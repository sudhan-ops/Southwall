function lF(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const a=Object.getOwnPropertyDescriptor(s,i);a&&Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var Tme=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function cF(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){var i=!1;try{i=this instanceof s}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var i=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return n[s]}})}),t}var Cb={exports:{}},Gh={},fb={exports:{}},Qt={};var PN;function UD(){if(PN)return Qt;PN=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function f(K){return K===null||typeof K!="object"?null:(K=m&&K[m]||K["@@iterator"],typeof K=="function"?K:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,x={};function v(K,re,le){this.props=K,this.context=re,this.refs=x,this.updater=le||p}v.prototype.isReactComponent={},v.prototype.setState=function(K,re){if(typeof K!="object"&&typeof K!="function"&&K!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,K,re,"setState")},v.prototype.forceUpdate=function(K){this.updater.enqueueForceUpdate(this,K,"forceUpdate")};function S(){}S.prototype=v.prototype;function B(K,re,le){this.props=K,this.context=re,this.refs=x,this.updater=le||p}var V=B.prototype=new S;V.constructor=B,b(V,v.prototype),V.isPureReactComponent=!0;var R=Array.isArray,W=Object.prototype.hasOwnProperty,_={current:null},Y={key:!0,ref:!0,__self:!0,__source:!0};function j(K,re,le){var ue,ae={},Ce=null,ie=null;if(re!=null)for(ue in re.ref!==void 0&&(ie=re.ref),re.key!==void 0&&(Ce=""+re.key),re)W.call(re,ue)&&!Y.hasOwnProperty(ue)&&(ae[ue]=re[ue]);var ge=arguments.length-2;if(ge===1)ae.children=le;else if(1<ge){for(var xe=Array(ge),_e=0;_e<ge;_e++)xe[_e]=arguments[_e+2];ae.children=xe}if(K&&K.defaultProps)for(ue in ge=K.defaultProps,ge)ae[ue]===void 0&&(ae[ue]=ge[ue]);return{$$typeof:n,type:K,key:Ce,ref:ie,props:ae,_owner:_.current}}function M(K,re){return{$$typeof:n,type:K.type,key:re,ref:K.ref,props:K.props,_owner:K._owner}}function H(K){return typeof K=="object"&&K!==null&&K.$$typeof===n}function D(K){var re={"=":"=0",":":"=2"};return"$"+K.replace(/[=:]/g,function(le){return re[le]})}var z=/\/+/g;function O(K,re){return typeof K=="object"&&K!==null&&K.key!=null?D(""+K.key):re.toString(36)}function E(K,re,le,ue,ae){var Ce=typeof K;(Ce==="undefined"||Ce==="boolean")&&(K=null);var ie=!1;if(K===null)ie=!0;else switch(Ce){case"string":case"number":ie=!0;break;case"object":switch(K.$$typeof){case n:case e:ie=!0}}if(ie)return ie=K,ae=ae(ie),K=ue===""?"."+O(ie,0):ue,R(ae)?(le="",K!=null&&(le=K.replace(z,"$&/")+"/"),E(ae,re,le,"",function(_e){return _e})):ae!=null&&(H(ae)&&(ae=M(ae,le+(!ae.key||ie&&ie.key===ae.key?"":(""+ae.key).replace(z,"$&/")+"/")+K)),re.push(ae)),1;if(ie=0,ue=ue===""?".":ue+":",R(K))for(var ge=0;ge<K.length;ge++){Ce=K[ge];var xe=ue+O(Ce,ge);ie+=E(Ce,re,le,xe,ae)}else if(xe=f(K),typeof xe=="function")for(K=xe.call(K),ge=0;!(Ce=K.next()).done;)Ce=Ce.value,xe=ue+O(Ce,ge++),ie+=E(Ce,re,le,xe,ae);else if(Ce==="object")throw re=String(K),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(K).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.");return ie}function te(K,re,le){if(K==null)return K;var ue=[],ae=0;return E(K,ue,"","",function(Ce){return re.call(le,Ce,ae++)}),ue}function q(K){if(K._status===-1){var re=K._result;re=re(),re.then(function(le){(K._status===0||K._status===-1)&&(K._status=1,K._result=le)},function(le){(K._status===0||K._status===-1)&&(K._status=2,K._result=le)}),K._status===-1&&(K._status=0,K._result=re)}if(K._status===1)return K._result.default;throw K._result}var de={current:null},U={transition:null},P={ReactCurrentDispatcher:de,ReactCurrentBatchConfig:U,ReactCurrentOwner:_};function ne(){throw Error("act(...) is not supported in production builds of React.")}return Qt.Children={map:te,forEach:function(K,re,le){te(K,function(){re.apply(this,arguments)},le)},count:function(K){var re=0;return te(K,function(){re++}),re},toArray:function(K){return te(K,function(re){return re})||[]},only:function(K){if(!H(K))throw Error("React.Children.only expected to receive a single React element child.");return K}},Qt.Component=v,Qt.Fragment=t,Qt.Profiler=i,Qt.PureComponent=B,Qt.StrictMode=s,Qt.Suspense=c,Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,Qt.act=ne,Qt.cloneElement=function(K,re,le){if(K==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+K+".");var ue=b({},K.props),ae=K.key,Ce=K.ref,ie=K._owner;if(re!=null){if(re.ref!==void 0&&(Ce=re.ref,ie=_.current),re.key!==void 0&&(ae=""+re.key),K.type&&K.type.defaultProps)var ge=K.type.defaultProps;for(xe in re)W.call(re,xe)&&!Y.hasOwnProperty(xe)&&(ue[xe]=re[xe]===void 0&&ge!==void 0?ge[xe]:re[xe])}var xe=arguments.length-2;if(xe===1)ue.children=le;else if(1<xe){ge=Array(xe);for(var _e=0;_e<xe;_e++)ge[_e]=arguments[_e+2];ue.children=ge}return{$$typeof:n,type:K.type,key:ae,ref:Ce,props:ue,_owner:ie}},Qt.createContext=function(K){return K={$$typeof:o,_currentValue:K,_currentValue2:K,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},K.Provider={$$typeof:a,_context:K},K.Consumer=K},Qt.createElement=j,Qt.createFactory=function(K){var re=j.bind(null,K);return re.type=K,re},Qt.createRef=function(){return{current:null}},Qt.forwardRef=function(K){return{$$typeof:l,render:K}},Qt.isValidElement=H,Qt.lazy=function(K){return{$$typeof:h,_payload:{_status:-1,_result:K},_init:q}},Qt.memo=function(K,re){return{$$typeof:d,type:K,compare:re===void 0?null:re}},Qt.startTransition=function(K){var re=U.transition;U.transition={};try{K()}finally{U.transition=re}},Qt.unstable_act=ne,Qt.useCallback=function(K,re){return de.current.useCallback(K,re)},Qt.useContext=function(K){return de.current.useContext(K)},Qt.useDebugValue=function(){},Qt.useDeferredValue=function(K){return de.current.useDeferredValue(K)},Qt.useEffect=function(K,re){return de.current.useEffect(K,re)},Qt.useId=function(){return de.current.useId()},Qt.useImperativeHandle=function(K,re,le){return de.current.useImperativeHandle(K,re,le)},Qt.useInsertionEffect=function(K,re){return de.current.useInsertionEffect(K,re)},Qt.useLayoutEffect=function(K,re){return de.current.useLayoutEffect(K,re)},Qt.useMemo=function(K,re){return de.current.useMemo(K,re)},Qt.useReducer=function(K,re,le){return de.current.useReducer(K,re,le)},Qt.useRef=function(K){return de.current.useRef(K)},Qt.useState=function(K){return de.current.useState(K)},Qt.useSyncExternalStore=function(K,re,le){return de.current.useSyncExternalStore(K,re,le)},Qt.useTransition=function(){return de.current.useTransition()},Qt.version="18.3.1",Qt}var KN;function Ar(){return KN||(KN=1,fb.exports=UD()),fb.exports}var ON;function QD(){if(ON)return Gh;ON=1;var n=Ar(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,d){var h,m={},f=null,p=null;d!==void 0&&(f=""+d),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(p=c.ref);for(h in c)s.call(c,h)&&!a.hasOwnProperty(h)&&(m[h]=c[h]);if(l&&l.defaultProps)for(h in c=l.defaultProps,c)m[h]===void 0&&(m[h]=c[h]);return{$$typeof:e,type:l,key:f,ref:p,props:m,_owner:i.current}}return Gh.Fragment=t,Gh.jsx=o,Gh.jsxs=o,Gh}var zN;function dF(){return zN||(zN=1,Cb.exports=QD()),Cb.exports}var r=dF(),k=Ar();const ot=rd(k),qD=lF({__proto__:null,default:ot},[k]);var EI={},pb={exports:{}},zr={},Ab={exports:{}},bb={};var UN;function $D(){return UN||(UN=1,(function(n){function e(U,P){var ne=U.length;U.push(P);e:for(;0<ne;){var K=ne-1>>>1,re=U[K];if(0<i(re,P))U[K]=P,U[ne]=re,ne=K;else break e}}function t(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var P=U[0],ne=U.pop();if(ne!==P){U[0]=ne;e:for(var K=0,re=U.length,le=re>>>1;K<le;){var ue=2*(K+1)-1,ae=U[ue],Ce=ue+1,ie=U[Ce];if(0>i(ae,ne))Ce<re&&0>i(ie,ae)?(U[K]=ie,U[Ce]=ne,K=Ce):(U[K]=ae,U[ue]=ne,K=ue);else if(Ce<re&&0>i(ie,ne))U[K]=ie,U[Ce]=ne,K=Ce;else break e}}return P}function i(U,P){var ne=U.sortIndex-P.sortIndex;return ne!==0?ne:U.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],d=[],h=1,m=null,f=3,p=!1,b=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(U){for(var P=t(d);P!==null;){if(P.callback===null)s(d);else if(P.startTime<=U)s(d),P.sortIndex=P.expirationTime,e(c,P);else break;P=t(d)}}function R(U){if(x=!1,V(U),!b)if(t(c)!==null)b=!0,q(W);else{var P=t(d);P!==null&&de(R,P.startTime-U)}}function W(U,P){b=!1,x&&(x=!1,S(j),j=-1),p=!0;var ne=f;try{for(V(P),m=t(c);m!==null&&(!(m.expirationTime>P)||U&&!D());){var K=m.callback;if(typeof K=="function"){m.callback=null,f=m.priorityLevel;var re=K(m.expirationTime<=P);P=n.unstable_now(),typeof re=="function"?m.callback=re:m===t(c)&&s(c),V(P)}else s(c);m=t(c)}if(m!==null)var le=!0;else{var ue=t(d);ue!==null&&de(R,ue.startTime-P),le=!1}return le}finally{m=null,f=ne,p=!1}}var _=!1,Y=null,j=-1,M=5,H=-1;function D(){return!(n.unstable_now()-H<M)}function z(){if(Y!==null){var U=n.unstable_now();H=U;var P=!0;try{P=Y(!0,U)}finally{P?O():(_=!1,Y=null)}}else _=!1}var O;if(typeof B=="function")O=function(){B(z)};else if(typeof MessageChannel<"u"){var E=new MessageChannel,te=E.port2;E.port1.onmessage=z,O=function(){te.postMessage(null)}}else O=function(){v(z,0)};function q(U){Y=U,_||(_=!0,O())}function de(U,P){j=v(function(){U(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(U){U.callback=null},n.unstable_continueExecution=function(){b||p||(b=!0,q(W))},n.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<U?Math.floor(1e3/U):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(U){switch(f){case 1:case 2:case 3:var P=3;break;default:P=f}var ne=f;f=P;try{return U()}finally{f=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(U,P){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var ne=f;f=U;try{return P()}finally{f=ne}},n.unstable_scheduleCallback=function(U,P,ne){var K=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?K+ne:K):ne=K,U){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=ne+re,U={id:h++,callback:P,priorityLevel:U,startTime:ne,expirationTime:re,sortIndex:-1},ne>K?(U.sortIndex=ne,e(d,U),t(c)===null&&U===t(d)&&(x?(S(j),j=-1):x=!0,de(R,ne-K))):(U.sortIndex=re,e(c,U),b||p||(b=!0,q(W))),U},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(U){var P=f;return function(){var ne=f;f=P;try{return U.apply(this,arguments)}finally{f=ne}}}})(bb)),bb}var QN;function e5(){return QN||(QN=1,Ab.exports=$D()),Ab.exports}var qN;function t5(){if(qN)return zr;qN=1;var n=Ar(),e=e5();function t(g){for(var I="https://reactjs.org/docs/error-decoder.html?invariant="+g,y=1;y<arguments.length;y++)I+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+g+"; visit "+I+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,i={};function a(g,I){o(g,I),o(g+"Capture",I)}function o(g,I){for(i[g]=I,g=0;g<I.length;g++)s.add(I[g])}var l=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},m={};function f(g){return c.call(m,g)?!0:c.call(h,g)?!1:d.test(g)?m[g]=!0:(h[g]=!0,!1)}function p(g,I,y,N){if(y!==null&&y.type===0)return!1;switch(typeof I){case"function":case"symbol":return!0;case"boolean":return N?!1:y!==null?!y.acceptsBooleans:(g=g.toLowerCase().slice(0,5),g!=="data-"&&g!=="aria-");default:return!1}}function b(g,I,y,N){if(I===null||typeof I>"u"||p(g,I,y,N))return!0;if(N)return!1;if(y!==null)switch(y.type){case 3:return!I;case 4:return I===!1;case 5:return isNaN(I);case 6:return isNaN(I)||1>I}return!1}function x(g,I,y,N,J,F,Q){this.acceptsBooleans=I===2||I===3||I===4,this.attributeName=N,this.attributeNamespace=J,this.mustUseProperty=y,this.propertyName=g,this.type=I,this.sanitizeURL=F,this.removeEmptyString=Q}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(g){v[g]=new x(g,0,!1,g,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(g){var I=g[0];v[I]=new x(I,1,!1,g[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(g){v[g]=new x(g,2,!1,g.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(g){v[g]=new x(g,2,!1,g,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(g){v[g]=new x(g,3,!1,g.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(g){v[g]=new x(g,3,!0,g,null,!1,!1)}),["capture","download"].forEach(function(g){v[g]=new x(g,4,!1,g,null,!1,!1)}),["cols","rows","size","span"].forEach(function(g){v[g]=new x(g,6,!1,g,null,!1,!1)}),["rowSpan","start"].forEach(function(g){v[g]=new x(g,5,!1,g.toLowerCase(),null,!1,!1)});var S=/[\-:]([a-z])/g;function B(g){return g[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(g){var I=g.replace(S,B);v[I]=new x(I,1,!1,g,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(g){var I=g.replace(S,B);v[I]=new x(I,1,!1,g,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(g){var I=g.replace(S,B);v[I]=new x(I,1,!1,g,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(g){v[g]=new x(g,1,!1,g.toLowerCase(),null,!1,!1)}),v.xlinkHref=new x("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(g){v[g]=new x(g,1,!1,g.toLowerCase(),null,!0,!0)});function V(g,I,y,N){var J=v.hasOwnProperty(I)?v[I]:null;(J!==null?J.type!==0:N||!(2<I.length)||I[0]!=="o"&&I[0]!=="O"||I[1]!=="n"&&I[1]!=="N")&&(b(I,y,J,N)&&(y=null),N||J===null?f(I)&&(y===null?g.removeAttribute(I):g.setAttribute(I,""+y)):J.mustUseProperty?g[J.propertyName]=y===null?J.type===3?!1:"":y:(I=J.attributeName,N=J.attributeNamespace,y===null?g.removeAttribute(I):(J=J.type,y=J===3||J===4&&y===!0?"":""+y,N?g.setAttributeNS(N,I,y):g.setAttribute(I,y))))}var R=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,W=Symbol.for("react.element"),_=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),H=Symbol.for("react.provider"),D=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),de=Symbol.for("react.offscreen"),U=Symbol.iterator;function P(g){return g===null||typeof g!="object"?null:(g=U&&g[U]||g["@@iterator"],typeof g=="function"?g:null)}var ne=Object.assign,K;function re(g){if(K===void 0)try{throw Error()}catch(y){var I=y.stack.trim().match(/\n( *(at )?)/);K=I&&I[1]||""}return`
`+K+g}var le=!1;function ue(g,I){if(!g||le)return"";le=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(I)if(I=function(){throw Error()},Object.defineProperty(I.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(I,[])}catch(Ve){var N=Ve}Reflect.construct(g,[],I)}else{try{I.call()}catch(Ve){N=Ve}g.call(I.prototype)}else{try{throw Error()}catch(Ve){N=Ve}g()}}catch(Ve){if(Ve&&N&&typeof Ve.stack=="string"){for(var J=Ve.stack.split(`
`),F=N.stack.split(`
`),Q=J.length-1,he=F.length-1;1<=Q&&0<=he&&J[Q]!==F[he];)he--;for(;1<=Q&&0<=he;Q--,he--)if(J[Q]!==F[he]){if(Q!==1||he!==1)do if(Q--,he--,0>he||J[Q]!==F[he]){var fe=`
`+J[Q].replace(" at new "," at ");return g.displayName&&fe.includes("<anonymous>")&&(fe=fe.replace("<anonymous>",g.displayName)),fe}while(1<=Q&&0<=he);break}}}finally{le=!1,Error.prepareStackTrace=y}return(g=g?g.displayName||g.name:"")?re(g):""}function ae(g){switch(g.tag){case 5:return re(g.type);case 16:return re("Lazy");case 13:return re("Suspense");case 19:return re("SuspenseList");case 0:case 2:case 15:return g=ue(g.type,!1),g;case 11:return g=ue(g.type.render,!1),g;case 1:return g=ue(g.type,!0),g;default:return""}}function Ce(g){if(g==null)return null;if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case Y:return"Fragment";case _:return"Portal";case M:return"Profiler";case j:return"StrictMode";case O:return"Suspense";case E:return"SuspenseList"}if(typeof g=="object")switch(g.$$typeof){case D:return(g.displayName||"Context")+".Consumer";case H:return(g._context.displayName||"Context")+".Provider";case z:var I=g.render;return g=g.displayName,g||(g=I.displayName||I.name||"",g=g!==""?"ForwardRef("+g+")":"ForwardRef"),g;case te:return I=g.displayName||null,I!==null?I:Ce(g.type)||"Memo";case q:I=g._payload,g=g._init;try{return Ce(g(I))}catch{}}return null}function ie(g){var I=g.type;switch(g.tag){case 24:return"Cache";case 9:return(I.displayName||"Context")+".Consumer";case 10:return(I._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=I.render,g=g.displayName||g.name||"",I.displayName||(g!==""?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return I;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ce(I);case 8:return I===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I}return null}function ge(g){switch(typeof g){case"boolean":case"number":case"string":case"undefined":return g;case"object":return g;default:return""}}function xe(g){var I=g.type;return(g=g.nodeName)&&g.toLowerCase()==="input"&&(I==="checkbox"||I==="radio")}function _e(g){var I=xe(g)?"checked":"value",y=Object.getOwnPropertyDescriptor(g.constructor.prototype,I),N=""+g[I];if(!g.hasOwnProperty(I)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var J=y.get,F=y.set;return Object.defineProperty(g,I,{configurable:!0,get:function(){return J.call(this)},set:function(Q){N=""+Q,F.call(this,Q)}}),Object.defineProperty(g,I,{enumerable:y.enumerable}),{getValue:function(){return N},setValue:function(Q){N=""+Q},stopTracking:function(){g._valueTracker=null,delete g[I]}}}}function Be(g){g._valueTracker||(g._valueTracker=_e(g))}function Se(g){if(!g)return!1;var I=g._valueTracker;if(!I)return!0;var y=I.getValue(),N="";return g&&(N=xe(g)?g.checked?"true":"false":g.value),g=N,g!==y?(I.setValue(g),!0):!1}function Re(g){if(g=g||(typeof document<"u"?document:void 0),typeof g>"u")return null;try{return g.activeElement||g.body}catch{return g.body}}function Ye(g,I){var y=I.checked;return ne({},I,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??g._wrapperState.initialChecked})}function De(g,I){var y=I.defaultValue==null?"":I.defaultValue,N=I.checked!=null?I.checked:I.defaultChecked;y=ge(I.value!=null?I.value:y),g._wrapperState={initialChecked:N,initialValue:y,controlled:I.type==="checkbox"||I.type==="radio"?I.checked!=null:I.value!=null}}function Me(g,I){I=I.checked,I!=null&&V(g,"checked",I,!1)}function Le(g,I){Me(g,I);var y=ge(I.value),N=I.type;if(y!=null)N==="number"?(y===0&&g.value===""||g.value!=y)&&(g.value=""+y):g.value!==""+y&&(g.value=""+y);else if(N==="submit"||N==="reset"){g.removeAttribute("value");return}I.hasOwnProperty("value")?st(g,I.type,y):I.hasOwnProperty("defaultValue")&&st(g,I.type,ge(I.defaultValue)),I.checked==null&&I.defaultChecked!=null&&(g.defaultChecked=!!I.defaultChecked)}function nt(g,I,y){if(I.hasOwnProperty("value")||I.hasOwnProperty("defaultValue")){var N=I.type;if(!(N!=="submit"&&N!=="reset"||I.value!==void 0&&I.value!==null))return;I=""+g._wrapperState.initialValue,y||I===g.value||(g.value=I),g.defaultValue=I}y=g.name,y!==""&&(g.name=""),g.defaultChecked=!!g._wrapperState.initialChecked,y!==""&&(g.name=y)}function st(g,I,y){(I!=="number"||Re(g.ownerDocument)!==g)&&(y==null?g.defaultValue=""+g._wrapperState.initialValue:g.defaultValue!==""+y&&(g.defaultValue=""+y))}var ee=Array.isArray;function oe(g,I,y,N){if(g=g.options,I){I={};for(var J=0;J<y.length;J++)I["$"+y[J]]=!0;for(y=0;y<g.length;y++)J=I.hasOwnProperty("$"+g[y].value),g[y].selected!==J&&(g[y].selected=J),J&&N&&(g[y].defaultSelected=!0)}else{for(y=""+ge(y),I=null,J=0;J<g.length;J++){if(g[J].value===y){g[J].selected=!0,N&&(g[J].defaultSelected=!0);return}I!==null||g[J].disabled||(I=g[J])}I!==null&&(I.selected=!0)}}function Ie(g,I){if(I.dangerouslySetInnerHTML!=null)throw Error(t(91));return ne({},I,{value:void 0,defaultValue:void 0,children:""+g._wrapperState.initialValue})}function Ne(g,I){var y=I.value;if(y==null){if(y=I.children,I=I.defaultValue,y!=null){if(I!=null)throw Error(t(92));if(ee(y)){if(1<y.length)throw Error(t(93));y=y[0]}I=y}I==null&&(I=""),y=I}g._wrapperState={initialValue:ge(y)}}function Ge(g,I){var y=ge(I.value),N=ge(I.defaultValue);y!=null&&(y=""+y,y!==g.value&&(g.value=y),I.defaultValue==null&&g.defaultValue!==y&&(g.defaultValue=y)),N!=null&&(g.defaultValue=""+N)}function je(g){var I=g.textContent;I===g._wrapperState.initialValue&&I!==""&&I!==null&&(g.value=I)}function Fe(g){switch(g){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ze(g,I){return g==null||g==="http://www.w3.org/1999/xhtml"?Fe(I):g==="http://www.w3.org/2000/svg"&&I==="foreignObject"?"http://www.w3.org/1999/xhtml":g}var lt,Dt=(function(g){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(I,y,N,J){MSApp.execUnsafeLocalFunction(function(){return g(I,y,N,J)})}:g})(function(g,I){if(g.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in g)g.innerHTML=I;else{for(lt=lt||document.createElement("div"),lt.innerHTML="<svg>"+I.valueOf().toString()+"</svg>",I=lt.firstChild;g.firstChild;)g.removeChild(g.firstChild);for(;I.firstChild;)g.appendChild(I.firstChild)}});function kt(g,I){if(I){var y=g.firstChild;if(y&&y===g.lastChild&&y.nodeType===3){y.nodeValue=I;return}}g.textContent=I}var $t={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wn=["Webkit","ms","Moz","O"];Object.keys($t).forEach(function(g){wn.forEach(function(I){I=I+g.charAt(0).toUpperCase()+g.substring(1),$t[I]=$t[g]})});function Rt(g,I,y){return I==null||typeof I=="boolean"||I===""?"":y||typeof I!="number"||I===0||$t.hasOwnProperty(g)&&$t[g]?(""+I).trim():I+"px"}function cn(g,I){g=g.style;for(var y in I)if(I.hasOwnProperty(y)){var N=y.indexOf("--")===0,J=Rt(y,I[y],N);y==="float"&&(y="cssFloat"),N?g.setProperty(y,J):g[y]=J}}var en=ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(g,I){if(I){if(en[g]&&(I.children!=null||I.dangerouslySetInnerHTML!=null))throw Error(t(137,g));if(I.dangerouslySetInnerHTML!=null){if(I.children!=null)throw Error(t(60));if(typeof I.dangerouslySetInnerHTML!="object"||!("__html"in I.dangerouslySetInnerHTML))throw Error(t(61))}if(I.style!=null&&typeof I.style!="object")throw Error(t(62))}}function Ut(g,I){if(g.indexOf("-")===-1)return typeof I.is=="string";switch(g){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dn=null;function fn(g){return g=g.target||g.srcElement||window,g.correspondingUseElement&&(g=g.correspondingUseElement),g.nodeType===3?g.parentNode:g}var Ft=null,it=null,pn=null;function un(g){if(g=dl(g)){if(typeof Ft!="function")throw Error(t(280));var I=g.stateNode;I&&(I=Yg(I),Ft(g.stateNode,g.type,I))}}function ls(g){it?pn?pn.push(g):pn=[g]:it=g}function Cs(){if(it){var g=it,I=pn;if(pn=it=null,un(g),I)for(g=0;g<I.length;g++)un(I[g])}}function br(g,I){return g(I)}function Ia(){}var Xr=!1;function Rn(g,I,y){if(Xr)return g(I,y);Xr=!0;try{return br(g,I,y)}finally{Xr=!1,(it!==null||pn!==null)&&(Ia(),Cs())}}function nr(g,I){var y=g.stateNode;if(y===null)return null;var N=Yg(y);if(N===null)return null;y=N[I];e:switch(I){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(g=g.type,N=!(g==="button"||g==="input"||g==="select"||g==="textarea")),g=!N;break e;default:g=!1}if(g)return null;if(y&&typeof y!="function")throw Error(t(231,I,typeof y));return y}var Jr=!1;if(l)try{var Gs={};Object.defineProperty(Gs,"passive",{get:function(){Jr=!0}}),window.addEventListener("test",Gs,Gs),window.removeEventListener("test",Gs,Gs)}catch{Jr=!1}function Yo(g,I,y,N,J,F,Q,he,fe){var Ve=Array.prototype.slice.call(arguments,3);try{I.apply(y,Ve)}catch(Ke){this.onError(Ke)}}var fs=!1,gt=null,Ca=!1,Pa=null,Tl={onError:function(g){fs=!0,gt=g}};function El(g,I,y,N,J,F,Q,he,fe){fs=!1,gt=null,Yo.apply(Tl,arguments)}function Fo(g,I,y,N,J,F,Q,he,fe){if(El.apply(this,arguments),fs){if(fs){var Ve=gt;fs=!1,gt=null}else throw Error(t(198));Ca||(Ca=!0,Pa=Ve)}}function Yr(g){var I=g,y=g;if(g.alternate)for(;I.return;)I=I.return;else{g=I;do I=g,(I.flags&4098)!==0&&(y=I.return),g=I.return;while(g)}return I.tag===3?y:null}function ai(g){if(g.tag===13){var I=g.memoizedState;if(I===null&&(g=g.alternate,g!==null&&(I=g.memoizedState)),I!==null)return I.dehydrated}return null}function Mo(g){if(Yr(g)!==g)throw Error(t(188))}function yd(g){var I=g.alternate;if(!I){if(I=Yr(g),I===null)throw Error(t(188));return I!==g?null:g}for(var y=g,N=I;;){var J=y.return;if(J===null)break;var F=J.alternate;if(F===null){if(N=J.return,N!==null){y=N;continue}break}if(J.child===F.child){for(F=J.child;F;){if(F===y)return Mo(J),g;if(F===N)return Mo(J),I;F=F.sibling}throw Error(t(188))}if(y.return!==N.return)y=J,N=F;else{for(var Q=!1,he=J.child;he;){if(he===y){Q=!0,y=J,N=F;break}if(he===N){Q=!0,N=J,y=F;break}he=he.sibling}if(!Q){for(he=F.child;he;){if(he===y){Q=!0,y=F,N=J;break}if(he===N){Q=!0,N=F,y=J;break}he=he.sibling}if(!Q)throw Error(t(189))}}if(y.alternate!==N)throw Error(t(190))}if(y.tag!==3)throw Error(t(188));return y.stateNode.current===y?g:I}function Dl(g){return g=yd(g),g!==null?Ll(g):null}function Ll(g){if(g.tag===5||g.tag===6)return g;for(g=g.child;g!==null;){var I=Ll(g);if(I!==null)return I;g=g.sibling}return null}var Pl=e.unstable_scheduleCallback,Ho=e.unstable_cancelCallback,vd=e.unstable_shouldYield,Ka=e.unstable_requestPaint,jn=e.unstable_now,xd=e.unstable_getCurrentPriorityLevel,To=e.unstable_ImmediatePriority,Kl=e.unstable_UserBlockingPriority,Oa=e.unstable_NormalPriority,Eo=e.unstable_LowPriority,Vi=e.unstable_IdlePriority,fa=null,Es=null;function pa(g){if(Es&&typeof Es.onCommitFiberRoot=="function")try{Es.onCommitFiberRoot(fa,g,void 0,(g.current.flags&128)===128)}catch{}}var Wt=Math.clz32?Math.clz32:_i,Zn=Math.log,za=Math.LN2;function _i(g){return g>>>=0,g===0?32:31-(Zn(g)/za|0)|0}var yr=64,ji=4194304;function Nt(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return g&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function vn(g,I){var y=g.pendingLanes;if(y===0)return 0;var N=0,J=g.suspendedLanes,F=g.pingedLanes,Q=y&268435455;if(Q!==0){var he=Q&~J;he!==0?N=Nt(he):(F&=Q,F!==0&&(N=Nt(F)))}else Q=y&~J,Q!==0?N=Nt(Q):F!==0&&(N=Nt(F));if(N===0)return 0;if(I!==0&&I!==N&&(I&J)===0&&(J=N&-N,F=I&-I,J>=F||J===16&&(F&4194240)!==0))return I;if((N&4)!==0&&(N|=y&16),I=g.entangledLanes,I!==0)for(g=g.entanglements,I&=N;0<I;)y=31-Wt(I),J=1<<y,N|=g[y],I&=~J;return N}function Do(g,I){switch(g){case 1:case 2:case 4:return I+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ua(g,I){for(var y=g.suspendedLanes,N=g.pingedLanes,J=g.expirationTimes,F=g.pendingLanes;0<F;){var Q=31-Wt(F),he=1<<Q,fe=J[Q];fe===-1?((he&y)===0||(he&N)!==0)&&(J[Q]=Do(he,I)):fe<=I&&(g.expiredLanes|=he),F&=~he}}function ps(g){return g=g.pendingLanes&-1073741825,g!==0?g:g&1073741824?1073741824:0}function Ol(){var g=yr;return yr<<=1,(yr&4194240)===0&&(yr=64),g}function Xi(g){for(var I=[],y=0;31>y;y++)I.push(g);return I}function Ds(g,I,y){g.pendingLanes|=I,I!==536870912&&(g.suspendedLanes=0,g.pingedLanes=0),g=g.eventTimes,I=31-Wt(I),g[I]=y}function Fn(g,I){var y=g.pendingLanes&~I;g.pendingLanes=I,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=I,g.mutableReadLanes&=I,g.entangledLanes&=I,I=g.entanglements;var N=g.eventTimes;for(g=g.expirationTimes;0<y;){var J=31-Wt(y),F=1<<J;I[J]=0,N[J]=-1,g[J]=-1,y&=~F}}function vr(g,I){var y=g.entangledLanes|=I;for(g=g.entanglements;y;){var N=31-Wt(y),J=1<<N;J&I|g[N]&I&&(g[N]|=I),y&=~J}}var zt=0;function Ji(g){return g&=-g,1<g?4<g?(g&268435455)!==0?16:536870912:4:1}var Qa,oi,qa,$a,Aa,ba=!1,Yi=[],Ls=null,xr=null,sr=null,ya=new Map,wt=new Map,qn=[],hn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lo(g,I){switch(g){case"focusin":case"focusout":Ls=null;break;case"dragenter":case"dragleave":xr=null;break;case"mouseover":case"mouseout":sr=null;break;case"pointerover":case"pointerout":ya.delete(I.pointerId);break;case"gotpointercapture":case"lostpointercapture":wt.delete(I.pointerId)}}function li(g,I,y,N,J,F){return g===null||g.nativeEvent!==F?(g={blockedOn:I,domEventName:y,eventSystemFlags:N,nativeEvent:F,targetContainers:[J]},I!==null&&(I=dl(I),I!==null&&oi(I)),g):(g.eventSystemFlags|=N,I=g.targetContainers,J!==null&&I.indexOf(J)===-1&&I.push(J),g)}function Po(g,I,y,N,J){switch(I){case"focusin":return Ls=li(Ls,g,I,y,N,J),!0;case"dragenter":return xr=li(xr,g,I,y,N,J),!0;case"mouseover":return sr=li(sr,g,I,y,N,J),!0;case"pointerover":var F=J.pointerId;return ya.set(F,li(ya.get(F)||null,g,I,y,N,J)),!0;case"gotpointercapture":return F=J.pointerId,wt.set(F,li(wt.get(F)||null,g,I,y,N,J)),!0}return!1}function eo(g){var I=cl(g.target);if(I!==null){var y=Yr(I);if(y!==null){if(I=y.tag,I===13){if(I=ai(y),I!==null){g.blockedOn=I,Aa(g.priority,function(){qa(y)});return}}else if(I===3&&y.stateNode.current.memoizedState.isDehydrated){g.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}g.blockedOn=null}function rr(g){if(g.blockedOn!==null)return!1;for(var I=g.targetContainers;0<I.length;){var y=so(g.domEventName,g.eventSystemFlags,I[0],g.nativeEvent);if(y===null){y=g.nativeEvent;var N=new y.constructor(y.type,y);dn=N,y.target.dispatchEvent(N),dn=null}else return I=dl(y),I!==null&&oi(I),g.blockedOn=y,!1;I.shift()}return!0}function to(g,I,y){rr(g)&&y.delete(I)}function va(){ba=!1,Ls!==null&&rr(Ls)&&(Ls=null),xr!==null&&rr(xr)&&(xr=null),sr!==null&&rr(sr)&&(sr=null),ya.forEach(to),wt.forEach(to)}function Xn(g,I){g.blockedOn===I&&(g.blockedOn=null,ba||(ba=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,va)))}function Ps(g){function I(J){return Xn(J,g)}if(0<Yi.length){Xn(Yi[0],g);for(var y=1;y<Yi.length;y++){var N=Yi[y];N.blockedOn===g&&(N.blockedOn=null)}}for(Ls!==null&&Xn(Ls,g),xr!==null&&Xn(xr,g),sr!==null&&Xn(sr,g),ya.forEach(I),wt.forEach(I),y=0;y<qn.length;y++)N=qn[y],N.blockedOn===g&&(N.blockedOn=null);for(;0<qn.length&&(y=qn[0],y.blockedOn===null);)eo(y),y.blockedOn===null&&qn.shift()}var ci=R.ReactCurrentBatchConfig,xa=!0;function Sd(g,I,y,N){var J=zt,F=ci.transition;ci.transition=null;try{zt=1,Sa(g,I,y,N)}finally{zt=J,ci.transition=F}}function zl(g,I,y,N){var J=zt,F=ci.transition;ci.transition=null;try{zt=4,Sa(g,I,y,N)}finally{zt=J,ci.transition=F}}function Sa(g,I,y,N){if(xa){var J=so(g,I,y,N);if(J===null)u(g,I,N,no,y),Lo(g,N);else if(Po(J,g,I,y,N))N.stopPropagation();else if(Lo(g,N),I&4&&-1<hn.indexOf(g)){for(;J!==null;){var F=dl(J);if(F!==null&&Qa(F),F=so(g,I,y,N),F===null&&u(g,I,N,no,y),F===J)break;J=F}J!==null&&N.stopPropagation()}else u(g,I,N,null,y)}}var no=null;function so(g,I,y,N){if(no=null,g=fn(N),g=cl(g),g!==null)if(I=Yr(g),I===null)g=null;else if(y=I.tag,y===13){if(g=ai(I),g!==null)return g;g=null}else if(y===3){if(I.stateNode.current.memoizedState.isDehydrated)return I.tag===3?I.stateNode.containerInfo:null;g=null}else I!==g&&(g=null);return no=g,null}function Pt(g){switch(g){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xd()){case To:return 1;case Kl:return 4;case Oa:case Eo:return 16;case Vi:return 536870912;default:return 16}default:return 16}}var Fr=null,Bs=null,Mr=null;function Ko(){if(Mr)return Mr;var g,I=Bs,y=I.length,N,J="value"in Fr?Fr.value:Fr.textContent,F=J.length;for(g=0;g<y&&I[g]===J[g];g++);var Q=y-g;for(N=1;N<=Q&&I[y-N]===J[F-N];N++);return Mr=J.slice(g,1<N?1-N:void 0)}function ro(g){var I=g.keyCode;return"charCode"in g?(g=g.charCode,g===0&&I===13&&(g=13)):g=I,g===10&&(g=13),32<=g||g===13?g:0}function Fi(){return!0}function Ul(){return!1}function As(g){function I(y,N,J,F,Q){this._reactName=y,this._targetInst=J,this.type=N,this.nativeEvent=F,this.target=Q,this.currentTarget=null;for(var he in g)g.hasOwnProperty(he)&&(y=g[he],this[he]=y?y(F):F[he]);return this.isDefaultPrevented=(F.defaultPrevented!=null?F.defaultPrevented:F.returnValue===!1)?Fi:Ul,this.isPropagationStopped=Ul,this}return ne(I.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Fi)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Fi)},persist:function(){},isPersistent:Fi}),I}var Mi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(g){return g.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Oo=As(Mi),di=ne({},Mi,{view:0,detail:0}),wd=As(di),Js,zo,Hi,Ks=ne({},di,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ui,button:0,buttons:0,relatedTarget:function(g){return g.relatedTarget===void 0?g.fromElement===g.srcElement?g.toElement:g.fromElement:g.relatedTarget},movementX:function(g){return"movementX"in g?g.movementX:(g!==Hi&&(Hi&&g.type==="mousemove"?(Js=g.screenX-Hi.screenX,zo=g.screenY-Hi.screenY):zo=Js=0,Hi=g),Js)},movementY:function(g){return"movementY"in g?g.movementY:zo}}),Uo=As(Ks),Ql=ne({},Ks,{dataTransfer:0}),Qo=As(Ql),Zd=ne({},di,{relatedTarget:0}),io=As(Zd),ql=ne({},Mi,{animationName:0,elapsedTime:0,pseudoElement:0}),Gd=As(ql),Bd=ne({},Mi,{clipboardData:function(g){return"clipboardData"in g?g.clipboardData:window.clipboardData}}),qo=As(Bd),Nd=ne({},Mi,{data:0}),$o=As(Nd),$l={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ao={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kd(g){var I=this.nativeEvent;return I.getModifierState?I.getModifierState(g):(g=gi[g])?!!I[g]:!1}function ui(){return kd}var Ys=ne({},di,{key:function(g){if(g.key){var I=$l[g.key]||g.key;if(I!=="Unidentified")return I}return g.type==="keypress"?(g=ro(g),g===13?"Enter":String.fromCharCode(g)):g.type==="keydown"||g.type==="keyup"?ao[g.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ui,charCode:function(g){return g.type==="keypress"?ro(g):0},keyCode:function(g){return g.type==="keydown"||g.type==="keyup"?g.keyCode:0},which:function(g){return g.type==="keypress"?ro(g):g.type==="keydown"||g.type==="keyup"?g.keyCode:0}}),ec=As(Ys),tc=ne({},Ks,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nc=As(tc),el=ne({},di,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ui}),tl=As(el),Rd=ne({},Mi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wd=As(Rd),sc=ne({},Ks,{deltaX:function(g){return"deltaX"in g?g.deltaX:"wheelDeltaX"in g?-g.wheelDeltaX:0},deltaY:function(g){return"deltaY"in g?g.deltaY:"wheelDeltaY"in g?-g.wheelDeltaY:"wheelDelta"in g?-g.wheelDelta:0},deltaZ:0,deltaMode:0}),Vd=As(sc),Os=[9,13,27,32],Hr=l&&"CompositionEvent"in window,wa=null;l&&"documentMode"in document&&(wa=document.documentMode);var Sr=l&&"TextEvent"in window&&!wa,rc=l&&(!Hr||wa&&8<wa&&11>=wa),hi=" ",ic=!1;function Ti(g,I){switch(g){case"keyup":return Os.indexOf(I.keyCode)!==-1;case"keydown":return I.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nl(g){return g=g.detail,typeof g=="object"&&"data"in g?g.data:null}var wr=!1;function _d(g,I){switch(g){case"compositionend":return nl(I);case"keypress":return I.which!==32?null:(ic=!0,hi);case"textInput":return g=I.data,g===hi&&ic?null:g;default:return null}}function Tr(g,I){if(wr)return g==="compositionend"||!Hr&&Ti(g,I)?(g=Ko(),Mr=Bs=Fr=null,wr=!1,g):null;switch(g){case"paste":return null;case"keypress":if(!(I.ctrlKey||I.altKey||I.metaKey)||I.ctrlKey&&I.altKey){if(I.char&&1<I.char.length)return I.char;if(I.which)return String.fromCharCode(I.which)}return null;case"compositionend":return rc&&I.locale!=="ko"?null:I.data;default:return null}}var oo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ac(g){var I=g&&g.nodeName&&g.nodeName.toLowerCase();return I==="input"?!!oo[g.type]:I==="textarea"}function lo(g,I,y,N){ls(N),I=G(I,"onChange"),0<I.length&&(y=new Oo("onChange","change",null,y,N),g.push({event:y,listeners:I}))}var Za=null,Ns=null;function jd(g){dh(g,0)}function Zr(g){var I=gl(g);if(Se(I))return g}function Xd(g,I){if(g==="change")return I}var ir=!1;if(l){var Ei;if(l){var co="oninput"in document;if(!co){var go=document.createElement("div");go.setAttribute("oninput","return;"),co=typeof go.oninput=="function"}Ei=co}else Ei=!1;ir=Ei&&(!document.documentMode||9<document.documentMode)}function Ga(){Za&&(Za.detachEvent("onpropertychange",uo),Ns=Za=null)}function uo(g){if(g.propertyName==="value"&&Zr(Ns)){var I=[];lo(I,Ns,g,fn(g)),Rn(jd,I)}}function ho(g,I,y){g==="focusin"?(Ga(),Za=I,Ns=y,Za.attachEvent("onpropertychange",uo)):g==="focusout"&&Ga()}function Di(g){if(g==="selectionchange"||g==="keyup"||g==="keydown")return Zr(Ns)}function mo(g,I){if(g==="click")return Zr(I)}function sl(g,I){if(g==="input"||g==="change")return Zr(I)}function oc(g,I){return g===I&&(g!==0||1/g===1/I)||g!==g&&I!==I}var zs=typeof Object.is=="function"?Object.is:oc;function Er(g,I){if(zs(g,I))return!0;if(typeof g!="object"||g===null||typeof I!="object"||I===null)return!1;var y=Object.keys(g),N=Object.keys(I);if(y.length!==N.length)return!1;for(N=0;N<y.length;N++){var J=y[N];if(!c.call(I,J)||!zs(g[J],I[J]))return!1}return!0}function lc(g){for(;g&&g.firstChild;)g=g.firstChild;return g}function rl(g,I){var y=lc(g);g=0;for(var N;y;){if(y.nodeType===3){if(N=g+y.textContent.length,g<=I&&N>=I)return{node:y,offset:I-g};g=N}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=lc(y)}}function cc(g,I){return g&&I?g===I?!0:g&&g.nodeType===3?!1:I&&I.nodeType===3?cc(g,I.parentNode):"contains"in g?g.contains(I):g.compareDocumentPosition?!!(g.compareDocumentPosition(I)&16):!1:!1}function il(){for(var g=window,I=Re();I instanceof g.HTMLIFrameElement;){try{var y=typeof I.contentWindow.location.href=="string"}catch{y=!1}if(y)g=I.contentWindow;else break;I=Re(g.document)}return I}function al(g){var I=g&&g.nodeName&&g.nodeName.toLowerCase();return I&&(I==="input"&&(g.type==="text"||g.type==="search"||g.type==="tel"||g.type==="url"||g.type==="password")||I==="textarea"||g.contentEditable==="true")}function C(g){var I=il(),y=g.focusedElem,N=g.selectionRange;if(I!==y&&y&&y.ownerDocument&&cc(y.ownerDocument.documentElement,y)){if(N!==null&&al(y)){if(I=N.start,g=N.end,g===void 0&&(g=I),"selectionStart"in y)y.selectionStart=I,y.selectionEnd=Math.min(g,y.value.length);else if(g=(I=y.ownerDocument||document)&&I.defaultView||window,g.getSelection){g=g.getSelection();var J=y.textContent.length,F=Math.min(N.start,J);N=N.end===void 0?F:Math.min(N.end,J),!g.extend&&F>N&&(J=N,N=F,F=J),J=rl(y,F);var Q=rl(y,N);J&&Q&&(g.rangeCount!==1||g.anchorNode!==J.node||g.anchorOffset!==J.offset||g.focusNode!==Q.node||g.focusOffset!==Q.offset)&&(I=I.createRange(),I.setStart(J.node,J.offset),g.removeAllRanges(),F>N?(g.addRange(I),g.extend(Q.node,Q.offset)):(I.setEnd(Q.node,Q.offset),g.addRange(I)))}}for(I=[],g=y;g=g.parentNode;)g.nodeType===1&&I.push({element:g,left:g.scrollLeft,top:g.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<I.length;y++)g=I[y],g.element.scrollLeft=g.left,g.element.scrollTop=g.top}}var jg=l&&"documentMode"in document&&11>=document.documentMode,dc=null,gc=null,Jd=null,Xg=!1;function qm(g,I,y){var N=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Xg||dc==null||dc!==Re(N)||(N=dc,"selectionStart"in N&&al(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),Jd&&Er(Jd,N)||(Jd=N,N=G(gc,"onSelect"),0<N.length&&(I=new Oo("onSelect","select",null,I,y),g.push({event:I,listeners:N}),I.target=dc)))}function Io(g,I){var y={};return y[g.toLowerCase()]=I.toLowerCase(),y["Webkit"+g]="webkit"+I,y["Moz"+g]="moz"+I,y}var uc={animationend:Io("Animation","AnimationEnd"),animationiteration:Io("Animation","AnimationIteration"),animationstart:Io("Animation","AnimationStart"),transitionend:Io("Transition","TransitionEnd")},Co={},ah={};l&&(ah=document.createElement("div").style,"AnimationEvent"in window||(delete uc.animationend.animation,delete uc.animationiteration.animation,delete uc.animationstart.animation),"TransitionEvent"in window||delete uc.transitionend.transition);function Yd(g){if(Co[g])return Co[g];if(!uc[g])return g;var I=uc[g],y;for(y in I)if(I.hasOwnProperty(y)&&y in ah)return Co[g]=I[y];return g}var $m=Yd("animationend"),Li=Yd("animationiteration"),oh=Yd("animationstart"),lh=Yd("transitionend"),hc=new Map,eI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mi(g,I){hc.set(g,I),a(I,[g])}for(var ol=0;ol<eI.length;ol++){var Jg=eI[ol],tI=Jg.toLowerCase(),dA=Jg[0].toUpperCase()+Jg.slice(1);mi(tI,"on"+dA)}mi($m,"onAnimationEnd"),mi(Li,"onAnimationIteration"),mi(oh,"onAnimationStart"),mi("dblclick","onDoubleClick"),mi("focusin","onFocus"),mi("focusout","onBlur"),mi(lh,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nI=new Set("cancel close invalid load scroll toggle".split(" ").concat(mc));function ch(g,I,y){var N=g.type||"unknown-event";g.currentTarget=y,Fo(N,I,void 0,g),g.currentTarget=null}function dh(g,I){I=(I&4)!==0;for(var y=0;y<g.length;y++){var N=g[y],J=N.event;N=N.listeners;e:{var F=void 0;if(I)for(var Q=N.length-1;0<=Q;Q--){var he=N[Q],fe=he.instance,Ve=he.currentTarget;if(he=he.listener,fe!==F&&J.isPropagationStopped())break e;ch(J,he,Ve),F=fe}else for(Q=0;Q<N.length;Q++){if(he=N[Q],fe=he.instance,Ve=he.currentTarget,he=he.listener,fe!==F&&J.isPropagationStopped())break e;ch(J,he,Ve),F=fe}}}if(Ca)throw g=Pa,Ca=!1,Pa=null,g}function Wn(g,I){var y=I[pc];y===void 0&&(y=I[pc]=new Set);var N=g+"__bubble";y.has(N)||(sI(I,g,2,!1),y.add(N))}function gh(g,I,y){var N=0;I&&(N|=4),sI(y,g,N,I)}var Fd="_reactListening"+Math.random().toString(36).slice(2);function Ic(g){if(!g[Fd]){g[Fd]=!0,s.forEach(function(y){y!=="selectionchange"&&(nI.has(y)||gh(y,!1,g),gh(y,!0,g))});var I=g.nodeType===9?g:g.ownerDocument;I===null||I[Fd]||(I[Fd]=!0,gh("selectionchange",!1,I))}}function sI(g,I,y,N){switch(Pt(I)){case 1:var J=Sd;break;case 4:J=zl;break;default:J=Sa}y=J.bind(null,I,y,g),J=void 0,!Jr||I!=="touchstart"&&I!=="touchmove"&&I!=="wheel"||(J=!0),N?J!==void 0?g.addEventListener(I,y,{capture:!0,passive:J}):g.addEventListener(I,y,!0):J!==void 0?g.addEventListener(I,y,{passive:J}):g.addEventListener(I,y,!1)}function u(g,I,y,N,J){var F=N;if((I&1)===0&&(I&2)===0&&N!==null)e:for(;;){if(N===null)return;var Q=N.tag;if(Q===3||Q===4){var he=N.stateNode.containerInfo;if(he===J||he.nodeType===8&&he.parentNode===J)break;if(Q===4)for(Q=N.return;Q!==null;){var fe=Q.tag;if((fe===3||fe===4)&&(fe=Q.stateNode.containerInfo,fe===J||fe.nodeType===8&&fe.parentNode===J))return;Q=Q.return}for(;he!==null;){if(Q=cl(he),Q===null)return;if(fe=Q.tag,fe===5||fe===6){N=F=Q;continue e}he=he.parentNode}}N=N.return}Rn(function(){var Ve=F,Ke=fn(y),Ue=[];e:{var Pe=hc.get(g);if(Pe!==void 0){var at=Oo,ut=g;switch(g){case"keypress":if(ro(y)===0)break e;case"keydown":case"keyup":at=ec;break;case"focusin":ut="focus",at=io;break;case"focusout":ut="blur",at=io;break;case"beforeblur":case"afterblur":at=io;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":at=Uo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":at=Qo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":at=tl;break;case $m:case Li:case oh:at=Gd;break;case lh:at=Wd;break;case"scroll":at=wd;break;case"wheel":at=Vd;break;case"copy":case"cut":case"paste":at=qo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":at=nc}var mt=(I&4)!==0,cs=!mt&&g==="scroll",Ze=mt?Pe!==null?Pe+"Capture":null:Pe;mt=[];for(var Ae=Ve,ke;Ae!==null;){ke=Ae;var Qe=ke.stateNode;if(ke.tag===5&&Qe!==null&&(ke=Qe,Ze!==null&&(Qe=nr(Ae,Ze),Qe!=null&&mt.push(A(Ae,Qe,ke)))),cs)break;Ae=Ae.return}0<mt.length&&(Pe=new at(Pe,ut,null,y,Ke),Ue.push({event:Pe,listeners:mt}))}}if((I&7)===0){e:{if(Pe=g==="mouseover"||g==="pointerover",at=g==="mouseout"||g==="pointerout",Pe&&y!==dn&&(ut=y.relatedTarget||y.fromElement)&&(cl(ut)||ut[xn]))break e;if((at||Pe)&&(Pe=Ke.window===Ke?Ke:(Pe=Ke.ownerDocument)?Pe.defaultView||Pe.parentWindow:window,at?(ut=y.relatedTarget||y.toElement,at=Ve,ut=ut?cl(ut):null,ut!==null&&(cs=Yr(ut),ut!==cs||ut.tag!==5&&ut.tag!==6)&&(ut=null)):(at=null,ut=Ve),at!==ut)){if(mt=Uo,Qe="onMouseLeave",Ze="onMouseEnter",Ae="mouse",(g==="pointerout"||g==="pointerover")&&(mt=nc,Qe="onPointerLeave",Ze="onPointerEnter",Ae="pointer"),cs=at==null?Pe:gl(at),ke=ut==null?Pe:gl(ut),Pe=new mt(Qe,Ae+"leave",at,y,Ke),Pe.target=cs,Pe.relatedTarget=ke,Qe=null,cl(Ke)===Ve&&(mt=new mt(Ze,Ae+"enter",ut,y,Ke),mt.target=ke,mt.relatedTarget=cs,Qe=mt),cs=Qe,at&&ut)t:{for(mt=at,Ze=ut,Ae=0,ke=mt;ke;ke=X(ke))Ae++;for(ke=0,Qe=Ze;Qe;Qe=X(Qe))ke++;for(;0<Ae-ke;)mt=X(mt),Ae--;for(;0<ke-Ae;)Ze=X(Ze),ke--;for(;Ae--;){if(mt===Ze||Ze!==null&&mt===Ze.alternate)break t;mt=X(mt),Ze=X(Ze)}mt=null}else mt=null;at!==null&&T(Ue,Pe,at,mt,!1),ut!==null&&cs!==null&&T(Ue,cs,ut,mt,!0)}}e:{if(Pe=Ve?gl(Ve):window,at=Pe.nodeName&&Pe.nodeName.toLowerCase(),at==="select"||at==="input"&&Pe.type==="file")var Ct=Xd;else if(ac(Pe))if(ir)Ct=sl;else{Ct=Di;var Zt=ho}else(at=Pe.nodeName)&&at.toLowerCase()==="input"&&(Pe.type==="checkbox"||Pe.type==="radio")&&(Ct=mo);if(Ct&&(Ct=Ct(g,Ve))){lo(Ue,Ct,y,Ke);break e}Zt&&Zt(g,Pe,Ve),g==="focusout"&&(Zt=Pe._wrapperState)&&Zt.controlled&&Pe.type==="number"&&st(Pe,"number",Pe.value)}switch(Zt=Ve?gl(Ve):window,g){case"focusin":(ac(Zt)||Zt.contentEditable==="true")&&(dc=Zt,gc=Ve,Jd=null);break;case"focusout":Jd=gc=dc=null;break;case"mousedown":Xg=!0;break;case"contextmenu":case"mouseup":case"dragend":Xg=!1,qm(Ue,y,Ke);break;case"selectionchange":if(jg)break;case"keydown":case"keyup":qm(Ue,y,Ke)}var Gt;if(Hr)e:{switch(g){case"compositionstart":var Xt="onCompositionStart";break e;case"compositionend":Xt="onCompositionEnd";break e;case"compositionupdate":Xt="onCompositionUpdate";break e}Xt=void 0}else wr?Ti(g,y)&&(Xt="onCompositionEnd"):g==="keydown"&&y.keyCode===229&&(Xt="onCompositionStart");Xt&&(rc&&y.locale!=="ko"&&(wr||Xt!=="onCompositionStart"?Xt==="onCompositionEnd"&&wr&&(Gt=Ko()):(Fr=Ke,Bs="value"in Fr?Fr.value:Fr.textContent,wr=!0)),Zt=G(Ve,Xt),0<Zt.length&&(Xt=new $o(Xt,g,null,y,Ke),Ue.push({event:Xt,listeners:Zt}),Gt?Xt.data=Gt:(Gt=nl(y),Gt!==null&&(Xt.data=Gt)))),(Gt=Sr?_d(g,y):Tr(g,y))&&(Ve=G(Ve,"onBeforeInput"),0<Ve.length&&(Ke=new $o("onBeforeInput","beforeinput",null,y,Ke),Ue.push({event:Ke,listeners:Ve}),Ke.data=Gt))}dh(Ue,I)})}function A(g,I,y){return{instance:g,listener:I,currentTarget:y}}function G(g,I){for(var y=I+"Capture",N=[];g!==null;){var J=g,F=J.stateNode;J.tag===5&&F!==null&&(J=F,F=nr(g,y),F!=null&&N.unshift(A(g,F,J)),F=nr(g,I),F!=null&&N.push(A(g,F,J))),g=g.return}return N}function X(g){if(g===null)return null;do g=g.return;while(g&&g.tag!==5);return g||null}function T(g,I,y,N,J){for(var F=I._reactName,Q=[];y!==null&&y!==N;){var he=y,fe=he.alternate,Ve=he.stateNode;if(fe!==null&&fe===N)break;he.tag===5&&Ve!==null&&(he=Ve,J?(fe=nr(y,F),fe!=null&&Q.unshift(A(y,fe,he))):J||(fe=nr(y,F),fe!=null&&Q.push(A(y,fe,he)))),y=y.return}Q.length!==0&&g.push({event:I,listeners:Q})}var $=/\r\n?/g,me=/\u0000|\uFFFD/g;function we(g){return(typeof g=="string"?g:""+g).replace($,`
`).replace(me,"")}function We(g,I,y){if(I=we(I),we(g)!==I&&y)throw Error(t(425))}function Ee(){}var tt=null,St=null;function Lt(g,I){return g==="textarea"||g==="noscript"||typeof I.children=="string"||typeof I.children=="number"||typeof I.dangerouslySetInnerHTML=="object"&&I.dangerouslySetInnerHTML!==null&&I.dangerouslySetInnerHTML.__html!=null}var ks=typeof setTimeout=="function"?setTimeout:void 0,bs=typeof clearTimeout=="function"?clearTimeout:void 0,Gr=typeof Promise=="function"?Promise:void 0,ar=typeof queueMicrotask=="function"?queueMicrotask:typeof Gr<"u"?function(g){return Gr.resolve(null).then(g).catch(Cc)}:ks;function Cc(g){setTimeout(function(){throw g})}function uh(g,I){var y=I,N=0;do{var J=y.nextSibling;if(g.removeChild(y),J&&J.nodeType===8)if(y=J.data,y==="/$"){if(N===0){g.removeChild(J),Ps(I);return}N--}else y!=="$"&&y!=="$?"&&y!=="$!"||N++;y=J}while(y);Ps(I)}function fo(g){for(;g!=null;g=g.nextSibling){var I=g.nodeType;if(I===1||I===3)break;if(I===8){if(I=g.data,I==="$"||I==="$!"||I==="$?")break;if(I==="/$")return null}}return g}function rI(g){g=g.previousSibling;for(var I=0;g;){if(g.nodeType===8){var y=g.data;if(y==="$"||y==="$!"||y==="$?"){if(I===0)return g;I--}else y==="/$"&&I++}g=g.previousSibling}return null}var ll=Math.random().toString(36).slice(2),Pi="__reactFiber$"+ll,fc="__reactProps$"+ll,xn="__reactContainer$"+ll,pc="__reactEvents$"+ll,gA="__reactListeners$"+ll,uA="__reactHandles$"+ll;function cl(g){var I=g[Pi];if(I)return I;for(var y=g.parentNode;y;){if(I=y[xn]||y[Pi]){if(y=I.alternate,I.child!==null||y!==null&&y.child!==null)for(g=rI(g);g!==null;){if(y=g[Pi])return y;g=rI(g)}return I}g=y,y=g.parentNode}return null}function dl(g){return g=g[Pi]||g[xn],!g||g.tag!==5&&g.tag!==6&&g.tag!==13&&g.tag!==3?null:g}function gl(g){if(g.tag===5||g.tag===6)return g.stateNode;throw Error(t(33))}function Yg(g){return g[fc]||null}var hA=[],Fg=-1;function Ac(g){return{current:g}}function En(g){0>Fg||(g.current=hA[Fg],hA[Fg]=null,Fg--)}function Mn(g,I){Fg++,hA[Fg]=g.current,g.current=I}var bc={},or=Ac(bc),Dr=Ac(!1),Md=bc;function Mg(g,I){var y=g.type.contextTypes;if(!y)return bc;var N=g.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===I)return N.__reactInternalMemoizedMaskedChildContext;var J={},F;for(F in y)J[F]=I[F];return N&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=I,g.__reactInternalMemoizedMaskedChildContext=J),J}function Lr(g){return g=g.childContextTypes,g!=null}function iI(){En(Dr),En(or)}function mB(g,I,y){if(or.current!==bc)throw Error(t(168));Mn(or,I),Mn(Dr,y)}function IB(g,I,y){var N=g.stateNode;if(I=I.childContextTypes,typeof N.getChildContext!="function")return y;N=N.getChildContext();for(var J in N)if(!(J in I))throw Error(t(108,ie(g)||"Unknown",J));return ne({},y,N)}function aI(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||bc,Md=or.current,Mn(or,g),Mn(Dr,Dr.current),!0}function CB(g,I,y){var N=g.stateNode;if(!N)throw Error(t(169));y?(g=IB(g,I,Md),N.__reactInternalMemoizedMergedChildContext=g,En(Dr),En(or),Mn(or,g)):En(Dr),Mn(Dr,y)}var ul=null,oI=!1,mA=!1;function fB(g){ul===null?ul=[g]:ul.push(g)}function ID(g){oI=!0,fB(g)}function yc(){if(!mA&&ul!==null){mA=!0;var g=0,I=zt;try{var y=ul;for(zt=1;g<y.length;g++){var N=y[g];do N=N(!0);while(N!==null)}ul=null,oI=!1}catch(J){throw ul!==null&&(ul=ul.slice(g+1)),Pl(To,yc),J}finally{zt=I,mA=!1}}return null}var Hg=[],Tg=0,lI=null,cI=0,Ki=[],Oi=0,Hd=null,hl=1,ml="";function Td(g,I){Hg[Tg++]=cI,Hg[Tg++]=lI,lI=g,cI=I}function pB(g,I,y){Ki[Oi++]=hl,Ki[Oi++]=ml,Ki[Oi++]=Hd,Hd=g;var N=hl;g=ml;var J=32-Wt(N)-1;N&=~(1<<J),y+=1;var F=32-Wt(I)+J;if(30<F){var Q=J-J%5;F=(N&(1<<Q)-1).toString(32),N>>=Q,J-=Q,hl=1<<32-Wt(I)+J|y<<J|N,ml=F+g}else hl=1<<F|y<<J|N,ml=g}function IA(g){g.return!==null&&(Td(g,1),pB(g,1,0))}function CA(g){for(;g===lI;)lI=Hg[--Tg],Hg[Tg]=null,cI=Hg[--Tg],Hg[Tg]=null;for(;g===Hd;)Hd=Ki[--Oi],Ki[Oi]=null,ml=Ki[--Oi],Ki[Oi]=null,hl=Ki[--Oi],Ki[Oi]=null}var Ii=null,Ci=null,Un=!1,Ba=null;function AB(g,I){var y=qi(5,null,null,0);y.elementType="DELETED",y.stateNode=I,y.return=g,I=g.deletions,I===null?(g.deletions=[y],g.flags|=16):I.push(y)}function bB(g,I){switch(g.tag){case 5:var y=g.type;return I=I.nodeType!==1||y.toLowerCase()!==I.nodeName.toLowerCase()?null:I,I!==null?(g.stateNode=I,Ii=g,Ci=fo(I.firstChild),!0):!1;case 6:return I=g.pendingProps===""||I.nodeType!==3?null:I,I!==null?(g.stateNode=I,Ii=g,Ci=null,!0):!1;case 13:return I=I.nodeType!==8?null:I,I!==null?(y=Hd!==null?{id:hl,overflow:ml}:null,g.memoizedState={dehydrated:I,treeContext:y,retryLane:1073741824},y=qi(18,null,null,0),y.stateNode=I,y.return=g,g.child=y,Ii=g,Ci=null,!0):!1;default:return!1}}function fA(g){return(g.mode&1)!==0&&(g.flags&128)===0}function pA(g){if(Un){var I=Ci;if(I){var y=I;if(!bB(g,I)){if(fA(g))throw Error(t(418));I=fo(y.nextSibling);var N=Ii;I&&bB(g,I)?AB(N,y):(g.flags=g.flags&-4097|2,Un=!1,Ii=g)}}else{if(fA(g))throw Error(t(418));g.flags=g.flags&-4097|2,Un=!1,Ii=g}}}function yB(g){for(g=g.return;g!==null&&g.tag!==5&&g.tag!==3&&g.tag!==13;)g=g.return;Ii=g}function dI(g){if(g!==Ii)return!1;if(!Un)return yB(g),Un=!0,!1;var I;if((I=g.tag!==3)&&!(I=g.tag!==5)&&(I=g.type,I=I!=="head"&&I!=="body"&&!Lt(g.type,g.memoizedProps)),I&&(I=Ci)){if(fA(g))throw vB(),Error(t(418));for(;I;)AB(g,I),I=fo(I.nextSibling)}if(yB(g),g.tag===13){if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(t(317));e:{for(g=g.nextSibling,I=0;g;){if(g.nodeType===8){var y=g.data;if(y==="/$"){if(I===0){Ci=fo(g.nextSibling);break e}I--}else y!=="$"&&y!=="$!"&&y!=="$?"||I++}g=g.nextSibling}Ci=null}}else Ci=Ii?fo(g.stateNode.nextSibling):null;return!0}function vB(){for(var g=Ci;g;)g=fo(g.nextSibling)}function Eg(){Ci=Ii=null,Un=!1}function AA(g){Ba===null?Ba=[g]:Ba.push(g)}var CD=R.ReactCurrentBatchConfig;function hh(g,I,y){if(g=y.ref,g!==null&&typeof g!="function"&&typeof g!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(t(309));var N=y.stateNode}if(!N)throw Error(t(147,g));var J=N,F=""+g;return I!==null&&I.ref!==null&&typeof I.ref=="function"&&I.ref._stringRef===F?I.ref:(I=function(Q){var he=J.refs;Q===null?delete he[F]:he[F]=Q},I._stringRef=F,I)}if(typeof g!="string")throw Error(t(284));if(!y._owner)throw Error(t(290,g))}return g}function gI(g,I){throw g=Object.prototype.toString.call(I),Error(t(31,g==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":g))}function xB(g){var I=g._init;return I(g._payload)}function SB(g){function I(Ze,Ae){if(g){var ke=Ze.deletions;ke===null?(Ze.deletions=[Ae],Ze.flags|=16):ke.push(Ae)}}function y(Ze,Ae){if(!g)return null;for(;Ae!==null;)I(Ze,Ae),Ae=Ae.sibling;return null}function N(Ze,Ae){for(Ze=new Map;Ae!==null;)Ae.key!==null?Ze.set(Ae.key,Ae):Ze.set(Ae.index,Ae),Ae=Ae.sibling;return Ze}function J(Ze,Ae){return Ze=Nc(Ze,Ae),Ze.index=0,Ze.sibling=null,Ze}function F(Ze,Ae,ke){return Ze.index=ke,g?(ke=Ze.alternate,ke!==null?(ke=ke.index,ke<Ae?(Ze.flags|=2,Ae):ke):(Ze.flags|=2,Ae)):(Ze.flags|=1048576,Ae)}function Q(Ze){return g&&Ze.alternate===null&&(Ze.flags|=2),Ze}function he(Ze,Ae,ke,Qe){return Ae===null||Ae.tag!==6?(Ae=db(ke,Ze.mode,Qe),Ae.return=Ze,Ae):(Ae=J(Ae,ke),Ae.return=Ze,Ae)}function fe(Ze,Ae,ke,Qe){var Ct=ke.type;return Ct===Y?Ke(Ze,Ae,ke.props.children,Qe,ke.key):Ae!==null&&(Ae.elementType===Ct||typeof Ct=="object"&&Ct!==null&&Ct.$$typeof===q&&xB(Ct)===Ae.type)?(Qe=J(Ae,ke.props),Qe.ref=hh(Ze,Ae,ke),Qe.return=Ze,Qe):(Qe=jI(ke.type,ke.key,ke.props,null,Ze.mode,Qe),Qe.ref=hh(Ze,Ae,ke),Qe.return=Ze,Qe)}function Ve(Ze,Ae,ke,Qe){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==ke.containerInfo||Ae.stateNode.implementation!==ke.implementation?(Ae=gb(ke,Ze.mode,Qe),Ae.return=Ze,Ae):(Ae=J(Ae,ke.children||[]),Ae.return=Ze,Ae)}function Ke(Ze,Ae,ke,Qe,Ct){return Ae===null||Ae.tag!==7?(Ae=Ud(ke,Ze.mode,Qe,Ct),Ae.return=Ze,Ae):(Ae=J(Ae,ke),Ae.return=Ze,Ae)}function Ue(Ze,Ae,ke){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number")return Ae=db(""+Ae,Ze.mode,ke),Ae.return=Ze,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case W:return ke=jI(Ae.type,Ae.key,Ae.props,null,Ze.mode,ke),ke.ref=hh(Ze,null,Ae),ke.return=Ze,ke;case _:return Ae=gb(Ae,Ze.mode,ke),Ae.return=Ze,Ae;case q:var Qe=Ae._init;return Ue(Ze,Qe(Ae._payload),ke)}if(ee(Ae)||P(Ae))return Ae=Ud(Ae,Ze.mode,ke,null),Ae.return=Ze,Ae;gI(Ze,Ae)}return null}function Pe(Ze,Ae,ke,Qe){var Ct=Ae!==null?Ae.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number")return Ct!==null?null:he(Ze,Ae,""+ke,Qe);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case W:return ke.key===Ct?fe(Ze,Ae,ke,Qe):null;case _:return ke.key===Ct?Ve(Ze,Ae,ke,Qe):null;case q:return Ct=ke._init,Pe(Ze,Ae,Ct(ke._payload),Qe)}if(ee(ke)||P(ke))return Ct!==null?null:Ke(Ze,Ae,ke,Qe,null);gI(Ze,ke)}return null}function at(Ze,Ae,ke,Qe,Ct){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return Ze=Ze.get(ke)||null,he(Ae,Ze,""+Qe,Ct);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case W:return Ze=Ze.get(Qe.key===null?ke:Qe.key)||null,fe(Ae,Ze,Qe,Ct);case _:return Ze=Ze.get(Qe.key===null?ke:Qe.key)||null,Ve(Ae,Ze,Qe,Ct);case q:var Zt=Qe._init;return at(Ze,Ae,ke,Zt(Qe._payload),Ct)}if(ee(Qe)||P(Qe))return Ze=Ze.get(ke)||null,Ke(Ae,Ze,Qe,Ct,null);gI(Ae,Qe)}return null}function ut(Ze,Ae,ke,Qe){for(var Ct=null,Zt=null,Gt=Ae,Xt=Ae=0,Hs=null;Gt!==null&&Xt<ke.length;Xt++){Gt.index>Xt?(Hs=Gt,Gt=null):Hs=Gt.sibling;var mn=Pe(Ze,Gt,ke[Xt],Qe);if(mn===null){Gt===null&&(Gt=Hs);break}g&&Gt&&mn.alternate===null&&I(Ze,Gt),Ae=F(mn,Ae,Xt),Zt===null?Ct=mn:Zt.sibling=mn,Zt=mn,Gt=Hs}if(Xt===ke.length)return y(Ze,Gt),Un&&Td(Ze,Xt),Ct;if(Gt===null){for(;Xt<ke.length;Xt++)Gt=Ue(Ze,ke[Xt],Qe),Gt!==null&&(Ae=F(Gt,Ae,Xt),Zt===null?Ct=Gt:Zt.sibling=Gt,Zt=Gt);return Un&&Td(Ze,Xt),Ct}for(Gt=N(Ze,Gt);Xt<ke.length;Xt++)Hs=at(Gt,Ze,Xt,ke[Xt],Qe),Hs!==null&&(g&&Hs.alternate!==null&&Gt.delete(Hs.key===null?Xt:Hs.key),Ae=F(Hs,Ae,Xt),Zt===null?Ct=Hs:Zt.sibling=Hs,Zt=Hs);return g&&Gt.forEach(function(kc){return I(Ze,kc)}),Un&&Td(Ze,Xt),Ct}function mt(Ze,Ae,ke,Qe){var Ct=P(ke);if(typeof Ct!="function")throw Error(t(150));if(ke=Ct.call(ke),ke==null)throw Error(t(151));for(var Zt=Ct=null,Gt=Ae,Xt=Ae=0,Hs=null,mn=ke.next();Gt!==null&&!mn.done;Xt++,mn=ke.next()){Gt.index>Xt?(Hs=Gt,Gt=null):Hs=Gt.sibling;var kc=Pe(Ze,Gt,mn.value,Qe);if(kc===null){Gt===null&&(Gt=Hs);break}g&&Gt&&kc.alternate===null&&I(Ze,Gt),Ae=F(kc,Ae,Xt),Zt===null?Ct=kc:Zt.sibling=kc,Zt=kc,Gt=Hs}if(mn.done)return y(Ze,Gt),Un&&Td(Ze,Xt),Ct;if(Gt===null){for(;!mn.done;Xt++,mn=ke.next())mn=Ue(Ze,mn.value,Qe),mn!==null&&(Ae=F(mn,Ae,Xt),Zt===null?Ct=mn:Zt.sibling=mn,Zt=mn);return Un&&Td(Ze,Xt),Ct}for(Gt=N(Ze,Gt);!mn.done;Xt++,mn=ke.next())mn=at(Gt,Ze,Xt,mn.value,Qe),mn!==null&&(g&&mn.alternate!==null&&Gt.delete(mn.key===null?Xt:mn.key),Ae=F(mn,Ae,Xt),Zt===null?Ct=mn:Zt.sibling=mn,Zt=mn);return g&&Gt.forEach(function(zD){return I(Ze,zD)}),Un&&Td(Ze,Xt),Ct}function cs(Ze,Ae,ke,Qe){if(typeof ke=="object"&&ke!==null&&ke.type===Y&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case W:e:{for(var Ct=ke.key,Zt=Ae;Zt!==null;){if(Zt.key===Ct){if(Ct=ke.type,Ct===Y){if(Zt.tag===7){y(Ze,Zt.sibling),Ae=J(Zt,ke.props.children),Ae.return=Ze,Ze=Ae;break e}}else if(Zt.elementType===Ct||typeof Ct=="object"&&Ct!==null&&Ct.$$typeof===q&&xB(Ct)===Zt.type){y(Ze,Zt.sibling),Ae=J(Zt,ke.props),Ae.ref=hh(Ze,Zt,ke),Ae.return=Ze,Ze=Ae;break e}y(Ze,Zt);break}else I(Ze,Zt);Zt=Zt.sibling}ke.type===Y?(Ae=Ud(ke.props.children,Ze.mode,Qe,ke.key),Ae.return=Ze,Ze=Ae):(Qe=jI(ke.type,ke.key,ke.props,null,Ze.mode,Qe),Qe.ref=hh(Ze,Ae,ke),Qe.return=Ze,Ze=Qe)}return Q(Ze);case _:e:{for(Zt=ke.key;Ae!==null;){if(Ae.key===Zt)if(Ae.tag===4&&Ae.stateNode.containerInfo===ke.containerInfo&&Ae.stateNode.implementation===ke.implementation){y(Ze,Ae.sibling),Ae=J(Ae,ke.children||[]),Ae.return=Ze,Ze=Ae;break e}else{y(Ze,Ae);break}else I(Ze,Ae);Ae=Ae.sibling}Ae=gb(ke,Ze.mode,Qe),Ae.return=Ze,Ze=Ae}return Q(Ze);case q:return Zt=ke._init,cs(Ze,Ae,Zt(ke._payload),Qe)}if(ee(ke))return ut(Ze,Ae,ke,Qe);if(P(ke))return mt(Ze,Ae,ke,Qe);gI(Ze,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"?(ke=""+ke,Ae!==null&&Ae.tag===6?(y(Ze,Ae.sibling),Ae=J(Ae,ke),Ae.return=Ze,Ze=Ae):(y(Ze,Ae),Ae=db(ke,Ze.mode,Qe),Ae.return=Ze,Ze=Ae),Q(Ze)):y(Ze,Ae)}return cs}var Dg=SB(!0),wB=SB(!1),uI=Ac(null),hI=null,Lg=null,bA=null;function yA(){bA=Lg=hI=null}function vA(g){var I=uI.current;En(uI),g._currentValue=I}function xA(g,I,y){for(;g!==null;){var N=g.alternate;if((g.childLanes&I)!==I?(g.childLanes|=I,N!==null&&(N.childLanes|=I)):N!==null&&(N.childLanes&I)!==I&&(N.childLanes|=I),g===y)break;g=g.return}}function Pg(g,I){hI=g,bA=Lg=null,g=g.dependencies,g!==null&&g.firstContext!==null&&((g.lanes&I)!==0&&(Pr=!0),g.firstContext=null)}function zi(g){var I=g._currentValue;if(bA!==g)if(g={context:g,memoizedValue:I,next:null},Lg===null){if(hI===null)throw Error(t(308));Lg=g,hI.dependencies={lanes:0,firstContext:g}}else Lg=Lg.next=g;return I}var Ed=null;function SA(g){Ed===null?Ed=[g]:Ed.push(g)}function ZB(g,I,y,N){var J=I.interleaved;return J===null?(y.next=y,SA(I)):(y.next=J.next,J.next=y),I.interleaved=y,Il(g,N)}function Il(g,I){g.lanes|=I;var y=g.alternate;for(y!==null&&(y.lanes|=I),y=g,g=g.return;g!==null;)g.childLanes|=I,y=g.alternate,y!==null&&(y.childLanes|=I),y=g,g=g.return;return y.tag===3?y.stateNode:null}var vc=!1;function wA(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function GB(g,I){g=g.updateQueue,I.updateQueue===g&&(I.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function Cl(g,I){return{eventTime:g,lane:I,tag:0,payload:null,callback:null,next:null}}function xc(g,I,y){var N=g.updateQueue;if(N===null)return null;if(N=N.shared,(gn&2)!==0){var J=N.pending;return J===null?I.next=I:(I.next=J.next,J.next=I),N.pending=I,Il(g,y)}return J=N.interleaved,J===null?(I.next=I,SA(N)):(I.next=J.next,J.next=I),N.interleaved=I,Il(g,y)}function mI(g,I,y){if(I=I.updateQueue,I!==null&&(I=I.shared,(y&4194240)!==0)){var N=I.lanes;N&=g.pendingLanes,y|=N,I.lanes=y,vr(g,y)}}function BB(g,I){var y=g.updateQueue,N=g.alternate;if(N!==null&&(N=N.updateQueue,y===N)){var J=null,F=null;if(y=y.firstBaseUpdate,y!==null){do{var Q={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};F===null?J=F=Q:F=F.next=Q,y=y.next}while(y!==null);F===null?J=F=I:F=F.next=I}else J=F=I;y={baseState:N.baseState,firstBaseUpdate:J,lastBaseUpdate:F,shared:N.shared,effects:N.effects},g.updateQueue=y;return}g=y.lastBaseUpdate,g===null?y.firstBaseUpdate=I:g.next=I,y.lastBaseUpdate=I}function II(g,I,y,N){var J=g.updateQueue;vc=!1;var F=J.firstBaseUpdate,Q=J.lastBaseUpdate,he=J.shared.pending;if(he!==null){J.shared.pending=null;var fe=he,Ve=fe.next;fe.next=null,Q===null?F=Ve:Q.next=Ve,Q=fe;var Ke=g.alternate;Ke!==null&&(Ke=Ke.updateQueue,he=Ke.lastBaseUpdate,he!==Q&&(he===null?Ke.firstBaseUpdate=Ve:he.next=Ve,Ke.lastBaseUpdate=fe))}if(F!==null){var Ue=J.baseState;Q=0,Ke=Ve=fe=null,he=F;do{var Pe=he.lane,at=he.eventTime;if((N&Pe)===Pe){Ke!==null&&(Ke=Ke.next={eventTime:at,lane:0,tag:he.tag,payload:he.payload,callback:he.callback,next:null});e:{var ut=g,mt=he;switch(Pe=I,at=y,mt.tag){case 1:if(ut=mt.payload,typeof ut=="function"){Ue=ut.call(at,Ue,Pe);break e}Ue=ut;break e;case 3:ut.flags=ut.flags&-65537|128;case 0:if(ut=mt.payload,Pe=typeof ut=="function"?ut.call(at,Ue,Pe):ut,Pe==null)break e;Ue=ne({},Ue,Pe);break e;case 2:vc=!0}}he.callback!==null&&he.lane!==0&&(g.flags|=64,Pe=J.effects,Pe===null?J.effects=[he]:Pe.push(he))}else at={eventTime:at,lane:Pe,tag:he.tag,payload:he.payload,callback:he.callback,next:null},Ke===null?(Ve=Ke=at,fe=Ue):Ke=Ke.next=at,Q|=Pe;if(he=he.next,he===null){if(he=J.shared.pending,he===null)break;Pe=he,he=Pe.next,Pe.next=null,J.lastBaseUpdate=Pe,J.shared.pending=null}}while(!0);if(Ke===null&&(fe=Ue),J.baseState=fe,J.firstBaseUpdate=Ve,J.lastBaseUpdate=Ke,I=J.shared.interleaved,I!==null){J=I;do Q|=J.lane,J=J.next;while(J!==I)}else F===null&&(J.shared.lanes=0);Pd|=Q,g.lanes=Q,g.memoizedState=Ue}}function NB(g,I,y){if(g=I.effects,I.effects=null,g!==null)for(I=0;I<g.length;I++){var N=g[I],J=N.callback;if(J!==null){if(N.callback=null,N=y,typeof J!="function")throw Error(t(191,J));J.call(N)}}}var mh={},po=Ac(mh),Ih=Ac(mh),Ch=Ac(mh);function Dd(g){if(g===mh)throw Error(t(174));return g}function ZA(g,I){switch(Mn(Ch,I),Mn(Ih,g),Mn(po,mh),g=I.nodeType,g){case 9:case 11:I=(I=I.documentElement)?I.namespaceURI:ze(null,"");break;default:g=g===8?I.parentNode:I,I=g.namespaceURI||null,g=g.tagName,I=ze(I,g)}En(po),Mn(po,I)}function Kg(){En(po),En(Ih),En(Ch)}function kB(g){Dd(Ch.current);var I=Dd(po.current),y=ze(I,g.type);I!==y&&(Mn(Ih,g),Mn(po,y))}function GA(g){Ih.current===g&&(En(po),En(Ih))}var $n=Ac(0);function CI(g){for(var I=g;I!==null;){if(I.tag===13){var y=I.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return I}else if(I.tag===19&&I.memoizedProps.revealOrder!==void 0){if((I.flags&128)!==0)return I}else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===g)break;for(;I.sibling===null;){if(I.return===null||I.return===g)return null;I=I.return}I.sibling.return=I.return,I=I.sibling}return null}var BA=[];function NA(){for(var g=0;g<BA.length;g++)BA[g]._workInProgressVersionPrimary=null;BA.length=0}var fI=R.ReactCurrentDispatcher,kA=R.ReactCurrentBatchConfig,Ld=0,es=null,Rs=null,Fs=null,pI=!1,fh=!1,ph=0,fD=0;function lr(){throw Error(t(321))}function RA(g,I){if(I===null)return!1;for(var y=0;y<I.length&&y<g.length;y++)if(!zs(g[y],I[y]))return!1;return!0}function WA(g,I,y,N,J,F){if(Ld=F,es=I,I.memoizedState=null,I.updateQueue=null,I.lanes=0,fI.current=g===null||g.memoizedState===null?yD:vD,g=y(N,J),fh){F=0;do{if(fh=!1,ph=0,25<=F)throw Error(t(301));F+=1,Fs=Rs=null,I.updateQueue=null,fI.current=xD,g=y(N,J)}while(fh)}if(fI.current=yI,I=Rs!==null&&Rs.next!==null,Ld=0,Fs=Rs=es=null,pI=!1,I)throw Error(t(300));return g}function VA(){var g=ph!==0;return ph=0,g}function Ao(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fs===null?es.memoizedState=Fs=g:Fs=Fs.next=g,Fs}function Ui(){if(Rs===null){var g=es.alternate;g=g!==null?g.memoizedState:null}else g=Rs.next;var I=Fs===null?es.memoizedState:Fs.next;if(I!==null)Fs=I,Rs=g;else{if(g===null)throw Error(t(310));Rs=g,g={memoizedState:Rs.memoizedState,baseState:Rs.baseState,baseQueue:Rs.baseQueue,queue:Rs.queue,next:null},Fs===null?es.memoizedState=Fs=g:Fs=Fs.next=g}return Fs}function Ah(g,I){return typeof I=="function"?I(g):I}function _A(g){var I=Ui(),y=I.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=g;var N=Rs,J=N.baseQueue,F=y.pending;if(F!==null){if(J!==null){var Q=J.next;J.next=F.next,F.next=Q}N.baseQueue=J=F,y.pending=null}if(J!==null){F=J.next,N=N.baseState;var he=Q=null,fe=null,Ve=F;do{var Ke=Ve.lane;if((Ld&Ke)===Ke)fe!==null&&(fe=fe.next={lane:0,action:Ve.action,hasEagerState:Ve.hasEagerState,eagerState:Ve.eagerState,next:null}),N=Ve.hasEagerState?Ve.eagerState:g(N,Ve.action);else{var Ue={lane:Ke,action:Ve.action,hasEagerState:Ve.hasEagerState,eagerState:Ve.eagerState,next:null};fe===null?(he=fe=Ue,Q=N):fe=fe.next=Ue,es.lanes|=Ke,Pd|=Ke}Ve=Ve.next}while(Ve!==null&&Ve!==F);fe===null?Q=N:fe.next=he,zs(N,I.memoizedState)||(Pr=!0),I.memoizedState=N,I.baseState=Q,I.baseQueue=fe,y.lastRenderedState=N}if(g=y.interleaved,g!==null){J=g;do F=J.lane,es.lanes|=F,Pd|=F,J=J.next;while(J!==g)}else J===null&&(y.lanes=0);return[I.memoizedState,y.dispatch]}function jA(g){var I=Ui(),y=I.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=g;var N=y.dispatch,J=y.pending,F=I.memoizedState;if(J!==null){y.pending=null;var Q=J=J.next;do F=g(F,Q.action),Q=Q.next;while(Q!==J);zs(F,I.memoizedState)||(Pr=!0),I.memoizedState=F,I.baseQueue===null&&(I.baseState=F),y.lastRenderedState=F}return[F,N]}function RB(){}function WB(g,I){var y=es,N=Ui(),J=I(),F=!zs(N.memoizedState,J);if(F&&(N.memoizedState=J,Pr=!0),N=N.queue,XA(jB.bind(null,y,N,g),[g]),N.getSnapshot!==I||F||Fs!==null&&Fs.memoizedState.tag&1){if(y.flags|=2048,bh(9,_B.bind(null,y,N,J,I),void 0,null),Ms===null)throw Error(t(349));(Ld&30)!==0||VB(y,I,J)}return J}function VB(g,I,y){g.flags|=16384,g={getSnapshot:I,value:y},I=es.updateQueue,I===null?(I={lastEffect:null,stores:null},es.updateQueue=I,I.stores=[g]):(y=I.stores,y===null?I.stores=[g]:y.push(g))}function _B(g,I,y,N){I.value=y,I.getSnapshot=N,XB(I)&&JB(g)}function jB(g,I,y){return y(function(){XB(I)&&JB(g)})}function XB(g){var I=g.getSnapshot;g=g.value;try{var y=I();return!zs(g,y)}catch{return!0}}function JB(g){var I=Il(g,1);I!==null&&Wa(I,g,1,-1)}function YB(g){var I=Ao();return typeof g=="function"&&(g=g()),I.memoizedState=I.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ah,lastRenderedState:g},I.queue=g,g=g.dispatch=bD.bind(null,es,g),[I.memoizedState,g]}function bh(g,I,y,N){return g={tag:g,create:I,destroy:y,deps:N,next:null},I=es.updateQueue,I===null?(I={lastEffect:null,stores:null},es.updateQueue=I,I.lastEffect=g.next=g):(y=I.lastEffect,y===null?I.lastEffect=g.next=g:(N=y.next,y.next=g,g.next=N,I.lastEffect=g)),g}function FB(){return Ui().memoizedState}function AI(g,I,y,N){var J=Ao();es.flags|=g,J.memoizedState=bh(1|I,y,void 0,N===void 0?null:N)}function bI(g,I,y,N){var J=Ui();N=N===void 0?null:N;var F=void 0;if(Rs!==null){var Q=Rs.memoizedState;if(F=Q.destroy,N!==null&&RA(N,Q.deps)){J.memoizedState=bh(I,y,F,N);return}}es.flags|=g,J.memoizedState=bh(1|I,y,F,N)}function MB(g,I){return AI(8390656,8,g,I)}function XA(g,I){return bI(2048,8,g,I)}function HB(g,I){return bI(4,2,g,I)}function TB(g,I){return bI(4,4,g,I)}function EB(g,I){if(typeof I=="function")return g=g(),I(g),function(){I(null)};if(I!=null)return g=g(),I.current=g,function(){I.current=null}}function DB(g,I,y){return y=y!=null?y.concat([g]):null,bI(4,4,EB.bind(null,I,g),y)}function JA(){}function LB(g,I){var y=Ui();I=I===void 0?null:I;var N=y.memoizedState;return N!==null&&I!==null&&RA(I,N[1])?N[0]:(y.memoizedState=[g,I],g)}function PB(g,I){var y=Ui();I=I===void 0?null:I;var N=y.memoizedState;return N!==null&&I!==null&&RA(I,N[1])?N[0]:(g=g(),y.memoizedState=[g,I],g)}function KB(g,I,y){return(Ld&21)===0?(g.baseState&&(g.baseState=!1,Pr=!0),g.memoizedState=y):(zs(y,I)||(y=Ol(),es.lanes|=y,Pd|=y,g.baseState=!0),I)}function pD(g,I){var y=zt;zt=y!==0&&4>y?y:4,g(!0);var N=kA.transition;kA.transition={};try{g(!1),I()}finally{zt=y,kA.transition=N}}function OB(){return Ui().memoizedState}function AD(g,I,y){var N=Gc(g);if(y={lane:N,action:y,hasEagerState:!1,eagerState:null,next:null},zB(g))UB(I,y);else if(y=ZB(g,I,y,N),y!==null){var J=Nr();Wa(y,g,N,J),QB(y,I,N)}}function bD(g,I,y){var N=Gc(g),J={lane:N,action:y,hasEagerState:!1,eagerState:null,next:null};if(zB(g))UB(I,J);else{var F=g.alternate;if(g.lanes===0&&(F===null||F.lanes===0)&&(F=I.lastRenderedReducer,F!==null))try{var Q=I.lastRenderedState,he=F(Q,y);if(J.hasEagerState=!0,J.eagerState=he,zs(he,Q)){var fe=I.interleaved;fe===null?(J.next=J,SA(I)):(J.next=fe.next,fe.next=J),I.interleaved=J;return}}catch{}finally{}y=ZB(g,I,J,N),y!==null&&(J=Nr(),Wa(y,g,N,J),QB(y,I,N))}}function zB(g){var I=g.alternate;return g===es||I!==null&&I===es}function UB(g,I){fh=pI=!0;var y=g.pending;y===null?I.next=I:(I.next=y.next,y.next=I),g.pending=I}function QB(g,I,y){if((y&4194240)!==0){var N=I.lanes;N&=g.pendingLanes,y|=N,I.lanes=y,vr(g,y)}}var yI={readContext:zi,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useInsertionEffect:lr,useLayoutEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useMutableSource:lr,useSyncExternalStore:lr,useId:lr,unstable_isNewReconciler:!1},yD={readContext:zi,useCallback:function(g,I){return Ao().memoizedState=[g,I===void 0?null:I],g},useContext:zi,useEffect:MB,useImperativeHandle:function(g,I,y){return y=y!=null?y.concat([g]):null,AI(4194308,4,EB.bind(null,I,g),y)},useLayoutEffect:function(g,I){return AI(4194308,4,g,I)},useInsertionEffect:function(g,I){return AI(4,2,g,I)},useMemo:function(g,I){var y=Ao();return I=I===void 0?null:I,g=g(),y.memoizedState=[g,I],g},useReducer:function(g,I,y){var N=Ao();return I=y!==void 0?y(I):I,N.memoizedState=N.baseState=I,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:I},N.queue=g,g=g.dispatch=AD.bind(null,es,g),[N.memoizedState,g]},useRef:function(g){var I=Ao();return g={current:g},I.memoizedState=g},useState:YB,useDebugValue:JA,useDeferredValue:function(g){return Ao().memoizedState=g},useTransition:function(){var g=YB(!1),I=g[0];return g=pD.bind(null,g[1]),Ao().memoizedState=g,[I,g]},useMutableSource:function(){},useSyncExternalStore:function(g,I,y){var N=es,J=Ao();if(Un){if(y===void 0)throw Error(t(407));y=y()}else{if(y=I(),Ms===null)throw Error(t(349));(Ld&30)!==0||VB(N,I,y)}J.memoizedState=y;var F={value:y,getSnapshot:I};return J.queue=F,MB(jB.bind(null,N,F,g),[g]),N.flags|=2048,bh(9,_B.bind(null,N,F,y,I),void 0,null),y},useId:function(){var g=Ao(),I=Ms.identifierPrefix;if(Un){var y=ml,N=hl;y=(N&~(1<<32-Wt(N)-1)).toString(32)+y,I=":"+I+"R"+y,y=ph++,0<y&&(I+="H"+y.toString(32)),I+=":"}else y=fD++,I=":"+I+"r"+y.toString(32)+":";return g.memoizedState=I},unstable_isNewReconciler:!1},vD={readContext:zi,useCallback:LB,useContext:zi,useEffect:XA,useImperativeHandle:DB,useInsertionEffect:HB,useLayoutEffect:TB,useMemo:PB,useReducer:_A,useRef:FB,useState:function(){return _A(Ah)},useDebugValue:JA,useDeferredValue:function(g){var I=Ui();return KB(I,Rs.memoizedState,g)},useTransition:function(){var g=_A(Ah)[0],I=Ui().memoizedState;return[g,I]},useMutableSource:RB,useSyncExternalStore:WB,useId:OB,unstable_isNewReconciler:!1},xD={readContext:zi,useCallback:LB,useContext:zi,useEffect:XA,useImperativeHandle:DB,useInsertionEffect:HB,useLayoutEffect:TB,useMemo:PB,useReducer:jA,useRef:FB,useState:function(){return jA(Ah)},useDebugValue:JA,useDeferredValue:function(g){var I=Ui();return Rs===null?I.memoizedState=g:KB(I,Rs.memoizedState,g)},useTransition:function(){var g=jA(Ah)[0],I=Ui().memoizedState;return[g,I]},useMutableSource:RB,useSyncExternalStore:WB,useId:OB,unstable_isNewReconciler:!1};function Na(g,I){if(g&&g.defaultProps){I=ne({},I),g=g.defaultProps;for(var y in g)I[y]===void 0&&(I[y]=g[y]);return I}return I}function YA(g,I,y,N){I=g.memoizedState,y=y(N,I),y=y==null?I:ne({},I,y),g.memoizedState=y,g.lanes===0&&(g.updateQueue.baseState=y)}var vI={isMounted:function(g){return(g=g._reactInternals)?Yr(g)===g:!1},enqueueSetState:function(g,I,y){g=g._reactInternals;var N=Nr(),J=Gc(g),F=Cl(N,J);F.payload=I,y!=null&&(F.callback=y),I=xc(g,F,J),I!==null&&(Wa(I,g,J,N),mI(I,g,J))},enqueueReplaceState:function(g,I,y){g=g._reactInternals;var N=Nr(),J=Gc(g),F=Cl(N,J);F.tag=1,F.payload=I,y!=null&&(F.callback=y),I=xc(g,F,J),I!==null&&(Wa(I,g,J,N),mI(I,g,J))},enqueueForceUpdate:function(g,I){g=g._reactInternals;var y=Nr(),N=Gc(g),J=Cl(y,N);J.tag=2,I!=null&&(J.callback=I),I=xc(g,J,N),I!==null&&(Wa(I,g,N,y),mI(I,g,N))}};function qB(g,I,y,N,J,F,Q){return g=g.stateNode,typeof g.shouldComponentUpdate=="function"?g.shouldComponentUpdate(N,F,Q):I.prototype&&I.prototype.isPureReactComponent?!Er(y,N)||!Er(J,F):!0}function $B(g,I,y){var N=!1,J=bc,F=I.contextType;return typeof F=="object"&&F!==null?F=zi(F):(J=Lr(I)?Md:or.current,N=I.contextTypes,F=(N=N!=null)?Mg(g,J):bc),I=new I(y,F),g.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,I.updater=vI,g.stateNode=I,I._reactInternals=g,N&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=J,g.__reactInternalMemoizedMaskedChildContext=F),I}function eN(g,I,y,N){g=I.state,typeof I.componentWillReceiveProps=="function"&&I.componentWillReceiveProps(y,N),typeof I.UNSAFE_componentWillReceiveProps=="function"&&I.UNSAFE_componentWillReceiveProps(y,N),I.state!==g&&vI.enqueueReplaceState(I,I.state,null)}function FA(g,I,y,N){var J=g.stateNode;J.props=y,J.state=g.memoizedState,J.refs={},wA(g);var F=I.contextType;typeof F=="object"&&F!==null?J.context=zi(F):(F=Lr(I)?Md:or.current,J.context=Mg(g,F)),J.state=g.memoizedState,F=I.getDerivedStateFromProps,typeof F=="function"&&(YA(g,I,F,y),J.state=g.memoizedState),typeof I.getDerivedStateFromProps=="function"||typeof J.getSnapshotBeforeUpdate=="function"||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(I=J.state,typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount(),I!==J.state&&vI.enqueueReplaceState(J,J.state,null),II(g,y,J,N),J.state=g.memoizedState),typeof J.componentDidMount=="function"&&(g.flags|=4194308)}function Og(g,I){try{var y="",N=I;do y+=ae(N),N=N.return;while(N);var J=y}catch(F){J=`
Error generating stack: `+F.message+`
`+F.stack}return{value:g,source:I,stack:J,digest:null}}function MA(g,I,y){return{value:g,source:null,stack:y??null,digest:I??null}}function HA(g,I){try{console.error(I.value)}catch(y){setTimeout(function(){throw y})}}var SD=typeof WeakMap=="function"?WeakMap:Map;function tN(g,I,y){y=Cl(-1,y),y.tag=3,y.payload={element:null};var N=I.value;return y.callback=function(){NI||(NI=!0,nb=N),HA(g,I)},y}function nN(g,I,y){y=Cl(-1,y),y.tag=3;var N=g.type.getDerivedStateFromError;if(typeof N=="function"){var J=I.value;y.payload=function(){return N(J)},y.callback=function(){HA(g,I)}}var F=g.stateNode;return F!==null&&typeof F.componentDidCatch=="function"&&(y.callback=function(){HA(g,I),typeof N!="function"&&(wc===null?wc=new Set([this]):wc.add(this));var Q=I.stack;this.componentDidCatch(I.value,{componentStack:Q!==null?Q:""})}),y}function sN(g,I,y){var N=g.pingCache;if(N===null){N=g.pingCache=new SD;var J=new Set;N.set(I,J)}else J=N.get(I),J===void 0&&(J=new Set,N.set(I,J));J.has(y)||(J.add(y),g=YD.bind(null,g,I,y),I.then(g,g))}function rN(g){do{var I;if((I=g.tag===13)&&(I=g.memoizedState,I=I!==null?I.dehydrated!==null:!0),I)return g;g=g.return}while(g!==null);return null}function iN(g,I,y,N,J){return(g.mode&1)===0?(g===I?g.flags|=65536:(g.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(I=Cl(-1,1),I.tag=2,xc(y,I,1))),y.lanes|=1),g):(g.flags|=65536,g.lanes=J,g)}var wD=R.ReactCurrentOwner,Pr=!1;function Br(g,I,y,N){I.child=g===null?wB(I,null,y,N):Dg(I,g.child,y,N)}function aN(g,I,y,N,J){y=y.render;var F=I.ref;return Pg(I,J),N=WA(g,I,y,N,F,J),y=VA(),g!==null&&!Pr?(I.updateQueue=g.updateQueue,I.flags&=-2053,g.lanes&=~J,fl(g,I,J)):(Un&&y&&IA(I),I.flags|=1,Br(g,I,N,J),I.child)}function oN(g,I,y,N,J){if(g===null){var F=y.type;return typeof F=="function"&&!cb(F)&&F.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(I.tag=15,I.type=F,lN(g,I,F,N,J)):(g=jI(y.type,null,N,I,I.mode,J),g.ref=I.ref,g.return=I,I.child=g)}if(F=g.child,(g.lanes&J)===0){var Q=F.memoizedProps;if(y=y.compare,y=y!==null?y:Er,y(Q,N)&&g.ref===I.ref)return fl(g,I,J)}return I.flags|=1,g=Nc(F,N),g.ref=I.ref,g.return=I,I.child=g}function lN(g,I,y,N,J){if(g!==null){var F=g.memoizedProps;if(Er(F,N)&&g.ref===I.ref)if(Pr=!1,I.pendingProps=N=F,(g.lanes&J)!==0)(g.flags&131072)!==0&&(Pr=!0);else return I.lanes=g.lanes,fl(g,I,J)}return TA(g,I,y,N,J)}function cN(g,I,y){var N=I.pendingProps,J=N.children,F=g!==null?g.memoizedState:null;if(N.mode==="hidden")if((I.mode&1)===0)I.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mn(Ug,fi),fi|=y;else{if((y&1073741824)===0)return g=F!==null?F.baseLanes|y:y,I.lanes=I.childLanes=1073741824,I.memoizedState={baseLanes:g,cachePool:null,transitions:null},I.updateQueue=null,Mn(Ug,fi),fi|=g,null;I.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=F!==null?F.baseLanes:y,Mn(Ug,fi),fi|=N}else F!==null?(N=F.baseLanes|y,I.memoizedState=null):N=y,Mn(Ug,fi),fi|=N;return Br(g,I,J,y),I.child}function dN(g,I){var y=I.ref;(g===null&&y!==null||g!==null&&g.ref!==y)&&(I.flags|=512,I.flags|=2097152)}function TA(g,I,y,N,J){var F=Lr(y)?Md:or.current;return F=Mg(I,F),Pg(I,J),y=WA(g,I,y,N,F,J),N=VA(),g!==null&&!Pr?(I.updateQueue=g.updateQueue,I.flags&=-2053,g.lanes&=~J,fl(g,I,J)):(Un&&N&&IA(I),I.flags|=1,Br(g,I,y,J),I.child)}function gN(g,I,y,N,J){if(Lr(y)){var F=!0;aI(I)}else F=!1;if(Pg(I,J),I.stateNode===null)SI(g,I),$B(I,y,N),FA(I,y,N,J),N=!0;else if(g===null){var Q=I.stateNode,he=I.memoizedProps;Q.props=he;var fe=Q.context,Ve=y.contextType;typeof Ve=="object"&&Ve!==null?Ve=zi(Ve):(Ve=Lr(y)?Md:or.current,Ve=Mg(I,Ve));var Ke=y.getDerivedStateFromProps,Ue=typeof Ke=="function"||typeof Q.getSnapshotBeforeUpdate=="function";Ue||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(he!==N||fe!==Ve)&&eN(I,Q,N,Ve),vc=!1;var Pe=I.memoizedState;Q.state=Pe,II(I,N,Q,J),fe=I.memoizedState,he!==N||Pe!==fe||Dr.current||vc?(typeof Ke=="function"&&(YA(I,y,Ke,N),fe=I.memoizedState),(he=vc||qB(I,y,he,N,Pe,fe,Ve))?(Ue||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(I.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(I.flags|=4194308),I.memoizedProps=N,I.memoizedState=fe),Q.props=N,Q.state=fe,Q.context=Ve,N=he):(typeof Q.componentDidMount=="function"&&(I.flags|=4194308),N=!1)}else{Q=I.stateNode,GB(g,I),he=I.memoizedProps,Ve=I.type===I.elementType?he:Na(I.type,he),Q.props=Ve,Ue=I.pendingProps,Pe=Q.context,fe=y.contextType,typeof fe=="object"&&fe!==null?fe=zi(fe):(fe=Lr(y)?Md:or.current,fe=Mg(I,fe));var at=y.getDerivedStateFromProps;(Ke=typeof at=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(he!==Ue||Pe!==fe)&&eN(I,Q,N,fe),vc=!1,Pe=I.memoizedState,Q.state=Pe,II(I,N,Q,J);var ut=I.memoizedState;he!==Ue||Pe!==ut||Dr.current||vc?(typeof at=="function"&&(YA(I,y,at,N),ut=I.memoizedState),(Ve=vc||qB(I,y,Ve,N,Pe,ut,fe)||!1)?(Ke||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(N,ut,fe),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(N,ut,fe)),typeof Q.componentDidUpdate=="function"&&(I.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(I.flags|=1024)):(typeof Q.componentDidUpdate!="function"||he===g.memoizedProps&&Pe===g.memoizedState||(I.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||he===g.memoizedProps&&Pe===g.memoizedState||(I.flags|=1024),I.memoizedProps=N,I.memoizedState=ut),Q.props=N,Q.state=ut,Q.context=fe,N=Ve):(typeof Q.componentDidUpdate!="function"||he===g.memoizedProps&&Pe===g.memoizedState||(I.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||he===g.memoizedProps&&Pe===g.memoizedState||(I.flags|=1024),N=!1)}return EA(g,I,y,N,F,J)}function EA(g,I,y,N,J,F){dN(g,I);var Q=(I.flags&128)!==0;if(!N&&!Q)return J&&CB(I,y,!1),fl(g,I,F);N=I.stateNode,wD.current=I;var he=Q&&typeof y.getDerivedStateFromError!="function"?null:N.render();return I.flags|=1,g!==null&&Q?(I.child=Dg(I,g.child,null,F),I.child=Dg(I,null,he,F)):Br(g,I,he,F),I.memoizedState=N.state,J&&CB(I,y,!0),I.child}function uN(g){var I=g.stateNode;I.pendingContext?mB(g,I.pendingContext,I.pendingContext!==I.context):I.context&&mB(g,I.context,!1),ZA(g,I.containerInfo)}function hN(g,I,y,N,J){return Eg(),AA(J),I.flags|=256,Br(g,I,y,N),I.child}var DA={dehydrated:null,treeContext:null,retryLane:0};function LA(g){return{baseLanes:g,cachePool:null,transitions:null}}function mN(g,I,y){var N=I.pendingProps,J=$n.current,F=!1,Q=(I.flags&128)!==0,he;if((he=Q)||(he=g!==null&&g.memoizedState===null?!1:(J&2)!==0),he?(F=!0,I.flags&=-129):(g===null||g.memoizedState!==null)&&(J|=1),Mn($n,J&1),g===null)return pA(I),g=I.memoizedState,g!==null&&(g=g.dehydrated,g!==null)?((I.mode&1)===0?I.lanes=1:g.data==="$!"?I.lanes=8:I.lanes=1073741824,null):(Q=N.children,g=N.fallback,F?(N=I.mode,F=I.child,Q={mode:"hidden",children:Q},(N&1)===0&&F!==null?(F.childLanes=0,F.pendingProps=Q):F=XI(Q,N,0,null),g=Ud(g,N,y,null),F.return=I,g.return=I,F.sibling=g,I.child=F,I.child.memoizedState=LA(y),I.memoizedState=DA,g):PA(I,Q));if(J=g.memoizedState,J!==null&&(he=J.dehydrated,he!==null))return ZD(g,I,Q,N,he,J,y);if(F){F=N.fallback,Q=I.mode,J=g.child,he=J.sibling;var fe={mode:"hidden",children:N.children};return(Q&1)===0&&I.child!==J?(N=I.child,N.childLanes=0,N.pendingProps=fe,I.deletions=null):(N=Nc(J,fe),N.subtreeFlags=J.subtreeFlags&14680064),he!==null?F=Nc(he,F):(F=Ud(F,Q,y,null),F.flags|=2),F.return=I,N.return=I,N.sibling=F,I.child=N,N=F,F=I.child,Q=g.child.memoizedState,Q=Q===null?LA(y):{baseLanes:Q.baseLanes|y,cachePool:null,transitions:Q.transitions},F.memoizedState=Q,F.childLanes=g.childLanes&~y,I.memoizedState=DA,N}return F=g.child,g=F.sibling,N=Nc(F,{mode:"visible",children:N.children}),(I.mode&1)===0&&(N.lanes=y),N.return=I,N.sibling=null,g!==null&&(y=I.deletions,y===null?(I.deletions=[g],I.flags|=16):y.push(g)),I.child=N,I.memoizedState=null,N}function PA(g,I){return I=XI({mode:"visible",children:I},g.mode,0,null),I.return=g,g.child=I}function xI(g,I,y,N){return N!==null&&AA(N),Dg(I,g.child,null,y),g=PA(I,I.pendingProps.children),g.flags|=2,I.memoizedState=null,g}function ZD(g,I,y,N,J,F,Q){if(y)return I.flags&256?(I.flags&=-257,N=MA(Error(t(422))),xI(g,I,Q,N)):I.memoizedState!==null?(I.child=g.child,I.flags|=128,null):(F=N.fallback,J=I.mode,N=XI({mode:"visible",children:N.children},J,0,null),F=Ud(F,J,Q,null),F.flags|=2,N.return=I,F.return=I,N.sibling=F,I.child=N,(I.mode&1)!==0&&Dg(I,g.child,null,Q),I.child.memoizedState=LA(Q),I.memoizedState=DA,F);if((I.mode&1)===0)return xI(g,I,Q,null);if(J.data==="$!"){if(N=J.nextSibling&&J.nextSibling.dataset,N)var he=N.dgst;return N=he,F=Error(t(419)),N=MA(F,N,void 0),xI(g,I,Q,N)}if(he=(Q&g.childLanes)!==0,Pr||he){if(N=Ms,N!==null){switch(Q&-Q){case 4:J=2;break;case 16:J=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:J=32;break;case 536870912:J=268435456;break;default:J=0}J=(J&(N.suspendedLanes|Q))!==0?0:J,J!==0&&J!==F.retryLane&&(F.retryLane=J,Il(g,J),Wa(N,g,J,-1))}return lb(),N=MA(Error(t(421))),xI(g,I,Q,N)}return J.data==="$?"?(I.flags|=128,I.child=g.child,I=FD.bind(null,g),J._reactRetry=I,null):(g=F.treeContext,Ci=fo(J.nextSibling),Ii=I,Un=!0,Ba=null,g!==null&&(Ki[Oi++]=hl,Ki[Oi++]=ml,Ki[Oi++]=Hd,hl=g.id,ml=g.overflow,Hd=I),I=PA(I,N.children),I.flags|=4096,I)}function IN(g,I,y){g.lanes|=I;var N=g.alternate;N!==null&&(N.lanes|=I),xA(g.return,I,y)}function KA(g,I,y,N,J){var F=g.memoizedState;F===null?g.memoizedState={isBackwards:I,rendering:null,renderingStartTime:0,last:N,tail:y,tailMode:J}:(F.isBackwards=I,F.rendering=null,F.renderingStartTime=0,F.last=N,F.tail=y,F.tailMode=J)}function CN(g,I,y){var N=I.pendingProps,J=N.revealOrder,F=N.tail;if(Br(g,I,N.children,y),N=$n.current,(N&2)!==0)N=N&1|2,I.flags|=128;else{if(g!==null&&(g.flags&128)!==0)e:for(g=I.child;g!==null;){if(g.tag===13)g.memoizedState!==null&&IN(g,y,I);else if(g.tag===19)IN(g,y,I);else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===I)break e;for(;g.sibling===null;){if(g.return===null||g.return===I)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}N&=1}if(Mn($n,N),(I.mode&1)===0)I.memoizedState=null;else switch(J){case"forwards":for(y=I.child,J=null;y!==null;)g=y.alternate,g!==null&&CI(g)===null&&(J=y),y=y.sibling;y=J,y===null?(J=I.child,I.child=null):(J=y.sibling,y.sibling=null),KA(I,!1,J,y,F);break;case"backwards":for(y=null,J=I.child,I.child=null;J!==null;){if(g=J.alternate,g!==null&&CI(g)===null){I.child=J;break}g=J.sibling,J.sibling=y,y=J,J=g}KA(I,!0,y,null,F);break;case"together":KA(I,!1,null,null,void 0);break;default:I.memoizedState=null}return I.child}function SI(g,I){(I.mode&1)===0&&g!==null&&(g.alternate=null,I.alternate=null,I.flags|=2)}function fl(g,I,y){if(g!==null&&(I.dependencies=g.dependencies),Pd|=I.lanes,(y&I.childLanes)===0)return null;if(g!==null&&I.child!==g.child)throw Error(t(153));if(I.child!==null){for(g=I.child,y=Nc(g,g.pendingProps),I.child=y,y.return=I;g.sibling!==null;)g=g.sibling,y=y.sibling=Nc(g,g.pendingProps),y.return=I;y.sibling=null}return I.child}function GD(g,I,y){switch(I.tag){case 3:uN(I),Eg();break;case 5:kB(I);break;case 1:Lr(I.type)&&aI(I);break;case 4:ZA(I,I.stateNode.containerInfo);break;case 10:var N=I.type._context,J=I.memoizedProps.value;Mn(uI,N._currentValue),N._currentValue=J;break;case 13:if(N=I.memoizedState,N!==null)return N.dehydrated!==null?(Mn($n,$n.current&1),I.flags|=128,null):(y&I.child.childLanes)!==0?mN(g,I,y):(Mn($n,$n.current&1),g=fl(g,I,y),g!==null?g.sibling:null);Mn($n,$n.current&1);break;case 19:if(N=(y&I.childLanes)!==0,(g.flags&128)!==0){if(N)return CN(g,I,y);I.flags|=128}if(J=I.memoizedState,J!==null&&(J.rendering=null,J.tail=null,J.lastEffect=null),Mn($n,$n.current),N)break;return null;case 22:case 23:return I.lanes=0,cN(g,I,y)}return fl(g,I,y)}var fN,OA,pN,AN;fN=function(g,I){for(var y=I.child;y!==null;){if(y.tag===5||y.tag===6)g.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===I)break;for(;y.sibling===null;){if(y.return===null||y.return===I)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},OA=function(){},pN=function(g,I,y,N){var J=g.memoizedProps;if(J!==N){g=I.stateNode,Dd(po.current);var F=null;switch(y){case"input":J=Ye(g,J),N=Ye(g,N),F=[];break;case"select":J=ne({},J,{value:void 0}),N=ne({},N,{value:void 0}),F=[];break;case"textarea":J=Ie(g,J),N=Ie(g,N),F=[];break;default:typeof J.onClick!="function"&&typeof N.onClick=="function"&&(g.onclick=Ee)}on(y,N);var Q;y=null;for(Ve in J)if(!N.hasOwnProperty(Ve)&&J.hasOwnProperty(Ve)&&J[Ve]!=null)if(Ve==="style"){var he=J[Ve];for(Q in he)he.hasOwnProperty(Q)&&(y||(y={}),y[Q]="")}else Ve!=="dangerouslySetInnerHTML"&&Ve!=="children"&&Ve!=="suppressContentEditableWarning"&&Ve!=="suppressHydrationWarning"&&Ve!=="autoFocus"&&(i.hasOwnProperty(Ve)?F||(F=[]):(F=F||[]).push(Ve,null));for(Ve in N){var fe=N[Ve];if(he=J?.[Ve],N.hasOwnProperty(Ve)&&fe!==he&&(fe!=null||he!=null))if(Ve==="style")if(he){for(Q in he)!he.hasOwnProperty(Q)||fe&&fe.hasOwnProperty(Q)||(y||(y={}),y[Q]="");for(Q in fe)fe.hasOwnProperty(Q)&&he[Q]!==fe[Q]&&(y||(y={}),y[Q]=fe[Q])}else y||(F||(F=[]),F.push(Ve,y)),y=fe;else Ve==="dangerouslySetInnerHTML"?(fe=fe?fe.__html:void 0,he=he?he.__html:void 0,fe!=null&&he!==fe&&(F=F||[]).push(Ve,fe)):Ve==="children"?typeof fe!="string"&&typeof fe!="number"||(F=F||[]).push(Ve,""+fe):Ve!=="suppressContentEditableWarning"&&Ve!=="suppressHydrationWarning"&&(i.hasOwnProperty(Ve)?(fe!=null&&Ve==="onScroll"&&Wn("scroll",g),F||he===fe||(F=[])):(F=F||[]).push(Ve,fe))}y&&(F=F||[]).push("style",y);var Ve=F;(I.updateQueue=Ve)&&(I.flags|=4)}},AN=function(g,I,y,N){y!==N&&(I.flags|=4)};function yh(g,I){if(!Un)switch(g.tailMode){case"hidden":I=g.tail;for(var y=null;I!==null;)I.alternate!==null&&(y=I),I=I.sibling;y===null?g.tail=null:y.sibling=null;break;case"collapsed":y=g.tail;for(var N=null;y!==null;)y.alternate!==null&&(N=y),y=y.sibling;N===null?I||g.tail===null?g.tail=null:g.tail.sibling=null:N.sibling=null}}function cr(g){var I=g.alternate!==null&&g.alternate.child===g.child,y=0,N=0;if(I)for(var J=g.child;J!==null;)y|=J.lanes|J.childLanes,N|=J.subtreeFlags&14680064,N|=J.flags&14680064,J.return=g,J=J.sibling;else for(J=g.child;J!==null;)y|=J.lanes|J.childLanes,N|=J.subtreeFlags,N|=J.flags,J.return=g,J=J.sibling;return g.subtreeFlags|=N,g.childLanes=y,I}function BD(g,I,y){var N=I.pendingProps;switch(CA(I),I.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cr(I),null;case 1:return Lr(I.type)&&iI(),cr(I),null;case 3:return N=I.stateNode,Kg(),En(Dr),En(or),NA(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(g===null||g.child===null)&&(dI(I)?I.flags|=4:g===null||g.memoizedState.isDehydrated&&(I.flags&256)===0||(I.flags|=1024,Ba!==null&&(ib(Ba),Ba=null))),OA(g,I),cr(I),null;case 5:GA(I);var J=Dd(Ch.current);if(y=I.type,g!==null&&I.stateNode!=null)pN(g,I,y,N,J),g.ref!==I.ref&&(I.flags|=512,I.flags|=2097152);else{if(!N){if(I.stateNode===null)throw Error(t(166));return cr(I),null}if(g=Dd(po.current),dI(I)){N=I.stateNode,y=I.type;var F=I.memoizedProps;switch(N[Pi]=I,N[fc]=F,g=(I.mode&1)!==0,y){case"dialog":Wn("cancel",N),Wn("close",N);break;case"iframe":case"object":case"embed":Wn("load",N);break;case"video":case"audio":for(J=0;J<mc.length;J++)Wn(mc[J],N);break;case"source":Wn("error",N);break;case"img":case"image":case"link":Wn("error",N),Wn("load",N);break;case"details":Wn("toggle",N);break;case"input":De(N,F),Wn("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!F.multiple},Wn("invalid",N);break;case"textarea":Ne(N,F),Wn("invalid",N)}on(y,F),J=null;for(var Q in F)if(F.hasOwnProperty(Q)){var he=F[Q];Q==="children"?typeof he=="string"?N.textContent!==he&&(F.suppressHydrationWarning!==!0&&We(N.textContent,he,g),J=["children",he]):typeof he=="number"&&N.textContent!==""+he&&(F.suppressHydrationWarning!==!0&&We(N.textContent,he,g),J=["children",""+he]):i.hasOwnProperty(Q)&&he!=null&&Q==="onScroll"&&Wn("scroll",N)}switch(y){case"input":Be(N),nt(N,F,!0);break;case"textarea":Be(N),je(N);break;case"select":case"option":break;default:typeof F.onClick=="function"&&(N.onclick=Ee)}N=J,I.updateQueue=N,N!==null&&(I.flags|=4)}else{Q=J.nodeType===9?J:J.ownerDocument,g==="http://www.w3.org/1999/xhtml"&&(g=Fe(y)),g==="http://www.w3.org/1999/xhtml"?y==="script"?(g=Q.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild)):typeof N.is=="string"?g=Q.createElement(y,{is:N.is}):(g=Q.createElement(y),y==="select"&&(Q=g,N.multiple?Q.multiple=!0:N.size&&(Q.size=N.size))):g=Q.createElementNS(g,y),g[Pi]=I,g[fc]=N,fN(g,I,!1,!1),I.stateNode=g;e:{switch(Q=Ut(y,N),y){case"dialog":Wn("cancel",g),Wn("close",g),J=N;break;case"iframe":case"object":case"embed":Wn("load",g),J=N;break;case"video":case"audio":for(J=0;J<mc.length;J++)Wn(mc[J],g);J=N;break;case"source":Wn("error",g),J=N;break;case"img":case"image":case"link":Wn("error",g),Wn("load",g),J=N;break;case"details":Wn("toggle",g),J=N;break;case"input":De(g,N),J=Ye(g,N),Wn("invalid",g);break;case"option":J=N;break;case"select":g._wrapperState={wasMultiple:!!N.multiple},J=ne({},N,{value:void 0}),Wn("invalid",g);break;case"textarea":Ne(g,N),J=Ie(g,N),Wn("invalid",g);break;default:J=N}on(y,J),he=J;for(F in he)if(he.hasOwnProperty(F)){var fe=he[F];F==="style"?cn(g,fe):F==="dangerouslySetInnerHTML"?(fe=fe?fe.__html:void 0,fe!=null&&Dt(g,fe)):F==="children"?typeof fe=="string"?(y!=="textarea"||fe!=="")&&kt(g,fe):typeof fe=="number"&&kt(g,""+fe):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(i.hasOwnProperty(F)?fe!=null&&F==="onScroll"&&Wn("scroll",g):fe!=null&&V(g,F,fe,Q))}switch(y){case"input":Be(g),nt(g,N,!1);break;case"textarea":Be(g),je(g);break;case"option":N.value!=null&&g.setAttribute("value",""+ge(N.value));break;case"select":g.multiple=!!N.multiple,F=N.value,F!=null?oe(g,!!N.multiple,F,!1):N.defaultValue!=null&&oe(g,!!N.multiple,N.defaultValue,!0);break;default:typeof J.onClick=="function"&&(g.onclick=Ee)}switch(y){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(I.flags|=4)}I.ref!==null&&(I.flags|=512,I.flags|=2097152)}return cr(I),null;case 6:if(g&&I.stateNode!=null)AN(g,I,g.memoizedProps,N);else{if(typeof N!="string"&&I.stateNode===null)throw Error(t(166));if(y=Dd(Ch.current),Dd(po.current),dI(I)){if(N=I.stateNode,y=I.memoizedProps,N[Pi]=I,(F=N.nodeValue!==y)&&(g=Ii,g!==null))switch(g.tag){case 3:We(N.nodeValue,y,(g.mode&1)!==0);break;case 5:g.memoizedProps.suppressHydrationWarning!==!0&&We(N.nodeValue,y,(g.mode&1)!==0)}F&&(I.flags|=4)}else N=(y.nodeType===9?y:y.ownerDocument).createTextNode(N),N[Pi]=I,I.stateNode=N}return cr(I),null;case 13:if(En($n),N=I.memoizedState,g===null||g.memoizedState!==null&&g.memoizedState.dehydrated!==null){if(Un&&Ci!==null&&(I.mode&1)!==0&&(I.flags&128)===0)vB(),Eg(),I.flags|=98560,F=!1;else if(F=dI(I),N!==null&&N.dehydrated!==null){if(g===null){if(!F)throw Error(t(318));if(F=I.memoizedState,F=F!==null?F.dehydrated:null,!F)throw Error(t(317));F[Pi]=I}else Eg(),(I.flags&128)===0&&(I.memoizedState=null),I.flags|=4;cr(I),F=!1}else Ba!==null&&(ib(Ba),Ba=null),F=!0;if(!F)return I.flags&65536?I:null}return(I.flags&128)!==0?(I.lanes=y,I):(N=N!==null,N!==(g!==null&&g.memoizedState!==null)&&N&&(I.child.flags|=8192,(I.mode&1)!==0&&(g===null||($n.current&1)!==0?Ws===0&&(Ws=3):lb())),I.updateQueue!==null&&(I.flags|=4),cr(I),null);case 4:return Kg(),OA(g,I),g===null&&Ic(I.stateNode.containerInfo),cr(I),null;case 10:return vA(I.type._context),cr(I),null;case 17:return Lr(I.type)&&iI(),cr(I),null;case 19:if(En($n),F=I.memoizedState,F===null)return cr(I),null;if(N=(I.flags&128)!==0,Q=F.rendering,Q===null)if(N)yh(F,!1);else{if(Ws!==0||g!==null&&(g.flags&128)!==0)for(g=I.child;g!==null;){if(Q=CI(g),Q!==null){for(I.flags|=128,yh(F,!1),N=Q.updateQueue,N!==null&&(I.updateQueue=N,I.flags|=4),I.subtreeFlags=0,N=y,y=I.child;y!==null;)F=y,g=N,F.flags&=14680066,Q=F.alternate,Q===null?(F.childLanes=0,F.lanes=g,F.child=null,F.subtreeFlags=0,F.memoizedProps=null,F.memoizedState=null,F.updateQueue=null,F.dependencies=null,F.stateNode=null):(F.childLanes=Q.childLanes,F.lanes=Q.lanes,F.child=Q.child,F.subtreeFlags=0,F.deletions=null,F.memoizedProps=Q.memoizedProps,F.memoizedState=Q.memoizedState,F.updateQueue=Q.updateQueue,F.type=Q.type,g=Q.dependencies,F.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),y=y.sibling;return Mn($n,$n.current&1|2),I.child}g=g.sibling}F.tail!==null&&jn()>Qg&&(I.flags|=128,N=!0,yh(F,!1),I.lanes=4194304)}else{if(!N)if(g=CI(Q),g!==null){if(I.flags|=128,N=!0,y=g.updateQueue,y!==null&&(I.updateQueue=y,I.flags|=4),yh(F,!0),F.tail===null&&F.tailMode==="hidden"&&!Q.alternate&&!Un)return cr(I),null}else 2*jn()-F.renderingStartTime>Qg&&y!==1073741824&&(I.flags|=128,N=!0,yh(F,!1),I.lanes=4194304);F.isBackwards?(Q.sibling=I.child,I.child=Q):(y=F.last,y!==null?y.sibling=Q:I.child=Q,F.last=Q)}return F.tail!==null?(I=F.tail,F.rendering=I,F.tail=I.sibling,F.renderingStartTime=jn(),I.sibling=null,y=$n.current,Mn($n,N?y&1|2:y&1),I):(cr(I),null);case 22:case 23:return ob(),N=I.memoizedState!==null,g!==null&&g.memoizedState!==null!==N&&(I.flags|=8192),N&&(I.mode&1)!==0?(fi&1073741824)!==0&&(cr(I),I.subtreeFlags&6&&(I.flags|=8192)):cr(I),null;case 24:return null;case 25:return null}throw Error(t(156,I.tag))}function ND(g,I){switch(CA(I),I.tag){case 1:return Lr(I.type)&&iI(),g=I.flags,g&65536?(I.flags=g&-65537|128,I):null;case 3:return Kg(),En(Dr),En(or),NA(),g=I.flags,(g&65536)!==0&&(g&128)===0?(I.flags=g&-65537|128,I):null;case 5:return GA(I),null;case 13:if(En($n),g=I.memoizedState,g!==null&&g.dehydrated!==null){if(I.alternate===null)throw Error(t(340));Eg()}return g=I.flags,g&65536?(I.flags=g&-65537|128,I):null;case 19:return En($n),null;case 4:return Kg(),null;case 10:return vA(I.type._context),null;case 22:case 23:return ob(),null;case 24:return null;default:return null}}var wI=!1,dr=!1,kD=typeof WeakSet=="function"?WeakSet:Set,dt=null;function zg(g,I){var y=g.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(N){as(g,I,N)}else y.current=null}function zA(g,I,y){try{y()}catch(N){as(g,I,N)}}var bN=!1;function RD(g,I){if(tt=xa,g=il(),al(g)){if("selectionStart"in g)var y={start:g.selectionStart,end:g.selectionEnd};else e:{y=(y=g.ownerDocument)&&y.defaultView||window;var N=y.getSelection&&y.getSelection();if(N&&N.rangeCount!==0){y=N.anchorNode;var J=N.anchorOffset,F=N.focusNode;N=N.focusOffset;try{y.nodeType,F.nodeType}catch{y=null;break e}var Q=0,he=-1,fe=-1,Ve=0,Ke=0,Ue=g,Pe=null;t:for(;;){for(var at;Ue!==y||J!==0&&Ue.nodeType!==3||(he=Q+J),Ue!==F||N!==0&&Ue.nodeType!==3||(fe=Q+N),Ue.nodeType===3&&(Q+=Ue.nodeValue.length),(at=Ue.firstChild)!==null;)Pe=Ue,Ue=at;for(;;){if(Ue===g)break t;if(Pe===y&&++Ve===J&&(he=Q),Pe===F&&++Ke===N&&(fe=Q),(at=Ue.nextSibling)!==null)break;Ue=Pe,Pe=Ue.parentNode}Ue=at}y=he===-1||fe===-1?null:{start:he,end:fe}}else y=null}y=y||{start:0,end:0}}else y=null;for(St={focusedElem:g,selectionRange:y},xa=!1,dt=I;dt!==null;)if(I=dt,g=I.child,(I.subtreeFlags&1028)!==0&&g!==null)g.return=I,dt=g;else for(;dt!==null;){I=dt;try{var ut=I.alternate;if((I.flags&1024)!==0)switch(I.tag){case 0:case 11:case 15:break;case 1:if(ut!==null){var mt=ut.memoizedProps,cs=ut.memoizedState,Ze=I.stateNode,Ae=Ze.getSnapshotBeforeUpdate(I.elementType===I.type?mt:Na(I.type,mt),cs);Ze.__reactInternalSnapshotBeforeUpdate=Ae}break;case 3:var ke=I.stateNode.containerInfo;ke.nodeType===1?ke.textContent="":ke.nodeType===9&&ke.documentElement&&ke.removeChild(ke.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Qe){as(I,I.return,Qe)}if(g=I.sibling,g!==null){g.return=I.return,dt=g;break}dt=I.return}return ut=bN,bN=!1,ut}function vh(g,I,y){var N=I.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var J=N=N.next;do{if((J.tag&g)===g){var F=J.destroy;J.destroy=void 0,F!==void 0&&zA(I,y,F)}J=J.next}while(J!==N)}}function ZI(g,I){if(I=I.updateQueue,I=I!==null?I.lastEffect:null,I!==null){var y=I=I.next;do{if((y.tag&g)===g){var N=y.create;y.destroy=N()}y=y.next}while(y!==I)}}function UA(g){var I=g.ref;if(I!==null){var y=g.stateNode;switch(g.tag){case 5:g=y;break;default:g=y}typeof I=="function"?I(g):I.current=g}}function yN(g){var I=g.alternate;I!==null&&(g.alternate=null,yN(I)),g.child=null,g.deletions=null,g.sibling=null,g.tag===5&&(I=g.stateNode,I!==null&&(delete I[Pi],delete I[fc],delete I[pc],delete I[gA],delete I[uA])),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function vN(g){return g.tag===5||g.tag===3||g.tag===4}function xN(g){e:for(;;){for(;g.sibling===null;){if(g.return===null||vN(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==5&&g.tag!==6&&g.tag!==18;){if(g.flags&2||g.child===null||g.tag===4)continue e;g.child.return=g,g=g.child}if(!(g.flags&2))return g.stateNode}}function QA(g,I,y){var N=g.tag;if(N===5||N===6)g=g.stateNode,I?y.nodeType===8?y.parentNode.insertBefore(g,I):y.insertBefore(g,I):(y.nodeType===8?(I=y.parentNode,I.insertBefore(g,y)):(I=y,I.appendChild(g)),y=y._reactRootContainer,y!=null||I.onclick!==null||(I.onclick=Ee));else if(N!==4&&(g=g.child,g!==null))for(QA(g,I,y),g=g.sibling;g!==null;)QA(g,I,y),g=g.sibling}function qA(g,I,y){var N=g.tag;if(N===5||N===6)g=g.stateNode,I?y.insertBefore(g,I):y.appendChild(g);else if(N!==4&&(g=g.child,g!==null))for(qA(g,I,y),g=g.sibling;g!==null;)qA(g,I,y),g=g.sibling}var Us=null,ka=!1;function Sc(g,I,y){for(y=y.child;y!==null;)SN(g,I,y),y=y.sibling}function SN(g,I,y){if(Es&&typeof Es.onCommitFiberUnmount=="function")try{Es.onCommitFiberUnmount(fa,y)}catch{}switch(y.tag){case 5:dr||zg(y,I);case 6:var N=Us,J=ka;Us=null,Sc(g,I,y),Us=N,ka=J,Us!==null&&(ka?(g=Us,y=y.stateNode,g.nodeType===8?g.parentNode.removeChild(y):g.removeChild(y)):Us.removeChild(y.stateNode));break;case 18:Us!==null&&(ka?(g=Us,y=y.stateNode,g.nodeType===8?uh(g.parentNode,y):g.nodeType===1&&uh(g,y),Ps(g)):uh(Us,y.stateNode));break;case 4:N=Us,J=ka,Us=y.stateNode.containerInfo,ka=!0,Sc(g,I,y),Us=N,ka=J;break;case 0:case 11:case 14:case 15:if(!dr&&(N=y.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){J=N=N.next;do{var F=J,Q=F.destroy;F=F.tag,Q!==void 0&&((F&2)!==0||(F&4)!==0)&&zA(y,I,Q),J=J.next}while(J!==N)}Sc(g,I,y);break;case 1:if(!dr&&(zg(y,I),N=y.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=y.memoizedProps,N.state=y.memoizedState,N.componentWillUnmount()}catch(he){as(y,I,he)}Sc(g,I,y);break;case 21:Sc(g,I,y);break;case 22:y.mode&1?(dr=(N=dr)||y.memoizedState!==null,Sc(g,I,y),dr=N):Sc(g,I,y);break;default:Sc(g,I,y)}}function wN(g){var I=g.updateQueue;if(I!==null){g.updateQueue=null;var y=g.stateNode;y===null&&(y=g.stateNode=new kD),I.forEach(function(N){var J=MD.bind(null,g,N);y.has(N)||(y.add(N),N.then(J,J))})}}function Ra(g,I){var y=I.deletions;if(y!==null)for(var N=0;N<y.length;N++){var J=y[N];try{var F=g,Q=I,he=Q;e:for(;he!==null;){switch(he.tag){case 5:Us=he.stateNode,ka=!1;break e;case 3:Us=he.stateNode.containerInfo,ka=!0;break e;case 4:Us=he.stateNode.containerInfo,ka=!0;break e}he=he.return}if(Us===null)throw Error(t(160));SN(F,Q,J),Us=null,ka=!1;var fe=J.alternate;fe!==null&&(fe.return=null),J.return=null}catch(Ve){as(J,I,Ve)}}if(I.subtreeFlags&12854)for(I=I.child;I!==null;)ZN(I,g),I=I.sibling}function ZN(g,I){var y=g.alternate,N=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:if(Ra(I,g),bo(g),N&4){try{vh(3,g,g.return),ZI(3,g)}catch(mt){as(g,g.return,mt)}try{vh(5,g,g.return)}catch(mt){as(g,g.return,mt)}}break;case 1:Ra(I,g),bo(g),N&512&&y!==null&&zg(y,y.return);break;case 5:if(Ra(I,g),bo(g),N&512&&y!==null&&zg(y,y.return),g.flags&32){var J=g.stateNode;try{kt(J,"")}catch(mt){as(g,g.return,mt)}}if(N&4&&(J=g.stateNode,J!=null)){var F=g.memoizedProps,Q=y!==null?y.memoizedProps:F,he=g.type,fe=g.updateQueue;if(g.updateQueue=null,fe!==null)try{he==="input"&&F.type==="radio"&&F.name!=null&&Me(J,F),Ut(he,Q);var Ve=Ut(he,F);for(Q=0;Q<fe.length;Q+=2){var Ke=fe[Q],Ue=fe[Q+1];Ke==="style"?cn(J,Ue):Ke==="dangerouslySetInnerHTML"?Dt(J,Ue):Ke==="children"?kt(J,Ue):V(J,Ke,Ue,Ve)}switch(he){case"input":Le(J,F);break;case"textarea":Ge(J,F);break;case"select":var Pe=J._wrapperState.wasMultiple;J._wrapperState.wasMultiple=!!F.multiple;var at=F.value;at!=null?oe(J,!!F.multiple,at,!1):Pe!==!!F.multiple&&(F.defaultValue!=null?oe(J,!!F.multiple,F.defaultValue,!0):oe(J,!!F.multiple,F.multiple?[]:"",!1))}J[fc]=F}catch(mt){as(g,g.return,mt)}}break;case 6:if(Ra(I,g),bo(g),N&4){if(g.stateNode===null)throw Error(t(162));J=g.stateNode,F=g.memoizedProps;try{J.nodeValue=F}catch(mt){as(g,g.return,mt)}}break;case 3:if(Ra(I,g),bo(g),N&4&&y!==null&&y.memoizedState.isDehydrated)try{Ps(I.containerInfo)}catch(mt){as(g,g.return,mt)}break;case 4:Ra(I,g),bo(g);break;case 13:Ra(I,g),bo(g),J=g.child,J.flags&8192&&(F=J.memoizedState!==null,J.stateNode.isHidden=F,!F||J.alternate!==null&&J.alternate.memoizedState!==null||(tb=jn())),N&4&&wN(g);break;case 22:if(Ke=y!==null&&y.memoizedState!==null,g.mode&1?(dr=(Ve=dr)||Ke,Ra(I,g),dr=Ve):Ra(I,g),bo(g),N&8192){if(Ve=g.memoizedState!==null,(g.stateNode.isHidden=Ve)&&!Ke&&(g.mode&1)!==0)for(dt=g,Ke=g.child;Ke!==null;){for(Ue=dt=Ke;dt!==null;){switch(Pe=dt,at=Pe.child,Pe.tag){case 0:case 11:case 14:case 15:vh(4,Pe,Pe.return);break;case 1:zg(Pe,Pe.return);var ut=Pe.stateNode;if(typeof ut.componentWillUnmount=="function"){N=Pe,y=Pe.return;try{I=N,ut.props=I.memoizedProps,ut.state=I.memoizedState,ut.componentWillUnmount()}catch(mt){as(N,y,mt)}}break;case 5:zg(Pe,Pe.return);break;case 22:if(Pe.memoizedState!==null){NN(Ue);continue}}at!==null?(at.return=Pe,dt=at):NN(Ue)}Ke=Ke.sibling}e:for(Ke=null,Ue=g;;){if(Ue.tag===5){if(Ke===null){Ke=Ue;try{J=Ue.stateNode,Ve?(F=J.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none"):(he=Ue.stateNode,fe=Ue.memoizedProps.style,Q=fe!=null&&fe.hasOwnProperty("display")?fe.display:null,he.style.display=Rt("display",Q))}catch(mt){as(g,g.return,mt)}}}else if(Ue.tag===6){if(Ke===null)try{Ue.stateNode.nodeValue=Ve?"":Ue.memoizedProps}catch(mt){as(g,g.return,mt)}}else if((Ue.tag!==22&&Ue.tag!==23||Ue.memoizedState===null||Ue===g)&&Ue.child!==null){Ue.child.return=Ue,Ue=Ue.child;continue}if(Ue===g)break e;for(;Ue.sibling===null;){if(Ue.return===null||Ue.return===g)break e;Ke===Ue&&(Ke=null),Ue=Ue.return}Ke===Ue&&(Ke=null),Ue.sibling.return=Ue.return,Ue=Ue.sibling}}break;case 19:Ra(I,g),bo(g),N&4&&wN(g);break;case 21:break;default:Ra(I,g),bo(g)}}function bo(g){var I=g.flags;if(I&2){try{e:{for(var y=g.return;y!==null;){if(vN(y)){var N=y;break e}y=y.return}throw Error(t(160))}switch(N.tag){case 5:var J=N.stateNode;N.flags&32&&(kt(J,""),N.flags&=-33);var F=xN(g);qA(g,F,J);break;case 3:case 4:var Q=N.stateNode.containerInfo,he=xN(g);QA(g,he,Q);break;default:throw Error(t(161))}}catch(fe){as(g,g.return,fe)}g.flags&=-3}I&4096&&(g.flags&=-4097)}function WD(g,I,y){dt=g,GN(g)}function GN(g,I,y){for(var N=(g.mode&1)!==0;dt!==null;){var J=dt,F=J.child;if(J.tag===22&&N){var Q=J.memoizedState!==null||wI;if(!Q){var he=J.alternate,fe=he!==null&&he.memoizedState!==null||dr;he=wI;var Ve=dr;if(wI=Q,(dr=fe)&&!Ve)for(dt=J;dt!==null;)Q=dt,fe=Q.child,Q.tag===22&&Q.memoizedState!==null?kN(J):fe!==null?(fe.return=Q,dt=fe):kN(J);for(;F!==null;)dt=F,GN(F),F=F.sibling;dt=J,wI=he,dr=Ve}BN(g)}else(J.subtreeFlags&8772)!==0&&F!==null?(F.return=J,dt=F):BN(g)}}function BN(g){for(;dt!==null;){var I=dt;if((I.flags&8772)!==0){var y=I.alternate;try{if((I.flags&8772)!==0)switch(I.tag){case 0:case 11:case 15:dr||ZI(5,I);break;case 1:var N=I.stateNode;if(I.flags&4&&!dr)if(y===null)N.componentDidMount();else{var J=I.elementType===I.type?y.memoizedProps:Na(I.type,y.memoizedProps);N.componentDidUpdate(J,y.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var F=I.updateQueue;F!==null&&NB(I,F,N);break;case 3:var Q=I.updateQueue;if(Q!==null){if(y=null,I.child!==null)switch(I.child.tag){case 5:y=I.child.stateNode;break;case 1:y=I.child.stateNode}NB(I,Q,y)}break;case 5:var he=I.stateNode;if(y===null&&I.flags&4){y=he;var fe=I.memoizedProps;switch(I.type){case"button":case"input":case"select":case"textarea":fe.autoFocus&&y.focus();break;case"img":fe.src&&(y.src=fe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(I.memoizedState===null){var Ve=I.alternate;if(Ve!==null){var Ke=Ve.memoizedState;if(Ke!==null){var Ue=Ke.dehydrated;Ue!==null&&Ps(Ue)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}dr||I.flags&512&&UA(I)}catch(Pe){as(I,I.return,Pe)}}if(I===g){dt=null;break}if(y=I.sibling,y!==null){y.return=I.return,dt=y;break}dt=I.return}}function NN(g){for(;dt!==null;){var I=dt;if(I===g){dt=null;break}var y=I.sibling;if(y!==null){y.return=I.return,dt=y;break}dt=I.return}}function kN(g){for(;dt!==null;){var I=dt;try{switch(I.tag){case 0:case 11:case 15:var y=I.return;try{ZI(4,I)}catch(fe){as(I,y,fe)}break;case 1:var N=I.stateNode;if(typeof N.componentDidMount=="function"){var J=I.return;try{N.componentDidMount()}catch(fe){as(I,J,fe)}}var F=I.return;try{UA(I)}catch(fe){as(I,F,fe)}break;case 5:var Q=I.return;try{UA(I)}catch(fe){as(I,Q,fe)}}}catch(fe){as(I,I.return,fe)}if(I===g){dt=null;break}var he=I.sibling;if(he!==null){he.return=I.return,dt=he;break}dt=I.return}}var VD=Math.ceil,GI=R.ReactCurrentDispatcher,$A=R.ReactCurrentOwner,Qi=R.ReactCurrentBatchConfig,gn=0,Ms=null,ys=null,Qs=0,fi=0,Ug=Ac(0),Ws=0,xh=null,Pd=0,BI=0,eb=0,Sh=null,Kr=null,tb=0,Qg=1/0,pl=null,NI=!1,nb=null,wc=null,kI=!1,Zc=null,RI=0,wh=0,sb=null,WI=-1,VI=0;function Nr(){return(gn&6)!==0?jn():WI!==-1?WI:WI=jn()}function Gc(g){return(g.mode&1)===0?1:(gn&2)!==0&&Qs!==0?Qs&-Qs:CD.transition!==null?(VI===0&&(VI=Ol()),VI):(g=zt,g!==0||(g=window.event,g=g===void 0?16:Pt(g.type)),g)}function Wa(g,I,y,N){if(50<wh)throw wh=0,sb=null,Error(t(185));Ds(g,y,N),((gn&2)===0||g!==Ms)&&(g===Ms&&((gn&2)===0&&(BI|=y),Ws===4&&Bc(g,Qs)),Or(g,N),y===1&&gn===0&&(I.mode&1)===0&&(Qg=jn()+500,oI&&yc()))}function Or(g,I){var y=g.callbackNode;Ua(g,I);var N=vn(g,g===Ms?Qs:0);if(N===0)y!==null&&Ho(y),g.callbackNode=null,g.callbackPriority=0;else if(I=N&-N,g.callbackPriority!==I){if(y!=null&&Ho(y),I===1)g.tag===0?ID(WN.bind(null,g)):fB(WN.bind(null,g)),ar(function(){(gn&6)===0&&yc()}),y=null;else{switch(Ji(N)){case 1:y=To;break;case 4:y=Kl;break;case 16:y=Oa;break;case 536870912:y=Vi;break;default:y=Oa}y=MN(y,RN.bind(null,g))}g.callbackPriority=I,g.callbackNode=y}}function RN(g,I){if(WI=-1,VI=0,(gn&6)!==0)throw Error(t(327));var y=g.callbackNode;if(qg()&&g.callbackNode!==y)return null;var N=vn(g,g===Ms?Qs:0);if(N===0)return null;if((N&30)!==0||(N&g.expiredLanes)!==0||I)I=_I(g,N);else{I=N;var J=gn;gn|=2;var F=_N();(Ms!==g||Qs!==I)&&(pl=null,Qg=jn()+500,Od(g,I));do try{XD();break}catch(he){VN(g,he)}while(!0);yA(),GI.current=F,gn=J,ys!==null?I=0:(Ms=null,Qs=0,I=Ws)}if(I!==0){if(I===2&&(J=ps(g),J!==0&&(N=J,I=rb(g,J))),I===1)throw y=xh,Od(g,0),Bc(g,N),Or(g,jn()),y;if(I===6)Bc(g,N);else{if(J=g.current.alternate,(N&30)===0&&!_D(J)&&(I=_I(g,N),I===2&&(F=ps(g),F!==0&&(N=F,I=rb(g,F))),I===1))throw y=xh,Od(g,0),Bc(g,N),Or(g,jn()),y;switch(g.finishedWork=J,g.finishedLanes=N,I){case 0:case 1:throw Error(t(345));case 2:zd(g,Kr,pl);break;case 3:if(Bc(g,N),(N&130023424)===N&&(I=tb+500-jn(),10<I)){if(vn(g,0)!==0)break;if(J=g.suspendedLanes,(J&N)!==N){Nr(),g.pingedLanes|=g.suspendedLanes&J;break}g.timeoutHandle=ks(zd.bind(null,g,Kr,pl),I);break}zd(g,Kr,pl);break;case 4:if(Bc(g,N),(N&4194240)===N)break;for(I=g.eventTimes,J=-1;0<N;){var Q=31-Wt(N);F=1<<Q,Q=I[Q],Q>J&&(J=Q),N&=~F}if(N=J,N=jn()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*VD(N/1960))-N,10<N){g.timeoutHandle=ks(zd.bind(null,g,Kr,pl),N);break}zd(g,Kr,pl);break;case 5:zd(g,Kr,pl);break;default:throw Error(t(329))}}}return Or(g,jn()),g.callbackNode===y?RN.bind(null,g):null}function rb(g,I){var y=Sh;return g.current.memoizedState.isDehydrated&&(Od(g,I).flags|=256),g=_I(g,I),g!==2&&(I=Kr,Kr=y,I!==null&&ib(I)),g}function ib(g){Kr===null?Kr=g:Kr.push.apply(Kr,g)}function _D(g){for(var I=g;;){if(I.flags&16384){var y=I.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var N=0;N<y.length;N++){var J=y[N],F=J.getSnapshot;J=J.value;try{if(!zs(F(),J))return!1}catch{return!1}}}if(y=I.child,I.subtreeFlags&16384&&y!==null)y.return=I,I=y;else{if(I===g)break;for(;I.sibling===null;){if(I.return===null||I.return===g)return!0;I=I.return}I.sibling.return=I.return,I=I.sibling}}return!0}function Bc(g,I){for(I&=~eb,I&=~BI,g.suspendedLanes|=I,g.pingedLanes&=~I,g=g.expirationTimes;0<I;){var y=31-Wt(I),N=1<<y;g[y]=-1,I&=~N}}function WN(g){if((gn&6)!==0)throw Error(t(327));qg();var I=vn(g,0);if((I&1)===0)return Or(g,jn()),null;var y=_I(g,I);if(g.tag!==0&&y===2){var N=ps(g);N!==0&&(I=N,y=rb(g,N))}if(y===1)throw y=xh,Od(g,0),Bc(g,I),Or(g,jn()),y;if(y===6)throw Error(t(345));return g.finishedWork=g.current.alternate,g.finishedLanes=I,zd(g,Kr,pl),Or(g,jn()),null}function ab(g,I){var y=gn;gn|=1;try{return g(I)}finally{gn=y,gn===0&&(Qg=jn()+500,oI&&yc())}}function Kd(g){Zc!==null&&Zc.tag===0&&(gn&6)===0&&qg();var I=gn;gn|=1;var y=Qi.transition,N=zt;try{if(Qi.transition=null,zt=1,g)return g()}finally{zt=N,Qi.transition=y,gn=I,(gn&6)===0&&yc()}}function ob(){fi=Ug.current,En(Ug)}function Od(g,I){g.finishedWork=null,g.finishedLanes=0;var y=g.timeoutHandle;if(y!==-1&&(g.timeoutHandle=-1,bs(y)),ys!==null)for(y=ys.return;y!==null;){var N=y;switch(CA(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&iI();break;case 3:Kg(),En(Dr),En(or),NA();break;case 5:GA(N);break;case 4:Kg();break;case 13:En($n);break;case 19:En($n);break;case 10:vA(N.type._context);break;case 22:case 23:ob()}y=y.return}if(Ms=g,ys=g=Nc(g.current,null),Qs=fi=I,Ws=0,xh=null,eb=BI=Pd=0,Kr=Sh=null,Ed!==null){for(I=0;I<Ed.length;I++)if(y=Ed[I],N=y.interleaved,N!==null){y.interleaved=null;var J=N.next,F=y.pending;if(F!==null){var Q=F.next;F.next=J,N.next=Q}y.pending=N}Ed=null}return g}function VN(g,I){do{var y=ys;try{if(yA(),fI.current=yI,pI){for(var N=es.memoizedState;N!==null;){var J=N.queue;J!==null&&(J.pending=null),N=N.next}pI=!1}if(Ld=0,Fs=Rs=es=null,fh=!1,ph=0,$A.current=null,y===null||y.return===null){Ws=1,xh=I,ys=null;break}e:{var F=g,Q=y.return,he=y,fe=I;if(I=Qs,he.flags|=32768,fe!==null&&typeof fe=="object"&&typeof fe.then=="function"){var Ve=fe,Ke=he,Ue=Ke.tag;if((Ke.mode&1)===0&&(Ue===0||Ue===11||Ue===15)){var Pe=Ke.alternate;Pe?(Ke.updateQueue=Pe.updateQueue,Ke.memoizedState=Pe.memoizedState,Ke.lanes=Pe.lanes):(Ke.updateQueue=null,Ke.memoizedState=null)}var at=rN(Q);if(at!==null){at.flags&=-257,iN(at,Q,he,F,I),at.mode&1&&sN(F,Ve,I),I=at,fe=Ve;var ut=I.updateQueue;if(ut===null){var mt=new Set;mt.add(fe),I.updateQueue=mt}else ut.add(fe);break e}else{if((I&1)===0){sN(F,Ve,I),lb();break e}fe=Error(t(426))}}else if(Un&&he.mode&1){var cs=rN(Q);if(cs!==null){(cs.flags&65536)===0&&(cs.flags|=256),iN(cs,Q,he,F,I),AA(Og(fe,he));break e}}F=fe=Og(fe,he),Ws!==4&&(Ws=2),Sh===null?Sh=[F]:Sh.push(F),F=Q;do{switch(F.tag){case 3:F.flags|=65536,I&=-I,F.lanes|=I;var Ze=tN(F,fe,I);BB(F,Ze);break e;case 1:he=fe;var Ae=F.type,ke=F.stateNode;if((F.flags&128)===0&&(typeof Ae.getDerivedStateFromError=="function"||ke!==null&&typeof ke.componentDidCatch=="function"&&(wc===null||!wc.has(ke)))){F.flags|=65536,I&=-I,F.lanes|=I;var Qe=nN(F,he,I);BB(F,Qe);break e}}F=F.return}while(F!==null)}XN(y)}catch(Ct){I=Ct,ys===y&&y!==null&&(ys=y=y.return);continue}break}while(!0)}function _N(){var g=GI.current;return GI.current=yI,g===null?yI:g}function lb(){(Ws===0||Ws===3||Ws===2)&&(Ws=4),Ms===null||(Pd&268435455)===0&&(BI&268435455)===0||Bc(Ms,Qs)}function _I(g,I){var y=gn;gn|=2;var N=_N();(Ms!==g||Qs!==I)&&(pl=null,Od(g,I));do try{jD();break}catch(J){VN(g,J)}while(!0);if(yA(),gn=y,GI.current=N,ys!==null)throw Error(t(261));return Ms=null,Qs=0,Ws}function jD(){for(;ys!==null;)jN(ys)}function XD(){for(;ys!==null&&!vd();)jN(ys)}function jN(g){var I=FN(g.alternate,g,fi);g.memoizedProps=g.pendingProps,I===null?XN(g):ys=I,$A.current=null}function XN(g){var I=g;do{var y=I.alternate;if(g=I.return,(I.flags&32768)===0){if(y=BD(y,I,fi),y!==null){ys=y;return}}else{if(y=ND(y,I),y!==null){y.flags&=32767,ys=y;return}if(g!==null)g.flags|=32768,g.subtreeFlags=0,g.deletions=null;else{Ws=6,ys=null;return}}if(I=I.sibling,I!==null){ys=I;return}ys=I=g}while(I!==null);Ws===0&&(Ws=5)}function zd(g,I,y){var N=zt,J=Qi.transition;try{Qi.transition=null,zt=1,JD(g,I,y,N)}finally{Qi.transition=J,zt=N}return null}function JD(g,I,y,N){do qg();while(Zc!==null);if((gn&6)!==0)throw Error(t(327));y=g.finishedWork;var J=g.finishedLanes;if(y===null)return null;if(g.finishedWork=null,g.finishedLanes=0,y===g.current)throw Error(t(177));g.callbackNode=null,g.callbackPriority=0;var F=y.lanes|y.childLanes;if(Fn(g,F),g===Ms&&(ys=Ms=null,Qs=0),(y.subtreeFlags&2064)===0&&(y.flags&2064)===0||kI||(kI=!0,MN(Oa,function(){return qg(),null})),F=(y.flags&15990)!==0,(y.subtreeFlags&15990)!==0||F){F=Qi.transition,Qi.transition=null;var Q=zt;zt=1;var he=gn;gn|=4,$A.current=null,RD(g,y),ZN(y,g),C(St),xa=!!tt,St=tt=null,g.current=y,WD(y),Ka(),gn=he,zt=Q,Qi.transition=F}else g.current=y;if(kI&&(kI=!1,Zc=g,RI=J),F=g.pendingLanes,F===0&&(wc=null),pa(y.stateNode),Or(g,jn()),I!==null)for(N=g.onRecoverableError,y=0;y<I.length;y++)J=I[y],N(J.value,{componentStack:J.stack,digest:J.digest});if(NI)throw NI=!1,g=nb,nb=null,g;return(RI&1)!==0&&g.tag!==0&&qg(),F=g.pendingLanes,(F&1)!==0?g===sb?wh++:(wh=0,sb=g):wh=0,yc(),null}function qg(){if(Zc!==null){var g=Ji(RI),I=Qi.transition,y=zt;try{if(Qi.transition=null,zt=16>g?16:g,Zc===null)var N=!1;else{if(g=Zc,Zc=null,RI=0,(gn&6)!==0)throw Error(t(331));var J=gn;for(gn|=4,dt=g.current;dt!==null;){var F=dt,Q=F.child;if((dt.flags&16)!==0){var he=F.deletions;if(he!==null){for(var fe=0;fe<he.length;fe++){var Ve=he[fe];for(dt=Ve;dt!==null;){var Ke=dt;switch(Ke.tag){case 0:case 11:case 15:vh(8,Ke,F)}var Ue=Ke.child;if(Ue!==null)Ue.return=Ke,dt=Ue;else for(;dt!==null;){Ke=dt;var Pe=Ke.sibling,at=Ke.return;if(yN(Ke),Ke===Ve){dt=null;break}if(Pe!==null){Pe.return=at,dt=Pe;break}dt=at}}}var ut=F.alternate;if(ut!==null){var mt=ut.child;if(mt!==null){ut.child=null;do{var cs=mt.sibling;mt.sibling=null,mt=cs}while(mt!==null)}}dt=F}}if((F.subtreeFlags&2064)!==0&&Q!==null)Q.return=F,dt=Q;else e:for(;dt!==null;){if(F=dt,(F.flags&2048)!==0)switch(F.tag){case 0:case 11:case 15:vh(9,F,F.return)}var Ze=F.sibling;if(Ze!==null){Ze.return=F.return,dt=Ze;break e}dt=F.return}}var Ae=g.current;for(dt=Ae;dt!==null;){Q=dt;var ke=Q.child;if((Q.subtreeFlags&2064)!==0&&ke!==null)ke.return=Q,dt=ke;else e:for(Q=Ae;dt!==null;){if(he=dt,(he.flags&2048)!==0)try{switch(he.tag){case 0:case 11:case 15:ZI(9,he)}}catch(Ct){as(he,he.return,Ct)}if(he===Q){dt=null;break e}var Qe=he.sibling;if(Qe!==null){Qe.return=he.return,dt=Qe;break e}dt=he.return}}if(gn=J,yc(),Es&&typeof Es.onPostCommitFiberRoot=="function")try{Es.onPostCommitFiberRoot(fa,g)}catch{}N=!0}return N}finally{zt=y,Qi.transition=I}}return!1}function JN(g,I,y){I=Og(y,I),I=tN(g,I,1),g=xc(g,I,1),I=Nr(),g!==null&&(Ds(g,1,I),Or(g,I))}function as(g,I,y){if(g.tag===3)JN(g,g,y);else for(;I!==null;){if(I.tag===3){JN(I,g,y);break}else if(I.tag===1){var N=I.stateNode;if(typeof I.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(wc===null||!wc.has(N))){g=Og(y,g),g=nN(I,g,1),I=xc(I,g,1),g=Nr(),I!==null&&(Ds(I,1,g),Or(I,g));break}}I=I.return}}function YD(g,I,y){var N=g.pingCache;N!==null&&N.delete(I),I=Nr(),g.pingedLanes|=g.suspendedLanes&y,Ms===g&&(Qs&y)===y&&(Ws===4||Ws===3&&(Qs&130023424)===Qs&&500>jn()-tb?Od(g,0):eb|=y),Or(g,I)}function YN(g,I){I===0&&((g.mode&1)===0?I=1:(I=ji,ji<<=1,(ji&130023424)===0&&(ji=4194304)));var y=Nr();g=Il(g,I),g!==null&&(Ds(g,I,y),Or(g,y))}function FD(g){var I=g.memoizedState,y=0;I!==null&&(y=I.retryLane),YN(g,y)}function MD(g,I){var y=0;switch(g.tag){case 13:var N=g.stateNode,J=g.memoizedState;J!==null&&(y=J.retryLane);break;case 19:N=g.stateNode;break;default:throw Error(t(314))}N!==null&&N.delete(I),YN(g,y)}var FN;FN=function(g,I,y){if(g!==null)if(g.memoizedProps!==I.pendingProps||Dr.current)Pr=!0;else{if((g.lanes&y)===0&&(I.flags&128)===0)return Pr=!1,GD(g,I,y);Pr=(g.flags&131072)!==0}else Pr=!1,Un&&(I.flags&1048576)!==0&&pB(I,cI,I.index);switch(I.lanes=0,I.tag){case 2:var N=I.type;SI(g,I),g=I.pendingProps;var J=Mg(I,or.current);Pg(I,y),J=WA(null,I,N,g,J,y);var F=VA();return I.flags|=1,typeof J=="object"&&J!==null&&typeof J.render=="function"&&J.$$typeof===void 0?(I.tag=1,I.memoizedState=null,I.updateQueue=null,Lr(N)?(F=!0,aI(I)):F=!1,I.memoizedState=J.state!==null&&J.state!==void 0?J.state:null,wA(I),J.updater=vI,I.stateNode=J,J._reactInternals=I,FA(I,N,g,y),I=EA(null,I,N,!0,F,y)):(I.tag=0,Un&&F&&IA(I),Br(null,I,J,y),I=I.child),I;case 16:N=I.elementType;e:{switch(SI(g,I),g=I.pendingProps,J=N._init,N=J(N._payload),I.type=N,J=I.tag=TD(N),g=Na(N,g),J){case 0:I=TA(null,I,N,g,y);break e;case 1:I=gN(null,I,N,g,y);break e;case 11:I=aN(null,I,N,g,y);break e;case 14:I=oN(null,I,N,Na(N.type,g),y);break e}throw Error(t(306,N,""))}return I;case 0:return N=I.type,J=I.pendingProps,J=I.elementType===N?J:Na(N,J),TA(g,I,N,J,y);case 1:return N=I.type,J=I.pendingProps,J=I.elementType===N?J:Na(N,J),gN(g,I,N,J,y);case 3:e:{if(uN(I),g===null)throw Error(t(387));N=I.pendingProps,F=I.memoizedState,J=F.element,GB(g,I),II(I,N,null,y);var Q=I.memoizedState;if(N=Q.element,F.isDehydrated)if(F={element:N,isDehydrated:!1,cache:Q.cache,pendingSuspenseBoundaries:Q.pendingSuspenseBoundaries,transitions:Q.transitions},I.updateQueue.baseState=F,I.memoizedState=F,I.flags&256){J=Og(Error(t(423)),I),I=hN(g,I,N,y,J);break e}else if(N!==J){J=Og(Error(t(424)),I),I=hN(g,I,N,y,J);break e}else for(Ci=fo(I.stateNode.containerInfo.firstChild),Ii=I,Un=!0,Ba=null,y=wB(I,null,N,y),I.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Eg(),N===J){I=fl(g,I,y);break e}Br(g,I,N,y)}I=I.child}return I;case 5:return kB(I),g===null&&pA(I),N=I.type,J=I.pendingProps,F=g!==null?g.memoizedProps:null,Q=J.children,Lt(N,J)?Q=null:F!==null&&Lt(N,F)&&(I.flags|=32),dN(g,I),Br(g,I,Q,y),I.child;case 6:return g===null&&pA(I),null;case 13:return mN(g,I,y);case 4:return ZA(I,I.stateNode.containerInfo),N=I.pendingProps,g===null?I.child=Dg(I,null,N,y):Br(g,I,N,y),I.child;case 11:return N=I.type,J=I.pendingProps,J=I.elementType===N?J:Na(N,J),aN(g,I,N,J,y);case 7:return Br(g,I,I.pendingProps,y),I.child;case 8:return Br(g,I,I.pendingProps.children,y),I.child;case 12:return Br(g,I,I.pendingProps.children,y),I.child;case 10:e:{if(N=I.type._context,J=I.pendingProps,F=I.memoizedProps,Q=J.value,Mn(uI,N._currentValue),N._currentValue=Q,F!==null)if(zs(F.value,Q)){if(F.children===J.children&&!Dr.current){I=fl(g,I,y);break e}}else for(F=I.child,F!==null&&(F.return=I);F!==null;){var he=F.dependencies;if(he!==null){Q=F.child;for(var fe=he.firstContext;fe!==null;){if(fe.context===N){if(F.tag===1){fe=Cl(-1,y&-y),fe.tag=2;var Ve=F.updateQueue;if(Ve!==null){Ve=Ve.shared;var Ke=Ve.pending;Ke===null?fe.next=fe:(fe.next=Ke.next,Ke.next=fe),Ve.pending=fe}}F.lanes|=y,fe=F.alternate,fe!==null&&(fe.lanes|=y),xA(F.return,y,I),he.lanes|=y;break}fe=fe.next}}else if(F.tag===10)Q=F.type===I.type?null:F.child;else if(F.tag===18){if(Q=F.return,Q===null)throw Error(t(341));Q.lanes|=y,he=Q.alternate,he!==null&&(he.lanes|=y),xA(Q,y,I),Q=F.sibling}else Q=F.child;if(Q!==null)Q.return=F;else for(Q=F;Q!==null;){if(Q===I){Q=null;break}if(F=Q.sibling,F!==null){F.return=Q.return,Q=F;break}Q=Q.return}F=Q}Br(g,I,J.children,y),I=I.child}return I;case 9:return J=I.type,N=I.pendingProps.children,Pg(I,y),J=zi(J),N=N(J),I.flags|=1,Br(g,I,N,y),I.child;case 14:return N=I.type,J=Na(N,I.pendingProps),J=Na(N.type,J),oN(g,I,N,J,y);case 15:return lN(g,I,I.type,I.pendingProps,y);case 17:return N=I.type,J=I.pendingProps,J=I.elementType===N?J:Na(N,J),SI(g,I),I.tag=1,Lr(N)?(g=!0,aI(I)):g=!1,Pg(I,y),$B(I,N,J),FA(I,N,J,y),EA(null,I,N,!0,g,y);case 19:return CN(g,I,y);case 22:return cN(g,I,y)}throw Error(t(156,I.tag))};function MN(g,I){return Pl(g,I)}function HD(g,I,y,N){this.tag=g,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=I,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(g,I,y,N){return new HD(g,I,y,N)}function cb(g){return g=g.prototype,!(!g||!g.isReactComponent)}function TD(g){if(typeof g=="function")return cb(g)?1:0;if(g!=null){if(g=g.$$typeof,g===z)return 11;if(g===te)return 14}return 2}function Nc(g,I){var y=g.alternate;return y===null?(y=qi(g.tag,I,g.key,g.mode),y.elementType=g.elementType,y.type=g.type,y.stateNode=g.stateNode,y.alternate=g,g.alternate=y):(y.pendingProps=I,y.type=g.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=g.flags&14680064,y.childLanes=g.childLanes,y.lanes=g.lanes,y.child=g.child,y.memoizedProps=g.memoizedProps,y.memoizedState=g.memoizedState,y.updateQueue=g.updateQueue,I=g.dependencies,y.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext},y.sibling=g.sibling,y.index=g.index,y.ref=g.ref,y}function jI(g,I,y,N,J,F){var Q=2;if(N=g,typeof g=="function")cb(g)&&(Q=1);else if(typeof g=="string")Q=5;else e:switch(g){case Y:return Ud(y.children,J,F,I);case j:Q=8,J|=8;break;case M:return g=qi(12,y,I,J|2),g.elementType=M,g.lanes=F,g;case O:return g=qi(13,y,I,J),g.elementType=O,g.lanes=F,g;case E:return g=qi(19,y,I,J),g.elementType=E,g.lanes=F,g;case de:return XI(y,J,F,I);default:if(typeof g=="object"&&g!==null)switch(g.$$typeof){case H:Q=10;break e;case D:Q=9;break e;case z:Q=11;break e;case te:Q=14;break e;case q:Q=16,N=null;break e}throw Error(t(130,g==null?g:typeof g,""))}return I=qi(Q,y,I,J),I.elementType=g,I.type=N,I.lanes=F,I}function Ud(g,I,y,N){return g=qi(7,g,N,I),g.lanes=y,g}function XI(g,I,y,N){return g=qi(22,g,N,I),g.elementType=de,g.lanes=y,g.stateNode={isHidden:!1},g}function db(g,I,y){return g=qi(6,g,null,I),g.lanes=y,g}function gb(g,I,y){return I=qi(4,g.children!==null?g.children:[],g.key,I),I.lanes=y,I.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},I}function ED(g,I,y,N,J){this.tag=I,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xi(0),this.expirationTimes=Xi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xi(0),this.identifierPrefix=N,this.onRecoverableError=J,this.mutableSourceEagerHydrationData=null}function ub(g,I,y,N,J,F,Q,he,fe){return g=new ED(g,I,y,he,fe),I===1?(I=1,F===!0&&(I|=8)):I=0,F=qi(3,null,null,I),g.current=F,F.stateNode=g,F.memoizedState={element:N,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},wA(F),g}function DD(g,I,y){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_,key:N==null?null:""+N,children:g,containerInfo:I,implementation:y}}function HN(g){if(!g)return bc;g=g._reactInternals;e:{if(Yr(g)!==g||g.tag!==1)throw Error(t(170));var I=g;do{switch(I.tag){case 3:I=I.stateNode.context;break e;case 1:if(Lr(I.type)){I=I.stateNode.__reactInternalMemoizedMergedChildContext;break e}}I=I.return}while(I!==null);throw Error(t(171))}if(g.tag===1){var y=g.type;if(Lr(y))return IB(g,y,I)}return I}function TN(g,I,y,N,J,F,Q,he,fe){return g=ub(y,N,!0,g,J,F,Q,he,fe),g.context=HN(null),y=g.current,N=Nr(),J=Gc(y),F=Cl(N,J),F.callback=I??null,xc(y,F,J),g.current.lanes=J,Ds(g,J,N),Or(g,N),g}function JI(g,I,y,N){var J=I.current,F=Nr(),Q=Gc(J);return y=HN(y),I.context===null?I.context=y:I.pendingContext=y,I=Cl(F,Q),I.payload={element:g},N=N===void 0?null:N,N!==null&&(I.callback=N),g=xc(J,I,Q),g!==null&&(Wa(g,J,Q,F),mI(g,J,Q)),Q}function YI(g){if(g=g.current,!g.child)return null;switch(g.child.tag){case 5:return g.child.stateNode;default:return g.child.stateNode}}function EN(g,I){if(g=g.memoizedState,g!==null&&g.dehydrated!==null){var y=g.retryLane;g.retryLane=y!==0&&y<I?y:I}}function hb(g,I){EN(g,I),(g=g.alternate)&&EN(g,I)}function LD(){return null}var DN=typeof reportError=="function"?reportError:function(g){console.error(g)};function mb(g){this._internalRoot=g}FI.prototype.render=mb.prototype.render=function(g){var I=this._internalRoot;if(I===null)throw Error(t(409));JI(g,I,null,null)},FI.prototype.unmount=mb.prototype.unmount=function(){var g=this._internalRoot;if(g!==null){this._internalRoot=null;var I=g.containerInfo;Kd(function(){JI(null,g,null,null)}),I[xn]=null}};function FI(g){this._internalRoot=g}FI.prototype.unstable_scheduleHydration=function(g){if(g){var I=$a();g={blockedOn:null,target:g,priority:I};for(var y=0;y<qn.length&&I!==0&&I<qn[y].priority;y++);qn.splice(y,0,g),y===0&&eo(g)}};function Ib(g){return!(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)}function MI(g){return!(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11&&(g.nodeType!==8||g.nodeValue!==" react-mount-point-unstable "))}function LN(){}function PD(g,I,y,N,J){if(J){if(typeof N=="function"){var F=N;N=function(){var Ve=YI(Q);F.call(Ve)}}var Q=TN(I,N,g,0,null,!1,!1,"",LN);return g._reactRootContainer=Q,g[xn]=Q.current,Ic(g.nodeType===8?g.parentNode:g),Kd(),Q}for(;J=g.lastChild;)g.removeChild(J);if(typeof N=="function"){var he=N;N=function(){var Ve=YI(fe);he.call(Ve)}}var fe=ub(g,0,!1,null,null,!1,!1,"",LN);return g._reactRootContainer=fe,g[xn]=fe.current,Ic(g.nodeType===8?g.parentNode:g),Kd(function(){JI(I,fe,y,N)}),fe}function HI(g,I,y,N,J){var F=y._reactRootContainer;if(F){var Q=F;if(typeof J=="function"){var he=J;J=function(){var fe=YI(Q);he.call(fe)}}JI(I,Q,g,J)}else Q=PD(y,I,g,J,N);return YI(Q)}Qa=function(g){switch(g.tag){case 3:var I=g.stateNode;if(I.current.memoizedState.isDehydrated){var y=Nt(I.pendingLanes);y!==0&&(vr(I,y|1),Or(I,jn()),(gn&6)===0&&(Qg=jn()+500,yc()))}break;case 13:Kd(function(){var N=Il(g,1);if(N!==null){var J=Nr();Wa(N,g,1,J)}}),hb(g,1)}},oi=function(g){if(g.tag===13){var I=Il(g,134217728);if(I!==null){var y=Nr();Wa(I,g,134217728,y)}hb(g,134217728)}},qa=function(g){if(g.tag===13){var I=Gc(g),y=Il(g,I);if(y!==null){var N=Nr();Wa(y,g,I,N)}hb(g,I)}},$a=function(){return zt},Aa=function(g,I){var y=zt;try{return zt=g,I()}finally{zt=y}},Ft=function(g,I,y){switch(I){case"input":if(Le(g,y),I=y.name,y.type==="radio"&&I!=null){for(y=g;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+I)+'][type="radio"]'),I=0;I<y.length;I++){var N=y[I];if(N!==g&&N.form===g.form){var J=Yg(N);if(!J)throw Error(t(90));Se(N),Le(N,J)}}}break;case"textarea":Ge(g,y);break;case"select":I=y.value,I!=null&&oe(g,!!y.multiple,I,!1)}},br=ab,Ia=Kd;var KD={usingClientEntryPoint:!1,Events:[dl,gl,Yg,ls,Cs,ab]},Zh={findFiberByHostInstance:cl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},OD={bundleType:Zh.bundleType,version:Zh.version,rendererPackageName:Zh.rendererPackageName,rendererConfig:Zh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(g){return g=Dl(g),g===null?null:g.stateNode},findFiberByHostInstance:Zh.findFiberByHostInstance||LD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var TI=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!TI.isDisabled&&TI.supportsFiber)try{fa=TI.inject(OD),Es=TI}catch{}}return zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KD,zr.createPortal=function(g,I){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ib(I))throw Error(t(200));return DD(g,I,null,y)},zr.createRoot=function(g,I){if(!Ib(g))throw Error(t(299));var y=!1,N="",J=DN;return I!=null&&(I.unstable_strictMode===!0&&(y=!0),I.identifierPrefix!==void 0&&(N=I.identifierPrefix),I.onRecoverableError!==void 0&&(J=I.onRecoverableError)),I=ub(g,1,!1,null,null,y,!1,N,J),g[xn]=I.current,Ic(g.nodeType===8?g.parentNode:g),new mb(I)},zr.findDOMNode=function(g){if(g==null)return null;if(g.nodeType===1)return g;var I=g._reactInternals;if(I===void 0)throw typeof g.render=="function"?Error(t(188)):(g=Object.keys(g).join(","),Error(t(268,g)));return g=Dl(I),g=g===null?null:g.stateNode,g},zr.flushSync=function(g){return Kd(g)},zr.hydrate=function(g,I,y){if(!MI(I))throw Error(t(200));return HI(null,g,I,!0,y)},zr.hydrateRoot=function(g,I,y){if(!Ib(g))throw Error(t(405));var N=y!=null&&y.hydratedSources||null,J=!1,F="",Q=DN;if(y!=null&&(y.unstable_strictMode===!0&&(J=!0),y.identifierPrefix!==void 0&&(F=y.identifierPrefix),y.onRecoverableError!==void 0&&(Q=y.onRecoverableError)),I=TN(I,null,g,1,y??null,J,!1,F,Q),g[xn]=I.current,Ic(g),N)for(g=0;g<N.length;g++)y=N[g],J=y._getVersion,J=J(y._source),I.mutableSourceEagerHydrationData==null?I.mutableSourceEagerHydrationData=[y,J]:I.mutableSourceEagerHydrationData.push(y,J);return new FI(I)},zr.render=function(g,I,y){if(!MI(I))throw Error(t(200));return HI(null,g,I,!1,y)},zr.unmountComponentAtNode=function(g){if(!MI(g))throw Error(t(40));return g._reactRootContainer?(Kd(function(){HI(null,null,g,!1,function(){g._reactRootContainer=null,g[xn]=null})}),!0):!1},zr.unstable_batchedUpdates=ab,zr.unstable_renderSubtreeIntoContainer=function(g,I,y,N){if(!MI(y))throw Error(t(200));if(g==null||g._reactInternals===void 0)throw Error(t(38));return HI(g,I,y,!1,N)},zr.version="18.3.1-next-f1338f8080-20240426",zr}var $N;function gF(){if($N)return pb.exports;$N=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),pb.exports=t5(),pb.exports}var ek;function n5(){if(ek)return EI;ek=1;var n=gF();return EI.createRoot=n.createRoot,EI.hydrateRoot=n.hydrateRoot,EI}var s5=n5();const r5=rd(s5);var uF=gF();function fm(){return fm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},fm.apply(this,arguments)}var Dc;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Dc||(Dc={}));const tk="popstate";function i5(n){n===void 0&&(n={});function e(i,a){let{pathname:o="/",search:l="",hash:c=""}=Gg(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),vw("",{pathname:o,search:l,hash:c},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){let o=i.document.querySelector("base"),l="";if(o&&o.getAttribute("href")){let c=i.location.href,d=c.indexOf("#");l=d===-1?c:c.slice(0,d)}return l+"#"+(typeof a=="string"?a:Rf(a))}function s(i,a){dp(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return o5(e,t,s,n)}function is(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function dp(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function a5(){return Math.random().toString(36).substr(2,8)}function nk(n,e){return{usr:n.state,key:n.key,idx:e}}function vw(n,e,t,s){return t===void 0&&(t=null),fm({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Gg(e):e,{state:t,key:e&&e.key||s||a5()})}function Rf(n){let{pathname:e="/",search:t="",hash:s=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Gg(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substr(s),n=n.substr(0,s)),n&&(e.pathname=n)}return e}function o5(n,e,t,s){s===void 0&&(s={});let{window:i=document.defaultView,v5Compat:a=!1}=s,o=i.history,l=Dc.Pop,c=null,d=h();d==null&&(d=0,o.replaceState(fm({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function m(){l=Dc.Pop;let v=h(),S=v==null?null:v-d;d=v,c&&c({action:l,location:x.location,delta:S})}function f(v,S){l=Dc.Push;let B=vw(x.location,v,S);t&&t(B,v),d=h()+1;let V=nk(B,d),R=x.createHref(B);try{o.pushState(V,"",R)}catch(W){if(W instanceof DOMException&&W.name==="DataCloneError")throw W;i.location.assign(R)}a&&c&&c({action:l,location:x.location,delta:1})}function p(v,S){l=Dc.Replace;let B=vw(x.location,v,S);t&&t(B,v),d=h();let V=nk(B,d),R=x.createHref(B);o.replaceState(V,"",R),a&&c&&c({action:l,location:x.location,delta:0})}function b(v){let S=i.location.origin!=="null"?i.location.origin:i.location.href,B=typeof v=="string"?v:Rf(v);return B=B.replace(/ $/,"%20"),is(S,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,S)}let x={get action(){return l},get location(){return n(i,o)},listen(v){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(tk,m),c=v,()=>{i.removeEventListener(tk,m),c=null}},createHref(v){return e(i,v)},createURL:b,encodeLocation(v){let S=b(v);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:f,replace:p,go(v){return o.go(v)}};return x}var sk;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(sk||(sk={}));function l5(n,e,t){return t===void 0&&(t="/"),c5(n,e,t)}function c5(n,e,t,s){let i=typeof e=="string"?Gg(e):e,a=Bu(i.pathname||"/",t);if(a==null)return null;let o=hF(n);d5(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=y5(a);l=A5(o[c],d)}return l}function hF(n,e,t,s){e===void 0&&(e=[]),t===void 0&&(t=[]),s===void 0&&(s="");let i=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(is(c.relativePath.startsWith(s),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(s.length));let d=zc([s,c.relativePath]),h=t.concat(c);a.children&&a.children.length>0&&(is(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),hF(a.children,e,h,d)),!(a.path==null&&!a.index)&&e.push({path:d,score:f5(d,a.index),routesMeta:h})};return n.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let c of mF(a.path))i(a,o,c)}),e}function mF(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(s.length===0)return i?[a,""]:[a];let o=mF(s.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>n.startsWith("/")&&c===""?"/":c)}function d5(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:p5(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}const g5=/^:[\w-]+$/,u5=3,h5=2,m5=1,I5=10,C5=-2,rk=n=>n==="*";function f5(n,e){let t=n.split("/"),s=t.length;return t.some(rk)&&(s+=C5),e&&(s+=h5),t.filter(i=>!rk(i)).reduce((i,a)=>i+(g5.test(a)?u5:a===""?m5:I5),s)}function p5(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function A5(n,e,t){let{routesMeta:s}=n,i={},a="/",o=[];for(let l=0;l<s.length;++l){let c=s[l],d=l===s.length-1,h=a==="/"?e:e.slice(a.length)||"/",m=xw({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),f=c.route;if(!m)return null;Object.assign(i,m.params),o.push({params:i,pathname:zc([a,m.pathname]),pathnameBase:Z5(zc([a,m.pathnameBase])),route:f}),m.pathnameBase!=="/"&&(a=zc([a,m.pathnameBase]))}return o}function xw(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=b5(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:s.reduce((d,h,m)=>{let{paramName:f,isOptional:p}=h;if(f==="*"){let x=l[m]||"";o=a.slice(0,a.length-x.length).replace(/(.)\/+$/,"$1")}const b=l[m];return p&&!b?d[f]=void 0:d[f]=(b||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:o,pattern:n}}function b5(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),dp(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(s.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function y5(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dp(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Bu(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}const v5=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,x5=n=>v5.test(n);function S5(n,e){e===void 0&&(e="/");let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?Gg(n):n,a;if(t)if(x5(t))a=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),dp(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?a=ik(t.substring(1),"/"):a=ik(t,e)}else a=e;return{pathname:a,search:G5(s),hash:B5(i)}}function ik(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function yb(n,e,t,s){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function w5(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function FZ(n,e){let t=w5(n);return e?t.map((s,i)=>i===t.length-1?s.pathname:s.pathnameBase):t.map(s=>s.pathnameBase)}function MZ(n,e,t,s){s===void 0&&(s=!1);let i;typeof n=="string"?i=Gg(n):(i=fm({},n),is(!i.pathname||!i.pathname.includes("?"),yb("?","pathname","search",i)),is(!i.pathname||!i.pathname.includes("#"),yb("#","pathname","hash",i)),is(!i.search||!i.search.includes("#"),yb("#","search","hash",i)));let a=n===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=t;else{let m=e.length-1;if(!s&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),m-=1;i.pathname=f.join("/")}l=m>=0?e[m]:"/"}let c=S5(i,l),d=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const zc=n=>n.join("/").replace(/\/\/+/g,"/"),Z5=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),G5=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,B5=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function N5(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const IF=["post","put","patch","delete"];new Set(IF);const k5=["get",...IF];new Set(k5);function pm(){return pm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},pm.apply(this,arguments)}const gp=k.createContext(null),CF=k.createContext(null),Yl=k.createContext(null),up=k.createContext(null),Xo=k.createContext({outlet:null,matches:[],isDataRoute:!1}),fF=k.createContext(null);function R5(n,e){let{relative:t}=e===void 0?{}:e;Qu()||is(!1);let{basename:s,navigator:i}=k.useContext(Yl),{hash:a,pathname:o,search:l}=hp(n,{relative:t}),c=o;return s!=="/"&&(c=o==="/"?s:zc([s,o])),i.createHref({pathname:c,search:l,hash:a})}function Qu(){return k.useContext(up)!=null}function er(){return Qu()||is(!1),k.useContext(up).location}function pF(n){k.useContext(Yl).static||k.useLayoutEffect(n)}function vt(){let{isDataRoute:n}=k.useContext(Xo);return n?L5():W5()}function W5(){Qu()||is(!1);let n=k.useContext(gp),{basename:e,future:t,navigator:s}=k.useContext(Yl),{matches:i}=k.useContext(Xo),{pathname:a}=er(),o=JSON.stringify(FZ(i,t.v7_relativeSplatPath)),l=k.useRef(!1);return pF(()=>{l.current=!0}),k.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){s.go(d);return}let m=MZ(d,JSON.parse(o),a,h.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:zc([e,m.pathname])),(h.replace?s.replace:s.push)(m,h.state,h)},[e,s,o,a,n])}const AF=k.createContext(null);function ki(){return k.useContext(AF)}function V5(n){let e=k.useContext(Xo).outlet;return e&&k.createElement(AF.Provider,{value:n},e)}function Bg(){let{matches:n}=k.useContext(Xo),e=n[n.length-1];return e?e.params:{}}function hp(n,e){let{relative:t}=e===void 0?{}:e,{future:s}=k.useContext(Yl),{matches:i}=k.useContext(Xo),{pathname:a}=er(),o=JSON.stringify(FZ(i,s.v7_relativeSplatPath));return k.useMemo(()=>MZ(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function _5(n,e){return j5(n,e)}function j5(n,e,t,s){Qu()||is(!1);let{navigator:i}=k.useContext(Yl),{matches:a}=k.useContext(Xo),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=er(),h;if(e){var m;let v=typeof e=="string"?Gg(e):e;c==="/"||(m=v.pathname)!=null&&m.startsWith(c)||is(!1),h=v}else h=d;let f=h.pathname||"/",p=f;if(c!=="/"){let v=c.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(v.length).join("/")}let b=l5(n,{pathname:p}),x=M5(b&&b.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:zc([c,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:zc([c,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),a,t,s);return e&&x?k.createElement(up.Provider,{value:{location:pm({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Dc.Pop}},x):x}function X5(){let n=D5(),e=N5(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),t?k.createElement("pre",{style:i},t):null,null)}const J5=k.createElement(X5,null);class Y5 extends k.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?k.createElement(Xo.Provider,{value:this.props.routeContext},k.createElement(fF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function F5(n){let{routeContext:e,match:t,children:s}=n,i=k.useContext(gp);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),k.createElement(Xo.Provider,{value:e},s)}function M5(n,e,t,s){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),s===void 0&&(s=null),n==null){var a;if(!t)return null;if(t.errors)n=t.matches;else if((a=s)!=null&&a.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,l=(i=t)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(m=>m.route.id&&l?.[m.route.id]!==void 0);h>=0||is(!1),o=o.slice(0,Math.min(o.length,h+1))}let c=!1,d=-1;if(t&&s&&s.v7_partialHydration)for(let h=0;h<o.length;h++){let m=o[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:f,errors:p}=t,b=m.route.loader&&f[m.route.id]===void 0&&(!p||p[m.route.id]===void 0);if(m.route.lazy||b){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,m,f)=>{let p,b=!1,x=null,v=null;t&&(p=l&&m.route.id?l[m.route.id]:void 0,x=m.route.errorElement||J5,c&&(d<0&&f===0?(P5("route-fallback"),b=!0,v=null):d===f&&(b=!0,v=m.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,f+1)),B=()=>{let V;return p?V=x:b?V=v:m.route.Component?V=k.createElement(m.route.Component,null):m.route.element?V=m.route.element:V=h,k.createElement(F5,{match:m,routeContext:{outlet:h,matches:S,isDataRoute:t!=null},children:V})};return t&&(m.route.ErrorBoundary||m.route.errorElement||f===0)?k.createElement(Y5,{location:t.location,revalidation:t.revalidation,component:x,error:p,children:B(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):B()},null)}var bF=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(bF||{}),yF=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(yF||{});function H5(n){let e=k.useContext(gp);return e||is(!1),e}function T5(n){let e=k.useContext(CF);return e||is(!1),e}function E5(n){let e=k.useContext(Xo);return e||is(!1),e}function vF(n){let e=E5(),t=e.matches[e.matches.length-1];return t.route.id||is(!1),t.route.id}function D5(){var n;let e=k.useContext(fF),t=T5(),s=vF();return e!==void 0?e:(n=t.errors)==null?void 0:n[s]}function L5(){let{router:n}=H5(bF.UseNavigateStable),e=vF(yF.UseNavigateStable),t=k.useRef(!1);return pF(()=>{t.current=!0}),k.useCallback(function(i,a){a===void 0&&(a={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,pm({fromRouteId:e},a)))},[n,e])}const ak={};function P5(n,e,t){ak[n]||(ak[n]=!0)}function K5(n,e){n?.v7_startTransition,n?.v7_relativeSplatPath}function Bl(n){let{to:e,replace:t,state:s,relative:i}=n;Qu()||is(!1);let{future:a,static:o}=k.useContext(Yl),{matches:l}=k.useContext(Xo),{pathname:c}=er(),d=vt(),h=MZ(e,FZ(l,a.v7_relativeSplatPath),c,i==="path"),m=JSON.stringify(h);return k.useEffect(()=>d(JSON.parse(m),{replace:t,state:s,relative:i}),[d,m,i,t,s]),null}function Nu(n){return V5(n.context)}function Te(n){is(!1)}function O5(n){let{basename:e="/",children:t=null,location:s,navigationType:i=Dc.Pop,navigator:a,static:o=!1,future:l}=n;Qu()&&is(!1);let c=e.replace(/^\/*/,"/"),d=k.useMemo(()=>({basename:c,navigator:a,static:o,future:pm({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof s=="string"&&(s=Gg(s));let{pathname:h="/",search:m="",hash:f="",state:p=null,key:b="default"}=s,x=k.useMemo(()=>{let v=Bu(h,c);return v==null?null:{location:{pathname:v,search:m,hash:f,state:p,key:b},navigationType:i}},[c,h,m,f,p,b,i]);return x==null?null:k.createElement(Yl.Provider,{value:d},k.createElement(up.Provider,{children:t,value:x}))}function z5(n){let{children:e,location:t}=n;return _5(Sw(e),t)}new Promise(()=>{});function Sw(n,e){e===void 0&&(e=[]);let t=[];return k.Children.forEach(n,(s,i)=>{if(!k.isValidElement(s))return;let a=[...e,i];if(s.type===k.Fragment){t.push.apply(t,Sw(s.props.children,a));return}s.type!==Te&&is(!1),!s.props.index||!s.props.children||is(!1);let o={id:s.props.id||a.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(o.children=Sw(s.props.children,a)),t.push(o)}),t}function Wf(){return Wf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Wf.apply(this,arguments)}function xF(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,a;for(a=0;a<s.length;a++)i=s[a],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function U5(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Q5(n,e){return n.button===0&&(!e||e==="_self")&&!U5(n)}function ww(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let s=n[t];return e.concat(Array.isArray(s)?s.map(i=>[t,i]):[[t,s]])},[]))}function q5(n,e){let t=ww(n);return e&&e.forEach((s,i)=>{t.has(i)||e.getAll(i).forEach(a=>{t.append(i,a)})}),t}const $5=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],e9=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],t9="6";try{window.__reactRouterVersion=t9}catch{}const n9=k.createContext({isTransitioning:!1}),s9="startTransition",ok=qD[s9];function r9(n){let{basename:e,children:t,future:s,window:i}=n,a=k.useRef();a.current==null&&(a.current=i5({window:i,v5Compat:!0}));let o=a.current,[l,c]=k.useState({action:o.action,location:o.location}),{v7_startTransition:d}=s||{},h=k.useCallback(m=>{d&&ok?ok(()=>c(m)):c(m)},[c,d]);return k.useLayoutEffect(()=>o.listen(h),[o,h]),k.useEffect(()=>K5(s),[s]),k.createElement(O5,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:o,future:s})}const i9=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",a9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,aa=k.forwardRef(function(e,t){let{onClick:s,relative:i,reloadDocument:a,replace:o,state:l,target:c,to:d,preventScrollReset:h,viewTransition:m}=e,f=xF(e,$5),{basename:p}=k.useContext(Yl),b,x=!1;if(typeof d=="string"&&a9.test(d)&&(b=d,i9))try{let V=new URL(window.location.href),R=d.startsWith("//")?new URL(V.protocol+d):new URL(d),W=Bu(R.pathname,p);R.origin===V.origin&&W!=null?d=W+R.search+R.hash:x=!0}catch{}let v=R5(d,{relative:i}),S=l9(d,{replace:o,state:l,target:c,preventScrollReset:h,relative:i,viewTransition:m});function B(V){s&&s(V),V.defaultPrevented||S(V)}return k.createElement("a",Wf({},f,{href:b||v,onClick:x||a?s:B,ref:t,target:c}))}),SF=k.forwardRef(function(e,t){let{"aria-current":s="page",caseSensitive:i=!1,className:a="",end:o=!1,style:l,to:c,viewTransition:d,children:h}=e,m=xF(e,e9),f=hp(c,{relative:m.relative}),p=er(),b=k.useContext(CF),{navigator:x,basename:v}=k.useContext(Yl),S=b!=null&&c9(f)&&d===!0,B=x.encodeLocation?x.encodeLocation(f).pathname:f.pathname,V=p.pathname,R=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;i||(V=V.toLowerCase(),R=R?R.toLowerCase():null,B=B.toLowerCase()),R&&v&&(R=Bu(R,v)||R);const W=B!=="/"&&B.endsWith("/")?B.length-1:B.length;let _=V===B||!o&&V.startsWith(B)&&V.charAt(W)==="/",Y=R!=null&&(R===B||!o&&R.startsWith(B)&&R.charAt(B.length)==="/"),j={isActive:_,isPending:Y,isTransitioning:S},M=_?s:void 0,H;typeof a=="function"?H=a(j):H=[a,_?"active":null,Y?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let D=typeof l=="function"?l(j):l;return k.createElement(aa,Wf({},m,{"aria-current":M,className:H,ref:t,style:D,to:c,viewTransition:d}),typeof h=="function"?h(j):h)});var Zw;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Zw||(Zw={}));var lk;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(lk||(lk={}));function o9(n){let e=k.useContext(gp);return e||is(!1),e}function l9(n,e){let{target:t,replace:s,state:i,preventScrollReset:a,relative:o,viewTransition:l}=e===void 0?{}:e,c=vt(),d=er(),h=hp(n,{relative:o});return k.useCallback(m=>{if(Q5(m,t)){m.preventDefault();let f=s!==void 0?s:Rf(d)===Rf(h);c(n,{replace:f,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[d,c,h,s,i,t,n,a,o,l])}function wF(n){let e=k.useRef(ww(n)),t=k.useRef(!1),s=er(),i=k.useMemo(()=>q5(s.search,t.current?null:e.current),[s.search]),a=vt(),o=k.useCallback((l,c)=>{const d=ww(typeof l=="function"?l(i):l);t.current=!0,a("?"+d,c)},[a,i]);return[i,o]}function c9(n,e){e===void 0&&(e={});let t=k.useContext(n9);t==null&&is(!1);let{basename:s}=o9(Zw.useViewTransitionState),i=hp(n,{relative:e.relative});if(!t.isTransitioning)return!1;let a=Bu(t.currentLocation.pathname,s)||t.currentLocation.pathname,o=Bu(t.nextLocation.pathname,s)||t.nextLocation.pathname;return xw(i.pathname,o)!=null||xw(i.pathname,a)!=null}const d9={},ck=n=>{let e;const t=new Set,s=(h,m)=>{const f=typeof h=="function"?h(e):h;if(!Object.is(f,e)){const p=e;e=m??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(b=>b(e,p))}},i=()=>e,c={setState:s,getState:i,getInitialState:()=>d,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{(d9?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},d=e=n(s,i,c);return c},g9=n=>n?ck(n):ck;var vb={exports:{}},xb={},Sb={exports:{}},wb={};var dk;function u9(){if(dk)return wb;dk=1;var n=Ar();function e(m,f){return m===f&&(m!==0||1/m===1/f)||m!==m&&f!==f}var t=typeof Object.is=="function"?Object.is:e,s=n.useState,i=n.useEffect,a=n.useLayoutEffect,o=n.useDebugValue;function l(m,f){var p=f(),b=s({inst:{value:p,getSnapshot:f}}),x=b[0].inst,v=b[1];return a(function(){x.value=p,x.getSnapshot=f,c(x)&&v({inst:x})},[m,p,f]),i(function(){return c(x)&&v({inst:x}),m(function(){c(x)&&v({inst:x})})},[m]),o(p),p}function c(m){var f=m.getSnapshot;m=m.value;try{var p=f();return!t(m,p)}catch{return!0}}function d(m,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return wb.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:h,wb}var gk;function h9(){return gk||(gk=1,Sb.exports=u9()),Sb.exports}var uk;function m9(){if(uk)return xb;uk=1;var n=Ar(),e=h9();function t(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var s=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,a=n.useRef,o=n.useEffect,l=n.useMemo,c=n.useDebugValue;return xb.useSyncExternalStoreWithSelector=function(d,h,m,f,p){var b=a(null);if(b.current===null){var x={hasValue:!1,value:null};b.current=x}else x=b.current;b=l(function(){function S(_){if(!B){if(B=!0,V=_,_=f(_),p!==void 0&&x.hasValue){var Y=x.value;if(p(Y,_))return R=Y}return R=_}if(Y=R,s(V,_))return Y;var j=f(_);return p!==void 0&&p(Y,j)?(V=_,Y):(V=_,R=j)}var B=!1,V,R,W=m===void 0?null:m;return[function(){return S(h())},W===null?void 0:function(){return S(W())}]},[h,m,f,p]);var v=i(d,b[0],b[1]);return o(function(){x.hasValue=!0,x.value=v},[v]),c(v),v},xb}var hk;function I9(){return hk||(hk=1,vb.exports=m9()),vb.exports}var C9=I9();const f9=rd(C9),ZF={},{useDebugValue:p9}=ot,{useSyncExternalStoreWithSelector:A9}=f9;let mk=!1;const b9=n=>n;function y9(n,e=b9,t){(ZF?"production":void 0)!=="production"&&t&&!mk&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),mk=!0);const s=A9(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return p9(s),s}const Ik=n=>{(ZF?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?g9(n):n,t=(s,i)=>y9(e,s,i);return Object.assign(t,e),t},ga=n=>n?Ik(n):Ik;var Gw=function(n,e){return Gw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])},Gw(n,e)};function HZ(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Gw(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vs=function(){return vs=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++){t=arguments[s];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},vs.apply(this,arguments)};function qu(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t}function GF(n,e,t,s){var i=arguments.length,a=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,t):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,e,t,s);else for(var l=n.length-1;l>=0;l--)(o=n[l])&&(a=(i<3?o(a):i>3?o(e,t,a):o(e,t))||a);return i>3&&a&&Object.defineProperty(e,t,a),a}function BF(n,e){return function(t,s){e(t,s,n)}}function NF(n,e,t,s,i,a){function o(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var l=s.kind,c=l==="getter"?"get":l==="setter"?"set":"value",d=!e&&n?s.static?n:n.prototype:null,h=e||(d?Object.getOwnPropertyDescriptor(d,s.name):{}),m,f=!1,p=t.length-1;p>=0;p--){var b={};for(var x in s)b[x]=x==="access"?{}:s[x];for(var x in s.access)b.access[x]=s.access[x];b.addInitializer=function(S){if(f)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(S||null))};var v=(0,t[p])(l==="accessor"?{get:h.get,set:h.set}:h[c],b);if(l==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(m=o(v.get))&&(h.get=m),(m=o(v.set))&&(h.set=m),(m=o(v.init))&&i.unshift(m)}else(m=o(v))&&(l==="field"?i.unshift(m):h[c]=m)}d&&Object.defineProperty(d,s.name,h),f=!0}function kF(n,e,t){for(var s=arguments.length>2,i=0;i<e.length;i++)t=s?e[i].call(n,t):e[i].call(n);return s?t:void 0}function RF(n){return typeof n=="symbol"?n:"".concat(n)}function WF(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function VF(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function At(n,e,t,s){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(h){try{d(s.next(h))}catch(m){o(m)}}function c(h){try{d(s.throw(h))}catch(m){o(m)}}function d(h){h.done?a(h.value):i(h.value).then(l,c)}d((s=s.apply(n,e||[])).next())})}function _F(n,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},s,i,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=l(0),o.throw=l(1),o.return=l(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(d){return function(h){return c([d,h])}}function c(d){if(s)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(t=0)),t;)try{if(s=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(n,t)}catch(h){d=[6,h],i=0}finally{s=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var mp=Object.create?(function(n,e,t,s){s===void 0&&(s=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,i)}):(function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]});function jF(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&mp(e,n,t)}function Vf(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function TZ(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var s=t.call(n),i,a=[],o;try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(l){o={error:l}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return a}function XF(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(TZ(arguments[e]));return n}function JF(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var s=Array(n),i=0,e=0;e<t;e++)for(var a=arguments[e],o=0,l=a.length;o<l;o++,i++)s[i]=a[o];return s}function YF(n,e,t){if(t||arguments.length===2)for(var s=0,i=e.length,a;s<i;s++)(a||!(s in e))&&(a||(a=Array.prototype.slice.call(e,0,s)),a[s]=e[s]);return n.concat(a||Array.prototype.slice.call(e))}function ku(n){return this instanceof ku?(this.v=n,this):new ku(n)}function FF(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(b){return Promise.resolve(b).then(p,m)}}function l(p,b){s[p]&&(i[p]=function(x){return new Promise(function(v,S){a.push([p,x,v,S])>1||c(p,x)})},b&&(i[p]=b(i[p])))}function c(p,b){try{d(s[p](b))}catch(x){f(a[0][3],x)}}function d(p){p.value instanceof ku?Promise.resolve(p.value.v).then(h,m):f(a[0][2],p)}function h(p){c("next",p)}function m(p){c("throw",p)}function f(p,b){p(b),a.shift(),a.length&&c(a[0][0],a[0][1])}}function MF(n){var e,t;return e={},s("next"),s("throw",function(i){throw i}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(i,a){e[i]=n[i]?function(o){return(t=!t)?{value:ku(n[i](o)),done:!1}:a?a(o):o}:a}}function HF(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Vf=="function"?Vf(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(a){t[a]=n[a]&&function(o){return new Promise(function(l,c){o=n[a](o),i(l,c,o.done,o.value)})}}function i(a,o,l,c){Promise.resolve(c).then(function(d){a({value:d,done:l})},o)}}function TF(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var v9=Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e},Bw=function(n){return Bw=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},Bw(n)};function EF(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=Bw(n),s=0;s<t.length;s++)t[s]!=="default"&&mp(e,n,t[s]);return v9(e,n),e}function DF(n){return n&&n.__esModule?n:{default:n}}function LF(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}function PF(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function KF(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function OF(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],t&&(i=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");i&&(s=function(){try{i.call(this)}catch(a){return Promise.reject(a)}}),n.stack.push({value:e,dispose:s,async:t})}else t&&n.stack.push({async:!0});return e}var x9=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=n,s.suppressed=e,s};function zF(n){function e(a){n.error=n.hasError?new x9(a,n.error,"An error was suppressed during disposal."):a,n.hasError=!0}var t,s=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&s===1)return s=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var a=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(a).then(i,function(o){return e(o),i()})}else s|=1}catch(o){e(o)}if(s===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function UF(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,s,i,a,o){return s?e?".jsx":".js":i&&(!a||!o)?t:i+a+"."+o.toLowerCase()+"js"}):n}const S9={__extends:HZ,__assign:vs,__rest:qu,__decorate:GF,__param:BF,__esDecorate:NF,__runInitializers:kF,__propKey:RF,__setFunctionName:WF,__metadata:VF,__awaiter:At,__generator:_F,__createBinding:mp,__exportStar:jF,__values:Vf,__read:TZ,__spread:XF,__spreadArrays:JF,__spreadArray:YF,__await:ku,__asyncGenerator:FF,__asyncDelegator:MF,__asyncValues:HF,__makeTemplateObject:TF,__importStar:EF,__importDefault:DF,__classPrivateFieldGet:LF,__classPrivateFieldSet:PF,__classPrivateFieldIn:KF,__addDisposableResource:OF,__disposeResources:zF,__rewriteRelativeImportExtension:UF},w9=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:OF,get __assign(){return vs},__asyncDelegator:MF,__asyncGenerator:FF,__asyncValues:HF,__await:ku,__awaiter:At,__classPrivateFieldGet:LF,__classPrivateFieldIn:KF,__classPrivateFieldSet:PF,__createBinding:mp,__decorate:GF,__disposeResources:zF,__esDecorate:NF,__exportStar:jF,__extends:HZ,__generator:_F,__importDefault:DF,__importStar:EF,__makeTemplateObject:TF,__metadata:VF,__param:BF,__propKey:RF,__read:TZ,__rest:qu,__rewriteRelativeImportExtension:UF,__runInitializers:kF,__setFunctionName:WF,__spread:XF,__spreadArray:YF,__spreadArrays:JF,__values:Vf,default:S9},Symbol.toStringTag,{value:"Module"})),Z9=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class EZ extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class G9 extends EZ{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ck extends EZ{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class fk extends EZ{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Nw;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Nw||(Nw={}));class B9{constructor(e,{headers:t={},customFetch:s,region:i=Nw.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Z9(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return At(this,arguments,void 0,function*(t,s={}){var i;let a,o;try{const{headers:l,method:c,body:d,signal:h,timeout:m}=s;let f={},{region:p}=s;p||(p=this.region);const b=new URL(`${this.url}/${t}`);p&&p!=="any"&&(f["x-region"]=p,b.searchParams.set("forceFunctionRegion",p));let x;d&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",x=d):typeof d=="string"?(f["Content-Type"]="text/plain",x=d):typeof FormData<"u"&&d instanceof FormData?x=d:(f["Content-Type"]="application/json",x=JSON.stringify(d)):x=d;let v=h;m&&(o=new AbortController,a=setTimeout(()=>o.abort(),m),h?(v=o.signal,h.addEventListener("abort",()=>o.abort())):v=o.signal);const S=yield this.fetch(b.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),l),body:x,signal:v}).catch(W=>{throw new G9(W)}),B=S.headers.get("x-relay-error");if(B&&B==="true")throw new Ck(S);if(!S.ok)throw new fk(S);let V=((i=S.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),R;return V==="application/json"?R=yield S.json():V==="application/octet-stream"||V==="application/pdf"?R=yield S.blob():V==="text/event-stream"?R=S:V==="multipart/form-data"?R=yield S.formData():R=yield S.text(),{data:R,error:null,response:S}}catch(l){return{data:null,error:l,response:l instanceof fk||l instanceof Ck?l.context:void 0}}finally{a&&clearTimeout(a)}})}}var gr={};const $u=cF(w9);var DI={},LI={},PI={},KI={},OI={},zI={},pk;function QF(){if(pk)return zI;pk=1,Object.defineProperty(zI,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return zI.default=n,zI}var Ak;function qF(){if(Ak)return OI;Ak=1,Object.defineProperty(OI,"__esModule",{value:!0});const e=$u.__importDefault(QF());class t{constructor(i){var a,o;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(a=i.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=i.signal,this.isMaybeSingle=(o=i.isMaybeSingle)!==null&&o!==void 0?o:!1,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=new Headers(this.headers),this.headers.set(i,a),this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var d,h,m,f;let p=null,b=null,x=null,v=c.status,S=c.statusText;if(c.ok){if(this.method!=="HEAD"){const W=await c.text();W===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?b=W:b=JSON.parse(W))}const V=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),R=(m=c.headers.get("content-range"))===null||m===void 0?void 0:m.split("/");V&&R&&R.length>1&&(x=parseInt(R[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(b)&&(b.length>1?(p={code:"PGRST116",details:`Results contain ${b.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},b=null,x=null,v=406,S="Not Acceptable"):b.length===1?b=b[0]:b=null)}else{const V=await c.text();try{p=JSON.parse(V),Array.isArray(p)&&c.status===404&&(b=[],p=null,v=200,S="OK")}catch{c.status===404&&V===""?(v=204,S="No Content"):p={message:V}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,S="OK"),p&&this.shouldThrowOnError)throw new e.default(p)}return{error:p,data:b,count:x,status:v,statusText:S}});return this.shouldThrowOnError||(l=l.catch(c=>{var d,h,m;return{error:{message:`${(d=c?.name)!==null&&d!==void 0?d:"FetchError"}: ${c?.message}`,details:`${(h=c?.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(m=c?.code)!==null&&m!==void 0?m:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,a)}returns(){return this}overrideTypes(){return this}}return OI.default=t,OI}var bk;function $F(){if(bk)return KI;bk=1,Object.defineProperty(KI,"__esModule",{value:!0});const e=$u.__importDefault(qF());class t extends e.default{select(i){let a=!1;const o=(i??"*").split("").map(l=>/\s/.test(l)&&!a?"":(l==='"'&&(a=!a),l)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:a=!0,nullsFirst:o,foreignTable:l,referencedTable:c=l}={}){const d=c?`${c}.order`:"order",h=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${h?`${h},`:""}${i}.${a?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${i}`),this}range(i,a,{foreignTable:o,referencedTable:l=o}={}){const c=typeof l>"u"?"offset":`${l}.offset`,d=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${i}`),this.url.searchParams.set(d,`${a-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:a=!1,settings:o=!1,buffers:l=!1,wal:c=!1,format:d="text"}={}){var h;const m=[i?"analyze":null,a?"verbose":null,o?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(h=this.headers.get("Accept"))!==null&&h!==void 0?h:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${f}"; options=${m};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return KI.default=t,KI}var yk;function DZ(){if(yk)return PI;yk=1,Object.defineProperty(PI,"__esModule",{value:!0});const e=$u.__importDefault($F()),t=new RegExp("[,()]");class s extends e.default{eq(a,o){return this.url.searchParams.append(a,`eq.${o}`),this}neq(a,o){return this.url.searchParams.append(a,`neq.${o}`),this}gt(a,o){return this.url.searchParams.append(a,`gt.${o}`),this}gte(a,o){return this.url.searchParams.append(a,`gte.${o}`),this}lt(a,o){return this.url.searchParams.append(a,`lt.${o}`),this}lte(a,o){return this.url.searchParams.append(a,`lte.${o}`),this}like(a,o){return this.url.searchParams.append(a,`like.${o}`),this}likeAllOf(a,o){return this.url.searchParams.append(a,`like(all).{${o.join(",")}}`),this}likeAnyOf(a,o){return this.url.searchParams.append(a,`like(any).{${o.join(",")}}`),this}ilike(a,o){return this.url.searchParams.append(a,`ilike.${o}`),this}ilikeAllOf(a,o){return this.url.searchParams.append(a,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(a,o){return this.url.searchParams.append(a,`ilike(any).{${o.join(",")}}`),this}is(a,o){return this.url.searchParams.append(a,`is.${o}`),this}in(a,o){const l=Array.from(new Set(o)).map(c=>typeof c=="string"&&t.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(a,`in.(${l})`),this}contains(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cs.{${o.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(o)}`),this}containedBy(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cd.{${o.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(o)}`),this}rangeGt(a,o){return this.url.searchParams.append(a,`sr.${o}`),this}rangeGte(a,o){return this.url.searchParams.append(a,`nxl.${o}`),this}rangeLt(a,o){return this.url.searchParams.append(a,`sl.${o}`),this}rangeLte(a,o){return this.url.searchParams.append(a,`nxr.${o}`),this}rangeAdjacent(a,o){return this.url.searchParams.append(a,`adj.${o}`),this}overlaps(a,o){return typeof o=="string"?this.url.searchParams.append(a,`ov.${o}`):this.url.searchParams.append(a,`ov.{${o.join(",")}}`),this}textSearch(a,o,{config:l,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const h=l===void 0?"":`(${l})`;return this.url.searchParams.append(a,`${d}fts${h}.${o}`),this}match(a){return Object.entries(a).forEach(([o,l])=>{this.url.searchParams.append(o,`eq.${l}`)}),this}not(a,o,l){return this.url.searchParams.append(a,`not.${o}.${l}`),this}or(a,{foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.or`:"or";return this.url.searchParams.append(c,`(${a})`),this}filter(a,o,l){return this.url.searchParams.append(a,`${o}.${l}`),this}}return PI.default=s,PI}var vk;function eM(){if(vk)return LI;vk=1,Object.defineProperty(LI,"__esModule",{value:!0});const e=$u.__importDefault(DZ());class t{constructor(i,{headers:a={},schema:o,fetch:l}){this.url=i,this.headers=new Headers(a),this.schema=o,this.fetch=l}select(i,a){const{head:o=!1,count:l}=a??{},c=o?"HEAD":"GET";let d=!1;const h=(i??"*").split("").map(m=>/\s/.test(m)&&!d?"":(m==='"'&&(d=!d),m)).join("");return this.url.searchParams.set("select",h),l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:a,defaultToNull:o=!0}={}){var l;const c="POST";if(a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const d=i.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(d.length>0){const h=[...new Set(d)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(i,{onConflict:a,ignoreDuplicates:o=!1,count:l,defaultToNull:c=!0}={}){var d;const h="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),a!==void 0&&this.url.searchParams.set("on_conflict",a),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const m=i.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(m.length>0){const f=[...new Set(m)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:h,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(i,{count:a}={}){var o;const l="PATCH";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:i}={}){var a;const o="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}}return LI.default=t,LI}var xk;function N9(){if(xk)return DI;xk=1,Object.defineProperty(DI,"__esModule",{value:!0});const n=$u,e=n.__importDefault(eM()),t=n.__importDefault(DZ());class s{constructor(a,{headers:o={},schema:l,fetch:c}={}){this.url=a,this.headers=new Headers(o),this.schemaName=l,this.fetch=c}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new s(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:l=!1,get:c=!1,count:d}={}){var h;let m;const f=new URL(`${this.url}/rpc/${a}`);let p;l||c?(m=l?"HEAD":"GET",Object.entries(o).filter(([x,v])=>v!==void 0).map(([x,v])=>[x,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([x,v])=>{f.searchParams.append(x,v)})):(m="POST",p=o);const b=new Headers(this.headers);return d&&b.set("Prefer",`count=${d}`),new t.default({method:m,url:f,headers:b,schema:this.schemaName,body:p,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}}return DI.default=s,DI}var Sk;function k9(){if(Sk)return gr;Sk=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.PostgrestError=gr.PostgrestBuilder=gr.PostgrestTransformBuilder=gr.PostgrestFilterBuilder=gr.PostgrestQueryBuilder=gr.PostgrestClient=void 0;const n=$u,e=n.__importDefault(N9());gr.PostgrestClient=e.default;const t=n.__importDefault(eM());gr.PostgrestQueryBuilder=t.default;const s=n.__importDefault(DZ());gr.PostgrestFilterBuilder=s.default;const i=n.__importDefault($F());gr.PostgrestTransformBuilder=i.default;const a=n.__importDefault(qF());gr.PostgrestBuilder=a.default;const o=n.__importDefault(QF());return gr.PostgrestError=o.default,gr.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:a.default,PostgrestError:o.default},gr}var tM=k9();const nM=rd(tM),R9=lF({__proto__:null,default:nM},[tM]),{PostgrestClient:W9,PostgrestQueryBuilder:Eme,PostgrestFilterBuilder:Dme,PostgrestTransformBuilder:Lme,PostgrestBuilder:Pme,PostgrestError:Kme}=nM||R9;class V9{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const s=t.node,i=parseInt(s.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const _9="2.81.1",j9=`realtime-js/${_9}`,sM="1.0.0",X9="2.0.0",wk=sM,kw=1e4,J9=1e3,Y9=100;var gg;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(gg||(gg={}));var Vs;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Vs||(Vs={}));var na;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(na||(na={}));var Rw;(function(n){n.websocket="websocket"})(Rw||(Rw={}));var ug;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ug||(ug={}));class F9{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodePush(e){const{join_ref:t,ref:s,event:i,topic:a,payload:o}=e,l=this.META_LENGTH+t.length+s.length+a.length+i.length,c=new ArrayBuffer(this.HEADER_LENGTH+l);let d=new DataView(c),h=0;d.setUint8(h++,this.KINDS.push),d.setUint8(h++,t.length),d.setUint8(h++,s.length),d.setUint8(h++,a.length),d.setUint8(h++,i.length),Array.from(t,f=>d.setUint8(h++,f.charCodeAt(0))),Array.from(s,f=>d.setUint8(h++,f.charCodeAt(0))),Array.from(a,f=>d.setUint8(h++,f.charCodeAt(0))),Array.from(i,f=>d.setUint8(h++,f.charCodeAt(0)));var m=new Uint8Array(c.byteLength+o.byteLength);return m.set(new Uint8Array(c),0),m.set(new Uint8Array(o),c.byteLength),m.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const{join_ref:i,ref:a,topic:o}=e,l=e.payload.event,c=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0),d=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+a.length+o.length+l.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let m=new DataView(h),f=0;m.setUint8(f++,this.KINDS.userBroadcastPush),m.setUint8(f++,i.length),m.setUint8(f++,a.length),m.setUint8(f++,o.length),m.setUint8(f++,l.length),m.setUint8(f++,this.BINARY_ENCODING),Array.from(i,b=>m.setUint8(f++,b.charCodeAt(0))),Array.from(a,b=>m.setUint8(f++,b.charCodeAt(0))),Array.from(o,b=>m.setUint8(f++,b.charCodeAt(0))),Array.from(l,b=>m.setUint8(f++,b.charCodeAt(0)));var p=new Uint8Array(h.byteLength+c.byteLength);return p.set(new Uint8Array(h),0),p.set(new Uint8Array(c),h.byteLength),p.buffer}_encodeJsonUserBroadcastPush(e){var t,s;const{join_ref:i,ref:a,topic:o}=e,l=e.payload.event,c=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},h=new TextEncoder().encode(JSON.stringify(c)).buffer,m=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+a.length+o.length+l.length,f=new ArrayBuffer(this.HEADER_LENGTH+m);let p=new DataView(f),b=0;p.setUint8(b++,this.KINDS.userBroadcastPush),p.setUint8(b++,i.length),p.setUint8(b++,a.length),p.setUint8(b++,o.length),p.setUint8(b++,l.length),p.setUint8(b++,this.JSON_ENCODING),Array.from(i,v=>p.setUint8(b++,v.charCodeAt(0))),Array.from(a,v=>p.setUint8(b++,v.charCodeAt(0))),Array.from(o,v=>p.setUint8(b++,v.charCodeAt(0))),Array.from(l,v=>p.setUint8(b++,v.charCodeAt(0)));var x=new Uint8Array(f.byteLength+h.byteLength);return x.set(new Uint8Array(f),0),x.set(new Uint8Array(h),f.byteLength),x.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){const s=JSON.parse(e),[i,a,o,l,c]=s;return t({join_ref:i,ref:a,topic:o,event:l,payload:c})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.push:return this._decodePush(e,t,i);case this.KINDS.reply:return this._decodeReply(e,t,i);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,i);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,i)}}_decodePush(e,t,s){const i=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3);let l=this.HEADER_LENGTH+this.META_LENGTH-1;const c=s.decode(e.slice(l,l+i));l=l+i;const d=s.decode(e.slice(l,l+a));l=l+a;const h=s.decode(e.slice(l,l+o));l=l+o;const m=JSON.parse(s.decode(e.slice(l,e.byteLength)));return{join_ref:c,ref:null,topic:d,event:h,payload:m}}_decodeReply(e,t,s){const i=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3),l=t.getUint8(4);let c=this.HEADER_LENGTH+this.META_LENGTH;const d=s.decode(e.slice(c,c+i));c=c+i;const h=s.decode(e.slice(c,c+a));c=c+a;const m=s.decode(e.slice(c,c+o));c=c+o;const f=s.decode(e.slice(c,c+l));c=c+l;const p=JSON.parse(s.decode(e.slice(c,e.byteLength))),b={status:f,response:p};return{join_ref:d,ref:h,topic:m,event:na.reply,payload:b}}_decodeBroadcast(e,t,s){const i=t.getUint8(1),a=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=s.decode(e.slice(o,o+i));o=o+i;const c=s.decode(e.slice(o,o+a));o=o+a;const d=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:l,event:c,payload:d}}_decodeUserBroadcast(e,t,s){const i=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3),l=t.getUint8(4);let c=this.HEADER_LENGTH+4;const d=s.decode(e.slice(c,c+i));c=c+i;const h=s.decode(e.slice(c,c+a));c=c+a;const m=s.decode(e.slice(c,c+o));c=c+o;const f=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(s.decode(f)):f,b={type:this.BROADCAST,event:h,payload:p};return o>0&&(b.meta=JSON.parse(m)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST,payload:b}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class rM{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Hn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Hn||(Hn={}));const Zk=(n,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((a,o)=>(a[o]=M9(o,n,e,i),a),{}):{}},M9=(n,e,t,s)=>{const i=e.find(l=>l.name===n),a=i?.type,o=t[n];return a&&!s.includes(a)?iM(a,o):Ww(o)},iM=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return D9(e,t)}switch(n){case Hn.bool:return H9(e);case Hn.float4:case Hn.float8:case Hn.int2:case Hn.int4:case Hn.int8:case Hn.numeric:case Hn.oid:return T9(e);case Hn.json:case Hn.jsonb:return E9(e);case Hn.timestamp:return L9(e);case Hn.abstime:case Hn.date:case Hn.daterange:case Hn.int4range:case Hn.int8range:case Hn.money:case Hn.reltime:case Hn.text:case Hn.time:case Hn.timestamptz:case Hn.timetz:case Hn.tsrange:case Hn.tstzrange:return Ww(e);default:return Ww(e)}},Ww=n=>n,H9=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},T9=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},E9=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},D9=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let a;const o=n.slice(1,t);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(l=>iM(e,l))}return n},L9=n=>typeof n=="string"?n.replace(" ","T"):n,aM=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Zb{constructor(e,t,s={},i=kw){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Gk;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Gk||(Gk={}));class lm{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=lm.syncState(this.state,i,a,o),this.pendingDiffs.forEach(c=>{this.state=lm.syncDiff(this.state,c,a,o)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=lm.syncDiff(this.state,i,a,o),l())}),this.onJoin((i,a,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:a,newPresences:o})}),this.onLeave((i,a,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const a=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(a,(d,h)=>{o[d]||(c[d]=h)}),this.map(o,(d,h)=>{const m=a[d];if(m){const f=h.map(v=>v.presence_ref),p=m.map(v=>v.presence_ref),b=h.filter(v=>p.indexOf(v.presence_ref)<0),x=m.filter(v=>f.indexOf(v.presence_ref)<0);b.length>0&&(l[d]=b),x.length>0&&(c[d]=x)}else l[d]=h}),this.syncDiff(a,{joins:l,leaves:c},s,i)}static syncDiff(e,t,s,i){const{joins:a,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(a,(l,c)=>{var d;const h=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),h.length>0){const m=e[l].map(p=>p.presence_ref),f=h.filter(p=>m.indexOf(p.presence_ref)<0);e[l].unshift(...f)}s(l,h,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const h=c.map(m=>m.presence_ref);d=d.filter(m=>h.indexOf(m.presence_ref)<0),e[l]=d,i(l,d,c),d.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Bk;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Bk||(Bk={}));var cm;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(cm||(cm={}));var wl;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(wl||(wl={}));class LZ{constructor(e,t={config:{}},s){var i,a;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Vs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Zb(this,na.join,this.params,this.timeout),this.rejoinTimer=new rM(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Vs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Vs.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Vs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Vs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Vs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(na.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new lm(this),this.broadcastEndpointURL=aM(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,i,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Vs.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(p=>p.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[cm.PRESENCE]&&this.bindings[cm.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,m={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(p=>e?.(wl.CHANNEL_ERROR,p)),this._onClose(()=>e?.(wl.CLOSED)),this.updateJoinPayload(Object.assign({config:f},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var b;if(this.socket.setAuth(),p===void 0){e?.(wl.SUBSCRIBED);return}else{const x=this.bindings.postgres_changes,v=(b=x?.length)!==null&&b!==void 0?b:0,S=[];for(let B=0;B<v;B++){const V=x[B],{filter:{event:R,schema:W,table:_,filter:Y}}=V,j=p&&p[B];if(j&&j.event===R&&j.schema===W&&j.table===_&&j.filter===Y)S.push(Object.assign(Object.assign({},V),{id:j.id}));else{this.unsubscribe(),this.state=Vs.errored,e?.(wl.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=S,e&&e(wl.SUBSCRIBED);return}}).receive("error",p=>{this.state=Vs.errored,e?.(wl.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e?.(wl.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Vs.joined&&e===cm.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var i;const a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=d.body)===null||i===void 0?void 0:i.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,l,c;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&a("ok"),d.receive("ok",()=>a("ok")),d.receive("error",()=>a("error")),d.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Vs.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(na.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new Zb(this,na.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Vs.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const i=new AbortController,a=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(a),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Zb(this,e,t,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Y9){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,a;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:h}=na;if(s&&[l,c,d,h].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var b,x,v;return((b=p.filter)===null||b===void 0?void 0:b.event)==="*"||((v=(x=p.filter)===null||x===void 0?void 0:x.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(p=>p.callback(f,s)):(a=this.bindings[o])===null||a===void 0||a.filter(p=>{var b,x,v,S,B,V;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const R=p.id,W=(b=p.filter)===null||b===void 0?void 0:b.event;return R&&((x=t.ids)===null||x===void 0?void 0:x.includes(R))&&(W==="*"||W?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const R=(B=(S=p?.filter)===null||S===void 0?void 0:S.event)===null||B===void 0?void 0:B.toLocaleLowerCase();return R==="*"||R===((V=t?.event)===null||V===void 0?void 0:V.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const b=f.data,{schema:x,table:v,commit_timestamp:S,type:B,errors:V}=b;f=Object.assign(Object.assign({},{schema:x,table:v,commit_timestamp:S,eventType:B,new:{},old:{},errors:V}),this._getPayloadRecords(b))}p.callback(f,s)})}_isClosed(){return this.state===Vs.closed}_isJoined(){return this.state===Vs.joined}_isJoining(){return this.state===Vs.joining}_isLeaving(){return this.state===Vs.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),a={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(a):this.bindings[i]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var a;return!(((a=i.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===s&&LZ.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(na.close,{},e)}_onError(e){this._on(na.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Vs.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Zk(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Zk(e.columns,e.old_record)),t}}const Gb=()=>{},UI={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},P9=[1e3,2e3,5e3,1e4],K9=1e4,O9=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class z9{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=kw,this.transport=null,this.heartbeatIntervalMs=UI.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Gb,this.ref=0,this.reconnectTimer=null,this.vsn=wk,this.logger=Gb,this.conn=null,this.sendBuffer=[],this.serializer=new F9,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...a)=>i(...a):(...a)=>fetch(...a),!(!((s=t?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Rw.websocket}`,this.httpEndpoint=aM(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=V9.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case gg.connecting:return ug.Connecting;case gg.open:return ug.Open;case gg.closing:return ug.Closing;default:return ug.Closed}}isConnected(){return this.connectionState()===ug.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(a=>a.topic===s);if(i)return i;{const a=new LZ(`realtime:${e}`,t,this);return this.channels.push(a),a}}push(e){const{topic:t,event:s,payload:i,ref:a}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${a})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(J9,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},UI.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:i,payload:a,ref:o}=t,l=o?`(${o})`:"",c=a.status||"";this.log("receive",`${c} ${s} ${i} ${l}`.trim(),a),this.channels.filter(d=>d._isMember(s)).forEach(d=>d._trigger(i,a,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===gg.open||this.conn.readyState===gg.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(na.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([O9],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:j9};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(na.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new rM(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},UI.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,i,a,o,l,c,d,h,m,f,p;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e?.timeout)!==null&&s!==void 0?s:kw,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:UI.HEARTBEAT_INTERVAL,this.worker=(a=e?.worker)!==null&&a!==void 0?a:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e?.heartbeatCallback)!==null&&l!==void 0?l:Gb,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:wk,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=e?.reconnectAfterMs)!==null&&d!==void 0?d:(b=>P9[b-1]||K9),this.vsn){case sM:this.encode=(h=e?.encode)!==null&&h!==void 0?h:((b,x)=>x(JSON.stringify(b))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:((b,x)=>x(JSON.parse(b)));break;case X9:this.encode=(f=e?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(p=e?.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class PZ extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ns(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class U9 extends PZ{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Vw extends PZ{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const KZ=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),Q9=()=>Response,_w=n=>{if(Array.isArray(n))return n.map(t=>_w(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[i]=_w(s)}),e},q9=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Bb=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},$9=(n,e,t)=>At(void 0,void 0,void 0,function*(){const s=yield Q9();n instanceof s&&!t?.noResolveJson?n.json().then(i=>{const a=n.status||500,o=i?.statusCode||a+"";e(new U9(Bb(i),a,o))}).catch(i=>{e(new Vw(Bb(i),i))}):e(new Vw(Bb(n),n))}),eL=(n,e,t,s)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"||!s?i:(q9(s)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(s)):i.body=s,e?.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function Hm(n,e,t,s,i,a){return At(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,eL(e,s,i,a)).then(c=>{if(!c.ok)throw c;return s?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>$9(c,l,s))})})}function Am(n,e,t,s){return At(this,void 0,void 0,function*(){return Hm(n,"GET",e,t,s)})}function Xa(n,e,t,s,i){return At(this,void 0,void 0,function*(){return Hm(n,"POST",e,s,i,t)})}function jw(n,e,t,s,i){return At(this,void 0,void 0,function*(){return Hm(n,"PUT",e,s,i,t)})}function tL(n,e,t,s){return At(this,void 0,void 0,function*(){return Hm(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function OZ(n,e,t,s,i){return At(this,void 0,void 0,function*(){return Hm(n,"DELETE",e,s,i,t)})}class nL{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return At(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ns(e))return{data:null,error:e};throw e}})}}var oM;class sL{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[oM]="BlobDownloadBuilder",this.promise=null}asStream(){return new nL(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return At(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ns(e))return{data:null,error:e};throw e}})}}oM=Symbol.toStringTag;const rL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Nk={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class iL{constructor(e,t={},s,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=KZ(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,i){return At(this,void 0,void 0,function*(){try{let a;const o=Object.assign(Object.assign({},Nk),i);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",this.encodeMetadata(c)),a.append("",s)):typeof FormData<"u"&&s instanceof FormData?(a=s,a.has("cacheControl")||a.append("cacheControl",o.cacheControl),c&&!a.has("metadata")&&a.append("metadata",this.encodeMetadata(c))):(a=s,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!o.duplex&&(o.duplex="half")),i?.headers&&(l=Object.assign(Object.assign({},l),i.headers));const d=this._removeEmptyFolders(t),h=this._getFinalPath(d),m=yield(e=="PUT"?jw:Xa)(this.fetch,`${this.url}/object/${h}`,a,Object.assign({headers:l},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:m.Id,fullPath:m.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ns(a))return{data:null,error:a};throw a}})}upload(e,t,s){return At(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return At(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),o=this._getFinalPath(a),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const d=Object.assign({upsert:Nk.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",d.cacheControl)):(c=s,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType);const m=yield jw(this.fetch,l.toString(),c,{headers:h});return{data:{path:a,fullPath:m.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ns(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return At(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const a=yield Xa(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(this.url+a.url),l=o.searchParams.get("token");if(!l)throw new PZ("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ns(s))return{data:null,error:s};throw s}})}update(e,t,s){return At(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return At(this,void 0,void 0,function*(){try{return{data:yield Xa(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}copy(e,t,s){return At(this,void 0,void 0,function*(){try{return{data:{path:(yield Xa(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return At(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),a=yield Xa(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s?.download?`&download=${s.download===!0?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${o}`)},{data:a,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return At(this,void 0,void 0,function*(){try{const i=yield Xa(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${a}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}download(e,t){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",l=this._getFinalPath(e),c=()=>Am(this.fetch,`${this.url}/${i}/${l}${o}`,{headers:this.headers,noResolveJson:!0});return new sL(c,this.shouldThrowOnError)}info(e){return At(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Am(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:_w(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ns(s))return{data:null,error:s};throw s}})}exists(e){return At(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield tL(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ns(s)&&s instanceof Vw){const i=s.originalError;if([400,404].includes(i?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],a=t?.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&i.push(a);const l=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&i.push(c);let d=i.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${d}`)}}}remove(e){return At(this,void 0,void 0,function*(){try{return{data:yield OZ(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}list(e,t,s){return At(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},rL),t),{prefix:e||""});return{data:yield Xa(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}listV2(e,t){return At(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Xa(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ns(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const lM="2.81.1",cM={"X-Client-Info":`storage-js/${lM}`};class aL{constructor(e,t={},s,i){this.shouldThrowOnError=!1;const a=new URL(e);i?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cM),t),this.fetch=KZ(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return At(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield Am(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}getBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield Am(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}createBucket(e){return At(this,arguments,void 0,function*(t,s={public:!1}){try{return{data:yield Xa(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ns(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return At(this,void 0,void 0,function*(){try{return{data:yield jw(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ns(s))return{data:null,error:s};throw s}})}emptyBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield Xa(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}deleteBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield OZ(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class oL{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cM),t),this.fetch=KZ(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield Xa(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}listBuckets(e){return At(this,void 0,void 0,function*(){try{const t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);const s=t.toString(),i=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield Am(this.fetch,i,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}deleteBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield OZ(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ns(t))return{data:null,error:t};throw t}})}}const zZ={"X-Client-Info":`storage-js/${lM}`,"Content-Type":"application/json"};class dM extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function yi(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}class Nb extends dM{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class lL extends dM{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var kk;(function(n){n.InternalError="InternalError",n.S3VectorConflictException="S3VectorConflictException",n.S3VectorNotFoundException="S3VectorNotFoundException",n.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",n.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",n.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(kk||(kk={}));const UZ=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),cL=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Rk=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),dL=(n,e,t)=>At(void 0,void 0,void 0,function*(){if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!t?.noResolveJson){const i=n.status||500,a=n;if(typeof a.json=="function")a.json().then(o=>{const l=o?.statusCode||o?.code||i+"";e(new Nb(Rk(o),i,l))}).catch(()=>{const o=i+"",l=a.statusText||`HTTP ${i} error`;e(new Nb(l,i,o))});else{const o=i+"",l=a.statusText||`HTTP ${i} error`;e(new Nb(l,i,o))}}else e(new lL(Rk(n),n))}),gL=(n,e,t,s)=>{const i={method:n,headers:e?.headers||{}};return s?(cL(s)?(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(s)):i.body=s,Object.assign(Object.assign({},i),t)):i};function uL(n,e,t,s,i,a){return At(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,gL(e,s,i,a)).then(c=>{if(!c.ok)throw c;if(s?.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>dL(c,l,s))})})}function vi(n,e,t,s,i){return At(this,void 0,void 0,function*(){return uL(n,"POST",e,s,i,t)})}class hL{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zZ),t),this.fetch=UZ(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return At(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}getIndex(e,t){return At(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(yi(s))return{data:null,error:s};throw s}})}listIndexes(e){return At(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return At(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(yi(s))return{data:null,error:s};throw s}})}}class mL{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zZ),t),this.fetch=UZ(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return At(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield vi(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}getVectors(e){return At(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}listVectors(e){return At(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield vi(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}queryVectors(e){return At(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}deleteVectors(e){return At(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield vi(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}}class IL{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},zZ),t),this.fetch=UZ(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return At(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}getBucket(e){return At(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}listBuckets(){return At(this,arguments,void 0,function*(e={}){try{return{data:yield vi(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}deleteBucket(e){return At(this,void 0,void 0,function*(){try{return{data:(yield vi(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yi(t))return{data:null,error:t};throw t}})}}class CL extends IL{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new fL(this.url,this.headers,e,this.fetch)}}class fL extends hL{constructor(e,t,s,i){super(e,t,i),this.vectorBucketName=s}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return At(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return At(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return At(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return At(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new pL(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class pL extends mL{constructor(e,t,s,i,a){super(e,t,a),this.vectorBucketName=s,this.indexName=i}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return At(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return At(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return At(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return At(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return At(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class AL extends aL{constructor(e,t={},s,i){super(e,t,s,i)}from(e){return new iL(this.url,this.headers,e,this.fetch)}get vectors(){return new CL(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new oL(this.url+"/iceberg",this.headers,this.fetch)}}const bL="2.81.1";let $h="";typeof Deno<"u"?$h="deno":typeof document<"u"?$h="web":typeof navigator<"u"&&navigator.product==="ReactNative"?$h="react-native":$h="node";const yL={"X-Client-Info":`supabase-js-${$h}/${bL}`},vL={headers:yL},xL={schema:"public"},SL={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wL={},ZL=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),GL=()=>Headers,BL=(n,e,t)=>{const s=ZL(t),i=GL();return async(a,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:n;let d=new i(o?.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),s(a,Object.assign(Object.assign({},o),{headers:d}))}};function NL(n){return n.endsWith("/")?n:n+"/"}function kL(n,e){var t,s;const{db:i,auth:a,realtime:o,global:l}=n,{db:c,auth:d,realtime:h,global:m}=e,f={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},d),a),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),l),{headers:Object.assign(Object.assign({},(t=m?.headers)!==null&&t!==void 0?t:{}),(s=l?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}function RL(n){const e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(NL(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const gM="2.81.1",hu=30*1e3,Xw=3,kb=Xw*hu,WL="http://localhost:9999",VL="supabase.auth.token",_L={"X-Client-Info":`gotrue-js/${gM}`},Jw="X-Supabase-Api-Version",uM={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jL=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,XL=600*1e3;class bm extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function yt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class JL extends bm{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function YL(n){return yt(n)&&n.name==="AuthApiError"}class hg extends bm{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class id extends bm{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class _a extends id{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function FL(n){return yt(n)&&n.name==="AuthSessionMissingError"}class $g extends id{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class QI extends id{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qI extends id{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ML(n){return yt(n)&&n.name==="AuthImplicitGrantRedirectError"}class Wk extends id{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Yw extends id{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Rb(n){return yt(n)&&n.name==="AuthRetryableFetchError"}class Vk extends id{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Fw extends id{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),_k=` 	
\r=`.split(""),HL=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<_k.length;e+=1)n[_k[e].charCodeAt(0)]=-2;for(let e=0;e<_f.length;e+=1)n[_f[e].charCodeAt(0)]=e;return n})();function jk(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(_f[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(_f[s]),e.queuedBits-=6}}function hM(n,e,t){const s=HL[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Xk(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=o=>{DL(o,s,t)};for(let o=0;o<n.length;o+=1)hM(n.charCodeAt(o),i,a);return e.join("")}function TL(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function EL(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}TL(s,e)}}function DL(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if((n>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function yu(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)hM(n.charCodeAt(i),t,s);return new Uint8Array(e)}function LL(n){const e=[];return EL(n,t=>e.push(t)),new Uint8Array(e)}function mg(n){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return n.forEach(i=>jk(i,t,s)),jk(null,t,s),e.join("")}function PL(n){return Math.round(Date.now()/1e3)+n}function KL(){return Symbol("auth-callback")}const qs=()=>typeof window<"u"&&typeof document<"u",Qd={tested:!1,writable:!1},mM=()=>{if(!qs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Qd.tested)return Qd.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Qd.tested=!0,Qd.writable=!0}catch{Qd.tested=!0,Qd.writable=!1}return Qd.writable};function OL(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,a)=>{e[a]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const IM=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),zL=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",mu=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},qd=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Rc=async(n,e)=>{await n.removeItem(e)};class Ip{constructor(){this.promise=new Ip.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ip.promiseConstructor=Promise;function Wb(n){const e=n.split(".");if(e.length!==3)throw new Fw("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!jL.test(e[s]))throw new Fw("JWT not in base64url format");return{header:JSON.parse(Xk(e[0])),payload:JSON.parse(Xk(e[1])),signature:yu(e[2]),raw:{header:e[0],payload:e[1]}}}async function UL(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function QL(n,e){return new Promise((s,i)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await n(a);if(!e(a,null,o)){s(o);return}}catch(o){if(!e(a,o)){i(o);return}}})()})}function qL(n){return("0"+n.toString(16)).substr(-2)}function $L(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let a=0;a<56;a++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,qL).join("")}async function e3(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}async function t3(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await e3(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function eu(n,e,t=!1){const s=$L();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await mu(n,`${e}-code-verifier`,i);const a=await t3(s);return[a,s===a?"plain":"s256"]}const n3=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function s3(n){const e=n.headers.get(Jw);if(!e||!e.match(n3))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function r3(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function i3(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const a3=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tu(n){if(!a3.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Vb(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function o3(n,e){return new Proxy(n,{get:(t,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,i)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,i)}})}function Jk(n){return JSON.parse(JSON.stringify(n))}const og=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),l3=[502,503,504];async function Yk(n){var e;if(!zL(n))throw new Yw(og(n),0);if(l3.includes(n.status))throw new Yw(og(n),n.status);let t;try{t=await n.json()}catch(a){throw new hg(og(a),a)}let s;const i=s3(n);if(i&&i.getTime()>=uM["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Vk(og(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new _a}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new Vk(og(t),n.status,t.weak_password.reasons);throw new JL(og(t),n.status||500,s)}const c3=(n,e,t,s)=>{const i={method:n,headers:e?.headers||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function _t(n,e,t,s){var i;const a=Object.assign({},s?.headers);a[Jw]||(a[Jw]=uM["2024-01-01"].name),s?.jwt&&(a.Authorization=`Bearer ${s.jwt}`);const o=(i=s?.query)!==null&&i!==void 0?i:{};s?.redirectTo&&(o.redirect_to=s.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await d3(n,e,t+l,{headers:a,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function d3(n,e,t,s,i,a){const o=c3(e,s,i,a);let l;try{l=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new Yw(og(c),0)}if(l.ok||await Yk(l),s?.noResolveJson)return l;try{return await l.json()}catch(c){await Yk(c)}}function ja(n){var e;let t=null;h3(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=PL(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function Fk(n){const e=ja(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ec(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function g3(n){return{data:n,error:null}}function u3(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:a}=n,o=qu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:a},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Mk(n){return n}function h3(n){return n.access_token&&n.refresh_token&&n.expires_in}const _b=["global","local","others"];class m3{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=IM(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=_b[0]){if(_b.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_b.join(", ")}`);try{return await _t(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(yt(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await _t(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ec})}catch(s){if(yt(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=qu(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s?.newEmail,delete i.newEmail),await _t(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:u3,redirectTo:t?.redirectTo})}catch(t){if(yt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ec})}catch(t){if(yt(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,a,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await _t(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(a=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:Mk});if(h.error)throw h.error;const m=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(b=>{const x=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(b.split(";")[1].split("=")[1]);d[`${v}Page`]=x}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(yt(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){tu(e);try{return await _t(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ec})}catch(t){if(yt(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){tu(e);try{return await _t(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ec})}catch(s){if(yt(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){tu(e);try{return await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ec})}catch(s){if(yt(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){tu(e.userId);try{const{data:t,error:s}=await _t(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(yt(t))return{data:null,error:t};throw t}}async _deleteFactor(e){tu(e.userId),tu(e.id);try{return{data:await _t(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(yt(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,i,a,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await _t(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(a=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:Mk});if(h.error)throw h.error;const m=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(b=>{const x=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(b.split(";")[1].split("=")[1]);d[`${v}Page`]=x}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(yt(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(yt(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await _t(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(yt(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await _t(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(yt(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await _t(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(yt(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await _t(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(yt(t))return{data:null,error:t};throw t}}}function Hk(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const nu={debug:!!(globalThis&&mM()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class CM extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class I3 extends CM{}async function C3(n,e,t){nu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),nu.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){nu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{nu.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw nu.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new I3(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(nu.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function f3(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function fM(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function p3(n){return parseInt(n,16)}function A3(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function b3(n){var e;const{chainId:t,domain:s,expirationTime:i,issuedAt:a=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:h,uri:m,version:f}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const p=fM(n.address),b=h?`${h}://${s}`:s,x=n.statement?`${n.statement}
`:"",v=`${b} wants you to sign in with your Ethereum account:
${p}

${x}`;let S=`URI: ${m}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${a.toISOString()}`;if(i&&(S+=`
Expiration Time: ${i.toISOString()}`),l&&(S+=`
Not Before: ${l.toISOString()}`),c&&(S+=`
Request ID: ${c}`),d){let B=`
Resources:`;for(const V of d){if(!V||typeof V!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${V}`);B+=`
- ${V}`}S+=B}return`${v}
${S}`}class xs extends Error{constructor({message:e,code:t,cause:s,name:i}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(a=i??(s instanceof Error?s.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=t}}class jf extends xs{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function y3({error:n,options:e}){var t,s,i;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new xs({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=a.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new xs({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((s=a.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new xs({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=a.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new xs({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new xs({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new xs({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return a.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new xs({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new xs({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const o=window.location.hostname;if(pM(o)){if(a.rp.id!==o)return new xs({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new xs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new xs({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new xs({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new xs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function v3({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new xs({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new xs({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const s=window.location.hostname;if(pM(s)){if(t.rpId!==s)return new xs({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new xs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new xs({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new xs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class x3{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const S3=new x3;function w3(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:s}=n,i=qu(n,["challenge","user","excludeCredentials"]),a=yu(e).buffer,o=Object.assign(Object.assign({},t),{id:yu(t.id).buffer}),l=Object.assign(Object.assign({},i),{challenge:a,user:o});if(s&&s.length>0){l.excludeCredentials=new Array(s.length);for(let c=0;c<s.length;c++){const d=s[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:yu(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function Z3(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,s=qu(n,["challenge","allowCredentials"]),i=yu(e).buffer,a=Object.assign(Object.assign({},s),{challenge:i});if(t&&t.length>0){a.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o];a.allowCredentials[o]=Object.assign(Object.assign({},l),{id:yu(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return a}function G3(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:mg(new Uint8Array(n.response.attestationObject)),clientDataJSON:mg(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function B3(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,s=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:mg(new Uint8Array(i.authenticatorData)),clientDataJSON:mg(new Uint8Array(i.clientDataJSON)),signature:mg(new Uint8Array(i.signature)),userHandle:i.userHandle?mg(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function pM(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Tk(){var n,e;return!!(qs()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function N3(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new jf("Browser returned unexpected credential type",e)}:{data:null,error:new jf("Empty credential response",e)}}catch(e){return{data:null,error:y3({error:e,options:n})}}}async function k3(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new jf("Browser returned unexpected credential type",e)}:{data:null,error:new jf("Empty credential response",e)}}catch(e){return{data:null,error:v3({error:e,options:n})}}}const R3={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},W3={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Xf(...n){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of n)if(i)for(const a in i){const o=i[a];if(o!==void 0)if(Array.isArray(o))s[a]=o;else if(t(o))s[a]=o;else if(e(o)){const l=s[a];e(l)?s[a]=Xf(l,o):s[a]=Xf(o)}else s[a]=o}return s}function V3(n,e){return Xf(R3,n,e||{})}function _3(n,e){return Xf(W3,n,e||{})}class j3{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:i},a){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:l};const c=i??S3.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:d}=o.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${s}`),d.displayName||(d.displayName=d.name)}switch(o.webauthn.type){case"create":{const d=V3(o.webauthn.credential_options.publicKey,a?.create),{data:h,error:m}=await N3({publicKey:d,signal:c});return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:m}}case"request":{const d=_3(o.webauthn.credential_options.publicKey,a?.request),{data:h,error:m}=await k3(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:d,signal:c}));return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:m}}}}catch(o){return yt(o)?{data:null,error:o}:{data:null,error:new hg("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!t)return{data:null,error:new bm("rpId is required for WebAuthn authentication")};try{if(!Tk())return{data:null,error:new hg("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:i},{request:a});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:s,credential_response:c.credential_response}})}catch(o){return yt(o)?{data:null,error:o}:{data:null,error:new hg("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!t)return{data:null,error:new bm("rpId is required for WebAuthn registration")};try{if(!Tk())return{data:null,error:new hg("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var m;return(m=h.data)===null||m===void 0?void 0:m.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h?.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:i},{create:a});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:s,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return yt(o)?{data:null,error:o}:{data:null,error:new hg("Unexpected error in register",o)}}}}f3();const X3={url:WL,storageKey:VL,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:_L,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Ek(n,e,t){return await t()}const su={};class ym{get jwks(){var e,t;return(t=(e=su[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){su[this.storageKey]=Object.assign(Object.assign({},su[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=su[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){su[this.storageKey]=Object.assign(Object.assign({},su[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},X3),e);if(this.storageKey=a.storageKey,this.instanceID=(t=ym.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,ym.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&qs()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new m3({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=IM(a.fetch),this.lock=a.lock||Ek,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,a.lock?this.lock=a.lock:qs()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=C3:this.lock=Ek,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new j3(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:mM()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Hk(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Hk(this.memoryStorage)),qs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${gM}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if(qs()&&(t=OL(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),qs()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:a}=await this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),ML(a)){const c=(e=a.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return yt(t)?this._returnResult({error:t}):this._returnResult({error:new hg("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const a=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:ja}),{data:o,error:l}=a;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(a){if(yt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var t,s,i;try{let a;if("email"in e){const{email:h,password:m,options:f}=e;let p=null,b=null;this.flowType==="pkce"&&([p,b]=await eu(this.storage,this.storageKey)),a=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:m,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:b},xform:ja})}else if("phone"in e){const{phone:h,password:m,options:f}=e;a=await _t(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:m,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:ja})}else throw new QI("You must provide either an email or phone number and a password");const{data:o,error:l}=a;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(a){if(yt(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:a,password:o,options:l}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Fk})}else if("phone"in e){const{phone:a,password:o,options:l}=e;t=await _t(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:Fk})}else throw new QI("You must provide either an email or phone number and a password");const{data:s,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const a=new $g;return this._returnResult({data:{user:null,session:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(yt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,i,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,i,a,o,l,c,d,h,m,f;let p,b;if("message"in e)p=e.message,b=e.signature;else{const{chain:x,wallet:v,statement:S,options:B}=e;let V;if(qs())if(typeof v=="object")V=v;else{const M=window;if("ethereum"in M&&typeof M.ethereum=="object"&&"request"in M.ethereum&&typeof M.ethereum.request=="function")V=M.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!B?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");V=v}const R=new URL((t=B?.url)!==null&&t!==void 0?t:window.location.href),W=await V.request({method:"eth_requestAccounts"}).then(M=>M).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!W||W.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=fM(W[0]);let Y=(s=B?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!Y){const M=await V.request({method:"eth_chainId"});Y=p3(M)}const j={domain:R.host,address:_,statement:S,uri:R.href,version:"1",chainId:Y,nonce:(i=B?.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(a=B?.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=B?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=B?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=B?.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(h=B?.signInWithEthereum)===null||h===void 0?void 0:h.resources};p=b3(j),b=await V.request({method:"personal_sign",params:[A3(p),_]})}try{const{data:x,error:v}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:b},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:ja});if(v)throw v;if(!x||!x.session||!x.user){const S=new $g;return this._returnResult({data:{user:null,session:null},error:S})}return x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),this._returnResult({data:Object.assign({},x),error:v})}catch(x){if(yt(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async signInWithSolana(e){var t,s,i,a,o,l,c,d,h,m,f,p;let b,x;if("message"in e)b=e.message,x=e.signature;else{const{chain:v,wallet:S,statement:B,options:V}=e;let R;if(qs())if(typeof S=="object")R=S;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))R=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!V?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=S}const W=new URL((t=V?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in R&&R.signIn){const _=await R.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},V?.signInWithSolana),{version:"1",domain:W.host,uri:W.href}),B?{statement:B}:null));let Y;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")Y=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)Y=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Y&&"signature"in Y&&(typeof Y.signedMessage=="string"||Y.signedMessage instanceof Uint8Array)&&Y.signature instanceof Uint8Array)b=typeof Y.signedMessage=="string"?Y.signedMessage:new TextDecoder().decode(Y.signedMessage),x=Y.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in R)||typeof R.signMessage!="function"||!("publicKey"in R)||typeof R!="object"||!R.publicKey||!("toBase58"in R.publicKey)||typeof R.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");b=[`${W.host} wants you to sign in with your Solana account:`,R.publicKey.toBase58(),...B?["",B,""]:[""],"Version: 1",`URI: ${W.href}`,`Issued At: ${(i=(s=V?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((a=V?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${V.signInWithSolana.notBefore}`]:[],...!((o=V?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${V.signInWithSolana.expirationTime}`]:[],...!((l=V?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${V.signInWithSolana.chainId}`]:[],...!((c=V?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${V.signInWithSolana.nonce}`]:[],...!((d=V?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${V.signInWithSolana.requestId}`]:[],...!((m=(h=V?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||m===void 0)&&m.length?["Resources",...V.signInWithSolana.resources.map(Y=>`- ${Y}`)]:[]].join(`
`);const _=await R.signMessage(new TextEncoder().encode(b),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=_}}try{const{data:v,error:S}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:b,signature:mg(x)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:ja});if(S)throw S;if(!v||!v.session||!v.user){const B=new $g;return this._returnResult({data:{user:null,session:null},error:B})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:S})}catch(v){if(yt(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const t=await qd(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:a,error:o}=await _t(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ja});if(await Rc(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!a||!a.session||!a.user){const l=new $g;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:o})}catch(a){if(yt(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:a,nonce:o}=e,l=await _t(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:ja}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const h=new $g;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(t){if(yt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,i,a,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await eu(this.storage,this.storageKey));const{error:m}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:h}=await _t(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(a=c?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:h})}throw new QI("You must provide either an email or phone number.")}catch(l){if(yt(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var t,s;try{let i,a;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,a=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:l}=await _t(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:ja});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,s,i,a,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await eu(this.storage,this.storageKey));const d=await _t(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:g3});return!((a=d.data)===null||a===void 0)&&a.url&&qs()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(l){if(yt(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new _a;const{error:i}=await _t(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(yt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:a}=e,{error:o}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:s,type:i,options:a}=e,{data:o,error:l}=await _t(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:l})}throw new QI("You must provide either an email or phone number and a type")}catch(t){if(yt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await qd(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<kb:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await qd(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Vb()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=o3(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ec}):await this._useSession(async t=>{var s,i,a;const{data:o,error:l}=t;if(l)throw l;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new _a}:await _t(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:Ec})})}catch(t){if(yt(t))return FL(t)&&(await this._removeSession(),await Rc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:a}=s;if(a)throw a;if(!i.session)throw new _a;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await eu(this.storage,this.storageKey));const{data:d,error:h}=await _t(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Ec});if(h)throw h;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(yt(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new _a;const t=Date.now()/1e3;let s=t,i=!0,a=null;const{payload:o}=Wb(e.access_token);if(o.exp&&(s=o.exp,i=s<=t),i){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};a=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;a={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(t){if(yt(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new _a;const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(yt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!qs())throw new qI("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qI(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Wk("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qI("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Wk("No code detected.");const{data:B,error:V}=await this._exchangeCodeForSession(e.code);if(V)throw V;const R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:B.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:a,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!a||!l||!o||!d)throw new qI("No session defined in URL");const h=Math.round(Date.now()/1e3),m=parseInt(l);let f=h+m;c&&(f=parseInt(c));const p=f-h;p*1e3<=hu&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${m}s`);const b=f-m;h-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,f,h):h-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,f,h);const{data:x,error:v}=await this._getUser(a);if(v)throw v;const S={provider_token:s,provider_refresh_token:i,access_token:a,expires_in:m,expires_at:f,refresh_token:o,token_type:d,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:S,redirectType:e.type},error:null})}catch(s){if(yt(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await qd(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:a}=t;if(a)return this._returnResult({error:a});const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(YL(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await Rc(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=KL(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:a},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await eu(this.storage,this.storageKey,!0));try{return await _t(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(yt(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:i}=await this._useSession(async a=>{var o,l,c,d,h;const{data:m,error:f}=a;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await _t(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return qs()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:e.provider,url:s?.url},error:null})}catch(s){if(yt(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:i,data:{session:a}}=t;if(i)throw i;const{options:o,provider:l,token:c,access_token:d,nonce:h}=e,m=await _t(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=a?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:l,id_token:c,access_token:d,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:ja}),{data:f,error:p}=m;return p?this._returnResult({data:{user:null,session:null},error:p}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new $g}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:p}))}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:a,error:o}=t;if(o)throw o;return await _t(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await QL(async i=>(i>0&&await UL(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await _t(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ja})),(i,a)=>{const o=200*Math.pow(2,i);return a&&Rb(a)&&Date.now()+o-s<hu})}catch(s){if(this._debug(t,"error",s),yt(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),qs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await qd(this.storage,this.storageKey);if(i&&this.userStorage){let o=await qd(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await mu(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o?.user)!==null&&e!==void 0?e:Vb()}else if(i&&!i.user&&!i.user){const o=await qd(this.storage,this.storageKey+"-user");o&&o?.user?(i.user=o.user,await Rc(this.storage,this.storageKey+"-user"),await mu(this.storage,this.storageKey,i)):i.user=Vb()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const a=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<kb;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${kb}s`),a){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Rb(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&o?.user?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new _a;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ip;const{data:a,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!a.session)throw new _a;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const l={data:a.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(a){if(this._debug(i,"error",a),yt(a)){const o={data:null,error:a};return Rb(a)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){a.push(c)}});if(await Promise.all(o),a.length>0){for(let l=0;l<a.length;l+=1)console.error(a[l]);throw a[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await mu(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const a=Jk(i);await mu(this.storage,this.storageKey,a)}else{const i=Jk(t);await mu(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Rc(this.storage,this.storageKey),await Rc(this.storage,this.storageKey+"-code-verifier"),await Rc(this.storage,this.storageKey+"-user"),this.userStorage&&await Rc(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qs()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),hu);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/hu);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${hu}ms, refresh threshold is ${Xw} ticks`),i<=Xw&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof CM)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qs()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[a,o]=await eu(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(s?.queryParams){const a=new URLSearchParams(s.queryParams);i.push(a.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;return a?this._returnResult({data:null,error:a}):await _t(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:a,error:o}=t;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await _t(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=a?.session)===null||s===void 0?void 0:s.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?G3(e.webauthn.credential_response):B3(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=await _t(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:w3(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Z3(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=t?.factors)!==null&&e!==void 0?e:[])i.all.push(a),a.status==="verified"&&i[a.factor_type].push(a);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Wb(s.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(h=>h.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(l="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:i}=t;return i?this._returnResult({data:null,error:i}):s?await _t(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new _a})})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new _a});const o=await _t(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&qs()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if(yt(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:i},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new _a});const o=await _t(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&qs()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(s){if(yt(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(l=>l.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(l=>l.kid===e),s&&this.jwks_cached_at+XL>i)return s;const{data:a,error:o}=await _t(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=i,s=a.keys.find(l=>l.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:p,error:b}=await this.getSession();if(b||!p.session)return this._returnResult({data:null,error:b});s=p.session.access_token}const{header:i,payload:a,signature:o,raw:{header:l,payload:c}}=Wb(s);t?.allowExpired||r3(a.exp);const d=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!d){const{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:a,header:i,signature:o},error:null}}const h=i3(i.alg),m=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,m,o,LL(`${l}.${c}`)))throw new Fw("Invalid JWT signature");return{data:{claims:a,header:i,signature:o},error:null}}catch(s){if(yt(s))return this._returnResult({data:null,error:s});throw s}}}ym.nextInstanceID={};const J3=ym;class Y3 extends J3{constructor(e){super(e)}}class F3{constructor(e,t,s){var i,a,o;this.supabaseUrl=e,this.supabaseKey=t;const l=RL(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:xL,realtime:wL,auth:Object.assign(Object.assign({},SL),{storageKey:c}),global:vL},h=kL(s??{},d);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=BL(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new W9(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new AL(this.storageUrl.href,this.headers,this.fetch,s?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new B9(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:a,storageKey:o,flowType:l,lock:c,debug:d,throwOnError:h},m,f){const p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Y3({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),m),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,userStorage:a,flowType:l,lock:c,debug:d,throwOnError:h,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new z9(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const M3=(n,e,t)=>new F3(n,e,t);function H3(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}H3()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const AM="https://nuvbqinadhtrontvyuuh.supabase.co",bM="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51dmJxaW5hZGh0cm9udHZ5dXVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAyODIsImV4cCI6MjA4MTA0NjI4Mn0.vH-QCahvp-Btc3118cz8S0K_zH8yncMpnHcZPW7a8hk",T3=AM,E3=bM,ve=M3(T3,E3,{auth:{persistSession:!0,storage:window.localStorage,autoRefreshToken:!0,detectSessionInUrl:!0},global:{multiTab:!1}}),D3=Object.freeze(Object.defineProperty({__proto__:null,supabase:ve,supabaseAnonKey:bM,supabaseUrl:AM},Symbol.toStringTag,{value:"Module"})),L3=async n=>{try{let{data:e,error:t}=await ve.from("users").select("*, role_id").eq("id",n.id).single();if(t&&t.code==="PGRST116"){const s={id:n.id,name:n.user_metadata.name||"New User",email:n.email,role_id:"unverified"},{data:i,error:a}=await ve.from("users").insert(s).select("*, role_id").single();if(a)return console.error("Error creating user profile on-the-fly:",a.message,a),null;e=i,t=null}return t?(console.error("Error fetching app profile:",t.message,t),null):{id:e.id,name:e.name,email:n.email||"",phone:e.phone,role:e.role_id,organizationId:e.organization_id,organizationName:e.organization_name,reportingManagerId:e.reporting_manager_id,photoUrl:e.photo_url}}catch(e){return console.error("Exception fetching profile:",e),null}},P3=async(n,e)=>await ve.auth.signInWithPassword({email:n,password:e}),K3=async n=>{const{email:e,password:t,options:s}=n;return await ve.auth.signUp({email:e,password:t,options:{...s,emailRedirectTo:`${window.location.origin}/`}})},O3=async(n,e)=>await ve.from("users").update({role_id:e}).eq("id",n),z3=async()=>await ve.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}}),U3=async()=>{const{error:n}=await ve.auth.signOut();n&&console.error("Error signing out:",n.message)},Q3=async n=>{const e=window.location.origin;return await ve.auth.resetPasswordForEmail(n,{redirectTo:e})},q3=async n=>await ve.auth.updateUser({password:n}),Ja={getAppUserProfile:L3,signInWithPassword:P3,signUpWithPassword:K3,signInWithGoogle:z3,signOut:U3,resetPasswordForEmail:Q3,updateUserPassword:q3,approveUser:O3},$3="modulepreload",eP=function(n,e){return new URL(n,e).href},Dk={},Ru=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let d=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");i=d(t.map(h=>{if(h=eP(h,s),h in Dk)return;Dk[h]=!0;const m=h.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(s)for(let b=o.length-1;b>=0;b--){const x=o[b];if(x.href===h&&(!m||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${f}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":$3,m||(p.as="script"),p.crossOrigin="",p.href=h,c&&p.setAttribute("nonce",c),document.head.appendChild(p),m)return new Promise((b,x)=>{p.addEventListener("load",b),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};function Yt(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function On(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function Zl(n,e){const t=Yt(n);return isNaN(e)?On(n,NaN):(e&&t.setDate(t.getDate()+e),t)}function Cp(n,e){const t=Yt(n);if(isNaN(e))return On(n,NaN);if(!e)return t;const s=t.getDate(),i=On(n,t.getTime());i.setMonth(t.getMonth()+e+1,0);const a=i.getDate();return s>=a?i:(t.setFullYear(i.getFullYear(),i.getMonth(),s),t)}const yM=6048e5,tP=864e5,fp=6e4,QZ=36e5,nP=1e3,$I=43200,Lk=1440;let sP={};function ad(){return sP}function Vo(n,e){const t=ad(),s=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=Yt(n),a=i.getDay(),o=(a<s?7:0)+a-s;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function Wu(n){return Vo(n,{weekStartsOn:1})}function vM(n){const e=Yt(n),t=e.getFullYear(),s=On(n,0);s.setFullYear(t+1,0,4),s.setHours(0,0,0,0);const i=Wu(s),a=On(n,0);a.setFullYear(t,0,4),a.setHours(0,0,0,0);const o=Wu(a);return e.getTime()>=i.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function $c(n){const e=Yt(n);return e.setHours(0,0,0,0),e}function Vu(n){const e=Yt(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function Tm(n,e){const t=$c(n),s=$c(e),i=+t-Vu(t),a=+s-Vu(s);return Math.round((i-a)/tP)}function rP(n){const e=vM(n),t=On(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Wu(t)}function Af(n,e){const t=Yt(n),s=Yt(e),i=t.getTime()-s.getTime();return i<0?-1:i>0?1:i}function iP(n){return On(n,Date.now())}function vu(n,e){const t=$c(n),s=$c(e);return+t==+s}function aP(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function oP(n){if(!aP(n)&&typeof n!="number")return!1;const e=Yt(n);return!isNaN(Number(e))}function lP(n,e){const t=Yt(n),s=Yt(e),i=t.getFullYear()-s.getFullYear(),a=t.getMonth()-s.getMonth();return i*12+a}function cP(n,e){const t=Yt(n),s=Yt(e),i=Pk(t,s),a=Math.abs(Tm(t,s));t.setDate(t.getDate()-i*a);const o=+(Pk(t,s)===-i),l=i*(a-o);return l===0?0:l}function Pk(n,e){const t=n.getFullYear()-e.getFullYear()||n.getMonth()-e.getMonth()||n.getDate()-e.getDate()||n.getHours()-e.getHours()||n.getMinutes()-e.getMinutes()||n.getSeconds()-e.getSeconds()||n.getMilliseconds()-e.getMilliseconds();return t<0?-1:t>0?1:t}function xM(n){return e=>{const s=(n?Math[n]:Math.trunc)(e);return s===0?0:s}}function SM(n,e){return+Yt(n)-+Yt(e)}function Uc(n,e,t){const s=SM(n,e)/fp;return xM(t?.roundingMethod)(s)}function qZ(n){const e=Yt(n);return e.setHours(23,59,59,999),e}function Ha(n){const e=Yt(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function dP(n){const e=Yt(n);return+qZ(e)==+Ha(e)}function gP(n,e){const t=Yt(n),s=Yt(e),i=Af(t,s),a=Math.abs(lP(t,s));let o;if(a<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-i*a);let l=Af(t,s)===-i;dP(Yt(n))&&a===1&&Af(n,s)===1&&(l=!1),o=i*(a-Number(l))}return o===0?0:o}function uP(n,e,t){const s=SM(n,e)/1e3;return xM(t?.roundingMethod)(s)}function wo(n,e){const t=Yt(n.start),s=Yt(n.end);let i=+t>+s;const a=i?+t:+s,o=i?s:t;o.setHours(0,0,0,0);let l=1;const c=[];for(;+o<=a;)c.push(Yt(o)),o.setDate(o.getDate()+l),o.setHours(0,0,0,0);return i?c.reverse():c}function Si(n){const e=Yt(n);return e.setDate(1),e.setHours(0,0,0,0),e}function hP(n){const e=Yt(n),t=e.getFullYear();return e.setFullYear(t+1,0,0),e.setHours(23,59,59,999),e}function wM(n){const e=Yt(n),t=On(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}function Kk(n,e){const t=ad(),s=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,i=Yt(n),a=i.getDay(),o=(a<s?-7:0)+6-(a-s);return i.setDate(i.getDate()+o),i.setHours(23,59,59,999),i}function jb(){return qZ(Date.now())}const mP={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},IP=(n,e,t)=>{let s;const i=mP[n];return typeof i=="string"?s=i:e===1?s=i.one:s=i.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function Xb(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const CP={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},fP={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},pP={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},AP={date:Xb({formats:CP,defaultWidth:"full"}),time:Xb({formats:fP,defaultWidth:"full"}),dateTime:Xb({formats:pP,defaultWidth:"full"})},bP={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},yP=(n,e,t,s)=>bP[n];function Bh(n){return(e,t)=>{const s=t?.context?String(t.context):"standalone";let i;if(s==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,l=t?.width?String(t.width):o;i=n.formattingValues[l]||n.formattingValues[o]}else{const o=n.defaultWidth,l=t?.width?String(t.width):n.defaultWidth;i=n.values[l]||n.values[o]}const a=n.argumentCallback?n.argumentCallback(e):e;return i[a]}}const vP={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xP={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},SP={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},wP={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ZP={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},GP={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},BP=(n,e)=>{const t=Number(n),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},NP={ordinalNumber:BP,era:Bh({values:vP,defaultWidth:"wide"}),quarter:Bh({values:xP,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Bh({values:SP,defaultWidth:"wide"}),day:Bh({values:wP,defaultWidth:"wide"}),dayPeriod:Bh({values:ZP,defaultWidth:"wide",formattingValues:GP,defaultFormattingWidth:"wide"})};function Nh(n){return(e,t={})=>{const s=t.width,i=s&&n.matchPatterns[s]||n.matchPatterns[n.defaultMatchWidth],a=e.match(i);if(!a)return null;const o=a[0],l=s&&n.parsePatterns[s]||n.parsePatterns[n.defaultParseWidth],c=Array.isArray(l)?RP(l,m=>m.test(o)):kP(l,m=>m.test(o));let d;d=n.valueCallback?n.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;const h=e.slice(o.length);return{value:d,rest:h}}}function kP(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function RP(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function WP(n){return(e,t={})=>{const s=e.match(n.matchPattern);if(!s)return null;const i=s[0],a=e.match(n.parsePattern);if(!a)return null;let o=n.valueCallback?n.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;const l=e.slice(i.length);return{value:o,rest:l}}}const VP=/^(\d+)(th|st|nd|rd)?/i,_P=/\d+/i,jP={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},XP={any:[/^b/i,/^(a|c)/i]},JP={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},YP={any:[/1/i,/2/i,/3/i,/4/i]},FP={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},MP={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},HP={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},TP={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},EP={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},DP={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},LP={ordinalNumber:WP({matchPattern:VP,parsePattern:_P,valueCallback:n=>parseInt(n,10)}),era:Nh({matchPatterns:jP,defaultMatchWidth:"wide",parsePatterns:XP,defaultParseWidth:"any"}),quarter:Nh({matchPatterns:JP,defaultMatchWidth:"wide",parsePatterns:YP,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Nh({matchPatterns:FP,defaultMatchWidth:"wide",parsePatterns:MP,defaultParseWidth:"any"}),day:Nh({matchPatterns:HP,defaultMatchWidth:"wide",parsePatterns:TP,defaultParseWidth:"any"}),dayPeriod:Nh({matchPatterns:EP,defaultMatchWidth:"any",parsePatterns:DP,defaultParseWidth:"any"})},$Z={code:"en-US",formatDistance:IP,formatLong:AP,formatRelative:yP,localize:NP,match:LP,options:{weekStartsOn:0,firstWeekContainsDate:1}};function PP(n){const e=Yt(n);return Tm(e,wM(e))+1}function ZM(n){const e=Yt(n),t=+Wu(e)-+rP(e);return Math.round(t/yM)+1}function eG(n,e){const t=Yt(n),s=t.getFullYear(),i=ad(),a=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,o=On(n,0);o.setFullYear(s+1,0,a),o.setHours(0,0,0,0);const l=Vo(o,e),c=On(n,0);c.setFullYear(s,0,a),c.setHours(0,0,0,0);const d=Vo(c,e);return t.getTime()>=l.getTime()?s+1:t.getTime()>=d.getTime()?s:s-1}function KP(n,e){const t=ad(),s=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??t.firstWeekContainsDate??t.locale?.options?.firstWeekContainsDate??1,i=eG(n,e),a=On(n,0);return a.setFullYear(i,0,s),a.setHours(0,0,0,0),Vo(a,e)}function GM(n,e){const t=Yt(n),s=+Vo(t,e)-+KP(t,e);return Math.round(s/yM)+1}function Gn(n,e){const t=n<0?"-":"",s=Math.abs(n).toString().padStart(e,"0");return t+s}const Wc={y(n,e){const t=n.getFullYear(),s=t>0?t:1-t;return Gn(e==="yy"?s%100:s,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):Gn(t+1,2)},d(n,e){return Gn(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return Gn(n.getHours()%12||12,e.length)},H(n,e){return Gn(n.getHours(),e.length)},m(n,e){return Gn(n.getMinutes(),e.length)},s(n,e){return Gn(n.getSeconds(),e.length)},S(n,e){const t=e.length,s=n.getMilliseconds(),i=Math.trunc(s*Math.pow(10,t-3));return Gn(i,e.length)}},ru={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ok={G:function(n,e,t){const s=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(s,{width:"abbreviated"});case"GGGGG":return t.era(s,{width:"narrow"});case"GGGG":default:return t.era(s,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const s=n.getFullYear(),i=s>0?s:1-s;return t.ordinalNumber(i,{unit:"year"})}return Wc.y(n,e)},Y:function(n,e,t,s){const i=eG(n,s),a=i>0?i:1-i;if(e==="YY"){const o=a%100;return Gn(o,2)}return e==="Yo"?t.ordinalNumber(a,{unit:"year"}):Gn(a,e.length)},R:function(n,e){const t=vM(n);return Gn(t,e.length)},u:function(n,e){const t=n.getFullYear();return Gn(t,e.length)},Q:function(n,e,t){const s=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return Gn(s,2);case"Qo":return t.ordinalNumber(s,{unit:"quarter"});case"QQQ":return t.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(s,{width:"wide",context:"formatting"})}},q:function(n,e,t){const s=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return Gn(s,2);case"qo":return t.ordinalNumber(s,{unit:"quarter"});case"qqq":return t.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(s,{width:"wide",context:"standalone"})}},M:function(n,e,t){const s=n.getMonth();switch(e){case"M":case"MM":return Wc.M(n,e);case"Mo":return t.ordinalNumber(s+1,{unit:"month"});case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(s,{width:"wide",context:"formatting"})}},L:function(n,e,t){const s=n.getMonth();switch(e){case"L":return String(s+1);case"LL":return Gn(s+1,2);case"Lo":return t.ordinalNumber(s+1,{unit:"month"});case"LLL":return t.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(s,{width:"wide",context:"standalone"})}},w:function(n,e,t,s){const i=GM(n,s);return e==="wo"?t.ordinalNumber(i,{unit:"week"}):Gn(i,e.length)},I:function(n,e,t){const s=ZM(n);return e==="Io"?t.ordinalNumber(s,{unit:"week"}):Gn(s,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):Wc.d(n,e)},D:function(n,e,t){const s=PP(n);return e==="Do"?t.ordinalNumber(s,{unit:"dayOfYear"}):Gn(s,e.length)},E:function(n,e,t){const s=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"});case"EEEE":default:return t.day(s,{width:"wide",context:"formatting"})}},e:function(n,e,t,s){const i=n.getDay(),a=(i-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return Gn(a,2);case"eo":return t.ordinalNumber(a,{unit:"day"});case"eee":return t.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(i,{width:"short",context:"formatting"});case"eeee":default:return t.day(i,{width:"wide",context:"formatting"})}},c:function(n,e,t,s){const i=n.getDay(),a=(i-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return Gn(a,e.length);case"co":return t.ordinalNumber(a,{unit:"day"});case"ccc":return t.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(i,{width:"narrow",context:"standalone"});case"cccccc":return t.day(i,{width:"short",context:"standalone"});case"cccc":default:return t.day(i,{width:"wide",context:"standalone"})}},i:function(n,e,t){const s=n.getDay(),i=s===0?7:s;switch(e){case"i":return String(i);case"ii":return Gn(i,e.length);case"io":return t.ordinalNumber(i,{unit:"day"});case"iii":return t.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(s,{width:"short",context:"formatting"});case"iiii":default:return t.day(s,{width:"wide",context:"formatting"})}},a:function(n,e,t){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(n,e,t){const s=n.getHours();let i;switch(s===12?i=ru.noon:s===0?i=ru.midnight:i=s/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(n,e,t){const s=n.getHours();let i;switch(s>=17?i=ru.evening:s>=12?i=ru.afternoon:s>=4?i=ru.morning:i=ru.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let s=n.getHours()%12;return s===0&&(s=12),t.ordinalNumber(s,{unit:"hour"})}return Wc.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):Wc.H(n,e)},K:function(n,e,t){const s=n.getHours()%12;return e==="Ko"?t.ordinalNumber(s,{unit:"hour"}):Gn(s,e.length)},k:function(n,e,t){let s=n.getHours();return s===0&&(s=24),e==="ko"?t.ordinalNumber(s,{unit:"hour"}):Gn(s,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):Wc.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):Wc.s(n,e)},S:function(n,e){return Wc.S(n,e)},X:function(n,e,t){const s=n.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return Uk(s);case"XXXX":case"XX":return lg(s);case"XXXXX":case"XXX":default:return lg(s,":")}},x:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"x":return Uk(s);case"xxxx":case"xx":return lg(s);case"xxxxx":case"xxx":default:return lg(s,":")}},O:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+zk(s,":");case"OOOO":default:return"GMT"+lg(s,":")}},z:function(n,e,t){const s=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+zk(s,":");case"zzzz":default:return"GMT"+lg(s,":")}},t:function(n,e,t){const s=Math.trunc(n.getTime()/1e3);return Gn(s,e.length)},T:function(n,e,t){const s=n.getTime();return Gn(s,e.length)}};function zk(n,e=""){const t=n>0?"-":"+",s=Math.abs(n),i=Math.trunc(s/60),a=s%60;return a===0?t+String(i):t+String(i)+e+Gn(a,2)}function Uk(n,e){return n%60===0?(n>0?"-":"+")+Gn(Math.abs(n)/60,2):lg(n,e)}function lg(n,e=""){const t=n>0?"-":"+",s=Math.abs(n),i=Gn(Math.trunc(s/60),2),a=Gn(s%60,2);return t+i+e+a}const Qk=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},BM=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},OP=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],s=t[1],i=t[2];if(!i)return Qk(n,e);let a;switch(s){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",Qk(s,e)).replace("{{time}}",BM(i,e))},Mw={p:BM,P:OP},zP=/^D+$/,UP=/^Y+$/,QP=["D","DD","YY","YYYY"];function NM(n){return zP.test(n)}function kM(n){return UP.test(n)}function Hw(n,e,t){const s=qP(n,e,t);if(console.warn(s),QP.includes(n))throw new RangeError(s)}function qP(n,e,t){const s=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${s} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const $P=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,eK=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,tK=/^'([^]*?)'?$/,nK=/''/g,sK=/[a-zA-Z]/;function He(n,e,t){const s=ad(),i=s.locale??$Z,a=s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,o=s.weekStartsOn??s.locale?.options?.weekStartsOn??0,l=Yt(n);if(!oP(l))throw new RangeError("Invalid time value");let c=e.match(eK).map(h=>{const m=h[0];if(m==="p"||m==="P"){const f=Mw[m];return f(h,i.formatLong)}return h}).join("").match($P).map(h=>{if(h==="''")return{isToken:!1,value:"'"};const m=h[0];if(m==="'")return{isToken:!1,value:rK(h)};if(Ok[m])return{isToken:!0,value:h};if(m.match(sK))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");return{isToken:!1,value:h}});i.localize.preprocessor&&(c=i.localize.preprocessor(l,c));const d={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return c.map(h=>{if(!h.isToken)return h.value;const m=h.value;(kM(m)||NM(m))&&Hw(m,e,String(n));const f=Ok[m[0]];return f(l,m,i.localize,d)}).join("")}function rK(n){const e=n.match(tK);return e?e[1].replace(nK,"'"):n}function iK(n,e,t){const s=ad(),i=t?.locale??s.locale??$Z,a=2520,o=Af(n,e);if(isNaN(o))throw new RangeError("Invalid time value");const l=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:o});let c,d;o>0?(c=Yt(e),d=Yt(n)):(c=Yt(n),d=Yt(e));const h=uP(d,c),m=(Vu(d)-Vu(c))/1e3,f=Math.round((h-m)/60);let p;if(f<2)return t?.includeSeconds?h<5?i.formatDistance("lessThanXSeconds",5,l):h<10?i.formatDistance("lessThanXSeconds",10,l):h<20?i.formatDistance("lessThanXSeconds",20,l):h<40?i.formatDistance("halfAMinute",0,l):h<60?i.formatDistance("lessThanXMinutes",1,l):i.formatDistance("xMinutes",1,l):f===0?i.formatDistance("lessThanXMinutes",1,l):i.formatDistance("xMinutes",f,l);if(f<45)return i.formatDistance("xMinutes",f,l);if(f<90)return i.formatDistance("aboutXHours",1,l);if(f<Lk){const b=Math.round(f/60);return i.formatDistance("aboutXHours",b,l)}else{if(f<a)return i.formatDistance("xDays",1,l);if(f<$I){const b=Math.round(f/Lk);return i.formatDistance("xDays",b,l)}else if(f<$I*2)return p=Math.round(f/$I),i.formatDistance("aboutXMonths",p,l)}if(p=gP(d,c),p<12){const b=Math.round(f/$I);return i.formatDistance("xMonths",b,l)}else{const b=p%12,x=Math.trunc(p/12);return b<3?i.formatDistance("aboutXYears",x,l):b<9?i.formatDistance("overXYears",x,l):i.formatDistance("almostXYears",x+1,l)}}function Vl(n,e){return iK(n,iP(n),e)}function tG(n){return Yt(n).getDay()}function aK(){return Object.assign({},ad())}function oK(n){let t=Yt(n).getDay();return t===0&&(t=7),t}function lK(n,e){const t=Yt(n),s=Yt(e);return t.getTime()>s.getTime()}function cK(n,e){const t=e instanceof Date?On(e,0):new e(0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),t}const dK=10;let RM=class{subPriority=0;validate(e,t){return!0}};class gK extends RM{constructor(e,t,s,i,a){super(),this.value=e,this.validateValue=t,this.setValue=s,this.priority=i,a&&(this.subPriority=a)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,s){return this.setValue(e,t,this.value,s)}}class uK extends RM{priority=dK;subPriority=-1;set(e,t){return t.timestampIsSet?e:On(e,cK(e,Date))}}let bn=class{run(e,t,s,i){const a=this.parse(e,t,s,i);return a?{setter:new gK(a.value,this.validate,this.set,this.priority,this.subPriority),rest:a.rest}:null}validate(e,t,s){return!0}},hK=class extends bn{priority=140;parse(e,t,s){switch(t){case"G":case"GG":case"GGG":return s.era(e,{width:"abbreviated"})||s.era(e,{width:"narrow"});case"GGGGG":return s.era(e,{width:"narrow"});case"GGGG":default:return s.era(e,{width:"wide"})||s.era(e,{width:"abbreviated"})||s.era(e,{width:"narrow"})}}set(e,t,s){return t.era=s,e.setFullYear(s,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]};const gs={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Zo={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function us(n,e){return n&&{value:e(n.value),rest:n.rest}}function ss(n,e){const t=e.match(n);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function Go(n,e){const t=e.match(n);if(!t)return null;if(t[0]==="Z")return{value:0,rest:e.slice(1)};const s=t[1]==="+"?1:-1,i=t[2]?parseInt(t[2],10):0,a=t[3]?parseInt(t[3],10):0,o=t[5]?parseInt(t[5],10):0;return{value:s*(i*QZ+a*fp+o*nP),rest:e.slice(t[0].length)}}function WM(n){return ss(gs.anyDigitsSigned,n)}function os(n,e){switch(n){case 1:return ss(gs.singleDigit,e);case 2:return ss(gs.twoDigits,e);case 3:return ss(gs.threeDigits,e);case 4:return ss(gs.fourDigits,e);default:return ss(new RegExp("^\\d{1,"+n+"}"),e)}}function Jf(n,e){switch(n){case 1:return ss(gs.singleDigitSigned,e);case 2:return ss(gs.twoDigitsSigned,e);case 3:return ss(gs.threeDigitsSigned,e);case 4:return ss(gs.fourDigitsSigned,e);default:return ss(new RegExp("^-?\\d{1,"+n+"}"),e)}}function nG(n){switch(n){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function VM(n,e){const t=e>0,s=t?e:1-e;let i;if(s<=50)i=n||100;else{const a=s+50,o=Math.trunc(a/100)*100,l=n>=a%100;i=n+o-(l?100:0)}return t?i:1-i}function _M(n){return n%400===0||n%4===0&&n%100!==0}let mK=class extends bn{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,t,s){const i=a=>({year:a,isTwoDigitYear:t==="yy"});switch(t){case"y":return us(os(4,e),i);case"yo":return us(s.ordinalNumber(e,{unit:"year"}),i);default:return us(os(t.length,e),i)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,s){const i=e.getFullYear();if(s.isTwoDigitYear){const o=VM(s.year,i);return e.setFullYear(o,0,1),e.setHours(0,0,0,0),e}const a=!("era"in t)||t.era===1?s.year:1-s.year;return e.setFullYear(a,0,1),e.setHours(0,0,0,0),e}},IK=class extends bn{priority=130;parse(e,t,s){const i=a=>({year:a,isTwoDigitYear:t==="YY"});switch(t){case"Y":return us(os(4,e),i);case"Yo":return us(s.ordinalNumber(e,{unit:"year"}),i);default:return us(os(t.length,e),i)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,s,i){const a=eG(e,i);if(s.isTwoDigitYear){const l=VM(s.year,a);return e.setFullYear(l,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Vo(e,i)}const o=!("era"in t)||t.era===1?s.year:1-s.year;return e.setFullYear(o,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Vo(e,i)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]},CK=class extends bn{priority=130;parse(e,t){return Jf(t==="R"?4:t.length,e)}set(e,t,s){const i=On(e,0);return i.setFullYear(s,0,4),i.setHours(0,0,0,0),Wu(i)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]},fK=class extends bn{priority=130;parse(e,t){return Jf(t==="u"?4:t.length,e)}set(e,t,s){return e.setFullYear(s,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]},pK=class extends bn{priority=120;parse(e,t,s){switch(t){case"Q":case"QQ":return os(t.length,e);case"Qo":return s.ordinalNumber(e,{unit:"quarter"});case"QQQ":return s.quarter(e,{width:"abbreviated",context:"formatting"})||s.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(e,{width:"wide",context:"formatting"})||s.quarter(e,{width:"abbreviated",context:"formatting"})||s.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,s){return e.setMonth((s-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]},AK=class extends bn{priority=120;parse(e,t,s){switch(t){case"q":case"qq":return os(t.length,e);case"qo":return s.ordinalNumber(e,{unit:"quarter"});case"qqq":return s.quarter(e,{width:"abbreviated",context:"standalone"})||s.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(e,{width:"wide",context:"standalone"})||s.quarter(e,{width:"abbreviated",context:"standalone"})||s.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,s){return e.setMonth((s-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]},bK=class extends bn{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,t,s){const i=a=>a-1;switch(t){case"M":return us(ss(gs.month,e),i);case"MM":return us(os(2,e),i);case"Mo":return us(s.ordinalNumber(e,{unit:"month"}),i);case"MMM":return s.month(e,{width:"abbreviated",context:"formatting"})||s.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(e,{width:"wide",context:"formatting"})||s.month(e,{width:"abbreviated",context:"formatting"})||s.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.setMonth(s,1),e.setHours(0,0,0,0),e}},yK=class extends bn{priority=110;parse(e,t,s){const i=a=>a-1;switch(t){case"L":return us(ss(gs.month,e),i);case"LL":return us(os(2,e),i);case"Lo":return us(s.ordinalNumber(e,{unit:"month"}),i);case"LLL":return s.month(e,{width:"abbreviated",context:"standalone"})||s.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(e,{width:"wide",context:"standalone"})||s.month(e,{width:"abbreviated",context:"standalone"})||s.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.setMonth(s,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};function vK(n,e,t){const s=Yt(n),i=GM(s,t)-e;return s.setDate(s.getDate()-i*7),s}let xK=class extends bn{priority=100;parse(e,t,s){switch(t){case"w":return ss(gs.week,e);case"wo":return s.ordinalNumber(e,{unit:"week"});default:return os(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,s,i){return Vo(vK(e,s,i),i)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};function SK(n,e){const t=Yt(n),s=ZM(t)-e;return t.setDate(t.getDate()-s*7),t}let wK=class extends bn{priority=100;parse(e,t,s){switch(t){case"I":return ss(gs.week,e);case"Io":return s.ordinalNumber(e,{unit:"week"});default:return os(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,s){return Wu(SK(e,s))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};const ZK=[31,28,31,30,31,30,31,31,30,31,30,31],GK=[31,29,31,30,31,30,31,31,30,31,30,31];let BK=class extends bn{priority=90;subPriority=1;parse(e,t,s){switch(t){case"d":return ss(gs.date,e);case"do":return s.ordinalNumber(e,{unit:"date"});default:return os(t.length,e)}}validate(e,t){const s=e.getFullYear(),i=_M(s),a=e.getMonth();return i?t>=1&&t<=GK[a]:t>=1&&t<=ZK[a]}set(e,t,s){return e.setDate(s),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]},NK=class extends bn{priority=90;subpriority=1;parse(e,t,s){switch(t){case"D":case"DD":return ss(gs.dayOfYear,e);case"Do":return s.ordinalNumber(e,{unit:"date"});default:return os(t.length,e)}}validate(e,t){const s=e.getFullYear();return _M(s)?t>=1&&t<=366:t>=1&&t<=365}set(e,t,s){return e.setMonth(0,s),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};function sG(n,e,t){const s=ad(),i=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,a=Yt(n),o=a.getDay(),c=(e%7+7)%7,d=7-i,h=e<0||e>6?e-(o+d)%7:(c+d)%7-(o+d)%7;return Zl(a,h)}let kK=class extends bn{priority=90;parse(e,t,s){switch(t){case"E":case"EE":case"EEE":return s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,i){return e=sG(e,s,i),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]},RK=class extends bn{priority=90;parse(e,t,s,i){const a=o=>{const l=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+l};switch(t){case"e":case"ee":return us(os(t.length,e),a);case"eo":return us(s.ordinalNumber(e,{unit:"day"}),a);case"eee":return s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"eeeee":return s.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,i){return e=sG(e,s,i),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]},WK=class extends bn{priority=90;parse(e,t,s,i){const a=o=>{const l=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+l};switch(t){case"c":case"cc":return us(os(t.length,e),a);case"co":return us(s.ordinalNumber(e,{unit:"day"}),a);case"ccc":return s.day(e,{width:"abbreviated",context:"standalone"})||s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"});case"ccccc":return s.day(e,{width:"narrow",context:"standalone"});case"cccccc":return s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(e,{width:"wide",context:"standalone"})||s.day(e,{width:"abbreviated",context:"standalone"})||s.day(e,{width:"short",context:"standalone"})||s.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,s,i){return e=sG(e,s,i),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};function VK(n,e){const t=Yt(n),s=oK(t),i=e-s;return Zl(t,i)}let _K=class extends bn{priority=90;parse(e,t,s){const i=a=>a===0?7:a;switch(t){case"i":case"ii":return os(t.length,e);case"io":return s.ordinalNumber(e,{unit:"day"});case"iii":return us(s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),i);case"iiiii":return us(s.day(e,{width:"narrow",context:"formatting"}),i);case"iiiiii":return us(s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),i);case"iiii":default:return us(s.day(e,{width:"wide",context:"formatting"})||s.day(e,{width:"abbreviated",context:"formatting"})||s.day(e,{width:"short",context:"formatting"})||s.day(e,{width:"narrow",context:"formatting"}),i)}}validate(e,t){return t>=1&&t<=7}set(e,t,s){return e=VK(e,s),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]},jK=class extends bn{priority=80;parse(e,t,s){switch(t){case"a":case"aa":case"aaa":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(nG(s),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]},XK=class extends bn{priority=80;parse(e,t,s){switch(t){case"b":case"bb":case"bbb":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(nG(s),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]},JK=class extends bn{priority=80;parse(e,t,s){switch(t){case"B":case"BB":case"BBB":return s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(e,{width:"wide",context:"formatting"})||s.dayPeriod(e,{width:"abbreviated",context:"formatting"})||s.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,s){return e.setHours(nG(s),0,0,0),e}incompatibleTokens=["a","b","t","T"]},YK=class extends bn{priority=70;parse(e,t,s){switch(t){case"h":return ss(gs.hour12h,e);case"ho":return s.ordinalNumber(e,{unit:"hour"});default:return os(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,s){const i=e.getHours()>=12;return i&&s<12?e.setHours(s+12,0,0,0):!i&&s===12?e.setHours(0,0,0,0):e.setHours(s,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]},FK=class extends bn{priority=70;parse(e,t,s){switch(t){case"H":return ss(gs.hour23h,e);case"Ho":return s.ordinalNumber(e,{unit:"hour"});default:return os(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,s){return e.setHours(s,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]},MK=class extends bn{priority=70;parse(e,t,s){switch(t){case"K":return ss(gs.hour11h,e);case"Ko":return s.ordinalNumber(e,{unit:"hour"});default:return os(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,s){return e.getHours()>=12&&s<12?e.setHours(s+12,0,0,0):e.setHours(s,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]},HK=class extends bn{priority=70;parse(e,t,s){switch(t){case"k":return ss(gs.hour24h,e);case"ko":return s.ordinalNumber(e,{unit:"hour"});default:return os(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,s){const i=s<=24?s%24:s;return e.setHours(i,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]},TK=class extends bn{priority=60;parse(e,t,s){switch(t){case"m":return ss(gs.minute,e);case"mo":return s.ordinalNumber(e,{unit:"minute"});default:return os(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,s){return e.setMinutes(s,0,0),e}incompatibleTokens=["t","T"]},EK=class extends bn{priority=50;parse(e,t,s){switch(t){case"s":return ss(gs.second,e);case"so":return s.ordinalNumber(e,{unit:"second"});default:return os(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,s){return e.setSeconds(s,0),e}incompatibleTokens=["t","T"]},DK=class extends bn{priority=30;parse(e,t){const s=i=>Math.trunc(i*Math.pow(10,-t.length+3));return us(os(t.length,e),s)}set(e,t,s){return e.setMilliseconds(s),e}incompatibleTokens=["t","T"]},LK=class extends bn{priority=10;parse(e,t){switch(t){case"X":return Go(Zo.basicOptionalMinutes,e);case"XX":return Go(Zo.basic,e);case"XXXX":return Go(Zo.basicOptionalSeconds,e);case"XXXXX":return Go(Zo.extendedOptionalSeconds,e);case"XXX":default:return Go(Zo.extended,e)}}set(e,t,s){return t.timestampIsSet?e:On(e,e.getTime()-Vu(e)-s)}incompatibleTokens=["t","T","x"]},PK=class extends bn{priority=10;parse(e,t){switch(t){case"x":return Go(Zo.basicOptionalMinutes,e);case"xx":return Go(Zo.basic,e);case"xxxx":return Go(Zo.basicOptionalSeconds,e);case"xxxxx":return Go(Zo.extendedOptionalSeconds,e);case"xxx":default:return Go(Zo.extended,e)}}set(e,t,s){return t.timestampIsSet?e:On(e,e.getTime()-Vu(e)-s)}incompatibleTokens=["t","T","X"]},KK=class extends bn{priority=40;parse(e){return WM(e)}set(e,t,s){return[On(e,s*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"},OK=class extends bn{priority=20;parse(e){return WM(e)}set(e,t,s){return[On(e,s),{timestampIsSet:!0}]}incompatibleTokens="*"};const zK={G:new hK,y:new mK,Y:new IK,R:new CK,u:new fK,Q:new pK,q:new AK,M:new bK,L:new yK,w:new xK,I:new wK,d:new BK,D:new NK,E:new kK,e:new RK,c:new WK,i:new _K,a:new jK,b:new XK,B:new JK,h:new YK,H:new FK,K:new MK,k:new HK,m:new TK,s:new EK,S:new DK,X:new LK,x:new PK,t:new KK,T:new OK},UK=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,QK=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qK=/^'([^]*?)'?$/,$K=/''/g,eO=/\S/,tO=/[a-zA-Z]/;function nO(n,e,t,s){const i=aK(),a=i.locale??$Z,o=i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,l=i.weekStartsOn??i.locale?.options?.weekStartsOn??0;if(e==="")return n===""?Yt(t):On(t,NaN);const c={firstWeekContainsDate:o,weekStartsOn:l,locale:a},d=[new uK],h=e.match(QK).map(x=>{const v=x[0];if(v in Mw){const S=Mw[v];return S(x,a.formatLong)}return x}).join("").match(UK),m=[];for(let x of h){kM(x)&&Hw(x,e,n),NM(x)&&Hw(x,e,n);const v=x[0],S=zK[v];if(S){const{incompatibleTokens:B}=S;if(Array.isArray(B)){const R=m.find(W=>B.includes(W.token)||W.token===v);if(R)throw new RangeError(`The format string mustn't contain \`${R.fullToken}\` and \`${x}\` at the same time`)}else if(S.incompatibleTokens==="*"&&m.length>0)throw new RangeError(`The format string mustn't contain \`${x}\` and any other token at the same time`);m.push({token:v,fullToken:x});const V=S.run(n,x,a.match,c);if(!V)return On(t,NaN);d.push(V.setter),n=V.rest}else{if(v.match(tO))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");if(x==="''"?x="'":v==="'"&&(x=sO(x)),n.indexOf(x)===0)n=n.slice(x.length);else return On(t,NaN)}}if(n.length>0&&eO.test(n))return On(t,NaN);const f=d.map(x=>x.priority).sort((x,v)=>v-x).filter((x,v,S)=>S.indexOf(x)===v).map(x=>d.filter(v=>v.priority===x).sort((v,S)=>S.subPriority-v.subPriority)).map(x=>x[0]);let p=Yt(t);if(isNaN(p.getTime()))return On(t,NaN);const b={};for(const x of f){if(!x.validate(p,c))return On(t,NaN);const v=x.set(p,b,c);Array.isArray(v)?(p=v[0],Object.assign(b,v[1])):p=v}return On(t,p)}function sO(n){return n.match(qK)[1].replace($K,"'")}function xu(n,e){return Zl(n,-e)}function Vc(n,e){const s=oO(n);let i;if(s.date){const c=lO(s.date,2);i=cO(c.restDateString,c.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const a=i.getTime();let o=0,l;if(s.time&&(o=dO(s.time),isNaN(o)))return new Date(NaN);if(s.timezone){if(l=gO(s.timezone),isNaN(l))return new Date(NaN)}else{const c=new Date(a+o),d=new Date(0);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return new Date(a+o+l)}const eC={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},rO=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,iO=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,aO=/^([+-])(\d{2})(?::?(\d{2}))?$/;function oO(n){const e={},t=n.split(eC.dateTimeDelimiter);let s;if(t.length>2)return e;if(/:/.test(t[0])?s=t[0]:(e.date=t[0],s=t[1],eC.timeZoneDelimiter.test(e.date)&&(e.date=n.split(eC.timeZoneDelimiter)[0],s=n.substr(e.date.length,n.length))),s){const i=eC.timezone.exec(s);i?(e.time=s.replace(i[1],""),e.timezone=i[1]):e.time=s}return e}function lO(n,e){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),s=n.match(t);if(!s)return{year:NaN,restDateString:""};const i=s[1]?parseInt(s[1]):null,a=s[2]?parseInt(s[2]):null;return{year:a===null?i:a*100,restDateString:n.slice((s[1]||s[2]).length)}}function cO(n,e){if(e===null)return new Date(NaN);const t=n.match(rO);if(!t)return new Date(NaN);const s=!!t[4],i=kh(t[1]),a=kh(t[2])-1,o=kh(t[3]),l=kh(t[4]),c=kh(t[5])-1;if(s)return CO(e,l,c)?uO(e,l,c):new Date(NaN);{const d=new Date(0);return!mO(e,a,o)||!IO(e,i)?new Date(NaN):(d.setUTCFullYear(e,a,Math.max(i,o)),d)}}function kh(n){return n?parseInt(n):1}function dO(n){const e=n.match(iO);if(!e)return NaN;const t=Jb(e[1]),s=Jb(e[2]),i=Jb(e[3]);return fO(t,s,i)?t*QZ+s*fp+i*1e3:NaN}function Jb(n){return n&&parseFloat(n.replace(",","."))||0}function gO(n){if(n==="Z")return 0;const e=n.match(aO);if(!e)return 0;const t=e[1]==="+"?-1:1,s=parseInt(e[2]),i=e[3]&&parseInt(e[3])||0;return pO(s,i)?t*(s*QZ+i*fp):NaN}function uO(n,e,t){const s=new Date(0);s.setUTCFullYear(n,0,4);const i=s.getUTCDay()||7,a=(e-1)*7+t+1-i;return s.setUTCDate(s.getUTCDate()+a),s}const hO=[31,null,31,30,31,30,31,31,30,31,30,31];function jM(n){return n%400===0||n%4===0&&n%100!==0}function mO(n,e,t){return e>=0&&e<=11&&t>=1&&t<=(hO[e]||(jM(n)?29:28))}function IO(n,e){return e>=1&&e<=(jM(n)?366:365)}function CO(n,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function fO(n,e,t){return n===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&n>=0&&n<25}function pO(n,e){return e>=0&&e<=59}function bf(){return $c(Date.now())}function rG(n,e){return Cp(n,-1)}var In;(function(n){n.assertEqual=i=>{};function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const a={};for(const o of i)a[o]=o;return a},n.getValidEnumValues=i=>{const a=n.objectKeys(i).filter(l=>typeof i[i[l]]!="number"),o={};for(const l of a)o[l]=i[l];return n.objectValues(o)},n.objectValues=i=>n.objectKeys(i).map(function(a){return i[a]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&a.push(o);return a},n.find=(i,a)=>{for(const o of i)if(a(o))return o},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function s(i,a=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}n.joinValues=s,n.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(In||(In={}));var qk;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(qk||(qk={}));const ht=In.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Tc=n=>{switch(typeof n){case"undefined":return ht.undefined;case"string":return ht.string;case"number":return Number.isNaN(n)?ht.nan:ht.number;case"boolean":return ht.boolean;case"function":return ht.function;case"bigint":return ht.bigint;case"symbol":return ht.symbol;case"object":return Array.isArray(n)?ht.array:n===null?ht.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ht.promise:typeof Map<"u"&&n instanceof Map?ht.map:typeof Set<"u"&&n instanceof Set?ht.set:typeof Date<"u"&&n instanceof Date?ht.date:ht.object;default:return ht.unknown}},qe=In.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class _l extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},s={_errors:[]},i=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let l=s,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(t(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return i(this),s}static assert(e){if(!(e instanceof _l))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,In.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const i of this.issues)if(i.path.length>0){const a=i.path[0];t[a]=t[a]||[],t[a].push(e(i))}else s.push(e(i));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}_l.create=n=>new _l(n);const Tw=(n,e)=>{let t;switch(n.code){case qe.invalid_type:n.received===ht.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case qe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,In.jsonStringifyReplacer)}`;break;case qe.unrecognized_keys:t=`Unrecognized key(s) in object: ${In.joinValues(n.keys,", ")}`;break;case qe.invalid_union:t="Invalid input";break;case qe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${In.joinValues(n.options)}`;break;case qe.invalid_enum_value:t=`Invalid enum value. Expected ${In.joinValues(n.options)}, received '${n.received}'`;break;case qe.invalid_arguments:t="Invalid function arguments";break;case qe.invalid_return_type:t="Invalid function return type";break;case qe.invalid_date:t="Invalid date";break;case qe.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:In.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case qe.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case qe.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case qe.custom:t="Invalid input";break;case qe.invalid_intersection_types:t="Intersection results could not be merged";break;case qe.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case qe.not_finite:t="Number must be finite";break;default:t=e.defaultError,In.assertNever(n)}return{message:t}};let AO=Tw;function bO(){return AO}const yO=n=>{const{data:e,path:t,errorMaps:s,issueData:i}=n,a=[...t,...i.path||[]],o={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let l="";const c=s.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:e,defaultError:l}).message;return{...i,path:a,message:l}};function rt(n,e){const t=bO(),s=yO({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Tw?void 0:Tw].filter(i=>!!i)});n.common.issues.push(s)}class Vr{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const i of t){if(i.status==="aborted")return Ht;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const i of t){const a=await i.key,o=await i.value;s.push({key:a,value:o})}return Vr.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const i of t){const{key:a,value:o}=i;if(a.status==="aborted"||o.status==="aborted")return Ht;a.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(s[a.value]=o.value)}return{status:e.value,value:s}}}const Ht=Object.freeze({status:"aborted"}),em=n=>({status:"dirty",value:n}),ua=n=>({status:"valid",value:n}),$k=n=>n.status==="aborted",eR=n=>n.status==="dirty",_u=n=>n.status==="valid",Yf=n=>typeof Promise<"u"&&n instanceof Promise;var ft;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(ft||(ft={}));class _o{constructor(e,t,s,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const tR=(n,e)=>{if(_u(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new _l(n.common.issues);return this._error=t,this._error}}};function Ot(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:i}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,l)=>{const{message:c}=n;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??s??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??t??l.defaultError}},description:i}}class ln{get description(){return this._def.description}_getType(e){return Tc(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Tc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Vr,ctx:{common:e.parent.common,data:e.data,parsedType:Tc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Yf(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){const s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tc(e)},i=this._parseSync({data:e,path:s.path,parent:s});return tR(s,i)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tc(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return _u(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>_u(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tc(e)},i=this._parse({data:e,path:s.path,parent:s}),a=await(Yf(i)?i:Promise.resolve(i));return tR(s,a)}refine(e,t){const s=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,a)=>{const o=e(i),l=()=>a.addIssue({code:qe.custom,...s(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(e,t){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof t=="function"?t(s,i):t),!1))}_refinement(e){return new Ju({schema:this,typeName:Mt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Qc.create(this,this._def)}nullable(){return Yu.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ro.create(this)}promise(){return Ef.create(this,this._def)}or(e){return Mf.create([this,e],this._def)}and(e){return Hf.create(this,e,this._def)}transform(e){return new Ju({...Ot(this._def),schema:this,typeName:Mt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Pw({...Ot(this._def),innerType:this,defaultValue:t,typeName:Mt.ZodDefault})}brand(){return new DO({typeName:Mt.ZodBranded,type:this,...Ot(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Kw({...Ot(this._def),innerType:this,catchValue:t,typeName:Mt.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return iG.create(this,e)}readonly(){return Ow.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const vO=/^c[^\s-]{8,}$/i,xO=/^[0-9a-z]+$/,SO=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wO=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ZO=/^[a-z0-9_-]{21}$/i,GO=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,BO=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,NO=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,kO="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Yb;const RO=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,WO=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,VO=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_O=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,jO=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,XO=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,XM="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",JO=new RegExp(`^${XM}$`);function JM(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function YO(n){return new RegExp(`^${JM(n)}$`)}function FO(n){let e=`${XM}T${JM(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function MO(n,e){return!!((e==="v4"||!e)&&RO.test(n)||(e==="v6"||!e)&&VO.test(n))}function HO(n,e){if(!GO.test(n))return!1;try{const[t]=n.split(".");if(!t)return!1;const s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function TO(n,e){return!!((e==="v4"||!e)&&WO.test(n)||(e==="v6"||!e)&&_O.test(n))}class Bo extends ln{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ht.string){const a=this._getOrReturnCtx(e);return rt(a,{code:qe.invalid_type,expected:ht.string,received:a.parsedType}),Ht}const s=new Vr;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),s.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,l=e.data.length<a.value;(o||l)&&(i=this._getOrReturnCtx(e,i),o?rt(i,{code:qe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):l&&rt(i,{code:qe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),s.dirty())}else if(a.kind==="email")NO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"email",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="emoji")Yb||(Yb=new RegExp(kO,"u")),Yb.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"emoji",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="uuid")wO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"uuid",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="nanoid")ZO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"nanoid",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid")vO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"cuid",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="cuid2")xO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"cuid2",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="ulid")SO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"ulid",code:qe.invalid_string,message:a.message}),s.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),rt(i,{validation:"url",code:qe.invalid_string,message:a.message}),s.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"regex",code:qe.invalid_string,message:a.message}),s.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),s.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:{startsWith:a.value},message:a.message}),s.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:{endsWith:a.value},message:a.message}),s.dirty()):a.kind==="datetime"?FO(a).test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:"datetime",message:a.message}),s.dirty()):a.kind==="date"?JO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:"date",message:a.message}),s.dirty()):a.kind==="time"?YO(a).test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.invalid_string,validation:"time",message:a.message}),s.dirty()):a.kind==="duration"?BO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"duration",code:qe.invalid_string,message:a.message}),s.dirty()):a.kind==="ip"?MO(e.data,a.version)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"ip",code:qe.invalid_string,message:a.message}),s.dirty()):a.kind==="jwt"?HO(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"jwt",code:qe.invalid_string,message:a.message}),s.dirty()):a.kind==="cidr"?TO(e.data,a.version)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"cidr",code:qe.invalid_string,message:a.message}),s.dirty()):a.kind==="base64"?jO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"base64",code:qe.invalid_string,message:a.message}),s.dirty()):a.kind==="base64url"?XO.test(e.data)||(i=this._getOrReturnCtx(e,i),rt(i,{validation:"base64url",code:qe.invalid_string,message:a.message}),s.dirty()):In.assertNever(a);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(i=>e.test(i),{validation:t,code:qe.invalid_string,...ft.errToObj(s)})}_addCheck(e){return new Bo({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ft.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ft.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ft.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ft.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ft.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ft.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ft.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ft.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ft.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ft.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ft.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ft.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ft.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...ft.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...ft.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...ft.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ft.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...ft.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ft.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ft.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ft.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ft.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ft.errToObj(t)})}nonempty(e){return this.min(1,ft.errToObj(e))}trim(){return new Bo({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bo({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bo({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Bo.create=n=>new Bo({checks:[],typeName:Mt.ZodString,coerce:n?.coerce??!1,...Ot(n)});function EO(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=t>s?t:s,a=Number.parseInt(n.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return a%o/10**i}class yg extends ln{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ht.number){const a=this._getOrReturnCtx(e);return rt(a,{code:qe.invalid_type,expected:ht.number,received:a.parsedType}),Ht}let s;const i=new Vr;for(const a of this._def.checks)a.kind==="int"?In.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?EO(e.data,a.value)!==0&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.not_finite,message:a.message}),i.dirty()):In.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ft.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ft.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ft.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ft.toString(t))}setLimit(e,t,s,i){return new yg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:ft.toString(i)}]})}_addCheck(e){return new yg({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ft.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ft.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ft.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ft.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ft.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ft.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ft.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ft.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ft.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&In.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}yg.create=n=>new yg({checks:[],typeName:Mt.ZodNumber,coerce:n?.coerce||!1,...Ot(n)});class vg extends ln{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ht.bigint)return this._getInvalidInput(e);let s;const i=new Vr;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),rt(s,{code:qe.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):In.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return rt(t,{code:qe.invalid_type,expected:ht.bigint,received:t.parsedType}),Ht}gte(e,t){return this.setLimit("min",e,!0,ft.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ft.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ft.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ft.toString(t))}setLimit(e,t,s,i){return new vg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:ft.toString(i)}]})}_addCheck(e){return new vg({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ft.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ft.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ft.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ft.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ft.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}vg.create=n=>new vg({checks:[],typeName:Mt.ZodBigInt,coerce:n?.coerce??!1,...Ot(n)});class Ff extends ln{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ht.boolean){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.boolean,received:s.parsedType}),Ht}return ua(e.data)}}Ff.create=n=>new Ff({typeName:Mt.ZodBoolean,coerce:n?.coerce||!1,...Ot(n)});class ju extends ln{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ht.date){const a=this._getOrReturnCtx(e);return rt(a,{code:qe.invalid_type,expected:ht.date,received:a.parsedType}),Ht}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return rt(a,{code:qe.invalid_date}),Ht}const s=new Vr;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),s.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),rt(i,{code:qe.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),s.dirty()):In.assertNever(a);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ju({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ft.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ft.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ju.create=n=>new ju({checks:[],coerce:n?.coerce||!1,typeName:Mt.ZodDate,...Ot(n)});class nR extends ln{_parse(e){if(this._getType(e)!==ht.symbol){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.symbol,received:s.parsedType}),Ht}return ua(e.data)}}nR.create=n=>new nR({typeName:Mt.ZodSymbol,...Ot(n)});class sR extends ln{_parse(e){if(this._getType(e)!==ht.undefined){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.undefined,received:s.parsedType}),Ht}return ua(e.data)}}sR.create=n=>new sR({typeName:Mt.ZodUndefined,...Ot(n)});class rR extends ln{_parse(e){if(this._getType(e)!==ht.null){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.null,received:s.parsedType}),Ht}return ua(e.data)}}rR.create=n=>new rR({typeName:Mt.ZodNull,...Ot(n)});class iR extends ln{constructor(){super(...arguments),this._any=!0}_parse(e){return ua(e.data)}}iR.create=n=>new iR({typeName:Mt.ZodAny,...Ot(n)});class Ew extends ln{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ua(e.data)}}Ew.create=n=>new Ew({typeName:Mt.ZodUnknown,...Ot(n)});class ed extends ln{_parse(e){const t=this._getOrReturnCtx(e);return rt(t,{code:qe.invalid_type,expected:ht.never,received:t.parsedType}),Ht}}ed.create=n=>new ed({typeName:Mt.ZodNever,...Ot(n)});class aR extends ln{_parse(e){if(this._getType(e)!==ht.undefined){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.void,received:s.parsedType}),Ht}return ua(e.data)}}aR.create=n=>new aR({typeName:Mt.ZodVoid,...Ot(n)});class Ro extends ln{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),i=this._def;if(t.parsedType!==ht.array)return rt(t,{code:qe.invalid_type,expected:ht.array,received:t.parsedType}),Ht;if(i.exactLength!==null){const o=t.data.length>i.exactLength.value,l=t.data.length<i.exactLength.value;(o||l)&&(rt(t,{code:o?qe.too_big:qe.too_small,minimum:l?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(rt(t,{code:qe.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(rt(t,{code:qe.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,l)=>i.type._parseAsync(new _o(t,o,t.path,l)))).then(o=>Vr.mergeArray(s,o));const a=[...t.data].map((o,l)=>i.type._parseSync(new _o(t,o,t.path,l)));return Vr.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new Ro({...this._def,minLength:{value:e,message:ft.toString(t)}})}max(e,t){return new Ro({...this._def,maxLength:{value:e,message:ft.toString(t)}})}length(e,t){return new Ro({...this._def,exactLength:{value:e,message:ft.toString(t)}})}nonempty(e){return this.min(1,e)}}Ro.create=(n,e)=>new Ro({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Mt.ZodArray,...Ot(e)});function Iu(n){if(n instanceof Ss){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=Qc.create(Iu(s))}return new Ss({...n._def,shape:()=>e})}else return n instanceof Ro?new Ro({...n._def,type:Iu(n.element)}):n instanceof Qc?Qc.create(Iu(n.unwrap())):n instanceof Yu?Yu.create(Iu(n.unwrap())):n instanceof xg?xg.create(n.items.map(e=>Iu(e))):n}class Ss extends ln{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=In.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==ht.object){const d=this._getOrReturnCtx(e);return rt(d,{code:qe.invalid_type,expected:ht.object,received:d.parsedType}),Ht}const{status:s,ctx:i}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof ed&&this._def.unknownKeys==="strip"))for(const d in i.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const h=a[d],m=i.data[d];c.push({key:{status:"valid",value:d},value:h._parse(new _o(i,m,i.path,d)),alwaysSet:d in i.data})}if(this._def.catchall instanceof ed){const d=this._def.unknownKeys;if(d==="passthrough")for(const h of l)c.push({key:{status:"valid",value:h},value:{status:"valid",value:i.data[h]}});else if(d==="strict")l.length>0&&(rt(i,{code:qe.unrecognized_keys,keys:l}),s.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const h of l){const m=i.data[h];c.push({key:{status:"valid",value:h},value:d._parse(new _o(i,m,i.path,h)),alwaysSet:h in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const d=[];for(const h of c){const m=await h.key,f=await h.value;d.push({key:m,value:f,alwaysSet:h.alwaysSet})}return d}).then(d=>Vr.mergeObjectSync(s,d)):Vr.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return ft.errToObj,new Ss({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{const i=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:ft.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Ss({...this._def,unknownKeys:"strip"})}passthrough(){return new Ss({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ss({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ss({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Mt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ss({...this._def,catchall:e})}pick(e){const t={};for(const s of In.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new Ss({...this._def,shape:()=>t})}omit(e){const t={};for(const s of In.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new Ss({...this._def,shape:()=>t})}deepPartial(){return Iu(this)}partial(e){const t={};for(const s of In.objectKeys(this.shape)){const i=this.shape[s];e&&!e[s]?t[s]=i:t[s]=i.optional()}return new Ss({...this._def,shape:()=>t})}required(e){const t={};for(const s of In.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let a=this.shape[s];for(;a instanceof Qc;)a=a._def.innerType;t[s]=a}return new Ss({...this._def,shape:()=>t})}keyof(){return YM(In.objectKeys(this.shape))}}Ss.create=(n,e)=>new Ss({shape:()=>n,unknownKeys:"strip",catchall:ed.create(),typeName:Mt.ZodObject,...Ot(e)});Ss.strictCreate=(n,e)=>new Ss({shape:()=>n,unknownKeys:"strict",catchall:ed.create(),typeName:Mt.ZodObject,...Ot(e)});Ss.lazycreate=(n,e)=>new Ss({shape:n,unknownKeys:"strip",catchall:ed.create(),typeName:Mt.ZodObject,...Ot(e)});class Mf extends ln{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function i(a){for(const l of a)if(l.result.status==="valid")return l.result;for(const l of a)if(l.result.status==="dirty")return t.common.issues.push(...l.ctx.common.issues),l.result;const o=a.map(l=>new _l(l.ctx.common.issues));return rt(t,{code:qe.invalid_union,unionErrors:o}),Ht}if(t.common.async)return Promise.all(s.map(async a=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(i);{let a;const o=[];for(const c of s){const d={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:d});if(h.status==="valid")return h;h.status==="dirty"&&!a&&(a={result:h,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const l=o.map(c=>new _l(c));return rt(t,{code:qe.invalid_union,unionErrors:l}),Ht}}get options(){return this._def.options}}Mf.create=(n,e)=>new Mf({options:n,typeName:Mt.ZodUnion,...Ot(e)});function Dw(n,e){const t=Tc(n),s=Tc(e);if(n===e)return{valid:!0,data:n};if(t===ht.object&&s===ht.object){const i=In.objectKeys(e),a=In.objectKeys(n).filter(l=>i.indexOf(l)!==-1),o={...n,...e};for(const l of a){const c=Dw(n[l],e[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(t===ht.array&&s===ht.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<n.length;a++){const o=n[a],l=e[a],c=Dw(o,l);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return t===ht.date&&s===ht.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Hf extends ln{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),i=(a,o)=>{if($k(a)||$k(o))return Ht;const l=Dw(a.value,o.value);return l.valid?((eR(a)||eR(o))&&t.dirty(),{status:t.value,value:l.data}):(rt(s,{code:qe.invalid_intersection_types}),Ht)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,o])=>i(a,o)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Hf.create=(n,e,t)=>new Hf({left:n,right:e,typeName:Mt.ZodIntersection,...Ot(t)});class xg extends ln{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ht.array)return rt(s,{code:qe.invalid_type,expected:ht.array,received:s.parsedType}),Ht;if(s.data.length<this._def.items.length)return rt(s,{code:qe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ht;!this._def.rest&&s.data.length>this._def.items.length&&(rt(s,{code:qe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new _o(s,o,s.path,l)):null}).filter(o=>!!o);return s.common.async?Promise.all(a).then(o=>Vr.mergeArray(t,o)):Vr.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new xg({...this._def,rest:e})}}xg.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xg({items:n,typeName:Mt.ZodTuple,rest:null,...Ot(e)})};class Tf extends ln{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ht.object)return rt(s,{code:qe.invalid_type,expected:ht.object,received:s.parsedType}),Ht;const i=[],a=this._def.keyType,o=this._def.valueType;for(const l in s.data)i.push({key:a._parse(new _o(s,l,s.path,l)),value:o._parse(new _o(s,s.data[l],s.path,l)),alwaysSet:l in s.data});return s.common.async?Vr.mergeObjectAsync(t,i):Vr.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof ln?new Tf({keyType:e,valueType:t,typeName:Mt.ZodRecord,...Ot(s)}):new Tf({keyType:Bo.create(),valueType:e,typeName:Mt.ZodRecord,...Ot(t)})}}class oR extends ln{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ht.map)return rt(s,{code:qe.invalid_type,expected:ht.map,received:s.parsedType}),Ht;const i=this._def.keyType,a=this._def.valueType,o=[...s.data.entries()].map(([l,c],d)=>({key:i._parse(new _o(s,l,s.path,[d,"key"])),value:a._parse(new _o(s,c,s.path,[d,"value"]))}));if(s.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,h=await c.value;if(d.status==="aborted"||h.status==="aborted")return Ht;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(d.value,h.value)}return{status:t.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,h=c.value;if(d.status==="aborted"||h.status==="aborted")return Ht;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(d.value,h.value)}return{status:t.value,value:l}}}}oR.create=(n,e,t)=>new oR({valueType:e,keyType:n,typeName:Mt.ZodMap,...Ot(t)});class vm extends ln{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ht.set)return rt(s,{code:qe.invalid_type,expected:ht.set,received:s.parsedType}),Ht;const i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(rt(s,{code:qe.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(rt(s,{code:qe.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const a=this._def.valueType;function o(c){const d=new Set;for(const h of c){if(h.status==="aborted")return Ht;h.status==="dirty"&&t.dirty(),d.add(h.value)}return{status:t.value,value:d}}const l=[...s.data.values()].map((c,d)=>a._parse(new _o(s,c,s.path,d)));return s.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(e,t){return new vm({...this._def,minSize:{value:e,message:ft.toString(t)}})}max(e,t){return new vm({...this._def,maxSize:{value:e,message:ft.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}vm.create=(n,e)=>new vm({valueType:n,minSize:null,maxSize:null,typeName:Mt.ZodSet,...Ot(e)});class Lw extends ln{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Lw.create=(n,e)=>new Lw({getter:n,typeName:Mt.ZodLazy,...Ot(e)});class lR extends ln{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return rt(t,{received:t.data,code:qe.invalid_literal,expected:this._def.value}),Ht}return{status:"valid",value:e.data}}get value(){return this._def.value}}lR.create=(n,e)=>new lR({value:n,typeName:Mt.ZodLiteral,...Ot(e)});function YM(n,e){return new Xu({values:n,typeName:Mt.ZodEnum,...Ot(e)})}class Xu extends ln{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return rt(t,{expected:In.joinValues(s),received:t.parsedType,code:qe.invalid_type}),Ht}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return rt(t,{received:t.data,code:qe.invalid_enum_value,options:s}),Ht}return ua(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Xu.create(e,{...this._def,...t})}exclude(e,t=this._def){return Xu.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}Xu.create=YM;class cR extends ln{_parse(e){const t=In.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==ht.string&&s.parsedType!==ht.number){const i=In.objectValues(t);return rt(s,{expected:In.joinValues(i),received:s.parsedType,code:qe.invalid_type}),Ht}if(this._cache||(this._cache=new Set(In.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=In.objectValues(t);return rt(s,{received:s.data,code:qe.invalid_enum_value,options:i}),Ht}return ua(e.data)}get enum(){return this._def.values}}cR.create=(n,e)=>new cR({values:n,typeName:Mt.ZodNativeEnum,...Ot(e)});class Ef extends ln{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ht.promise&&t.common.async===!1)return rt(t,{code:qe.invalid_type,expected:ht.promise,received:t.parsedType}),Ht;const s=t.parsedType===ht.promise?t.data:Promise.resolve(t.data);return ua(s.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ef.create=(n,e)=>new Ef({type:n,typeName:Mt.ZodPromise,...Ot(e)});class Ju extends ln{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Mt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:o=>{rt(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const o=i.transform(s.data,a);if(s.common.async)return Promise.resolve(o).then(async l=>{if(t.value==="aborted")return Ht;const c=await this._def.schema._parseAsync({data:l,path:s.path,parent:s});return c.status==="aborted"?Ht:c.status==="dirty"||t.value==="dirty"?em(c.value):c});{if(t.value==="aborted")return Ht;const l=this._def.schema._parseSync({data:o,path:s.path,parent:s});return l.status==="aborted"?Ht:l.status==="dirty"||t.value==="dirty"?em(l.value):l}}if(i.type==="refinement"){const o=l=>{const c=i.refinement(l,a);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(s.common.async===!1){const l=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return l.status==="aborted"?Ht:(l.status==="dirty"&&t.dirty(),o(l.value),{status:t.value,value:l.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(l=>l.status==="aborted"?Ht:(l.status==="dirty"&&t.dirty(),o(l.value).then(()=>({status:t.value,value:l.value}))))}if(i.type==="transform")if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!_u(o))return Ht;const l=i.transform(o.value,a);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:l}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>_u(o)?Promise.resolve(i.transform(o.value,a)).then(l=>({status:t.value,value:l})):Ht);In.assertNever(i)}}Ju.create=(n,e,t)=>new Ju({schema:n,typeName:Mt.ZodEffects,effect:e,...Ot(t)});Ju.createWithPreprocess=(n,e,t)=>new Ju({schema:e,effect:{type:"preprocess",transform:n},typeName:Mt.ZodEffects,...Ot(t)});class Qc extends ln{_parse(e){return this._getType(e)===ht.undefined?ua(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qc.create=(n,e)=>new Qc({innerType:n,typeName:Mt.ZodOptional,...Ot(e)});class Yu extends ln{_parse(e){return this._getType(e)===ht.null?ua(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Yu.create=(n,e)=>new Yu({innerType:n,typeName:Mt.ZodNullable,...Ot(e)});class Pw extends ln{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===ht.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Pw.create=(n,e)=>new Pw({innerType:n,typeName:Mt.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ot(e)});class Kw extends ln{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Yf(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new _l(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new _l(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Kw.create=(n,e)=>new Kw({innerType:n,typeName:Mt.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ot(e)});class dR extends ln{_parse(e){if(this._getType(e)!==ht.nan){const s=this._getOrReturnCtx(e);return rt(s,{code:qe.invalid_type,expected:ht.nan,received:s.parsedType}),Ht}return{status:"valid",value:e.data}}}dR.create=n=>new dR({typeName:Mt.ZodNaN,...Ot(n)});class DO extends ln{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class iG extends ln{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?Ht:a.status==="dirty"?(t.dirty(),em(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})})();{const i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?Ht:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,t){return new iG({in:e,out:t,typeName:Mt.ZodPipeline})}}class Ow extends ln{_parse(e){const t=this._def.innerType._parse(e),s=i=>(_u(i)&&(i.value=Object.freeze(i.value)),i);return Yf(t)?t.then(i=>s(i)):s(t)}unwrap(){return this._def.innerType}}Ow.create=(n,e)=>new Ow({innerType:n,typeName:Mt.ZodReadonly,...Ot(e)});var Mt;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Mt||(Mt={}));const $d=Bo.create,gR=yg.create;vg.create;const LO=Ff.create;ju.create;const uR=Ew.create;ed.create;const tm=Ro.create,PO=Ss.create,KO=Mf.create;Hf.create;xg.create;const OO=Tf.create,zO=Lw.create,UO=Xu.create;Ef.create;Qc.create;Yu.create;const iu={string:(n=>Bo.create({...n,coerce:!0})),number:(n=>yg.create({...n,coerce:!0})),boolean:(n=>Ff.create({...n,coerce:!0})),bigint:(n=>vg.create({...n,coerce:!0})),date:(n=>ju.create({...n,coerce:!0}))};let QO,qO;function $O(){return{geminiUrl:QO,vertexUrl:qO}}function ez(n,e,t){var s,i,a;if(!(!((s=n.httpOptions)===null||s===void 0)&&s.baseUrl)){const o=$O();return n.vertexai?(i=o.vertexUrl)!==null&&i!==void 0?i:e:(a=o.geminiUrl)!==null&&a!==void 0?a:t}return n.httpOptions.baseUrl}class Em{}function Jt(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const a=e[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function Z(n,e,t){for(let a=0;a<e.length-1;a++){const o=e[a];if(o.endsWith("[]")){const l=o.slice(0,-2);if(!(l in n))if(Array.isArray(t))n[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[l])){const c=n[l];if(Array.isArray(t))for(let d=0;d<c.length;d++){const h=c[d];Z(h,e.slice(a+1),t[d])}else for(const d of c)Z(d,e.slice(a+1),t)}return}else if(o.endsWith("[0]")){const l=o.slice(0,-3);l in n||(n[l]=[{}]);const c=n[l];Z(c[0],e.slice(a+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const s=e[e.length-1],i=n[s];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else n[s]=t}function w(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const s=e[t];if(s.endsWith("[]")){const i=s.slice(0,-2);if(i in n){const a=n[i];return Array.isArray(a)?a.map(o=>w(o,e.slice(t+1))):void 0}else return}else n=n[s]}return n}catch(t){if(t instanceof TypeError)return;throw t}}var hR;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(hR||(hR={}));var mR;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(mR||(mR={}));var IR;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(IR||(IR={}));var CR;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(CR||(CR={}));var fR;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(fR||(fR={}));var $e;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})($e||($e={}));var pR;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(pR||(pR={}));var AR;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(AR||(AR={}));var bR;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY"})(bR||(bR={}));var yR;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(yR||(yR={}));var vR;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(vR||(vR={}));var xR;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(xR||(xR={}));var SR;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(SR||(SR={}));var xm;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(xm||(xm={}));var wR;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(wR||(wR={}));var zw;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(zw||(zw={}));var ZR;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(ZR||(ZR={}));var GR;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(GR||(GR={}));var BR;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(BR||(BR={}));var NR;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(NR||(NR={}));var kR;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(kR||(kR={}));var RR;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(RR||(RR={}));var WR;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(WR||(WR={}));var VR;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(VR||(VR={}));var _R;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(_R||(_R={}));var jR;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(jR||(jR={}));var XR;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(XR||(XR={}));var JR;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(JR||(JR={}));var YR;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(YR||(YR={}));var FR;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(FR||(FR={}));var MR;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(MR||(MR={}));var HR;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(HR||(HR={}));var TR;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(TR||(TR={}));var ER;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(ER||(ER={}));var DR;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(DR||(DR={}));var LR;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(LR||(LR={}));var PR;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(PR||(PR={}));var KR;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(KR||(KR={}));var OR;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY"})(OR||(OR={}));var fu;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(fu||(fu={}));class Rh{get text(){var e,t,s,i,a,o,l,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const m=[];for(const f of(c=(l=(o=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[p,b]of Object.entries(f))p!=="text"&&p!=="thought"&&(b!==null||b!==void 0)&&m.push(p);if(typeof f.text=="string"){if(typeof f.thought=="boolean"&&f.thought)continue;h=!0,d+=f.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,s,i,a,o,l,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const m of(c=(l=(o=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[f,p]of Object.entries(m))f!=="inlineData"&&(p!==null||p!==void 0)&&h.push(f);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,s,i,a,o,l,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(o=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if(d?.length!==0)return d}get executableCode(){var e,t,s,i,a,o,l,c,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(c=(l=(o=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if(h?.length!==0)return(d=h?.[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,s,i,a,o,l,c,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(c=(l=(o=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if(h?.length!==0)return(d=h?.[0])===null||d===void 0?void 0:d.output}}class zR{}class UR{}class tz{}class nz{}class QR{}class qR{}class $R{}class sz{}class e2{}class t2{}class n2{}class rz{}class Uw{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class iz{}class az{}class oz{get text(){var e,t,s;let i="",a=!1;const o=[];for(const l of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[c,d]of Object.entries(l))c!=="text"&&c!=="thought"&&d!==null&&o.push(c);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;a=!0,i+=l.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?i:void 0}get data(){var e,t,s;let i="";const a=[];for(const o of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[l,c]of Object.entries(o))l!=="inlineData"&&c!==null&&a.push(l);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class lz{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}function zn(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function FM(n,e){const t=zn(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function MM(n,e){return Array.isArray(e)?e.map(t=>Df(n,t)):[Df(n,e)]}function Df(n,e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function cz(n,e){const t=Df(n,e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function dz(n,e){const t=Df(n,e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function s2(n,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function HM(n,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>s2(n,t)):[s2(n,e)]}function Qw(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function r2(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function i2(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function ei(n,e){if(e==null)throw new Error("ContentUnion is required");return Qw(e)?e:{role:"user",parts:HM(n,e)}}function TM(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=ei(n,t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=ei(n,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ei(n,t)):[ei(n,e)]}function Ta(n,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(r2(e)||i2(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ei(n,e)]}const t=[],s=[],i=Qw(e[0]);for(const a of e){const o=Qw(a);if(o!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)t.push(a);else{if(r2(a)||i2(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");s.push(a)}}return i||t.push({role:"user",parts:HM(n,s)}),t}const a2=UO(["string","number","integer","object","array","boolean","null"]),gz=KO([a2,tm(a2)]);function uz(n=!0){const e=zO(()=>{const t=PO({type:gz.optional(),format:$d().optional(),title:$d().optional(),description:$d().optional(),default:uR().optional(),items:e.optional(),minItems:iu.string().optional(),maxItems:iu.string().optional(),enum:tm(uR()).optional(),properties:OO($d(),e).optional(),required:tm($d()).optional(),minProperties:iu.string().optional(),maxProperties:iu.string().optional(),propertyOrdering:tm($d()).optional(),minimum:gR().optional(),maximum:gR().optional(),minLength:iu.string().optional(),maxLength:iu.string().optional(),pattern:$d().optional(),anyOf:tm(e).optional(),additionalProperties:LO().optional()});return n?t.strict():t});return e}function hz(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.keys($e).includes(t[0].toUpperCase())?$e[t[0].toUpperCase()]:$e.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.keys($e).includes(s.toUpperCase())?$e[s.toUpperCase()]:$e.TYPE_UNSPECIFIED})}}function dm(n){const e={},t=["items"],s=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const a=n.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,n=a[1]):a[1].type==="null"&&(e.nullable=!0,n=a[0])),n.type instanceof Array&&hz(n.type,e);for(const[o,l]of Object.entries(n))if(l!=null)if(o=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.keys($e).includes(l.toUpperCase())?l.toUpperCase():$e.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=dm(l);else if(s.includes(o)){const c=[];for(const d of l){if(d.type=="null"){e.nullable=!0;continue}c.push(dm(d))}e[o]=c}else if(i.includes(o)){const c={};for(const[d,h]of Object.entries(l))c[d]=dm(h);e[o]=c}else{if(o==="additionalProperties")continue;e[o]=l}return e}function Lf(n,e){if(Object.keys(e).includes("$schema")){delete e.$schema;const t=uz().parse(e);return dm(t)}else return dm(e)}function EM(n,e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function DM(n,e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function pp(n,e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(t.parameters=Lf(n,t.parameters)),t.response&&(t.response=Lf(n,t.response));return e}function Ap(n,e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const s of e)t.push(s);return t}function mz(n,e,t,s=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function od(n,e){if(typeof e!="string")throw new Error("name must be a string");return mz(n,e,"cachedContents")}function LM(n,e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function ld(n,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function Iz(n){return n!=null&&typeof n=="object"&&"name"in n}function Cz(n){return n!=null&&typeof n=="object"&&"video"in n}function fz(n){return n!=null&&typeof n=="object"&&"uri"in n}function PM(n,e){var t;let s;if(Iz(e)&&(s=e.name),!(fz(e)&&(s=e.uri,s===void 0))&&!(Cz(e)&&(s=(t=e.video)===null||t===void 0?void 0:t.uri,s===void 0))){if(typeof e=="string"&&(s=e),s===void 0)throw new Error("Could not extract file name from the provided input.");if(s.startsWith("https://")){const a=s.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${s}`);s=a[0]}else s.startsWith("files/")&&(s=s.split("files/")[1]);return s}}function KM(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function OM(n,e){for(const t of["models","tunedModels","publisherModels"])if(pz(e,t))return e[t];return[]}function pz(n,e){return n!==null&&typeof n=="object"&&e in n}function Az(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function bz(n,e){const t={};if(w(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function yz(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],Az(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],bz(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function o2(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>yz(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function vz(n,e){const t={},s=w(e,["behavior"]);s!=null&&Z(t,["behavior"],s);const i=w(e,["description"]);i!=null&&Z(t,["description"],i);const a=w(e,["name"]);a!=null&&Z(t,["name"],a);const o=w(e,["parameters"]);o!=null&&Z(t,["parameters"],o);const l=w(e,["response"]);return l!=null&&Z(t,["response"],l),t}function xz(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function Sz(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],xz(n,s)),t}function wz(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function Zz(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],wz(n,s)),t}function Gz(){return{}}function Bz(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(d=>vz(n,d))),Z(t,["functionDeclarations"],c)}if(w(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=w(e,["googleSearch"]);i!=null&&Z(t,["googleSearch"],Sz(n,i));const a=w(e,["googleSearchRetrieval"]);if(a!=null&&Z(t,["googleSearchRetrieval"],Zz(n,a)),w(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(w(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");w(e,["urlContext"])!=null&&Z(t,["urlContext"],Gz());const l=w(e,["codeExecution"]);return l!=null&&Z(t,["codeExecution"],l),t}function Nz(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["allowedFunctionNames"]);return i!=null&&Z(t,["allowedFunctionNames"],i),t}function kz(n,e){const t={},s=w(e,["latitude"]);s!=null&&Z(t,["latitude"],s);const i=w(e,["longitude"]);return i!=null&&Z(t,["longitude"],i),t}function Rz(n,e){const t={},s=w(e,["latLng"]);return s!=null&&Z(t,["latLng"],kz(n,s)),t}function Wz(n,e){const t={},s=w(e,["functionCallingConfig"]);s!=null&&Z(t,["functionCallingConfig"],Nz(n,s));const i=w(e,["retrievalConfig"]);return i!=null&&Z(t,["retrievalConfig"],Rz(n,i)),t}function Vz(n,e,t){const s={},i=w(e,["ttl"]);t!==void 0&&i!=null&&Z(t,["ttl"],i);const a=w(e,["expireTime"]);t!==void 0&&a!=null&&Z(t,["expireTime"],a);const o=w(e,["displayName"]);t!==void 0&&o!=null&&Z(t,["displayName"],o);const l=w(e,["contents"]);if(t!==void 0&&l!=null){let m=Ta(n,l);Array.isArray(m)&&(m=m.map(f=>o2(n,f))),Z(t,["contents"],m)}const c=w(e,["systemInstruction"]);t!==void 0&&c!=null&&Z(t,["systemInstruction"],o2(n,ei(n,c)));const d=w(e,["tools"]);if(t!==void 0&&d!=null){let m=d;Array.isArray(m)&&(m=m.map(f=>Bz(n,f))),Z(t,["tools"],m)}const h=w(e,["toolConfig"]);if(t!==void 0&&h!=null&&Z(t,["toolConfig"],Wz(n,h)),w(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return s}function _z(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["model"],FM(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],Vz(n,i,t)),t}function jz(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function Xz(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function Jz(n,e,t){const s={},i=w(e,["ttl"]);t!==void 0&&i!=null&&Z(t,["ttl"],i);const a=w(e,["expireTime"]);return t!==void 0&&a!=null&&Z(t,["expireTime"],a),s}function Yz(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],Jz(n,i,t)),t}function Fz(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);return t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a),s}function Mz(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],Fz(n,s,t)),t}function Hz(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function Tz(n,e){const t={},s=w(e,["displayName"]);s!=null&&Z(t,["displayName"],s);const i=w(e,["data"]);i!=null&&Z(t,["data"],i);const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function Ez(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],Hz(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],Tz(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function l2(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>Ez(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function Dz(n,e){const t={};if(w(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=w(e,["description"]);s!=null&&Z(t,["description"],s);const i=w(e,["name"]);i!=null&&Z(t,["name"],i);const a=w(e,["parameters"]);a!=null&&Z(t,["parameters"],a);const o=w(e,["response"]);return o!=null&&Z(t,["response"],o),t}function Lz(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function Pz(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],Lz(n,s)),t}function Kz(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function Oz(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],Kz(n,s)),t}function zz(){return{}}function Uz(n,e){const t={},s=w(e,["apiKeyString"]);return s!=null&&Z(t,["apiKeyString"],s),t}function Qz(n,e){const t={},s=w(e,["apiKeyConfig"]);s!=null&&Z(t,["apiKeyConfig"],Uz(n,s));const i=w(e,["authType"]);i!=null&&Z(t,["authType"],i);const a=w(e,["googleServiceAccountConfig"]);a!=null&&Z(t,["googleServiceAccountConfig"],a);const o=w(e,["httpBasicAuthConfig"]);o!=null&&Z(t,["httpBasicAuthConfig"],o);const l=w(e,["oauthConfig"]);l!=null&&Z(t,["oauthConfig"],l);const c=w(e,["oidcConfig"]);return c!=null&&Z(t,["oidcConfig"],c),t}function qz(n,e){const t={},s=w(e,["authConfig"]);return s!=null&&Z(t,["authConfig"],Qz(n,s)),t}function $z(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>Dz(n,m))),Z(t,["functionDeclarations"],h)}const i=w(e,["retrieval"]);i!=null&&Z(t,["retrieval"],i);const a=w(e,["googleSearch"]);a!=null&&Z(t,["googleSearch"],Pz(n,a));const o=w(e,["googleSearchRetrieval"]);o!=null&&Z(t,["googleSearchRetrieval"],Oz(n,o)),w(e,["enterpriseWebSearch"])!=null&&Z(t,["enterpriseWebSearch"],zz());const c=w(e,["googleMaps"]);if(c!=null&&Z(t,["googleMaps"],qz(n,c)),w(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=w(e,["codeExecution"]);return d!=null&&Z(t,["codeExecution"],d),t}function eU(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["allowedFunctionNames"]);return i!=null&&Z(t,["allowedFunctionNames"],i),t}function tU(n,e){const t={},s=w(e,["latitude"]);s!=null&&Z(t,["latitude"],s);const i=w(e,["longitude"]);return i!=null&&Z(t,["longitude"],i),t}function nU(n,e){const t={},s=w(e,["latLng"]);return s!=null&&Z(t,["latLng"],tU(n,s)),t}function sU(n,e){const t={},s=w(e,["functionCallingConfig"]);s!=null&&Z(t,["functionCallingConfig"],eU(n,s));const i=w(e,["retrievalConfig"]);return i!=null&&Z(t,["retrievalConfig"],nU(n,i)),t}function rU(n,e,t){const s={},i=w(e,["ttl"]);t!==void 0&&i!=null&&Z(t,["ttl"],i);const a=w(e,["expireTime"]);t!==void 0&&a!=null&&Z(t,["expireTime"],a);const o=w(e,["displayName"]);t!==void 0&&o!=null&&Z(t,["displayName"],o);const l=w(e,["contents"]);if(t!==void 0&&l!=null){let f=Ta(n,l);Array.isArray(f)&&(f=f.map(p=>l2(n,p))),Z(t,["contents"],f)}const c=w(e,["systemInstruction"]);t!==void 0&&c!=null&&Z(t,["systemInstruction"],l2(n,ei(n,c)));const d=w(e,["tools"]);if(t!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>$z(n,p))),Z(t,["tools"],f)}const h=w(e,["toolConfig"]);t!==void 0&&h!=null&&Z(t,["toolConfig"],sU(n,h));const m=w(e,["kmsKeyName"]);return t!==void 0&&m!=null&&Z(t,["encryption_spec","kmsKeyName"],m),s}function iU(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["model"],FM(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],rU(n,i,t)),t}function aU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function oU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function lU(n,e,t){const s={},i=w(e,["ttl"]);t!==void 0&&i!=null&&Z(t,["ttl"],i);const a=w(e,["expireTime"]);return t!==void 0&&a!=null&&Z(t,["expireTime"],a),s}function cU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],od(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],lU(n,i,t)),t}function dU(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);return t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a),s}function gU(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],dU(n,s,t)),t}function yf(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["model"]);a!=null&&Z(t,["model"],a);const o=w(e,["createTime"]);o!=null&&Z(t,["createTime"],o);const l=w(e,["updateTime"]);l!=null&&Z(t,["updateTime"],l);const c=w(e,["expireTime"]);c!=null&&Z(t,["expireTime"],c);const d=w(e,["usageMetadata"]);return d!=null&&Z(t,["usageMetadata"],d),t}function uU(){return{}}function hU(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(o=>yf(n,o))),Z(t,["cachedContents"],a)}return t}function vf(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["model"]);a!=null&&Z(t,["model"],a);const o=w(e,["createTime"]);o!=null&&Z(t,["createTime"],o);const l=w(e,["updateTime"]);l!=null&&Z(t,["updateTime"],l);const c=w(e,["expireTime"]);c!=null&&Z(t,["expireTime"],c);const d=w(e,["usageMetadata"]);return d!=null&&Z(t,["usageMetadata"],d),t}function mU(){return{}}function IU(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["cachedContents"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(o=>vf(n,o))),Z(t,["cachedContents"],a)}return t}var Fu;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Fu||(Fu={}));class bp{constructor(e,t,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,i)}init(e,t,s){var i,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let o={config:{}};s?typeof s=="object"?o=Object.assign({},s):o=s:o={config:{}},o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(a=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}class CU extends Em{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new bp(Fu.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=iU(this.apiClient,e);return l=Jt("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>vf(this.apiClient,h))}else{const d=_z(this.apiClient,e);return l=Jt("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>yf(this.apiClient,h))}}async get(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=aU(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>vf(this.apiClient,h))}else{const d=jz(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>yf(this.apiClient,h))}}async delete(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=oU(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(()=>{const h=mU(),m=new t2;return Object.assign(m,h),m})}else{const d=Xz(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(()=>{const h=uU(),m=new t2;return Object.assign(m,h),m})}}async update(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=cU(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>vf(this.apiClient,h))}else{const d=Yz(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>yf(this.apiClient,h))}}async listInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=gU(this.apiClient,e);return l=Jt("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=IU(this.apiClient,h),f=new n2;return Object.assign(f,m),f})}else{const d=Mz(this.apiClient,e);return l=Jt("cachedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=hU(this.apiClient,h),f=new n2;return Object.assign(f,m),f})}}}function c2(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ts(n){return this instanceof ts?(this.v=n,this):new ts(n)}function gm(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(b){return Promise.resolve(b).then(p,m)}}function l(p,b){s[p]&&(i[p]=function(x){return new Promise(function(v,S){a.push([p,x,v,S])>1||c(p,x)})},b&&(i[p]=b(i[p])))}function c(p,b){try{d(s[p](b))}catch(x){f(a[0][3],x)}}function d(p){p.value instanceof ts?Promise.resolve(p.value.v).then(h,m):f(a[0][2],p)}function h(p){c("next",p)}function m(p){c("throw",p)}function f(p,b){p(b),a.shift(),a.length&&c(a[0][0],a[0][1])}}function xf(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof c2=="function"?c2(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(a){t[a]=n[a]&&function(o){return new Promise(function(l,c){o=n[a](o),i(l,c,o.done,o.value)})}}function i(a,o,l,c){Promise.resolve(c).then(function(d){a({value:d,done:l})},o)}}function fU(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:zM(t)}function zM(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function pU(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function d2(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const i=[];let a=!0;for(;s<t&&n[s].role==="model";)i.push(n[s]),a&&!zM(n[s])&&(a=!1),s++;a?e.push(...i):e.pop()}return e}class AU{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new bU(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class bU{constructor(e,t,s,i={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),pU(a)}async sendMessage(e){var t;await this.sendPromise;const s=ei(this.apiClient,e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,o,l;const c=await i,d=(o=(a=c.candidates)===null||a===void 0?void 0:a[0])===null||o===void 0?void 0:o.content,h=c.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let f=[];h!=null&&(f=(l=h.slice(m))!==null&&l!==void 0?l:[]);const p=d?[d]:[];this.recordHistory(s,p,f)})(),await this.sendPromise,i}async sendMessageStream(e){var t;await this.sendPromise;const s=ei(this.apiClient,e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const a=await i;return this.processStreamResponse(a,s)}getHistory(e=!1){const t=e?d2(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var s,i;return gm(this,arguments,function*(){var o,l,c,d;const h=[];try{for(var m=!0,f=xf(e),p;p=yield ts(f.next()),o=p.done,!o;m=!0){d=p.value,m=!1;const b=d;if(fU(b)){const x=(i=(s=b.candidates)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.content;x!==void 0&&h.push(x)}yield yield ts(b)}}catch(b){l={error:b}}finally{try{!m&&!o&&(c=f.return)&&(yield ts(c.call(f)))}finally{if(l)throw l.error}}this.recordHistory(t,h)})}recordHistory(e,t,s){let i=[];t.length>0&&t.every(a=>a.role!==void 0)?i=t:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...d2(s)):this.history.push(e),this.history.push(...i)}}function yU(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);return t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a),s}function vU(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],yU(n,s,t)),t}function xU(n,e){const t={},s=w(e,["details"]);s!=null&&Z(t,["details"],s);const i=w(e,["message"]);i!=null&&Z(t,["message"],i);const a=w(e,["code"]);return a!=null&&Z(t,["code"],a),t}function SU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["mimeType"]);a!=null&&Z(t,["mimeType"],a);const o=w(e,["sizeBytes"]);o!=null&&Z(t,["sizeBytes"],o);const l=w(e,["createTime"]);l!=null&&Z(t,["createTime"],l);const c=w(e,["expirationTime"]);c!=null&&Z(t,["expirationTime"],c);const d=w(e,["updateTime"]);d!=null&&Z(t,["updateTime"],d);const h=w(e,["sha256Hash"]);h!=null&&Z(t,["sha256Hash"],h);const m=w(e,["uri"]);m!=null&&Z(t,["uri"],m);const f=w(e,["downloadUri"]);f!=null&&Z(t,["downloadUri"],f);const p=w(e,["state"]);p!=null&&Z(t,["state"],p);const b=w(e,["source"]);b!=null&&Z(t,["source"],b);const x=w(e,["videoMetadata"]);x!=null&&Z(t,["videoMetadata"],x);const v=w(e,["error"]);return v!=null&&Z(t,["error"],xU(n,v)),t}function wU(n,e){const t={},s=w(e,["file"]);s!=null&&Z(t,["file"],SU(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function ZU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","file"],PM(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function GU(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","file"],PM(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function BU(n,e){const t={},s=w(e,["details"]);s!=null&&Z(t,["details"],s);const i=w(e,["message"]);i!=null&&Z(t,["message"],i);const a=w(e,["code"]);return a!=null&&Z(t,["code"],a),t}function qw(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["mimeType"]);a!=null&&Z(t,["mimeType"],a);const o=w(e,["sizeBytes"]);o!=null&&Z(t,["sizeBytes"],o);const l=w(e,["createTime"]);l!=null&&Z(t,["createTime"],l);const c=w(e,["expirationTime"]);c!=null&&Z(t,["expirationTime"],c);const d=w(e,["updateTime"]);d!=null&&Z(t,["updateTime"],d);const h=w(e,["sha256Hash"]);h!=null&&Z(t,["sha256Hash"],h);const m=w(e,["uri"]);m!=null&&Z(t,["uri"],m);const f=w(e,["downloadUri"]);f!=null&&Z(t,["downloadUri"],f);const p=w(e,["state"]);p!=null&&Z(t,["state"],p);const b=w(e,["source"]);b!=null&&Z(t,["source"],b);const x=w(e,["videoMetadata"]);x!=null&&Z(t,["videoMetadata"],x);const v=w(e,["error"]);return v!=null&&Z(t,["error"],BU(n,v)),t}function NU(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["files"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(o=>qw(n,o))),Z(t,["files"],a)}return t}function kU(){return{}}function RU(){return{}}let WU=class extends Em{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new bp(Fu.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>qw(this.apiClient,t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=vU(this.apiClient,e);return a=Jt("files",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=NU(this.apiClient,c),h=new rz;return Object.assign(h,d),h})}}async createInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=wU(this.apiClient,e);return a=Jt("upload/v1beta/files",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(()=>{const c=kU(),d=new iz;return Object.assign(d,c),d})}}async get(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=ZU(this.apiClient,e);return a=Jt("files/{file}",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>qw(this.apiClient,c))}}async delete(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=GU(this.apiClient,e);return a=Jt("files/{file}",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(()=>{const c=RU(),d=new az;return Object.assign(d,c),d})}}};function VU(n,e){const t={},s=w(e,["voiceName"]);return s!=null&&Z(t,["voiceName"],s),t}function _U(n,e){const t={},s=w(e,["voiceName"]);return s!=null&&Z(t,["voiceName"],s),t}function UM(n,e){const t={},s=w(e,["prebuiltVoiceConfig"]);return s!=null&&Z(t,["prebuiltVoiceConfig"],VU(n,s)),t}function jU(n,e){const t={},s=w(e,["prebuiltVoiceConfig"]);return s!=null&&Z(t,["prebuiltVoiceConfig"],_U(n,s)),t}function XU(n,e){const t={},s=w(e,["speaker"]);s!=null&&Z(t,["speaker"],s);const i=w(e,["voiceConfig"]);return i!=null&&Z(t,["voiceConfig"],UM(n,i)),t}function JU(n,e){const t={},s=w(e,["speakerVoiceConfigs"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>XU(n,a))),Z(t,["speakerVoiceConfigs"],i)}return t}function YU(n,e){const t={},s=w(e,["voiceConfig"]);s!=null&&Z(t,["voiceConfig"],UM(n,s));const i=w(e,["multiSpeakerVoiceConfig"]);i!=null&&Z(t,["multiSpeakerVoiceConfig"],JU(n,i));const a=w(e,["languageCode"]);return a!=null&&Z(t,["languageCode"],a),t}function FU(n,e){const t={},s=w(e,["voiceConfig"]);if(s!=null&&Z(t,["voiceConfig"],jU(n,s)),w(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=w(e,["languageCode"]);return i!=null&&Z(t,["languageCode"],i),t}function MU(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function HU(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function TU(n,e){const t={};if(w(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function EU(n,e){const t={},s=w(e,["displayName"]);s!=null&&Z(t,["displayName"],s);const i=w(e,["data"]);i!=null&&Z(t,["data"],i);const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function DU(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],MU(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],TU(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function LU(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],HU(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],EU(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function PU(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>DU(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function KU(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>LU(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function OU(n,e){const t={},s=w(e,["behavior"]);s!=null&&Z(t,["behavior"],s);const i=w(e,["description"]);i!=null&&Z(t,["description"],i);const a=w(e,["name"]);a!=null&&Z(t,["name"],a);const o=w(e,["parameters"]);o!=null&&Z(t,["parameters"],o);const l=w(e,["response"]);return l!=null&&Z(t,["response"],l),t}function zU(n,e){const t={};if(w(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=w(e,["description"]);s!=null&&Z(t,["description"],s);const i=w(e,["name"]);i!=null&&Z(t,["name"],i);const a=w(e,["parameters"]);a!=null&&Z(t,["parameters"],a);const o=w(e,["response"]);return o!=null&&Z(t,["response"],o),t}function UU(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function QU(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function qU(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],UU(n,s)),t}function $U(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],QU(n,s)),t}function e4(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function t4(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function n4(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],e4(n,s)),t}function s4(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],t4(n,s)),t}function r4(){return{}}function i4(n,e){const t={},s=w(e,["apiKeyString"]);return s!=null&&Z(t,["apiKeyString"],s),t}function a4(n,e){const t={},s=w(e,["apiKeyConfig"]);s!=null&&Z(t,["apiKeyConfig"],i4(n,s));const i=w(e,["authType"]);i!=null&&Z(t,["authType"],i);const a=w(e,["googleServiceAccountConfig"]);a!=null&&Z(t,["googleServiceAccountConfig"],a);const o=w(e,["httpBasicAuthConfig"]);o!=null&&Z(t,["httpBasicAuthConfig"],o);const l=w(e,["oauthConfig"]);l!=null&&Z(t,["oauthConfig"],l);const c=w(e,["oidcConfig"]);return c!=null&&Z(t,["oidcConfig"],c),t}function o4(n,e){const t={},s=w(e,["authConfig"]);return s!=null&&Z(t,["authConfig"],a4(n,s)),t}function l4(){return{}}function c4(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(d=>OU(n,d))),Z(t,["functionDeclarations"],c)}if(w(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=w(e,["googleSearch"]);i!=null&&Z(t,["googleSearch"],qU(n,i));const a=w(e,["googleSearchRetrieval"]);if(a!=null&&Z(t,["googleSearchRetrieval"],n4(n,a)),w(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(w(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");w(e,["urlContext"])!=null&&Z(t,["urlContext"],l4());const l=w(e,["codeExecution"]);return l!=null&&Z(t,["codeExecution"],l),t}function d4(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>zU(n,m))),Z(t,["functionDeclarations"],h)}const i=w(e,["retrieval"]);i!=null&&Z(t,["retrieval"],i);const a=w(e,["googleSearch"]);a!=null&&Z(t,["googleSearch"],$U(n,a));const o=w(e,["googleSearchRetrieval"]);o!=null&&Z(t,["googleSearchRetrieval"],s4(n,o)),w(e,["enterpriseWebSearch"])!=null&&Z(t,["enterpriseWebSearch"],r4());const c=w(e,["googleMaps"]);if(c!=null&&Z(t,["googleMaps"],o4(n,c)),w(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=w(e,["codeExecution"]);return d!=null&&Z(t,["codeExecution"],d),t}function g4(n,e){const t={},s=w(e,["handle"]);if(s!=null&&Z(t,["handle"],s),w(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function u4(n,e){const t={},s=w(e,["handle"]);s!=null&&Z(t,["handle"],s);const i=w(e,["transparent"]);return i!=null&&Z(t,["transparent"],i),t}function g2(){return{}}function u2(){return{}}function h4(n,e){const t={},s=w(e,["disabled"]);s!=null&&Z(t,["disabled"],s);const i=w(e,["startOfSpeechSensitivity"]);i!=null&&Z(t,["startOfSpeechSensitivity"],i);const a=w(e,["endOfSpeechSensitivity"]);a!=null&&Z(t,["endOfSpeechSensitivity"],a);const o=w(e,["prefixPaddingMs"]);o!=null&&Z(t,["prefixPaddingMs"],o);const l=w(e,["silenceDurationMs"]);return l!=null&&Z(t,["silenceDurationMs"],l),t}function m4(n,e){const t={},s=w(e,["disabled"]);s!=null&&Z(t,["disabled"],s);const i=w(e,["startOfSpeechSensitivity"]);i!=null&&Z(t,["startOfSpeechSensitivity"],i);const a=w(e,["endOfSpeechSensitivity"]);a!=null&&Z(t,["endOfSpeechSensitivity"],a);const o=w(e,["prefixPaddingMs"]);o!=null&&Z(t,["prefixPaddingMs"],o);const l=w(e,["silenceDurationMs"]);return l!=null&&Z(t,["silenceDurationMs"],l),t}function I4(n,e){const t={},s=w(e,["automaticActivityDetection"]);s!=null&&Z(t,["automaticActivityDetection"],h4(n,s));const i=w(e,["activityHandling"]);i!=null&&Z(t,["activityHandling"],i);const a=w(e,["turnCoverage"]);return a!=null&&Z(t,["turnCoverage"],a),t}function C4(n,e){const t={},s=w(e,["automaticActivityDetection"]);s!=null&&Z(t,["automaticActivityDetection"],m4(n,s));const i=w(e,["activityHandling"]);i!=null&&Z(t,["activityHandling"],i);const a=w(e,["turnCoverage"]);return a!=null&&Z(t,["turnCoverage"],a),t}function f4(n,e){const t={},s=w(e,["targetTokens"]);return s!=null&&Z(t,["targetTokens"],s),t}function p4(n,e){const t={},s=w(e,["targetTokens"]);return s!=null&&Z(t,["targetTokens"],s),t}function A4(n,e){const t={},s=w(e,["triggerTokens"]);s!=null&&Z(t,["triggerTokens"],s);const i=w(e,["slidingWindow"]);return i!=null&&Z(t,["slidingWindow"],f4(n,i)),t}function b4(n,e){const t={},s=w(e,["triggerTokens"]);s!=null&&Z(t,["triggerTokens"],s);const i=w(e,["slidingWindow"]);return i!=null&&Z(t,["slidingWindow"],p4(n,i)),t}function y4(n,e){const t={},s=w(e,["proactiveAudio"]);return s!=null&&Z(t,["proactiveAudio"],s),t}function v4(n,e){const t={},s=w(e,["proactiveAudio"]);return s!=null&&Z(t,["proactiveAudio"],s),t}function x4(n,e,t){const s={},i=w(e,["generationConfig"]);t!==void 0&&i!=null&&Z(t,["setup","generationConfig"],i);const a=w(e,["responseModalities"]);t!==void 0&&a!=null&&Z(t,["setup","generationConfig","responseModalities"],a);const o=w(e,["temperature"]);t!==void 0&&o!=null&&Z(t,["setup","generationConfig","temperature"],o);const l=w(e,["topP"]);t!==void 0&&l!=null&&Z(t,["setup","generationConfig","topP"],l);const c=w(e,["topK"]);t!==void 0&&c!=null&&Z(t,["setup","generationConfig","topK"],c);const d=w(e,["maxOutputTokens"]);t!==void 0&&d!=null&&Z(t,["setup","generationConfig","maxOutputTokens"],d);const h=w(e,["mediaResolution"]);t!==void 0&&h!=null&&Z(t,["setup","generationConfig","mediaResolution"],h);const m=w(e,["seed"]);t!==void 0&&m!=null&&Z(t,["setup","generationConfig","seed"],m);const f=w(e,["speechConfig"]);t!==void 0&&f!=null&&Z(t,["setup","generationConfig","speechConfig"],YU(n,DM(n,f)));const p=w(e,["enableAffectiveDialog"]);t!==void 0&&p!=null&&Z(t,["setup","generationConfig","enableAffectiveDialog"],p);const b=w(e,["systemInstruction"]);t!==void 0&&b!=null&&Z(t,["setup","systemInstruction"],PU(n,ei(n,b)));const x=w(e,["tools"]);if(t!==void 0&&x!=null){let _=Ap(n,x);Array.isArray(_)&&(_=_.map(Y=>c4(n,pp(n,Y)))),Z(t,["setup","tools"],_)}const v=w(e,["sessionResumption"]);t!==void 0&&v!=null&&Z(t,["setup","sessionResumption"],g4(n,v));const S=w(e,["inputAudioTranscription"]);t!==void 0&&S!=null&&Z(t,["setup","inputAudioTranscription"],g2());const B=w(e,["outputAudioTranscription"]);t!==void 0&&B!=null&&Z(t,["setup","outputAudioTranscription"],g2());const V=w(e,["realtimeInputConfig"]);t!==void 0&&V!=null&&Z(t,["setup","realtimeInputConfig"],I4(n,V));const R=w(e,["contextWindowCompression"]);t!==void 0&&R!=null&&Z(t,["setup","contextWindowCompression"],A4(n,R));const W=w(e,["proactivity"]);return t!==void 0&&W!=null&&Z(t,["setup","proactivity"],y4(n,W)),s}function S4(n,e,t){const s={},i=w(e,["generationConfig"]);t!==void 0&&i!=null&&Z(t,["setup","generationConfig"],i);const a=w(e,["responseModalities"]);t!==void 0&&a!=null&&Z(t,["setup","generationConfig","responseModalities"],a);const o=w(e,["temperature"]);t!==void 0&&o!=null&&Z(t,["setup","generationConfig","temperature"],o);const l=w(e,["topP"]);t!==void 0&&l!=null&&Z(t,["setup","generationConfig","topP"],l);const c=w(e,["topK"]);t!==void 0&&c!=null&&Z(t,["setup","generationConfig","topK"],c);const d=w(e,["maxOutputTokens"]);t!==void 0&&d!=null&&Z(t,["setup","generationConfig","maxOutputTokens"],d);const h=w(e,["mediaResolution"]);t!==void 0&&h!=null&&Z(t,["setup","generationConfig","mediaResolution"],h);const m=w(e,["seed"]);t!==void 0&&m!=null&&Z(t,["setup","generationConfig","seed"],m);const f=w(e,["speechConfig"]);t!==void 0&&f!=null&&Z(t,["setup","generationConfig","speechConfig"],FU(n,DM(n,f)));const p=w(e,["enableAffectiveDialog"]);t!==void 0&&p!=null&&Z(t,["setup","generationConfig","enableAffectiveDialog"],p);const b=w(e,["systemInstruction"]);t!==void 0&&b!=null&&Z(t,["setup","systemInstruction"],KU(n,ei(n,b)));const x=w(e,["tools"]);if(t!==void 0&&x!=null){let _=Ap(n,x);Array.isArray(_)&&(_=_.map(Y=>d4(n,pp(n,Y)))),Z(t,["setup","tools"],_)}const v=w(e,["sessionResumption"]);t!==void 0&&v!=null&&Z(t,["setup","sessionResumption"],u4(n,v));const S=w(e,["inputAudioTranscription"]);t!==void 0&&S!=null&&Z(t,["setup","inputAudioTranscription"],u2());const B=w(e,["outputAudioTranscription"]);t!==void 0&&B!=null&&Z(t,["setup","outputAudioTranscription"],u2());const V=w(e,["realtimeInputConfig"]);t!==void 0&&V!=null&&Z(t,["setup","realtimeInputConfig"],C4(n,V));const R=w(e,["contextWindowCompression"]);t!==void 0&&R!=null&&Z(t,["setup","contextWindowCompression"],b4(n,R));const W=w(e,["proactivity"]);return t!==void 0&&W!=null&&Z(t,["setup","proactivity"],v4(n,W)),s}function w4(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["setup","model"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],x4(n,i,t)),t}function Z4(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["setup","model"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],S4(n,i,t)),t}function G4(){return{}}function B4(){return{}}function N4(){return{}}function k4(){return{}}function R4(n,e){const t={},s=w(e,["media"]);s!=null&&Z(t,["mediaChunks"],MM(n,s));const i=w(e,["audio"]);i!=null&&Z(t,["audio"],dz(n,i));const a=w(e,["audioStreamEnd"]);a!=null&&Z(t,["audioStreamEnd"],a);const o=w(e,["video"]);o!=null&&Z(t,["video"],cz(n,o));const l=w(e,["text"]);return l!=null&&Z(t,["text"],l),w(e,["activityStart"])!=null&&Z(t,["activityStart"],G4()),w(e,["activityEnd"])!=null&&Z(t,["activityEnd"],N4()),t}function W4(n,e){const t={},s=w(e,["media"]);if(s!=null&&Z(t,["mediaChunks"],MM(n,s)),w(e,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=w(e,["audioStreamEnd"]);if(i!=null&&Z(t,["audioStreamEnd"],i),w(e,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(w(e,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return w(e,["activityStart"])!=null&&Z(t,["activityStart"],B4()),w(e,["activityEnd"])!=null&&Z(t,["activityEnd"],k4()),t}function QM(n,e){const t={},s=w(e,["text"]);s!=null&&Z(t,["text"],s);const i=w(e,["weight"]);return i!=null&&Z(t,["weight"],i),t}function V4(n,e){const t={},s=w(e,["weightedPrompts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>QM(n,a))),Z(t,["weightedPrompts"],i)}return t}function qM(n,e){const t={},s=w(e,["temperature"]);s!=null&&Z(t,["temperature"],s);const i=w(e,["topK"]);i!=null&&Z(t,["topK"],i);const a=w(e,["seed"]);a!=null&&Z(t,["seed"],a);const o=w(e,["guidance"]);o!=null&&Z(t,["guidance"],o);const l=w(e,["bpm"]);l!=null&&Z(t,["bpm"],l);const c=w(e,["density"]);c!=null&&Z(t,["density"],c);const d=w(e,["brightness"]);d!=null&&Z(t,["brightness"],d);const h=w(e,["scale"]);h!=null&&Z(t,["scale"],h);const m=w(e,["muteBass"]);m!=null&&Z(t,["muteBass"],m);const f=w(e,["muteDrums"]);f!=null&&Z(t,["muteDrums"],f);const p=w(e,["onlyBassAndDrums"]);p!=null&&Z(t,["onlyBassAndDrums"],p);const b=w(e,["musicGenerationMode"]);return b!=null&&Z(t,["musicGenerationMode"],b),t}function _4(n,e){const t={},s=w(e,["musicGenerationConfig"]);return s!=null&&Z(t,["musicGenerationConfig"],qM(n,s)),t}function $M(n,e){const t={},s=w(e,["model"]);return s!=null&&Z(t,["model"],s),t}function eH(n,e){const t={},s=w(e,["weightedPrompts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>QM(n,a))),Z(t,["weightedPrompts"],i)}return t}function $w(n,e){const t={},s=w(e,["setup"]);s!=null&&Z(t,["setup"],$M(n,s));const i=w(e,["clientContent"]);i!=null&&Z(t,["clientContent"],eH(n,i));const a=w(e,["musicGenerationConfig"]);a!=null&&Z(t,["musicGenerationConfig"],qM(n,a));const o=w(e,["playbackControl"]);return o!=null&&Z(t,["playbackControl"],o),t}function j4(){return{}}function X4(){return{}}function J4(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function Y4(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function F4(n,e){const t={},s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function M4(n,e){const t={},s=w(e,["displayName"]);s!=null&&Z(t,["displayName"],s);const i=w(e,["data"]);i!=null&&Z(t,["data"],i);const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function H4(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],J4(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],F4(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function T4(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],Y4(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],M4(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function E4(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>H4(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function D4(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>T4(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function h2(n,e){const t={},s=w(e,["text"]);s!=null&&Z(t,["text"],s);const i=w(e,["finished"]);return i!=null&&Z(t,["finished"],i),t}function m2(n,e){const t={},s=w(e,["text"]);s!=null&&Z(t,["text"],s);const i=w(e,["finished"]);return i!=null&&Z(t,["finished"],i),t}function L4(n,e){const t={},s=w(e,["retrievedUrl"]);s!=null&&Z(t,["retrievedUrl"],s);const i=w(e,["urlRetrievalStatus"]);return i!=null&&Z(t,["urlRetrievalStatus"],i),t}function P4(n,e){const t={},s=w(e,["urlMetadata"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>L4(n,a))),Z(t,["urlMetadata"],i)}return t}function K4(n,e){const t={},s=w(e,["modelTurn"]);s!=null&&Z(t,["modelTurn"],E4(n,s));const i=w(e,["turnComplete"]);i!=null&&Z(t,["turnComplete"],i);const a=w(e,["interrupted"]);a!=null&&Z(t,["interrupted"],a);const o=w(e,["groundingMetadata"]);o!=null&&Z(t,["groundingMetadata"],o);const l=w(e,["generationComplete"]);l!=null&&Z(t,["generationComplete"],l);const c=w(e,["inputTranscription"]);c!=null&&Z(t,["inputTranscription"],h2(n,c));const d=w(e,["outputTranscription"]);d!=null&&Z(t,["outputTranscription"],h2(n,d));const h=w(e,["urlContextMetadata"]);return h!=null&&Z(t,["urlContextMetadata"],P4(n,h)),t}function O4(n,e){const t={},s=w(e,["modelTurn"]);s!=null&&Z(t,["modelTurn"],D4(n,s));const i=w(e,["turnComplete"]);i!=null&&Z(t,["turnComplete"],i);const a=w(e,["interrupted"]);a!=null&&Z(t,["interrupted"],a);const o=w(e,["groundingMetadata"]);o!=null&&Z(t,["groundingMetadata"],o);const l=w(e,["generationComplete"]);l!=null&&Z(t,["generationComplete"],l);const c=w(e,["inputTranscription"]);c!=null&&Z(t,["inputTranscription"],m2(n,c));const d=w(e,["outputTranscription"]);return d!=null&&Z(t,["outputTranscription"],m2(n,d)),t}function z4(n,e){const t={},s=w(e,["id"]);s!=null&&Z(t,["id"],s);const i=w(e,["args"]);i!=null&&Z(t,["args"],i);const a=w(e,["name"]);return a!=null&&Z(t,["name"],a),t}function U4(n,e){const t={},s=w(e,["args"]);s!=null&&Z(t,["args"],s);const i=w(e,["name"]);return i!=null&&Z(t,["name"],i),t}function Q4(n,e){const t={},s=w(e,["functionCalls"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>z4(n,a))),Z(t,["functionCalls"],i)}return t}function q4(n,e){const t={},s=w(e,["functionCalls"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>U4(n,a))),Z(t,["functionCalls"],i)}return t}function $4(n,e){const t={},s=w(e,["ids"]);return s!=null&&Z(t,["ids"],s),t}function eQ(n,e){const t={},s=w(e,["ids"]);return s!=null&&Z(t,["ids"],s),t}function tC(n,e){const t={},s=w(e,["modality"]);s!=null&&Z(t,["modality"],s);const i=w(e,["tokenCount"]);return i!=null&&Z(t,["tokenCount"],i),t}function nC(n,e){const t={},s=w(e,["modality"]);s!=null&&Z(t,["modality"],s);const i=w(e,["tokenCount"]);return i!=null&&Z(t,["tokenCount"],i),t}function tQ(n,e){const t={},s=w(e,["promptTokenCount"]);s!=null&&Z(t,["promptTokenCount"],s);const i=w(e,["cachedContentTokenCount"]);i!=null&&Z(t,["cachedContentTokenCount"],i);const a=w(e,["responseTokenCount"]);a!=null&&Z(t,["responseTokenCount"],a);const o=w(e,["toolUsePromptTokenCount"]);o!=null&&Z(t,["toolUsePromptTokenCount"],o);const l=w(e,["thoughtsTokenCount"]);l!=null&&Z(t,["thoughtsTokenCount"],l);const c=w(e,["totalTokenCount"]);c!=null&&Z(t,["totalTokenCount"],c);const d=w(e,["promptTokensDetails"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(b=>tC(n,b))),Z(t,["promptTokensDetails"],p)}const h=w(e,["cacheTokensDetails"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(b=>tC(n,b))),Z(t,["cacheTokensDetails"],p)}const m=w(e,["responseTokensDetails"]);if(m!=null){let p=m;Array.isArray(p)&&(p=p.map(b=>tC(n,b))),Z(t,["responseTokensDetails"],p)}const f=w(e,["toolUsePromptTokensDetails"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(b=>tC(n,b))),Z(t,["toolUsePromptTokensDetails"],p)}return t}function nQ(n,e){const t={},s=w(e,["promptTokenCount"]);s!=null&&Z(t,["promptTokenCount"],s);const i=w(e,["cachedContentTokenCount"]);i!=null&&Z(t,["cachedContentTokenCount"],i);const a=w(e,["candidatesTokenCount"]);a!=null&&Z(t,["responseTokenCount"],a);const o=w(e,["toolUsePromptTokenCount"]);o!=null&&Z(t,["toolUsePromptTokenCount"],o);const l=w(e,["thoughtsTokenCount"]);l!=null&&Z(t,["thoughtsTokenCount"],l);const c=w(e,["totalTokenCount"]);c!=null&&Z(t,["totalTokenCount"],c);const d=w(e,["promptTokensDetails"]);if(d!=null){let b=d;Array.isArray(b)&&(b=b.map(x=>nC(n,x))),Z(t,["promptTokensDetails"],b)}const h=w(e,["cacheTokensDetails"]);if(h!=null){let b=h;Array.isArray(b)&&(b=b.map(x=>nC(n,x))),Z(t,["cacheTokensDetails"],b)}const m=w(e,["candidatesTokensDetails"]);if(m!=null){let b=m;Array.isArray(b)&&(b=b.map(x=>nC(n,x))),Z(t,["responseTokensDetails"],b)}const f=w(e,["toolUsePromptTokensDetails"]);if(f!=null){let b=f;Array.isArray(b)&&(b=b.map(x=>nC(n,x))),Z(t,["toolUsePromptTokensDetails"],b)}const p=w(e,["trafficType"]);return p!=null&&Z(t,["trafficType"],p),t}function sQ(n,e){const t={},s=w(e,["timeLeft"]);return s!=null&&Z(t,["timeLeft"],s),t}function rQ(n,e){const t={},s=w(e,["timeLeft"]);return s!=null&&Z(t,["timeLeft"],s),t}function iQ(n,e){const t={},s=w(e,["newHandle"]);s!=null&&Z(t,["newHandle"],s);const i=w(e,["resumable"]);i!=null&&Z(t,["resumable"],i);const a=w(e,["lastConsumedClientMessageIndex"]);return a!=null&&Z(t,["lastConsumedClientMessageIndex"],a),t}function aQ(n,e){const t={},s=w(e,["newHandle"]);s!=null&&Z(t,["newHandle"],s);const i=w(e,["resumable"]);i!=null&&Z(t,["resumable"],i);const a=w(e,["lastConsumedClientMessageIndex"]);return a!=null&&Z(t,["lastConsumedClientMessageIndex"],a),t}function oQ(n,e){const t={};w(e,["setupComplete"])!=null&&Z(t,["setupComplete"],j4());const i=w(e,["serverContent"]);i!=null&&Z(t,["serverContent"],K4(n,i));const a=w(e,["toolCall"]);a!=null&&Z(t,["toolCall"],Q4(n,a));const o=w(e,["toolCallCancellation"]);o!=null&&Z(t,["toolCallCancellation"],$4(n,o));const l=w(e,["usageMetadata"]);l!=null&&Z(t,["usageMetadata"],tQ(n,l));const c=w(e,["goAway"]);c!=null&&Z(t,["goAway"],sQ(n,c));const d=w(e,["sessionResumptionUpdate"]);return d!=null&&Z(t,["sessionResumptionUpdate"],iQ(n,d)),t}function lQ(n,e){const t={};w(e,["setupComplete"])!=null&&Z(t,["setupComplete"],X4());const i=w(e,["serverContent"]);i!=null&&Z(t,["serverContent"],O4(n,i));const a=w(e,["toolCall"]);a!=null&&Z(t,["toolCall"],q4(n,a));const o=w(e,["toolCallCancellation"]);o!=null&&Z(t,["toolCallCancellation"],eQ(n,o));const l=w(e,["usageMetadata"]);l!=null&&Z(t,["usageMetadata"],nQ(n,l));const c=w(e,["goAway"]);c!=null&&Z(t,["goAway"],rQ(n,c));const d=w(e,["sessionResumptionUpdate"]);return d!=null&&Z(t,["sessionResumptionUpdate"],aQ(n,d)),t}function cQ(){return{}}function dQ(n,e){const t={},s=w(e,["text"]);s!=null&&Z(t,["text"],s);const i=w(e,["weight"]);return i!=null&&Z(t,["weight"],i),t}function gQ(n,e){const t={},s=w(e,["weightedPrompts"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>dQ(n,a))),Z(t,["weightedPrompts"],i)}return t}function uQ(n,e){const t={},s=w(e,["temperature"]);s!=null&&Z(t,["temperature"],s);const i=w(e,["topK"]);i!=null&&Z(t,["topK"],i);const a=w(e,["seed"]);a!=null&&Z(t,["seed"],a);const o=w(e,["guidance"]);o!=null&&Z(t,["guidance"],o);const l=w(e,["bpm"]);l!=null&&Z(t,["bpm"],l);const c=w(e,["density"]);c!=null&&Z(t,["density"],c);const d=w(e,["brightness"]);d!=null&&Z(t,["brightness"],d);const h=w(e,["scale"]);h!=null&&Z(t,["scale"],h);const m=w(e,["muteBass"]);m!=null&&Z(t,["muteBass"],m);const f=w(e,["muteDrums"]);f!=null&&Z(t,["muteDrums"],f);const p=w(e,["onlyBassAndDrums"]);p!=null&&Z(t,["onlyBassAndDrums"],p);const b=w(e,["musicGenerationMode"]);return b!=null&&Z(t,["musicGenerationMode"],b),t}function hQ(n,e){const t={},s=w(e,["clientContent"]);s!=null&&Z(t,["clientContent"],gQ(n,s));const i=w(e,["musicGenerationConfig"]);return i!=null&&Z(t,["musicGenerationConfig"],uQ(n,i)),t}function mQ(n,e){const t={},s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);i!=null&&Z(t,["mimeType"],i);const a=w(e,["sourceMetadata"]);return a!=null&&Z(t,["sourceMetadata"],hQ(n,a)),t}function IQ(n,e){const t={},s=w(e,["audioChunks"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>mQ(n,a))),Z(t,["audioChunks"],i)}return t}function CQ(n,e){const t={},s=w(e,["text"]);s!=null&&Z(t,["text"],s);const i=w(e,["filteredReason"]);return i!=null&&Z(t,["filteredReason"],i),t}function fQ(n,e){const t={};w(e,["setupComplete"])!=null&&Z(t,["setupComplete"],cQ());const i=w(e,["serverContent"]);i!=null&&Z(t,["serverContent"],IQ(n,i));const a=w(e,["filteredPrompt"]);return a!=null&&Z(t,["filteredPrompt"],CQ(n,a)),t}function pQ(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function AQ(n,e){const t={};if(w(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function bQ(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],pQ(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],AQ(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function yp(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>bQ(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function yQ(n,e){const t={};if(w(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=w(e,["category"]);s!=null&&Z(t,["category"],s);const i=w(e,["threshold"]);return i!=null&&Z(t,["threshold"],i),t}function vQ(n,e){const t={},s=w(e,["behavior"]);s!=null&&Z(t,["behavior"],s);const i=w(e,["description"]);i!=null&&Z(t,["description"],i);const a=w(e,["name"]);a!=null&&Z(t,["name"],a);const o=w(e,["parameters"]);o!=null&&Z(t,["parameters"],o);const l=w(e,["response"]);return l!=null&&Z(t,["response"],l),t}function xQ(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function SQ(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],xQ(n,s)),t}function wQ(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function ZQ(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],wQ(n,s)),t}function GQ(){return{}}function BQ(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(d=>vQ(n,d))),Z(t,["functionDeclarations"],c)}if(w(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=w(e,["googleSearch"]);i!=null&&Z(t,["googleSearch"],SQ(n,i));const a=w(e,["googleSearchRetrieval"]);if(a!=null&&Z(t,["googleSearchRetrieval"],ZQ(n,a)),w(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(w(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");w(e,["urlContext"])!=null&&Z(t,["urlContext"],GQ());const l=w(e,["codeExecution"]);return l!=null&&Z(t,["codeExecution"],l),t}function NQ(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["allowedFunctionNames"]);return i!=null&&Z(t,["allowedFunctionNames"],i),t}function kQ(n,e){const t={},s=w(e,["latitude"]);s!=null&&Z(t,["latitude"],s);const i=w(e,["longitude"]);return i!=null&&Z(t,["longitude"],i),t}function RQ(n,e){const t={},s=w(e,["latLng"]);return s!=null&&Z(t,["latLng"],kQ(n,s)),t}function WQ(n,e){const t={},s=w(e,["functionCallingConfig"]);s!=null&&Z(t,["functionCallingConfig"],NQ(n,s));const i=w(e,["retrievalConfig"]);return i!=null&&Z(t,["retrievalConfig"],RQ(n,i)),t}function VQ(n,e){const t={},s=w(e,["voiceName"]);return s!=null&&Z(t,["voiceName"],s),t}function tH(n,e){const t={},s=w(e,["prebuiltVoiceConfig"]);return s!=null&&Z(t,["prebuiltVoiceConfig"],VQ(n,s)),t}function _Q(n,e){const t={},s=w(e,["speaker"]);s!=null&&Z(t,["speaker"],s);const i=w(e,["voiceConfig"]);return i!=null&&Z(t,["voiceConfig"],tH(n,i)),t}function jQ(n,e){const t={},s=w(e,["speakerVoiceConfigs"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>_Q(n,a))),Z(t,["speakerVoiceConfigs"],i)}return t}function XQ(n,e){const t={},s=w(e,["voiceConfig"]);s!=null&&Z(t,["voiceConfig"],tH(n,s));const i=w(e,["multiSpeakerVoiceConfig"]);i!=null&&Z(t,["multiSpeakerVoiceConfig"],jQ(n,i));const a=w(e,["languageCode"]);return a!=null&&Z(t,["languageCode"],a),t}function JQ(n,e){const t={},s=w(e,["includeThoughts"]);s!=null&&Z(t,["includeThoughts"],s);const i=w(e,["thinkingBudget"]);return i!=null&&Z(t,["thinkingBudget"],i),t}function YQ(n,e,t){const s={},i=w(e,["systemInstruction"]);t!==void 0&&i!=null&&Z(t,["systemInstruction"],yp(n,ei(n,i)));const a=w(e,["temperature"]);a!=null&&Z(s,["temperature"],a);const o=w(e,["topP"]);o!=null&&Z(s,["topP"],o);const l=w(e,["topK"]);l!=null&&Z(s,["topK"],l);const c=w(e,["candidateCount"]);c!=null&&Z(s,["candidateCount"],c);const d=w(e,["maxOutputTokens"]);d!=null&&Z(s,["maxOutputTokens"],d);const h=w(e,["stopSequences"]);h!=null&&Z(s,["stopSequences"],h);const m=w(e,["responseLogprobs"]);m!=null&&Z(s,["responseLogprobs"],m);const f=w(e,["logprobs"]);f!=null&&Z(s,["logprobs"],f);const p=w(e,["presencePenalty"]);p!=null&&Z(s,["presencePenalty"],p);const b=w(e,["frequencyPenalty"]);b!=null&&Z(s,["frequencyPenalty"],b);const x=w(e,["seed"]);x!=null&&Z(s,["seed"],x);const v=w(e,["responseMimeType"]);v!=null&&Z(s,["responseMimeType"],v);const S=w(e,["responseSchema"]);if(S!=null&&Z(s,["responseSchema"],Lf(n,S)),w(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(w(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const B=w(e,["safetySettings"]);if(t!==void 0&&B!=null){let H=B;Array.isArray(H)&&(H=H.map(D=>yQ(n,D))),Z(t,["safetySettings"],H)}const V=w(e,["tools"]);if(t!==void 0&&V!=null){let H=Ap(n,V);Array.isArray(H)&&(H=H.map(D=>BQ(n,pp(n,D)))),Z(t,["tools"],H)}const R=w(e,["toolConfig"]);if(t!==void 0&&R!=null&&Z(t,["toolConfig"],WQ(n,R)),w(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const W=w(e,["cachedContent"]);t!==void 0&&W!=null&&Z(t,["cachedContent"],od(n,W));const _=w(e,["responseModalities"]);_!=null&&Z(s,["responseModalities"],_);const Y=w(e,["mediaResolution"]);Y!=null&&Z(s,["mediaResolution"],Y);const j=w(e,["speechConfig"]);if(j!=null&&Z(s,["speechConfig"],XQ(n,EM(n,j))),w(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const M=w(e,["thinkingConfig"]);return M!=null&&Z(s,["thinkingConfig"],JQ(n,M)),s}function I2(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);if(i!=null){let o=Ta(n,i);Array.isArray(o)&&(o=o.map(l=>yp(n,l))),Z(t,["contents"],o)}const a=w(e,["config"]);return a!=null&&Z(t,["generationConfig"],YQ(n,a,t)),t}function FQ(n,e,t){const s={},i=w(e,["taskType"]);t!==void 0&&i!=null&&Z(t,["requests[]","taskType"],i);const a=w(e,["title"]);t!==void 0&&a!=null&&Z(t,["requests[]","title"],a);const o=w(e,["outputDimensionality"]);if(t!==void 0&&o!=null&&Z(t,["requests[]","outputDimensionality"],o),w(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(w(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function MQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);i!=null&&Z(t,["requests[]","content"],TM(n,i));const a=w(e,["config"]);a!=null&&Z(t,["config"],FQ(n,a,t));const o=w(e,["model"]);return o!==void 0&&Z(t,["requests[]","model"],zn(n,o)),t}function HQ(n,e,t){const s={};if(w(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(w(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=w(e,["numberOfImages"]);t!==void 0&&i!=null&&Z(t,["parameters","sampleCount"],i);const a=w(e,["aspectRatio"]);t!==void 0&&a!=null&&Z(t,["parameters","aspectRatio"],a);const o=w(e,["guidanceScale"]);if(t!==void 0&&o!=null&&Z(t,["parameters","guidanceScale"],o),w(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=w(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&Z(t,["parameters","safetySetting"],l);const c=w(e,["personGeneration"]);t!==void 0&&c!=null&&Z(t,["parameters","personGeneration"],c);const d=w(e,["includeSafetyAttributes"]);t!==void 0&&d!=null&&Z(t,["parameters","includeSafetyAttributes"],d);const h=w(e,["includeRaiReason"]);t!==void 0&&h!=null&&Z(t,["parameters","includeRaiReason"],h);const m=w(e,["language"]);t!==void 0&&m!=null&&Z(t,["parameters","language"],m);const f=w(e,["outputMimeType"]);t!==void 0&&f!=null&&Z(t,["parameters","outputOptions","mimeType"],f);const p=w(e,["outputCompressionQuality"]);if(t!==void 0&&p!=null&&Z(t,["parameters","outputOptions","compressionQuality"],p),w(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(w(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return s}function TQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["prompt"]);i!=null&&Z(t,["instances[0]","prompt"],i);const a=w(e,["config"]);return a!=null&&Z(t,["config"],HQ(n,a,t)),t}function EQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","name"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function DQ(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a);const o=w(e,["filter"]);t!==void 0&&o!=null&&Z(t,["_query","filter"],o);const l=w(e,["queryBase"]);return t!==void 0&&l!=null&&Z(t,["_url","models_url"],KM(n,l)),s}function LQ(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],DQ(n,s,t)),t}function PQ(n,e,t){const s={},i=w(e,["displayName"]);t!==void 0&&i!=null&&Z(t,["displayName"],i);const a=w(e,["description"]);t!==void 0&&a!=null&&Z(t,["description"],a);const o=w(e,["defaultCheckpointId"]);return t!==void 0&&o!=null&&Z(t,["defaultCheckpointId"],o),s}function KQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","name"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],PQ(n,i,t)),t}function OQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","name"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function zQ(n,e){const t={};if(w(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(w(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(w(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function UQ(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);if(i!=null){let o=Ta(n,i);Array.isArray(o)&&(o=o.map(l=>yp(n,l))),Z(t,["contents"],o)}const a=w(e,["config"]);return a!=null&&Z(t,["config"],zQ(n,a)),t}function QQ(n,e){const t={};if(w(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const s=w(e,["imageBytes"]);s!=null&&Z(t,["bytesBase64Encoded"],ld(n,s));const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function qQ(n,e,t){const s={},i=w(e,["numberOfVideos"]);if(t!==void 0&&i!=null&&Z(t,["parameters","sampleCount"],i),w(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(w(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=w(e,["durationSeconds"]);if(t!==void 0&&a!=null&&Z(t,["parameters","durationSeconds"],a),w(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=w(e,["aspectRatio"]);if(t!==void 0&&o!=null&&Z(t,["parameters","aspectRatio"],o),w(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const l=w(e,["personGeneration"]);if(t!==void 0&&l!=null&&Z(t,["parameters","personGeneration"],l),w(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=w(e,["negativePrompt"]);if(t!==void 0&&c!=null&&Z(t,["parameters","negativePrompt"],c),w(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return s}function $Q(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["prompt"]);i!=null&&Z(t,["instances[0]","prompt"],i);const a=w(e,["image"]);a!=null&&Z(t,["instances[0]","image"],QQ(n,a));const o=w(e,["config"]);return o!=null&&Z(t,["config"],qQ(n,o,t)),t}function e8(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function t8(n,e){const t={},s=w(e,["displayName"]);s!=null&&Z(t,["displayName"],s);const i=w(e,["data"]);i!=null&&Z(t,["data"],i);const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function n8(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],e8(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],t8(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function eh(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>n8(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function s8(n,e){const t={},s=w(e,["featureSelectionPreference"]);return s!=null&&Z(t,["featureSelectionPreference"],s),t}function r8(n,e){const t={},s=w(e,["method"]);s!=null&&Z(t,["method"],s);const i=w(e,["category"]);i!=null&&Z(t,["category"],i);const a=w(e,["threshold"]);return a!=null&&Z(t,["threshold"],a),t}function i8(n,e){const t={};if(w(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=w(e,["description"]);s!=null&&Z(t,["description"],s);const i=w(e,["name"]);i!=null&&Z(t,["name"],i);const a=w(e,["parameters"]);a!=null&&Z(t,["parameters"],a);const o=w(e,["response"]);return o!=null&&Z(t,["response"],o),t}function a8(n,e){const t={},s=w(e,["startTime"]);s!=null&&Z(t,["startTime"],s);const i=w(e,["endTime"]);return i!=null&&Z(t,["endTime"],i),t}function o8(n,e){const t={},s=w(e,["timeRangeFilter"]);return s!=null&&Z(t,["timeRangeFilter"],a8(n,s)),t}function l8(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["dynamicThreshold"]);return i!=null&&Z(t,["dynamicThreshold"],i),t}function c8(n,e){const t={},s=w(e,["dynamicRetrievalConfig"]);return s!=null&&Z(t,["dynamicRetrievalConfig"],l8(n,s)),t}function d8(){return{}}function g8(n,e){const t={},s=w(e,["apiKeyString"]);return s!=null&&Z(t,["apiKeyString"],s),t}function u8(n,e){const t={},s=w(e,["apiKeyConfig"]);s!=null&&Z(t,["apiKeyConfig"],g8(n,s));const i=w(e,["authType"]);i!=null&&Z(t,["authType"],i);const a=w(e,["googleServiceAccountConfig"]);a!=null&&Z(t,["googleServiceAccountConfig"],a);const o=w(e,["httpBasicAuthConfig"]);o!=null&&Z(t,["httpBasicAuthConfig"],o);const l=w(e,["oauthConfig"]);l!=null&&Z(t,["oauthConfig"],l);const c=w(e,["oidcConfig"]);return c!=null&&Z(t,["oidcConfig"],c),t}function h8(n,e){const t={},s=w(e,["authConfig"]);return s!=null&&Z(t,["authConfig"],u8(n,s)),t}function nH(n,e){const t={},s=w(e,["functionDeclarations"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>i8(n,m))),Z(t,["functionDeclarations"],h)}const i=w(e,["retrieval"]);i!=null&&Z(t,["retrieval"],i);const a=w(e,["googleSearch"]);a!=null&&Z(t,["googleSearch"],o8(n,a));const o=w(e,["googleSearchRetrieval"]);o!=null&&Z(t,["googleSearchRetrieval"],c8(n,o)),w(e,["enterpriseWebSearch"])!=null&&Z(t,["enterpriseWebSearch"],d8());const c=w(e,["googleMaps"]);if(c!=null&&Z(t,["googleMaps"],h8(n,c)),w(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=w(e,["codeExecution"]);return d!=null&&Z(t,["codeExecution"],d),t}function m8(n,e){const t={},s=w(e,["mode"]);s!=null&&Z(t,["mode"],s);const i=w(e,["allowedFunctionNames"]);return i!=null&&Z(t,["allowedFunctionNames"],i),t}function I8(n,e){const t={},s=w(e,["latitude"]);s!=null&&Z(t,["latitude"],s);const i=w(e,["longitude"]);return i!=null&&Z(t,["longitude"],i),t}function C8(n,e){const t={},s=w(e,["latLng"]);return s!=null&&Z(t,["latLng"],I8(n,s)),t}function f8(n,e){const t={},s=w(e,["functionCallingConfig"]);s!=null&&Z(t,["functionCallingConfig"],m8(n,s));const i=w(e,["retrievalConfig"]);return i!=null&&Z(t,["retrievalConfig"],C8(n,i)),t}function p8(n,e){const t={},s=w(e,["voiceName"]);return s!=null&&Z(t,["voiceName"],s),t}function A8(n,e){const t={},s=w(e,["prebuiltVoiceConfig"]);return s!=null&&Z(t,["prebuiltVoiceConfig"],p8(n,s)),t}function b8(n,e){const t={},s=w(e,["voiceConfig"]);if(s!=null&&Z(t,["voiceConfig"],A8(n,s)),w(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=w(e,["languageCode"]);return i!=null&&Z(t,["languageCode"],i),t}function y8(n,e){const t={},s=w(e,["includeThoughts"]);s!=null&&Z(t,["includeThoughts"],s);const i=w(e,["thinkingBudget"]);return i!=null&&Z(t,["thinkingBudget"],i),t}function v8(n,e,t){const s={},i=w(e,["systemInstruction"]);t!==void 0&&i!=null&&Z(t,["systemInstruction"],eh(n,ei(n,i)));const a=w(e,["temperature"]);a!=null&&Z(s,["temperature"],a);const o=w(e,["topP"]);o!=null&&Z(s,["topP"],o);const l=w(e,["topK"]);l!=null&&Z(s,["topK"],l);const c=w(e,["candidateCount"]);c!=null&&Z(s,["candidateCount"],c);const d=w(e,["maxOutputTokens"]);d!=null&&Z(s,["maxOutputTokens"],d);const h=w(e,["stopSequences"]);h!=null&&Z(s,["stopSequences"],h);const m=w(e,["responseLogprobs"]);m!=null&&Z(s,["responseLogprobs"],m);const f=w(e,["logprobs"]);f!=null&&Z(s,["logprobs"],f);const p=w(e,["presencePenalty"]);p!=null&&Z(s,["presencePenalty"],p);const b=w(e,["frequencyPenalty"]);b!=null&&Z(s,["frequencyPenalty"],b);const x=w(e,["seed"]);x!=null&&Z(s,["seed"],x);const v=w(e,["responseMimeType"]);v!=null&&Z(s,["responseMimeType"],v);const S=w(e,["responseSchema"]);S!=null&&Z(s,["responseSchema"],Lf(n,S));const B=w(e,["routingConfig"]);B!=null&&Z(s,["routingConfig"],B);const V=w(e,["modelSelectionConfig"]);V!=null&&Z(s,["modelConfig"],s8(n,V));const R=w(e,["safetySettings"]);if(t!==void 0&&R!=null){let E=R;Array.isArray(E)&&(E=E.map(te=>r8(n,te))),Z(t,["safetySettings"],E)}const W=w(e,["tools"]);if(t!==void 0&&W!=null){let E=Ap(n,W);Array.isArray(E)&&(E=E.map(te=>nH(n,pp(n,te)))),Z(t,["tools"],E)}const _=w(e,["toolConfig"]);t!==void 0&&_!=null&&Z(t,["toolConfig"],f8(n,_));const Y=w(e,["labels"]);t!==void 0&&Y!=null&&Z(t,["labels"],Y);const j=w(e,["cachedContent"]);t!==void 0&&j!=null&&Z(t,["cachedContent"],od(n,j));const M=w(e,["responseModalities"]);M!=null&&Z(s,["responseModalities"],M);const H=w(e,["mediaResolution"]);H!=null&&Z(s,["mediaResolution"],H);const D=w(e,["speechConfig"]);D!=null&&Z(s,["speechConfig"],b8(n,EM(n,D)));const z=w(e,["audioTimestamp"]);z!=null&&Z(s,["audioTimestamp"],z);const O=w(e,["thinkingConfig"]);return O!=null&&Z(s,["thinkingConfig"],y8(n,O)),s}function C2(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);if(i!=null){let o=Ta(n,i);Array.isArray(o)&&(o=o.map(l=>eh(n,l))),Z(t,["contents"],o)}const a=w(e,["config"]);return a!=null&&Z(t,["generationConfig"],v8(n,a,t)),t}function x8(n,e,t){const s={},i=w(e,["taskType"]);t!==void 0&&i!=null&&Z(t,["instances[]","task_type"],i);const a=w(e,["title"]);t!==void 0&&a!=null&&Z(t,["instances[]","title"],a);const o=w(e,["outputDimensionality"]);t!==void 0&&o!=null&&Z(t,["parameters","outputDimensionality"],o);const l=w(e,["mimeType"]);t!==void 0&&l!=null&&Z(t,["instances[]","mimeType"],l);const c=w(e,["autoTruncate"]);return t!==void 0&&c!=null&&Z(t,["parameters","autoTruncate"],c),s}function S8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);i!=null&&Z(t,["instances[]","content"],TM(n,i));const a=w(e,["config"]);return a!=null&&Z(t,["config"],x8(n,a,t)),t}function w8(n,e,t){const s={},i=w(e,["outputGcsUri"]);t!==void 0&&i!=null&&Z(t,["parameters","storageUri"],i);const a=w(e,["negativePrompt"]);t!==void 0&&a!=null&&Z(t,["parameters","negativePrompt"],a);const o=w(e,["numberOfImages"]);t!==void 0&&o!=null&&Z(t,["parameters","sampleCount"],o);const l=w(e,["aspectRatio"]);t!==void 0&&l!=null&&Z(t,["parameters","aspectRatio"],l);const c=w(e,["guidanceScale"]);t!==void 0&&c!=null&&Z(t,["parameters","guidanceScale"],c);const d=w(e,["seed"]);t!==void 0&&d!=null&&Z(t,["parameters","seed"],d);const h=w(e,["safetyFilterLevel"]);t!==void 0&&h!=null&&Z(t,["parameters","safetySetting"],h);const m=w(e,["personGeneration"]);t!==void 0&&m!=null&&Z(t,["parameters","personGeneration"],m);const f=w(e,["includeSafetyAttributes"]);t!==void 0&&f!=null&&Z(t,["parameters","includeSafetyAttributes"],f);const p=w(e,["includeRaiReason"]);t!==void 0&&p!=null&&Z(t,["parameters","includeRaiReason"],p);const b=w(e,["language"]);t!==void 0&&b!=null&&Z(t,["parameters","language"],b);const x=w(e,["outputMimeType"]);t!==void 0&&x!=null&&Z(t,["parameters","outputOptions","mimeType"],x);const v=w(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&Z(t,["parameters","outputOptions","compressionQuality"],v);const S=w(e,["addWatermark"]);t!==void 0&&S!=null&&Z(t,["parameters","addWatermark"],S);const B=w(e,["enhancePrompt"]);return t!==void 0&&B!=null&&Z(t,["parameters","enhancePrompt"],B),s}function Z8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["prompt"]);i!=null&&Z(t,["instances[0]","prompt"],i);const a=w(e,["config"]);return a!=null&&Z(t,["config"],w8(n,a,t)),t}function aG(n,e){const t={},s=w(e,["gcsUri"]);s!=null&&Z(t,["gcsUri"],s);const i=w(e,["imageBytes"]);i!=null&&Z(t,["bytesBase64Encoded"],ld(n,i));const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function G8(n,e){const t={},s=w(e,["maskMode"]);s!=null&&Z(t,["maskMode"],s);const i=w(e,["segmentationClasses"]);i!=null&&Z(t,["maskClasses"],i);const a=w(e,["maskDilation"]);return a!=null&&Z(t,["dilation"],a),t}function B8(n,e){const t={},s=w(e,["controlType"]);s!=null&&Z(t,["controlType"],s);const i=w(e,["enableControlImageComputation"]);return i!=null&&Z(t,["computeControl"],i),t}function N8(n,e){const t={},s=w(e,["styleDescription"]);return s!=null&&Z(t,["styleDescription"],s),t}function k8(n,e){const t={},s=w(e,["subjectType"]);s!=null&&Z(t,["subjectType"],s);const i=w(e,["subjectDescription"]);return i!=null&&Z(t,["subjectDescription"],i),t}function R8(n,e){const t={},s=w(e,["referenceImage"]);s!=null&&Z(t,["referenceImage"],aG(n,s));const i=w(e,["referenceId"]);i!=null&&Z(t,["referenceId"],i);const a=w(e,["referenceType"]);a!=null&&Z(t,["referenceType"],a);const o=w(e,["maskImageConfig"]);o!=null&&Z(t,["maskImageConfig"],G8(n,o));const l=w(e,["controlImageConfig"]);l!=null&&Z(t,["controlImageConfig"],B8(n,l));const c=w(e,["styleImageConfig"]);c!=null&&Z(t,["styleImageConfig"],N8(n,c));const d=w(e,["subjectImageConfig"]);return d!=null&&Z(t,["subjectImageConfig"],k8(n,d)),t}function W8(n,e,t){const s={},i=w(e,["outputGcsUri"]);t!==void 0&&i!=null&&Z(t,["parameters","storageUri"],i);const a=w(e,["negativePrompt"]);t!==void 0&&a!=null&&Z(t,["parameters","negativePrompt"],a);const o=w(e,["numberOfImages"]);t!==void 0&&o!=null&&Z(t,["parameters","sampleCount"],o);const l=w(e,["aspectRatio"]);t!==void 0&&l!=null&&Z(t,["parameters","aspectRatio"],l);const c=w(e,["guidanceScale"]);t!==void 0&&c!=null&&Z(t,["parameters","guidanceScale"],c);const d=w(e,["seed"]);t!==void 0&&d!=null&&Z(t,["parameters","seed"],d);const h=w(e,["safetyFilterLevel"]);t!==void 0&&h!=null&&Z(t,["parameters","safetySetting"],h);const m=w(e,["personGeneration"]);t!==void 0&&m!=null&&Z(t,["parameters","personGeneration"],m);const f=w(e,["includeSafetyAttributes"]);t!==void 0&&f!=null&&Z(t,["parameters","includeSafetyAttributes"],f);const p=w(e,["includeRaiReason"]);t!==void 0&&p!=null&&Z(t,["parameters","includeRaiReason"],p);const b=w(e,["language"]);t!==void 0&&b!=null&&Z(t,["parameters","language"],b);const x=w(e,["outputMimeType"]);t!==void 0&&x!=null&&Z(t,["parameters","outputOptions","mimeType"],x);const v=w(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&Z(t,["parameters","outputOptions","compressionQuality"],v);const S=w(e,["editMode"]);t!==void 0&&S!=null&&Z(t,["parameters","editMode"],S);const B=w(e,["baseSteps"]);return t!==void 0&&B!=null&&Z(t,["parameters","editConfig","baseSteps"],B),s}function V8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["prompt"]);i!=null&&Z(t,["instances[0]","prompt"],i);const a=w(e,["referenceImages"]);if(a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>R8(n,c))),Z(t,["instances[0]","referenceImages"],l)}const o=w(e,["config"]);return o!=null&&Z(t,["config"],W8(n,o,t)),t}function _8(n,e,t){const s={},i=w(e,["includeRaiReason"]);t!==void 0&&i!=null&&Z(t,["parameters","includeRaiReason"],i);const a=w(e,["outputMimeType"]);t!==void 0&&a!=null&&Z(t,["parameters","outputOptions","mimeType"],a);const o=w(e,["outputCompressionQuality"]);t!==void 0&&o!=null&&Z(t,["parameters","outputOptions","compressionQuality"],o);const l=w(e,["numberOfImages"]);t!==void 0&&l!=null&&Z(t,["parameters","sampleCount"],l);const c=w(e,["mode"]);return t!==void 0&&c!=null&&Z(t,["parameters","mode"],c),s}function j8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["image"]);i!=null&&Z(t,["instances[0]","image"],aG(n,i));const a=w(e,["upscaleFactor"]);a!=null&&Z(t,["parameters","upscaleConfig","upscaleFactor"],a);const o=w(e,["config"]);return o!=null&&Z(t,["config"],_8(n,o,t)),t}function X8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","name"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function J8(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a);const o=w(e,["filter"]);t!==void 0&&o!=null&&Z(t,["_query","filter"],o);const l=w(e,["queryBase"]);return t!==void 0&&l!=null&&Z(t,["_url","models_url"],KM(n,l)),s}function Y8(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],J8(n,s,t)),t}function F8(n,e,t){const s={},i=w(e,["displayName"]);t!==void 0&&i!=null&&Z(t,["displayName"],i);const a=w(e,["description"]);t!==void 0&&a!=null&&Z(t,["description"],a);const o=w(e,["defaultCheckpointId"]);return t!==void 0&&o!=null&&Z(t,["defaultCheckpointId"],o),s}function M8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],F8(n,i,t)),t}function H8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","name"],zn(n,s));const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function T8(n,e,t){const s={},i=w(e,["systemInstruction"]);t!==void 0&&i!=null&&Z(t,["systemInstruction"],eh(n,ei(n,i)));const a=w(e,["tools"]);if(t!==void 0&&a!=null){let l=a;Array.isArray(l)&&(l=l.map(c=>nH(n,c))),Z(t,["tools"],l)}const o=w(e,["generationConfig"]);return t!==void 0&&o!=null&&Z(t,["generationConfig"],o),s}function E8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);if(i!=null){let o=Ta(n,i);Array.isArray(o)&&(o=o.map(l=>eh(n,l))),Z(t,["contents"],o)}const a=w(e,["config"]);return a!=null&&Z(t,["config"],T8(n,a,t)),t}function D8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["contents"]);if(i!=null){let o=Ta(n,i);Array.isArray(o)&&(o=o.map(l=>eh(n,l))),Z(t,["contents"],o)}const a=w(e,["config"]);return a!=null&&Z(t,["config"],a),t}function L8(n,e,t){const s={},i=w(e,["numberOfVideos"]);t!==void 0&&i!=null&&Z(t,["parameters","sampleCount"],i);const a=w(e,["outputGcsUri"]);t!==void 0&&a!=null&&Z(t,["parameters","storageUri"],a);const o=w(e,["fps"]);t!==void 0&&o!=null&&Z(t,["parameters","fps"],o);const l=w(e,["durationSeconds"]);t!==void 0&&l!=null&&Z(t,["parameters","durationSeconds"],l);const c=w(e,["seed"]);t!==void 0&&c!=null&&Z(t,["parameters","seed"],c);const d=w(e,["aspectRatio"]);t!==void 0&&d!=null&&Z(t,["parameters","aspectRatio"],d);const h=w(e,["resolution"]);t!==void 0&&h!=null&&Z(t,["parameters","resolution"],h);const m=w(e,["personGeneration"]);t!==void 0&&m!=null&&Z(t,["parameters","personGeneration"],m);const f=w(e,["pubsubTopic"]);t!==void 0&&f!=null&&Z(t,["parameters","pubsubTopic"],f);const p=w(e,["negativePrompt"]);t!==void 0&&p!=null&&Z(t,["parameters","negativePrompt"],p);const b=w(e,["enhancePrompt"]);return t!==void 0&&b!=null&&Z(t,["parameters","enhancePrompt"],b),s}function P8(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["_url","model"],zn(n,s));const i=w(e,["prompt"]);i!=null&&Z(t,["instances[0]","prompt"],i);const a=w(e,["image"]);a!=null&&Z(t,["instances[0]","image"],aG(n,a));const o=w(e,["config"]);return o!=null&&Z(t,["config"],L8(n,o,t)),t}function K8(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function O8(n,e){const t={},s=w(e,["data"]);s!=null&&Z(t,["data"],s);const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function z8(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],K8(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],O8(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function U8(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>z8(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function Q8(n,e){const t={},s=w(e,["citationSources"]);return s!=null&&Z(t,["citations"],s),t}function q8(n,e){const t={},s=w(e,["retrievedUrl"]);s!=null&&Z(t,["retrievedUrl"],s);const i=w(e,["urlRetrievalStatus"]);return i!=null&&Z(t,["urlRetrievalStatus"],i),t}function $8(n,e){const t={},s=w(e,["urlMetadata"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>q8(n,a))),Z(t,["urlMetadata"],i)}return t}function eq(n,e){const t={},s=w(e,["content"]);s!=null&&Z(t,["content"],U8(n,s));const i=w(e,["citationMetadata"]);i!=null&&Z(t,["citationMetadata"],Q8(n,i));const a=w(e,["tokenCount"]);a!=null&&Z(t,["tokenCount"],a);const o=w(e,["finishReason"]);o!=null&&Z(t,["finishReason"],o);const l=w(e,["urlContextMetadata"]);l!=null&&Z(t,["urlContextMetadata"],$8(n,l));const c=w(e,["avgLogprobs"]);c!=null&&Z(t,["avgLogprobs"],c);const d=w(e,["groundingMetadata"]);d!=null&&Z(t,["groundingMetadata"],d);const h=w(e,["index"]);h!=null&&Z(t,["index"],h);const m=w(e,["logprobsResult"]);m!=null&&Z(t,["logprobsResult"],m);const f=w(e,["safetyRatings"]);return f!=null&&Z(t,["safetyRatings"],f),t}function f2(n,e){const t={},s=w(e,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>eq(n,c))),Z(t,["candidates"],l)}const i=w(e,["modelVersion"]);i!=null&&Z(t,["modelVersion"],i);const a=w(e,["promptFeedback"]);a!=null&&Z(t,["promptFeedback"],a);const o=w(e,["usageMetadata"]);return o!=null&&Z(t,["usageMetadata"],o),t}function tq(n,e){const t={},s=w(e,["values"]);return s!=null&&Z(t,["values"],s),t}function nq(){return{}}function sq(n,e){const t={},s=w(e,["embeddings"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>tq(n,o))),Z(t,["embeddings"],a)}return w(e,["metadata"])!=null&&Z(t,["metadata"],nq()),t}function rq(n,e){const t={},s=w(e,["bytesBase64Encoded"]);s!=null&&Z(t,["imageBytes"],ld(n,s));const i=w(e,["mimeType"]);return i!=null&&Z(t,["mimeType"],i),t}function sH(n,e){const t={},s=w(e,["safetyAttributes","categories"]);s!=null&&Z(t,["categories"],s);const i=w(e,["safetyAttributes","scores"]);i!=null&&Z(t,["scores"],i);const a=w(e,["contentType"]);return a!=null&&Z(t,["contentType"],a),t}function iq(n,e){const t={},s=w(e,["_self"]);s!=null&&Z(t,["image"],rq(n,s));const i=w(e,["raiFilteredReason"]);i!=null&&Z(t,["raiFilteredReason"],i);const a=w(e,["_self"]);return a!=null&&Z(t,["safetyAttributes"],sH(n,a)),t}function aq(n,e){const t={},s=w(e,["predictions"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>iq(n,o))),Z(t,["generatedImages"],a)}const i=w(e,["positivePromptSafetyAttributes"]);return i!=null&&Z(t,["positivePromptSafetyAttributes"],sH(n,i)),t}function oq(n,e){const t={},s=w(e,["baseModel"]);s!=null&&Z(t,["baseModel"],s);const i=w(e,["createTime"]);i!=null&&Z(t,["createTime"],i);const a=w(e,["updateTime"]);return a!=null&&Z(t,["updateTime"],a),t}function eZ(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["description"]);a!=null&&Z(t,["description"],a);const o=w(e,["version"]);o!=null&&Z(t,["version"],o);const l=w(e,["_self"]);l!=null&&Z(t,["tunedModelInfo"],oq(n,l));const c=w(e,["inputTokenLimit"]);c!=null&&Z(t,["inputTokenLimit"],c);const d=w(e,["outputTokenLimit"]);d!=null&&Z(t,["outputTokenLimit"],d);const h=w(e,["supportedGenerationMethods"]);return h!=null&&Z(t,["supportedActions"],h),t}function lq(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["_self"]);if(i!=null){let a=OM(n,i);Array.isArray(a)&&(a=a.map(o=>eZ(n,o))),Z(t,["models"],a)}return t}function cq(){return{}}function dq(n,e){const t={},s=w(e,["totalTokens"]);s!=null&&Z(t,["totalTokens"],s);const i=w(e,["cachedContentTokenCount"]);return i!=null&&Z(t,["cachedContentTokenCount"],i),t}function gq(n,e){const t={},s=w(e,["video","uri"]);s!=null&&Z(t,["uri"],s);const i=w(e,["video","encodedVideo"]);i!=null&&Z(t,["videoBytes"],ld(n,i));const a=w(e,["encoding"]);return a!=null&&Z(t,["mimeType"],a),t}function uq(n,e){const t={},s=w(e,["_self"]);return s!=null&&Z(t,["video"],gq(n,s)),t}function hq(n,e){const t={},s=w(e,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>uq(n,l))),Z(t,["generatedVideos"],o)}const i=w(e,["raiMediaFilteredCount"]);i!=null&&Z(t,["raiMediaFilteredCount"],i);const a=w(e,["raiMediaFilteredReasons"]);return a!=null&&Z(t,["raiMediaFilteredReasons"],a),t}function mq(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["metadata"]);i!=null&&Z(t,["metadata"],i);const a=w(e,["done"]);a!=null&&Z(t,["done"],a);const o=w(e,["error"]);o!=null&&Z(t,["error"],o);const l=w(e,["response","generateVideoResponse"]);return l!=null&&Z(t,["response"],hq(n,l)),t}function Iq(n,e){const t={},s=w(e,["fps"]);s!=null&&Z(t,["fps"],s);const i=w(e,["endOffset"]);i!=null&&Z(t,["endOffset"],i);const a=w(e,["startOffset"]);return a!=null&&Z(t,["startOffset"],a),t}function Cq(n,e){const t={},s=w(e,["displayName"]);s!=null&&Z(t,["displayName"],s);const i=w(e,["data"]);i!=null&&Z(t,["data"],i);const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function fq(n,e){const t={},s=w(e,["videoMetadata"]);s!=null&&Z(t,["videoMetadata"],Iq(n,s));const i=w(e,["thought"]);i!=null&&Z(t,["thought"],i);const a=w(e,["inlineData"]);a!=null&&Z(t,["inlineData"],Cq(n,a));const o=w(e,["codeExecutionResult"]);o!=null&&Z(t,["codeExecutionResult"],o);const l=w(e,["executableCode"]);l!=null&&Z(t,["executableCode"],l);const c=w(e,["fileData"]);c!=null&&Z(t,["fileData"],c);const d=w(e,["functionCall"]);d!=null&&Z(t,["functionCall"],d);const h=w(e,["functionResponse"]);h!=null&&Z(t,["functionResponse"],h);const m=w(e,["text"]);return m!=null&&Z(t,["text"],m),t}function pq(n,e){const t={},s=w(e,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>fq(n,o))),Z(t,["parts"],a)}const i=w(e,["role"]);return i!=null&&Z(t,["role"],i),t}function Aq(n,e){const t={},s=w(e,["citations"]);return s!=null&&Z(t,["citations"],s),t}function bq(n,e){const t={},s=w(e,["content"]);s!=null&&Z(t,["content"],pq(n,s));const i=w(e,["citationMetadata"]);i!=null&&Z(t,["citationMetadata"],Aq(n,i));const a=w(e,["finishMessage"]);a!=null&&Z(t,["finishMessage"],a);const o=w(e,["finishReason"]);o!=null&&Z(t,["finishReason"],o);const l=w(e,["avgLogprobs"]);l!=null&&Z(t,["avgLogprobs"],l);const c=w(e,["groundingMetadata"]);c!=null&&Z(t,["groundingMetadata"],c);const d=w(e,["index"]);d!=null&&Z(t,["index"],d);const h=w(e,["logprobsResult"]);h!=null&&Z(t,["logprobsResult"],h);const m=w(e,["safetyRatings"]);return m!=null&&Z(t,["safetyRatings"],m),t}function p2(n,e){const t={},s=w(e,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(h=>bq(n,h))),Z(t,["candidates"],d)}const i=w(e,["createTime"]);i!=null&&Z(t,["createTime"],i);const a=w(e,["responseId"]);a!=null&&Z(t,["responseId"],a);const o=w(e,["modelVersion"]);o!=null&&Z(t,["modelVersion"],o);const l=w(e,["promptFeedback"]);l!=null&&Z(t,["promptFeedback"],l);const c=w(e,["usageMetadata"]);return c!=null&&Z(t,["usageMetadata"],c),t}function yq(n,e){const t={},s=w(e,["truncated"]);s!=null&&Z(t,["truncated"],s);const i=w(e,["token_count"]);return i!=null&&Z(t,["tokenCount"],i),t}function vq(n,e){const t={},s=w(e,["values"]);s!=null&&Z(t,["values"],s);const i=w(e,["statistics"]);return i!=null&&Z(t,["statistics"],yq(n,i)),t}function xq(n,e){const t={},s=w(e,["billableCharacterCount"]);return s!=null&&Z(t,["billableCharacterCount"],s),t}function Sq(n,e){const t={},s=w(e,["predictions[]","embeddings"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>vq(n,o))),Z(t,["embeddings"],a)}const i=w(e,["metadata"]);return i!=null&&Z(t,["metadata"],xq(n,i)),t}function wq(n,e){const t={},s=w(e,["gcsUri"]);s!=null&&Z(t,["gcsUri"],s);const i=w(e,["bytesBase64Encoded"]);i!=null&&Z(t,["imageBytes"],ld(n,i));const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function rH(n,e){const t={},s=w(e,["safetyAttributes","categories"]);s!=null&&Z(t,["categories"],s);const i=w(e,["safetyAttributes","scores"]);i!=null&&Z(t,["scores"],i);const a=w(e,["contentType"]);return a!=null&&Z(t,["contentType"],a),t}function oG(n,e){const t={},s=w(e,["_self"]);s!=null&&Z(t,["image"],wq(n,s));const i=w(e,["raiFilteredReason"]);i!=null&&Z(t,["raiFilteredReason"],i);const a=w(e,["_self"]);a!=null&&Z(t,["safetyAttributes"],rH(n,a));const o=w(e,["prompt"]);return o!=null&&Z(t,["enhancedPrompt"],o),t}function Zq(n,e){const t={},s=w(e,["predictions"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>oG(n,o))),Z(t,["generatedImages"],a)}const i=w(e,["positivePromptSafetyAttributes"]);return i!=null&&Z(t,["positivePromptSafetyAttributes"],rH(n,i)),t}function Gq(n,e){const t={},s=w(e,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>oG(n,a))),Z(t,["generatedImages"],i)}return t}function Bq(n,e){const t={},s=w(e,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>oG(n,a))),Z(t,["generatedImages"],i)}return t}function Nq(n,e){const t={},s=w(e,["endpoint"]);s!=null&&Z(t,["name"],s);const i=w(e,["deployedModelId"]);return i!=null&&Z(t,["deployedModelId"],i),t}function kq(n,e){const t={},s=w(e,["labels","google-vertex-llm-tuning-base-model-id"]);s!=null&&Z(t,["baseModel"],s);const i=w(e,["createTime"]);i!=null&&Z(t,["createTime"],i);const a=w(e,["updateTime"]);return a!=null&&Z(t,["updateTime"],a),t}function Rq(n,e){const t={},s=w(e,["checkpointId"]);s!=null&&Z(t,["checkpointId"],s);const i=w(e,["epoch"]);i!=null&&Z(t,["epoch"],i);const a=w(e,["step"]);return a!=null&&Z(t,["step"],a),t}function tZ(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["displayName"]);i!=null&&Z(t,["displayName"],i);const a=w(e,["description"]);a!=null&&Z(t,["description"],a);const o=w(e,["versionId"]);o!=null&&Z(t,["version"],o);const l=w(e,["deployedModels"]);if(l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>Nq(n,p))),Z(t,["endpoints"],f)}const c=w(e,["labels"]);c!=null&&Z(t,["labels"],c);const d=w(e,["_self"]);d!=null&&Z(t,["tunedModelInfo"],kq(n,d));const h=w(e,["defaultCheckpointId"]);h!=null&&Z(t,["defaultCheckpointId"],h);const m=w(e,["checkpoints"]);if(m!=null){let f=m;Array.isArray(f)&&(f=f.map(p=>Rq(n,p))),Z(t,["checkpoints"],f)}return t}function Wq(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["_self"]);if(i!=null){let a=OM(n,i);Array.isArray(a)&&(a=a.map(o=>tZ(n,o))),Z(t,["models"],a)}return t}function Vq(){return{}}function _q(n,e){const t={},s=w(e,["totalTokens"]);return s!=null&&Z(t,["totalTokens"],s),t}function jq(n,e){const t={},s=w(e,["tokensInfo"]);return s!=null&&Z(t,["tokensInfo"],s),t}function Xq(n,e){const t={},s=w(e,["gcsUri"]);s!=null&&Z(t,["uri"],s);const i=w(e,["bytesBase64Encoded"]);i!=null&&Z(t,["videoBytes"],ld(n,i));const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function Jq(n,e){const t={},s=w(e,["_self"]);return s!=null&&Z(t,["video"],Xq(n,s)),t}function Yq(n,e){const t={},s=w(e,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>Jq(n,l))),Z(t,["generatedVideos"],o)}const i=w(e,["raiMediaFilteredCount"]);i!=null&&Z(t,["raiMediaFilteredCount"],i);const a=w(e,["raiMediaFilteredReasons"]);return a!=null&&Z(t,["raiMediaFilteredReasons"],a),t}function Fq(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["metadata"]);i!=null&&Z(t,["metadata"],i);const a=w(e,["done"]);a!=null&&Z(t,["done"],a);const o=w(e,["error"]);o!=null&&Z(t,["error"],o);const l=w(e,["response"]);return l!=null&&Z(t,["response"],Yq(n,l)),t}const Mq="Content-Type",Hq="X-Server-Timeout",Tq="User-Agent",nZ="x-goog-api-client",Eq="0.15.0",Dq=`google-genai-sdk/${Eq}`,Lq="v1beta1",Pq="v1beta",A2=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class iH extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class sZ extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class Kq{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Lq,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:Pq,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const i=[this.getRequestUrlInternal(t)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[o,l]of Object.entries(e.queryParams))i.searchParams.append(o,String(l));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.unaryApiCall(i,a,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[i,a]of Object.entries(t))typeof a=="object"?s[i]=Object.assign(Object.assign({},s[i]),a):a!==void 0&&(s[i]=a);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.streamApiCall(i,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s){if(t&&t.timeout||s){const i=new AbortController,a=i.signal;t.timeout&&t?.timeout>0&&setTimeout(()=>i.abort(),t.timeout),s&&s.addEventListener("abort",()=>{i.abort()}),e.signal=a}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await b2(i),new Uw(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await b2(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return gm(this,arguments,function*(){const i=(t=e?.body)===null||t===void 0?void 0:t.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="";for(;;){const{done:l,value:c}=yield ts(i.read());if(l){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=a.decode(c);try{const m=JSON.parse(d);if("error"in m){const f=JSON.parse(JSON.stringify(m.error)),p=f.status,b=f.code,x=`got status: ${p}. ${JSON.stringify(m)}`;if(b>=400&&b<500)throw new iH(x);if(b>=500&&b<600)throw new sZ(x)}}catch(m){const f=m;if(f.name==="ClientError"||f.name==="ServerError")throw m}o+=d;let h=o.match(A2);for(;h;){const m=h[1];try{const f=new Response(m,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield ts(new Uw(f)),o=o.slice(h[0].length),h=o.match(A2)}catch(f){throw new Error(`exception parsing stream chunk ${m}. ${f}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=Dq+" "+this.clientOptions.userAgentExtra;return e[Tq]=t,e[nZ]=t,e[Mq]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[s,i]of Object.entries(e.headers))t.append(s,i);e.timeout&&e.timeout>0&&t.append(Hq,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var s;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,o=await a.stat(e);i.sizeBytes=String(o.size);const l=(s=t?.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;const c=await this.fetchUploadUrl(i,t);return a.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var s;let i={};t?.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const a={file:e},o=await this.request({path:Jt("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!o||!o?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const l=(s=o?.headers)===null||s===void 0?void 0:s["x-goog-upload-url"];if(l===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return l}}async function b2(n){var e;if(n===void 0)throw new sZ("response is undefined");if(!n.ok){const t=n.status,s=n.statusText;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const a=`got status: ${t} ${s}. ${JSON.stringify(i)}`;throw t>=400&&t<500?new iH(a):t>=500&&t<600?new sZ(a):new Error(a)}}const Oq="mcp_used/unknown";function rZ(n){for(const e of n)if(lG(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function iZ(n){var e;n[nZ]=(((e=n[nZ])!==null&&e!==void 0?e:"")+` ${Oq}`).trimStart()}function zq(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>lG(i)))!==null&&s!==void 0?s:!1}function Uq(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!lG(i)))!==null&&s!==void 0?s:!1}function lG(n){return n!==null&&typeof n=="object"&&"tool"in n&&"callTool"in n}async function Qq(n,e,t){const s=new lz,i=JSON.parse(t.data),a=fQ(n,i);Object.assign(s,a),e(s)}class qq{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),o=t7(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),c=`${i}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${l}`;let d=()=>{};const h=new Promise(V=>{d=V}),m=e.callbacks,f=function(){d({})},p=this.apiClient,b={onopen:f,onmessage:V=>{Qq(p,m.onmessage,V)},onerror:(t=m?.onerror)!==null&&t!==void 0?t:function(V){},onclose:(s=m?.onclose)!==null&&s!==void 0?s:function(V){}},x=this.webSocketFactory.create(c,e7(o),b);x.connect(),await h;const v=zn(this.apiClient,e.model),S=$M(this.apiClient,{model:v}),B=$w(this.apiClient,{setup:S});return x.send(JSON.stringify(B)),new $q(x,this.apiClient)}}class $q{constructor(e,t){this.conn=e,this.apiClient=t}async setClientContent(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=V4(this.apiClient,e),s=eH(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=_4(this.apiClient,e),s=$w(this.apiClient,t);this.conn.send(JSON.stringify(s))}sendPlaybackControl(e){const t=$w(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(fu.PLAY)}pause(){this.sendPlaybackControl(fu.PAUSE)}stop(){this.sendPlaybackControl(fu.STOP)}resetContext(){this.sendPlaybackControl(fu.RESET_CONTEXT)}close(){this.conn.close()}}function e7(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function t7(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}const n7="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function s7(n,e,t){const s=new oz;let i;if(t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),n.isVertexAI()){const a=lQ(n,i);Object.assign(s,a)}else{const a=oQ(n,i);Object.assign(s,a)}e(s)}class r7{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new qq(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,i,a,o,l;const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const m=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&rZ(e.config.tools)&&iZ(m);const f=l7(m);if(this.apiClient.isVertexAI())h=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(f);else{const M=this.apiClient.getApiKey();h=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.BidiGenerateContent?key=${M}`}let p=()=>{};const b=new Promise(M=>{p=M}),x=e.callbacks,v=function(){var M;(M=x?.onopen)===null||M===void 0||M.call(x),p({})},S=this.apiClient,B={onopen:v,onmessage:M=>{s7(S,x.onmessage,M)},onerror:(t=x?.onerror)!==null&&t!==void 0?t:function(M){},onclose:(s=x?.onclose)!==null&&s!==void 0?s:function(M){}},V=this.webSocketFactory.create(h,o7(f),B);V.connect(),await b;let R=zn(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&R.startsWith("publishers/")){const M=this.apiClient.getProject(),H=this.apiClient.getLocation();R=`projects/${M}/locations/${H}/`+R}let W={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[xm.AUDIO]}:e.config.responseModalities=[xm.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const _=(l=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[],Y=[];for(const M of _)if(this.isCallableTool(M)){const H=M;Y.push(await H.tool())}else Y.push(M);Y.length>0&&(e.config.tools=Y);const j={model:R,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?W=Z4(this.apiClient,j):W=w4(this.apiClient,j),delete W.config,V.send(JSON.stringify(W)),new a7(V,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const i7={turnComplete:!0};class a7{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=Ta(e,t.turns),e.isVertexAI()?s=s.map(i=>eh(e,i)):s=s.map(i=>yp(e,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const a of s){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(n7)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},i7),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:W4(this.apiClient,e)}:t={realtimeInput:R4(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function o7(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function l7(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}const y2=10;function v2(n){var e,t,s;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const o of(t=n?.tools)!==null&&t!==void 0?t:[])if(Sf(o)){i=!0;break}if(!i)return!0;const a=(s=n?.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function Sf(n){return"callTool"in n&&typeof n.callTool=="function"}function x2(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}class c7 extends Em{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,i,a,o,l;if(t.config&&t.config.tools&&rZ(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),iZ(t.config.httpOptions.headers)),!zq(t)||v2(t.config))return await this.generateContentInternal(t);if(Uq(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");const c=await this.transformCallableTools(t);let d,h;const m=Ta(this.apiClient,c.contents),f=(a=(i=(s=c.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&a!==void 0?a:y2;let p=0;for(;p<f&&(d=await this.generateContentInternal(c),!(!d.functionCalls||d.functionCalls.length===0));){const b=d.candidates[0].content,x=[];for(const v of(l=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[])if(Sf(v)){const B=await v.callTool(d.functionCalls);x.push(...B)}p++,h={role:"user",parts:x},c.contents=Ta(this.apiClient,c.contents),c.contents.push(b),c.contents.push(h),x2(c.config)&&(m.push(b),m.push(h))}return x2(c.config)&&(d.automaticFunctionCallingHistory=m),d},this.generateContentStream=async t=>{if(t.config&&t.config.tools&&rZ(t.config.tools)&&(t.config.httpOptions||(t.config.httpOptions={}),t.config.httpOptions.headers||(t.config.httpOptions.headers=this.apiClient.getDefaultHeaders()),iZ(t.config.httpOptions.headers)),v2(t.config)){const s=await this.transformCallableTools(t);return await this.generateContentStreamInternal(s)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var i;let a;const o=[];if(s?.generatedImages)for(const c of s.generatedImages)c&&c?.safetyAttributes&&((i=c?.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=c?.safetyAttributes:o.push(c);let l;return a?l={generatedImages:o,positivePromptSafetyAttributes:a}:l={generatedImages:o},l}),this.list=async t=>{var s;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((s=o.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new bp(Fu.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(o),o)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(i)}}async transformCallableTools(e){var t;const s=(t=e.config)===null||t===void 0?void 0:t.tools;if(!s)return e;const i=await Promise.all(s.map(async o=>Sf(o)?await o.tool():o)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};return a.config.tools=i,a}async initAfcToolsMap(e){var t,s,i;const a=new Map;for(const o of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(Sf(o)){const l=o,c=await l.tool();for(const d of(i=c.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(a.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);a.set(d.name,l)}}return a}async processAfcStream(e){var t,s,i;const a=(i=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:y2;let o=!1,l=0;const c=await this.initAfcToolsMap(e);return(function(d,h,m){var f,p;return gm(this,arguments,function*(){for(var b,x,v,S;l<a;){o&&(l++,o=!1);const W=yield ts(d.transformCallableTools(m)),_=yield ts(d.generateContentStreamInternal(W)),Y=[],j=[];try{for(var B=!0,V=(x=void 0,xf(_)),R;R=yield ts(V.next()),b=R.done,!b;B=!0){S=R.value,B=!1;const M=S;if(yield yield ts(M),M.candidates&&(!((f=M.candidates[0])===null||f===void 0)&&f.content)){j.push(M.candidates[0].content);for(const H of(p=M.candidates[0].content.parts)!==null&&p!==void 0?p:[])if(l<a&&H.functionCall){if(!H.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(H.functionCall.name)){const D=yield ts(h.get(H.functionCall.name).callTool([H.functionCall]));Y.push(...D)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${H.functionCall.name}`)}}}}catch(M){x={error:M}}finally{try{!B&&!b&&(v=V.return)&&(yield ts(v.call(V)))}finally{if(x)throw x.error}}if(Y.length>0){o=!0;const M=new Rh;M.candidates=[{content:{role:"user",parts:Y}}],yield yield ts(M);const H=[];H.push(...j),H.push({role:"user",parts:Y});const D=Ta(d.apiClient,m.contents).concat(H);m.contents=D}else break}})})(this,c,e)}async generateContentInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=C2(this.apiClient,e);return l=Jt("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=p2(this.apiClient,h),f=new Rh;return Object.assign(f,m),f})}else{const d=I2(this.apiClient,e);return l=Jt("{model}:generateContent",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=f2(this.apiClient,h),f=new Rh;return Object.assign(f,m),f})}}async generateContentStreamInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=C2(this.apiClient,e);l=Jt("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const h=this.apiClient;return o=h.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(m){return gm(this,arguments,function*(){var f,p,b,x;try{for(var v=!0,S=xf(m),B;B=yield ts(S.next()),f=B.done,!f;v=!0){x=B.value,v=!1;const R=p2(h,yield ts(x.json())),W=new Rh;Object.assign(W,R),yield yield ts(W)}}catch(V){p={error:V}}finally{try{!v&&!f&&(b=S.return)&&(yield ts(b.call(S)))}finally{if(p)throw p.error}}})})}else{const d=I2(this.apiClient,e);l=Jt("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const h=this.apiClient;return o=h.requestStream({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),o.then(function(m){return gm(this,arguments,function*(){var f,p,b,x;try{for(var v=!0,S=xf(m),B;B=yield ts(S.next()),f=B.done,!f;v=!0){x=B.value,v=!1;const R=f2(h,yield ts(x.json())),W=new Rh;Object.assign(W,R),yield yield ts(W)}}catch(V){p={error:V}}finally{try{!v&&!f&&(b=S.return)&&(yield ts(b.call(S)))}finally{if(p)throw p.error}}})})}}async embedContent(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=S8(this.apiClient,e);return l=Jt("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=Sq(this.apiClient,h),f=new zR;return Object.assign(f,m),f})}else{const d=MQ(this.apiClient,e);return l=Jt("{model}:batchEmbedContents",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=sq(this.apiClient,h),f=new zR;return Object.assign(f,m),f})}}async generateImagesInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=Z8(this.apiClient,e);return l=Jt("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=Zq(this.apiClient,h),f=new UR;return Object.assign(f,m),f})}else{const d=TQ(this.apiClient,e);return l=Jt("{model}:predict",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=aq(this.apiClient,h),f=new UR;return Object.assign(f,m),f})}}async editImageInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI()){const l=V8(this.apiClient,e);return a=Jt("{model}:predict",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=Gq(this.apiClient,c),h=new tz;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI()){const l=j8(this.apiClient,e);return a=Jt("{model}:predict",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=Bq(this.apiClient,c),h=new nz;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=X8(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>tZ(this.apiClient,h))}else{const d=EQ(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>eZ(this.apiClient,h))}}async listInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=Y8(this.apiClient,e);return l=Jt("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=Wq(this.apiClient,h),f=new QR;return Object.assign(f,m),f})}else{const d=LQ(this.apiClient,e);return l=Jt("{models_url}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=lq(this.apiClient,h),f=new QR;return Object.assign(f,m),f})}}async update(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=M8(this.apiClient,e);return l=Jt("{model}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>tZ(this.apiClient,h))}else{const d=KQ(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>eZ(this.apiClient,h))}}async delete(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=H8(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(()=>{const h=Vq(),m=new qR;return Object.assign(m,h),m})}else{const d=OQ(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(()=>{const h=cq(),m=new qR;return Object.assign(m,h),m})}}async countTokens(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=E8(this.apiClient,e);return l=Jt("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=_q(this.apiClient,h),f=new $R;return Object.assign(f,m),f})}else{const d=UQ(this.apiClient,e);return l=Jt("{model}:countTokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=dq(this.apiClient,h),f=new $R;return Object.assign(f,m),f})}}async computeTokens(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI()){const l=D8(this.apiClient,e);return a=Jt("{model}:computeTokens",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=jq(this.apiClient,c),h=new sz;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=P8(this.apiClient,e);return l=Jt("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>Fq(this.apiClient,h))}else{const d=$Q(this.apiClient,e);return l=Jt("{model}:predictLongRunning",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>mq(this.apiClient,h))}}}function d7(n,e){const t={},s=w(e,["operationName"]);s!=null&&Z(t,["_url","operationName"],s);const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function g7(n,e){const t={},s=w(e,["operationName"]);s!=null&&Z(t,["_url","operationName"],s);const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function u7(n,e){const t={},s=w(e,["operationName"]);s!=null&&Z(t,["operationName"],s);const i=w(e,["resourceName"]);i!=null&&Z(t,["_url","resourceName"],i);const a=w(e,["config"]);return a!=null&&Z(t,["config"],a),t}function h7(n,e){const t={},s=w(e,["video","uri"]);s!=null&&Z(t,["uri"],s);const i=w(e,["video","encodedVideo"]);i!=null&&Z(t,["videoBytes"],ld(n,i));const a=w(e,["encoding"]);return a!=null&&Z(t,["mimeType"],a),t}function m7(n,e){const t={},s=w(e,["_self"]);return s!=null&&Z(t,["video"],h7(n,s)),t}function I7(n,e){const t={},s=w(e,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>m7(n,l))),Z(t,["generatedVideos"],o)}const i=w(e,["raiMediaFilteredCount"]);i!=null&&Z(t,["raiMediaFilteredCount"],i);const a=w(e,["raiMediaFilteredReasons"]);return a!=null&&Z(t,["raiMediaFilteredReasons"],a),t}function C7(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["metadata"]);i!=null&&Z(t,["metadata"],i);const a=w(e,["done"]);a!=null&&Z(t,["done"],a);const o=w(e,["error"]);o!=null&&Z(t,["error"],o);const l=w(e,["response","generateVideoResponse"]);return l!=null&&Z(t,["response"],I7(n,l)),t}function f7(n,e){const t={},s=w(e,["gcsUri"]);s!=null&&Z(t,["uri"],s);const i=w(e,["bytesBase64Encoded"]);i!=null&&Z(t,["videoBytes"],ld(n,i));const a=w(e,["mimeType"]);return a!=null&&Z(t,["mimeType"],a),t}function p7(n,e){const t={},s=w(e,["_self"]);return s!=null&&Z(t,["video"],f7(n,s)),t}function A7(n,e){const t={},s=w(e,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>p7(n,l))),Z(t,["generatedVideos"],o)}const i=w(e,["raiMediaFilteredCount"]);i!=null&&Z(t,["raiMediaFilteredCount"],i);const a=w(e,["raiMediaFilteredReasons"]);return a!=null&&Z(t,["raiMediaFilteredReasons"],a),t}function S2(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["metadata"]);i!=null&&Z(t,["metadata"],i);const a=w(e,["done"]);a!=null&&Z(t,["done"],a);const o=w(e,["error"]);o!=null&&Z(t,["error"],o);const l=w(e,["response"]);return l!=null&&Z(t,["response"],A7(n,l)),t}class b7 extends Em{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let a;return s&&"httpOptions"in s&&(a=s.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:a}})}else return this.getVideosOperationInternal({operationName:t.name,config:s})}async getVideosOperationInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=g7(this.apiClient,e);return l=Jt("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>S2(this.apiClient,h))}else{const d=d7(this.apiClient,e);return l=Jt("{operationName}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>C7(this.apiClient,h))}}async fetchPredictVideosOperationInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI()){const l=u7(this.apiClient,e);return a=Jt("{resourceName}:fetchPredictOperation",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>S2(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}}function y7(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],s);const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function v7(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a);const o=w(e,["filter"]);return t!==void 0&&o!=null&&Z(t,["_query","filter"],o),s}function x7(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],v7(n,s,t)),t}function S7(n,e){const t={},s=w(e,["textInput"]);s!=null&&Z(t,["textInput"],s);const i=w(e,["output"]);return i!=null&&Z(t,["output"],i),t}function w7(n,e){const t={};if(w(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const s=w(e,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(a=>S7(n,a))),Z(t,["examples","examples"],i)}return t}function Z7(n,e,t){const s={};if(w(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=w(e,["tunedModelDisplayName"]);if(t!==void 0&&i!=null&&Z(t,["displayName"],i),w(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const a=w(e,["epochCount"]);t!==void 0&&a!=null&&Z(t,["tuningTask","hyperparameters","epochCount"],a);const o=w(e,["learningRateMultiplier"]);if(o!=null&&Z(s,["tuningTask","hyperparameters","learningRateMultiplier"],o),w(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(w(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=w(e,["batchSize"]);t!==void 0&&l!=null&&Z(t,["tuningTask","hyperparameters","batchSize"],l);const c=w(e,["learningRate"]);return t!==void 0&&c!=null&&Z(t,["tuningTask","hyperparameters","learningRate"],c),s}function G7(n,e){const t={},s=w(e,["baseModel"]);s!=null&&Z(t,["baseModel"],s);const i=w(e,["trainingDataset"]);i!=null&&Z(t,["tuningTask","trainingData"],w7(n,i));const a=w(e,["config"]);return a!=null&&Z(t,["config"],Z7(n,a,t)),t}function B7(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["_url","name"],s);const i=w(e,["config"]);return i!=null&&Z(t,["config"],i),t}function N7(n,e,t){const s={},i=w(e,["pageSize"]);t!==void 0&&i!=null&&Z(t,["_query","pageSize"],i);const a=w(e,["pageToken"]);t!==void 0&&a!=null&&Z(t,["_query","pageToken"],a);const o=w(e,["filter"]);return t!==void 0&&o!=null&&Z(t,["_query","filter"],o),s}function k7(n,e){const t={},s=w(e,["config"]);return s!=null&&Z(t,["config"],N7(n,s,t)),t}function R7(n,e,t){const s={},i=w(e,["gcsUri"]);if(t!==void 0&&i!=null&&Z(t,["supervisedTuningSpec","trainingDatasetUri"],i),w(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function W7(n,e){const t={},s=w(e,["gcsUri"]);return s!=null&&Z(t,["validationDatasetUri"],s),t}function V7(n,e,t){const s={},i=w(e,["validationDataset"]);t!==void 0&&i!=null&&Z(t,["supervisedTuningSpec"],W7(n,i));const a=w(e,["tunedModelDisplayName"]);t!==void 0&&a!=null&&Z(t,["tunedModelDisplayName"],a);const o=w(e,["description"]);t!==void 0&&o!=null&&Z(t,["description"],o);const l=w(e,["epochCount"]);t!==void 0&&l!=null&&Z(t,["supervisedTuningSpec","hyperParameters","epochCount"],l);const c=w(e,["learningRateMultiplier"]);t!==void 0&&c!=null&&Z(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c);const d=w(e,["exportLastCheckpointOnly"]);t!==void 0&&d!=null&&Z(t,["supervisedTuningSpec","exportLastCheckpointOnly"],d);const h=w(e,["adapterSize"]);if(t!==void 0&&h!=null&&Z(t,["supervisedTuningSpec","hyperParameters","adapterSize"],h),w(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(w(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return s}function _7(n,e){const t={},s=w(e,["baseModel"]);s!=null&&Z(t,["baseModel"],s);const i=w(e,["trainingDataset"]);i!=null&&Z(t,["supervisedTuningSpec","trainingDatasetUri"],R7(n,i,t));const a=w(e,["config"]);return a!=null&&Z(t,["config"],V7(n,a,t)),t}function j7(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["model"],s);const i=w(e,["name"]);return i!=null&&Z(t,["endpoint"],i),t}function aH(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["state"]);i!=null&&Z(t,["state"],LM(n,i));const a=w(e,["createTime"]);a!=null&&Z(t,["createTime"],a);const o=w(e,["tuningTask","startTime"]);o!=null&&Z(t,["startTime"],o);const l=w(e,["tuningTask","completeTime"]);l!=null&&Z(t,["endTime"],l);const c=w(e,["updateTime"]);c!=null&&Z(t,["updateTime"],c);const d=w(e,["description"]);d!=null&&Z(t,["description"],d);const h=w(e,["baseModel"]);h!=null&&Z(t,["baseModel"],h);const m=w(e,["_self"]);m!=null&&Z(t,["tunedModel"],j7(n,m));const f=w(e,["distillationSpec"]);f!=null&&Z(t,["distillationSpec"],f);const p=w(e,["experiment"]);p!=null&&Z(t,["experiment"],p);const b=w(e,["labels"]);b!=null&&Z(t,["labels"],b);const x=w(e,["pipelineJob"]);x!=null&&Z(t,["pipelineJob"],x);const v=w(e,["tunedModelDisplayName"]);return v!=null&&Z(t,["tunedModelDisplayName"],v),t}function X7(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["tunedModels"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(o=>aH(n,o))),Z(t,["tuningJobs"],a)}return t}function J7(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["metadata"]);i!=null&&Z(t,["metadata"],i);const a=w(e,["done"]);a!=null&&Z(t,["done"],a);const o=w(e,["error"]);return o!=null&&Z(t,["error"],o),t}function Y7(n,e){const t={},s=w(e,["checkpointId"]);s!=null&&Z(t,["checkpointId"],s);const i=w(e,["epoch"]);i!=null&&Z(t,["epoch"],i);const a=w(e,["step"]);a!=null&&Z(t,["step"],a);const o=w(e,["endpoint"]);return o!=null&&Z(t,["endpoint"],o),t}function F7(n,e){const t={},s=w(e,["model"]);s!=null&&Z(t,["model"],s);const i=w(e,["endpoint"]);i!=null&&Z(t,["endpoint"],i);const a=w(e,["checkpoints"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>Y7(n,l))),Z(t,["checkpoints"],o)}return t}function aZ(n,e){const t={},s=w(e,["name"]);s!=null&&Z(t,["name"],s);const i=w(e,["state"]);i!=null&&Z(t,["state"],LM(n,i));const a=w(e,["createTime"]);a!=null&&Z(t,["createTime"],a);const o=w(e,["startTime"]);o!=null&&Z(t,["startTime"],o);const l=w(e,["endTime"]);l!=null&&Z(t,["endTime"],l);const c=w(e,["updateTime"]);c!=null&&Z(t,["updateTime"],c);const d=w(e,["error"]);d!=null&&Z(t,["error"],d);const h=w(e,["description"]);h!=null&&Z(t,["description"],h);const m=w(e,["baseModel"]);m!=null&&Z(t,["baseModel"],m);const f=w(e,["tunedModel"]);f!=null&&Z(t,["tunedModel"],F7(n,f));const p=w(e,["supervisedTuningSpec"]);p!=null&&Z(t,["supervisedTuningSpec"],p);const b=w(e,["tuningDataStats"]);b!=null&&Z(t,["tuningDataStats"],b);const x=w(e,["encryptionSpec"]);x!=null&&Z(t,["encryptionSpec"],x);const v=w(e,["partnerModelTuningSpec"]);v!=null&&Z(t,["partnerModelTuningSpec"],v);const S=w(e,["distillationSpec"]);S!=null&&Z(t,["distillationSpec"],S);const B=w(e,["experiment"]);B!=null&&Z(t,["experiment"],B);const V=w(e,["labels"]);V!=null&&Z(t,["labels"],V);const R=w(e,["pipelineJob"]);R!=null&&Z(t,["pipelineJob"],R);const W=w(e,["tunedModelDisplayName"]);return W!=null&&Z(t,["tunedModelDisplayName"],W),t}function M7(n,e){const t={},s=w(e,["nextPageToken"]);s!=null&&Z(t,["nextPageToken"],s);const i=w(e,["tuningJobs"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(o=>aZ(n,o))),Z(t,["tuningJobs"],a)}return t}class H7 extends Em{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new bp(Fu.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const s=await this.tuneMldevInternal(t);let i="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?i=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(i=s.name.split("/operations/")[0]),{name:i,state:zw.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=B7(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>aZ(this.apiClient,h))}else{const d=y7(this.apiClient,e);return l=Jt("{name}",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>aH(this.apiClient,h))}}async listInternal(e){var t,s,i,a;let o,l="",c={};if(this.apiClient.isVertexAI()){const d=k7(this.apiClient,e);return l=Jt("tuningJobs",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),o.then(h=>{const m=M7(this.apiClient,h),f=new e2;return Object.assign(f,m),f})}else{const d=x7(this.apiClient,e);return l=Jt("tunedModels",d._url),c=d._query,delete d.config,delete d._url,delete d._query,o=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(h=>h.json()),o.then(h=>{const m=X7(this.apiClient,h),f=new e2;return Object.assign(f,m),f})}}async tuneInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI()){const l=_7(this.apiClient,e);return a=Jt("tuningJobs",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>aZ(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let i,a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=G7(this.apiClient,e);return a=Jt("tunedModels",l._url),o=l._query,delete l.config,delete l._url,delete l._query,i=this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>J7(this.apiClient,c))}}}class T7{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const E7=1024*1024*8,D7=3,L7=1e3,P7=2,Fb="x-goog-upload-status";async function K7(n,e,t){var s,i,a;let o=0,l=0,c=new Uw(new Response),d="upload";for(o=n.size;l<o;){const m=Math.min(E7,o-l),f=n.slice(l,l+m);l+m>=o&&(d+=", finalize");let p=0,b=L7;for(;p<D7&&(c=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(m)}}}),!(!((s=c?.headers)===null||s===void 0)&&s[Fb]));)p++,await z7(b),b=b*P7;if(l+=m,((i=c?.headers)===null||i===void 0?void 0:i[Fb])!=="active")break;if(o<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await c?.json();if(((a=c?.headers)===null||a===void 0?void 0:a[Fb])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function O7(n){return{size:n.size,type:n.type}}function z7(n){return new Promise(e=>setTimeout(e,n))}class U7{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await K7(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await O7(e)}}class Q7{create(e,t,s){return new q7(e,t,s)}}class q7{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}const w2="x-goog-api-key";class $7{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(w2)===null&&e.append(w2,this.apiKey)}}const e6="gl-node/";class t6{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=ez(e,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const i=new $7(this.apiKey);this.apiClient=new Kq({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:e6+"web",uploader:new U7,downloader:new T7}),this.models=new c7(this.apiClient),this.live=new r7(this.apiClient,i,new Q7),this.chats=new AU(this.models,this.apiClient),this.caches=new CU(this.apiClient),this.files=new WU(this.apiClient),this.operations=new b7(this.apiClient),this.tunings=new H7(this.apiClient)}}const Sm="onboarding-documents",oZ="avatars",Z2="support-attachments",Wh="logo",Vh="background",n6="task-attachments",s6="your-google-genai-api-key";let vl=null;vl=new t6({apiKey:s6});const lZ=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(lZ);const e={...n};if(typeof e.name=="string"&&typeof e.path=="string"){const t=e.path.startsWith("avatars/")?oZ:Sm,{data:{publicUrl:s}}=ve.storage.from(t).getPublicUrl(e.path);e.preview=s,e.url=s}for(const t in e)e[t]=lZ(e[t]);return e},cZ=async(n,e,t)=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return Promise.all(n.map(i=>cZ(i,e,t)));const s={...n};if(s.file instanceof File){const i=s.file,a=`${e}/documents/${Date.now()}_${i.name}`,{error:o}=await ve.storage.from(Sm).upload(a,i);if(o)throw o;try{await ve.from("user_documents").insert({user_id:e,submission_id:t||null,name:s.name||i.name,bucket:Sm,path:a,file_type:i.type,file_size:i.size})}catch(l){console.error("Failed to record uploaded document:",l)}return{name:s.name||i.name,type:i.type,size:i.size,path:a}}if(typeof s.name=="string"&&s.path)return{name:s.name,type:s.type,size:s.size,path:s.path};for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&(s[i]=await cZ(s[i],e,t));return s},G2=async n=>await(await fetch(n)).blob(),nn=n=>{if(Array.isArray(n))return n.map(e=>nn(e));if(n!==null&&typeof n=="object"&&!(n instanceof Date)&&!(n instanceof File)){const e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=t.replace(/[A-Z]/g,i=>`_${i.toLowerCase()}`);e[s]=nn(n[t])}return e}return n},ct=n=>{if(Array.isArray(n))return n.map(e=>ct(e));if(n!==null&&typeof n=="object"&&!(n instanceof Date)){const e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=t.replace(/_([a-z])/g,i=>i[1].toUpperCase());e[s]=ct(n[t])}return lZ(e)}return n},ce={getInitialAppData:async()=>{const{data:n,error:e}=await ve.from("settings").select("*").eq("id","singleton").single();if(e)throw new Error("Failed to fetch core application settings.");const{data:t,error:s}=await ve.from("roles").select("*");if(s)throw new Error("Failed to fetch user roles.");const{data:i,error:a}=await ve.from("holidays").select("*");if(a)throw new Error("Failed to fetch holidays.");return{settings:ct(n),roles:(t||[]).map(ct),holidays:(i||[]).map(ct)}},updateSettings:async n=>{const{error:e}=await ve.from("settings").update(nn(n)).eq("id","singleton");if(e)throw e},getVerificationSubmissions:async(n,e)=>{let t=ve.from("onboarding_submissions").select("*");n&&(t=t.eq("status",n)),e&&(t=t.eq("organization_id",e));const{data:s,error:i}=await t.order("created_at",{ascending:!1});if(i)throw i;return(s||[]).map(ct)},getOnboardingDataById:async n=>{const{data:e,error:t}=await ve.from("onboarding_submissions").select("*").eq("id",n).single();if(t&&t.code!=="PGRST116")throw t;return e?ct(e):null},_saveSubmission:async(n,e)=>{const{data:{session:t}}=await ve.auth.getSession();if(!t?.user)throw new Error("User not authenticated");const s=n.id&&!n.id.startsWith("draft_")?n.id:crypto.randomUUID(),i=await cZ(n,t.user.id,s),a={...nn(i),id:s,user_id:t.user.id,status:e?"draft":n.status};delete a.file,delete a.confirm_account_number;const{data:o,error:l}=await ve.from("onboarding_submissions").upsert(a,{onConflict:"id"}).select("id").single();if(l)throw l;return{draftId:o.id}},saveDraft:async n=>ce._saveSubmission(n,!0),submitOnboarding:async n=>{const{draftId:e}=await ce._saveSubmission(n,!1),t=await ce.getOnboardingDataById(e);if(!t)throw new Error("Failed to retrieve submitted data.");return t},updateOnboarding:async n=>{const{draftId:e}=await ce._saveSubmission(n,n.status==="draft"),t=await ce.getOnboardingDataById(e);if(!t)throw new Error("Failed to retrieve updated data.");return t},verifySubmission:async n=>{const{error:e}=await ve.from("onboarding_submissions").update({status:"verified",portal_sync_status:"pending_sync"}).eq("id",n);if(e)throw e},requestChanges:async(n,e)=>{const{error:t}=await ve.from("onboarding_submissions").update({status:"rejected"}).eq("id",n);if(t)throw t},syncPortals:async n=>{const{data:e,error:t}=await ve.functions.invoke("sync-portals",{body:{submissionId:n}});if(t)throw t;return ct(e)},deleteFile:async n=>{const{error:e}=await ve.storage.from(Sm).remove([n]);if(e)throw e},uploadDocument:async(n,e=Sm,t,s)=>{const{data:{session:i}}=await ve.auth.getSession(),a=i?.user?.id||"anonymous_user",o=`${a}/documents/${Date.now()}_${n.name}`,{error:l}=await ve.storage.from(e).upload(o,n);if(l)throw l;const{data:c}=ve.storage.from(e).getPublicUrl(o);if(!c.publicUrl)throw new Error("Could not get public URL for uploaded file.");try{await ve.from("user_documents").insert({user_id:a,submission_id:t||null,name:s||n.name,bucket:e,path:o,file_type:n.type,file_size:n.size})}catch(d){console.error("Failed to insert user_documents record:",d)}return{url:c.publicUrl,path:o}},getUsers:async()=>{const{data:n,error:e}=await ve.from("users").select("*, role_id");if(e)throw e;return(n||[]).map(t=>ct({...t,role:t.role_id}))},getUsersWithManagers:async()=>{const{data:n,error:e}=await ve.from("users").select("*, reporting_manager_id, role_id");if(e)throw e;const t=(n||[]).map(i=>ct({...i,role:i.role_id})),s=new Map(t.map(i=>[i.id,i.name]));return t.map(i=>({...i,managerName:i.reportingManagerId?s.get(i.reportingManagerId):void 0}))},getFieldOfficers:async()=>ce.getUsers().then(n=>n.filter(e=>e.role==="field_officer")),getNearbyUsers:async()=>{const n=await ce.getUsers();let e={};try{const t=new Date;t.setHours(0,0,0,0);const s=new Date,i=await ce.getAllAttendanceEvents(t.toISOString(),s.toISOString()),a={};i.forEach(o=>{const{userId:l,type:c,timestamp:d}=o;l&&(!a[l]||new Date(d)>new Date(a[l].timestamp))&&(a[l]={type:c.toLowerCase(),timestamp:d})}),e=Object.fromEntries(Object.entries(a).map(([o,l])=>{const c=l.type.toLowerCase().replace(/[-_\s]/g,""),d=c==="checkin";return console.log(`User ${o}: latest event type = "${l.type}", normalized = "${c}", isCheckIn = ${d}`),[o,d]}))}catch(t){console.warn("Failed to compute user availability:",t)}return n.map(t=>({...t,isAvailable:e[t.id]??!1}))},updateUser:async(n,e)=>{const{role:t,...s}=e,i=nn(s);if(t&&(i.role_id=t),"photo_url"in i){const{data:{session:l}}=await ve.auth.getSession();if(!l?.user)throw new Error("User not authenticated for photo upload");const c=l.user.id,{data:d}=await ve.from("users").select("photo_url").eq("id",n).single(),h=d?.photo_url,m=async f=>{if(f)try{const b=new URL(f).pathname.split("/public/")[1];if(b){const[x,...v]=b.split("/"),S=v.join("/");S&&await ve.storage.from(x).remove([S])}}catch(p){console.error("Failed to process old avatar URL for deletion:",p)}};if(i.photo_url&&i.photo_url.startsWith("data:")){await m(h);const f=await G2(i.photo_url),p=i.photo_url.split(";")[0].split("/")[1]||"jpg",b=`${c}/${Date.now()}.${p}`,{error:x}=await ve.storage.from(oZ).upload(b,f,{upsert:!0});if(x)throw x;const{data:{publicUrl:v}}=ve.storage.from(oZ).getPublicUrl(b);i.photo_url=v}else i.photo_url===null&&await m(h)}const{data:a,error:o}=await ve.from("users").update(i).eq("id",n).select().single();if(o)throw o;return ct({...a,role:a.role_id})},createUser:async n=>{const{role:e,...t}=n,s=nn(t);e&&(s.role_id=e);const{data:i,error:a}=await ve.from("users").insert(s).select().single();if(a)throw a;return ct({...i,role:i.role_id})},deleteUser:async n=>{const{error:e}=await ve.from("users").delete().eq("id",n);if(e)throw e},updateUserReportingManager:async(n,e)=>{const{error:t}=await ve.from("users").update({reporting_manager_id:e}).eq("id",n);if(t)throw t},getOrganizations:async()=>{const{data:n,error:e}=await ve.from("organizations").select("*").order("short_name");if(e)throw e;return(n||[]).map(ct)},createOrganization:async n=>{const{data:e,error:t}=await ve.from("organizations").insert(nn(n)).select().single();if(t)throw t;return ct(e)},getOrganizationStructure:async()=>{const{data:n,error:e}=await ve.from("organization_groups").select("*");if(e)throw e;const{data:t,error:s}=await ve.from("companies").select("*");if(s)throw s;const{data:i,error:a}=await ve.from("entities").select("*");if(a)throw a;const o=(n||[]).map(ct),l=(t||[]).map(ct),c=(i||[]).map(ct),d=new Map;return l.forEach(h=>{const m={...h,entities:c.filter(f=>f.companyId===h.id)};d.has(h.groupId)||d.set(h.groupId,[]),d.get(h.groupId).push(m)}),o.map(h=>({...h,companies:d.get(h.id)||[],locations:[]}))},getSiteConfigurations:async()=>{const{data:n,error:e}=await ve.from("site_configurations").select("*");if(e)throw e;return(n||[]).map(ct)},bulkUploadOrganizations:async n=>{const{count:e,error:t}=await ve.from("organizations").upsert(nn(n),{onConflict:"id"});if(t)throw t;return{count:e||0}},getModules:async()=>{const{data:n,error:e}=await ve.from("app_modules").select("*");if(e)throw e;return(n||[]).map(ct)},saveModules:async n=>{const e=n.map(s=>({...s,created_at:s.created_at||new Date().toISOString(),updated_at:new Date().toISOString()})),{error:t}=await ve.from("app_modules").upsert(nn(e));if(t)throw t},getRoles:async()=>{const{data:n,error:e}=await ve.from("roles").select("*");if(e)throw e;return(n||[]).map(ct)},saveRoles:async n=>{const{error:e}=await ve.from("roles").upsert(nn(n));if(e)throw e},getHolidays:async()=>{const{data:n,error:e}=await ve.from("holidays").select("*");if(e)throw e;return(n||[]).map(ct)},addHoliday:async n=>{const{data:e,error:t}=await ve.from("holidays").insert(nn(n)).select().single();if(t)throw t;return ct(e)},removeHoliday:async n=>{const{error:e}=await ve.from("holidays").delete().eq("id",n);if(e)throw e},getAttendanceEvents:async(n,e,t)=>{const{data:s,error:i}=await ve.from("attendance_events").select("*").eq("user_id",n).gte("timestamp",e).lte("timestamp",t);if(i)throw i;return(s||[]).map(ct)},getAllAttendanceEvents:async(n,e)=>{const{data:t,error:s}=await ve.from("attendance_events").select("*").gte("timestamp",n).lte("timestamp",e);if(s)throw s;return(t||[]).map(ct)},getAttendanceDashboardData:async(n,e,t,s="UTC")=>{const{data:i,error:a}=await ve.rpc("get_attendance_dashboard_data",{start_date_iso:He(n,"yyyy-MM-dd"),end_date_iso:He(e,"yyyy-MM-dd"),current_date_iso:He(t,"yyyy-MM-dd"),p_timezone:s});if(a)throw new Error("Could not load attendance dashboard data from the database function.");return i},addAttendanceEvent:async n=>{const{error:e}=await ve.from("attendance_events").insert(nn(n));if(e)throw e},getLocations:async()=>{const{data:n,error:e}=await ve.from("locations").select("*, created_by_user:created_by (id, name)");if(e)throw e;return(n||[]).map(t=>{const s=ct(t),a=s.createdByUser?.name||void 0,{createdByUser:o,...l}=s;return{...l,createdByName:a}})},getUserLocations:async n=>{const{data:e,error:t}=await ve.from("user_locations").select("location_id:location_id (*), id").eq("user_id",n);if(t)throw t;return(e||[]).map(s=>{const i=s.location_id||{};return ct(i)})},createLocation:async n=>{const e=nn(n),{data:t,error:s}=await ve.from("locations").insert(e).select("*").single();if(s)throw s;return ct(t)},assignLocationToUser:async(n,e)=>{const{error:t}=await ve.from("user_locations").insert({user_id:n,location_id:e});if(t)throw t},updateLocation:async(n,e)=>{const t=nn(e),{data:s,error:i}=await ve.from("locations").update(t).eq("id",n).select("*").single();if(i)throw i;return ct(s)},deleteLocation:async n=>{const{error:e}=await ve.from("locations").delete().eq("id",n);if(e)throw e},unassignLocationFromUser:async(n,e)=>{const{error:t}=await ve.from("user_locations").delete().match({user_id:n,location_id:e});if(t)throw t},uploadLogo:async n=>{n.name.split(".").pop();const t=`${`${Date.now()}_${n.name}`}`,{error:s}=await ve.storage.from(Wh).upload(t,n,{upsert:!0});if(s)throw s;const{data:{publicUrl:i}}=ve.storage.from(Wh).getPublicUrl(t);return i},getLogos:async()=>{const{data:n,error:e}=await ve.storage.from(Wh).list("",{limit:100,sortBy:{column:"name",order:"asc"}});if(e)throw e;return(n||[]).map(t=>{const{data:{publicUrl:s}}=ve.storage.from(Wh).getPublicUrl(t.name);return{name:t.name,url:s}})},deleteLogo:async n=>{const{error:e}=await ve.storage.from(Wh).remove([n]);if(e)throw e},uploadBackground:async n=>{n.name.split(".").pop();const t=`${`${Date.now()}_${n.name}`}`,{error:s}=await ve.storage.from(Vh).upload(t,n,{upsert:!0});if(s)throw s;const{data:{publicUrl:i}}=ve.storage.from(Vh).getPublicUrl(t);return i},getBackgroundImages:async()=>{const{data:n,error:e}=await ve.storage.from(Vh).list("",{limit:100,sortBy:{column:"name",order:"asc"}});if(e)throw e;return(n||[]).map(t=>{const{data:{publicUrl:s}}=ve.storage.from(Vh).getPublicUrl(t.name);return{name:t.name,url:s}})},deleteBackground:async n=>{const{error:e}=await ve.storage.from(Vh).remove([n]);if(e)throw e},getAttendanceSettings:async()=>{const{data:n,error:e}=await ve.from("settings").select("attendance_settings").eq("id","singleton").single();if(e)throw e;if(!n?.attendance_settings)throw new Error("Attendance settings are not configured.");return ct(n.attendance_settings)},saveAttendanceSettings:async n=>{const{error:e}=await ve.from("settings").upsert({id:"singleton",attendance_settings:nn(n),updated_at:new Date().toISOString()},{onConflict:"id"});if(e)throw console.error("Error saving attendance settings:",e),e},getRecurringHolidays:async()=>{const{data:n,error:e}=await ve.from("recurring_holidays").select("*");if(e)throw e;return(n||[]).map(t=>({id:t.id,type:t.role_type,day:t.day,n:t.occurrence}))},addRecurringHoliday:async n=>{const e={role_type:n.type||"office",day:n.day,occurrence:n.n},{data:t,error:s}=await ve.from("recurring_holidays").insert(e).select().single();if(s)throw s;return{id:t.id,type:t.role_type,day:t.day,n:t.occurrence}},deleteRecurringHoliday:async n=>{const{error:e}=await ve.from("recurring_holidays").delete().eq("id",n);if(e)throw e},createAssignment:async(n,e,t)=>{const s=(await ce.getOrganizations()).find(i=>i.id===e);await ce.createTask({name:`Visit ${s?.shortName||"site"} for verification`,description:`Perform on-site duties and verification tasks for ${s?.shortName}.`,dueDate:t,priority:"Medium",assignedToId:n})},getLeaveBalancesForUser:async n=>{const e=x=>["hr","admin","finance"].includes(x)?"office":"field",{data:t,error:s}=await ve.from("settings").select("attendance_settings").eq("id","singleton").single();if(s||!t?.attendance_settings)throw new Error("Could not load attendance rules.");const{data:i,error:a}=await ve.from("users").select("role_id").eq("id",n).single();if(a)throw a;const o=e(i.role_id),l=ct(t.attendance_settings)[o],[{data:c,error:d},{data:h,error:m},{data:f,error:p}]=await Promise.all([ve.from("leave_requests").select("leave_type, start_date, end_date, day_option").eq("user_id",n).eq("status","approved"),ve.from("comp_off_logs").select("*").eq("user_id",n),ve.from("extra_work_logs").select("hours_worked").eq("user_id",n).eq("claim_type","OT").eq("status","Approved").gte("work_date",He(Si(new Date),"yyyy-MM-dd")).lte("work_date",He(Ha(new Date),"yyyy-MM-dd"))]);if(d||m||p)throw new Error("Failed to fetch all leave balance data.");const b={userId:n,earnedTotal:l.annualEarnedLeaves||0,earnedUsed:0,sickTotal:l.annualSickLeaves||0,sickUsed:0,floatingTotal:(l.monthlyFloatingLeaves||0)*12,floatingUsed:0,compOffTotal:(h||[]).length,compOffUsed:(h||[]).filter(x=>x.status==="used").length,otHoursThisMonth:(f||[]).reduce((x,v)=>x+(v.hours_worked||0),0)};return(c||[]).forEach(x=>{const v=x.day_option==="half"?.5:Tm(new Date(x.end_date),new Date(x.start_date))+1;x.leave_type==="Earned"&&(b.earnedUsed+=v),x.leave_type==="Sick"&&(b.sickUsed+=v),x.leave_type==="Floating"&&(b.floatingUsed+=v)}),b},submitLeaveRequest:async n=>{const{data:e,error:t}=await ve.from("users").select("reporting_manager_id").eq("id",n.userId).single();if(t)throw t;const{data:s,error:i}=await ve.from("leave_requests").insert({...nn(n),status:"pending_manager_approval",current_approver_id:e.reporting_manager_id||null,approval_history:[]}).select("*").single();if(i)throw i;return ct(s)},getLeaveRequests:async n=>{let e=ve.from("leave_requests").select("*");n?.userId&&(e=e.eq("user_id",n.userId)),n?.userIds&&(e=e.in("user_id",n.userIds)),n?.status&&(e=e.eq("status",n.status)),n?.forApproverId&&(e=e.eq("current_approver_id",n.forApproverId)),n?.startDate&&n?.endDate&&(e=e.lte("start_date",n.endDate).gte("end_date",n.startDate));const{data:t,error:s}=await e.order("start_date",{ascending:!1});if(s)throw s;return(t||[]).map(ct)},getTasks:async()=>{const{data:n,error:e}=await ve.from("tasks").select("*").order("created_at",{ascending:!1});if(e)throw e;return(n||[]).map(ct)},createTask:async n=>{const{data:e,error:t}=await ve.from("tasks").insert(nn({...n,status:"To Do",escalationStatus:"None"})).select().single();if(t)throw t;return ct(e)},updateTask:async(n,e)=>{if(e?.completionPhoto&&e.completionPhoto.file){const i=e.completionPhoto,a=i.file;try{const{path:o}=await ce.uploadDocument(a,n6);e.completionPhoto={name:i.name,type:i.type,size:i.size,path:o}}catch(o){console.error("Failed to upload task completion photo:",o),delete e.completionPhoto}}const{data:t,error:s}=await ve.from("tasks").update(nn(e)).eq("id",n).select().single();if(s)throw s;return ct(t)},deleteTask:async n=>{const{error:e}=await ve.from("tasks").delete().eq("id",n);if(e)throw e},runAutomaticEscalations:async()=>{const{data:n,error:e}=await ve.functions.invoke("run-escalations");if(e)throw e;return ct(n)},getNotifications:async n=>{const{data:e,error:t}=await ve.from("notifications").select("*").eq("user_id",n).order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(ct)},createNotification:async n=>{const{data:e,error:t}=await ve.from("notifications").insert(nn(n)).select().single();if(t)throw t;return ct(e)},markNotificationAsRead:async n=>{await ve.from("notifications").update({is_read:!0}).eq("id",n)},markAllNotificationsAsRead:async n=>{await ve.from("notifications").update({is_read:!0}).eq("user_id",n).eq("is_read",!1)},createAuthUser:async n=>{const{name:e,email:t,password:s,role:i}=n;try{const{error:a}=await ve.functions.invoke("admin-create-user",{body:{name:e,email:t,password:s,role:i}});if(a)throw a;const l=(await ce.getUsers()).find(c=>c.email===t);if(l)return l;console.warn("admin-create-user completed but user not found; falling back to client side signup")}catch(a){const o=typeof a?.message=="string"?a.message:String(a);if(!o.toLowerCase().includes("failed to send a request")&&!o.toLowerCase().includes("edge function"))throw a;console.warn("Edge function not reachable, falling back to client side signup");const{data:l,error:c}=await ve.auth.signUp({email:t,password:s,options:{data:{name:e}}});if(c||!l?.user)throw c||new Error("Failed to sign up user");const d=l.user;try{await ve.from("users").upsert({id:d.id,name:e,email:t,role_id:i},{onConflict:"id"})}catch(h){console.warn("Failed to upsert user profile after fallback signup:",h)}return{id:d.id,name:e,email:t,role:i,phone:void 0,organizationId:void 0,organizationName:void 0,reportingManagerId:void 0,photoUrl:void 0}}return{id:"",name:e,email:t,role:i,phone:void 0,organizationId:void 0,organizationName:void 0,reportingManagerId:void 0,photoUrl:void 0}},getPolicies:async()=>{const{data:n,error:e}=await ve.from("policies").select("*");if(e)throw e;return(n||[]).map(ct)},createPolicy:async n=>{const{data:e,error:t}=await ve.from("policies").insert(nn(n)).select().single();if(t)throw t;return ct(e)},getInsurances:async()=>{const{data:n,error:e}=await ve.from("insurances").select("*");if(e)throw e;return(n||[]).map(ct)},createInsurance:async n=>{const{data:e,error:t}=await ve.from("insurances").insert(nn(n)).select().single();if(t)throw t;return ct(e)},getApprovalWorkflowSettings:async()=>{const{data:n,error:e}=await ve.from("settings").select("approval_workflow_settings").eq("id","singleton").single();if(e)throw e;if(!n?.approval_workflow_settings)throw new Error("Approval workflow settings are not configured.");return ct(n.approval_workflow_settings)},updateApprovalWorkflowSettings:async n=>{const{error:e}=await ve.from("settings").update({approval_workflow_settings:nn({finalConfirmationRole:n})}).eq("id","singleton");if(e)throw e},approveLeaveRequest:async(n,e)=>{const{data:t,error:s}=await ve.from("leave_requests").select("approval_history").eq("id",n).single();if(s)throw s;const{finalConfirmationRole:i}=await ce.getApprovalWorkflowSettings(),{data:a}=await ve.from("users").select("id").eq("role_id",i).limit(1).single(),{data:o,error:l}=await ve.from("users").select("name").eq("id",e).single();if(l)throw l;const c={approver_id:e,approver_name:o.name,status:"approved",timestamp:new Date().toISOString()},d=[...t.approval_history||[],c],{error:h}=await ve.from("leave_requests").update({status:"pending_hr_confirmation",current_approver_id:a?.id,approval_history:d}).eq("id",n);if(h)throw h},rejectLeaveRequest:async(n,e,t="")=>{const{data:s,error:i}=await ve.from("leave_requests").select("approval_history").eq("id",n).single();if(i)throw i;const{data:a,error:o}=await ve.from("users").select("name").eq("id",e).single();if(o)throw o;const l={approver_id:e,approver_name:a.name,status:"rejected",timestamp:new Date().toISOString(),comments:t},c=[...s.approval_history||[],l],{error:d}=await ve.from("leave_requests").update({status:"rejected",current_approver_id:null,approval_history:c}).eq("id",n);if(d)throw d},confirmLeaveByHR:async(n,e)=>{const{data:t,error:s}=await ve.from("leave_requests").select("leave_type, user_id, approval_history").eq("id",n).single();if(s)throw s;const{data:i,error:a}=await ve.from("users").select("name").eq("id",e).single();if(a)throw a;const o={approver_id:e,approver_name:i.name,status:"approved",timestamp:new Date().toISOString(),comments:"Final approval."},l=[...t.approval_history||[],o],{error:c}=await ve.from("leave_requests").update({status:"approved",current_approver_id:null,approval_history:l}).eq("id",n);if(c)throw c;if(t.leave_type==="Comp Off"){const{data:d,error:h}=await ve.from("comp_off_logs").select("id").eq("user_id",t.user_id).eq("status","earned").limit(1).single();if(h&&h.code!=="PGRST116")throw h;d&&await ve.from("comp_off_logs").update({status:"used",leave_request_id:n}).eq("id",d.id)}},submitExtraWorkClaim:async n=>{const{error:e}=await ve.from("extra_work_logs").insert(nn({...n,status:"Pending"}));if(e)throw e},getExtraWorkLogs:async n=>{let e=ve.from("extra_work_logs").select("*");n?e=e.eq("user_id",n):e=e.eq("status","Pending");const{data:t,error:s}=await e.order("work_date",{ascending:!1});if(s)throw s;return(t||[]).map(ct)},approveExtraWorkClaim:async(n,e)=>{const{data:t,error:s}=await ve.from("users").select("name").eq("id",e).single();if(s)throw s;const{data:i,error:a}=await ve.from("extra_work_logs").select("*").eq("id",n).single();if(a)throw a;if(!i)throw new Error("Claim not found.");const{error:o}=await ve.from("extra_work_logs").update({status:"Approved",approver_id:e,approver_name:t.name,approved_at:new Date().toISOString()}).eq("id",n);if(o)throw o;i.claim_type==="Comp Off"&&await ce.addCompOffLog({userId:i.user_id,userName:i.user_name,dateEarned:i.work_date,reason:`Claim approved: ${i.reason}`,status:"earned",grantedById:e,grantedByName:t.name})},rejectExtraWorkClaim:async(n,e,t)=>{const{data:s,error:i}=await ve.from("users").select("name").eq("id",e).single();if(i)throw i;const{error:a}=await ve.from("extra_work_logs").update({status:"Rejected",approver_id:e,approver_name:s.name,rejection_reason:t}).eq("id",n);if(a)throw a},getManpowerDetails:async n=>{const{data:e,error:t}=await ve.rpc("get_manpower_details",{site_id_param:n});if(t)throw t;return ct(e)},addCompOffLog:async n=>{const{data:e,error:t}=await ve.from("comp_off_logs").insert(nn(n)).select().single();if(t)throw t;return ct(e)},exportAllData:async()=>{const n=["users","organizations","onboarding_submissions","settings"],e={};for(const t of n){const{data:s,error:i}=await ve.from(t).select("*");if(i)throw new Error(`Failed to export ${t}`);e[t]=s}return ct(e)},getPincodeDetails:async n=>new Promise(e=>setTimeout(()=>e({city:"Bengaluru",state:"Karnataka"}),500)),suggestDepartmentForDesignation:async n=>{const e={"Security Guard":"Security","Housekeeping Staff":"Housekeeping","Site Manager":"Management"},t=Object.keys(e).find(s=>n.toLowerCase().includes(s.toLowerCase()));return Promise.resolve(t?e[t]:null)},verifyBankAccountWithPerfios:async n=>{console.log("Mock verifying bank account:",n),await new Promise(t=>setTimeout(t,1500));const e=Math.random()>.1;return{success:e,message:e?"Bank account verified successfully.":"Account holder name did not match.",verifiedFields:{name:null,dob:null,aadhaar:null,bank:e,uan:null,esi:null,accountHolderName:e,accountNumber:e,ifscCode:!0}}},verifyAadhaar:async n=>{console.log("Mock verifying Aadhaar:",n),await new Promise(t=>setTimeout(t,1e3));const e=n.length===12&&Math.random()>.1;return{success:e,message:e?"Aadhaar details verified.":"Invalid Aadhaar number.",verifiedFields:{name:null,dob:null,aadhaar:e,bank:null,uan:null,esi:null}}},lookupUan:async n=>{console.log("Mock looking up UAN:",n),await new Promise(t=>setTimeout(t,1200));const e=n.length===12&&Math.random()>.1;return{success:e,message:e?"UAN found and linked.":"UAN not found in EPFO database.",verifiedFields:{name:null,dob:null,aadhaar:null,bank:null,uan:e,esi:null}}},extractDataFromImage:async(n,e,t,s)=>{if(!vl)return console.warn("AI feature disabled: cannot extract data from image. Returning empty result."),{};const a=(await vl.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:`Extract the structured data from this document image. It is a ${s||"document"}.`},{inlineData:{data:n,mimeType:e}}]},config:{responseMimeType:"application/json",responseSchema:t}})).text.trim();return JSON.parse(a)},crossVerifyNames:async(n,e)=>{if(!vl){const i=n.trim().toLowerCase()===e.trim().toLowerCase();return{isMatch:i,reason:i?"Names are identical (case-insensitive match) without AI.":"AI disabled; simple case-insensitive comparison used."}}const s=(await vl.models.generateContent({model:"gemini-2.5-flash",contents:`Are these two names referring to the same person? Name 1: "${n}", Name 2: "${e}". Respond in JSON format with two keys: "isMatch" (boolean) and "reason" (a brief string explanation).`,config:{responseMimeType:"application/json",responseSchema:{type:$e.OBJECT,properties:{isMatch:{type:$e.BOOLEAN},reason:{type:$e.STRING}}}}})).text.trim();return JSON.parse(s)},verifyFingerprintImage:async(n,e)=>{if(!vl)return{containsFingerprints:!1,reason:"AI disabled; cannot detect fingerprints."};const s=(await vl.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:'Does this image contain one or more human fingerprints? The image might be a scan from paper. Respond in JSON with "containsFingerprints" (boolean) and "reason" (string).'},{inlineData:{data:n,mimeType:e}}]},config:{responseMimeType:"application/json",responseSchema:{type:$e.OBJECT,properties:{containsFingerprints:{type:$e.BOOLEAN},reason:{type:$e.STRING}}}}})).text.trim();return JSON.parse(s)},enhanceDocumentPhoto:async(n,e)=>{if(!vl)return console.warn("AI disabled; returning original document photo without enhancement."),n;const t=await vl.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{text:"Enhance this document photo. Improve contrast, correct perspective to be flat, and make text as clear as possible. Return only the enhanced image."},{inlineData:{data:n,mimeType:e}}]},config:{responseModalities:[xm.IMAGE]}});for(const s of t.candidates[0].content.parts)if(s.inlineData)return s.inlineData.data;throw new Error("AI did not return an enhanced image.")},getSiteStaffDesignations:async()=>{const{data:n,error:e}=await ve.from("site_staff_designations").select("*");if(e)throw e;return(n||[]).map(ct)},updateManpowerDetails:async(n,e)=>{console.log("Mock updating manpower for",n,e),await new Promise(t=>setTimeout(t,500))},getCompOffLogs:async n=>{const{data:e,error:t}=await ve.from("comp_off_logs").select("*").eq("user_id",n).order("date_earned",{ascending:!1});if(t)throw t;return(e||[]).map(ct)},checkCompOffTableExists:async()=>{const{error:n}=await ve.from("comp_off_logs").select("id").limit(1);if(n)throw n},getAllSiteAssets:async()=>Promise.resolve({}),updateSiteAssets:async(n,e)=>(console.log("Mock updating assets for site",n,e),Promise.resolve()),getBackOfficeIdSeries:async()=>{const{data:n,error:e}=await ve.from("settings").select("back_office_id_series").eq("id","singleton").single();if(e)throw e;return n?.back_office_id_series?ct(n.back_office_id_series):[]},updateBackOfficeIdSeries:async n=>{const{error:e}=await ve.from("settings").update({back_office_id_series:nn(n)}).eq("id","singleton");if(e)throw e},updateSiteStaffDesignations:async n=>{const{error:e}=await ve.from("site_staff_designations").upsert(nn(n),{onConflict:"id"});if(e)throw e},getAllSiteIssuedTools:async()=>Promise.resolve({}),getToolsList:async()=>Promise.resolve({}),updateSiteIssuedTools:async(n,e)=>{console.log("Mock updating tools for site",n,e)},getAllSiteGentsUniforms:async()=>Promise.resolve({}),getMasterGentsUniforms:async()=>Promise.resolve({pants:[],shirts:[]}),updateSiteGentsUniforms:async(n,e)=>{console.log("Mock updating gents uniforms for",n,e)},getAllSiteUniformDetails:async()=>Promise.resolve({}),updateSiteUniformDetails:async(n,e)=>{console.log("Mock updating uniform details for",n,e)},getAllSiteLadiesUniforms:async()=>Promise.resolve({}),getMasterLadiesUniforms:async()=>Promise.resolve({pants:[],shirts:[]}),updateSiteLadiesUniforms:async(n,e)=>{console.log("Mock updating ladies uniforms for",n,e)},getUniformRequests:async()=>{const{data:n,error:e}=await ve.from("uniform_requests").select("*");if(e)throw e;return(n||[]).map(ct)},submitUniformRequest:async n=>{const{data:e,error:t}=await ve.from("uniform_requests").insert(nn(n)).select().single();if(t)throw t;return ct(e)},updateUniformRequest:async n=>{const{data:e,error:t}=await ve.from("uniform_requests").update(nn(n)).eq("id",n.id).select().single();if(t)throw t;return ct(e)},deleteUniformRequest:async n=>{const{error:e}=await ve.from("uniform_requests").delete().eq("id",n);if(e)throw e},getInvoiceStatuses:async n=>(console.log("Mock fetching invoice statuses for",n),Promise.resolve({})),getInvoiceSummaryData:async(n,e)=>(console.log("Mock fetching invoice data for",n,e),Promise.resolve({siteName:"Mock Site",siteAddress:"Mock Address",invoiceNumber:"INV-001",invoiceDate:"2023-01-31",statementMonth:"January-2023",lineItems:[]})),getSupportTickets:async()=>{const{data:n,error:e}=await ve.from("support_tickets").select("*, posts:ticket_posts(*, comments:ticket_comments(*))");if(e)throw e;return(n||[]).map(ct)},getSupportTicketById:async n=>{const{data:e,error:t}=await ve.from("support_tickets").select("*, posts:ticket_posts(*, comments:ticket_comments(*))").eq("id",n).single();if(t)throw t;return ct(e)},createSupportTicket:async n=>{let e=null;const t=n.attachment;if(t&&t.file instanceof File)try{const{path:l}=await ce.uploadDocument(t.file,Z2);e=l}catch(l){console.error("Failed to upload support ticket attachment:",l)}delete n.attachment;let s=n.description||"";e&&(s+=`

[Attachment: ${e}]`);const i={...n,description:s,raisedAt:new Date().toISOString(),ticketNumber:`TKT-${Date.now()}`},{data:a,error:o}=await ve.from("support_tickets").insert(nn(i)).select("*, posts:ticket_posts(*, comments:ticket_comments(*))").single();if(o)throw o;return ct(a)},updateSupportTicket:async(n,e)=>{const t=e.attachment;if(t&&t.file instanceof File)try{const{path:a}=await ce.uploadDocument(t.file,Z2);e.attachment={name:t.name,type:t.type,size:t.size,path:a}}catch(a){console.error("Failed to upload updated support ticket attachment:",a),delete e.attachment}const{data:s,error:i}=await ve.from("support_tickets").update(nn(e)).eq("id",n).select("*, posts:ticket_posts(*, comments:ticket_comments(*))").single();if(i)throw i;return ct(s)},deleteSupportTicket:async n=>{const{error:e}=await ve.from("support_tickets").delete().eq("id",n);if(e)throw e},addTicketPost:async(n,e)=>{const{data:t,error:s}=await ve.from("ticket_posts").insert(nn(e)).select("*, comments:ticket_comments(*)").single();if(s)throw s;return ct(t)},togglePostLike:async(n,e)=>{const{data:t,error:s}=await ve.from("ticket_posts").select("likes").eq("id",n).single();if(s)throw s;const i=t.likes||[],a=i.includes(e)?i.filter(l=>l!==e):[...i,e],{error:o}=await ve.from("ticket_posts").update({likes:a}).eq("id",n);if(o)throw o},addPostComment:async(n,e)=>{const{data:t,error:s}=await ve.from("ticket_comments").insert(nn(e)).select().single();if(s)throw s;return ct(t)},getVerificationCostBreakdown:async(n,e)=>{const{data:t,error:s}=await ve.from("onboarding_submissions").select("id, employee_id, personal, enrollment_date, verification_usage").gte("enrollment_date",n).lte("enrollment_date",e);if(s)throw s;return(t||[]).map(i=>{const a=ct(i);return{id:a.id,employeeId:a.personal.employeeId,employeeName:`${a.personal.firstName} ${a.personal.lastName}`,enrollmentDate:a.enrollmentDate,totalCost:0,breakdown:a.verificationUsage||[]}})},generatePdf:async(n,e)=>{try{const t=(await Ru(async()=>{const{default:s}=await import("./html2pdf-CO-w4bza.js").then(i=>i.h);return{default:s}},[],import.meta.url)).default;await t().set(e).from(n).save()}catch(t){throw console.error("PDF generation failed:",t),t}},batchResolveAddresses:async n=>{if(n.length===0)return{};const e=c=>parseFloat(c.toFixed(6)),t=Array.from(new Set(n.map(c=>`${e(c.lat)},${e(c.lon)}`))).map(c=>{const[d,h]=c.split(",").map(Number);return{lat:d,lon:h}}),s={},i=[],a=t.map(c=>c.lat),{data:o,error:l}=await ve.from("location_cache").select("*").in("latitude",a);!l&&o&&o.forEach(c=>{const d=e(parseFloat(c.latitude)),h=e(parseFloat(c.longitude)),m=`${d},${h}`;t.some(f=>e(f.lat)===d&&e(f.lon)===h)&&(s[m]=c.address)}),t.forEach(c=>{const d=`${e(c.lat)},${e(c.lon)}`;s[d]||i.push(c)}),console.log("Geocoding API: Found",Object.keys(s).length,"cached,",i.length,"missing");for(const c of i)try{const d=await Ru(()=>Promise.resolve().then(()=>i6),void 0,import.meta.url).then(m=>m.reverseGeocode(c.lat,c.lon)),h=`${e(c.lat)},${e(c.lon)}`;s[h]=d,await ve.from("location_cache").insert({latitude:e(c.lat),longitude:e(c.lon),address:d}),console.log("Geocoding API: Fetched and cached",h,"->",d),await new Promise(m=>setTimeout(m,1e3))}catch(d){console.error(`Failed to resolve address for ${c.lat},${c.lon}`,d);const h=`${e(c.lat)},${e(c.lon)}`;s[h]=`${c.lat.toFixed(4)}, ${c.lon.toFixed(4)}`}return s},sendSecurityAlert:async(n,e,t,s)=>{const{data:i,error:a}=await ve.from("users").select("reporting_manager_id").eq("id",n).single();if(a||!i?.reporting_manager_id){console.warn("Could not find reporting manager for security alert");return}const o=t==="developer_mode"?"attempted to access the application with Developer Mode enabled":"attempted to access the application with Location Spoofing detected",l=s?` using device: ${s}`:"";await ce.createNotification({userId:i.reporting_manager_id,title:" Security Alert",message:`${e} ${o}${l}. Access was blocked for security reasons.`,type:"security",link:"/user-management"})},sendDeviceChangeAlert:async(n,e,t,s)=>{const{data:i,error:a}=await ve.from("users").select("reporting_manager_id").eq("id",n).single();if(a||!i?.reporting_manager_id){console.warn("Could not find reporting manager for device change alert");return}await ce.createNotification({userId:i.reporting_manager_id,title:" Device Change Detected",message:`${e} logged in from a new device. Previous device: ${t}, New device: ${s}`,type:"info",link:"/user-management"})},getPatrolQrCodes:async n=>{let e=ve.from("patrol_qr_codes").select("*");n&&(e=e.eq("site_id",n));const{data:t,error:s}=await e;if(s)throw s;return(t||[]).map(ct)},createPatrolQrCode:async n=>{const{data:e,error:t}=await ve.from("patrol_qr_codes").insert(nn(n)).select().single();if(t)throw t;return ct(e)},updatePatrolQrCode:async(n,e)=>{const{error:t}=await ve.from("patrol_qr_codes").update(nn(e)).eq("id",n);if(t)throw t},deletePatrolQrCode:async n=>{const{error:e}=await ve.from("patrol_qr_codes").delete().eq("id",n);if(e)throw e},logLocation:async n=>{const{error:e}=await ve.from("user_location_logs").insert(nn(n));if(e)throw e},getTeamMembers:async n=>{const{data:e,error:t}=await ve.from("users").select("*").eq("reporting_manager_id",n);if(t)throw t;return(e||[]).map(ct)},getLocationHistory:async(n,e)=>{const t=new Date(e);t.setHours(0,0,0,0);const s=new Date(e);s.setHours(23,59,59,999);const{data:i,error:a}=await ve.from("user_location_logs").select("*").eq("user_id",n).gte("timestamp",t.toISOString()).lte("timestamp",s.toISOString()).order("timestamp",{ascending:!0});if(a)throw a;return(i||[]).map(ct)},getLatestLocations:async n=>{if(n.length===0)return{};const e=new Date;e.setHours(e.getHours()-24);const{data:t,error:s}=await ve.from("user_location_logs").select("*").in("user_id",n).gte("timestamp",e.toISOString()).order("timestamp",{ascending:!1});if(s)throw s;const i={};return(t||[]).forEach(a=>{const o=ct(a);i[o.userId]||(i[o.userId]=o)}),i},submitPatrolLog:async n=>{let e=n.photoUrl;if(e&&e.startsWith("data:")){const{data:{session:i}}=await ve.auth.getSession();if(!i?.user)throw new Error("User not authenticated");const a=await G2(e),l=`${i.user.id}/patrols/${Date.now()}.jpg`,{error:c}=await ve.storage.from("task-attachments").upload(l,a);if(c)throw c;const{data:{publicUrl:d}}=ve.storage.from("task-attachments").getPublicUrl(l);e=d}const t={...nn(n),photo_url:e},{error:s}=await ve.from("patrol_logs").insert(t);if(s)throw s},getPatrolLogs:async(n,e)=>{const t=new Date(`${n}T00:00:00`),s=new Date(`${n}T23:59:59.999`);let i=ve.from("patrol_logs").select("*, patrol_qr_codes!inner(site_id)").gte("scan_time",t.toISOString()).lte("scan_time",s.toISOString()).order("scan_time",{ascending:!1});e&&(i=i.eq("patrol_qr_codes.site_id",e));const{data:a,error:o}=await i;if(o)throw o;return(a||[]).map(ct)},getPatrolDailyScores:async n=>{const{data:e,error:t}=await ve.from("patrol_daily_scores").select("*").eq("date",n);if(t)throw t;return(e||[]).map(ct)},getCheckpoints:async n=>{const{data:e,error:t}=await ve.from("patrol_qr_codes").select("*").eq("site_id",n).eq("status","active");if(t)throw t;return(e||[]).map(ct)}},r6=(n,e,t="Operation timed out")=>{const s=new Promise((i,a)=>{setTimeout(()=>a(new Error(t)),e)});return Promise.race([n,s])};function dZ(n,e,t,s){const i=h=>h*Math.PI/180,o=i(t-n),l=i(s-e),c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i(n))*Math.cos(i(t))*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}async function wm(n,e){const t=`${n.toFixed(4)}, ${e.toFixed(4)}`;try{const{supabase:s}=await Ru(async()=>{const{supabase:l}=await Promise.resolve().then(()=>D3);return{supabase:l}},void 0,import.meta.url),i=Math.round(n*1e4)/1e4,a=Math.round(e*1e4)/1e4,{data:o}=await s.from("location_cache").select("address").eq("latitude",i).eq("longitude",a).maybeSingle();return o?.address?o.address:t}catch(s){return console.warn("Reverse geocode failed:",s),t}}function vp(n=50,e=1e4){return new Promise((t,s)=>{if(!("geolocation"in navigator))return s(new Error("Geolocation is not supported by this browser."));let i=null;const a=setTimeout(()=>{i?(navigator.geolocation.clearWatch(o),t(i)):(navigator.geolocation.clearWatch(o),s(new Error("Unable to acquire a precise position within the timeout period")))},e),o=navigator.geolocation.watchPosition(l=>{(!i||l.coords.accuracy<i.coords.accuracy)&&(i=l),l.coords.accuracy<=n&&(clearTimeout(a),navigator.geolocation.clearWatch(o),t(l))},l=>{clearTimeout(a),navigator.geolocation.clearWatch(o),s(l)},{enableHighAccuracy:!0,maximumAge:0})})}const i6=Object.freeze(Object.defineProperty({__proto__:null,calculateDistanceMeters:dZ,getPrecisePosition:vp,reverseGeocode:wm},Symbol.toStringTag,{value:"Module"})),sC=n=>{const e=n.toLowerCase();return e.includes("timed out")?"The request took too long. Please check your internet connection and try again.":e.includes("invalid api key")||e.includes("configuration")?"System configuration error. Please contact support.":e.includes("failed to fetch")||e.includes("network")?"Unable to connect. Please check your internet connection.":e.includes("invalid login credentials")?'Incorrect email or password. If you use Google Sign-In, please click "Sign in with Google".':e.includes("user already registered")||e.includes("already exists")?"This email is already registered. Please sign in.":e.includes("email not confirmed")?"Please verify your email address. Check your inbox for the confirmation link.":e.includes("too many requests")||e.includes("rate limit")?"Too many attempts. Please wait a few minutes before trying again.":e.includes("weak password")?"Password is too weak. Please use a stronger password.":(console.error("Unhandled auth error:",n),"Something went wrong. Please try again or contact support.")},Mb=()=>{const n=new Date().getHours();return n<12?"Good Morning":n<17?"Good Afternoon":"Good Evening"},bt=ga()((n,e)=>({user:null,isInitialized:!1,isCheckedIn:!1,isAttendanceLoading:!0,lastCheckInTime:null,lastCheckOutTime:null,error:null,loading:!1,isLoginAnimationPending:!1,setLoginAnimationPending:t=>n({isLoginAnimationPending:t}),setUser:t=>n({user:t,error:null,loading:!1}),setInitialized:t=>n({isInitialized:t}),setLoading:t=>n({loading:t}),resetAttendance:()=>n({isCheckedIn:!1,isAttendanceLoading:!1,lastCheckInTime:null,lastCheckOutTime:null,isLoginAnimationPending:!1}),setError:t=>n({error:t}),loginWithEmail:async(t,s,i)=>{n({error:null,loading:!0});try{await Ja.signOut()}catch{}try{const{data:a,error:o}=await r6(Ja.signInWithPassword(t,s),2e4,"Login attempt timed out. Please check your network connection.").catch(c=>({data:{user:null,session:null},error:{message:c.message}}));if(o||!a.user||!a.session){const c=sC(o?.message||"Invalid login credentials");return n({error:c,loading:!1}),{error:{message:c}}}i?(localStorage.setItem("rememberedEmail",t),localStorage.setItem("supabase.auth.rememberMe",a.session.refresh_token)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("supabase.auth.rememberMe"));const l=await Ja.getAppUserProfile(a.user);if(l){n({user:l,error:null,loading:!1});try{const c=`greetingSent_${l.id}`,d=Mb();await ce.createNotification({userId:l.id,message:`${d}, ${l.name||"there"}! Welcome back to Paradigm Services.`,type:"greeting"})}catch(c){console.error("Failed to send login greeting notification",c)}return{error:null}}else{await Ja.signOut();const c="Login successful, but failed to retrieve user profile. Please try again.";return n({user:null,error:c,loading:!1}),{error:{message:c}}}}catch(a){console.error("Unexpected error during login flow:",a);const o=sC("Unexpected error during login flow");return n({user:null,error:o,loading:!1}),{error:{message:o}}}},signUp:async(t,s,i)=>{n({error:null,loading:!0});const{error:a}=await Ja.signUpWithPassword({email:s,password:i,options:{data:{name:t}}});if(a){const o=sC(a.message);return n({error:o,loading:!1}),{error:{message:o}}}return n({loading:!1}),{error:null}},loginWithGoogle:async()=>{n({error:null,loading:!0});const{error:t}=await Ja.signInWithGoogle();if(t){const s=sC(t.message);return n({error:s,loading:!1}),{error:{message:s}}}return n({loading:!1}),{error:null}},sendPasswordReset:async t=>{const{error:s}=await Ja.resetPasswordForEmail(t);return s?{error:{message:s.message}}:{error:null}},logout:async()=>{const t=e().user;if(t)try{const s=Mb(),i=new Date().getHours()>=20?"Good Night":s;await ce.createNotification({userId:t.id,message:`${i}, ${t.name||"there"}! Thanks for your hard work today.`,type:"greeting"})}catch(s){console.error("Failed to send logout farewell notification",s)}localStorage.removeItem("supabase.auth.rememberMe"),await Ja.signOut()},updateUserProfile:t=>n(s=>({user:s.user?{...s.user,...t}:null})),checkAttendanceStatus:async()=>{const{user:t}=e();if(!t){n({isAttendanceLoading:!1});return}n({isAttendanceLoading:!0});try{const s=new Date,i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0).toISOString(),a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999).toISOString(),o=await ce.getAttendanceEvents(t.id,i,a);if(o.length===0){n({isCheckedIn:!1,lastCheckInTime:null,lastCheckOutTime:null,isAttendanceLoading:!1});return}o.sort((h,m)=>new Date(h.timestamp).getTime()-new Date(m.timestamp).getTime());const l=o.find(h=>h.type==="check-in"),c=[...o].reverse().find(h=>h.type==="check-out"),d=o[o.length-1];n({isCheckedIn:d?.type==="check-in",lastCheckInTime:l?l.timestamp:null,lastCheckOutTime:c?c.timestamp:null,isAttendanceLoading:!1})}catch(s){console.error("Failed to check attendance status:",s),n({isAttendanceLoading:!1})}},toggleCheckInStatus:async()=>{const{user:t,isCheckedIn:s}=e();if(!t)return{success:!1,message:"User not found"};const i=s?"check-out":"check-in";try{let a=null;try{a=await vp()}catch{}(!a||!a.coords)&&(a=await new Promise(m=>{navigator.geolocation.getCurrentPosition(f=>m(f),f=>{console.warn("Fallback geolocation failed:",f.message),m(null)},{enableHighAccuracy:!1,timeout:15e3,maximumAge:6e4})}));const o=async(m,f,p)=>{await ce.addAttendanceEvent({userId:t.id,timestamp:new Date().toISOString(),type:i,latitude:m,longitude:f,locationId:p}),await e().checkAttendanceStatus();try{const b=Mb(),x=i==="check-in"?"checking in":"checking out";await ce.createNotification({userId:t.id,message:`${b}, ${t.name||"there"}! Thanks for ${x}.`,type:"greeting"})}catch(b){console.warn("Failed to send user attendance notification",b)}try{const b=await ce.getAttendanceSettings();if((["admin","hr","finance","developer"].includes(t.role)?b?.office:b?.field)?.enableAttendanceNotifications){const S=[];t.reportingManagerId&&S.push({id:t.reportingManagerId});const B=await ce.getNearbyUsers();for(const _ of B)S.find(Y=>Y.id===_.id)||S.push({id:_.id});const V=t.name||"An employee",R=p?"":m&&f?` at ${m.toFixed(4)}, ${f.toFixed(4)}`:"",W=`${V} ${i.replace("-"," ")}${R}`;await Promise.all(S.map(_=>ce.createNotification({userId:_.id,message:W,type:"greeting"})))}}catch(b){console.warn("Failed to create manager notifications:",b)}return{success:!0,message:`Successfully ${i.replace("-"," ")}!`}};if(!a||!a.coords)return{success:!1,message:"Location required. Please enable GPS/Location Services and try again."};const{latitude:l,longitude:c,accuracy:d}=a.coords;let h=null;try{const m=await ce.getUserLocations(t.id);for(const f of m)if(dZ(l,c,f.latitude,f.longitude)<=f.radius){h=f.id;break}if(!h){const f=await ce.getLocations();for(const p of f)if(dZ(l,c,p.latitude,p.longitude)<=p.radius){h=p.id;try{await ce.assignLocationToUser(t.id,p.id)}catch(x){console.warn("Failed to autoassign location to user:",x)}break}}}catch(m){console.warn("Geofencing check failed:",m)}if(!h)try{let m=null;try{m=await wm(l,c)}catch(b){console.warn("Reverse geocode failed for new location:",b)}const p=await ce.createLocation({name:m||null,latitude:l,longitude:c,radius:100,address:m||null,createdBy:t.id});try{await ce.assignLocationToUser(t.id,p.id)}catch(b){console.warn("Failed to autoassign new location to user:",b)}h=p.id}catch(m){console.warn("Failed to create a new geofence location:",m),h=null}return await o(l,c,h)}catch(a){return console.error("Error during attendance update:",a),{success:!1,message:"Failed to update attendance."}}}})),a6={};function cd(n,e){let t;try{t=n()}catch{return}return{getItem:i=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=t.getItem(i))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(i,a)=>t.setItem(i,JSON.stringify(a,void 0)),removeItem:i=>t.removeItem(i)}}const Zm=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return Zm(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return Zm(s)(t)}}}},o6=(n,e)=>(t,s,i)=>{let a={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:v=>v,version:0,merge:(v,S)=>({...S,...v}),...e},o=!1;const l=new Set,c=new Set;let d;try{d=a.getStorage()}catch{}if(!d)return n((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),t(...v)},s,i);const h=Zm(a.serialize),m=()=>{const v=a.partialize({...s()});let S;const B=h({state:v,version:a.version}).then(V=>d.setItem(a.name,V)).catch(V=>{S=V});if(S)throw S;return B},f=i.setState;i.setState=(v,S)=>{f(v,S),m()};const p=n((...v)=>{t(...v),m()},s,i);let b;const x=()=>{var v;if(!d)return;o=!1,l.forEach(B=>B(s()));const S=((v=a.onRehydrateStorage)==null?void 0:v.call(a,s()))||void 0;return Zm(d.getItem.bind(d))(a.name).then(B=>{if(B)return a.deserialize(B)}).then(B=>{if(B)if(typeof B.version=="number"&&B.version!==a.version){if(a.migrate)return a.migrate(B.state,B.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return B.state}).then(B=>{var V;return b=a.merge(B,(V=s())!=null?V:p),t(b,!0),m()}).then(()=>{S?.(b,void 0),o=!0,c.forEach(B=>B(b))}).catch(B=>{S?.(void 0,B)})};return i.persist={setOptions:v=>{a={...a,...v},v.getStorage&&(d=v.getStorage())},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:v=>(l.add(v),()=>{l.delete(v)}),onFinishHydration:v=>(c.add(v),()=>{c.delete(v)})},x(),b||p},l6=(n,e)=>(t,s,i)=>{let a={storage:cd(()=>localStorage),partialize:x=>x,version:0,merge:(x,v)=>({...v,...x}),...e},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return n((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),t(...x)},s,i);const h=()=>{const x=a.partialize({...s()});return d.setItem(a.name,{state:x,version:a.version})},m=i.setState;i.setState=(x,v)=>{m(x,v),h()};const f=n((...x)=>{t(...x),h()},s,i);i.getInitialState=()=>f;let p;const b=()=>{var x,v;if(!d)return;o=!1,l.forEach(B=>{var V;return B((V=s())!=null?V:f)});const S=((v=a.onRehydrateStorage)==null?void 0:v.call(a,(x=s())!=null?x:f))||void 0;return Zm(d.getItem.bind(d))(a.name).then(B=>{if(B)if(typeof B.version=="number"&&B.version!==a.version){if(a.migrate)return[!0,a.migrate(B.state,B.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,B.state];return[!1,void 0]}).then(B=>{var V;const[R,W]=B;if(p=a.merge(W,(V=s())!=null?V:f),t(p,!0),R)return h()}).then(()=>{S?.(p,void 0),p=s(),o=!0,c.forEach(B=>B(p))}).catch(B=>{S?.(void 0,B)})};return i.persist={setOptions:x=>{a={...a,...x},x.storage&&(d=x.storage)},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>b(),hasHydrated:()=>o,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(c.add(x),()=>{c.delete(x)})},a.skipHydration||b(),p||f},c6=(n,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((a6?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),o6(n,e)):l6(n,e),Ng=c6,Fl=ga(Ng(n=>({theme:"light",isAutomatic:!0,setTheme:e=>n({theme:e,isAutomatic:!1}),setAutomatic:e=>n({isAutomatic:e}),_setThemeInternal:e=>n({theme:e})}),{name:"paradigm-app-theme",storage:cd(()=>localStorage)})),d6={esiCtcThreshold:21e3,enforceManpowerLimit:!1,manpowerLimitRule:"warn",allowSalaryEdit:!1,salaryThreshold:21e3,defaultPolicySingle:"1L",defaultPolicyMarried:"2L",enableEsiRule:!1,enableGmcRule:!1,enforceFamilyValidation:!0,rulesByDesignation:{}},dd=ga()(n=>({...d6,init:e=>{e&&n(e)},updateRules:e=>n(t=>({...t,...e}))})),g6={unverified:[],admin:["view_all_submissions","manage_users","manage_sites","view_entity_management","view_developer_settings","view_operations_dashboard","view_site_dashboard","create_enrollment","manage_roles_and_permissions","manage_attendance_rules","view_all_attendance","view_own_attendance","apply_for_leave","manage_leave_requests","manage_approval_workflow","download_attendance_report","manage_tasks","manage_policies","manage_insurance","manage_enrollment_rules","manage_uniforms","view_invoice_summary","view_verification_costing","view_field_officer_tracking","manage_modules","access_support_desk"],hr:["view_all_submissions","manage_users","manage_sites","view_entity_management","manage_attendance_rules","view_all_attendance","view_own_attendance","apply_for_leave","manage_leave_requests","download_attendance_report","manage_policies","manage_insurance","manage_enrollment_rules","manage_uniforms","view_invoice_summary","view_verification_costing","access_support_desk"],finance:["view_invoice_summary","view_verification_costing","view_own_attendance","apply_for_leave"],developer:["view_developer_settings"],operation_manager:["view_operations_dashboard","view_all_attendance","view_own_attendance","apply_for_leave","manage_leave_requests","manage_tasks","access_support_desk"],site_manager:["view_site_dashboard","create_enrollment","view_own_attendance","apply_for_leave","access_support_desk"],field_officer:["create_enrollment","view_own_attendance","apply_for_leave","access_support_desk"]},ha=ga(Ng((n,e)=>({permissions:g6,initRoles:t=>{if(!t)return;const i={...e().permissions};let a=!1;t.forEach(o=>{i[o.id]||(i[o.id]=[],a=!0)}),a&&n({permissions:i})},addRolePermissionEntry:t=>{n(s=>({permissions:{...s.permissions,[t.id]:[]}}))},removeRolePermissionEntry:t=>{n(s=>{const i={...s.permissions};return delete i[t],{permissions:i}})},renameRolePermissionEntry:(t,s)=>{n(i=>{const a={...i.permissions};return a[t]&&(a[s]=a[t],delete a[t]),{permissions:a}})},setRolePermissions:(t,s)=>{n(i=>({permissions:{...i.permissions,[t]:s}}))}}),{name:"paradigm_app_permissions_v2",storage:cd(()=>localStorage)})),u6={enablePincodeVerification:!0},h6={office:{minimumHoursFullDay:8,minimumHoursHalfDay:4,annualEarnedLeaves:5,annualSickLeaves:12,monthlyFloatingLeaves:1,annualCompOffLeaves:5,enableAttendanceNotifications:!1,sickLeaveCertificateThreshold:2},field:{minimumHoursFullDay:9,minimumHoursHalfDay:5,annualEarnedLeaves:10,annualSickLeaves:10,monthlyFloatingLeaves:0,annualCompOffLeaves:10,enableAttendanceNotifications:!0,sickLeaveCertificateThreshold:3}},m6={applicability:"Optional - Opt-in Default",optInDisclaimer:"Please note that currently the GMC facility covers only spouse and two children. If you would like to continue, please select below relationships and submit.",coverageDetails:"Spouse and two children",optOutDisclaimer:"Please note that you are opting out of the GMC Facility. You will have to submit a declaration to the company towards the same along with proof of your existing insurance.",requireAlternateInsurance:!0,collectProvider:!0,collectStartDate:!0,collectEndDate:!0,collectExtentOfCover:!0},I6={enabled:!0,clientId:"",clientSecret:""},C6={enabled:!0},f6={enabled:!0},p6={email:{enabled:!1}},A6=[{id:"cost_1",name:"Profile Picture",cost:0},{id:"cost_2",name:"Mobile to Form Prefill",cost:7},{id:"cost_3",name:"KYC OCR (Plus)",cost:1.5},{id:"cost_4",name:"Aadhaar Mobile Link",cost:2.5},{id:"cost_5",name:"EPF UAN Lookup",cost:2.5},{id:"cost_6",name:"Cheque OCR",cost:3},{id:"cost_7",name:"Bank AC Verification Advanced",cost:2.25},{id:"cost_8",name:"PAN Profile Detailed",cost:5},{id:"cost_9",name:"Aadhaar Verification",cost:1.75},{id:"cost_10",name:"Voter ID OCR",cost:1.5},{id:"cost_11",name:"Driving License OCR",cost:1.5},{id:"cost_12",name:"Education Certificate OCR",cost:2},{id:"cost_13",name:"Experience/Salary Slip OCR",cost:2},{id:"cost_14",name:"ESI Card OCR",cost:1.5}],b6={enableProvisionalSites:!1},wi=ga()(Ng(n=>({address:u6,attendance:h6,officeHolidays:[],fieldHolidays:[],recurringHolidays:[],gmcPolicy:m6,perfiosApi:I6,geminiApi:C6,otp:f6,notifications:p6,verificationCosts:A6,siteManagement:b6,initSettings:e=>{if(e){const{holidays:t,attendanceSettings:s,recurringHolidays:i}=e,a=t.filter(l=>l.type==="office"),o=t.filter(l=>l.type==="field");n({officeHolidays:a,fieldHolidays:o,attendance:s,recurringHolidays:i||[]})}},updateAddressSettings:e=>n(t=>({address:{...t.address,...e}})),updateAttendanceSettings:e=>n({attendance:e}),updateGmcPolicySettings:e=>n(t=>({gmcPolicy:{...t.gmcPolicy,...e}})),updatePerfiosApiSettings:e=>n(t=>({perfiosApi:{...t.perfiosApi,...e}})),updateGeminiApiSettings:e=>n(t=>({geminiApi:{...t.geminiApi,...e}})),updateOtpSettings:e=>n(t=>({otp:{...t.otp,...e}})),updateNotificationSettings:e=>n(t=>({notifications:{...t.notifications,...e,email:{...t.notifications.email,...e.email}}})),updateVerificationCosts:e=>n({verificationCosts:e}),updateSiteManagementSettings:e=>n(t=>({siteManagement:{...t.siteManagement,...e}})),addHoliday:async(e,t)=>{const s=await ce.addHoliday({...t,type:e});n(i=>{const a=e==="office"?"officeHolidays":"fieldHolidays",o=[...i[a],s].sort((l,c)=>new Date(l.date).getTime()-new Date(c.date).getTime());return{[a]:o}})},removeHoliday:async(e,t)=>{await ce.removeHoliday(t),n(s=>{const i=e==="office"?"officeHolidays":"fieldHolidays";return{[i]:s[i].filter(a=>a.id!==t)}})},addRecurringHoliday:async e=>{const t=await ce.addRecurringHoliday(e);n(s=>({recurringHolidays:[...s.recurringHolidays,t]}))},removeRecurringHoliday:async e=>{await ce.deleteRecurringHoliday(e),n(t=>({recurringHolidays:t.recurringHolidays.filter(s=>s.id!==e)}))}}),{name:"paradigm_app_settings",storage:cd(()=>localStorage)})),an=ga()(Ng(n=>({colorScheme:"professional-blue",appTitle:"Southwall Employee Onboarding",userHasSetPreference:!1,setColorScheme:e=>n({colorScheme:e,userHasSetPreference:!0}),setAppTitle:e=>n({appTitle:e}),initBranding:(e,t)=>n(s=>({colorScheme:e,appTitle:t||s.appTitle}))}),{name:"paradigm-branding",storage:cd(()=>localStorage)})),nm="/SouthWall-Logo.jpg",y6="https://fmyafuhxlorbafbacywa.supabase.co/storage/v1/object/sign/logo/Paradigm-Logo-3-1024x157.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV82MDgwNWUxZC0yMTk2LTQxMjktYjUwMC0yMGZiYzgwN2I3NjUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJsb2dvL1BhcmFkaWdtLUxvZ28tMy0xMDI0eDE1Ny5wbmciLCJpYXQiOjE3NjM2MTQwNzUsImV4cCI6MjA3ODk3NDA3NX0.TYFTGDrqZ3frG3wS6gbF5TQchyBX3kb2VV49Il4X-34",v6="/SouthWall-Logo.jpg",cG=n=>n==="blue"||n==="professional-blue"?v6:y6,x6=n=>n==="blue"||n==="professional-blue"?"SouthWall Security":"Paradigm Services",Dm=ga(Ng(n=>({currentLogo:nm,defaultLogo:nm,userHasSetLogo:!1,setCurrentLogo:e=>n({currentLogo:e,userHasSetLogo:!0}),initLogo:e=>n({currentLogo:e}),setDefaultLogoValue:e=>n({defaultLogo:e}),setDefaultLogo:()=>n(e=>({defaultLogo:e.currentLogo})),resetToDefault:()=>n(e=>({currentLogo:e.defaultLogo})),resetToOriginal:()=>n({currentLogo:nm,defaultLogo:nm})}),{name:"paradigm-app-logo",storage:cd(()=>localStorage)})),jt=n=>{const[e,t]=k.useState(window.matchMedia(n).matches);return k.useEffect(()=>{const s=window.matchMedia(n),i=()=>t(s.matches);try{s.addEventListener("change",i)}catch{s.addListener(i)}return()=>{try{s.removeEventListener("change",i)}catch{s.removeListener(i)}}},[n]),e},S6=300*1e3,w6=50,Z6=()=>{const{user:n}=bt(),[e,t]=k.useState(!1),s=k.useRef(null);return k.useEffect(()=>{if(!n)return;let i,a;const o=async c=>{const{latitude:d,longitude:h,accuracy:m,speed:f}=c.coords;if(!(s.current&&G6(s.current.lat,s.current.lng,d,h)<w6))try{let p="still";(f||0)>1&&(f||0)<5&&(p="walking"),(f||0)>=5&&(p="vehicle"),await ce.logLocation({userId:n.id,latitude:d,longitude:h,accuracy:m,speed:f||0,activityType:p,timestamp:new Date().toISOString()}),s.current={lat:d,lng:h},console.log("Location logged:",d,h)}catch(p){console.error("Failed to log location",p)}};return(()=>{if(!("geolocation"in navigator)){console.error("Geolocation not supported");return}t(!0),navigator.geolocation.getCurrentPosition(o,console.error);let c=0;a=navigator.geolocation.watchPosition(d=>{const h=Date.now();h-c>3e4&&(o(d),c=h)},d=>{d.code===3?console.warn("Watch Position Timeout - retrying..."):console.error("Watch Position Error:",d)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:6e4}),i=setInterval(()=>{navigator.geolocation.getCurrentPosition(o,console.error,{enableHighAccuracy:!0})},S6)})(),()=>{t(!1),a&&navigator.geolocation.clearWatch(a),i&&clearInterval(i)}},[n]),{isTracking:e}};function G6(n,e,t,s){const a=n*Math.PI/180,o=t*Math.PI/180,l=(t-n)*Math.PI/180,c=(s-e)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}const B2=()=>({id:`draft_${Date.now()}`,status:"draft",enrollmentDate:new Date().toISOString().split("T")[0],personal:{employeeId:`PARA-${Math.floor(1e3+Math.random()*9e3)}`,firstName:"",lastName:"",dob:"",gender:"",maritalStatus:"",bloodGroup:"",mobile:"",alternateMobile:"",email:"",emergencyContactName:"",emergencyContactNumber:"",relationship:"",salary:null,verifiedStatus:{}},address:{present:{line1:"",city:"",state:"",country:"India",pincode:"",verifiedStatus:{country:!0}},permanent:{line1:"",city:"",state:"",country:"India",pincode:"",verifiedStatus:{country:!0}},sameAsPresent:!0},family:[],education:[],bank:{accountHolderName:"",accountNumber:"",confirmAccountNumber:"",ifscCode:"",bankName:"",branchName:"",verifiedStatus:{}},uan:{hasPreviousPf:!1,verifiedStatus:{},salarySlip:null},esi:{hasEsi:!1,verifiedStatus:{}},gmc:{isOptedIn:null,policyAmount:"",nomineeName:"",nomineeRelation:"",selectedSpouseId:"",selectedChildIds:[],gmcPolicyCopy:null,declarationAccepted:!1},organization:{designation:"",department:"",reportingManager:"",organizationId:"",organizationName:"",joiningDate:He(new Date,"yyyy-MM-dd"),workType:"Full-time",defaultSalary:null},uniforms:[],biometrics:{signatureImage:null,fingerprints:{leftThumb:null,leftIndex:null,leftMiddle:null,leftRing:null,leftLittle:null,rightThumb:null,rightIndex:null,rightMiddle:null,rightRing:null,rightLittle:null}},salaryChangeRequest:null,requiresManualVerification:!1,formsGenerated:!1,verificationUsage:[]}),Qn=ga(n=>({data:B2(),setData:e=>n({data:e}),updatePersonal:e=>n(t=>({data:{...t.data,personal:{...t.data.personal,...e}}})),setPersonalVerifiedStatus:e=>n(t=>({data:{...t.data,personal:{...t.data.personal,verifiedStatus:{...t.data.personal.verifiedStatus,...e}}}})),updateAddress:e=>n(t=>({data:{...t.data,address:{...t.data.address,...e}}})),setAddressVerifiedStatus:(e,t)=>n(s=>({data:{...s.data,address:{...s.data.address,[e]:{...s.data.address[e],verifiedStatus:{...s.data.address[e].verifiedStatus,...t}}}}})),updateFamily:e=>n(t=>({data:{...t.data,family:e}})),updateEducation:e=>n(t=>({data:{...t.data,education:e}})),updateBank:e=>n(t=>({data:{...t.data,bank:{...t.data.bank,...e}}})),setBankVerifiedStatus:e=>n(t=>({data:{...t.data,bank:{...t.data.bank,verifiedStatus:{...t.data.bank.verifiedStatus,...e}}}})),updateUan:e=>n(t=>({data:{...t.data,uan:{...t.data.uan,...e}}})),setUanVerifiedStatus:e=>n(t=>({data:{...t.data,uan:{...t.data.uan,verifiedStatus:{...t.data.uan.verifiedStatus,...e}}}})),updateEsi:e=>n(t=>({data:{...t.data,esi:{...t.data.esi,...e}}})),setEsiVerifiedStatus:e=>n(t=>({data:{...t.data,esi:{...t.data.esi,verifiedStatus:{...t.data.esi.verifiedStatus,...e}}}})),updateGmc:e=>n(t=>({data:{...t.data,gmc:{...t.data.gmc,...e}}})),updateOrganization:e=>n(t=>({data:{...t.data,organization:{...t.data.organization,...e}}})),updateUniforms:e=>n(t=>({data:{...t.data,uniforms:e}})),updateBiometrics:e=>n(t=>({data:{...t.data,biometrics:{...t.data.biometrics,...e}}})),setSalaryChangeRequest:e=>n(t=>({data:{...t.data,salaryChangeRequest:e}})),setRequiresManualVerification:e=>n(t=>({data:{...t.data,requiresManualVerification:e}})),setFormsGenerated:e=>n(t=>({data:{...t.data,formsGenerated:e}})),logVerificationUsage:e=>n(t=>{const s=JSON.parse(JSON.stringify(t.data.verificationUsage||[])),i=s.find(a=>a.name===e);return i?i.count+=1:s.push({name:e,count:1}),{data:{...t.data,verificationUsage:s}}}),reset:()=>n({data:B2()}),addFamilyMember:()=>n(e=>({data:{...e.data,family:[...e.data.family,{id:`fam_${Date.now()}`,relation:"",name:"",dob:"",gender:"",occupation:"",dependent:!1,idProof:null,phone:""}]}})),updateFamilyMember:(e,t)=>n(s=>({data:{...s.data,family:s.data.family.map(i=>i.id===e?{...i,...t}:i)}})),removeFamilyMember:e=>n(t=>({data:{...t.data,family:t.data.family.filter(s=>s.id!==e)}})),addEducationRecord:()=>n(e=>({data:{...e.data,education:[...e.data.education,{id:`edu_${Date.now()}`,degree:"",institution:"",startYear:"",endYear:""}]}})),updateEducationRecord:(e,t)=>n(s=>({data:{...s.data,education:s.data.education.map(i=>i.id===e?{...i,...t}:i)}})),removeEducationRecord:e=>n(t=>({data:{...t.data,education:t.data.education.filter(s=>s.id!==e)}})),addOrUpdateEmergencyContactAsFamilyMember:()=>n(e=>{const{personal:t,family:s}=e.data,{emergencyContactName:i,emergencyContactNumber:a,relationship:o}=t;if(i&&["Spouse","Child","Father","Mother"].includes(o)){const c=s.find(d=>d.name.toLowerCase()===i.toLowerCase()&&d.relation===o);if(c){if(c.phone!==a){const d=s.map(h=>h.id===c.id?{...h,phone:a}:h);return{data:{...e.data,family:d}}}}else{const d={id:`fam_emergency_${Date.now()}`,name:i,relation:o,phone:a,dob:"",gender:"",dependent:!1,idProof:null,occupation:""};return{data:{...e.data,family:[...s,d]}}}}return e})}));const B6=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),oH=(...n)=>n.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ");var N6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const k6=k.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:a,iconNode:o,...l},c)=>k.createElement("svg",{ref:c,...N6,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:oH("lucide",i),...l},[...o.map(([d,h])=>k.createElement(d,h)),...Array.isArray(a)?a:[a]]));const Xe=(n,e)=>{const t=k.forwardRef(({className:s,...i},a)=>k.createElement(k6,{ref:a,iconNode:e,className:oH(`lucide-${B6(n)}`,s),...i}));return t.displayName=`${n}`,t};const sm=Xe("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);const R6=Xe("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);const Ri=Xe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const W6=Xe("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const V6=Xe("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const _6=Xe("Badge",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]]);const j6=Xe("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const X6=Xe("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const Mu=Xe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const J6=Xe("BriefcaseBusiness",[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2",key:"1ksdt3"}],["path",{d:"M22 13a18.15 18.15 0 0 1-20 0",key:"12hx5q"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const lH=Xe("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);const oa=Xe("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);const Y6=Xe("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);const F6=Xe("CalendarCheck2",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 14V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"bce9hv"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m16 20 2 2 4-4",key:"13tcca"}]]);const M6=Xe("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);const H6=Xe("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);const T6=Xe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const ra=Xe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);const dG=Xe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const E6=Xe("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);const Rl=Xe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const kg=Xe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const xp=Xe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const Hu=Xe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);const D6=Xe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const L6=Xe("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);const P6=Xe("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);const gG=Xe("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Gi=Xe("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const N2=Xe("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const k2=Xe("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const K6=Xe("CircleUserRound",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);const Gm=Xe("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const cH=Xe("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);const uG=Xe("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);const jo=Xe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const O6=Xe("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);const dH=Xe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);const z6=Xe("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);const gZ=Xe("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);const si=Xe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);const U6=Xe("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const Q6=Xe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);const jl=Xe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const q6=Xe("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);const $6=Xe("FileDigit",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["rect",{width:"4",height:"6",x:"2",y:"12",rx:"2",key:"jm304g"}],["path",{d:"M10 12h2v6",key:"12zw74"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);const gH=Xe("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);const uZ=Xe("FilePenLine",[["path",{d:"m18 5-3-3H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"h0fsxq"}],["path",{d:"M8 18h1",key:"13wk12"}],["path",{d:"M18.4 9.6a2 2 0 1 1 3 3L17 17l-4 1 1-4Z",key:"dyo8mm"}]]);const Cr=Xe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const e$=Xe("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);const t$=Xe("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);const n$=Xe("Files",[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]]);const uH=Xe("Fingerprint",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);const R2=Xe("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);const s$=Xe("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);const r$=Xe("GitPullRequest",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]]);const hH=Xe("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const i$=Xe("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6h0",key:"1uc279"}],["path",{d:"M14 6h0a6 6 0 0 1 6 6v3",key:"1j9mnm"}]]);const hG=Xe("HeartPulse",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]]);const mG=Xe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);const a$=Xe("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);const mH=Xe("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const Xl=Xe("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);const fg=Xe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const o$=Xe("Laptop",[["path",{d:"M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.9 1.45H3.62a1 1 0 0 1-.9-1.45L4 16",key:"tarvll"}]]);const IH=Xe("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);const Pf=Xe("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]);const IG=Xe("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);const l$=Xe("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const xt=Xe("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);const hZ=Xe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);const Kf=Xe("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);const No=Xe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const CH=Xe("MailCheck",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);const th=Xe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const Bi=Xe("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const fH=Xe("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);const mZ=Xe("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const W2=Xe("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);const Bm=Xe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);const c$=Xe("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);const d$=Xe("MousePointerClick",[["path",{d:"m9 9 5 12 1.8-5.2L21 14Z",key:"1b76lo"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}]]);const g$=Xe("MoveRight",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]);const IZ=Xe("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);const u$=Xe("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);const h$=Xe("PackagePlus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);const Tu=Xe("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);const m$=Xe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const I$=Xe("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);const Eu=Xe("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);const pH=Xe("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]);const C$=Xe("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);const Tt=Xe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Du=Xe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const f$=Xe("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);const fr=Xe("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const la=Xe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);const CG=Xe("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);const Lm=Xe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const AH=Xe("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);const Nm=Xe("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const bH=Xe("ShieldHalf",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 22V2",key:"zs6s6o"}]]);const p$=Xe("ShieldPlus",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]]);const km=Xe("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Lu=Xe("Shirt",[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]]);const yH=Xe("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);const Rm=Xe("SquareCheckBig",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);const ms=Xe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);const vH=Xe("SquareX",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const xH=Xe("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);const SH=Xe("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);const wH=Xe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);const A$=Xe("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);const b$=Xe("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);const rn=Xe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const V2=Xe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);const ca=Xe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const td=Xe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);const Sg=Xe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);const nd=Xe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);const Of=Xe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);const Jl=Xe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const Ni=Xe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);const ZH=Xe("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);const GH=Xe("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);const Zi=Xe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);const y$=Xe("ZapOff",[["path",{d:"M10.513 4.856 13.12 2.17a.5.5 0 0 1 .86.46l-1.377 4.317",key:"193nxd"}],["path",{d:"M15.656 10H20a1 1 0 0 1 .78 1.63l-1.72 1.773",key:"27a7lr"}],["path",{d:"M16.273 16.273 10.88 21.83a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4a1 1 0 0 1-.78-1.63l4.507-4.643",key:"1e0qe9"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const CZ=Xe("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);const fG=Xe("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);const pG=Xe("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),da=({className:n="",localPath:e})=>{const{colorScheme:t}=an(),{currentLogo:s}=Dm();return s?r.jsx("img",{src:s,alt:"Logo",className:`object-contain ${n}`}):null},_2={green:{id:"green",label:"Paradigm Green",isDark:!1,colors:{sidebarBg:"#041b0f",sidebarBorder:"#1f3d2b",activeItemBg:"#006B3F",activeItemText:"#ffffff",mobileBg:"#041b0f",primary:"#22c55e",secondary:"#1f3d2b"}},purple:{id:"purple",label:"Royal Purple",isDark:!1,colors:{sidebarBg:"#3B0764",sidebarBorder:"#4C1D95",activeItemBg:"#5B21B6",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#5B21B6",secondary:"#E9D5FF"}},red:{id:"red",label:"Crimson Red",isDark:!1,colors:{sidebarBg:"#450A0A",sidebarBorder:"#7F1D1D",activeItemBg:"#991B1B",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#991B1B",secondary:"#FECACA"}},amber:{id:"amber",label:"Amber Gold",isDark:!1,colors:{sidebarBg:"#451A03",sidebarBorder:"#92400E",activeItemBg:"#B45309",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#B45309",secondary:"#FDE68A"}},"professional-blue":{id:"professional-blue",label:"Professional Blue",isDark:!1,colors:{sidebarBg:"#172554",sidebarBorder:"#1E3A8A",activeItemBg:"#2563EB",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#2563EB",secondary:"#BFDBFE"}},"dark-saas":{id:"dark-saas",label:"Dark SaaS",isDark:!0,colors:{sidebarBg:"#020617",sidebarBorder:"#1E293B",activeItemBg:"#22D3EE",activeItemText:"#020617",mobileBg:"#020617",primary:"#22D3EE",secondary:"#1E293B"}},"teal-mint":{id:"teal-mint",label:"Teal & Mint",isDark:!1,colors:{sidebarBg:"#042F2E",sidebarBorder:"#115E59",activeItemBg:"#0D9488",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#0D9488",secondary:"#99F6E4"}},"indigo-violet":{id:"indigo-violet",label:"Indigo & Violet",isDark:!1,colors:{sidebarBg:"#1E1B4B",sidebarBorder:"#3730A3",activeItemBg:"#4F46E5",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#4F46E5",secondary:"#C7D2FE"}},"green-finance":{id:"green-finance",label:"Green Finance",isDark:!1,colors:{sidebarBg:"#052E16",sidebarBorder:"#065F46",activeItemBg:"#15803D",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#15803D",secondary:"#BBF7D0"}},"orange-energy":{id:"orange-energy",label:"Orange Energy",isDark:!1,colors:{sidebarBg:"#431407",sidebarBorder:"#9A3412",activeItemBg:"#EA580C",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#EA580C",secondary:"#FED7AA"}},"red-alert":{id:"red-alert",label:"Red Alert",isDark:!1,colors:{sidebarBg:"#450A0A",sidebarBorder:"#7F1D1D",activeItemBg:"#DC2626",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#DC2626",secondary:"#FECACA"}},"neutral-gray":{id:"neutral-gray",label:"Neutral Gray",isDark:!1,colors:{sidebarBg:"#111827",sidebarBorder:"#374151",activeItemBg:"#374151",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#374151",secondary:"#E5E7EB"}},"cyan-tech":{id:"cyan-tech",label:"Cyan Tech",isDark:!1,colors:{sidebarBg:"#083344",sidebarBorder:"#155E75",activeItemBg:"#0891B2",activeItemText:"#ffffff",mobileBg:"#ffffff",primary:"#0891B2",secondary:"#A5F3FC"}},"black-gold":{id:"black-gold",label:"Premium Black & Gold",isDark:!0,colors:{sidebarBg:"#020617",sidebarBorder:"#FACC15",activeItemBg:"#FACC15",activeItemText:"#000000",mobileBg:"#0B0F19",primary:"#FACC15",secondary:"#1F2937"}}},Is=n=>{const e=_2[n]||_2.green;return{...e.colors,isDark:e.isDark}},se=({children:n,className:e="",variant:t="primary",size:s="md",isLoading:i=!1,...a})=>{const l=`btn-${t}`,c=`btn-${s}`,{colorScheme:d}=an(),h=Is(d),m=()=>t==="primary"?{backgroundColor:h.activeItemBg,borderColor:h.sidebarBorder,color:"#FFFFFF"}:t==="outline"?{borderColor:h.primary,color:h.primary}:{};return r.jsx("button",{className:`btn ${l} ${c} ${e}`,disabled:i||a.disabled,style:{...m(),...a.style},...a,children:i?r.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):n})},BH=ga(Ng(n=>({autoClickOnHover:!0,autoScrollOnHover:!0,setAutoClickOnHover:e=>n({autoClickOnHover:e}),setAutoScrollOnHover:e=>n({autoScrollOnHover:e})}),{name:"paradigm-ui-settings",storage:cd(()=>localStorage)})),Sp=ga((n,e)=>({notifications:[],unreadCount:0,isLoading:!1,error:null,fetchNotifications:async()=>{const t=bt.getState().user;if(t){n({isLoading:!0,error:null});try{const s=await ce.getNotifications(t.id),i=s.filter(a=>!a.isRead).length;n({notifications:s,unreadCount:i,isLoading:!1})}catch{n({error:"Failed to fetch notifications.",isLoading:!1})}}},markAsRead:async t=>{const s=e().notifications.find(i=>i.id===t);if(!(s&&s.isRead))try{await ce.markNotificationAsRead(t),n(i=>({notifications:i.notifications.map(a=>a.id===t?{...a,isRead:!0}:a),unreadCount:Math.max(0,i.unreadCount-1)}))}catch(i){console.error("Failed to mark notification as read",i)}},markAllAsRead:async()=>{const t=bt.getState().user;if(t&&e().unreadCount!==0)try{await ce.markAllNotificationsAsRead(t.id),n(s=>({notifications:s.notifications.map(i=>({...i,isRead:!0})),unreadCount:0}))}catch(s){console.error("Failed to mark all notifications as read",s)}}})),v$=({type:n})=>{const e={task_assigned:nd,task_escalated:ca,provisional_site_reminder:cH,security:km,info:fg,greeting:wH},t={task_assigned:"text-blue-500 dark:text-blue-400",task_escalated:"text-orange-500 dark:text-orange-400",provisional_site_reminder:"text-purple-500 dark:text-purple-400",security:"text-red-500 dark:text-red-400",info:"text-blue-400 dark:text-blue-300",greeting:"text-yellow-500 dark:text-yellow-400"},s=e[n]||Mu;return r.jsx(s,{className:`h-5 w-5 ${t[n]}`})},x$=({className:n=""})=>{const{notifications:e,unreadCount:t,markAsRead:s,markAllAsRead:i}=Sp(),{colorScheme:a}=an();jt("(max-width: 767px)");const[o,l]=k.useState(!1),c=k.useRef(null),d=k.useRef(null),h=vt();k.useEffect(()=>{const p=b=>{c.current&&!c.current.contains(b.target)&&d.current&&!d.current.contains(b.target)&&l(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const m=p=>{s(p.id),p.linkTo&&h(p.linkTo),l(!1)},f=()=>{i()};return r.jsxs("div",{className:`relative notification-bell ${n}`,children:[r.jsxs("button",{ref:d,onClick:()=>l(!o),className:"btn-icon relative p-2 rounded-full hover:bg-page text-muted","aria-label":`Notifications (${t} unread)`,children:[r.jsx(Mu,{className:"h-5 w-5"}),t>0&&r.jsx("span",{className:"notification-dot absolute top-0 right-0 block h-2.5 w-2.5 rounded-full bg-red-500"})]}),o&&uF.createPortal(r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[90] md:hidden",onClick:()=>l(!1)}),r.jsxs("div",{ref:c,className:"fixed inset-x-4 top-20 bottom-20 z-[100] flex flex-col bg-white dark:!bg-[#0d1f12] rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-800 md:absolute md:inset-auto md:top-16 md:right-4 md:mt-2 md:w-[400px] md:h-auto md:max-h-[600px] md:bottom-auto animate-in fade-in zoom-in-95 duration-200 overflow-hidden",style:{position:window.innerWidth>=768?"absolute":"fixed"},children:[r.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 dark:border-white/10 bg-gray-50 dark:!bg-[#0d1f12]",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-bold text-lg text-gray-900 dark:text-white",children:"Notifications"}),r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:["You have ",t," unread messages"]})]}),r.jsx("div",{className:"flex items-center gap-2",children:t>0&&r.jsx("span",{onClick:f,className:"relative isolate overflow-hidden before:!content-none after:!content-none text-xs h-8 px-4 flex items-center justify-center rounded-3xl !bg-[#32CD32] hover:!bg-[#28a428] !text-[#0D1A0D] !font-bold cursor-pointer transition-colors",style:{backgroundImage:"none"},children:r.jsx("span",{className:"relative z-10",children:"Mark all read"})})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-white dark:!bg-[#0d1f12] dark:[color-scheme:dark]",children:e.slice(0,10).length>0?r.jsx("div",{className:"divide-y divide-gray-100 dark:divide-white/20",children:e.slice(0,10).map(p=>r.jsxs("div",{onClick:()=>m(p),className:`group flex items-start gap-4 p-5 cursor-pointer transition-all duration-200 ${p.isRead?"bg-white dark:!bg-[#0d1f12] hover:bg-gray-50 dark:hover:!bg-[#152b1b]":"bg-emerald-50 dark:!bg-[#0d1f12] hover:bg-emerald-100 dark:hover:!bg-[#152b1b]"}`,children:[r.jsx("div",{className:`flex-shrink-0 p-2.5 rounded-full ${p.isRead?"bg-gray-100 dark:bg-[#1a2e1a]":"bg-white dark:bg-[#1a2e1a] shadow-sm"}`,children:r.jsx(v$,{type:p.type})}),r.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[r.jsx("p",{className:`text-sm font-medium leading-snug mb-1.5 ${p.isRead?"text-gray-600 dark:text-gray-300":"text-gray-900 dark:text-white"}`,children:p.message}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 flex items-center gap-1",children:Vl(new Date(p.createdAt),{addSuffix:!0})})]}),!p.isRead&&r.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 mt-2.5 flex-shrink-0 shadow-[0_0_8px_rgba(16,185,129,0.5)]"})]},p.id))}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center p-8",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-[#1a2e1a] rounded-full flex items-center justify-center mb-4",children:r.jsx(Mu,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),r.jsx("h5",{className:"text-gray-900 dark:text-white font-medium mb-1",children:"No notifications"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"You're all caught up! Check back later."})]})})]})]}),document.body)]})},tr=({isOpen:n,onClose:e,onConfirm:t,title:s,children:i,confirmButtonVariant:a="danger",confirmButtonText:o="Confirm",isConfirming:l=!1,isLoading:c})=>{if(!n)return null;const d=c!==void 0?c:l;return r.jsx("div",{className:"fixed inset-0 z-[999] flex items-center justify-center bg-black bg-opacity-50","aria-modal":"true",role:"dialog",children:r.jsxs("div",{className:"bg-card shadow-card flex flex-col animate-fade-in-scale overflow-hidden w-full h-full sm:w-full sm:h-full sm:max-w-full sm:rounded-none md:w-auto md:h-auto md:max-w-md md:max-h-[90vh] md:rounded-xl",children:[r.jsx("div",{className:"flex-shrink-0 p-6 border-b border-border",children:r.jsx("h3",{className:"text-lg font-bold text-primary-text",children:s})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.jsx("div",{className:"text-sm text-muted",children:i})}),r.jsx("div",{className:"flex-shrink-0 p-6 border-t border-border bg-card",children:r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx(se,{onClick:e,variant:"secondary",disabled:d,children:"Cancel"}),r.jsx(se,{onClick:t,variant:a,isLoading:d,children:o})]})})]})})},S$=({className:n})=>r.jsxs("svg",{viewBox:"0 0 144 144",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:n,children:[r.jsx("circle",{cx:"72",cy:"72",r:"72",fill:"#F0EBE3"}),r.jsx("path",{d:"M109.5 144H34.5C34.5 119.464 51.18 99 72 99C92.82 99 109.5 119.464 109.5 144Z",fill:"white"}),r.jsx("path",{d:"M84 99C84 105.627 78.6274 111 72 111C65.3726 111 60 105.627 60 99H84Z",fill:"#E1C699"}),r.jsx("path",{d:"M96 87C96 70.4315 85.3726 57 72 57C58.6274 57 48 70.4315 48 87H96Z",fill:"#4A4A4A"}),r.jsx("rect",{x:"62",y:"77",width:"5",height:"2",rx:"1",fill:"#2D2D2D"}),r.jsx("rect",{x:"77",y:"77",width:"5",height:"2",rx:"1",fill:"#2D2D2D"})]}),Hb=[S$],ia=({className:n,photoUrl:e,seed:t})=>{const{user:s}=bt();if(e)return r.jsx("img",{src:e,alt:"Profile",className:`object-cover ${n||""}`});const i=t||s?.id;if(!i){const l=Hb[0];return r.jsx(l,{className:`text-muted/60 ${n||""}`})}const a=i.charCodeAt(i.length-1)%Hb.length,o=Hb[a];return r.jsx(o,{className:n||""})},NH=({setIsMobileMenuOpen:n})=>{const{user:e,logout:t}=bt(),{permissions:s}=ha(),{colorScheme:i}=an(),a=vt(),[o,l]=k.useState(!1),[c,d]=k.useState(!1),h=k.useRef(null),m=jt("(max-width: 767px)");er(),k.useEffect(()=>{const v=S=>{h.current&&!h.current.contains(S.target)&&l(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const f=v=>v.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase()),p=()=>{n?.(!1),l(!1),d(!0)},b=async()=>{d(!1),await t(),a("/auth/login",{replace:!0})},x=Is(i);return r.jsxs(r.Fragment,{children:[r.jsx(tr,{isOpen:c,onClose:()=>d(!1),onConfirm:b,title:"Confirm Log Out",children:"Are you sure you want to log out?"}),r.jsx("header",{className:`sticky top-0 z-40 ${m?"":"md:bg-gray-50/50 md:border-gray-200/50"} backdrop-blur-md border-b transition-all duration-200`,style:{paddingTop:"env(safe-area-inset-top)",backgroundColor:m?x.sidebarBg:void 0,borderColor:m?x.sidebarBorder:void 0,color:m?"white":void 0},children:r.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"flex items-center h-16",children:[r.jsx("div",{className:"flex-1 flex justify-center md:justify-start min-w-0 px-2",children:m&&r.jsx("div",{className:"flex items-center justify-center bg-transparent p-2 border-0",children:r.jsx(da,{className:"border-0 h-[52px]"})})}),r.jsx("div",{className:"flex-none flex justify-end w-auto min-w-10",children:r.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[r.jsx(x$,{}),!m&&e&&r.jsxs("div",{className:"relative",ref:h,children:[r.jsxs("button",{onClick:()=>l(!o),className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-page transition-colors","aria-expanded":o,"aria-haspopup":"true",children:[r.jsx(ia,{photoUrl:e.photoUrl,seed:e.id,className:"h-8 w-8 rounded-lg"}),r.jsxs("div",{className:"text-left hidden sm:block",children:[r.jsx("span",{className:"text-sm font-semibold",children:e.name}),r.jsx("span",{className:"text-xs text-muted block",children:f(e.role)})]}),r.jsx(kg,{className:"h-4 w-4 text-muted"})]}),o&&r.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-card rounded-xl shadow-card border border-border py-1 z-40 animate-fade-in-down",role:"menu",children:[r.jsxs(aa,{to:"/profile",onClick:()=>l(!1),className:"flex items-center px-4 py-2 text-sm text-primary-text hover:bg-page",role:"menuitem",children:[r.jsx(Jl,{className:"mr-2 h-4 w-4"}),"Profile"]}),e&&s[e.role]?.includes("apply_for_leave")&&r.jsxs(aa,{to:"/leaves/dashboard",onClick:()=>l(!1),className:"flex items-center px-4 py-2 text-sm text-primary-text hover:bg-page",role:"menuitem",children:[r.jsx(gZ,{className:"mr-2 h-4 w-4"}),"Tracker"]}),r.jsxs("button",{onClick:p,className:"flex items-center w-full text-left px-4 py-2 text-sm text-primary-text hover:bg-page",role:"menuitem",children:[r.jsx(No,{className:"mr-2 h-4 w-4"}),"Log Out"]})]})]})]})})]})})})]})},kH=[{to:"/verification/dashboard",label:"All Submissions",icon:IH,permission:"view_all_submissions"},{to:"/developer/api",label:"API Settings",icon:Lm,permission:"view_developer_settings"},{to:"/attendance/dashboard",label:"Attendance",icon:ra,permission:"view_own_attendance"},{to:"/hr/attendance-settings",label:"Attendance Rules",icon:F6,permission:"manage_attendance_rules"},{to:"/support",label:"Backend Support",icon:Pf,permission:"access_support_desk"},{to:"/hr/entities",label:"Client Management",icon:lH,permission:"view_entity_management"},{to:"/hr/enrollment-rules",label:"Enrollment Rules",icon:cH,permission:"manage_enrollment_rules"},{to:"/hr/policies-and-insurance",label:"Insurance Management",icon:bH,permission:"manage_insurance"},{to:"/billing/summary",label:"Invoice Summary",icon:$6,permission:"view_invoice_summary"},{to:"/billing/cost-analysis",label:"Verification Costing",icon:Xl,permission:"view_verification_costing"},{to:"/admin/approval-workflow",label:"Leave Approval Settings",icon:s$,permission:"manage_approval_workflow"},{to:"/hr/leave-management",label:"Leave Management",icon:r$,permission:"manage_leave_requests"},{to:"/admin/modules",label:"Module Management",icon:h$,permission:"manage_modules"},{to:"/onboarding",label:"New Enrollment",icon:nd,permission:"create_enrollment"},{to:"/operations/dashboard",label:"Operations",icon:J6,permission:"view_operations_dashboard"},{to:"/profile",label:"Profile",icon:Jl,permission:"view_own_attendance"},{to:"/admin/roles",label:"Role Management",icon:Nm,permission:"manage_roles_and_permissions"},{to:"/my-team",label:"My Team",icon:Ni,permission:"view_field_officer_tracking"},{to:"/site/dashboard",label:"Site Dashboard",icon:mG,permission:"view_site_dashboard"},{to:"/admin/sites",label:"Site Management",icon:oa,permission:"manage_sites"},{to:"/tasks",label:"Task Management",icon:IG,permission:"manage_tasks"},{to:"/uniforms",label:"Uniform Management",icon:Lu,permission:"manage_uniforms"},{to:"/admin/users",label:"User Management",icon:Ni,permission:"manage_users"},{to:"/admin/patrol/dashboard",label:"Patrol Dashboard",icon:uG,permission:"manage_approval_workflow"},{to:"/hr/field-officer-tracking",label:"User Activity Tracking",icon:fH,permission:"view_field_officer_tracking"},{to:"/hr/locations",label:"Geo Locations",icon:Bi,permission:"manage_attendance_rules"},{to:"/attendance/locations",label:"My Locations",icon:IZ,permission:"view_own_attendance"},{to:"/patrol/scan",label:"Patrol Scanner",icon:Nm,permission:"view_developer_settings"}],w$=({isCollapsed:n,onLinkClick:e,onExpand:t,hideHeader:s=!1,mode:i="light",isMobile:a=!1})=>{const{user:o}=bt(),{permissions:l}=ha(),{colorScheme:c}=an(),{currentLogo:d}=Dm();er();const h=d&&d!==nm,m=o?kH.filter(b=>l[o.role]?.includes(b.permission)).sort((b,x)=>b.label.localeCompare(x.label)):[],f=Is(c),p=b=>{if(a&&n&&t){b.preventDefault(),t();return}e&&e()};return r.jsxs("div",{className:"flex flex-col",children:[s&&n&&r.jsx("div",{className:"p-4 border-b flex justify-center h-16 items-center transition-all duration-300 flex-shrink-0",style:{borderColor:f.sidebarBorder,backgroundColor:f.sidebarBg},children:r.jsxs("button",{onClick:()=>window.location.href="/#/profile",className:"btn-icon inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-white/10 focus:outline-none","aria-label":"Go to profile page",children:[r.jsx("span",{className:"sr-only",children:"Go to profile"}),r.jsx(Ri,{className:"block h-6 w-6"})]})}),s&&!n&&r.jsx("div",{className:"p-4 border-b flex justify-center h-16 items-center transition-all duration-300 flex-shrink-0",style:{borderColor:f.sidebarBorder,backgroundColor:f.sidebarBg}}),!s&&r.jsx("div",{className:"p-4 border-b border-gray-200 bg-white flex justify-center h-16 items-center transition-all duration-300 flex-shrink-0 overlay-hidden",children:n?r.jsx("div",{className:"h-8 w-8 overflow-hidden flex items-center justify-center",children:h?r.jsx("img",{src:d,alt:"Logo",className:"h-8 w-auto object-contain"}):r.jsx(da,{className:"h-8 max-w-none object-left object-cover"})}):h?r.jsx("img",{src:d,alt:"Logo",className:"h-14 lg:h-16 w-auto object-contain"}):r.jsx(da,{className:"h-14 lg:h-16"})}),r.jsx("nav",{className:"px-3 py-4 space-y-1.5",children:m.map(b=>r.jsx(SF,{to:b.to,onClick:p,className:({isActive:x})=>`group flex items-center px-3 py-3 rounded-xl text-sm font-medium transition-all duration-200 ease-in-out ${n?"justify-center":""} ${i==="light"?x?"!text-white shadow-sm border bg-accent":"text-slate-700 hover:bg-gray-100 hover:text-slate-900":x?"!text-white shadow-sm border border-white/5":"text-white hover:bg-white/10 hover:text-white"} ${x&&i==="light"?"nav-active-white":""}`,style:({isActive:x})=>x?i==="light"?{backgroundColor:f.activeItemBg,borderColor:f.sidebarBorder,color:"#ffffff"}:{backgroundColor:f.activeItemBg,color:f.activeItemText}:{},title:b.label,children:({isActive:x})=>r.jsxs(r.Fragment,{children:[r.jsx(b.icon,{className:`h-5 w-5 flex-shrink-0 transition-colors duration-200 ${i==="light"?x?"text-white":"text-slate-500 group-hover:text-slate-700":x?"text-white":"text-white group-hover:text-white"} ${n?"":"mr-3"}`}),!n&&r.jsx("span",{className:x&&i==="light"?"!text-white":"",style:x&&i==="light"?{color:"#ffffff"}:{},children:b.label})]})},b.to))}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .nav-active-white,
                .nav-active-white *,
                a[aria-current="page"] span,
                a[aria-current="page"] svg {
                    color: #ffffff !important;
                }
            `}})]})},Z$=()=>{const{user:n}=bt(),{fetchNotifications:e}=Sp(),{permissions:t}=ha(),{autoScrollOnHover:s}=BH(),{colorScheme:i}=an();er();const a=jt("(max-width: 767px)"),o=k.useRef(null),l=k.useRef(null),[c,d]=k.useState(!0),[h,m]=k.useState(0),[f,p]=k.useState(!1);k.useEffect(()=>{d(a)},[a]);const b=k.useCallback(()=>{l.current!==null&&(clearInterval(l.current),l.current=null)},[]),x=k.useCallback(S=>{b();const B=o.current;if(!B)return;const V=()=>{B.scrollBy({top:S==="up"?-window.innerHeight*.8:window.innerHeight*.8,behavior:"smooth"})};V(),l.current=window.setInterval(V,300)},[b]);if(k.useEffect(()=>{const S=()=>{const V=o.current;V&&(p(V.scrollHeight>V.clientHeight),m(V.scrollTop))},B=o.current;return B?.addEventListener("scroll",S,{passive:!0}),window.addEventListener("resize",S),S(),()=>{B?.removeEventListener("scroll",S),window.removeEventListener("resize",S),b()}},[b]),k.useEffect(()=>{n&&e()},[n,e]),!n)return r.jsx(Bl,{to:"/auth/login",replace:!0});const v=Is(i);return r.jsxs("div",{className:`flex min-h-screen ${a?v.mobileBg:"bg-page"} ${a?"":"p-4 md:p-6 lg:p-8 gap-4 md:gap-6 lg:gap-8"}`,style:a&&v.isDark?{backgroundColor:v.mobileBg}:{},children:[a&&!c&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-20 transition-opacity duration-300",onClick:()=>d(!0)}),r.jsxs("aside",{className:`flex flex-col flex-shrink-0 transition-all duration-300 ease-in-out ${a?c?"w-16":"w-64":c?"w-20":"w-72"} ${a?"border-r":"bg-white border-r border-gray-200/60"} ${a?"fixed left-0 top-0 bottom-0 z-50":""}`,style:a?{backgroundColor:v.sidebarBg,borderRightColor:v.sidebarBorder}:void 0,children:[r.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:r.jsx(w$,{isCollapsed:c,mode:a?"dark":"light",onLinkClick:a?()=>d(!0):void 0,onExpand:()=>d(!1),hideHeader:a,isMobile:a})}),r.jsx("div",{className:`flex-shrink-0 px-2 pt-2 mt-auto flex items-center ${a?"border-t":"border-t border-border"}`,style:a?{borderColor:v.sidebarBorder}:void 0,children:r.jsx("button",{onClick:()=>d(!c),className:`flex-1 flex items-center justify-center p-2 rounded-lg transition-colors ${a?"text-white/70 hover:bg-white/10":"text-muted hover:bg-page"}`,title:c?"Expand sidebar":"Collapse sidebar",children:c?r.jsx(P6,{className:"h-5 w-5"}):r.jsx(L6,{className:"h-5 w-5"})})})]}),r.jsxs("div",{className:`flex-1 flex flex-col ${a?"":"bg-gray-50/50"} ${a&&c?"ml-16":""}`,style:a?{backgroundColor:v.mobileBg}:void 0,children:[r.jsx(NH,{}),r.jsx("main",{ref:o,className:`flex-1 overflow-y-auto ${a?"":"bg-page"}`,style:a&&v.isDark?{backgroundColor:v.mobileBg}:void 0,children:r.jsx("div",{className:"p-4",children:r.jsx(Nu,{})})})]}),f&&!a&&r.jsxs("div",{className:"fixed bottom-8 right-8 z-50 flex flex-col gap-2 no-print",children:[r.jsx(se,{variant:"secondary",size:"sm",className:"!rounded-full !p-2 shadow-lg",onMouseEnter:s?()=>x("up"):void 0,onMouseLeave:b,onMouseDown:()=>x("up"),onMouseUp:b,onTouchStart:()=>x("up"),onTouchEnd:b,disabled:h<=0,"aria-label":"Scroll Up",children:r.jsx(D6,{className:"h-5 w-5"})}),r.jsx(se,{variant:"secondary",size:"sm",className:"!rounded-full !p-2 shadow-lg",onMouseEnter:s?()=>x("down"):void 0,onMouseLeave:b,onMouseDown:()=>x("down"),onMouseUp:b,onTouchStart:()=>x("down"),onTouchEnd:b,disabled:o.current?Math.ceil(o.current.clientHeight+h)>=o.current.scrollHeight:!1,"aria-label":"Scroll Down",children:r.jsx(kg,{className:"h-5 w-5"})})]})]})},G$=()=>{const{user:n}=bt(),{permissions:e}=ha(),{colorScheme:t}=an();if(!n)return null;const s=e[n.role]||[],i=[{to:"/mobile-home",label:"Home",icon:mG,show:!0},{to:"/attendance/dashboard",label:"Attendance",icon:M6,show:s.includes("view_own_attendance")},{to:"/tasks",label:"Tasks",icon:IG,show:s.includes("manage_tasks")},{to:"/profile",label:"Profile",icon:Jl,show:!0}],a=t!=="green"?{bg:"#FFFFFF",border:"#e2e8f0",activeText:"#1a3a6e",inactiveText:"text-slate-400"}:{bg:"#041b0f",border:"#1f3d2b",activeText:"#22c55e",inactiveText:"text-gray-400"};return r.jsx("nav",{id:"mobile-bottom-nav",className:"fixed bottom-0 left-0 right-0 z-40 transition-colors duration-300",style:{paddingBottom:"env(safe-area-inset-bottom)",backgroundColor:a.bg,borderTopColor:a.border,borderTopWidth:"1px"},children:r.jsx("div",{className:"flex justify-around items-center h-16",children:i.filter(o=>o.show).map(o=>r.jsxs(SF,{to:o.to,className:({isActive:l})=>`flex flex-col items-center justify-center flex-1 h-full transition-colors ${l?"":a.inactiveText}`,style:({isActive:l})=>l?{color:a.activeText}:{},children:[r.jsx(o.icon,{className:"w-6 h-6"}),r.jsx("span",{className:"text-xs mt-1",children:o.label})]},o.to))})})},B$=()=>{const{colorScheme:n}=an(),[e,t]=k.useState(!0),s=k.useRef(0),i=k.useRef(!1);k.useEffect(()=>{const o=()=>{i.current||(window.requestAnimationFrame(()=>{const l=window.scrollY;l<s.current||l<10?t(!0):l>s.current&&l>10&&t(!1),s.current=l,i.current=!1}),i.current=!0)};return window.addEventListener("scroll",o,{passive:!0}),()=>window.removeEventListener("scroll",o)},[]);const a=Is(n);return r.jsxs("div",{className:"flex flex-col min-h-screen",style:{backgroundColor:a.mobileBg},children:[r.jsx("div",{className:`sticky top-0 z-50 transition-transform duration-200 ${e?"translate-y-0":"-translate-y-full"}`,children:r.jsx(NH,{})}),r.jsx("main",{className:"flex-1 overflow-y-auto px-4 pt-2",style:{paddingBottom:"calc(9.1rem + env(safe-area-inset-bottom))",backgroundColor:a.mobileBg},children:r.jsx(Nu,{})}),r.jsx(G$,{})]})},N$=["https://picsum.photos/seed/corporate_campus/1200/900","https://picsum.photos/seed/luxury_complex/1200/900","https://picsum.photos/seed/office_interior/1200/900","https://picsum.photos/seed/landscaping/1200/900","https://picsum.photos/seed/lobby_design/1200/900"],RH=ga(Ng((n,e)=>({backgroundImages:N$,addBackgroundImage:t=>{const s=e();return s.backgroundImages.includes(t)?!1:(n({backgroundImages:[...s.backgroundImages,t]}),!0)},removeBackgroundImage:t=>n(s=>({backgroundImages:s.backgroundImages.filter((i,a)=>a!==t)}))}),{name:"paradigm-auth-layout-settings",storage:cd(()=>localStorage)})),k$=()=>{const{backgroundImages:n}=RH(),[e,t]=k.useState(0),s=er();k.useEffect(()=>{if(n.length>1){const o=setInterval(()=>{t(l=>(l+1)%n.length)},5e3);return()=>clearInterval(o)}},[n.length]);const i=k.useMemo(()=>n&&n.length>0?n:["https://picsum.photos/seed/default_fallback_1/1200/900"],[n]),a=k.useMemo(()=>s.pathname.includes("signup")?{title:"Create an Account",subtitle:"Join our platform to get started."}:s.pathname.includes("forgot-password")?{title:"Forgot Password?",subtitle:"No worries, we'll send you reset instructions."}:s.pathname.includes("update-password")?{title:"Set a New Password",subtitle:"Please enter your new password."}:{title:"Sign In",subtitle:"Enter your credentials to access your account."},[s.pathname]);return r.jsxs("div",{className:"min-h-screen font-sans flex items-center justify-center bg-page relative overflow-hidden",children:[r.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[i.map((o,l)=>r.jsx("div",{className:`absolute inset-0 w-full h-full bg-cover bg-center transition-opacity duration-1000 ease-in-out ${l===e?"opacity-100":"opacity-0"}`,style:{backgroundImage:`url(${o})`}},l)),r.jsx("div",{className:"absolute inset-0 bg-black/30"})," "]}),r.jsx("div",{className:"relative w-full max-w-3xl lg:max-w-4xl xl:max-w-5xl p-4",children:r.jsxs("div",{className:"auth-card-container w-full grid md:grid-cols-2 rounded-2xl shadow-2xl overflow-hidden backdrop-blur-md bg-black/40 border border-white/10",children:[r.jsxs("div",{className:"hidden md:flex flex-col justify-between p-6 lg:p-10 xl:p-16 bg-gradient-to-br from-black/40 to-black/70",children:[r.jsxs("div",{className:"flex flex-col items-center text-center",children:[r.jsx(da,{className:"h-10 lg:h-14 xl:h-24"}),r.jsx("h1",{className:"text-xl lg:text-2xl xl:text-4xl font-bold !text-white mt-6 lg:mt-8 leading-tight drop-shadow-lg relative z-10",style:{color:"#ffffff",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:"Welcome to the Future of Onboarding."}),r.jsx("p",{className:"!text-white mt-4 max-w-md drop-shadow-lg text-xs lg:text-sm xl:text-base relative z-10",style:{color:"#ffffff",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"Streamlining the journey for every new member of the Southwall family."})]}),r.jsx("div",{children:r.jsxs("p",{className:"!text-white text-[10px] lg:text-xs mt-4",style:{color:"#ffffff"},children:[" ",new Date().getFullYear()," Southwall Security. All rights reserved."]})})]}),r.jsx("div",{className:"p-6 lg:p-10 xl:p-16 flex flex-col justify-center bg-[#050505]/85 backdrop-blur-xl border-l border-white/10 !text-white",children:r.jsxs("div",{className:"w-full max-w-md mx-auto",children:[r.jsx("div",{className:"md:hidden flex justify-center mb-8",children:r.jsx(da,{className:"h-12"})}),r.jsx("h2",{className:"text-xl lg:text-2xl xl:text-3xl font-bold !text-white mb-2",style:{color:"#ffffff"},children:a.title}),r.jsx("p",{className:"!text-white mb-4 lg:mb-6 xl:mb-8 text-xs lg:text-sm xl:text-base",style:{color:"#ffffff"},children:a.subtitle}),r.jsx(Nu,{})]})})]})})]})};function R$(){const[n,e]=k.useState({isSecure:!0,issues:[],developerModeEnabled:!1,locationSpoofingDetected:!1});return k.useEffect(()=>{const t=()=>{const i=[];let a=!1,o=!1;("geolocation"in navigator,!1)&&(o=!0,i.push("Location spoofing detected. Please disable location mocking apps to continue."));const c=i.length===0;e({isSecure:c,issues:i,developerModeEnabled:a,locationSpoofingDetected:o})};t();const s=setInterval(t,2e3);return window.addEventListener("resize",t),()=>{clearInterval(s),window.removeEventListener("resize",t)}},[]),n}const W$=({issues:n,onDismiss:e})=>{const[t,s]=k.useState(!1);return k.useEffect(()=>{const i=()=>{s(window.innerWidth<768)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),t?r.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-y-auto",children:r.jsxs("div",{className:"min-h-screen p-4 flex flex-col",children:[r.jsx("div",{className:"flex justify-center mt-8 mb-6",children:r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(km,{className:"w-8 h-8 text-red-600"})})}),r.jsx("h2",{className:"text-xl font-bold text-center text-gray-900 mb-4",children:"Security Warning"}),r.jsxs("div",{className:"space-y-3 mb-4",children:[r.jsx("p",{className:"text-gray-700 text-center text-sm",children:"Access to this application has been temporarily blocked for security reasons:"}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:r.jsx("ul",{className:"space-y-2",children:n.map((i,a)=>r.jsxs("li",{className:"flex items-start gap-2 text-xs text-red-800",children:[r.jsx(ca,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:i})]},a))})})]}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[r.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-sm",children:"To continue:"}),r.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-xs text-blue-800",children:[r.jsx("li",{children:"Close browser developer tools (F12)"}),r.jsx("li",{children:"Disable any location spoofing apps or extensions"}),r.jsx("li",{children:"Refresh this page"})]})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:r.jsx("p",{className:"text-xs text-yellow-800 text-center",children:" Your reporting manager has been notified of this security alert."})}),e&&r.jsx(se,{onClick:e,variant:"outline",className:"w-full mt-auto",size:"sm",children:"I Understand"})]})}):r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:r.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 animate-in fade-in zoom-in duration-300",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(km,{className:"w-10 h-10 text-red-600"})})}),r.jsx("h2",{className:"text-2xl font-bold text-center text-gray-900 mb-4",children:"Security Warning"}),r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsx("p",{className:"text-gray-700 text-center",children:"Access to this application has been temporarily blocked for security reasons:"}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsx("ul",{className:"space-y-2",children:n.map((i,a)=>r.jsxs("li",{className:"flex items-start gap-2 text-sm text-red-800",children:[r.jsx(ca,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),r.jsx("span",{children:i})]},a))})})]}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[r.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"To continue:"}),r.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-blue-800",children:[r.jsx("li",{children:"Close browser developer tools (F12)"}),r.jsx("li",{children:"Disable any location spoofing apps or extensions"}),r.jsx("li",{children:"Refresh this page"})]})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:r.jsx("p",{className:"text-xs text-yellow-800 text-center",children:" Your reporting manager has been notified of this security alert."})}),e&&r.jsx(se,{onClick:e,variant:"outline",className:"w-full",children:"I Understand"})]})})},V$=({children:n})=>{const{user:e}=bt(),t=R$(),[s,i]=k.useState(!1),a=e&&(e.role==="admin"||e.role==="developer");return k.useEffect(()=>{if(e&&!a&&!t.isSecure&&!s){const o=t.developerModeEnabled?"developer_mode":"location_spoofing";ce.sendSecurityAlert(e.id,e.name,o,void 0).catch(l=>console.error("Failed to send security alert:",l)),i(!0)}},[e,t,s,a]),e&&!a&&!t.isSecure?r.jsx(W$,{issues:t.issues}):r.jsx(r.Fragment,{children:n})};var Pu;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Pu||(Pu={}));class Su extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const _$=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},j$=n=>{const e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},s=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:_$(n),a=()=>i()!=="web",o=m=>{const f=d.get(m);return!!(f?.platforms.has(i())||l(m))},l=m=>{var f;return(f=t.PluginHeaders)===null||f===void 0?void 0:f.find(p=>p.name===m)},c=m=>n.console.error(m),d=new Map,h=(m,f={})=>{const p=d.get(m);if(p)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),p.proxy;const b=i(),x=l(m);let v;const S=async()=>(!v&&b in f?v=typeof f[b]=="function"?v=await f[b]():v=f[b]:e!==null&&!v&&"web"in f&&(v=typeof f.web=="function"?v=await f.web():v=f.web),v),B=(j,M)=>{var H,D;if(x){const z=x?.methods.find(O=>M===O.name);if(z)return z.rtype==="promise"?O=>t.nativePromise(m,M.toString(),O):(O,E)=>t.nativeCallback(m,M.toString(),O,E);if(j)return(H=j[M])===null||H===void 0?void 0:H.bind(j)}else{if(j)return(D=j[M])===null||D===void 0?void 0:D.bind(j);throw new Su(`"${m}" plugin is not implemented on ${b}`,Pu.Unimplemented)}},V=j=>{let M;const H=(...D)=>{const z=S().then(O=>{const E=B(O,j);if(E){const te=E(...D);return M=te?.remove,te}else throw new Su(`"${m}.${j}()" is not implemented on ${b}`,Pu.Unimplemented)});return j==="addListener"&&(z.remove=async()=>M()),z};return H.toString=()=>`${j.toString()}() { [capacitor code] }`,Object.defineProperty(H,"name",{value:j,writable:!1,configurable:!1}),H},R=V("addListener"),W=V("removeListener"),_=(j,M)=>{const H=R({eventName:j},M),D=async()=>{const O=await H;W({eventName:j,callbackId:O},M)},z=new Promise(O=>H.then(()=>O({remove:D})));return z.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await D()},z},Y=new Proxy({},{get(j,M){switch(M){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?_:R;case"removeListener":return W;default:return V(M)}}});return s[m]=Y,d.set(m,{name:m,proxy:Y,platforms:new Set([...Object.keys(f),...x?[b]:[]])}),Y};return t.convertFileSrc||(t.convertFileSrc=m=>m),t.getPlatform=i,t.handleError=c,t.isNativePlatform=a,t.isPluginAvailable=o,t.registerPlugin=h,t.Exception=Su,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},X$=n=>n.Capacitor=j$(n),zf=X$(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),gd=zf.registerPlugin;class AG{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),s&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const i=this.listeners[e];if(!i){if(s){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}i.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new zf.Exception(e,Pu.Unimplemented)}unavailable(e="not available"){return new zf.Exception(e,Pu.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}}const j2=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),X2=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class J$ extends AG{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,a]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=X2(i).trim(),a=X2(a).trim(),t[i]=a}),t}async setCookie(e){try{const t=j2(e.key),s=j2(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${a}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}gd("CapacitorCookies",{web:()=>new J$});const Y$=async n=>new Promise((e,t)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(n)}),F$=(n={})=>{const e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,a,o)=>(i[a]=n[e[o]],i),{})},M$=(n,e=!0)=>n?Object.entries(n).reduce((s,i)=>{const[a,o]=i;let l,c;return Array.isArray(o)?(c="",o.forEach(d=>{l=e?encodeURIComponent(d):d,c+=`${a}=${l}&`}),c.slice(0,-1)):(l=e?encodeURIComponent(o):o,c=`${a}=${l}`),`${s}&${c}`},"").substr(1):null,H$=(n,e={})=>{const t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=F$(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[o,l]of Object.entries(n.data||{}))a.set(o,l);t.body=a.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){const a=new FormData;if(n.data instanceof FormData)n.data.forEach((l,c)=>{a.append(c,l)});else for(const l of Object.keys(n.data))a.append(l,n.data[l]);t.body=a;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t};class T$ extends AG{async request(e){const t=H$(e,e.webFetchExtra),s=M$(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,a=await fetch(i,t),o=a.headers.get("content-type")||"";let{responseType:l="text"}=a.ok?e:{};o.includes("application/json")&&(l="json");let c,d;switch(l){case"arraybuffer":case"blob":d=await a.blob(),c=await Y$(d);break;case"json":c=await a.json();break;case"document":case"text":default:c=await a.text()}const h={};return a.headers.forEach((m,f)=>{h[f]=m}),{data:c,headers:h,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}gd("CapacitorHttp",{web:()=>new T$});function E$(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(s,i){return(a,o,l)=>{const c=n.Capacitor.Plugins[t];if(c===void 0){l(new Error(`Capacitor plugin ${t} not found`));return}if(typeof c[i]!="function"){l(new Error(`Method ${i} not found in Capacitor plugin ${t}`));return}(async()=>{try{const d=await c[i](a);o(d)}catch(d){l(d)}})()}}})}})}function D$(n){n.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return n.cordova.plugins[t]}})}function WH(n=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!n?E$(window):window.cordova!==void 0&&D$(window))}const bG=gd("Geolocation",{web:()=>Ru(()=>import("./web-Bk-hmn5J.js"),[],import.meta.url).then(n=>new n.GeolocationWeb)});WH();var pu;(function(n){n.Prompt="PROMPT",n.Camera="CAMERA",n.Photos="PHOTOS"})(pu||(pu={}));var um;(function(n){n.Rear="REAR",n.Front="FRONT"})(um||(um={}));var J2;(function(n){n.Uri="uri",n.Base64="base64",n.DataUrl="dataUrl"})(J2||(J2={}));class L$ extends AG{async getPhoto(e){return new Promise(async(t,s)=>{if(e.webUseInput||e.source===pu.Photos)this.fileInputExperience(e,t,s);else if(e.source===pu.Prompt){let i=document.querySelector("pwa-action-sheet");i||(i=document.createElement("pwa-action-sheet"),document.body.appendChild(i)),i.header=e.promptLabelHeader||"Photo",i.cancelable=!1,i.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],i.addEventListener("onSelection",async a=>{a.detail===0?this.fileInputExperience(e,t,s):this.cameraExperience(e,t,s)})}else this.cameraExperience(e,t,s)})}async pickImages(e){return new Promise(async(t,s)=>{this.multipleFileInputExperience(t,s)})}async cameraExperience(e,t,s){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===um.Front?"user":"environment",document.body.appendChild(i);try{await i.componentOnReady(),i.addEventListener("onPhoto",async a=>{const o=a.detail;o===null?s(new Su("User cancelled photos app")):o instanceof Error?s(o):t(await this._getCameraPhoto(o,e)),i.dismiss(),document.body.removeChild(i)}),i.present()}catch{this.fileInputExperience(e,t,s)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,s)}fileInputExperience(e,t,s){let i=document.querySelector("#_capacitor-camera-input");const a=()=>{var o;(o=i.parentNode)===null||o===void 0||o.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",o=>{const l=i.files[0];let c="jpeg";if(l.type==="image/png"?c="png":l.type==="image/gif"&&(c="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){const d=new FileReader;d.addEventListener("load",()=>{if(e.resultType==="dataUrl")t({dataUrl:d.result,format:c});else if(e.resultType==="base64"){const h=d.result.split(",")[1];t({base64String:h,format:c})}a()}),d.readAsDataURL(l)}else t({webPath:URL.createObjectURL(l),format:c}),a()}),i.addEventListener("cancel",o=>{s(new Su("User cancelled photos app")),a()})),i.accept="image/*",i.capture=!0,e.source===pu.Photos||e.source===pu.Prompt?i.removeAttribute("capture"):e.direction===um.Front?i.capture="user":e.direction===um.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(e,t){let s=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var a;(a=s.parentNode)===null||a===void 0||a.removeChild(s)};s||(s=document.createElement("input"),s.id="_capacitor-camera-input-multiple",s.type="file",s.hidden=!0,s.multiple=!0,document.body.appendChild(s),s.addEventListener("change",a=>{const o=[];for(let l=0;l<s.files.length;l++){const c=s.files[l];let d="jpeg";c.type==="image/png"?d="png":c.type==="image/gif"&&(d="gif"),o.push({webPath:URL.createObjectURL(c),format:d})}e({photos:o}),i()}),s.addEventListener("cancel",a=>{t(new Su("User cancelled photos app")),i()})),s.accept="image/*",s.click()}_getCameraPhoto(e,t){return new Promise((s,i)=>{const a=new FileReader,o=e.type.split("/")[1];t.resultType==="uri"?s({webPath:URL.createObjectURL(e),format:o,saved:!1}):(a.readAsDataURL(e),a.onloadend=()=>{const l=a.result;t.resultType==="dataUrl"?s({dataUrl:l,format:o,saved:!1}):s({base64String:l.split(",")[1],format:o,saved:!1})},a.onerror=l=>{i(l)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const P$=gd("Camera",{web:()=>new L$}),K$=gd("PushNotifications",{});var Y2;(function(n){n.Documents="DOCUMENTS",n.Data="DATA",n.Library="LIBRARY",n.Cache="CACHE",n.External="EXTERNAL",n.ExternalStorage="EXTERNAL_STORAGE",n.ExternalCache="EXTERNAL_CACHE",n.LibraryNoCloud="LIBRARY_NO_CLOUD",n.Temporary="TEMPORARY"})(Y2||(Y2={}));var F2;(function(n){n.UTF8="utf8",n.ASCII="ascii",n.UTF16="utf16"})(F2||(F2={}));const O$=gd("Filesystem",{web:()=>Ru(()=>import("./web-BI46Xwoy.js"),[],import.meta.url).then(n=>new n.FilesystemWeb)});WH();const M2=gd("App",{web:()=>Ru(()=>import("./web-CxBY1JE2.js"),[],import.meta.url).then(n=>new n.AppWeb)}),z$=gd("SecurityCheck"),U$=({children:n})=>{const[e,t]=k.useState({location:!1,camera:!1,notification:!1,microphone:!1,storage:!1,calendar:!1,contacts:!1,activity:!1}),[s,i]=k.useState({developerMode:!1}),[a,o]=k.useState(!0),l=zf.isNativePlatform(),c=async()=>{if(!l){o(!1);return}try{let m=!1,f=!1,p=!1,b=!1,x=!1,v=!1;try{const M=await z$.getSecurityStatus();m=M.developerMode,f=M.microphoneGranted===!0,p=M.calendarGranted===!0,b=M.contactsGranted===!0,x=M.filesGranted===!0,v=M.activityGranted===!0}catch(M){console.warn("Failed to check security status or plugin not available",M)}const S=await bG.checkPermissions(),B=S.location==="granted"||S.coarseLocation==="granted",V=await P$.checkPermissions(),R=V.camera==="granted"||V.photos==="granted";let W=!1;try{W=(await K$.checkPermissions()).receive==="granted"}catch(M){console.warn("Push details not available or failed",M)}const Y=(await O$.checkPermissions()).publicStorage==="granted";t({location:B,camera:R,notification:W,storage:Y,microphone:f,calendar:p,contacts:b,activity:v}),i({developerMode:m})}catch(m){console.error("Error checking permissions:",m)}finally{o(!1)}};if(k.useEffect(()=>{c();const m=M2.addListener("appStateChange",({isActive:f})=>{f&&c()});return()=>{m.then(f=>f.remove())}},[l]),!l)return r.jsx(r.Fragment,{children:n});if(a)return r.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})});if(s.developerMode)return r.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50 px-6 text-center animate-fade-in",children:r.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full border-2 border-red-500",children:[r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-red-50 ring-8 ring-red-50/50",children:r.jsx("svg",{className:"h-10 w-10 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Security Alert"}),r.jsx("p",{className:"text-gray-600 mb-6 text-sm leading-relaxed",children:"Developer Options are enabled on this device."}),r.jsxs("div",{className:"bg-red-50 rounded-lg p-4 mb-6 text-left border border-red-100",children:[r.jsx("p",{className:"text-xs text-red-800 font-medium mb-1",children:"Action Required"}),r.jsxs("p",{className:"text-xs text-red-600",children:["Please disable ",r.jsx("strong",{children:"Developer Options"})," in your device settings to continue using the application securely."]})]}),r.jsx("button",{onClick:()=>c(),className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3.5 px-4 rounded-xl shadow-lg shadow-red-600/20 transition-all duration-200 active:scale-[0.98]",children:"Retry Check"})]})});if(e.location&&e.camera&&e.notification&&e.storage&&e.microphone&&e.calendar&&e.contacts&&e.activity)return r.jsx(r.Fragment,{children:n});const h=async()=>{try{await M2.openAppSettings()}catch(m){console.error("Failed to open settings",m)}};return r.jsx("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-900 px-6 text-center animate-fade-in",children:r.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full border-4 border-red-600 relative overflow-hidden",children:[r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-red-50 ring-8 ring-red-50/50",children:r.jsx("svg",{className:"h-10 w-10 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Permissions Access"}),r.jsx("p",{className:"text-gray-500 mb-6 text-sm leading-relaxed",children:"This app requires full access to function. Please grant the following permissions in Settings."}),r.jsxs("div",{className:"w-full space-y-3 mb-8 text-left text-sm max-h-[320px] overflow-y-auto pr-1",children:[r.jsx(_c,{label:"Location",granted:e.location}),r.jsx(_c,{label:"Camera",granted:e.camera}),r.jsx(_c,{label:"Notifications",granted:e.notification}),r.jsx(_c,{label:"Microphone",granted:e.microphone}),r.jsx(_c,{label:"Files & Media",granted:e.storage}),r.jsx(_c,{label:"Calendar",granted:e.calendar}),r.jsx(_c,{label:"Contacts",granted:e.contacts}),r.jsx(_c,{label:"Physical Activity",granted:e.activity})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:h,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg shadow-red-600/20 transition-all duration-200 active:scale-[0.98] uppercase tracking-wide text-sm",children:"Grant Access"}),r.jsx("button",{onClick:c,className:"text-gray-500 text-xs hover:text-gray-700 underline underline-offset-2",children:"I have granted them, Check Again"})]})]})})},_c=({label:n,granted:e})=>r.jsxs("div",{className:"flex justify-between items-center py-2.5 px-3 rounded-lg bg-gray-50 border border-gray-100",children:[r.jsx("span",{className:"font-medium text-gray-700 text-sm",children:n}),e?r.jsx("svg",{className:"h-5 w-5 text-emerald-500",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):r.jsx("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-full bg-red-100 text-red-600 tracking-wide uppercase",children:"Required"})]}),Q$=({onComplete:n})=>{const e=jt("(max-width: 767px)"),{colorScheme:t}=an(),[s,i]=k.useState("prompt"),[a,o]=k.useState("prompt"),[l,c]=k.useState(!1),[d,h]=k.useState(null),m=s==="granted"&&a==="granted",f=t==="blue",p=f?"bg-[#1a3a6e]":"bg-white",b=f?"text-white":"text-gray-600",x=f?"text-white":"text-gray-900",v=f?"bg-white/10 border-white/20":"bg-gray-100 border-gray-300",S=f?"text-white":"text-gray-900",B=f?"text-gray-300":"text-gray-600";k.useEffect(()=>{(!e||m)&&n()},[e,m,n]);const V=async()=>{c(!0),h(null);try{try{const R=await navigator.mediaDevices.getUserMedia({video:!0});o("granted"),R.getTracks().forEach(W=>W.stop())}catch{throw o("denied"),new Error("Camera permission was denied.")}try{await new Promise((R,W)=>{navigator.geolocation.getCurrentPosition(()=>{i("granted"),R(!0)},()=>{i("denied"),W(new Error("Location permission was denied."))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})}catch{throw new Error("Location permission was denied.")}n()}catch(R){h(R.message||"Permissions are required to use this app.")}finally{c(!1)}};return e?r.jsxs("div",{className:`min-h-screen flex flex-col items-center justify-center p-4 text-center ${p}`,children:[r.jsx("div",{className:"splash-logo",children:r.jsx(da,{className:"h-16 mb-8"})}),r.jsxs("div",{className:"max-w-md",children:[r.jsx("h1",{className:`text-2xl font-bold mb-4 ${x}`,children:"Permissions Required"}),r.jsx("p",{className:`mb-8 ${b}`,children:"To ensure the best experience and enable features like location-based check-ins and photo uploads, we need access to your device's Camera and Location."}),r.jsxs("div",{className:"space-y-4 mb-8",children:[r.jsxs("div",{className:`p-4 rounded-lg border ${s==="granted"?"bg-emerald-500/20 border-emerald-500 text-emerald-100":v}`,children:[r.jsx("p",{className:`font-semibold ${S}`,children:"Location Access"}),r.jsx("p",{className:`text-sm ${B}`,children:s==="granted"?"Permission Granted":"Needed for check-in/out"})]}),r.jsxs("div",{className:`p-4 rounded-lg border ${a==="granted"?"bg-emerald-500/20 border-emerald-500 text-emerald-100":v}`,children:[r.jsx("p",{className:`font-semibold ${S}`,children:"Camera Access"}),r.jsx("p",{className:`text-sm ${B}`,children:a==="granted"?"Permission Granted":"Needed for identity verification"})]})]}),r.jsx(se,{onClick:V,disabled:l,className:f?"w-full bg-white text-[#1a3a6e] hover:bg-gray-100":"w-full",children:l?"Requesting...":"Grant Permissions"}),d&&r.jsx("p",{className:"text-red-500 mt-4",children:d}),r.jsx("p",{className:`text-xs mt-8 ${f?"text-white/50":"text-gray-500"}`,children:"You can manage these permissions in your device settings at any time."})]})]}):null},q$=()=>{const[n,e]=k.useState(!1),t=()=>{e(!0)};return n?r.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-white p-4",children:[r.jsx("div",{className:"splash-logo",children:r.jsx(da,{className:"h-16 mb-8"})}),r.jsx("p",{className:"text-gray-600",children:"Loading Application..."})]}):r.jsx(Q$,{onComplete:t})},$$=()=>{const{user:n,logout:e}=bt(),{permissions:t}=ha(),{colorScheme:s}=an(),i=vt(),a=Is(s);if(!n)return null;const o=kH.filter(c=>t[n.role]?.includes(c.permission)).sort((c,d)=>c.label.localeCompare(d.label)),l=async()=>{await e(),i("/auth/login")};return r.jsxs("div",{className:"min-h-[calc(100vh-180px)] flex flex-col pb-4",style:{backgroundColor:a.mobileBg},children:[r.jsx("div",{className:"border p-6 rounded-3xl shadow-lg -mx-4 mb-6",style:{backgroundColor:a.sidebarBg,borderColor:a.sidebarBorder},children:r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"rounded-full border-2",style:{borderColor:a.primary},children:r.jsx(ia,{photoUrl:n.photoUrl,seed:n.id,className:"h-14 w-14 rounded-full"})}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-white",children:["Hi, ",n.name.split(" ")[0]]}),r.jsx("p",{className:"text-xs text-white/70 uppercase tracking-wider",children:n.role.replace(/_/g," ")})]})]})})}),r.jsxs("div",{className:"flex-1 flex flex-col",children:[r.jsx("h2",{className:"text-lg font-semibold mb-4 px-2",style:{color:a.isDark?"white":"#111827"},children:"Apps & Features"}),r.jsx("div",{className:"grid grid-cols-3 gap-3 px-2 flex-1 content-start",children:o.map(c=>r.jsxs("div",{onClick:()=>i(c.to),className:"flex flex-col items-center justify-center p-4 border rounded-2xl active:scale-95 transition-transform duration-150 shadow-md min-h-[110px]",style:{backgroundColor:a.sidebarBg,borderColor:a.sidebarBorder},children:[r.jsx("div",{className:"p-3 rounded-full mb-2",style:{backgroundColor:a.mobileBg==="#ffffff"?a.activeItemBg+"20":a.mobileBg,color:a.primary},children:r.jsx(c.icon,{className:"w-7 h-7"})}),r.jsx("span",{className:"text-xs text-center font-medium leading-tight",style:{color:a.isDark||a.sidebarBg!=="#ffffff"?"white":"#1e293b"},children:c.label})]},c.to))})]}),r.jsx("div",{className:"px-2 mt-6",children:r.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center space-x-2 p-4 rounded-xl font-semibold active:scale-95 transition-all text-white shadow-lg",style:{backgroundColor:"#1f2937"},children:[r.jsx(No,{className:"w-5 h-5"}),r.jsx("span",{children:"Log Out"})]})})]})};var Pm=n=>n.type==="checkbox",Ig=n=>n instanceof Date,qr=n=>n==null;const VH=n=>typeof n=="object";var Zs=n=>!qr(n)&&!Array.isArray(n)&&VH(n)&&!Ig(n),_H=n=>Zs(n)&&n.target?Pm(n.target)?n.target.checked:n.target.value:n,eee=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,jH=(n,e)=>n.has(eee(e)),tee=n=>{const e=n.constructor&&n.constructor.prototype;return Zs(e)&&e.hasOwnProperty("isPrototypeOf")},yG=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ln(n){let e;const t=Array.isArray(n),s=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(!(yG&&(n instanceof Blob||s))&&(t||Zs(n)))if(e=t?[]:Object.create(Object.getPrototypeOf(n)),!t&&!tee(n))e=n;else for(const i in n)n.hasOwnProperty(i)&&(e[i]=Ln(n[i]));else return n;return e}var wp=n=>/^\w*$/.test(n),Tn=n=>n===void 0,Zp=n=>Array.isArray(n)?n.filter(Boolean):[],vG=n=>Zp(n.replace(/["|']|\]/g,"").split(/\.|\[/)),et=(n,e,t)=>{if(!e||!Zs(n))return t;const s=(wp(e)?[e]:vG(e)).reduce((i,a)=>qr(i)?i:i[a],n);return Tn(s)||s===n?Tn(n[e])?t:n[e]:s},Ai=n=>typeof n=="boolean",An=(n,e,t)=>{let s=-1;const i=wp(e)?[e]:vG(e),a=i.length,o=a-1;for(;++s<a;){const l=i[s];let c=t;if(s!==o){const d=n[l];c=Zs(d)||Array.isArray(d)?d:isNaN(+i[s+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;n[l]=c,n=n[l]}};const Uf={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},sa={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Al={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},XH=ot.createContext(null);XH.displayName="HookFormContext";const Gp=()=>ot.useContext(XH);var JH=(n,e,t,s=!0)=>{const i={defaultValues:e._defaultValues};for(const a in n)Object.defineProperty(i,a,{get:()=>{const o=a;return e._proxyFormState[o]!==sa.all&&(e._proxyFormState[o]=!s||sa.all),t&&(t[o]=!0),n[o]}});return i};const Bp=typeof window<"u"?ot.useLayoutEffect:ot.useEffect;function nee(n){const e=Gp(),{control:t=e.control,disabled:s,name:i,exact:a}=n||{},[o,l]=ot.useState(t._formState),c=ot.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return Bp(()=>t._subscribe({name:i,formState:c.current,exact:a,callback:d=>{!s&&l({...t._formState,...d})}}),[i,s,a]),ot.useEffect(()=>{c.current.isValid&&t._setValid(!0)},[t]),ot.useMemo(()=>JH(o,t,c.current,!1),[o,t])}var xi=n=>typeof n=="string",fZ=(n,e,t,s,i)=>xi(n)?(s&&e.watch.add(n),et(t,n,i)):Array.isArray(n)?n.map(a=>(s&&e.watch.add(a),et(t,a))):(s&&(e.watchAll=!0),t),pZ=n=>qr(n)||!VH(n);function Ya(n,e,t=new WeakSet){if(pZ(n)||pZ(e))return n===e;if(Ig(n)&&Ig(e))return n.getTime()===e.getTime();const s=Object.keys(n),i=Object.keys(e);if(s.length!==i.length)return!1;if(t.has(n)||t.has(e))return!0;t.add(n),t.add(e);for(const a of s){const o=n[a];if(!i.includes(a))return!1;if(a!=="ref"){const l=e[a];if(Ig(o)&&Ig(l)||Zs(o)&&Zs(l)||Array.isArray(o)&&Array.isArray(l)?!Ya(o,l,t):o!==l)return!1}}return!0}function pg(n){const e=Gp(),{control:t=e.control,name:s,defaultValue:i,disabled:a,exact:o,compute:l}=n||{},c=ot.useRef(i),d=ot.useRef(l),h=ot.useRef(void 0),m=ot.useRef(t),f=ot.useRef(s);d.current=l;const[p,b]=ot.useState(()=>{const R=t._getWatch(s,c.current);return d.current?d.current(R):R}),x=ot.useCallback(R=>{const W=fZ(s,t._names,R||t._formValues,!1,c.current);return d.current?d.current(W):W},[t._formValues,t._names,s]),v=ot.useCallback(R=>{if(!a){const W=fZ(s,t._names,R||t._formValues,!1,c.current);if(d.current){const _=d.current(W);Ya(_,h.current)||(b(_),h.current=_)}else b(W)}},[t._formValues,t._names,a,s]);Bp(()=>((m.current!==t||!Ya(f.current,s))&&(m.current=t,f.current=s,v()),t._subscribe({name:s,formState:{values:!0},exact:o,callback:R=>{v(R.values)}})),[t,o,s,v]),ot.useEffect(()=>t._removeUnmounted());const S=m.current!==t,B=f.current,V=ot.useMemo(()=>{if(a)return null;const R=!S&&!Ya(B,s);return S||R?x():null},[a,S,s,B,x]);return V!==null?V:p}function see(n){const e=Gp(),{name:t,disabled:s,control:i=e.control,shouldUnregister:a,defaultValue:o}=n,l=jH(i._names.array,t),c=ot.useMemo(()=>et(i._formValues,t,et(i._defaultValues,t,o)),[i,t,o]),d=pg({control:i,name:t,defaultValue:c,exact:!0}),h=nee({control:i,name:t,exact:!0}),m=ot.useRef(n),f=ot.useRef(void 0),p=ot.useRef(i.register(t,{...n.rules,value:d,...Ai(n.disabled)?{disabled:n.disabled}:{}}));m.current=n;const b=ot.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!et(h.errors,t)},isDirty:{enumerable:!0,get:()=>!!et(h.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!et(h.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!et(h.validatingFields,t)},error:{enumerable:!0,get:()=>et(h.errors,t)}}),[h,t]),x=ot.useCallback(V=>p.current.onChange({target:{value:_H(V),name:t},type:Uf.CHANGE}),[t]),v=ot.useCallback(()=>p.current.onBlur({target:{value:et(i._formValues,t),name:t},type:Uf.BLUR}),[t,i._formValues]),S=ot.useCallback(V=>{const R=et(i._fields,t);R&&V&&(R._f.ref={focus:()=>V.focus&&V.focus(),select:()=>V.select&&V.select(),setCustomValidity:W=>V.setCustomValidity(W),reportValidity:()=>V.reportValidity()})},[i._fields,t]),B=ot.useMemo(()=>({name:t,value:d,...Ai(s)||h.disabled?{disabled:h.disabled||s}:{},onChange:x,onBlur:v,ref:S}),[t,s,h.disabled,x,v,S,d]);return ot.useEffect(()=>{const V=i._options.shouldUnregister||a,R=f.current;R&&R!==t&&!l&&i.unregister(R),i.register(t,{...m.current.rules,...Ai(m.current.disabled)?{disabled:m.current.disabled}:{}});const W=(_,Y)=>{const j=et(i._fields,_);j&&j._f&&(j._f.mount=Y)};if(W(t,!0),V){const _=Ln(et(i._options.defaultValues,t,m.current.defaultValue));An(i._defaultValues,t,_),Tn(et(i._formValues,t))&&An(i._formValues,t,_)}return!l&&i.register(t),f.current=t,()=>{(l?V&&!i._state.action:V)?i.unregister(t):W(t,!1)}},[t,i,l,a]),ot.useEffect(()=>{i._setDisabledField({disabled:s,name:t})},[s,t,i]),ot.useMemo(()=>({field:B,formState:h,fieldState:b}),[B,h,b])}const ye=n=>n.render(see(n));var YH=(n,e,t,s,i)=>e?{...t[n],types:{...t[n]&&t[n].types?t[n].types:{},[s]:i||!0}}:{},ti=n=>Array.isArray(n)?n:[n],H2=()=>{let n=[];return{get observers(){return n},next:i=>{for(const a of n)a.next&&a.next(i)},subscribe:i=>(n.push(i),{unsubscribe:()=>{n=n.filter(a=>a!==i)}}),unsubscribe:()=>{n=[]}}};function FH(n,e){const t={};for(const s in n)if(n.hasOwnProperty(s)){const i=n[s],a=e[s];if(i&&Zs(i)&&a){const o=FH(i,a);Zs(o)&&(t[s]=o)}else n[s]&&(t[s]=a)}return t}var ur=n=>Zs(n)&&!Object.keys(n).length,xG=n=>n.type==="file",Fa=n=>typeof n=="function",Qf=n=>{if(!yG)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},MH=n=>n.type==="select-multiple",SG=n=>n.type==="radio",ree=n=>SG(n)||Pm(n),Tb=n=>Qf(n)&&n.isConnected;function iee(n,e){const t=e.slice(0,-1).length;let s=0;for(;s<t;)n=Tn(n)?s++:n[e[s++]];return n}function aee(n){for(const e in n)if(n.hasOwnProperty(e)&&!Tn(n[e]))return!1;return!0}function ds(n,e){const t=Array.isArray(e)?e:wp(e)?[e]:vG(e),s=t.length===1?n:iee(n,t),i=t.length-1,a=t[i];return s&&delete s[a],i!==0&&(Zs(s)&&ur(s)||Array.isArray(s)&&aee(s))&&ds(n,t.slice(0,-1)),n}var oee=n=>{for(const e in n)if(Fa(n[e]))return!0;return!1};function HH(n){return Array.isArray(n)||Zs(n)&&!oee(n)}function AZ(n,e={}){for(const t in n)HH(n[t])?(e[t]=Array.isArray(n[t])?[]:{},AZ(n[t],e[t])):Tn(n[t])||(e[t]=!0);return e}function Cu(n,e,t){t||(t=AZ(e));for(const s in n)HH(n[s])?Tn(e)||pZ(t[s])?t[s]=AZ(n[s],Array.isArray(n[s])?[]:{}):Cu(n[s],qr(e)?{}:e[s],t[s]):t[s]=!Ya(n[s],e[s]);return t}const T2={value:!1,isValid:!1},E2={value:!0,isValid:!0};var TH=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Tn(n[0].attributes.value)?Tn(n[0].value)||n[0].value===""?E2:{value:n[0].value,isValid:!0}:E2:T2}return T2},EH=(n,{valueAsNumber:e,valueAsDate:t,setValueAs:s})=>Tn(n)?n:e?n===""?NaN:n&&+n:t&&xi(n)?new Date(n):s?s(n):n;const D2={isValid:!1,value:null};var DH=n=>Array.isArray(n)?n.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,D2):D2;function L2(n){const e=n.ref;return xG(e)?e.files:SG(e)?DH(n.refs).value:MH(e)?[...e.selectedOptions].map(({value:t})=>t):Pm(e)?TH(n.refs).value:EH(Tn(e.value)?n.ref.value:e.value,n)}var lee=(n,e,t,s)=>{const i={};for(const a of n){const o=et(e,a);o&&An(i,a,o._f)}return{criteriaMode:t,names:[...n],fields:i,shouldUseNativeValidation:s}},qf=n=>n instanceof RegExp,_h=n=>Tn(n)?n:qf(n)?n.source:Zs(n)?qf(n.value)?n.value.source:n.value:n,Au=n=>({isOnSubmit:!n||n===sa.onSubmit,isOnBlur:n===sa.onBlur,isOnChange:n===sa.onChange,isOnAll:n===sa.all,isOnTouch:n===sa.onTouched});const P2="AsyncFunction";var cee=n=>!!n&&!!n.validate&&!!(Fa(n.validate)&&n.validate.constructor.name===P2||Zs(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===P2)),dee=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),bZ=(n,e,t)=>!t&&(e.watchAll||e.watch.has(n)||[...e.watch].some(s=>n.startsWith(s)&&/^\.\w+/.test(n.slice(s.length))));const wu=(n,e,t,s)=>{for(const i of t||Object.keys(n)){const a=et(n,i);if(a){const{_f:o,...l}=a;if(o){if(o.refs&&o.refs[0]&&e(o.refs[0],i)&&!s)return!0;if(o.ref&&e(o.ref,o.name)&&!s)return!0;if(wu(l,e))break}else if(Zs(l)&&wu(l,e))break}}};function K2(n,e,t){const s=et(n,t);if(s||wp(t))return{error:s,name:t};const i=t.split(".");for(;i.length;){const a=i.join("."),o=et(e,a),l=et(n,a);if(o&&!Array.isArray(o)&&t!==a)return{name:t};if(l&&l.type)return{name:a,error:l};if(l&&l.root&&l.root.type)return{name:`${a}.root`,error:l.root};i.pop()}return{name:t}}var gee=(n,e,t,s)=>{t(n);const{name:i,...a}=n;return ur(a)||Object.keys(a).length>=Object.keys(e).length||Object.keys(a).find(o=>e[o]===(!s||sa.all))},uee=(n,e,t)=>!n||!e||n===e||ti(n).some(s=>s&&(t?s===e:s.startsWith(e)||e.startsWith(s))),hee=(n,e,t,s,i)=>i.isOnAll?!1:!t&&i.isOnTouch?!(e||n):(t?s.isOnBlur:i.isOnBlur)?!n:(t?s.isOnChange:i.isOnChange)?n:!0,mee=(n,e)=>!Zp(et(n,e)).length&&ds(n,e),LH=(n,e,t)=>{const s=ti(et(n,t));return An(s,"root",e[t]),An(n,t,s),n};function O2(n,e,t="validate"){if(xi(n)||Array.isArray(n)&&n.every(xi)||Ai(n)&&!n)return{type:t,message:xi(n)?n:"",ref:e}}var au=n=>Zs(n)&&!qf(n)?n:{value:n,message:""},yZ=async(n,e,t,s,i,a)=>{const{ref:o,refs:l,required:c,maxLength:d,minLength:h,min:m,max:f,pattern:p,validate:b,name:x,valueAsNumber:v,mount:S}=n._f,B=et(t,x);if(!S||e.has(x))return{};const V=l?l[0]:o,R=z=>{i&&V.reportValidity&&(V.setCustomValidity(Ai(z)?"":z||""),V.reportValidity())},W={},_=SG(o),Y=Pm(o),j=_||Y,M=(v||xG(o))&&Tn(o.value)&&Tn(B)||Qf(o)&&o.value===""||B===""||Array.isArray(B)&&!B.length,H=YH.bind(null,x,s,W),D=(z,O,E,te=Al.maxLength,q=Al.minLength)=>{const de=z?O:E;W[x]={type:z?te:q,message:de,ref:o,...H(z?te:q,de)}};if(a?!Array.isArray(B)||!B.length:c&&(!j&&(M||qr(B))||Ai(B)&&!B||Y&&!TH(l).isValid||_&&!DH(l).isValid)){const{value:z,message:O}=xi(c)?{value:!!c,message:c}:au(c);if(z&&(W[x]={type:Al.required,message:O,ref:V,...H(Al.required,O)},!s))return R(O),W}if(!M&&(!qr(m)||!qr(f))){let z,O;const E=au(f),te=au(m);if(!qr(B)&&!isNaN(B)){const q=o.valueAsNumber||B&&+B;qr(E.value)||(z=q>E.value),qr(te.value)||(O=q<te.value)}else{const q=o.valueAsDate||new Date(B),de=ne=>new Date(new Date().toDateString()+" "+ne),U=o.type=="time",P=o.type=="week";xi(E.value)&&B&&(z=U?de(B)>de(E.value):P?B>E.value:q>new Date(E.value)),xi(te.value)&&B&&(O=U?de(B)<de(te.value):P?B<te.value:q<new Date(te.value))}if((z||O)&&(D(!!z,E.message,te.message,Al.max,Al.min),!s))return R(W[x].message),W}if((d||h)&&!M&&(xi(B)||a&&Array.isArray(B))){const z=au(d),O=au(h),E=!qr(z.value)&&B.length>+z.value,te=!qr(O.value)&&B.length<+O.value;if((E||te)&&(D(E,z.message,O.message),!s))return R(W[x].message),W}if(p&&!M&&xi(B)){const{value:z,message:O}=au(p);if(qf(z)&&!B.match(z)&&(W[x]={type:Al.pattern,message:O,ref:o,...H(Al.pattern,O)},!s))return R(O),W}if(b){if(Fa(b)){const z=await b(B,t),O=O2(z,V);if(O&&(W[x]={...O,...H(Al.validate,O.message)},!s))return R(O.message),W}else if(Zs(b)){let z={};for(const O in b){if(!ur(z)&&!s)break;const E=O2(await b[O](B,t),V,O);E&&(z={...E,...H(O,E.message)},R(E.message),s&&(W[x]=z))}if(!ur(z)&&(W[x]={ref:V,...z},!s))return W}}return R(!0),W};const Iee={mode:sa.onSubmit,reValidateMode:sa.onChange,shouldFocusError:!0};function Cee(n={}){let e={...Iee,...n},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:Fa(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},s={},i=Zs(e.defaultValues)||Zs(e.values)?Ln(e.defaultValues||e.values)||{}:{},a=e.shouldUnregister?{}:Ln(i),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let m={...h};const f={array:H2(),state:H2()},p=e.criteriaMode===sa.all,b=ee=>oe=>{clearTimeout(d),d=setTimeout(ee,oe)},x=async ee=>{if(!e.disabled&&(h.isValid||m.isValid||ee)){const oe=e.resolver?ur((await Y()).errors):await M(s,!0);oe!==t.isValid&&f.state.next({isValid:oe})}},v=(ee,oe)=>{!e.disabled&&(h.isValidating||h.validatingFields||m.isValidating||m.validatingFields)&&((ee||Array.from(l.mount)).forEach(Ie=>{Ie&&(oe?An(t.validatingFields,Ie,oe):ds(t.validatingFields,Ie))}),f.state.next({validatingFields:t.validatingFields,isValidating:!ur(t.validatingFields)}))},S=(ee,oe=[],Ie,Ne,Ge=!0,je=!0)=>{if(Ne&&Ie&&!e.disabled){if(o.action=!0,je&&Array.isArray(et(s,ee))){const Fe=Ie(et(s,ee),Ne.argA,Ne.argB);Ge&&An(s,ee,Fe)}if(je&&Array.isArray(et(t.errors,ee))){const Fe=Ie(et(t.errors,ee),Ne.argA,Ne.argB);Ge&&An(t.errors,ee,Fe),mee(t.errors,ee)}if((h.touchedFields||m.touchedFields)&&je&&Array.isArray(et(t.touchedFields,ee))){const Fe=Ie(et(t.touchedFields,ee),Ne.argA,Ne.argB);Ge&&An(t.touchedFields,ee,Fe)}(h.dirtyFields||m.dirtyFields)&&(t.dirtyFields=Cu(i,a)),f.state.next({name:ee,isDirty:D(ee,oe),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else An(a,ee,oe)},B=(ee,oe)=>{An(t.errors,ee,oe),f.state.next({errors:t.errors})},V=ee=>{t.errors=ee,f.state.next({errors:t.errors,isValid:!1})},R=(ee,oe,Ie,Ne)=>{const Ge=et(s,ee);if(Ge){const je=et(a,ee,Tn(Ie)?et(i,ee):Ie);Tn(je)||Ne&&Ne.defaultChecked||oe?An(a,ee,oe?je:L2(Ge._f)):E(ee,je),o.mount&&x()}},W=(ee,oe,Ie,Ne,Ge)=>{let je=!1,Fe=!1;const ze={name:ee};if(!e.disabled){if(!Ie||Ne){(h.isDirty||m.isDirty)&&(Fe=t.isDirty,t.isDirty=ze.isDirty=D(),je=Fe!==ze.isDirty);const lt=Ya(et(i,ee),oe);Fe=!!et(t.dirtyFields,ee),lt?ds(t.dirtyFields,ee):An(t.dirtyFields,ee,!0),ze.dirtyFields=t.dirtyFields,je=je||(h.dirtyFields||m.dirtyFields)&&Fe!==!lt}if(Ie){const lt=et(t.touchedFields,ee);lt||(An(t.touchedFields,ee,Ie),ze.touchedFields=t.touchedFields,je=je||(h.touchedFields||m.touchedFields)&&lt!==Ie)}je&&Ge&&f.state.next(ze)}return je?ze:{}},_=(ee,oe,Ie,Ne)=>{const Ge=et(t.errors,ee),je=(h.isValid||m.isValid)&&Ai(oe)&&t.isValid!==oe;if(e.delayError&&Ie?(c=b(()=>B(ee,Ie)),c(e.delayError)):(clearTimeout(d),c=null,Ie?An(t.errors,ee,Ie):ds(t.errors,ee)),(Ie?!Ya(Ge,Ie):Ge)||!ur(Ne)||je){const Fe={...Ne,...je&&Ai(oe)?{isValid:oe}:{},errors:t.errors,name:ee};t={...t,...Fe},f.state.next(Fe)}},Y=async ee=>{v(ee,!0);const oe=await e.resolver(a,e.context,lee(ee||l.mount,s,e.criteriaMode,e.shouldUseNativeValidation));return v(ee),oe},j=async ee=>{const{errors:oe}=await Y(ee);if(ee)for(const Ie of ee){const Ne=et(oe,Ie);Ne?An(t.errors,Ie,Ne):ds(t.errors,Ie)}else t.errors=oe;return oe},M=async(ee,oe,Ie={valid:!0})=>{for(const Ne in ee){const Ge=ee[Ne];if(Ge){const{_f:je,...Fe}=Ge;if(je){const ze=l.array.has(je.name),lt=Ge._f&&cee(Ge._f);lt&&h.validatingFields&&v([je.name],!0);const Dt=await yZ(Ge,l.disabled,a,p,e.shouldUseNativeValidation&&!oe,ze);if(lt&&h.validatingFields&&v([je.name]),Dt[je.name]&&(Ie.valid=!1,oe))break;!oe&&(et(Dt,je.name)?ze?LH(t.errors,Dt,je.name):An(t.errors,je.name,Dt[je.name]):ds(t.errors,je.name))}!ur(Fe)&&await M(Fe,oe,Ie)}}return Ie.valid},H=()=>{for(const ee of l.unMount){const oe=et(s,ee);oe&&(oe._f.refs?oe._f.refs.every(Ie=>!Tb(Ie)):!Tb(oe._f.ref))&&ie(ee)}l.unMount=new Set},D=(ee,oe)=>!e.disabled&&(ee&&oe&&An(a,ee,oe),!Ya(ne(),i)),z=(ee,oe,Ie)=>fZ(ee,l,{...o.mount?a:Tn(oe)?i:xi(ee)?{[ee]:oe}:oe},Ie,oe),O=ee=>Zp(et(o.mount?a:i,ee,e.shouldUnregister?et(i,ee,[]):[])),E=(ee,oe,Ie={})=>{const Ne=et(s,ee);let Ge=oe;if(Ne){const je=Ne._f;je&&(!je.disabled&&An(a,ee,EH(oe,je)),Ge=Qf(je.ref)&&qr(oe)?"":oe,MH(je.ref)?[...je.ref.options].forEach(Fe=>Fe.selected=Ge.includes(Fe.value)):je.refs?Pm(je.ref)?je.refs.forEach(Fe=>{(!Fe.defaultChecked||!Fe.disabled)&&(Array.isArray(Ge)?Fe.checked=!!Ge.find(ze=>ze===Fe.value):Fe.checked=Ge===Fe.value||!!Ge)}):je.refs.forEach(Fe=>Fe.checked=Fe.value===Ge):xG(je.ref)?je.ref.value="":(je.ref.value=Ge,je.ref.type||f.state.next({name:ee,values:Ln(a)})))}(Ie.shouldDirty||Ie.shouldTouch)&&W(ee,Ge,Ie.shouldTouch,Ie.shouldDirty,!0),Ie.shouldValidate&&P(ee)},te=(ee,oe,Ie)=>{for(const Ne in oe){if(!oe.hasOwnProperty(Ne))return;const Ge=oe[Ne],je=ee+"."+Ne,Fe=et(s,je);(l.array.has(ee)||Zs(Ge)||Fe&&!Fe._f)&&!Ig(Ge)?te(je,Ge,Ie):E(je,Ge,Ie)}},q=(ee,oe,Ie={})=>{const Ne=et(s,ee),Ge=l.array.has(ee),je=Ln(oe);An(a,ee,je),Ge?(f.array.next({name:ee,values:Ln(a)}),(h.isDirty||h.dirtyFields||m.isDirty||m.dirtyFields)&&Ie.shouldDirty&&f.state.next({name:ee,dirtyFields:Cu(i,a),isDirty:D(ee,je)})):Ne&&!Ne._f&&!qr(je)?te(ee,je,Ie):E(ee,je,Ie),bZ(ee,l)&&f.state.next({...t,name:ee}),f.state.next({name:o.mount?ee:void 0,values:Ln(a)})},de=async ee=>{o.mount=!0;const oe=ee.target;let Ie=oe.name,Ne=!0;const Ge=et(s,Ie),je=lt=>{Ne=Number.isNaN(lt)||Ig(lt)&&isNaN(lt.getTime())||Ya(lt,et(a,Ie,lt))},Fe=Au(e.mode),ze=Au(e.reValidateMode);if(Ge){let lt,Dt;const kt=oe.type?L2(Ge._f):_H(ee),$t=ee.type===Uf.BLUR||ee.type===Uf.FOCUS_OUT,wn=!dee(Ge._f)&&!e.resolver&&!et(t.errors,Ie)&&!Ge._f.deps||hee($t,et(t.touchedFields,Ie),t.isSubmitted,ze,Fe),Rt=bZ(Ie,l,$t);An(a,Ie,kt),$t?(!oe||!oe.readOnly)&&(Ge._f.onBlur&&Ge._f.onBlur(ee),c&&c(0)):Ge._f.onChange&&Ge._f.onChange(ee);const cn=W(Ie,kt,$t),en=!ur(cn)||Rt;if(!$t&&f.state.next({name:Ie,type:ee.type,values:Ln(a)}),wn)return(h.isValid||m.isValid)&&(e.mode==="onBlur"?$t&&x():$t||x()),en&&f.state.next({name:Ie,...Rt?{}:cn});if(!$t&&Rt&&f.state.next({...t}),e.resolver){const{errors:on}=await Y([Ie]);if(je(kt),Ne){const Ut=K2(t.errors,s,Ie),dn=K2(on,s,Ut.name||Ie);lt=dn.error,Ie=dn.name,Dt=ur(on)}}else v([Ie],!0),lt=(await yZ(Ge,l.disabled,a,p,e.shouldUseNativeValidation))[Ie],v([Ie]),je(kt),Ne&&(lt?Dt=!1:(h.isValid||m.isValid)&&(Dt=await M(s,!0)));Ne&&(Ge._f.deps&&(!Array.isArray(Ge._f.deps)||Ge._f.deps.length>0)&&P(Ge._f.deps),_(Ie,Dt,lt,cn))}},U=(ee,oe)=>{if(et(t.errors,oe)&&ee.focus)return ee.focus(),1},P=async(ee,oe={})=>{let Ie,Ne;const Ge=ti(ee);if(e.resolver){const je=await j(Tn(ee)?ee:Ge);Ie=ur(je),Ne=ee?!Ge.some(Fe=>et(je,Fe)):Ie}else ee?(Ne=(await Promise.all(Ge.map(async je=>{const Fe=et(s,je);return await M(Fe&&Fe._f?{[je]:Fe}:Fe)}))).every(Boolean),!(!Ne&&!t.isValid)&&x()):Ne=Ie=await M(s);return f.state.next({...!xi(ee)||(h.isValid||m.isValid)&&Ie!==t.isValid?{}:{name:ee},...e.resolver||!ee?{isValid:Ie}:{},errors:t.errors}),oe.shouldFocus&&!Ne&&wu(s,U,ee?Ge:l.mount),Ne},ne=(ee,oe)=>{let Ie={...o.mount?a:i};return oe&&(Ie=FH(oe.dirtyFields?t.dirtyFields:t.touchedFields,Ie)),Tn(ee)?Ie:xi(ee)?et(Ie,ee):ee.map(Ne=>et(Ie,Ne))},K=(ee,oe)=>({invalid:!!et((oe||t).errors,ee),isDirty:!!et((oe||t).dirtyFields,ee),error:et((oe||t).errors,ee),isValidating:!!et(t.validatingFields,ee),isTouched:!!et((oe||t).touchedFields,ee)}),re=ee=>{ee&&ti(ee).forEach(oe=>ds(t.errors,oe)),f.state.next({errors:ee?t.errors:{}})},le=(ee,oe,Ie)=>{const Ne=(et(s,ee,{_f:{}})._f||{}).ref,Ge=et(t.errors,ee)||{},{ref:je,message:Fe,type:ze,...lt}=Ge;An(t.errors,ee,{...lt,...oe,ref:Ne}),f.state.next({name:ee,errors:t.errors,isValid:!1}),Ie&&Ie.shouldFocus&&Ne&&Ne.focus&&Ne.focus()},ue=(ee,oe)=>Fa(ee)?f.state.subscribe({next:Ie=>"values"in Ie&&ee(z(void 0,oe),Ie)}):z(ee,oe,!0),ae=ee=>f.state.subscribe({next:oe=>{uee(ee.name,oe.name,ee.exact)&&gee(oe,ee.formState||h,Le,ee.reRenderRoot)&&ee.callback({values:{...a},...t,...oe,defaultValues:i})}}).unsubscribe,Ce=ee=>(o.mount=!0,m={...m,...ee.formState},ae({...ee,formState:m})),ie=(ee,oe={})=>{for(const Ie of ee?ti(ee):l.mount)l.mount.delete(Ie),l.array.delete(Ie),oe.keepValue||(ds(s,Ie),ds(a,Ie)),!oe.keepError&&ds(t.errors,Ie),!oe.keepDirty&&ds(t.dirtyFields,Ie),!oe.keepTouched&&ds(t.touchedFields,Ie),!oe.keepIsValidating&&ds(t.validatingFields,Ie),!e.shouldUnregister&&!oe.keepDefaultValue&&ds(i,Ie);f.state.next({values:Ln(a)}),f.state.next({...t,...oe.keepDirty?{isDirty:D()}:{}}),!oe.keepIsValid&&x()},ge=({disabled:ee,name:oe})=>{(Ai(ee)&&o.mount||ee||l.disabled.has(oe))&&(ee?l.disabled.add(oe):l.disabled.delete(oe))},xe=(ee,oe={})=>{let Ie=et(s,ee);const Ne=Ai(oe.disabled)||Ai(e.disabled);return An(s,ee,{...Ie||{},_f:{...Ie&&Ie._f?Ie._f:{ref:{name:ee}},name:ee,mount:!0,...oe}}),l.mount.add(ee),Ie?ge({disabled:Ai(oe.disabled)?oe.disabled:e.disabled,name:ee}):R(ee,!0,oe.value),{...Ne?{disabled:oe.disabled||e.disabled}:{},...e.progressive?{required:!!oe.required,min:_h(oe.min),max:_h(oe.max),minLength:_h(oe.minLength),maxLength:_h(oe.maxLength),pattern:_h(oe.pattern)}:{},name:ee,onChange:de,onBlur:de,ref:Ge=>{if(Ge){xe(ee,oe),Ie=et(s,ee);const je=Tn(Ge.value)&&Ge.querySelectorAll&&Ge.querySelectorAll("input,select,textarea")[0]||Ge,Fe=ree(je),ze=Ie._f.refs||[];if(Fe?ze.find(lt=>lt===je):je===Ie._f.ref)return;An(s,ee,{_f:{...Ie._f,...Fe?{refs:[...ze.filter(Tb),je,...Array.isArray(et(i,ee))?[{}]:[]],ref:{type:je.type,name:ee}}:{ref:je}}}),R(ee,!1,void 0,je)}else Ie=et(s,ee,{}),Ie._f&&(Ie._f.mount=!1),(e.shouldUnregister||oe.shouldUnregister)&&!(jH(l.array,ee)&&o.action)&&l.unMount.add(ee)}}},_e=()=>e.shouldFocusError&&wu(s,U,l.mount),Be=ee=>{Ai(ee)&&(f.state.next({disabled:ee}),wu(s,(oe,Ie)=>{const Ne=et(s,Ie);Ne&&(oe.disabled=Ne._f.disabled||ee,Array.isArray(Ne._f.refs)&&Ne._f.refs.forEach(Ge=>{Ge.disabled=Ne._f.disabled||ee}))},0,!1))},Se=(ee,oe)=>async Ie=>{let Ne;Ie&&(Ie.preventDefault&&Ie.preventDefault(),Ie.persist&&Ie.persist());let Ge=Ln(a);if(f.state.next({isSubmitting:!0}),e.resolver){const{errors:je,values:Fe}=await Y();t.errors=je,Ge=Ln(Fe)}else await M(s);if(l.disabled.size)for(const je of l.disabled)ds(Ge,je);if(ds(t.errors,"root"),ur(t.errors)){f.state.next({errors:{}});try{await ee(Ge,Ie)}catch(je){Ne=je}}else oe&&await oe({...t.errors},Ie),_e(),setTimeout(_e);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ur(t.errors)&&!Ne,submitCount:t.submitCount+1,errors:t.errors}),Ne)throw Ne},Re=(ee,oe={})=>{et(s,ee)&&(Tn(oe.defaultValue)?q(ee,Ln(et(i,ee))):(q(ee,oe.defaultValue),An(i,ee,Ln(oe.defaultValue))),oe.keepTouched||ds(t.touchedFields,ee),oe.keepDirty||(ds(t.dirtyFields,ee),t.isDirty=oe.defaultValue?D(ee,Ln(et(i,ee))):D()),oe.keepError||(ds(t.errors,ee),h.isValid&&x()),f.state.next({...t}))},Ye=(ee,oe={})=>{const Ie=ee?Ln(ee):i,Ne=Ln(Ie),Ge=ur(ee),je=Ge?i:Ne;if(oe.keepDefaultValues||(i=Ie),!oe.keepValues){if(oe.keepDirtyValues){const Fe=new Set([...l.mount,...Object.keys(Cu(i,a))]);for(const ze of Array.from(Fe))et(t.dirtyFields,ze)?An(je,ze,et(a,ze)):q(ze,et(je,ze))}else{if(yG&&Tn(ee))for(const Fe of l.mount){const ze=et(s,Fe);if(ze&&ze._f){const lt=Array.isArray(ze._f.refs)?ze._f.refs[0]:ze._f.ref;if(Qf(lt)){const Dt=lt.closest("form");if(Dt){Dt.reset();break}}}}if(oe.keepFieldsRef)for(const Fe of l.mount)q(Fe,et(je,Fe));else s={}}a=e.shouldUnregister?oe.keepDefaultValues?Ln(i):{}:Ln(je),f.array.next({values:{...je}}),f.state.next({values:{...je}})}l={mount:oe.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!h.isValid||!!oe.keepIsValid||!!oe.keepDirtyValues||!e.shouldUnregister&&!ur(je),o.watch=!!e.shouldUnregister,f.state.next({submitCount:oe.keepSubmitCount?t.submitCount:0,isDirty:Ge?!1:oe.keepDirty?t.isDirty:!!(oe.keepDefaultValues&&!Ya(ee,i)),isSubmitted:oe.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:Ge?{}:oe.keepDirtyValues?oe.keepDefaultValues&&a?Cu(i,a):t.dirtyFields:oe.keepDefaultValues&&ee?Cu(i,ee):oe.keepDirty?t.dirtyFields:{},touchedFields:oe.keepTouched?t.touchedFields:{},errors:oe.keepErrors?t.errors:{},isSubmitSuccessful:oe.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:i})},De=(ee,oe)=>Ye(Fa(ee)?ee(a):ee,oe),Me=(ee,oe={})=>{const Ie=et(s,ee),Ne=Ie&&Ie._f;if(Ne){const Ge=Ne.refs?Ne.refs[0]:Ne.ref;Ge.focus&&(Ge.focus(),oe.shouldSelect&&Fa(Ge.select)&&Ge.select())}},Le=ee=>{t={...t,...ee}},st={control:{register:xe,unregister:ie,getFieldState:K,handleSubmit:Se,setError:le,_subscribe:ae,_runSchema:Y,_focusError:_e,_getWatch:z,_getDirty:D,_setValid:x,_setFieldArray:S,_setDisabledField:ge,_setErrors:V,_getFieldArray:O,_reset:Ye,_resetDefaultValues:()=>Fa(e.defaultValues)&&e.defaultValues().then(ee=>{De(ee,e.resetOptions),f.state.next({isLoading:!1})}),_removeUnmounted:H,_disableForm:Be,_subjects:f,_proxyFormState:h,get _fields(){return s},get _formValues(){return a},get _state(){return o},set _state(ee){o=ee},get _defaultValues(){return i},get _names(){return l},set _names(ee){l=ee},get _formState(){return t},get _options(){return e},set _options(ee){e={...e,...ee}}},subscribe:Ce,trigger:P,register:xe,handleSubmit:Se,watch:ue,setValue:q,getValues:ne,reset:De,resetField:Re,clearErrors:re,unregister:ie,setError:le,setFocus:Me,getFieldState:K};return{...st,formControl:st}}var jc=()=>{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();const n=typeof performance>"u"?Date.now():performance.now()*1e3;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(Math.random()*16+n)%16|0;return(e=="x"?t:t&3|8).toString(16)})},Eb=(n,e,t={})=>t.shouldFocus||Tn(t.shouldFocus)?t.focusName||`${n}.${Tn(t.focusIndex)?e:t.focusIndex}.`:"",Db=(n,e)=>[...n,...ti(e)],Lb=n=>Array.isArray(n)?n.map(()=>{}):void 0;function Pb(n,e,t){return[...n.slice(0,e),...ti(t),...n.slice(e)]}var Kb=(n,e,t)=>Array.isArray(n)?(Tn(n[t])&&(n[t]=void 0),n.splice(t,0,n.splice(e,1)[0]),n):[],Ob=(n,e)=>[...ti(e),...ti(n)];function fee(n,e){let t=0;const s=[...n];for(const i of e)s.splice(i-t,1),t++;return Zp(s).length?s:[]}var zb=(n,e)=>Tn(e)?[]:fee(n,ti(e).sort((t,s)=>t-s)),Ub=(n,e,t)=>{[n[e],n[t]]=[n[t],n[e]]},z2=(n,e,t)=>(n[e]=t,n);function Wr(n){const e=Gp(),{control:t=e.control,name:s,keyName:i="id",shouldUnregister:a,rules:o}=n,[l,c]=ot.useState(t._getFieldArray(s)),d=ot.useRef(t._getFieldArray(s).map(jc)),h=ot.useRef(!1);t._names.array.add(s),ot.useMemo(()=>o&&l.length>=0&&t.register(s,o),[t,s,l.length,o]),Bp(()=>t._subjects.array.subscribe({next:({values:R,name:W})=>{if(W===s||!W){const _=et(R,s);Array.isArray(_)&&(c(_),d.current=_.map(jc))}}}).unsubscribe,[t,s]);const m=ot.useCallback(R=>{h.current=!0,t._setFieldArray(s,R)},[t,s]),f=(R,W)=>{const _=ti(Ln(R)),Y=Db(t._getFieldArray(s),_);t._names.focus=Eb(s,Y.length-1,W),d.current=Db(d.current,_.map(jc)),m(Y),c(Y),t._setFieldArray(s,Y,Db,{argA:Lb(R)})},p=(R,W)=>{const _=ti(Ln(R)),Y=Ob(t._getFieldArray(s),_);t._names.focus=Eb(s,0,W),d.current=Ob(d.current,_.map(jc)),m(Y),c(Y),t._setFieldArray(s,Y,Ob,{argA:Lb(R)})},b=R=>{const W=zb(t._getFieldArray(s),R);d.current=zb(d.current,R),m(W),c(W),!Array.isArray(et(t._fields,s))&&An(t._fields,s,void 0),t._setFieldArray(s,W,zb,{argA:R})},x=(R,W,_)=>{const Y=ti(Ln(W)),j=Pb(t._getFieldArray(s),R,Y);t._names.focus=Eb(s,R,_),d.current=Pb(d.current,R,Y.map(jc)),m(j),c(j),t._setFieldArray(s,j,Pb,{argA:R,argB:Lb(W)})},v=(R,W)=>{const _=t._getFieldArray(s);Ub(_,R,W),Ub(d.current,R,W),m(_),c(_),t._setFieldArray(s,_,Ub,{argA:R,argB:W},!1)},S=(R,W)=>{const _=t._getFieldArray(s);Kb(_,R,W),Kb(d.current,R,W),m(_),c(_),t._setFieldArray(s,_,Kb,{argA:R,argB:W},!1)},B=(R,W)=>{const _=Ln(W),Y=z2(t._getFieldArray(s),R,_);d.current=[...Y].map((j,M)=>!j||M===R?jc():d.current[M]),m(Y),c([...Y]),t._setFieldArray(s,Y,z2,{argA:R,argB:_},!0,!1)},V=R=>{const W=ti(Ln(R));d.current=W.map(jc),m([...W]),c([...W]),t._setFieldArray(s,[...W],_=>_,{},!0,!1)};return ot.useEffect(()=>{if(t._state.action=!1,bZ(s,t._names)&&t._subjects.state.next({...t._formState}),h.current&&(!Au(t._options.mode).isOnSubmit||t._formState.isSubmitted)&&!Au(t._options.reValidateMode).isOnSubmit)if(t._options.resolver)t._runSchema([s]).then(R=>{const W=et(R.errors,s),_=et(t._formState.errors,s);(_?!W&&_.type||W&&(_.type!==W.type||_.message!==W.message):W&&W.type)&&(W?An(t._formState.errors,s,W):ds(t._formState.errors,s),t._subjects.state.next({errors:t._formState.errors}))});else{const R=et(t._fields,s);R&&R._f&&!(Au(t._options.reValidateMode).isOnSubmit&&Au(t._options.mode).isOnSubmit)&&yZ(R,t._names.disabled,t._formValues,t._options.criteriaMode===sa.all,t._options.shouldUseNativeValidation,!0).then(W=>!ur(W)&&t._subjects.state.next({errors:LH(t._formState.errors,W,s)}))}t._subjects.state.next({name:s,values:Ln(t._formValues)}),t._names.focus&&wu(t._fields,(R,W)=>{if(t._names.focus&&W.startsWith(t._names.focus)&&R.focus)return R.focus(),1}),t._names.focus="",t._setValid(),h.current=!1},[l,s,t]),ot.useEffect(()=>(!et(t._formValues,s)&&t._setFieldArray(s),()=>{const R=(W,_)=>{const Y=et(t._fields,W);Y&&Y._f&&(Y._f.mount=_)};t._options.shouldUnregister||a?t.unregister(s):R(s,!1)}),[s,t,i,a]),{swap:ot.useCallback(v,[m,s,t]),move:ot.useCallback(S,[m,s,t]),prepend:ot.useCallback(p,[m,s,t]),append:ot.useCallback(f,[m,s,t]),remove:ot.useCallback(b,[m,s,t]),insert:ot.useCallback(x,[m,s,t]),update:ot.useCallback(B,[m,s,t]),replace:ot.useCallback(V,[m,s,t]),fields:ot.useMemo(()=>l.map((R,W)=>({...R,[i]:d.current[W]||jc()})),[l,i])}}function tn(n={}){const e=ot.useRef(void 0),t=ot.useRef(void 0),[s,i]=ot.useState({isDirty:!1,isValidating:!1,isLoading:Fa(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:Fa(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:s},n.defaultValues&&!Fa(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:o,...l}=Cee(n);e.current={...l,formState:s}}const a=e.current.control;return a._options=n,Bp(()=>{const o=a._subscribe({formState:a._proxyFormState,callback:()=>i({...a._formState}),reRenderRoot:!0});return i(l=>({...l,isReady:!0})),a._formState.isReady=!0,o},[a]),ot.useEffect(()=>a._disableForm(n.disabled),[a,n.disabled]),ot.useEffect(()=>{n.mode&&(a._options.mode=n.mode),n.reValidateMode&&(a._options.reValidateMode=n.reValidateMode)},[a,n.mode,n.reValidateMode]),ot.useEffect(()=>{n.errors&&(a._setErrors(n.errors),a._focusError())},[a,n.errors]),ot.useEffect(()=>{n.shouldUnregister&&a._subjects.state.next({values:a._getWatch()})},[a,n.shouldUnregister]),ot.useEffect(()=>{if(a._proxyFormState.isDirty){const o=a._getDirty();o!==s.isDirty&&a._subjects.state.next({isDirty:o})}},[a,s.isDirty]),ot.useEffect(()=>{n.values&&!Ya(n.values,t.current)?(a._reset(n.values,{keepFieldsRef:!0,...a._options.resetOptions}),t.current=n.values,i(o=>({...o}))):a._resetDefaultValues()},[a,n.values]),ot.useEffect(()=>{a._state.mount||(a._setValid(),a._state.mount=!0),a._state.watch&&(a._state.watch=!1,a._subjects.state.next({...a._formState})),a._removeUnmounted()}),e.current.formState=JH(s,a),e.current}const U2=(n,e,t)=>{if(n&&"reportValidity"in n){const s=et(t,e);n.setCustomValidity(s&&s.message||""),n.reportValidity()}},PH=(n,e)=>{for(const t in e.fields){const s=e.fields[t];s&&s.ref&&"reportValidity"in s.ref?U2(s.ref,t,n):s.refs&&s.refs.forEach(i=>U2(i,t,n))}},pee=(n,e)=>{e.shouldUseNativeValidation&&PH(n,e);const t={};for(const s in n){const i=et(e.fields,s),a=Object.assign(n[s]||{},{ref:i&&i.ref});if(Aee(e.names||Object.keys(n),s)){const o=Object.assign({},et(t,s));An(o,"root",a),An(t,s,o)}else An(t,s,a)}return t},Aee=(n,e)=>n.some(t=>t.startsWith(e+"."));function Yn(n,e,t){return e===void 0&&(e={}),t===void 0&&(t={}),function(s,i,a){try{return Promise.resolve((function(o,l){try{var c=(e.context,Promise.resolve(n[t.mode==="sync"?"validateSync":"validate"](s,Object.assign({abortEarly:!1},e,{context:i}))).then(function(d){return a.shouldUseNativeValidation&&PH({},a),{values:t.raw?s:d,errors:{}}}))}catch(d){return l(d)}return c&&c.then?c.then(void 0,l):c})(0,function(o){if(!o.inner)throw o;return{values:{},errors:pee((l=o,c=!a.shouldUseNativeValidation&&a.criteriaMode==="all",(l.inner||[]).reduce(function(d,h){if(d[h.path]||(d[h.path]={message:h.message,type:h.type}),c){var m=d[h.path].types,f=m&&m[h.type];d[h.path]=YH(h.path,c,d,h.type,f?[].concat(f,h.message):h.message)}return d},{})),a)};var l,c}))}catch(o){return Promise.reject(o)}}}var Qb,Q2;function bee(){if(Q2)return Qb;Q2=1;function n(S){this._maxSize=S,this.clear()}n.prototype.clear=function(){this._size=0,this._values=Object.create(null)},n.prototype.get=function(S){return this._values[S]},n.prototype.set=function(S,B){return this._size>=this._maxSize&&this.clear(),S in this._values||this._size++,this._values[S]=B};var e=/[^.^\]^[]+|(?=\[\]|\.\.)/g,t=/^\d+$/,s=/^\d/,i=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,a=/^\s*(['"]?)(.*?)(\1)\s*$/,o=512,l=new n(o),c=new n(o),d=new n(o);Qb={Cache:n,split:m,normalizePath:h,setter:function(S){var B=h(S);return c.get(S)||c.set(S,function(R,W){for(var _=0,Y=B.length,j=R;_<Y-1;){var M=B[_];if(M==="__proto__"||M==="constructor"||M==="prototype")return R;j=j[B[_++]]}j[B[_]]=W})},getter:function(S,B){var V=h(S);return d.get(S)||d.set(S,function(W){for(var _=0,Y=V.length;_<Y;)if(W!=null||!B)W=W[V[_++]];else return;return W})},join:function(S){return S.reduce(function(B,V){return B+(p(V)||t.test(V)?"["+V+"]":(B?".":"")+V)},"")},forEach:function(S,B,V){f(Array.isArray(S)?S:m(S),B,V)}};function h(S){return l.get(S)||l.set(S,m(S).map(function(B){return B.replace(a,"$2")}))}function m(S){return S.match(e)||[""]}function f(S,B,V){var R=S.length,W,_,Y,j;for(_=0;_<R;_++)W=S[_],W&&(v(W)&&(W='"'+W+'"'),j=p(W),Y=!j&&/^\d+$/.test(W),B.call(V,W,j,Y,_,S))}function p(S){return typeof S=="string"&&S&&["'",'"'].indexOf(S.charAt(0))!==-1}function b(S){return S.match(s)&&!S.match(t)}function x(S){return i.test(S)}function v(S){return!p(S)&&(b(S)||x(S))}return Qb}var Ag=bee(),qb,q2;function yee(){if(q2)return qb;q2=1;const n=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,e=h=>h.match(n)||[],t=h=>h[0].toUpperCase()+h.slice(1),s=(h,m)=>e(h).join(m).toLowerCase(),i=h=>e(h).reduce((m,f)=>`${m}${m?f[0].toUpperCase()+f.slice(1).toLowerCase():f.toLowerCase()}`,"");return qb={words:e,upperFirst:t,camelCase:i,pascalCase:h=>t(i(h)),snakeCase:h=>s(h,"_"),kebabCase:h=>s(h,"-"),sentenceCase:h=>t(s(h," ")),titleCase:h=>e(h).map(t).join(" ")},qb}var $b=yee(),rC={exports:{}},$2;function vee(){if($2)return rC.exports;$2=1,rC.exports=function(i){return n(e(i),i)},rC.exports.array=n;function n(i,a){var o=i.length,l=new Array(o),c={},d=o,h=t(a),m=s(i);for(a.forEach(function(p){if(!m.has(p[0])||!m.has(p[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});d--;)c[d]||f(i[d],d,new Set);return l;function f(p,b,x){if(x.has(p)){var v;try{v=", node was:"+JSON.stringify(p)}catch{v=""}throw new Error("Cyclic dependency"+v)}if(!m.has(p))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(p));if(!c[b]){c[b]=!0;var S=h.get(p)||new Set;if(S=Array.from(S),b=S.length){x.add(p);do{var B=S[--b];f(B,m.get(B),x)}while(b);x.delete(p)}l[--o]=p}}}function e(i){for(var a=new Set,o=0,l=i.length;o<l;o++){var c=i[o];a.add(c[0]),a.add(c[1])}return Array.from(a)}function t(i){for(var a=new Map,o=0,l=i.length;o<l;o++){var c=i[o];a.has(c[0])||a.set(c[0],new Set),a.has(c[1])||a.set(c[1],new Set),a.get(c[0]).add(c[1])}return a}function s(i){for(var a=new Map,o=0,l=i.length;o<l;o++)a.set(i[o],o);return a}return rC.exports}var xee=vee();const See=rd(xee),wee=Object.prototype.toString,Zee=Error.prototype.toString,Gee=RegExp.prototype.toString,Bee=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Nee=/^Symbol\((.*)\)(.*)$/;function kee(n){return n!=+n?"NaN":n===0&&1/n<0?"-0":""+n}function eW(n,e=!1){if(n==null||n===!0||n===!1)return""+n;const t=typeof n;if(t==="number")return kee(n);if(t==="string")return e?`"${n}"`:n;if(t==="function")return"[Function "+(n.name||"anonymous")+"]";if(t==="symbol")return Bee.call(n).replace(Nee,"Symbol($1)");const s=wee.call(n).slice(8,-1);return s==="Date"?isNaN(n.getTime())?""+n:n.toISOString(n):s==="Error"||n instanceof Error?"["+Zee.call(n)+"]":s==="RegExp"?Gee.call(n):null}function Wl(n,e){let t=eW(n,e);return t!==null?t:JSON.stringify(n,function(s,i){let a=eW(this[s],e);return a!==null?a:i},2)}function KH(n){return n==null?[]:[].concat(n)}let OH,zH,UH,Ree=/\$\{\s*(\w+)\s*\}/g;OH=Symbol.toStringTag;class tW{constructor(e,t,s,i){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[OH]="Error",this.name="ValidationError",this.value=t,this.path=s,this.type=i,this.errors=[],this.inner=[],KH(e).forEach(a=>{if(kr.isError(a)){this.errors.push(...a.errors);const o=a.inner.length?a.inner:[a];this.inner.push(...o)}else this.errors.push(a)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}zH=Symbol.hasInstance;UH=Symbol.toStringTag;class kr extends Error{static formatError(e,t){const s=t.label||t.path||"this";return t=Object.assign({},t,{path:s,originalPath:t.path}),typeof e=="string"?e.replace(Ree,(i,a)=>Wl(t[a])):typeof e=="function"?e(t):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,t,s,i,a){const o=new tW(e,t,s,i);if(a)return o;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[UH]="Error",this.name=o.name,this.message=o.message,this.type=o.type,this.value=o.value,this.path=o.path,this.errors=o.errors,this.inner=o.inner,Error.captureStackTrace&&Error.captureStackTrace(this,kr)}static[zH](e){return tW[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let So={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:n,type:e,value:t,originalValue:s})=>{const i=s!=null&&s!==t?` (cast from the value \`${Wl(s,!0)}\`).`:".";return e!=="mixed"?`${n} must be a \`${e}\` type, but the final value was: \`${Wl(t,!0)}\``+i:`${n} must match the configured type. The validated value was: \`${Wl(t,!0)}\``+i}},Qr={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Hc={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},vZ={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},xZ={isValue:"${path} field must be ${value}"},wf={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},Zf={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},Wee={notType:n=>{const{path:e,value:t,spec:s}=n,i=s.types.length;if(Array.isArray(t)){if(t.length<i)return`${e} tuple value has too few items, expected a length of ${i} but got ${t.length} for value: \`${Wl(t,!0)}\``;if(t.length>i)return`${e} tuple value has too many items, expected a length of ${i} but got ${t.length} for value: \`${Wl(t,!0)}\``}return kr.formatError(So.notType,n)}};Object.assign(Object.create(null),{mixed:So,string:Qr,number:Hc,date:vZ,object:wf,array:Zf,boolean:xZ,tuple:Wee});const Np=n=>n&&n.__isYupSchema__;class $f{static fromOptions(e,t){if(!t.then&&!t.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:s,then:i,otherwise:a}=t,o=typeof s=="function"?s:(...l)=>l.every(c=>c===s);return new $f(e,(l,c)=>{var d;let h=o(...l)?i:a;return(d=h?.(c))!=null?d:c})}constructor(e,t){this.fn=void 0,this.refs=e,this.refs=e,this.fn=t}resolve(e,t){let s=this.refs.map(a=>a.getValue(t?.value,t?.parent,t?.context)),i=this.fn(s,e,t);if(i===void 0||i===e)return e;if(!Np(i))throw new TypeError("conditions must return a schema object");return i.resolve(t)}}const iC={context:"$",value:"."};function wG(n,e){return new ud(n,e)}class ud{constructor(e,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===iC.context,this.isValue=this.key[0]===iC.value,this.isSibling=!this.isContext&&!this.isValue;let s=this.isContext?iC.context:this.isValue?iC.value:"";this.path=this.key.slice(s.length),this.getter=this.path&&Ag.getter(this.path,!0),this.map=t.map}getValue(e,t,s){let i=this.isContext?s:this.isValue?e:t;return this.getter&&(i=this.getter(i||{})),this.map&&(i=this.map(i)),i}cast(e,t){return this.getValue(e,t?.parent,t?.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}}ud.prototype.__isYupRef=!0;const Ma=n=>n==null;function ou(n){function e({value:t,path:s="",options:i,originalValue:a,schema:o},l,c){const{name:d,test:h,params:m,message:f,skipAbsent:p}=n;let{parent:b,context:x,abortEarly:v=o.spec.abortEarly,disableStackTrace:S=o.spec.disableStackTrace}=i;const B={value:t,parent:b,context:x};function V(D={}){const z=QH(Object.assign({value:t,originalValue:a,label:o.spec.label,path:D.path||s,spec:o.spec,disableStackTrace:D.disableStackTrace||S},m,D.params),B),O=new kr(kr.formatError(D.message||f,z),t,z.path,D.type||d,z.disableStackTrace);return O.params=z,O}const R=v?l:c;let W={path:s,parent:b,type:d,from:i.from,createError:V,resolve(D){return qH(D,B)},options:i,originalValue:a,schema:o};const _=D=>{kr.isError(D)?R(D):D?c(null):R(V())},Y=D=>{kr.isError(D)?R(D):l(D)};if(p&&Ma(t))return _(!0);let M;try{var H;if(M=h.call(W,t,W),typeof((H=M)==null?void 0:H.then)=="function"){if(i.sync)throw new Error(`Validation test of type: "${W.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(M).then(_,Y)}}catch(D){Y(D);return}_(M)}return e.OPTIONS=n,e}function QH(n,e){if(!n)return n;for(const t of Object.keys(n))n[t]=qH(n[t],e);return n}function qH(n,e){return ud.isRef(n)?n.getValue(e.value,e.parent,e.context):n}function Vee(n,e,t,s=t){let i,a,o;return e?(Ag.forEach(e,(l,c,d)=>{let h=c?l.slice(1,l.length-1):l;n=n.resolve({context:s,parent:i,value:t});let m=n.type==="tuple",f=d?parseInt(h,10):0;if(n.innerType||m){if(m&&!d)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${o}" must contain an index to the tuple element, e.g. "${o}[0]"`);if(t&&f>=t.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${l}, in the path: ${e}. because there is no value at that index. `);i=t,t=t&&t[f],n=m?n.spec.types[f]:n.innerType}if(!d){if(!n.fields||!n.fields[h])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${o} which is a type: "${n.type}")`);i=t,t=t&&t[h],n=n.fields[h]}a=h,o=c?"["+l+"]":"."+l}),{schema:n,parent:i,parentPath:a}):{parent:i,parentPath:e,schema:n}}class ep extends Set{describe(){const e=[];for(const t of this.values())e.push(ud.isRef(t)?t.describe():t);return e}resolveAll(e){let t=[];for(const s of this.values())t.push(e(s));return t}clone(){return new ep(this.values())}merge(e,t){const s=this.clone();return e.forEach(i=>s.add(i)),t.forEach(i=>s.delete(i)),s}}function bu(n,e=new Map){if(Np(n)||!n||typeof n!="object")return n;if(e.has(n))return e.get(n);let t;if(n instanceof Date)t=new Date(n.getTime()),e.set(n,t);else if(n instanceof RegExp)t=new RegExp(n),e.set(n,t);else if(Array.isArray(n)){t=new Array(n.length),e.set(n,t);for(let s=0;s<n.length;s++)t[s]=bu(n[s],e)}else if(n instanceof Map){t=new Map,e.set(n,t);for(const[s,i]of n.entries())t.set(s,bu(i,e))}else if(n instanceof Set){t=new Set,e.set(n,t);for(const s of n)t.add(bu(s,e))}else if(n instanceof Object){t={},e.set(n,t);for(const[s,i]of Object.entries(n))t[s]=bu(i,e)}else throw Error(`Unable to clone ${n}`);return t}function _ee(n){if(!(n!=null&&n.length))return;const e=[];let t="",s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];if(o==="["&&!i){t&&(e.push(...t.split(".").filter(Boolean)),t=""),s=!0;continue}if(o==="]"&&!i){t&&(/^\d+$/.test(t)?e.push(t):e.push(t.replace(/^"|"$/g,"")),t=""),s=!1;continue}if(o==='"'){i=!i;continue}if(o==="."&&!s&&!i){t&&(e.push(t),t="");continue}t+=o}return t&&e.push(...t.split(".").filter(Boolean)),e}function jee(n,e){const t=e?`${e}.${n.path}`:n.path;return n.errors.map(s=>({message:s,path:_ee(t)}))}function $H(n,e){var t;if(!((t=n.inner)!=null&&t.length)&&n.errors.length)return jee(n,e);const s=e?`${e}.${n.path}`:n.path;return n.inner.flatMap(i=>$H(i,s))}class ri{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new ep,this._blacklist=new ep,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(So.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e?.spec),this.withMutation(t=>{t.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=bu(Object.assign({},this.spec,e)),t}label(e){let t=this.clone();return t.spec.label=e,t}meta(...e){if(e.length===0)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}withMutation(e){let t=this._mutate;this._mutate=!0;let s=e(this);return this._mutate=t,s}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let t=this,s=e.clone();const i=Object.assign({},t.spec,s.spec);return s.spec=i,s.internalTests=Object.assign({},t.internalTests,s.internalTests),s._whitelist=t._whitelist.merge(e._whitelist,e._blacklist),s._blacklist=t._blacklist.merge(e._blacklist,e._whitelist),s.tests=t.tests,s.exclusiveTests=t.exclusiveTests,s.withMutation(a=>{e.tests.forEach(o=>{a.test(o.OPTIONS)})}),s.transforms=[...t.transforms,...s.transforms],s}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let t=this;if(t.conditions.length){let s=t.conditions;t=t.clone(),t.conditions=[],t=s.reduce((i,a)=>a.resolve(i,e),t),t=t.resolve(e)}return t}resolveOptions(e){var t,s,i,a;return Object.assign({},e,{from:e.from||[],strict:(t=e.strict)!=null?t:this.spec.strict,abortEarly:(s=e.abortEarly)!=null?s:this.spec.abortEarly,recursive:(i=e.recursive)!=null?i:this.spec.recursive,disableStackTrace:(a=e.disableStackTrace)!=null?a:this.spec.disableStackTrace})}cast(e,t={}){let s=this.resolve(Object.assign({},t,{value:e})),i=t.assert==="ignore-optionality",a=s._cast(e,t);if(t.assert!==!1&&!s.isType(a)){if(i&&Ma(a))return a;let o=Wl(e),l=Wl(a);throw new TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${s.type}". 

attempted value: ${o} 
`+(l!==o?`result of cast: ${l}`:""))}return a}_cast(e,t){let s=e===void 0?e:this.transforms.reduce((i,a)=>a.call(this,i,e,this,t),e);return s===void 0&&(s=this.getDefault(t)),s}_validate(e,t={},s,i){let{path:a,originalValue:o=e,strict:l=this.spec.strict}=t,c=e;l||(c=this._cast(c,Object.assign({assert:!1},t)));let d=[];for(let h of Object.values(this.internalTests))h&&d.push(h);this.runTests({path:a,value:c,originalValue:o,options:t,tests:d},s,h=>{if(h.length)return i(h,c);this.runTests({path:a,value:c,originalValue:o,options:t,tests:this.tests},s,i)})}runTests(e,t,s){let i=!1,{tests:a,value:o,originalValue:l,path:c,options:d}=e,h=x=>{i||(i=!0,t(x,o))},m=x=>{i||(i=!0,s(x,o))},f=a.length,p=[];if(!f)return m([]);let b={value:o,originalValue:l,path:c,options:d,schema:this};for(let x=0;x<a.length;x++){const v=a[x];v(b,h,function(B){B&&(Array.isArray(B)?p.push(...B):p.push(B)),--f<=0&&m(p)})}}asNestedTest({key:e,index:t,parent:s,parentPath:i,originalParent:a,options:o}){const l=e??t;if(l==null)throw TypeError("Must include `key` or `index` for nested validations");const c=typeof l=="number";let d=s[l];const h=Object.assign({},o,{strict:!0,parent:s,value:d,originalValue:a[l],key:void 0,[c?"index":"key"]:l,path:c||l.includes(".")?`${i||""}[${c?l:`"${l}"`}]`:(i?`${i}.`:"")+e});return(m,f,p)=>this.resolve(h)._validate(d,h,f,p)}validate(e,t){var s;let i=this.resolve(Object.assign({},t,{value:e})),a=(s=t?.disableStackTrace)!=null?s:i.spec.disableStackTrace;return new Promise((o,l)=>i._validate(e,t,(c,d)=>{kr.isError(c)&&(c.value=d),l(c)},(c,d)=>{c.length?l(new kr(c,d,void 0,void 0,a)):o(d)}))}validateSync(e,t){var s;let i=this.resolve(Object.assign({},t,{value:e})),a,o=(s=t?.disableStackTrace)!=null?s:i.spec.disableStackTrace;return i._validate(e,Object.assign({},t,{sync:!0}),(l,c)=>{throw kr.isError(l)&&(l.value=c),l},(l,c)=>{if(l.length)throw new kr(l,e,void 0,void 0,o);a=c}),a}isValid(e,t){return this.validate(e,t).then(()=>!0,s=>{if(kr.isError(s))return!1;throw s})}isValidSync(e,t){try{return this.validateSync(e,t),!0}catch(s){if(kr.isError(s))return!1;throw s}}_getDefault(e){let t=this.spec.default;return t==null?t:typeof t=="function"?t.call(this,e):bu(t)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,t){const s=this.clone({nullable:e});return s.internalTests.nullable=ou({message:t,name:"nullable",test(i){return i===null?this.schema.spec.nullable:!0}}),s}optionality(e,t){const s=this.clone({optional:e});return s.internalTests.optionality=ou({message:t,name:"optionality",test(i){return i===void 0?this.schema.spec.optional:!0}}),s}optional(){return this.optionality(!0)}defined(e=So.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=So.notNull){return this.nullability(!1,e)}required(e=So.required){return this.clone().withMutation(t=>t.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let t=this.clone();return t.transforms.push(e),t}test(...e){let t;if(e.length===1?typeof e[0]=="function"?t={test:e[0]}:t=e[0]:e.length===2?t={name:e[0],test:e[1]}:t={name:e[0],message:e[1],test:e[2]},t.message===void 0&&(t.message=So.default),typeof t.test!="function")throw new TypeError("`test` is a required parameters");let s=this.clone(),i=ou(t),a=t.exclusive||t.name&&s.exclusiveTests[t.name]===!0;if(t.exclusive&&!t.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(s.exclusiveTests[t.name]=!!t.exclusive),s.tests=s.tests.filter(o=>!(o.OPTIONS.name===t.name&&(a||o.OPTIONS.test===i.OPTIONS.test))),s.tests.push(i),s}when(e,t){!Array.isArray(e)&&typeof e!="string"&&(t=e,e=".");let s=this.clone(),i=KH(e).map(a=>new ud(a));return i.forEach(a=>{a.isSibling&&s.deps.push(a.key)}),s.conditions.push(typeof t=="function"?new $f(i,t):$f.fromOptions(i,t)),s}typeError(e){let t=this.clone();return t.internalTests.typeError=ou({message:e,name:"typeError",skipAbsent:!0,test(s){return this.schema._typeCheck(s)?!0:this.createError({params:{type:this.schema.type}})}}),t}oneOf(e,t=So.oneOf){let s=this.clone();return e.forEach(i=>{s._whitelist.add(i),s._blacklist.delete(i)}),s.internalTests.whiteList=ou({message:t,name:"oneOf",skipAbsent:!0,test(i){let a=this.schema._whitelist,o=a.resolveAll(this.resolve);return o.includes(i)?!0:this.createError({params:{values:Array.from(a).join(", "),resolved:o}})}}),s}notOneOf(e,t=So.notOneOf){let s=this.clone();return e.forEach(i=>{s._blacklist.add(i),s._whitelist.delete(i)}),s.internalTests.blacklist=ou({message:t,name:"notOneOf",test(i){let a=this.schema._blacklist,o=a.resolveAll(this.resolve);return o.includes(i)?this.createError({params:{values:Array.from(a).join(", "),resolved:o}}):!0}}),s}strip(e=!0){let t=this.clone();return t.spec.strip=e,t}describe(e){const t=(e?this.resolve(e):this).clone(),{label:s,meta:i,optional:a,nullable:o}=t.spec;return{meta:i,label:s,optional:a,nullable:o,default:t.getDefault(e),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.filter((c,d,h)=>h.findIndex(m=>m.OPTIONS.name===c.OPTIONS.name)===d).map(c=>{const d=c.OPTIONS.params&&e?QH(Object.assign({},c.OPTIONS.params),e):c.OPTIONS.params;return{name:c.OPTIONS.name,params:d}})}}get"~standard"(){const e=this;return{version:1,vendor:"yup",async validate(s){try{return{value:await e.validate(s,{abortEarly:!1})}}catch(i){if(i instanceof kr)return{issues:$H(i)};throw i}}}}}ri.prototype.__isYupSchema__=!0;for(const n of["validate","validateSync"])ri.prototype[`${n}At`]=function(e,t,s={}){const{parent:i,parentPath:a,schema:o}=Vee(this,e,t,s.context);return o[n](i&&i[a],Object.assign({},s,{parent:i,path:e}))};for(const n of["equals","is"])ri.prototype[n]=ri.prototype.oneOf;for(const n of["not","nope"])ri.prototype[n]=ri.prototype.notOneOf;const Xee=()=>!0;function Et(n){return new eT(n)}class eT extends ri{constructor(e){super(typeof e=="function"?{type:"mixed",check:e}:Object.assign({type:"mixed",check:Xee},e))}}Et.prototype=eT.prototype;function hr(){return new tT}class tT extends ri{constructor(){super({type:"boolean",check(e){return e instanceof Boolean&&(e=e.valueOf()),typeof e=="boolean"}}),this.withMutation(()=>{this.transform((e,t)=>{if(this.spec.coerce&&!this.isType(e)){if(/^(true|1)$/i.test(String(e)))return!0;if(/^(false|0)$/i.test(String(e)))return!1}return e})})}isTrue(e=xZ.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"true"},test(t){return Ma(t)||t===!0}})}isFalse(e=xZ.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"false"},test(t){return Ma(t)||t===!1}})}default(e){return super.default(e)}defined(e){return super.defined(e)}optional(){return super.optional()}required(e){return super.required(e)}notRequired(){return super.notRequired()}nullable(){return super.nullable()}nonNullable(e){return super.nonNullable(e)}strip(e){return super.strip(e)}}hr.prototype=tT.prototype;const Jee=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function Yee(n){const e=SZ(n);if(!e)return Date.parse?Date.parse(n):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let t=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(t=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(t=0-t)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+t,e.second,e.millisecond)}function SZ(n){var e,t;const s=Jee.exec(n);return s?{year:bl(s[1]),month:bl(s[2],1)-1,day:bl(s[3],1),hour:bl(s[4]),minute:bl(s[5]),second:bl(s[6]),millisecond:s[7]?bl(s[7].substring(0,3)):0,precision:(e=(t=s[7])==null?void 0:t.length)!=null?e:void 0,z:s[8]||void 0,plusMinus:s[9]||void 0,hourOffset:bl(s[10]),minuteOffset:bl(s[11])}:null}function bl(n,e=0){return Number(n)||e}let Fee=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Mee=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Hee=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Tee="^\\d{4}-\\d{2}-\\d{2}",Eee="\\d{2}:\\d{2}:\\d{2}",Dee="(([+-]\\d{2}(:?\\d{2})?)|Z)",Lee=new RegExp(`${Tee}T${Eee}(\\.\\d+)?${Dee}$`),Pee=n=>Ma(n)||n===n.trim(),Kee={}.toString();function pe(){return new nT}class nT extends ri{constructor(){super({type:"string",check(e){return e instanceof String&&(e=e.valueOf()),typeof e=="string"}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce||this.isType(e)||Array.isArray(e))return e;const s=e!=null&&e.toString?e.toString():e;return s===Kee?e:s})})}required(e){return super.required(e).withMutation(t=>t.test({message:e||So.required,name:"required",skipAbsent:!0,test:s=>!!s.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(t=>t.OPTIONS.name!=="required"),e))}length(e,t=Qr.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(s){return s.length===this.resolve(e)}})}min(e,t=Qr.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(s){return s.length>=this.resolve(e)}})}max(e,t=Qr.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:e},skipAbsent:!0,test(s){return s.length<=this.resolve(e)}})}matches(e,t){let s=!1,i,a;return t&&(typeof t=="object"?{excludeEmptyString:s=!1,message:i,name:a}=t:i=t),this.test({name:a||"matches",message:i||Qr.matches,params:{regex:e},skipAbsent:!0,test:o=>o===""&&s||o.search(e)!==-1})}email(e=Qr.email){return this.matches(Fee,{name:"email",message:e,excludeEmptyString:!0})}url(e=Qr.url){return this.matches(Mee,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=Qr.uuid){return this.matches(Hee,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let t="",s,i;return e&&(typeof e=="object"?{message:t="",allowOffset:s=!1,precision:i=void 0}=e:t=e),this.matches(Lee,{name:"datetime",message:t||Qr.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:t||Qr.datetime_offset,params:{allowOffset:s},skipAbsent:!0,test:a=>{if(!a||s)return!0;const o=SZ(a);return o?!!o.z:!1}}).test({name:"datetime_precision",message:t||Qr.datetime_precision,params:{precision:i},skipAbsent:!0,test:a=>{if(!a||i==null)return!0;const o=SZ(a);return o?o.precision===i:!1}})}ensure(){return this.default("").transform(e=>e===null?"":e)}trim(e=Qr.trim){return this.transform(t=>t!=null?t.trim():t).test({message:e,name:"trim",test:Pee})}lowercase(e=Qr.lowercase){return this.transform(t=>Ma(t)?t:t.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>Ma(t)||t===t.toLowerCase()})}uppercase(e=Qr.uppercase){return this.transform(t=>Ma(t)?t:t.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>Ma(t)||t===t.toUpperCase()})}}pe.prototype=nT.prototype;let Oee=n=>n!=+n;function mr(){return new sT}class sT extends ri{constructor(){super({type:"number",check(e){return e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&!Oee(e)}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce)return e;let s=e;if(typeof s=="string"){if(s=s.replace(/\s/g,""),s==="")return NaN;s=+s}return this.isType(s)||s===null?s:parseFloat(s)})})}min(e,t=Hc.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(s){return s>=this.resolve(e)}})}max(e,t=Hc.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(s){return s<=this.resolve(e)}})}lessThan(e,t=Hc.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:e},skipAbsent:!0,test(s){return s<this.resolve(e)}})}moreThan(e,t=Hc.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:e},skipAbsent:!0,test(s){return s>this.resolve(e)}})}positive(e=Hc.positive){return this.moreThan(0,e)}negative(e=Hc.negative){return this.lessThan(0,e)}integer(e=Hc.integer){return this.test({name:"integer",message:e,skipAbsent:!0,test:t=>Number.isInteger(t)})}truncate(){return this.transform(e=>Ma(e)?e:e|0)}round(e){var t;let s=["ceil","floor","round","trunc"];if(e=((t=e)==null?void 0:t.toLowerCase())||"round",e==="trunc")return this.truncate();if(s.indexOf(e.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+s.join(", "));return this.transform(i=>Ma(i)?i:Math[e](i))}}mr.prototype=sT.prototype;let zee=new Date(""),Uee=n=>Object.prototype.toString.call(n)==="[object Date]";class ZG extends ri{constructor(){super({type:"date",check(e){return Uee(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,t)=>!this.spec.coerce||this.isType(e)||e===null?e:(e=Yee(e),isNaN(e)?ZG.INVALID_DATE:new Date(e)))})}prepareParam(e,t){let s;if(ud.isRef(e))s=e;else{let i=this.cast(e);if(!this._typeCheck(i))throw new TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);s=i}return s}min(e,t=vZ.min){let s=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(i){return i>=this.resolve(s)}})}max(e,t=vZ.max){let s=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(i){return i<=this.resolve(s)}})}}ZG.INVALID_DATE=zee;function Qee(n,e=[]){let t=[],s=new Set,i=new Set(e.map(([o,l])=>`${o}-${l}`));function a(o,l){let c=Ag.split(o)[0];s.add(c),i.has(`${l}-${c}`)||t.push([l,c])}for(const o of Object.keys(n)){let l=n[o];s.add(o),ud.isRef(l)&&l.isSibling?a(l.path,o):Np(l)&&"deps"in l&&l.deps.forEach(c=>a(c,o))}return See.array(Array.from(s),t).reverse()}function nW(n,e){let t=1/0;return n.some((s,i)=>{var a;if((a=e.path)!=null&&a.includes(s))return t=i,!0}),t}function rT(n){return(e,t)=>nW(n,e)-nW(n,t)}const iT=(n,e,t)=>{if(typeof n!="string")return n;let s=n;try{s=JSON.parse(n)}catch{}return t.isType(s)?s:n};function Gf(n){if("fields"in n){const e={};for(const[t,s]of Object.entries(n.fields))e[t]=Gf(s);return n.setFields(e)}if(n.type==="array"){const e=n.optional();return e.innerType&&(e.innerType=Gf(e.innerType)),e}return n.type==="tuple"?n.optional().clone({types:n.spec.types.map(Gf)}):"optional"in n?n.optional():n}const qee=(n,e)=>{const t=[...Ag.normalizePath(e)];if(t.length===1)return t[0]in n;let s=t.pop(),i=Ag.getter(Ag.join(t),!0)(n);return!!(i&&s in i)};let sW=n=>Object.prototype.toString.call(n)==="[object Object]";function rW(n,e){let t=Object.keys(n.fields);return Object.keys(e).filter(s=>t.indexOf(s)===-1)}const $ee=rT([]);function Bt(n){return new aT(n)}class aT extends ri{constructor(e){super({type:"object",check(t){return sW(t)||typeof t=="function"}}),this.fields=Object.create(null),this._sortErrors=$ee,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,t={}){var s;let i=super._cast(e,t);if(i===void 0)return this.getDefault(t);if(!this._typeCheck(i))return i;let a=this.fields,o=(s=t.stripUnknown)!=null?s:this.spec.noUnknown,l=[].concat(this._nodes,Object.keys(i).filter(m=>!this._nodes.includes(m))),c={},d=Object.assign({},t,{parent:c,__validating:t.__validating||!1}),h=!1;for(const m of l){let f=a[m],p=m in i,b=i[m];if(f){let x;d.path=(t.path?`${t.path}.`:"")+m,f=f.resolve({value:b,context:t.context,parent:c});let v=f instanceof ri?f.spec:void 0,S=v?.strict;if(v!=null&&v.strip){h=h||m in i;continue}x=!t.__validating||!S?f.cast(b,d):b,x!==void 0&&(c[m]=x)}else p&&!o&&(c[m]=b);(p!==m in c||c[m]!==b)&&(h=!0)}return h?c:i}_validate(e,t={},s,i){let{from:a=[],originalValue:o=e,recursive:l=this.spec.recursive}=t;t.from=[{schema:this,value:o},...a],t.__validating=!0,t.originalValue=o,super._validate(e,t,s,(c,d)=>{if(!l||!sW(d)){i(c,d);return}o=o||d;let h=[];for(let m of this._nodes){let f=this.fields[m];!f||ud.isRef(f)||h.push(f.asNestedTest({options:t,key:m,parent:d,parentPath:t.path,originalParent:o}))}this.runTests({tests:h,value:d,originalValue:o,options:t},s,m=>{i(m.sort(this._sortErrors).concat(c),d)})})}clone(e){const t=super.clone(e);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(e){let t=super.concat(e),s=t.fields;for(let[i,a]of Object.entries(this.fields)){const o=s[i];s[i]=o===void 0?a:o}return t.withMutation(i=>i.setFields(s,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let t={};return this._nodes.forEach(s=>{var i;const a=this.fields[s];let o=e;(i=o)!=null&&i.value&&(o=Object.assign({},o,{parent:o.value,value:o.value[s]})),t[s]=a&&"getDefault"in a?a.getDefault(o):void 0}),t}setFields(e,t){let s=this.clone();return s.fields=e,s._nodes=Qee(e,t),s._sortErrors=rT(Object.keys(e)),t&&(s._excludedEdges=t),s}shape(e,t=[]){return this.clone().withMutation(s=>{let i=s._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),i=[...s._excludedEdges,...t]),s.setFields(Object.assign(s.fields,e),i)})}partial(){const e={};for(const[t,s]of Object.entries(this.fields))e[t]="optional"in s&&s.optional instanceof Function?s.optional():s;return this.setFields(e)}deepPartial(){return Gf(this)}pick(e){const t={};for(const s of e)this.fields[s]&&(t[s]=this.fields[s]);return this.setFields(t,this._excludedEdges.filter(([s,i])=>e.includes(s)&&e.includes(i)))}omit(e){const t=[];for(const s of Object.keys(this.fields))e.includes(s)||t.push(s);return this.pick(t)}from(e,t,s){let i=Ag.getter(e,!0);return this.transform(a=>{if(!a)return a;let o=a;return qee(a,e)&&(o=Object.assign({},a),s||delete o[e],o[t]=i(a)),o})}json(){return this.transform(iT)}exact(e){return this.test({name:"exact",exclusive:!0,message:e||wf.exact,test(t){if(t==null)return!0;const s=rW(this.schema,t);return s.length===0||this.createError({params:{properties:s.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(e=!0,t=wf.noUnknown){typeof e!="boolean"&&(t=e,e=!0);let s=this.test({name:"noUnknown",exclusive:!0,message:t,test(i){if(i==null)return!0;const a=rW(this.schema,i);return!e||a.length===0||this.createError({params:{unknown:a.join(", ")}})}});return s.spec.noUnknown=e,s}unknown(e=!0,t=wf.noUnknown){return this.noUnknown(!e,t)}transformKeys(e){return this.transform(t=>{if(!t)return t;const s={};for(const i of Object.keys(t))s[e(i)]=t[i];return s})}camelCase(){return this.transformKeys($b.camelCase)}snakeCase(){return this.transformKeys($b.snakeCase)}constantCase(){return this.transformKeys(e=>$b.snakeCase(e).toUpperCase())}describe(e){const t=(e?this.resolve(e):this).clone(),s=super.describe(e);s.fields={};for(const[a,o]of Object.entries(t.fields)){var i;let l=e;(i=l)!=null&&i.value&&(l=Object.assign({},l,{parent:l.value,value:l.value[a]})),s.fields[a]=o.describe(l)}return s}}Bt.prototype=aT.prototype;function Rr(n){return new oT(n)}class oT extends ri{constructor(e){super({type:"array",spec:{types:e},check(t){return Array.isArray(t)}}),this.innerType=void 0,this.innerType=e}_cast(e,t){const s=super._cast(e,t);if(!this._typeCheck(s)||!this.innerType)return s;let i=!1;const a=s.map((o,l)=>{const c=this.innerType.cast(o,Object.assign({},t,{path:`${t.path||""}[${l}]`,parent:s,originalValue:o,value:o,index:l}));return c!==o&&(i=!0),c});return i?a:s}_validate(e,t={},s,i){var a;let o=this.innerType,l=(a=t.recursive)!=null?a:this.spec.recursive;t.originalValue!=null&&t.originalValue,super._validate(e,t,s,(c,d)=>{var h;if(!l||!o||!this._typeCheck(d)){i(c,d);return}let m=new Array(d.length);for(let p=0;p<d.length;p++){var f;m[p]=o.asNestedTest({options:t,index:p,parent:d,parentPath:t.path,originalParent:(f=t.originalValue)!=null?f:e})}this.runTests({value:d,tests:m,originalValue:(h=t.originalValue)!=null?h:e,options:t},s,p=>i(p.concat(c),d))})}clone(e){const t=super.clone(e);return t.innerType=this.innerType,t}json(){return this.transform(iT)}concat(e){let t=super.concat(e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}of(e){let t=this.clone();if(!Np(e))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+Wl(e));return t.innerType=e,t.spec=Object.assign({},t.spec,{types:e}),t}length(e,t=Zf.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(s){return s.length===this.resolve(e)}})}min(e,t){return t=t||Zf.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(s){return s.length>=this.resolve(e)}})}max(e,t){return t=t||Zf.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(s){return s.length<=this.resolve(e)}})}ensure(){return this.default(()=>[]).transform((e,t)=>this._typeCheck(e)?e:t==null?[]:[].concat(t))}compact(e){let t=e?(s,i,a)=>!e(s,i,a):s=>!!s;return this.transform(s=>s!=null?s.filter(t):s)}describe(e){const t=(e?this.resolve(e):this).clone(),s=super.describe(e);if(t.innerType){var i;let a=e;(i=a)!=null&&i.value&&(a=Object.assign({},a,{parent:a.value,value:a.value[0]})),s.innerType=t.innerType.describe(a)}return s}}Rr.prototype=oT.prototype;const be=k.forwardRef(({label:n,id:e,error:t,registration:s,className:i,labelClassName:a,...o},l)=>{const h=`form-input ${t?"form-input--error":""} ${i||""}`;return r.jsxs("div",{children:[n&&r.jsx("label",{htmlFor:e,className:`block text-sm font-medium text-muted ${a||""}`,children:n}),r.jsx("div",{className:n?"mt-1":"",children:r.jsx("input",{ref:l,id:e,className:h,"aria-invalid":!!t,...s,...o})}),t&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:t})]})});be.displayName="Input";const Nn=k.forwardRef(({id:n,label:e,description:t,className:s,labelClassName:i,inputClassName:a,...o},l)=>{const c=n||o.name;return r.jsxs("div",{className:`relative flex items-start ${s}`,children:[r.jsx("div",{className:"flex h-6 items-center",children:r.jsx("input",{id:c,"aria-describedby":t?`${c}-description`:void 0,type:"checkbox",ref:l,className:`h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent cursor-pointer ${a||""}`,...o})}),r.jsxs("div",{className:"ml-3 text-sm leading-6",children:[r.jsx("label",{htmlFor:c,className:`font-medium text-primary-text cursor-pointer ${i}`,children:e}),t&&r.jsx("p",{id:`${c}-description`,className:"text-muted",children:t})]})]})});Nn.displayName="Checkbox";function ete(){const[n,e]=k.useState(null),[t,s]=k.useState(!1),[i,a]=k.useState(null);return k.useEffect(()=>{const l=(()=>{const m=navigator.userAgent,f=`${window.screen.width}x${window.screen.height}`,p=Intl.DateTimeFormat().resolvedOptions().timeZone,b=navigator.language,x=navigator.platform,v=navigator.hardwareConcurrency||0,S=`${m}|${f}|${p}|${b}|${x}|${v}`;let B=0;for(let _=0;_<S.length;_++){const Y=S.charCodeAt(_);B=(B<<5)-B+Y,B=B&B}const V="dev_"+Math.abs(B).toString(36),R=()=>m.indexOf("Chrome")>-1?"Chrome":m.indexOf("Firefox")>-1?"Firefox":m.indexOf("Safari")>-1?"Safari":m.indexOf("Edge")>-1?"Edge":"Unknown",W=()=>m.indexOf("Win")>-1?"Windows":m.indexOf("Mac")>-1?"MacOS":m.indexOf("Linux")>-1?"Linux":m.indexOf("Android")>-1?"Android":m.indexOf("iOS")>-1?"iOS":"Unknown";return{deviceId:V,deviceName:`${W()} - ${R()}`,browser:R(),os:W(),timestamp:new Date().toISOString()}})();e(l);const c=localStorage.getItem("device_id"),d=localStorage.getItem("device_name"),h=localStorage.getItem("device_timestamp");c&&c!==l.deviceId&&(s(!0),a({deviceId:c,deviceName:d||"Unknown Device",browser:"",os:"",timestamp:h||new Date().toISOString()})),localStorage.setItem("device_id",l.deviceId),localStorage.setItem("device_name",l.deviceName),localStorage.setItem("device_timestamp",l.timestamp)},[]),{deviceInfo:n,isNewDevice:t,previousDevice:i}}const tte=Bt({email:pe().email("Must be a valid email").required("Email is required"),password:pe().required("Password is required"),rememberMe:hr().optional()}).defined(),nte=n=>n.role==="unverified"?"/pending-approval":"/profile",ste=()=>{const{user:n,loginWithEmail:e,loginWithGoogle:t,error:s,setError:i,loading:a,setLoginAnimationPending:o,isLoginAnimationPending:l}=bt(),{colorScheme:c}=an(),d=Is(c),h=vt(),m=er(),{deviceInfo:f,isNewDevice:p,previousDevice:b}=ete(),[x,v]=k.useState(!1),[S,B]=k.useState(!1);k.useEffect(()=>{i(null);const H=new URLSearchParams(m.hash.substring(1)),D=H.get("error_code"),z=H.get("error_description");D==="otp_expired"&&z&&(i("Email confirmation link has expired or is invalid. Please try signing up again or request a new confirmation email."),h("/auth/login",{replace:!0}))},[i,m,h]),k.useEffect(()=>{n&&p&&b&&!x&&(ce.sendDeviceChangeAlert(n.id,n.name,b.deviceName,f?.deviceName||"Unknown Device").catch(H=>console.error("Failed to send device change alert:",H)),v(!0))},[n,p,b,x,f]),k.useEffect(()=>{n&&!l&&h(nte(n),{replace:!0})},[n,h,l]);const{register:V,handleSubmit:R,setValue:W,formState:{errors:_}}=tn({resolver:Yn(tte)});k.useEffect(()=>{const H=localStorage.getItem("rememberedEmail");H&&(W("email",H),W("rememberMe",!0)),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&W("rememberMe",!0)},[W]);const Y=async H=>{o(!0);const z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:H.rememberMe||!1;(await e(H.email,H.password,z)).error?o(!1):(B(!0),setTimeout(()=>{o(!1)},1500))},j=async()=>{await t()},M=a||S;return r.jsxs(r.Fragment,{children:[r.jsxs("form",{onSubmit:R(Y),className:"space-y-3",children:[r.jsxs("fieldset",{disabled:M,className:"space-y-3",children:[r.jsxs("div",{className:"relative group",children:[r.jsx(th,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-[#22c55e] transition-colors pointer-events-none"}),r.jsx(be,{id:"email",type:"email",autoComplete:"email",placeholder:"Email",registration:V("email"),error:_.email?.message,className:"!pl-12 !bg-black/60 !text-white !border-white/10 focus:!border-[#22c55e] placeholder:!text-gray-500 !py-3 !rounded-xl transition-all"})]}),r.jsxs("div",{className:"relative group",children:[r.jsx(hZ,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-[#22c55e] transition-colors pointer-events-none"}),r.jsx(be,{id:"password",type:"password",autoComplete:"current-password",placeholder:"Password",registration:V("password"),error:_.password?.message,className:"!pl-12 !bg-black/60 !text-white !border-white/10 focus:!border-[#22c55e] placeholder:!text-gray-500 !py-3 !rounded-xl transition-all"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex-shrink-0 login-checkbox-container",children:[r.jsx(Nn,{id:"rememberMe",label:"Remember me",labelClassName:"!text-white font-medium",...V("rememberMe"),inputClassName:"text-blue-600 focus:ring-blue-600 border-white/20 rounded bg-black/40"}),r.jsx("style",{dangerouslySetInnerHTML:{__html:`
                                .login-checkbox-container label {
                                    color: #ffffff !important;
                                    opacity: 1 !important;
                                    pointer-events: auto !important;
                                    position: relative !important;
                                    z-index: 10 !important;
                                }
                            `}})]}),r.jsx(aa,{to:"/auth/forgot-password",className:`text-sm font-medium !text-white hover:text-gray-200 transition-colors auth-link ${M?"pointer-events-none opacity-50":""}`,"aria-disabled":M,onClick:H=>{M&&H.preventDefault()},style:{color:"#ffffff"},children:"Forgot your password?"})]})]}),r.jsx("div",{className:"min-h-[24px] flex items-center justify-center",children:s&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-400 text-center p-2 bg-red-500/10 rounded-lg border border-red-500/20",children:[r.jsx(ca,{className:"h-4 w-4 flex-shrink-0"}),r.jsx("span",{children:s})]})}),r.jsx(se,{type:"submit",className:"w-full !font-bold !py-3 !rounded-full shadow-lg transition-all transform hover:scale-[1.02] signin-btn !text-white",style:{backgroundColor:d.activeItemBg,borderColor:d.sidebarBorder},isLoading:a&&!S,size:"lg",disabled:M&&!S,children:S?r.jsx(Rl,{className:"w-6 h-6 animate-bounce"}):"Sign In"})]}),r.jsxs("div",{className:"flex items-center my-6",children:[r.jsx("div",{className:"flex-1 border-t border-white/10"}),r.jsx("span",{className:"px-4 text-sm !text-white font-medium",children:"OR"}),r.jsx("div",{className:"flex-1 border-t border-white/10"})]}),r.jsxs("button",{type:"button",onClick:j,className:"w-full flex items-center justify-center gap-3 bg-white text-gray-900 hover:bg-gray-100 font-bold py-3 rounded-full transition-all transform hover:scale-[1.02] shadow-lg google-btn",disabled:M,children:[r.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 48 48",children:[r.jsx("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),r.jsx("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),r.jsx("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.487-11.181-8.264l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),r.jsx("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.99,35.508,44,30.021,44,24C44,22.659,43.862,21.35,43.611,20.083z"})]}),"Sign in with Google"]}),r.jsx("div",{className:"text-center mt-4",children:r.jsxs("p",{className:"text-sm !text-white",style:{color:"#ffffff"},children:["Don't have an account?"," ",r.jsx(aa,{to:"/auth/signup",className:"font-medium !text-white hover:text-gray-200 auth-link",style:{color:"#ffffff"},children:"Sign Up"})]})})]})},rte=Bt({name:pe().required("Your name is required"),email:pe().email("Must be a valid email").required("Email is required"),password:pe().min(6,"Password must be at least 6 characters").required("Password is required"),confirmPassword:pe().oneOf([wG("password")],"Passwords must match").required("Please confirm your password")}).defined(),ite=()=>{const{signUp:n}=bt(),[e,t]=k.useState(""),[s,i]=k.useState(!1),{register:a,handleSubmit:o,formState:{errors:l,isSubmitting:c}}=tn({resolver:Yn(rte)}),d=async h=>{t("");const{error:m}=await n(h.name,h.email,h.password);m?t(m.message):i(!0)};return s?r.jsxs("div",{className:"text-center",children:[r.jsx(CH,{className:"mx-auto h-12 w-12 text-accent"}),r.jsx("h3",{className:"mt-4 text-lg font-semibold text-white",style:{color:"#ffffff"},children:"Confirm your email"}),r.jsx("p",{className:"mt-2 text-sm text-gray-300",style:{color:"#ffffff"},children:"We've sent a confirmation link to your email address. Please click the link to activate your account."}),r.jsx("div",{className:"mt-6",children:r.jsx(aa,{to:"/auth/login",className:"font-medium text-white/80 hover:text-white",style:{color:"#ffffff"},children:" Back to Login"})})]}):r.jsxs("form",{onSubmit:o(d),className:"space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx(Jl,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),r.jsx(be,{id:"name",type:"text",placeholder:"Full Name",registration:a("name"),error:l.name?.message,className:"pl-11 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(th,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),r.jsx(be,{id:"email",type:"email",placeholder:"Email Address",registration:a("email"),error:l.email?.message,className:"pl-11 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(hZ,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),r.jsx(be,{id:"password",type:"password",placeholder:"Password",registration:a("password"),error:l.password?.message,className:"pl-11 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(hZ,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),r.jsx(be,{id:"confirmPassword",type:"password",placeholder:"Confirm Password",registration:a("confirmPassword"),error:l.confirmPassword?.message,className:"pl-11 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"})]}),e&&r.jsx("p",{className:"text-sm text-red-400 text-center",children:e}),r.jsx("div",{className:"pt-2",children:r.jsx(se,{type:"submit",className:"w-full",isLoading:c,size:"lg",children:"Sign Up"})}),r.jsx("div",{className:"text-center pt-2",children:r.jsx(aa,{to:"/auth/login",className:"text-sm font-medium text-white/80 hover:text-white",style:{color:"#ffffff"},children:"Already have an account? Sign In"})})]})},ate=Bt({email:pe().email("Must be a valid email").required("Email is required")}).defined(),ote=()=>{const{sendPasswordReset:n}=bt(),[e,t]=k.useState(""),[s,i]=k.useState(!1),a=vt();k.useEffect(()=>{if(s){const m=setTimeout(()=>{a("/auth/login",{replace:!0})},3e3);return()=>clearTimeout(m)}},[s,a]);const{register:o,handleSubmit:l,formState:{errors:c,isSubmitting:d}}=tn({resolver:Yn(ate)}),h=async m=>{t("");const{error:f}=await n(m.email);f&&f.message.includes("rate limit")?t("Too many attempts. Please wait a few minutes before trying again."):i(!0)};return s?r.jsxs("div",{className:"text-center",children:[r.jsx(CH,{className:"mx-auto h-12 w-12 text-accent"}),r.jsx("h3",{className:"mt-4 text-lg font-semibold text-white",style:{color:"#ffffff"},children:"Check your email"}),r.jsx("p",{className:"mt-2 text-sm text-gray-300",style:{color:"#ffffff"},children:"If an account exists for the email you provided, we've sent password reset instructions. Redirecting to login..."})]}):r.jsx(r.Fragment,{children:r.jsxs("form",{onSubmit:l(h),className:"space-y-6",children:[r.jsxs("div",{className:"relative group",children:[r.jsx(th,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-[#22c55e] transition-colors pointer-events-none z-10"}),r.jsx(be,{id:"email",type:"email",autoComplete:"email",placeholder:"Email Address",registration:o("email"),error:c.email?.message,className:"!pl-12 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-400 focus:!border-[#22c55e] !py-3 !rounded-xl transition-all"})]}),e&&r.jsx("p",{className:"text-sm text-red-400 text-center",children:e}),r.jsx("div",{children:r.jsx(se,{type:"submit",className:"w-full",isLoading:d,size:"lg",children:"Send Reset Link"})}),r.jsx("div",{className:"text-center",children:r.jsx(aa,{to:"/auth/login",className:"text-sm font-medium text-white/80 hover:text-white",style:{color:"#ffffff"},children:" Back to Login"})})]})})},lte=Bt({password:pe().min(6,"Password must be at least 6 characters").required("Password is required"),confirmPassword:pe().oneOf([wG("password")],"Passwords must match").required("Please confirm your password")}).defined(),cte=n=>{const e=n.toLowerCase();return e.includes("weak password")?"Password is too weak. Please use at least 6 characters.":e.includes("requires a recent login")?"For your security, please sign in again to continue.":(console.error("Unhandled auth error:",n),"Something went wrong. Please try again.")},dte=()=>{const[n,e]=k.useState(""),[t,s]=k.useState(!1),i=vt(),{user:a,logout:o}=bt();k.useEffect(()=>{a||e("Invalid or expired password reset session. Please request a new password reset link.")},[a]);const{register:l,handleSubmit:c,formState:{errors:d,isSubmitting:h}}=tn({resolver:Yn(lte)}),m=async f=>{e("");const{error:p}=await Ja.updateUserPassword(f.password);p?e(cte(p.message)):(s(!0),await o(),setTimeout(()=>i("/auth/login",{replace:!0}),2e3))};return t?r.jsxs("div",{className:"text-center",children:[r.jsx(Gi,{className:"mx-auto h-12 w-12 text-accent"}),r.jsx("h3",{className:"mt-4 text-lg font-semibold text-white",children:"Password Updated!"}),r.jsx("p",{className:"mt-2 text-sm text-gray-300",children:"Your password has been changed successfully. You will be redirected to the login page shortly."}),r.jsx("div",{className:"mt-6",children:r.jsx(aa,{to:"/auth/login",className:"font-medium text-white/80 hover:text-white",children:" Back to Login Now"})})]}):n&&!a?r.jsxs("div",{className:"text-center",children:[r.jsx("h3",{className:"text-3xl font-bold text-white",children:"Link Expired"}),r.jsx("p",{className:"text-sm text-gray-300 mt-1",children:"This password reset link is no longer valid."}),r.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[r.jsx(aa,{to:"/auth/forgot-password",className:"font-medium text-white/80 hover:text-white",children:"Request a new link"}),r.jsx("div",{className:"auth-separator",children:"OR"}),r.jsx(se,{onClick:()=>i("/auth/login"),className:"w-full",size:"lg",children:"Back to Sign In"})]})]}):r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm text-center text-gray-300 -mt-6 mb-6",children:["for ",r.jsx("span",{className:"font-semibold text-white",children:a?.email}),"."]}),r.jsxs("form",{onSubmit:c(m),className:"space-y-6",children:[r.jsx(be,{id:"password",type:"password",placeholder:"New Password",autoComplete:"new-password",registration:l("password"),error:d.password?.message,className:"pl-4 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"}),r.jsx(be,{id:"confirmPassword",type:"password",placeholder:"Confirm New Password",autoComplete:"new-password",registration:l("confirmPassword"),error:d.confirmPassword?.message,className:"pl-4 !bg-white/10 !text-white !border-white/20 placeholder:!text-gray-300"}),n&&r.jsx("p",{className:"text-sm text-red-400 text-center",children:n}),r.jsx("div",{children:r.jsx(se,{type:"submit",className:"w-full",isLoading:h,size:"lg",disabled:!a,children:"Update Password"})})]})]})},gte=()=>{const n=vt(),{logout:e}=bt(),t=async()=>{await e(),n("/auth/login",{replace:!0})},s=()=>{n(-1)};return r.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 relative",children:r.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl shadow-card p-8 text-center relative z-10",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"p-4 rounded-full bg-red-100",children:r.jsx(No,{className:"h-10 w-10 text-red-600"})})}),r.jsx("h1",{className:"text-2xl font-bold text-primary-text mb-2",children:"Log Out"}),r.jsx("p",{className:"text-muted mb-8",children:"Are you sure you want to log out? You will need to sign in again to access your account."}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsx(se,{onClick:t,variant:"danger",className:"w-full !py-3 !text-lg shadow-lg shadow-red-100",children:"Yes, Log Out"}),r.jsx(se,{onClick:s,variant:"secondary",className:"w-full !py-3",children:"Cancel"})]})]})})},ute=()=>{const{logout:n,user:e}=bt(),t=vt(),s=async()=>{await n(),t("/auth/login",{replace:!0})};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-page p-4",children:r.jsxs("div",{className:"text-center p-8 bg-card rounded-2xl shadow-card w-full",children:[r.jsx(da,{className:"h-10 mx-auto mb-6"}),r.jsx(a$,{className:"h-16 w-16 text-accent mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-primary-text mb-2",children:"Account Pending Approval"}),r.jsxs("p",{className:"text-muted mb-6",children:["Welcome, ",e?.name||"user","! Your account has been created successfully and is pending approval. An administrator will review your details and perform a security check before activating your account."]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs(se,{onClick:s,variant:"secondary",children:[r.jsx(No,{className:"mr-2 h-4 w-4"}),"Log Out"]})})]})})},hte=()=>{const n=vt();return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-page p-4",children:r.jsxs("div",{className:"text-center p-8 bg-card rounded-2xl shadow-card w-full",children:[r.jsx("div",{className:"flex justify-center mb-4",children:r.jsx(AH,{className:"h-16 w-16 text-red-500"})}),r.jsx("h2",{className:"text-3xl font-bold text-primary-text mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-muted mb-6",children:"You do not have the necessary permissions to view this page. If you believe this is an error, please contact your administrator."}),r.jsxs("div",{className:"flex justify-center gap-4",children:[r.jsx(se,{onClick:()=>n(-1),variant:"secondary",children:"Go Back"}),r.jsx(se,{onClick:async()=>{await bt.getState().logout(),n("/auth/login")},children:"Login"})]})]})})},mte=()=>{const n=vt(),{data:e,reset:t}=Qn(),{user:s}=bt(),i=e.personal.firstName||e.personal.lastName,a=jt("(max-width: 767px)"),o=()=>{t(),n("/onboarding/select-organization")},l=()=>{n("/onboarding/add/personal")};return a?r.jsx("div",{className:"flex flex-col items-center justify-center text-center relative min-h-[70vh]",children:r.jsxs("div",{className:"p-8 max-w-sm w-full bg-transparent",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"p-4 rounded-full bg-black/20",children:r.jsx(uZ,{className:"h-10 w-10 text-emerald-400"})})}),r.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Welcome to Employee Onboarding"}),r.jsx("p",{className:"text-gray-400 text-sm mb-8",children:"We need to collect some information to get you set up. This should only take a few minutes."}),r.jsxs("div",{className:"flex flex-col gap-3",children:[i&&r.jsx(se,{onClick:l,variant:"secondary",className:"w-full !py-3",children:"Continue Previous Application"}),r.jsx(se,{onClick:o,variant:"primary",className:"w-full !py-3 !text-lg",children:"Start New Application"})]})]})}):r.jsx("div",{className:"h-full flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-card p-8 sm:p-12 rounded-2xl shadow-card text-center w-full",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:"bg-accent-light p-4 rounded-full",children:r.jsx(uZ,{className:"h-12 w-12 text-accent-dark"})})}),r.jsx("h2",{className:"text-3xl font-bold text-primary-text mb-2",children:"Welcome to Employee Onboarding"}),r.jsx("p",{className:"text-muted mb-8 max-w-md mx-auto",children:"We need to collect some information to get you set up. This should only take a few minutes."}),r.jsxs("div",{className:"mt-10 flex justify-center items-center gap-4 flex-wrap",children:[i&&r.jsx(se,{onClick:l,variant:"secondary",children:"Continue Draft"}),r.jsx(se,{onClick:o,variant:"primary",children:i?"Start Fresh":"Start New Application"})]})]})})},Oe=k.forwardRef(({label:n,id:e,error:t,registration:s,children:i,className:a,...o},l)=>{const h=`form-input ${t?"form-input--error":""} ${a||""}`;return r.jsxs("div",{children:[n&&r.jsx("label",{htmlFor:e,className:"block text-sm font-medium text-muted",children:n}),r.jsx("div",{className:n?"mt-1":"",children:r.jsx("select",{ref:l,id:e,className:h,"aria-invalid":!!t,...s,...o,children:i})}),t&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:t})]})});Oe.displayName="Select";const Ite=()=>{const n=vt(),{updateOrganization:e,updatePersonal:t}=Qn(),{enforceManpowerLimit:s,manpowerLimitRule:i}=dd(),{user:a}=bt(),[o,l]=k.useState(!0),[c,d]=k.useState([]),[h,m]=k.useState([]),[f,p]=k.useState([]),[b,x]=k.useState(""),[v,S]=k.useState(""),[B,V]=k.useState(""),[R,W]=k.useState(""),[_,Y]=k.useState([]),[j,M]=k.useState(window.innerWidth<768);k.useEffect(()=>{const P=()=>M(window.innerWidth<768);return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[]);const[H,D]=k.useState({isOverLimit:!1,message:""}),z=a?.role==="field_officer"&&j;k.useEffect(()=>{(async()=>{l(!0);try{const[ne,K,re]=await Promise.all([ce.getOrganizationStructure(),ce.getOrganizations(),ce.getSiteStaffDesignations()]);d(ne),m(K),p(re)}catch(ne){console.error("Failed to fetch organization structure",ne)}finally{l(!1)}})()},[]);const O=k.useMemo(()=>c.find(P=>P.id===b),[c,b]),E=k.useMemo(()=>O?.companies||[],[O]),te=k.useMemo(()=>E.find(P=>P.id===v),[E,v]),q=k.useMemo(()=>te?.entities||[],[te]);k.useEffect(()=>{W("");const P=q.find(ne=>ne.id===B);Y(P?f:[])},[B,q,f]),k.useEffect(()=>{(async()=>{if(D({isOverLimit:!1,message:""}),!B||!s)return;const K=q.find(ue=>ue.id===B)?.organizationId;if(!K)return;const le=h.find(ue=>ue.id===K)?.manpowerApprovedCount;if(le==null){D({isOverLimit:!1,message:"Manpower limit not set for this site."});return}try{const ae=(await ce.getVerificationSubmissions()).filter(Ce=>Ce.organizationId===K&&(Ce.status==="verified"||Ce.status==="pending")).length;if(ae>=le){const Ce=`Manpower limit of ${le} reached (${ae} deployed).`;D({isOverLimit:!0,message:Ce})}else{const Ce=`Manpower: ${ae} / ${le} deployed.`;D({isOverLimit:!1,message:Ce})}}catch{D({isOverLimit:!1,message:"Could not verify manpower count."})}})()},[B,h,q,s]);const de=()=>{const P=q.find(ne=>ne.id===B);if(P?.organizationId){const ne=h.find(re=>re.id===P.organizationId),K=f.find(re=>re.designation===R);ne&&K?(e({organizationId:ne.id,organizationName:ne.shortName,joiningDate:He(new Date,"yyyy-MM-dd"),workType:"Full-time",designation:R,department:K.department,defaultSalary:K.monthlySalary||null}),t({salary:K.monthlySalary||null}),n("/onboarding/pre-upload")):console.error("Organization or Designation details not found.")}};if(o)return r.jsx("div",{className:"flex justify-center items-center h-96",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})});const U=!B||!R||H.isOverLimit&&i==="block";return z?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("header",{className:"p-4 flex-shrink-0 flex items-center gap-4 fo-mobile-header text-white",children:[r.jsx("button",{onClick:()=>n("/onboarding"),"aria-label":"Go back",className:"text-white",children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsx("h1",{className:"text-xl font-bold",children:"New Enrollment"})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Select Site"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Choose the client and site for the new employee."})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("select",{value:b,onChange:P=>{x(P.target.value),S(""),V("")},className:"form-input",children:[r.jsx("option",{value:"",children:"-- Select a Group --"}),c.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs("select",{value:v,onChange:P=>{S(P.target.value),V("")},disabled:!b,className:"form-input",children:[r.jsx("option",{value:"",children:"-- Select a Company --"}),E.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs("select",{value:B,onChange:P=>V(P.target.value),disabled:!v,className:"form-input",children:[r.jsx("option",{value:"",children:"-- Select a Client/Site --"}),q.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs("select",{value:R,onChange:P=>W(P.target.value),disabled:!B,className:"form-input",children:[r.jsx("option",{value:"",children:"-- Select a Designation --"}),_.map(P=>r.jsx("option",{value:P.designation,children:P.designation},P.id))]}),H.message&&r.jsx("div",{className:`mt-4 text-sm p-3 rounded-lg ${H.isOverLimit?"bg-red-900/50 text-red-300 border border-red-500/50":"bg-green-900/50 text-green-300 border border-green-500/50"}`,children:H.message})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center justify-between gap-4",children:[r.jsx("button",{onClick:()=>n("/onboarding"),className:"fo-btn-secondary px-6",children:"Back"}),r.jsx("button",{onClick:de,disabled:U,className:"fo-btn-primary flex-1",children:"Continue"})]})]}):r.jsx("div",{className:"p-4 md:p-0",children:r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Select Site"}),r.jsx("p",{className:"text-muted",children:"Choose the client and site for the new employee."})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs(Oe,{label:"Company Group",id:"group",value:b,onChange:P=>{x(P.target.value),S(""),V("")},children:[r.jsx("option",{value:"",children:"-- Select a Group --"}),c.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs(Oe,{label:"Company",id:"company",value:v,onChange:P=>{S(P.target.value),V("")},disabled:!b,children:[r.jsx("option",{value:"",children:"-- Select a Company --"}),E.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs(Oe,{label:"Client / Site",id:"entity",value:B,onChange:P=>V(P.target.value),disabled:!v,children:[r.jsx("option",{value:"",children:"-- Select a Client/Site --"}),q.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs(Oe,{label:"Designation",id:"designation",value:R,onChange:P=>W(P.target.value),disabled:!B,children:[r.jsx("option",{value:"",children:"-- Select a Designation --"}),_.map(P=>r.jsx("option",{value:P.designation,children:P.designation},P.id))]})]}),H.message&&r.jsx("div",{className:`mt-4 text-sm p-3 rounded-lg ${H.isOverLimit?"bg-red-50 text-red-700":"bg-green-50 text-green-700"}`,children:H.message}),r.jsx("div",{className:"mt-8 pt-6 border-t flex justify-end",children:r.jsxs(se,{onClick:de,disabled:U,children:["Continue ",r.jsx(W6,{className:"ml-2 h-4 w-4"})]})})]})})},iW=({steps:n,currentStepIndex:e,onStepClick:t,highestStepReached:s,isMobileOptimized:i=!1})=>{const[a,o]=k.useState(0),l=4,c=Math.ceil(n.length/l);k.useEffect(()=>{if(i){const f=Math.floor(e/l);o(f)}},[e,i,l]);const d=()=>{o(f=>Math.min(f+1,c-1))},h=()=>{o(f=>Math.max(f-1,0))},m=k.useMemo(()=>{if(!i)return[];const f=a*l,p=f+l;return Array.from({length:n.length},(b,x)=>x).slice(f,p)},[a,l,n.length,i]);if(!i){const f=e>0?e/(n.length-1)*100:0,b=100/n.length/2;return r.jsx("nav",{"aria-label":"Onboarding Progress",className:"py-4",children:r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"absolute top-4 h-1",style:{left:`${b}%`,right:`${b}%`},children:[r.jsx("div",{className:"w-full h-full bg-border rounded-full"}),r.jsx("div",{className:"absolute top-0 left-0 h-full bg-accent rounded-full transition-all duration-500 ease-in-out",style:{width:`${f}%`}})]}),r.jsx("ol",{role:"list",className:"relative flex items-center",children:n.map((x,v)=>{const S=v<e,B=v===e,V=v<=s;return r.jsx("li",{className:"flex-1",children:r.jsxs("div",{className:"relative flex flex-col items-center group",children:[r.jsx("button",{type:"button",onClick:()=>V&&t(v),disabled:!V,className:"flex flex-col items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-accent-dark rounded-full disabled:cursor-not-allowed","aria-current":B?"step":void 0,title:x.label,children:r.jsx("div",{className:`relative flex items-center justify-center w-9 h-9 rounded-full transition-all duration-300 border-2 z-10 ${S?"bg-accent border-accent text-white":""} ${B?"bg-card border-accent text-accent scale-110":""} ${!S&&!B?"bg-card border-border text-muted":""} ${V?"group-hover:border-accent-dark":""}`,children:S?r.jsx(Rl,{className:"w-5 h-5"}):ot.createElement(x.icon,{className:"w-5 h-5"})})}),r.jsx("span",{className:`hidden sm:block absolute top-12 w-24 text-center text-xs transition-colors duration-300 ${B?"text-accent font-bold":"text-muted"} ${V?"group-hover:text-primary-text":""}`,children:x.label})]})},x.key)})})]})})}return r.jsxs("nav",{"aria-label":"Onboarding Progress",className:"bg-card rounded-2xl mx-4 my-2 p-2 flex items-center gap-1",children:[r.jsx("button",{type:"button",onClick:h,disabled:a===0,className:"p-2 rounded-full disabled:opacity-30 disabled:cursor-not-allowed text-white hover:bg-white/10","aria-label":"Previous steps",children:r.jsx(xp,{className:"h-6 w-6"})}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx("ol",{role:"list",className:"flex items-center justify-around",children:m.map(f=>{const p=n[f],b=f<e,x=f===e,v=f<=s;return r.jsx("li",{className:"flex-shrink-0",children:r.jsx("div",{className:"relative flex flex-col items-center group",children:r.jsx("button",{type:"button",onClick:()=>v&&t(f),disabled:!v,className:"flex flex-col items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[#041b0f] focus-visible:ring-emerald-400 rounded-full disabled:cursor-not-allowed","aria-current":x?"step":void 0,title:p.label,children:r.jsx("div",{className:`relative flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 border-2 z-10
                      ${b?"bg-green-600 border-green-600 text-white":""}
                      ${x?"bg-transparent border-green-500 text-white scale-110":""}
                      ${!b&&!x?`bg-transparent ${v?"border-gray-500 text-gray-400 group-hover:border-emerald-400":"border-gray-700 text-gray-600 opacity-50"}`:""}`,children:b?r.jsx(Rl,{className:"w-6 h-6 text-white"}):ot.createElement(p.icon,{className:"w-6 h-6"})})})})},p.key)})})}),r.jsx("button",{type:"button",onClick:d,disabled:a>=c-1,className:"p-2 rounded-full disabled:opacity-30 disabled:cursor-not-allowed text-white hover:bg-white/10","aria-label":"Next steps",children:r.jsx(Hu,{className:"h-6 w-6"})})]})},It=({message:n,type:e,onDismiss:t})=>{k.useEffect(()=>{const a=setTimeout(()=>{t()},5e3);return()=>{clearTimeout(a)}},[t]);const s=e==="error"?"bg-red-500":"bg-accent",i=e==="success"?Gi:Gm;return r.jsxs("div",{className:`fixed top-5 right-5 z-50 flex items-center p-4 rounded-lg text-white shadow-lg ${s}`,children:[r.jsx(i,{className:"h-6 w-6 mr-3"}),r.jsx("span",{className:"text-sm font-medium",children:n}),r.jsx("button",{onClick:t,className:"ml-4 -mr-2 p-1.5 rounded-md hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white",children:r.jsx(Zi,{className:"h-5 w-5"})})]})},lT=[{key:"personal",label:"Personal",icon:Jl},{key:"address",label:"Address",icon:Bi},{key:"organization",label:"Organization",icon:oa},{key:"family",label:"Family",icon:Ni},{key:"education",label:"Education",icon:hH},{key:"bank",label:"Bank",icon:Xl},{key:"uan",label:"UAN/PF",icon:V6},{key:"esi",label:"ESI",icon:p$},{key:"gmc",label:"GMC",icon:hG},{key:"uniform",label:"Uniform",icon:Lu},{key:"documents",label:"Documents",icon:n$},{key:"biometrics",label:"Biometrics",icon:uH},{key:"review",label:"Review",icon:q6}],$i=lT.map(n=>n.key),Cte=()=>{const n=vt(),e=er(),{data:t,reset:s,setData:i}=Qn(),{user:a}=bt(),{salaryThreshold:o}=dd(),[l,c]=k.useState(!1),[d,h]=k.useState(!0),[m,f]=k.useState(null),[p]=wF(),[b,x]=k.useState(!1),[v,S]=k.useState("idle"),B=k.useRef(null),V=jt("(max-width: 767px)"),R=k.useRef(null),W=e.pathname.split("/").pop(),_=k.useMemo(()=>$i.indexOf(W),[W]),[Y,j]=k.useState(0);k.useEffect(()=>{const U=t.personal.firstName==="Ravi"&&t.status==="draft";if(t.status!=="draft"||U){j($i.length-1);return}const P=sessionStorage.getItem(`onboarding_progress_${t.id}`),ne=P?parseInt(P,10):0,K=Math.max(ne,_);j(K),_>ne&&sessionStorage.setItem(`onboarding_progress_${t.id}`,String(_))},[t,_]);const M=k.useMemo(()=>lT.map((U,P)=>({...U,status:P<_?"complete":P===_?"current":"upcoming"})),[_]);k.useEffect(()=>{const U=p.get("id");U?(async ne=>{h(!0);try{const K=await ce.getOnboardingDataById(ne);K?(i(K),S("saved")):(f({message:"Could not find submission data.",type:"error"}),s())}catch(K){console.error("Failed to fetch submission data",K),f({message:"Failed to load submission data.",type:"error"}),s()}finally{h(!1)}})(U):h(!1)},[p,i,s]);const H=k.useCallback(async()=>{S("saving");try{const{draftId:U}=await ce.saveDraft(t);U!==t.id&&i({...t,id:U}),S("saved")}catch{f({message:"Auto-save failed. Check your connection.",type:"error"}),S("dirty")}},[t,i]);k.useEffect(()=>((!t.id||t.id.startsWith("draft_")||t.status==="draft")&&!d&&(v!=="saving"&&S("dirty"),B.current&&clearTimeout(B.current),B.current=window.setTimeout(()=>{H()},2e3)),()=>{B.current&&clearTimeout(B.current)}),[t,d,H,v]);const D=async()=>{B.current&&clearTimeout(B.current),await H();const U=R.current;if(R.current=null,U)n(`/onboarding/add/${U}`);else if(_<$i.length-1){let P=_+1;W==="esi"&&$i[P]==="gmc"&&(t.personal.salary!=null&&t.personal.salary>o||P++),P<$i.length&&n(`/onboarding/add/${$i[P]}`)}},z=U=>{U<=Y&&n(`/onboarding/add/${$i[U]}`)},O=()=>{if(_>0){let U=_-1;W==="uniform"&&$i[U]==="gmc"&&(t.personal.salary!=null&&t.personal.salary>o||U--),U>=0?n(`/onboarding/add/${$i[U]}`):n("/onboarding/select-organization")}else n("/onboarding/select-organization")},E=async()=>{c(!0);const U={...t,status:"pending"};try{!!t.id&&!t.id.startsWith("draft_")?(await ce.updateOnboarding(U),f({message:"Application updated successfully!",type:"success"})):(await ce.submitOnboarding(U),f({message:"Application submitted successfully!",type:"success"})),setTimeout(()=>{s(),a?.role==="site_manager"?n("/site/dashboard"):n("/onboarding")},2e3)}catch{f({message:"Failed to submit application.",type:"error"}),c(!1)}},te=()=>{sessionStorage.removeItem(`onboarding_progress_${t.id}`),s(),x(!1),n("/onboarding/add/personal",{replace:!0}),f({message:"Form has been cleared.",type:"success"})},q=U=>{if(U.key!=="ArrowUp"&&U.key!=="ArrowDown"&&U.key!=="Enter")return;const P=U.target;if(U.key==="Enter"&&P.tagName!=="TEXTAREA"&&P.tagName!=="BUTTON"&&U.preventDefault(),U.key==="Enter"&&P.tagName==="BUTTON"||(U.key==="ArrowUp"||U.key==="ArrowDown")&&(P.tagName==="TEXTAREA"||P.type==="number"))return;const ne=U.currentTarget,K=Array.from(ne.querySelectorAll('input:not([type="hidden"]):not([readonly]), select, textarea, button')).filter(ue=>!ue.hasAttribute("disabled")&&ue.offsetParent!==null),re=K.indexOf(document.activeElement);if(re===-1)return;(U.key==="ArrowUp"||U.key==="ArrowDown")&&U.preventDefault();let le=re;if(U.key==="ArrowUp"?le=re-1:le=re+1,le>=0&&le<K.length)K[le].focus();else if(U.key==="Enter"&&le>=K.length){const ue=document.getElementById("save-and-next-button");ue&&ue.click()}};if(d)return r.jsxs("div",{className:"flex justify-center items-center h-full text-muted",children:[r.jsx(xt,{className:"h-8 w-8 animate-spin mr-4"}),r.jsx("p",{children:"Loading application data..."})]});const de=$i[_]==="review";return V?r.jsxs("div",{className:"h-full flex flex-col",children:[m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)}),r.jsx(iW,{steps:M,currentStepIndex:_,onStepClick:z,highestStepReached:Y,isMobileOptimized:!0}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4 pb-28",onKeyDown:q,children:r.jsx("div",{className:"bg-card p-6 rounded-2xl",children:r.jsx(Nu,{context:{onValidated:D,onSubmit:E,isSubmitting:l,setToast:f}})})}),r.jsxs("footer",{className:"fixed bottom-0 left-0 right-0 p-4 flex items-center justify-between gap-2 bg-card border-t border-[#123820] z-10",children:[r.jsx(se,{type:"button",onClick:O,variant:"secondary",children:"Back"}),r.jsx(se,{type:"button",onClick:()=>n("/onboarding"),variant:"secondary",className:"!p-3 !rounded-full","aria-label":"Go to Home",children:r.jsx(mG,{className:"h-5 w-5"})}),r.jsx(se,{id:"save-and-next-button",type:"submit",form:`${$i[_]}-form`,children:de?"Submit":"Next"})]})]}):r.jsx("div",{className:"p-4 md:p-0",children:r.jsxs("div",{className:`transition-opacity duration-300 ${l?"opacity-50 pointer-events-none":""}`,children:[m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)}),r.jsx(tr,{isOpen:b,onClose:()=>x(!1),onConfirm:te,title:"Confirm Clear Form",children:"Are you sure you want to clear all data entered in this form? This action cannot be undone."}),r.jsx(iW,{steps:M,currentStepIndex:_,onStepClick:z,highestStepReached:Y,isMobileOptimized:V}),r.jsx("div",{className:"mt-8 bg-card p-6 sm:p-8 rounded-xl shadow-card",onKeyDown:q,children:r.jsx(Nu,{context:{onValidated:D,onSubmit:E,isSubmitting:l,setToast:f}})}),r.jsxs("div",{className:"mt-8 flex justify-between items-center",children:[r.jsx(se,{onClick:O,disabled:_===0,variant:"secondary",children:"Back"}),r.jsxs("div",{className:"flex flex-wrap gap-4 justify-end items-center",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted italic transition-opacity duration-300 min-h-[20px]",children:[v==="saving"&&r.jsxs(r.Fragment,{children:[r.jsx(xt,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Saving..."})]}),v==="saved"&&r.jsxs(r.Fragment,{children:[r.jsx(Gi,{className:"h-4 w-4 text-accent"}),r.jsx("span",{children:"Draft saved"})]}),v==="dirty"&&r.jsx("span",{className:"text-gray-500",children:"Unsaved changes"})]}),!de&&r.jsx(se,{id:"save-and-next-button",type:"submit",form:`${$i[_]}-form`,children:"Save & Next"})]})]})]})})},GG=({status:n})=>{const t={pending:"status-chip--pending",verified:"status-chip--verified",rejected:"status-chip--rejected",draft:"status-chip--draft"}[n]||"status-chip--draft";return r.jsx("span",{className:`status-chip ${t}`,children:n})},$s=({className:n=""})=>r.jsx("div",{className:`skeleton-pulse rounded-md ${n}`}),fte=({rows:n,cols:e})=>r.jsx("div",{className:"space-y-4",children:Array.from({length:n}).map((t,s)=>r.jsx("div",{className:"bg-card rounded-2xl border border-border p-4 space-y-3",children:Array.from({length:e}).map((i,a)=>r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx($s,{className:"h-4 w-1/4"}),r.jsx($s,{className:"h-4 w-1/2"})]},a))},s))}),pte=({rows:n,cols:e})=>r.jsx(r.Fragment,{children:Array.from({length:n}).map((t,s)=>r.jsx("tr",{children:Array.from({length:e}).map((i,a)=>r.jsx("td",{className:"px-6 py-4",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx($s,{className:`h-4 ${a===0?"w-3/4":"w-full"}`}),a===0&&r.jsx($s,{className:"h-3 w-1/2"})]})},a))},s))}),Ea=({rows:n=5,cols:e=4,isMobile:t=!1,mobileCols:s})=>t?r.jsx(fte,{rows:n,cols:s||e}):r.jsx(pte,{rows:n,cols:e}),Ate=({submission:n,isSyncing:e})=>{if(n.status!=="verified"||!n.portalSyncStatus)return r.jsx("span",{className:"text-sm font-medium text-muted",children:"-"});if(e)return r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[r.jsx(xt,{className:"h-4 w-4 animate-spin"})," Syncing..."]});const t=n.uan?.hasPreviousPf,s=[{label:"Aadhaar",verified:n.personal?.verifiedStatus?.idProofNumber},{label:"Bank",verified:n.bank?.verifiedStatus?.accountNumber},...t?[{label:"UAN",verified:n.uan?.verifiedStatus?.uanNumber}]:[]],i=n.portalSyncStatus==="synced"||n.portalSyncStatus==="failed",a=({label:o,status:l})=>{const c=i&&l===!0,d=i&&l===!1,h=c?Rm:d?vH:xH,m=c?"text-green-600":d?"text-red-600":"text-muted",f=c?"Verified":d?"Failed":"Pending Verification";return r.jsxs("div",{className:`flex items-center gap-1.5 text-xs font-medium ${m}`,title:f,children:[r.jsx(h,{className:"h-4 w-4"}),r.jsx("span",{children:o})]})};return r.jsx("div",{className:"flex flex-row gap-3 items-center",children:s.map(o=>r.jsx(a,{label:o.label,status:o.verified},o.label))})},bte=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),[i,a]=k.useState("all"),[o,l]=k.useState(""),[c,d]=k.useState(null),[h,m]=k.useState(null),f=vt(),p=jt("(max-width: 767px)"),b=k.useCallback(async()=>{s(!0);try{const R=await ce.getVerificationSubmissions(i==="all"?void 0:i);e(R)}catch(R){console.error("Failed to fetch submissions",R)}finally{s(!1)}},[i]);k.useEffect(()=>{b();const R=ve.channel("submissions-feed").on("postgres_changes",{event:"*",schema:"public",table:"onboarding_submissions"},W=>{console.log("Real-time change received!",W),b()}).subscribe();return()=>{ve.removeChannel(R)}},[b]);const x=k.useMemo(()=>n?n.filter(R=>R.personal.firstName?.toLowerCase().includes(o.toLowerCase())||R.personal.lastName?.toLowerCase().includes(o.toLowerCase())||R.personal.employeeId?.toLowerCase().includes(o.toLowerCase())||R.organizationName?.toLowerCase().includes(o.toLowerCase())):[],[n,o]),v=async(R,W)=>{e(_=>_.map(Y=>Y.id===W?{...Y,status:R==="approve"?"verified":"rejected",portalSyncStatus:R==="approve"?"pending_sync":void 0}:Y));try{R==="approve"?await ce.verifySubmission(W):await ce.requestChanges(W,"Changes requested by admin.")}catch(_){console.error(`Failed to ${R} submission`,_)}},S=async R=>{d(R);try{const W=await ce.syncPortals(R);e(_=>_.map(Y=>Y.id===R?W:Y)),W.portalSyncStatus==="synced"?m({message:"Portals synced successfully!",type:"success"}):m({message:"Portal sync failed. Check details.",type:"error"})}catch{m({message:"An error occurred during sync.",type:"error"})}finally{d(null)}},B=["all","pending","verified","rejected"],V=i==="verified"?4:5;return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)}),r.jsx("h2",{className:"text-2xl font-semibold text-primary-text mb-6",children:"Onboarding Forms"}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[r.jsx("div",{className:"w-full sm:w-auto border-b border-border",children:r.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:B.map(R=>r.jsx("button",{onClick:()=>a(R),className:`${i===R?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"} whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm capitalize`,children:R},R))})}),r.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-xs",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(la,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"text",placeholder:"Search by name, ID, site...",value:o,onChange:R=>l(R.target.value),className:"form-input block w-full pl-10 pr-3 py-2 border-border rounded-lg leading-5 placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-accent focus:border-accent sm:text-sm"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-border responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Employee"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Site"}),i!=="verified"&&r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Status"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Portal Verification"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-card md:divide-y-0",children:t?p?r.jsx("tr",{children:r.jsx("td",{colSpan:V,children:r.jsx(Ea,{rows:3,cols:4,isMobile:!0})})}):r.jsx(Ea,{rows:5,cols:V}):x.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:V,className:"text-center py-10 text-white",children:"No submissions found."})}):x.map(R=>r.jsxs("tr",{className:R.requiresManualVerification?"bg-orange-50":"",children:[r.jsx("td",{"data-label":"Employee",className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[R.requiresManualVerification&&r.jsx("span",{title:"Manual verification required due to data mismatch.",children:r.jsx(ca,{className:"h-4 w-4 text-orange-500 mr-2 flex-shrink-0"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm font-medium text-primary-text",children:[R.personal.firstName," ",R.personal.lastName]}),r.jsx("div",{className:"text-sm text-muted",children:R.personal.employeeId})]})]})}),r.jsx("td",{"data-label":"Site",className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-primary-text",children:R.organizationName}),i!=="verified"&&r.jsx("td",{"data-label":"Status",className:"px-6 py-4 whitespace-nowrap",children:r.jsx(GG,{status:R.status})}),r.jsx("td",{"data-label":"Portal Verification",className:"px-6 py-4 whitespace-nowrap",children:r.jsx(Ate,{submission:R,isSyncing:c===R.id})}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>f(`/onboarding/add/personal?id=${R.id}`),title:"View Details","aria-label":`View details for ${R.personal.firstName}`,children:r.jsx(jl,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>f(`/onboarding/pdf/${R.id}`),title:"Download Forms","aria-label":`Download forms for ${R.personal.firstName}`,children:r.jsx(Cr,{className:"h-4 w-4"})}),R.status==="pending"&&r.jsxs(r.Fragment,{children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>v("approve",R.id),title:"Verify","aria-label":`Verify submission for ${R.personal.firstName}`,children:r.jsx(Rm,{className:"h-4 w-4 text-green-600"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>v("reject",R.id),title:"Request Changes","aria-label":`Request changes for ${R.personal.firstName}`,children:r.jsx(vH,{className:"h-4 w-4 text-red-600"})})]}),R.status==="verified"&&(R.portalSyncStatus==="pending_sync"||R.portalSyncStatus==="failed")&&r.jsxs(se,{variant:"outline",size:"sm",onClick:()=>S(R.id),isLoading:c===R.id,title:"Push data to government portals",children:[c!==R.id&&r.jsx(CG,{className:"h-4 w-4 mr-1"}),"Sync Portals"]})]})})]},R.id))})]})})]})},ma=({title:n,children:e})=>r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsx("h2",{className:"text-2xl font-semibold text-primary-text",children:n}),e&&r.jsx("div",{className:"flex-shrink-0 flex items-center flex-wrap gap-2",children:e})]}),yte=({isOpen:n,onClose:e,onApprove:t,user:s,isConfirming:i})=>{const[a,o]=k.useState([]),[l,c]=k.useState(""),[d,h]=k.useState(!0);k.useEffect(()=>{n&&(h(!0),ce.getRoles().then(f=>{const p=f.filter(b=>b.id!=="unverified"&&b.id!=="admin");o(p),p.length>0&&c(p[0].id),h(!1)}))},[n]);const m=()=>{s&&l&&t(s.id,l)};return!n||!s?null:r.jsx(tr,{isOpen:n,onClose:e,onConfirm:m,title:"Approve User Account",confirmButtonText:"Confirm Approval",confirmButtonVariant:"primary",isConfirming:i,children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("p",{children:["You are approving the account for ",r.jsx("strong",{className:"text-primary-text",children:s.name})," (",s.email,")."]}),r.jsx("p",{children:"Please assign a role to activate their account."}),d?r.jsx("p",{children:"Loading roles..."}):r.jsx(Oe,{label:"Assign Role",id:"approval-role",value:l,onChange:f=>c(f.target.value),children:a.map(f=>r.jsx("option",{value:f.id,children:f.displayName},f.id))})]})})},vte=({isOpen:n,onClose:e,userId:t,userName:s,onSuccess:i})=>{const[a,o]=k.useState([]),[l,c]=k.useState([]),[d,h]=k.useState(!0),[m,f]=k.useState(!1),[p,b]=k.useState(""),[x,v]=k.useState(null);k.useEffect(()=>{n&&t&&S()},[n,t]);const S=async()=>{h(!0);try{const[_,Y]=await Promise.all([ce.getUserLocations(t),ce.getLocations()]);o(_),c(Y)}catch(_){console.error("Failed to load locations:",_),v({message:"Failed to load locations.",type:"error"})}finally{h(!1)}},B=async _=>{f(!0);try{await ce.assignLocationToUser(t,_);const Y=await ce.getUserLocations(t);o(Y),v({message:"Location assigned successfully!",type:"success"}),i?.()}catch(Y){console.error("Failed to assign location:",Y),v({message:Y.message||"Failed to assign location.",type:"error"})}finally{f(!1)}},V=async _=>{f(!0);try{await ce.unassignLocationFromUser(t,_);const Y=await ce.getUserLocations(t);o(Y),v({message:"Location unassigned successfully!",type:"success"}),i?.()}catch(Y){console.error("Failed to unassign location:",Y),v({message:Y.message||"Failed to unassign location.",type:"error"})}finally{f(!1)}},R=_=>a.some(Y=>Y.id===_),W=l.filter(_=>!R(_.id)).filter(_=>p===""||_.name?.toLowerCase().includes(p.toLowerCase())||_.address?.toLowerCase().includes(p.toLowerCase()));return r.jsxs(r.Fragment,{children:[x&&r.jsx(It,{message:x.message,type:x.type,onDismiss:()=>v(null)}),r.jsx(tr,{isOpen:n,onClose:e,title:`Manage Locations for ${s}`,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("h3",{className:"text-sm font-semibold text-primary-text mb-3",children:["Assigned Locations (",a.length,")"]}),d?r.jsx("p",{className:"text-sm text-muted",children:"Loading..."}):a.length===0?r.jsx("p",{className:"text-sm text-muted bg-gray-50 p-3 rounded-lg",children:"No locations assigned yet."}):r.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:a.map(_=>r.jsxs("div",{className:"flex items-start justify-between bg-accent/10 border border-accent/30 rounded-lg p-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-sm text-primary-text",children:_.name||"Unnamed"}),r.jsx("p",{className:"text-xs text-muted mt-1",children:_.address||"No address"})]}),r.jsx("button",{type:"button",onClick:()=>V(_.id),disabled:m,className:"text-red-500 hover:text-red-700 disabled:opacity-50 p-1",title:"Remove",children:r.jsx(Zi,{className:"h-5 w-5"})})]},_.id))})]}),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-sm font-semibold text-primary-text mb-3",children:["Available Locations (",W.length,")"]}),r.jsx(be,{type:"text",placeholder:"Search locations...",value:p,onChange:_=>b(_.target.value),className:"mb-3"}),d?r.jsx("p",{className:"text-sm text-muted",children:"Loading..."}):W.length===0?r.jsx("p",{className:"text-sm text-muted bg-gray-50 p-3 rounded-lg",children:p?"No locations found.":"All assigned."}):r.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:W.map(_=>r.jsxs("div",{className:"flex items-start justify-between border border-border rounded-lg p-3 hover:bg-gray-50",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-sm text-primary-text",children:_.name||"Unnamed"}),r.jsx("p",{className:"text-xs text-muted mt-1",children:_.address||"No address"}),r.jsxs("p",{className:"text-xs text-muted mt-1",children:[_.latitude.toFixed(4),", ",_.longitude.toFixed(4),"  Radius: ",_.radius,"m"]})]}),r.jsx("button",{type:"button",onClick:()=>B(_.id),disabled:m,className:"text-accent hover:text-accent-dark disabled:opacity-50 p-1",title:"Assign",children:r.jsx(Tt,{className:"h-5 w-5"})})]},_.id))})]}),r.jsx("div",{className:"flex justify-end pt-4 border-t border-border",children:r.jsx(se,{onClick:e,variant:"secondary",children:"Done"})})]})})]})},xte=()=>{const n=vt(),[e,t]=k.useState([]),[s,i]=k.useState(!0),[a,o]=k.useState(!1),[l,c]=k.useState(!1),[d,h]=k.useState(!1),[m,f]=k.useState(!1),[p,b]=k.useState(null),[x,v]=k.useState(null),[S,B]=k.useState(null),V=jt("(max-width: 767px)"),R=k.useCallback(async()=>{i(!0);try{const z=await ce.getUsers();t(z)}catch{B({message:"Failed to fetch users.",type:"error"})}finally{i(!1)}},[]);k.useEffect(()=>{R()},[R]);const W=()=>{n("/admin/users/add")},_=z=>{n(`/admin/users/edit/${z.id}`)},Y=z=>{b(z),h(!0)},j=z=>{b(z),c(!0)},M=async(z,O)=>{o(!0);try{await ce.updateUser(z,{role:O}),B({message:"User approved successfully!",type:"success"}),h(!1),R()}catch{B({message:"Failed to approve user.",type:"error"})}finally{o(!1)}},H=async()=>{if(p){o(!0);try{await ce.deleteUser(p.id),B({message:"User deleted. Remember to also remove them from Supabase Auth.",type:"success"}),c(!1),R()}catch{B({message:"Failed to delete user.",type:"error"})}finally{o(!1)}}},D=z=>z?z.replace(/_/g," ").replace(/\b\w/g,O=>O.toUpperCase()):"N/A";return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[S&&r.jsx(It,{message:S.message,type:S.type,onDismiss:()=>B(null)}),r.jsx(yte,{isOpen:d,onClose:()=>h(!1),onApprove:M,user:p,isConfirming:a}),r.jsxs(tr,{isOpen:l,onClose:()=>c(!1),onConfirm:H,title:"Confirm Deletion",isConfirming:a,children:['Are you sure you want to delete the user "',p?.name,'"? This action cannot be undone.']}),r.jsx(vte,{isOpen:m,onClose:()=>f(!1),userId:x?.id||"",userName:x?.name||""}),r.jsx(ma,{title:"User Management",children:r.jsxs(se,{onClick:W,children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add User"]})}),r.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded-lg text-sm",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(fg,{className:"h-5 w-5 mr-3 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold",children:"Adding New Users"}),r.jsxs("p",{className:"mt-1",children:["Use the ",r.jsx("strong",{children:"Add User"})," button below to create a new user. Provide their name, email, role and a temporary password. The system will automatically provision their login, send them a verification email and create their profile."]}),r.jsx("p",{className:"mt-2",children:"Once they confirm their email they can sign in using the password you set. You can edit or delete users at any time from this page."})]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Name"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Email"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Role"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:s?V?r.jsx("tr",{children:r.jsx("td",{colSpan:4,children:r.jsx(Ea,{rows:3,cols:4,isMobile:!0})})}):r.jsx(Ea,{rows:5,cols:4}):e.map(z=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Name",className:"px-6 py-4 font-medium",children:z.name}),r.jsx("td",{"data-label":"Email",className:"px-6 py-4 text-sm text-muted",children:z.email}),r.jsxs("td",{"data-label":"Role",className:"px-6 py-4 text-sm text-muted",children:[r.jsxs("div",{className:"flex items-center md:justify-start justify-end",children:[r.jsx(Nm,{className:"h-4 w-4 mr-2 text-accent"}),D(z.role)]}),z.role==="unverified"&&r.jsx("span",{className:"text-xs font-semibold px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 ml-2",children:"Pending Approval"})]}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4",children:r.jsxs("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:[z.role==="unverified"&&r.jsxs(se,{variant:"outline",size:"sm",onClick:()=>Y(z),"aria-label":`Approve user ${z.name}`,title:`Approve user ${z.name}`,children:[r.jsx(Sg,{className:"h-4 w-4 mr-2"}),"Approve"]}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>_(z),"aria-label":`Edit user ${z.name}`,title:`Edit user ${z.name}`,children:r.jsx(ms,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",onClick:()=>j(z),"aria-label":`Delete user ${z.name}`,title:`Delete user ${z.name}`,className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})})]},z.id))})]})})]})};var ey,aW;function Ste(){if(aW)return ey;aW=1;var n=!1,e,t,s,i,a,o,l,c,d,h,m,f,p,b,x;function v(){if(!n){n=!0;var B=navigator.userAgent,V=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(B),R=/(Mac OS X)|(Windows)|(Linux)/.exec(B);if(f=/\b(iPhone|iP[ao]d)/.exec(B),p=/\b(iP[ao]d)/.exec(B),h=/Android/i.exec(B),b=/FBAN\/\w+;/i.exec(B),x=/Mobile/i.exec(B),m=!!/Win64/.exec(B),V){e=V[1]?parseFloat(V[1]):V[5]?parseFloat(V[5]):NaN,e&&document&&document.documentMode&&(e=document.documentMode);var W=/(?:Trident\/(\d+.\d+))/.exec(B);o=W?parseFloat(W[1])+4:e,t=V[2]?parseFloat(V[2]):NaN,s=V[3]?parseFloat(V[3]):NaN,i=V[4]?parseFloat(V[4]):NaN,i?(V=/(?:Chrome\/(\d+\.\d+))/.exec(B),a=V&&V[1]?parseFloat(V[1]):NaN):a=NaN}else e=t=s=a=i=NaN;if(R){if(R[1]){var _=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(B);l=_?parseFloat(_[1].replace("_",".")):!0}else l=!1;c=!!R[2],d=!!R[3]}else l=c=d=!1}}var S={ie:function(){return v()||e},ieCompatibilityMode:function(){return v()||o>e},ie64:function(){return S.ie()&&m},firefox:function(){return v()||t},opera:function(){return v()||s},webkit:function(){return v()||i},safari:function(){return S.webkit()},chrome:function(){return v()||a},windows:function(){return v()||c},osx:function(){return v()||l},linux:function(){return v()||d},iphone:function(){return v()||f},mobile:function(){return v()||f||p||h||x},nativeApp:function(){return v()||b},android:function(){return v()||h},ipad:function(){return v()||p}};return ey=S,ey}var ty,oW;function wte(){if(oW)return ty;oW=1;var n=!!(typeof window<"u"&&window.document&&window.document.createElement),e={canUseDOM:n,canUseWorkers:typeof Worker<"u",canUseEventListeners:n&&!!(window.addEventListener||window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};return ty=e,ty}var ny,lW;function Zte(){if(lW)return ny;lW=1;var n=wte(),e;n.canUseDOM&&(e=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);function t(s,i){if(!n.canUseDOM||i&&!("addEventListener"in document))return!1;var a="on"+s,o=a in document;if(!o){var l=document.createElement("div");l.setAttribute(a,"return;"),o=typeof l[a]=="function"}return!o&&e&&s==="wheel"&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}return ny=t,ny}var sy,cW;function Gte(){if(cW)return sy;cW=1;var n=Ste(),e=Zte(),t=10,s=40,i=800;function a(o){var l=0,c=0,d=0,h=0;return"detail"in o&&(c=o.detail),"wheelDelta"in o&&(c=-o.wheelDelta/120),"wheelDeltaY"in o&&(c=-o.wheelDeltaY/120),"wheelDeltaX"in o&&(l=-o.wheelDeltaX/120),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(l=c,c=0),d=l*t,h=c*t,"deltaY"in o&&(h=o.deltaY),"deltaX"in o&&(d=o.deltaX),(d||h)&&o.deltaMode&&(o.deltaMode==1?(d*=s,h*=s):(d*=i,h*=i)),d&&!l&&(l=d<1?-1:1),h&&!c&&(c=h<1?-1:1),{spinX:l,spinY:c,pixelX:d,pixelY:h}}return a.getEventType=function(){return n.firefox()?"DOMMouseScroll":e("wheel")?"wheel":"mousewheel"},sy=a,sy}var ry,dW;function Bte(){return dW||(dW=1,ry=Gte()),ry}var Nte=Bte();const kte=rd(Nte);function Rte(n,e,t,s,i,a){a===void 0&&(a=0);var o=Ku(n,e,a),l=o.width,c=o.height,d=Math.min(l,t),h=Math.min(c,s);return d>h*i?{width:h*i,height:h}:{width:d,height:d/i}}function Wte(n){return n.width>n.height?n.width/n.naturalWidth:n.height/n.naturalHeight}function jh(n,e,t,s,i){i===void 0&&(i=0);var a=Ku(e.width,e.height,i),o=a.width,l=a.height;return{x:gW(n.x,o,t.width,s),y:gW(n.y,l,t.height,s)}}function gW(n,e,t,s){var i=e*s/2-t/2;return kp(n,-i,i)}function uW(n,e){return Math.sqrt(Math.pow(n.y-e.y,2)+Math.pow(n.x-e.x,2))}function hW(n,e){return Math.atan2(e.y-n.y,e.x-n.x)*180/Math.PI}function Vte(n,e,t,s,i,a,o){a===void 0&&(a=0),o===void 0&&(o=!0);var l=o?_te:jte,c=Ku(e.width,e.height,a),d=Ku(e.naturalWidth,e.naturalHeight,a),h={x:l(100,((c.width-t.width/i)/2-n.x/i)/c.width*100),y:l(100,((c.height-t.height/i)/2-n.y/i)/c.height*100),width:l(100,t.width/c.width*100/i),height:l(100,t.height/c.height*100/i)},m=Math.round(l(d.width,h.width*d.width/100)),f=Math.round(l(d.height,h.height*d.height/100)),p=d.width>=d.height*s,b=p?{width:Math.round(f*s),height:f}:{width:m,height:Math.round(m/s)},x=vs(vs({},b),{x:Math.round(l(d.width-b.width,h.x*d.width/100)),y:Math.round(l(d.height-b.height,h.y*d.height/100))});return{croppedAreaPercentages:h,croppedAreaPixels:x}}function _te(n,e){return Math.min(n,Math.max(0,e))}function jte(n,e){return e}function Xte(n,e,t,s,i,a){var o=Ku(e.width,e.height,t),l=kp(s.width/o.width*(100/n.width),i,a),c={x:l*o.width/2-s.width/2-o.width*l*(n.x/100),y:l*o.height/2-s.height/2-o.height*l*(n.y/100)};return{crop:c,zoom:l}}function Jte(n,e,t){var s=Wte(e);return t.height>t.width?t.height/(n.height*s):t.width/(n.width*s)}function Yte(n,e,t,s,i,a){t===void 0&&(t=0);var o=Ku(e.naturalWidth,e.naturalHeight,t),l=kp(Jte(n,e,s),i,a),c=s.height>s.width?s.height/n.height:s.width/n.width,d={x:((o.width-n.width)/2-n.x)*c,y:((o.height-n.height)/2-n.y)*c};return{crop:d,zoom:l}}function mW(n,e){return{x:(e.x+n.x)/2,y:(e.y+n.y)/2}}function Fte(n){return n*Math.PI/180}function Ku(n,e,t){var s=Fte(t);return{width:Math.abs(Math.cos(s)*n)+Math.abs(Math.sin(s)*e),height:Math.abs(Math.sin(s)*n)+Math.abs(Math.cos(s)*e)}}function kp(n,e,t){return Math.min(Math.max(n,e),t)}function aC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var Mte=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Hte=1,Tte=3,Ete=1,Dte=(function(n){HZ(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.cropperRef=k.createRef(),t.imageRef=k.createRef(),t.videoRef=k.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.previousCropSize=null,t.isInitialized=!1,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var s=!0;t.resizeObserver=new window.ResizeObserver(function(i){if(s){s=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(s){return s.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var s=t.computeSizes();s&&(t.previousCropSize=s,t.emitCropData(),t.setInitialCrop(s),t.isInitialized=!0),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(s){if(t.props.initialCroppedAreaPercentages){var i=Xte(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,s,t.props.minZoom,t.props.maxZoom),a=i.crop,o=i.zoom;t.props.onCropChange(a),t.props.onZoomChange&&t.props.onZoomChange(o)}else if(t.props.initialCroppedAreaPixels){var l=Yte(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,s,t.props.minZoom,t.props.maxZoom),a=l.crop,o=l.zoom;t.props.onCropChange(a),t.props.onZoomChange&&t.props.onZoomChange(o)}},t.computeSizes=function(){var s,i,a,o,l,c,d=t.imageRef.current||t.videoRef.current;if(d&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var h=t.containerRect.width/t.containerRect.height,m=((s=t.imageRef.current)===null||s===void 0?void 0:s.naturalWidth)||((i=t.videoRef.current)===null||i===void 0?void 0:i.videoWidth)||0,f=((a=t.imageRef.current)===null||a===void 0?void 0:a.naturalHeight)||((o=t.videoRef.current)===null||o===void 0?void 0:o.videoHeight)||0,p=d.offsetWidth<m||d.offsetHeight<f,b=m/f,x=void 0;if(p)switch(t.state.mediaObjectFit){default:case"contain":x=h>b?{width:t.containerRect.height*b,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/b};break;case"horizontal-cover":x={width:t.containerRect.width,height:t.containerRect.width/b};break;case"vertical-cover":x={width:t.containerRect.height*b,height:t.containerRect.height};break}else x={width:d.offsetWidth,height:d.offsetHeight};t.mediaSize=vs(vs({},x),{naturalWidth:m,naturalHeight:f}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var v=t.props.cropSize?t.props.cropSize:Rte(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((l=t.state.cropSize)===null||l===void 0?void 0:l.height)!==v.height||((c=t.state.cropSize)===null||c===void 0?void 0:c.width)!==v.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(v),t.setState({cropSize:v},t.recomputeCropPosition),t.props.setCropSize&&t.props.setCropSize(v),v}},t.saveContainerPosition=function(){if(t.containerRef){var s=t.containerRef.getBoundingClientRect();t.containerPosition={x:s.left,y:s.top}}},t.onMouseDown=function(s){t.currentDoc&&(s.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(e.getMousePoint(s)))},t.onMouseMove=function(s){return t.onDrag(e.getMousePoint(s))},t.onScroll=function(s){t.currentDoc&&(s.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(s){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(s))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),s.touches.length===2?t.onPinchStart(s):s.touches.length===1&&t.onDragStart(e.getTouchPoint(s.touches[0]))))},t.onTouchMove=function(s){s.preventDefault(),s.touches.length===2?t.onPinchMove(s):s.touches.length===1&&t.onDrag(e.getTouchPoint(s.touches[0]))},t.onGestureStart=function(s){t.currentDoc&&(s.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(s){if(s.preventDefault(),!t.isTouching){var i=e.getMousePoint(s),a=t.gestureZoomStart-1+s.scale;if(t.setNewZoom(a,i,{shouldUpdatePosition:!0}),t.props.onRotationChange){var o=t.gestureRotationStart+s.rotation;t.props.onRotationChange(o)}}},t.onGestureEnd=function(s){t.cleanEvents()},t.onDragStart=function(s){var i,a,o=s.x,l=s.y;t.dragStartPosition={x:o,y:l},t.dragStartCrop=vs({},t.props.crop),(a=(i=t.props).onInteractionStart)===null||a===void 0||a.call(i)},t.onDrag=function(s){var i=s.x,a=s.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(i===void 0||a===void 0)){var o=i-t.dragStartPosition.x,l=a-t.dragStartPosition.y,c={x:t.dragStartCrop.x+o,y:t.dragStartCrop.y+l},d=t.props.restrictPosition?jh(c,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):c;t.props.onCropChange(d)}}))},t.onDragStopped=function(){var s,i;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(i=(s=t.props).onInteractionEnd)===null||i===void 0||i.call(s)},t.onWheel=function(s){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(s))){s.preventDefault();var i=e.getMousePoint(s),a=kte(s).pixelY,o=t.props.zoom-a*t.props.zoomSpeed/200;t.setNewZoom(o,i,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var l,c;return(c=(l=t.props).onInteractionStart)===null||c===void 0?void 0:c.call(l)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var l,c;return(c=(l=t.props).onInteractionEnd)===null||c===void 0?void 0:c.call(l)})},250)}},t.getPointOnContainer=function(s,i){var a=s.x,o=s.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(a-i.x),y:t.containerRect.height/2-(o-i.y)}},t.getPointOnMedia=function(s){var i=s.x,a=s.y,o=t.props,l=o.crop,c=o.zoom;return{x:(i+l.x)/c,y:(a+l.y)/c}},t.setNewZoom=function(s,i,a){var o=a===void 0?{}:a,l=o.shouldUpdatePosition,c=l===void 0?!0:l;if(!(!t.state.cropSize||!t.props.onZoomChange)){var d=kp(s,t.props.minZoom,t.props.maxZoom);if(c){var h=t.getPointOnContainer(i,t.containerPosition),m=t.getPointOnMedia(h),f={x:m.x*d-h.x,y:m.y*d-h.y},p=t.props.restrictPosition?jh(f,t.mediaSize,t.state.cropSize,d,t.props.rotation):f;t.props.onCropChange(p)}t.props.onZoomChange(d)}},t.getCropData=function(){if(!t.state.cropSize)return null;var s=t.props.restrictPosition?jh(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return Vte(s,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var s=t.getCropData();if(s){var i=s.croppedAreaPercentages,a=s.croppedAreaPixels;t.props.onCropComplete&&t.props.onCropComplete(i,a),t.props.onCropAreaChange&&t.props.onCropAreaChange(i,a)}},t.emitCropAreaChange=function(){var s=t.getCropData();if(s){var i=s.croppedAreaPercentages,a=s.croppedAreaPixels;t.props.onCropAreaChange&&t.props.onCropAreaChange(i,a)}},t.recomputeCropPosition=function(){if(t.state.cropSize){var s=t.props.crop;if(t.isInitialized&&t.previousCropSize){var i=Math.abs(t.previousCropSize.width-t.state.cropSize.width)>1e-6||Math.abs(t.previousCropSize.height-t.state.cropSize.height)>1e-6;if(i){var a=t.state.cropSize.width/t.previousCropSize.width,o=t.state.cropSize.height/t.previousCropSize.height;s={x:t.props.crop.x*a,y:t.props.crop.y*o}}}var l=t.props.restrictPosition?jh(s,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):s;t.previousCropSize=t.state.cropSize,t.props.onCropChange(l),t.emitCropData()}},t.onKeyDown=function(s){var i,a,o=t.props,l=o.crop,c=o.onCropChange,d=o.keyboardStep,h=o.zoom,m=o.rotation,f=d;if(t.state.cropSize){s.shiftKey&&(f*=.2);var p=vs({},l);switch(s.key){case"ArrowUp":p.y-=f,s.preventDefault();break;case"ArrowDown":p.y+=f,s.preventDefault();break;case"ArrowLeft":p.x-=f,s.preventDefault();break;case"ArrowRight":p.x+=f,s.preventDefault();break;default:return}t.props.restrictPosition&&(p=jh(p,t.mediaSize,t.state.cropSize,h,m)),s.repeat||(a=(i=t.props).onInteractionStart)===null||a===void 0||a.call(i),c(p)}},t.onKeyUp=function(s){var i,a;switch(s.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":s.preventDefault();break;default:return}t.emitCropData(),(a=(i=t.props).onInteractionEnd)===null||a===void 0||a.call(i)},t}return e.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Mte,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},e.prototype.componentWillUnmount=function(){var t,s;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((s=this.styleRef.parentNode)===null||s===void 0||s.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},e.prototype.componentDidUpdate=function(t){var s,i,a,o,l,c,d,h,m;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((s=t.cropSize)===null||s===void 0?void 0:s.height)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.height)||((a=t.cropSize)===null||a===void 0?void 0:a.width)!==((o=this.props.cropSize)===null||o===void 0?void 0:o.width)?this.computeSizes():(((l=t.crop)===null||l===void 0?void 0:l.x)!==((c=this.props.crop)===null||c===void 0?void 0:c.x)||((d=t.crop)===null||d===void 0?void 0:d.y)!==((h=this.props.crop)===null||h===void 0?void 0:h.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((m=this.videoRef.current)===null||m===void 0||m.load());var f=this.getObjectFit();f!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:f},this.computeSizes)},e.prototype.getAspect=function(){var t=this.props,s=t.cropSize,i=t.aspect;return s?s.width/s.height:i},e.prototype.getObjectFit=function(){var t,s,i,a;if(this.props.objectFit==="cover"){var o=this.imageRef.current||this.videoRef.current;if(o&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var l=this.containerRect.width/this.containerRect.height,c=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((s=this.videoRef.current)===null||s===void 0?void 0:s.videoWidth)||0,d=((i=this.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((a=this.videoRef.current)===null||a===void 0?void 0:a.videoHeight)||0,h=c/d;return h<l?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},e.prototype.onPinchStart=function(t){var s=e.getTouchPoint(t.touches[0]),i=e.getTouchPoint(t.touches[1]);this.lastPinchDistance=uW(s,i),this.lastPinchRotation=hW(s,i),this.onDragStart(mW(s,i))},e.prototype.onPinchMove=function(t){var s=this;if(!(!this.currentDoc||!this.currentWindow)){var i=e.getTouchPoint(t.touches[0]),a=e.getTouchPoint(t.touches[1]),o=mW(i,a);this.onDrag(o),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var l=uW(i,a),c=s.props.zoom*(l/s.lastPinchDistance);s.setNewZoom(c,o,{shouldUpdatePosition:!1}),s.lastPinchDistance=l;var d=hW(i,a),h=s.props.rotation+(d-s.lastPinchRotation);s.props.onRotationChange&&s.props.onRotationChange(h),s.lastPinchRotation=d})}},e.prototype.render=function(){var t=this,s,i=this.props,a=i.image,o=i.video,l=i.mediaProps,c=i.cropperProps,d=i.transform,h=i.crop,m=h.x,f=h.y,p=i.rotation,b=i.zoom,x=i.cropShape,v=i.showGrid,S=i.roundCropAreaPixels,B=i.style,V=B.containerStyle,R=B.cropAreaStyle,W=B.mediaStyle,_=i.classes,Y=_.containerClassName,j=_.cropAreaClassName,M=_.mediaClassName,H=(s=this.state.mediaObjectFit)!==null&&s!==void 0?s:this.getObjectFit();return k.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(z){return t.containerRef=z},"data-testid":"container",style:V,className:aC("reactEasyCrop_Container",Y)},a?k.createElement("img",vs({alt:"",className:aC("reactEasyCrop_Image",H==="contain"&&"reactEasyCrop_Contain",H==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",H==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",M)},l,{src:a,ref:this.imageRef,style:vs(vs({},W),{transform:d||"translate(".concat(m,"px, ").concat(f,"px) rotate(").concat(p,"deg) scale(").concat(b,")")}),onLoad:this.onMediaLoad})):o&&k.createElement("video",vs({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:aC("reactEasyCrop_Video",H==="contain"&&"reactEasyCrop_Contain",H==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",H==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",M)},l,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:vs(vs({},W),{transform:d||"translate(".concat(m,"px, ").concat(f,"px) rotate(").concat(p,"deg) scale(").concat(b,")")}),controls:!1}),(Array.isArray(o)?o:[{src:o}]).map(function(D){return k.createElement("source",vs({key:D.src},D))})),this.state.cropSize&&k.createElement("div",vs({ref:this.cropperRef,style:vs(vs({},R),{width:S?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:S?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:aC("reactEasyCrop_CropArea",x==="round"&&"reactEasyCrop_CropAreaRound",v&&"reactEasyCrop_CropAreaGrid",j)},c)))},e.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:Tte,minZoom:Hte,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:Ete},e.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},e.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},e})(k.Component);const Lte=n=>new Promise((e,t)=>{const s=new Image;s.addEventListener("load",()=>e(s)),s.addEventListener("error",i=>t(i)),s.src=n});async function Pte(n,e){const t=await Lte(n),s=document.createElement("canvas"),i=s.getContext("2d");if(!i)throw new Error("No 2d context");return s.width=e.width,s.height=e.height,i.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),s.toDataURL("image/jpeg",.9)}const BG=({isOpen:n,onClose:e,onCapture:t,captureGuidance:s="none"})=>{const i=k.useRef(null),a=k.useRef(null),o=k.useRef(null),[l,c]=k.useState(null),[d,h]=k.useState(null),[m,f]=k.useState(!1),[p,b]=k.useState(""),[x,v]=k.useState(!1),[S,B]=k.useState({x:0,y:0}),[V,R]=k.useState(1),[W,_]=k.useState(null),[Y,j]=k.useState(null),[M,H]=k.useState([]),[D,z]=k.useState(0),[O,E]=k.useState(!1),[te,q]=k.useState(!1),[de,U]=k.useState(!1),[P,ne]=k.useState(!1),[K,re]=k.useState(),le=k.useCallback(()=>{o.current&&(o.current.getTracks().forEach(Me=>Me.stop()),o.current=null)},[]),ue=k.useCallback(async Me=>{le(),c(null),v(!1),E(!1);try{const Le={video:Me?{deviceId:{exact:Me}}:{facingMode:"environment"}},nt=await navigator.mediaDevices.getUserMedia(Le);o.current=nt,i.current&&(i.current.srcObject=nt),h(null);const st=nt.getVideoTracks()[0];if(st){const ee=st.getCapabilities();q(!!ee.torch),re(st.getSettings().facingMode)}else q(!1)}catch(Le){console.error("Error accessing camera:",Le),h("Could not access camera. Please check permissions.")}},[le]);k.useEffect(()=>{if(!n){le();return}let Me=!1;return(async()=>{try{const nt=await navigator.mediaDevices.getUserMedia({video:!0});if(Me){nt.getTracks().forEach(oe=>oe.stop());return}const ee=(await navigator.mediaDevices.enumerateDevices()).filter(oe=>oe.kind==="videoinput");if(nt.getTracks().forEach(oe=>oe.stop()),Me)return;if(H(ee),ee.length>0){let oe=D;oe>=ee.length&&(oe=0),await ue(ee[oe].deviceId)}else h("No camera found.")}catch(nt){console.error(nt),h("Could not access camera.")}})(),()=>{Me=!0,le()}},[n,D,ue,le]);const ae=()=>{if(i.current&&a.current){const Me=i.current,Le=a.current;Le.width=Me.videoWidth,Le.height=Me.videoHeight,Le.getContext("2d")?.drawImage(Me,0,0,Me.videoWidth,Me.videoHeight),c(Le.toDataURL("image/jpeg",.9)),le()}},Ce=()=>{K==="user"&&de?(ne(!0),setTimeout(()=>{ae(),ne(!1)},100)):ae()},ie=()=>{h(null),c(null),j(null),v(!1),R(1)},ge=async()=>{if(!o.current||!te)return;const Me=o.current.getVideoTracks()[0];try{await Me.applyConstraints({advanced:[{torch:!O}]}),E(!O)}catch(Le){console.error("Failed to toggle flash",Le)}},xe=k.useCallback((Me,Le)=>{_(Le)},[]),_e=()=>{v(!0),R(1)},Be=async()=>{try{if(l&&W){const Me=await Pte(l,W);j(Me),v(!1)}}catch(Me){console.error(Me),h("Failed to crop image")}},Se=()=>{v(!1),R(1),j(null)},Re=async()=>{const Me=Y||l;if(Me){f(!0);try{const Le=Me.split(",")[1];b("Enhancing photo...");const st=(s==="document"?await ce.enhanceDocumentPhoto(Le,"image/jpeg"):null)||Le;t(st,"image/jpeg"),e()}catch(Le){h(Le.message||"Processing failed.")}finally{f(!1)}}},Ye=()=>{le(),e()};if(!n)return null;const De=Y||l;return r.jsxs("div",{className:"fixed inset-0 z-[200] flex flex-col bg-black text-white",children:[P&&r.jsx("div",{className:"absolute inset-0 bg-white z-50"}),m&&r.jsxs("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center bg-black/80",children:[r.jsx(xt,{className:"h-12 w-12 animate-spin text-white"}),r.jsx("p",{className:"mt-4 text-lg font-semibold",children:p})]}),r.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/70 to-transparent z-30 flex justify-between items-center",children:[r.jsx(se,{variant:"icon",className:"!text-white hover:!bg-white/20 !p-2",onClick:Ye,children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsx("h3",{className:"text-lg font-bold flex-1 text-center",children:x?"Crop Photo":l?"Preview":"Capture Photo"}),r.jsx("div",{className:"w-10"})]}),r.jsxs("div",{className:"flex-grow relative flex items-center justify-center overflow-hidden bg-black",children:[d&&!l&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white p-4 text-center bg-black/50 z-10",children:d}),x&&l?r.jsx("div",{className:"absolute inset-0",children:r.jsx(Dte,{image:l,crop:S,zoom:V,aspect:s==="profile"?1:4/3,onCropChange:B,onCropComplete:xe,onZoomChange:R,cropShape:s==="profile"?"round":"rect",style:{containerStyle:{backgroundColor:"transparent"},mediaStyle:{objectFit:"contain"}},classes:{containerClassName:"bg-black/30"}})}):r.jsxs(r.Fragment,{children:[r.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:`w-full h-full object-cover ${l?"hidden":""}`}),De&&r.jsx("img",{src:De,alt:"Preview",className:"w-full h-full object-contain"})]}),r.jsx("canvas",{ref:a,className:"hidden"})]}),r.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent z-30",children:[d&&!l&&r.jsx("div",{className:"mb-2 p-3 bg-red-500/30 text-white text-sm rounded-lg text-center",children:d}),x&&r.jsx("div",{className:"mb-4 px-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(pG,{className:"h-5 w-5 text-white/70"}),r.jsx("input",{type:"range",min:1,max:3,step:.1,value:V,onChange:Me=>R(Number(Me.target.value)),className:"flex-1 h-1 bg-white/20 rounded-lg"}),r.jsx(fG,{className:"h-5 w-5 text-white/70"})]})}),r.jsx("div",{className:"flex justify-around items-center",children:x?r.jsxs(r.Fragment,{children:[r.jsx(se,{onClick:Se,variant:"secondary",size:"lg",className:"!rounded-full !px-6",children:"Cancel"}),r.jsxs(se,{onClick:Be,size:"lg",className:"!rounded-full !px-6",children:[r.jsx(Rl,{className:"h-5 w-5 mr-2"})," Apply"]})]}):l?r.jsxs(r.Fragment,{children:[r.jsx(se,{onClick:ie,variant:"secondary",size:"lg",className:"!rounded-full !p-4",children:r.jsx(Du,{className:"h-6 w-6"})}),r.jsx(se,{onClick:_e,variant:"secondary",size:"lg",className:"!rounded-full !p-4",children:r.jsx(z6,{className:"h-6 w-6"})}),r.jsx(se,{onClick:Re,size:"lg",className:"!rounded-full !p-4",children:r.jsx(Rl,{className:"h-6 w-6"})})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"w-16 h-16 flex items-center justify-center",children:[K==="environment"&&te&&r.jsx(se,{onClick:ge,variant:"icon",className:"!text-white hover:!bg-white/20 !rounded-full !p-3",children:O?r.jsx(y$,{className:"h-6 w-6"}):r.jsx(CZ,{className:"h-6 w-6"})}),K==="user"&&r.jsx(se,{onClick:()=>U(!de),variant:"icon",className:`!rounded-full !p-3 ${de?"!text-yellow-400":"!text-white"} hover:!bg-white/20`,children:r.jsx(wH,{className:"h-6 w-6"})})]}),r.jsx(se,{onClick:Ce,disabled:!!d||!o.current,size:"lg",className:"!rounded-full !w-20 !h-20",children:r.jsx(dG,{className:"h-8 w-8"})}),r.jsx("div",{className:"w-16 h-16 flex items-center justify-center",children:M.length>1&&r.jsx(se,{onClick:()=>z(Me=>(Me+1)%M.length),variant:"icon",className:"!text-white hover:!bg-white/20 !rounded-full !p-3",children:r.jsx(Du,{className:"h-6 w-6"})})})]})})]})]})},Kte=({isOpen:n,onClose:e,imageUrl:t})=>n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80 p-4",onClick:e,role:"dialog","aria-modal":"true",children:r.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onClick:s=>s.stopPropagation(),children:[r.jsx("img",{src:t,alt:"Document Preview",className:"max-w-full max-h-full object-contain rounded-lg"}),r.jsx("button",{onClick:e,className:"absolute top-0 right-0 m-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/80 transition-colors","aria-label":"Close image preview",children:r.jsx(Zi,{className:"h-6 w-6"})})]})}):null,pt=({label:n,file:e,onFileChange:t,allowedTypes:s=["image/jpeg","image/png","application/pdf"],error:i,allowCapture:a=!1,costingItemName:o,verificationStatus:l,onOcrComplete:c,ocrSchema:d,setToast:h,docType:m,onVerification:f})=>{const[p,b]=k.useState(!1),[x,v]=k.useState(""),[S,B]=k.useState(!1),[V,R]=k.useState(!1),{logVerificationUsage:W}=Qn.getState(),_=k.useMemo(()=>{const E=n.toLowerCase();return E.includes("photo")?"profile":["proof","document","card","slip","passbook","cheque","certificate"].some(te=>E.includes(te))?"document":"none"},[n]),Y=k.useCallback(async E=>{if(!s.includes(E.type)){v(`Invalid file type. Allowed: ${s.join(", ")}.`);return}if(E.size>5*1024*1024){v("File size must be less than 5MB.");return}v(""),b(!0);const te=URL.createObjectURL(E);let q={name:E.name,type:E.type,size:E.size,preview:te,file:E};t(q),o&&W(o);try{const de=new FileReader;de.readAsDataURL(E),de.onloadend=async()=>{try{const U=de.result.split(",")[1];if(f){const P=await f(U,E.type);if(!P.success){v(P.reason),b(!1);return}}if(c&&d&&h)try{const P=await ce.extractDataFromImage(U,E.type,d,m);c(P)}catch(P){console.error("OCR failed:",P),h({message:"AI extraction failed. Please check the document.",type:"error"})}}catch(U){v(U.message||"Processing failed.")}finally{b(!1)}},de.onerror=()=>{throw new Error("Could not read file for processing.")}}catch(de){v(de.message||"Processing failed."),b(!1)}},[s,t,o,W,c,d,h,m,f]),j=k.useCallback(async(E,te)=>{const q=await(await fetch(`data:${te};base64,${E}`)).blob(),de=new File([q],`capture-${Date.now()}.jpg`,{type:te});Y(de)},[Y]),M=()=>{e&&URL.revokeObjectURL(e.preview),t(null),v("")},H=`file-upload-${n.replace(/\s+/g,"-")}`,D=i||x,O=(E=>{const te=E.toLowerCase();return te.includes("profile photo")?Jl:te.includes("id proof")||te.includes("aadhaar")||te.includes("pan")||te.includes("voter")?dH:te.includes("bank proof")?Xl:te.includes("signature")?uZ:te.includes("fingerprint")?uH:te.includes("certificate")?hH:Cr})(n);return r.jsxs("div",{className:"w-full",children:[r.jsx(Kte,{isOpen:V,onClose:()=>R(!1),imageUrl:e?.preview||""}),S&&r.jsx(BG,{isOpen:S,onClose:()=>B(!1),onCapture:j,captureGuidance:_}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("label",{className:"block text-sm font-medium text-muted",htmlFor:H,children:n}),l===!0&&r.jsx("span",{title:"Verified",children:r.jsx(Gi,{className:"h-4 w-4 text-green-400"})}),l===!1&&r.jsx("span",{title:"Verification Failed",children:r.jsx(Gm,{className:"h-4 w-4 text-red-400"})})]}),r.jsx("div",{className:"w-full text-center transition-all duration-300",children:e?r.jsxs("div",{className:"w-full flex flex-col h-full bg-page p-2 border border-border rounded-lg relative pro-dark-theme:bg-[#0d2c18] pro-dark-theme:border-[#123820]",children:[r.jsxs("div",{className:"flex-grow w-full rounded-md overflow-hidden group relative bg-black/10 flex items-center justify-center min-h-[100px]",children:[p?r.jsxs("div",{className:"flex flex-col items-center text-muted",children:[r.jsx(xt,{className:"h-8 w-8 animate-spin"}),r.jsx("span",{className:"text-xs mt-2",children:"Processing..."})]}):e.type.startsWith("image/")?r.jsx("img",{src:e.preview,alt:"preview",className:"max-w-full max-h-28 object-contain"}):r.jsxs("div",{className:"text-muted p-2",children:[r.jsx(t$,{className:"h-10 w-10 mx-auto"}),r.jsx("span",{className:"text-xs mt-1 block break-all",children:e.name})]}),r.jsx("label",{htmlFor:H,className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-md cursor-pointer",children:r.jsx(Du,{className:"h-6 w-6 text-white"})})]}),r.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 flex-shrink-0",children:[e.type.startsWith("image/")&&r.jsxs("button",{type:"button",onClick:()=>R(!0),className:"text-xs font-medium text-accent hover:underline flex items-center gap-1 p-1",children:[r.jsx(jl,{className:"h-3 w-3"})," View"]}),r.jsxs("button",{type:"button",onClick:M,className:"text-xs font-medium text-red-500 hover:underline flex items-center gap-1 p-1",children:[r.jsx(rn,{className:"h-3 w-3"})," Remove"]})]})]}):r.jsxs("label",{htmlFor:H,className:`
                        cursor-pointer flex flex-col items-center justify-center
                        p-6 border-2 border-dashed rounded-lg transition-colors
                        border-border hover:border-accent hover:bg-accent-light
                        pro-dark-theme:border-gray-600 pro-dark-theme:hover:border-accent pro-dark-theme:hover:bg-accent-light
                        ${D?"!border-red-500":""}
                    `,children:[r.jsx("div",{className:"p-3 bg-accent-light rounded-full text-accent-dark pro-dark-theme:bg-accent/20 pro-dark-theme:text-accent",children:r.jsx(O,{className:"h-8 w-8"})}),r.jsx("p",{className:"font-semibold text-primary-text mt-2",children:"Click to upload"}),r.jsx("p",{className:"text-xs text-muted mt-1",children:"or drag & drop"}),a&&r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"text-xs text-muted my-2",children:"OR"}),r.jsxs(se,{type:"button",onClick:E=>{E.preventDefault(),B(!0)},variant:"secondary",size:"sm",children:[r.jsx(dG,{className:"h-4 w-4 mr-2"}),"Capture with Camera"]})]})]})}),r.jsx("input",{id:H,type:"file",className:"sr-only",onChange:E=>E.target.files?.[0]&&Y(E.target.files[0]),accept:s.join(",")}),r.jsx("div",{className:"text-center mt-1 min-h-[16px]",children:D&&r.jsx("p",{className:"text-xs text-red-500",children:D})})]})};var iy={},Xh={},ay={exports:{}},oy,IW;function Ote(){if(IW)return oy;IW=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return oy=n,oy}var ly,CW;function zte(){if(CW)return ly;CW=1;var n=Ote();function e(){}function t(){}return t.resetWarningCache=e,ly=function(){function s(o,l,c,d,h,m){if(m!==n){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}s.isRequired=s;function i(){return s}var a={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},ly}var fW;function La(){return fW||(fW=1,ay.exports=zte()()),ay.exports}var Jh={},eg={},cy={exports:{}};var pW;function Rg(){return pW||(pW=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var a="",o=0;o<arguments.length;o++){var l=arguments[o];l&&(a=i(a,s(l)))}return a}function s(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return t.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var l in a)e.call(a,l)&&a[l]&&(o=i(o,l));return o}function i(a,o){return o?a?a+" "+o:a+o:a}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(cy)),cy.exports}var dy={},gy={},uy={},hy={},AW;function Je(){if(AW)return hy;AW=1,hy.toDate=n;function n(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}return hy}var my={},bW;function Cn(){if(bW)return my;bW=1,my.constructFrom=n;function n(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}return my}var yW;function Ml(){if(yW)return uy;yW=1,uy.addDays=t;var n=Je(),e=Cn();function t(s,i){const a=(0,n.toDate)(s);return isNaN(i)?(0,e.constructFrom)(s,NaN):(i&&a.setDate(a.getDate()+i),a)}return uy}var Iy={},vW;function Km(){if(vW)return Iy;vW=1,Iy.addMonths=t;var n=Je(),e=Cn();function t(s,i){const a=(0,n.toDate)(s);if(isNaN(i))return(0,e.constructFrom)(s,NaN);if(!i)return a;const o=a.getDate(),l=(0,e.constructFrom)(s,a.getTime());l.setMonth(a.getMonth()+i+1,0);const c=l.getDate();return o>=c?l:(a.setFullYear(l.getFullYear(),l.getMonth(),o),a)}return Iy}var xW;function cT(){if(xW)return gy;xW=1,gy.add=i;var n=Ml(),e=Km(),t=Cn(),s=Je();function i(a,o){const{years:l=0,months:c=0,weeks:d=0,days:h=0,hours:m=0,minutes:f=0,seconds:p=0}=o,b=(0,s.toDate)(a),x=c||l?(0,e.addMonths)(b,c+l*12):b,v=h||d?(0,n.addDays)(x,h+d*7):x,S=f+m*60,V=(p+S*60)*1e3;return(0,t.constructFrom)(a,v.getTime()+V)}return gy}var Cy={},fy={},SW;function dT(){if(SW)return fy;SW=1,fy.isSaturday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===6}return fy}var py={},wW;function gT(){if(wW)return py;wW=1,py.isSunday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===0}return py}var Ay={},ZW;function Rp(){if(ZW)return Ay;ZW=1,Ay.isWeekend=e;var n=Je();function e(t){const s=(0,n.toDate)(t).getDay();return s===0||s===6}return Ay}var GW;function uT(){if(GW)return Cy;GW=1,Cy.addBusinessDays=a;var n=Cn(),e=dT(),t=gT(),s=Rp(),i=Je();function a(o,l){const c=(0,i.toDate)(o),d=(0,s.isWeekend)(c);if(isNaN(l))return(0,n.constructFrom)(o,NaN);const h=c.getHours(),m=l<0?-1:1,f=Math.trunc(l/5);c.setDate(c.getDate()+f*7);let p=Math.abs(l%5);for(;p>0;)c.setDate(c.getDate()+m),(0,s.isWeekend)(c)||(p-=1);return d&&(0,s.isWeekend)(c)&&l!==0&&((0,e.isSaturday)(c)&&c.setDate(c.getDate()+(m<0?2:-1)),(0,t.isSunday)(c)&&c.setDate(c.getDate()+(m<0?1:-2))),c.setHours(h),c}return Cy}var by={},yy={},BW;function Om(){if(BW)return yy;BW=1,yy.addMilliseconds=t;var n=Je(),e=Cn();function t(s,i){const a=+(0,n.toDate)(s);return(0,e.constructFrom)(s,a+i)}return yy}var Vt={},NW;function qt(){if(NW)return Vt;NW=1,Vt.secondsInYear=Vt.secondsInWeek=Vt.secondsInQuarter=Vt.secondsInMonth=Vt.secondsInMinute=Vt.secondsInHour=Vt.secondsInDay=Vt.quartersInYear=Vt.monthsInYear=Vt.monthsInQuarter=Vt.minutesInYear=Vt.minutesInMonth=Vt.minutesInHour=Vt.minutesInDay=Vt.minTime=Vt.millisecondsInWeek=Vt.millisecondsInSecond=Vt.millisecondsInMinute=Vt.millisecondsInHour=Vt.millisecondsInDay=Vt.maxTime=Vt.daysInYear=Vt.daysInWeek=void 0,Vt.daysInWeek=7;const n=Vt.daysInYear=365.2425,e=Vt.maxTime=Math.pow(10,8)*24*60*60*1e3;Vt.minTime=-e,Vt.millisecondsInWeek=6048e5,Vt.millisecondsInDay=864e5,Vt.millisecondsInMinute=6e4,Vt.millisecondsInHour=36e5,Vt.millisecondsInSecond=1e3,Vt.minutesInYear=525600,Vt.minutesInMonth=43200,Vt.minutesInDay=1440,Vt.minutesInHour=60,Vt.monthsInQuarter=3,Vt.monthsInYear=12,Vt.quartersInYear=4;const t=Vt.secondsInHour=3600;Vt.secondsInMinute=60;const s=Vt.secondsInDay=t*24;Vt.secondsInWeek=s*7;const i=Vt.secondsInYear=s*n,a=Vt.secondsInMonth=i/12;return Vt.secondsInQuarter=a*3,Vt}var kW;function NG(){if(kW)return by;kW=1,by.addHours=t;var n=Om(),e=qt();function t(s,i){return(0,n.addMilliseconds)(s,i*e.millisecondsInHour)}return by}var vy={},xy={},Sy={},wy={},oC={},RW;function _r(){if(RW)return oC;RW=1,oC.getDefaultOptions=e,oC.setDefaultOptions=t;let n={};function e(){return n}function t(s){n=s}return oC}var WW;function Jo(){if(WW)return wy;WW=1,wy.startOfWeek=t;var n=Je(),e=_r();function t(s,i){const a=(0,e.getDefaultOptions)(),o=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=(0,n.toDate)(s),c=l.getDay(),d=(c<o?7:0)+c-o;return l.setDate(l.getDate()-d),l.setHours(0,0,0,0),l}return wy}var VW;function Hl(){if(VW)return Sy;VW=1,Sy.startOfISOWeek=e;var n=Jo();function e(t){return(0,n.startOfWeek)(t,{weekStartsOn:1})}return Sy}var _W;function Wg(){if(_W)return xy;_W=1,xy.getISOWeekYear=s;var n=Cn(),e=Hl(),t=Je();function s(i){const a=(0,t.toDate)(i),o=a.getFullYear(),l=(0,n.constructFrom)(i,0);l.setFullYear(o+1,0,4),l.setHours(0,0,0,0);const c=(0,e.startOfISOWeek)(l),d=(0,n.constructFrom)(i,0);d.setFullYear(o,0,4),d.setHours(0,0,0,0);const h=(0,e.startOfISOWeek)(d);return a.getTime()>=c.getTime()?o+1:a.getTime()>=h.getTime()?o:o-1}return xy}var Zy={},Gy={},By={},jW;function Wp(){if(jW)return By;jW=1,By.startOfDay=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setHours(0,0,0,0),s}return By}var Ny={},XW;function hd(){if(XW)return Ny;XW=1,Ny.getTimezoneOffsetInMilliseconds=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return i.setUTCFullYear(s.getFullYear()),+t-+i}return Ny}var JW;function md(){if(JW)return Gy;JW=1,Gy.differenceInCalendarDays=s;var n=qt(),e=Wp(),t=hd();function s(i,a){const o=(0,e.startOfDay)(i),l=(0,e.startOfDay)(a),c=+o-(0,t.getTimezoneOffsetInMilliseconds)(o),d=+l-(0,t.getTimezoneOffsetInMilliseconds)(l);return Math.round((c-d)/n.millisecondsInDay)}return Gy}var ky={},YW;function zm(){if(YW)return ky;YW=1,ky.startOfISOWeekYear=s;var n=Wg(),e=Hl(),t=Cn();function s(i){const a=(0,n.getISOWeekYear)(i),o=(0,t.constructFrom)(i,0);return o.setFullYear(a,0,4),o.setHours(0,0,0,0),(0,e.startOfISOWeek)(o)}return ky}var FW;function hT(){if(FW)return Zy;FW=1,Zy.setISOWeekYear=i;var n=Cn(),e=md(),t=zm(),s=Je();function i(a,o){let l=(0,s.toDate)(a);const c=(0,e.differenceInCalendarDays)(l,(0,t.startOfISOWeekYear)(l)),d=(0,n.constructFrom)(a,0);return d.setFullYear(o,0,4),d.setHours(0,0,0,0),l=(0,t.startOfISOWeekYear)(d),l.setDate(l.getDate()+c),l}return Zy}var MW;function mT(){if(MW)return vy;MW=1,vy.addISOWeekYears=t;var n=Wg(),e=hT();function t(s,i){return(0,e.setISOWeekYear)(s,(0,n.getISOWeekYear)(s)+i)}return vy}var Ry={},HW;function kG(){if(HW)return Ry;HW=1,Ry.addMinutes=t;var n=Om(),e=qt();function t(s,i){return(0,n.addMilliseconds)(s,i*e.millisecondsInMinute)}return Ry}var Wy={},TW;function RG(){if(TW)return Wy;TW=1,Wy.addQuarters=e;var n=Km();function e(t,s){const i=s*3;return(0,n.addMonths)(t,i)}return Wy}var Vy={},EW;function IT(){if(EW)return Vy;EW=1,Vy.addSeconds=e;var n=Om();function e(t,s){return(0,n.addMilliseconds)(t,s*1e3)}return Vy}var _y={},DW;function Vp(){if(DW)return _y;DW=1,_y.addWeeks=e;var n=Ml();function e(t,s){const i=s*7;return(0,n.addDays)(t,i)}return _y}var jy={},LW;function CT(){if(LW)return jy;LW=1,jy.addYears=e;var n=Km();function e(t,s){return(0,n.addMonths)(t,s*12)}return jy}var Xy={},PW;function Ute(){if(PW)return Xy;PW=1,Xy.areIntervalsOverlapping=e;var n=Je();function e(t,s,i){const[a,o]=[+(0,n.toDate)(t.start),+(0,n.toDate)(t.end)].sort((d,h)=>d-h),[l,c]=[+(0,n.toDate)(s.start),+(0,n.toDate)(s.end)].sort((d,h)=>d-h);return i?.inclusive?a<=c&&l<=o:a<c&&l<o}return Xy}var Jy={},Yy={},KW;function fT(){if(KW)return Yy;KW=1,Yy.max=e;var n=Je();function e(t){let s;return t.forEach(function(i){const a=(0,n.toDate)(i);(s===void 0||s<a||isNaN(Number(a)))&&(s=a)}),s||new Date(NaN)}return Yy}var Fy={},OW;function pT(){if(OW)return Fy;OW=1,Fy.min=e;var n=Je();function e(t){let s;return t.forEach(i=>{const a=(0,n.toDate)(i);(!s||s>a||isNaN(+a))&&(s=a)}),s||new Date(NaN)}return Fy}var zW;function Qte(){if(zW)return Jy;zW=1,Jy.clamp=t;var n=fT(),e=pT();function t(s,i){return(0,e.min)([(0,n.max)([s,i.start]),i.end])}return Jy}var My={},UW;function qte(){if(UW)return My;UW=1,My.closestIndexTo=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);if(isNaN(Number(i)))return NaN;const a=i.getTime();let o,l;return s.forEach(function(c,d){const h=(0,n.toDate)(c);if(isNaN(Number(h))){o=NaN,l=NaN;return}const m=Math.abs(a-h.getTime());(o==null||m<l)&&(o=d,l=m)}),o}return My}var Hy={},QW;function $te(){if(QW)return Hy;QW=1,Hy.closestTo=t;var n=Cn(),e=Je();function t(s,i){const a=(0,e.toDate)(s);if(isNaN(Number(a)))return(0,n.constructFrom)(s,NaN);const o=a.getTime();let l,c;return i.forEach(d=>{const h=(0,e.toDate)(d);if(isNaN(Number(h))){l=(0,n.constructFrom)(s,NaN),c=NaN;return}const m=Math.abs(o-h.getTime());(l==null||m<c)&&(l=h,c=m)}),l}return Hy}var Ty={},qW;function nh(){if(qW)return Ty;qW=1,Ty.compareAsc=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s),o=i.getTime()-a.getTime();return o<0?-1:o>0?1:o}return Ty}var Ey={},$W;function ene(){if($W)return Ey;$W=1,Ey.compareDesc=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s),o=i.getTime()-a.getTime();return o>0?-1:o<0?1:o}return Ey}var Dy={},eV;function ii(){if(eV)return Dy;eV=1,Dy.constructNow=e;var n=Cn();function e(t){return(0,n.constructFrom)(t,Date.now())}return Dy}var Ly={},tV;function tne(){if(tV)return Ly;tV=1,Ly.daysToWeeks=e;var n=qt();function e(t){const s=t/n.daysInWeek,i=Math.trunc(s);return i===0?0:i}return Ly}var Py={},Ky={},nV;function Um(){if(nV)return Ky;nV=1,Ky.isSameDay=e;var n=Wp();function e(t,s){const i=(0,n.startOfDay)(t),a=(0,n.startOfDay)(s);return+i==+a}return Ky}var Oy={},zy={},sV;function AT(){if(sV)return zy;sV=1,zy.isDate=n;function n(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}return zy}var rV;function Id(){if(rV)return Oy;rV=1,Oy.isValid=t;var n=AT(),e=Je();function t(s){if(!(0,n.isDate)(s)&&typeof s!="number")return!1;const i=(0,e.toDate)(s);return!isNaN(Number(i))}return Oy}var iV;function nne(){if(iV)return Py;iV=1,Py.differenceInBusinessDays=o;var n=Ml(),e=md(),t=Um(),s=Id(),i=Rp(),a=Je();function o(l,c){const d=(0,a.toDate)(l);let h=(0,a.toDate)(c);if(!(0,s.isValid)(d)||!(0,s.isValid)(h))return NaN;const m=(0,e.differenceInCalendarDays)(d,h),f=m<0?-1:1,p=Math.trunc(m/7);let b=p*5;for(h=(0,n.addDays)(h,p*7);!(0,t.isSameDay)(d,h);)b+=(0,i.isWeekend)(h)?0:f,h=(0,n.addDays)(h,f);return b===0?0:b}return Py}var Uy={},aV;function bT(){if(aV)return Uy;aV=1,Uy.differenceInCalendarISOWeekYears=e;var n=Wg();function e(t,s){return(0,n.getISOWeekYear)(t)-(0,n.getISOWeekYear)(s)}return Uy}var Qy={},oV;function sne(){if(oV)return Qy;oV=1,Qy.differenceInCalendarISOWeeks=s;var n=qt(),e=Hl(),t=hd();function s(i,a){const o=(0,e.startOfISOWeek)(i),l=(0,e.startOfISOWeek)(a),c=+o-(0,t.getTimezoneOffsetInMilliseconds)(o),d=+l-(0,t.getTimezoneOffsetInMilliseconds)(l);return Math.round((c-d)/n.millisecondsInWeek)}return Qy}var qy={},lV;function WG(){if(lV)return qy;lV=1,qy.differenceInCalendarMonths=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s),o=i.getFullYear()-a.getFullYear(),l=i.getMonth()-a.getMonth();return o*12+l}return qy}var $y={},e0={},cV;function yT(){if(cV)return e0;cV=1,e0.getQuarter=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return Math.trunc(s.getMonth()/3)+1}return e0}var dV;function vT(){if(dV)return $y;dV=1,$y.differenceInCalendarQuarters=t;var n=yT(),e=Je();function t(s,i){const a=(0,e.toDate)(s),o=(0,e.toDate)(i),l=a.getFullYear()-o.getFullYear(),c=(0,n.getQuarter)(a)-(0,n.getQuarter)(o);return l*4+c}return $y}var t0={},gV;function VG(){if(gV)return t0;gV=1,t0.differenceInCalendarWeeks=s;var n=qt(),e=Jo(),t=hd();function s(i,a,o){const l=(0,e.startOfWeek)(i,o),c=(0,e.startOfWeek)(a,o),d=+l-(0,t.getTimezoneOffsetInMilliseconds)(l),h=+c-(0,t.getTimezoneOffsetInMilliseconds)(c);return Math.round((d-h)/n.millisecondsInWeek)}return t0}var n0={},uV;function _G(){if(uV)return n0;uV=1,n0.differenceInCalendarYears=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return i.getFullYear()-a.getFullYear()}return n0}var s0={},hV;function jG(){if(hV)return s0;hV=1,s0.differenceInDays=t;var n=md(),e=Je();function t(i,a){const o=(0,e.toDate)(i),l=(0,e.toDate)(a),c=s(o,l),d=Math.abs((0,n.differenceInCalendarDays)(o,l));o.setDate(o.getDate()-c*d);const h=+(s(o,l)===-c),m=c*(d-h);return m===0?0:m}function s(i,a){const o=i.getFullYear()-a.getFullYear()||i.getMonth()-a.getMonth()||i.getDate()-a.getDate()||i.getHours()-a.getHours()||i.getMinutes()-a.getMinutes()||i.getSeconds()-a.getSeconds()||i.getMilliseconds()-a.getMilliseconds();return o<0?-1:o>0?1:o}return s0}var r0={},i0={},mV;function Cd(){if(mV)return i0;mV=1,i0.getRoundingMethod=n;function n(e){return t=>{const i=(e?Math[e]:Math.trunc)(t);return i===0?0:i}}return i0}var a0={},IV;function _p(){if(IV)return a0;IV=1,a0.differenceInMilliseconds=e;var n=Je();function e(t,s){return+(0,n.toDate)(t)-+(0,n.toDate)(s)}return a0}var CV;function XG(){if(CV)return r0;CV=1,r0.differenceInHours=s;var n=Cd(),e=qt(),t=_p();function s(i,a,o){const l=(0,t.differenceInMilliseconds)(i,a)/e.millisecondsInHour;return(0,n.getRoundingMethod)(o?.roundingMethod)(l)}return r0}var o0={},l0={},fV;function xT(){if(fV)return l0;fV=1,l0.subISOWeekYears=e;var n=mT();function e(t,s){return(0,n.addISOWeekYears)(t,-s)}return l0}var pV;function rne(){if(pV)return o0;pV=1,o0.differenceInISOWeekYears=i;var n=nh(),e=bT(),t=xT(),s=Je();function i(a,o){let l=(0,s.toDate)(a);const c=(0,s.toDate)(o),d=(0,n.compareAsc)(l,c),h=Math.abs((0,e.differenceInCalendarISOWeekYears)(l,c));l=(0,t.subISOWeekYears)(l,d*h);const m=+((0,n.compareAsc)(l,c)===-d),f=d*(h-m);return f===0?0:f}return o0}var c0={},AV;function JG(){if(AV)return c0;AV=1,c0.differenceInMinutes=s;var n=Cd(),e=qt(),t=_p();function s(i,a,o){const l=(0,t.differenceInMilliseconds)(i,a)/e.millisecondsInMinute;return(0,n.getRoundingMethod)(o?.roundingMethod)(l)}return c0}var d0={},g0={},u0={},bV;function YG(){if(bV)return u0;bV=1,u0.endOfDay=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setHours(23,59,59,999),s}return u0}var h0={},yV;function FG(){if(yV)return h0;yV=1,h0.endOfMonth=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getMonth();return s.setFullYear(s.getFullYear(),i+1,0),s.setHours(23,59,59,999),s}return h0}var vV;function ST(){if(vV)return g0;vV=1,g0.isLastDayOfMonth=s;var n=YG(),e=FG(),t=Je();function s(i){const a=(0,t.toDate)(i);return+(0,n.endOfDay)(a)==+(0,e.endOfMonth)(a)}return g0}var xV;function jp(){if(xV)return d0;xV=1,d0.differenceInMonths=i;var n=nh(),e=WG(),t=ST(),s=Je();function i(a,o){const l=(0,s.toDate)(a),c=(0,s.toDate)(o),d=(0,n.compareAsc)(l,c),h=Math.abs((0,e.differenceInCalendarMonths)(l,c));let m;if(h<1)m=0;else{l.getMonth()===1&&l.getDate()>27&&l.setDate(30),l.setMonth(l.getMonth()-d*h);let f=(0,n.compareAsc)(l,c)===-d;(0,t.isLastDayOfMonth)((0,s.toDate)(a))&&h===1&&(0,n.compareAsc)(a,c)===1&&(f=!1),m=d*(h-Number(f))}return m===0?0:m}return d0}var m0={},SV;function ine(){if(SV)return m0;SV=1,m0.differenceInQuarters=t;var n=Cd(),e=jp();function t(s,i,a){const o=(0,e.differenceInMonths)(s,i)/3;return(0,n.getRoundingMethod)(a?.roundingMethod)(o)}return m0}var I0={},wV;function Xp(){if(wV)return I0;wV=1,I0.differenceInSeconds=t;var n=Cd(),e=_p();function t(s,i,a){const o=(0,e.differenceInMilliseconds)(s,i)/1e3;return(0,n.getRoundingMethod)(a?.roundingMethod)(o)}return I0}var C0={},ZV;function ane(){if(ZV)return C0;ZV=1,C0.differenceInWeeks=t;var n=Cd(),e=jG();function t(s,i,a){const o=(0,e.differenceInDays)(s,i)/7;return(0,n.getRoundingMethod)(a?.roundingMethod)(o)}return C0}var f0={},GV;function wT(){if(GV)return f0;GV=1,f0.differenceInYears=s;var n=nh(),e=_G(),t=Je();function s(i,a){const o=(0,t.toDate)(i),l=(0,t.toDate)(a),c=(0,n.compareAsc)(o,l),d=Math.abs((0,e.differenceInCalendarYears)(o,l));o.setFullYear(1584),l.setFullYear(1584);const h=(0,n.compareAsc)(o,l)===-c,m=c*(d-+h);return m===0?0:m}return f0}var p0={},BV;function ZT(){if(BV)return p0;BV=1,p0.eachDayOfInterval=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t.start),a=(0,n.toDate)(t.end);let o=+i>+a;const l=o?+i:+a,c=o?a:i;c.setHours(0,0,0,0);let d=s?.step??1;if(!d)return[];d<0&&(d=-d,o=!o);const h=[];for(;+c<=l;)h.push((0,n.toDate)(c)),c.setDate(c.getDate()+d),c.setHours(0,0,0,0);return o?h.reverse():h}return p0}var A0={},NV;function one(){if(NV)return A0;NV=1,A0.eachHourOfInterval=t;var n=NG(),e=Je();function t(s,i){const a=(0,e.toDate)(s.start),o=(0,e.toDate)(s.end);let l=+a>+o;const c=l?+a:+o;let d=l?o:a;d.setMinutes(0,0,0);let h=i?.step??1;if(!h)return[];h<0&&(h=-h,l=!l);const m=[];for(;+d<=c;)m.push((0,e.toDate)(d)),d=(0,n.addHours)(d,h);return l?m.reverse():m}return A0}var b0={},y0={},kV;function MG(){if(kV)return y0;kV=1,y0.startOfMinute=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setSeconds(0,0),s}return y0}var RV;function lne(){if(RV)return b0;RV=1,b0.eachMinuteOfInterval=s;var n=kG(),e=MG(),t=Je();function s(i,a){const o=(0,e.startOfMinute)((0,t.toDate)(i.start)),l=(0,t.toDate)(i.end);let c=+o>+l;const d=c?+o:+l;let h=c?l:o,m=a?.step??1;if(!m)return[];m<0&&(m=-m,c=!c);const f=[];for(;+h<=d;)f.push((0,t.toDate)(h)),h=(0,n.addMinutes)(h,m);return c?f.reverse():f}return b0}var v0={},WV;function cne(){if(WV)return v0;WV=1,v0.eachMonthOfInterval=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t.start),a=(0,n.toDate)(t.end);let o=+i>+a;const l=o?+i:+a,c=o?a:i;c.setHours(0,0,0,0),c.setDate(1);let d=s?.step??1;if(!d)return[];d<0&&(d=-d,o=!o);const h=[];for(;+c<=l;)h.push((0,n.toDate)(c)),c.setMonth(c.getMonth()+d);return o?h.reverse():h}return v0}var x0={},S0={},VV;function HG(){if(VV)return S0;VV=1,S0.startOfQuarter=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getMonth(),a=i-i%3;return s.setMonth(a,1),s.setHours(0,0,0,0),s}return S0}var _V;function dne(){if(_V)return x0;_V=1,x0.eachQuarterOfInterval=s;var n=RG(),e=HG(),t=Je();function s(i,a){const o=(0,t.toDate)(i.start),l=(0,t.toDate)(i.end);let c=+o>+l;const d=c?+(0,e.startOfQuarter)(o):+(0,e.startOfQuarter)(l);let h=c?(0,e.startOfQuarter)(l):(0,e.startOfQuarter)(o),m=a?.step??1;if(!m)return[];m<0&&(m=-m,c=!c);const f=[];for(;+h<=d;)f.push((0,t.toDate)(h)),h=(0,n.addQuarters)(h,m);return c?f.reverse():f}return x0}var w0={},jV;function gne(){if(jV)return w0;jV=1,w0.eachWeekOfInterval=s;var n=Vp(),e=Jo(),t=Je();function s(i,a){const o=(0,t.toDate)(i.start),l=(0,t.toDate)(i.end);let c=+o>+l;const d=c?(0,e.startOfWeek)(l,a):(0,e.startOfWeek)(o,a),h=c?(0,e.startOfWeek)(o,a):(0,e.startOfWeek)(l,a);d.setHours(15),h.setHours(15);const m=+h.getTime();let f=d,p=a?.step??1;if(!p)return[];p<0&&(p=-p,c=!c);const b=[];for(;+f<=m;)f.setHours(0),b.push((0,t.toDate)(f)),f=(0,n.addWeeks)(f,p),f.setHours(15);return c?b.reverse():b}return w0}var Z0={},XV;function TG(){if(XV)return Z0;XV=1,Z0.eachWeekendOfInterval=t;var n=ZT(),e=Rp();function t(s){const i=(0,n.eachDayOfInterval)(s),a=[];let o=0;for(;o<i.length;){const l=i[o++];(0,e.isWeekend)(l)&&a.push(l)}return a}return Z0}var G0={},B0={},JV;function Jp(){if(JV)return B0;JV=1,B0.startOfMonth=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setDate(1),s.setHours(0,0,0,0),s}return B0}var YV;function une(){if(YV)return G0;YV=1,G0.eachWeekendOfMonth=s;var n=TG(),e=FG(),t=Jp();function s(i){const a=(0,t.startOfMonth)(i),o=(0,e.endOfMonth)(i);return(0,n.eachWeekendOfInterval)({start:a,end:o})}return G0}var N0={},k0={},FV;function GT(){if(FV)return k0;FV=1,k0.endOfYear=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getFullYear();return s.setFullYear(i+1,0,0),s.setHours(23,59,59,999),s}return k0}var R0={},MV;function EG(){if(MV)return R0;MV=1,R0.startOfYear=t;var n=Je(),e=Cn();function t(s){const i=(0,n.toDate)(s),a=(0,e.constructFrom)(s,0);return a.setFullYear(i.getFullYear(),0,1),a.setHours(0,0,0,0),a}return R0}var HV;function hne(){if(HV)return N0;HV=1,N0.eachWeekendOfYear=s;var n=TG(),e=GT(),t=EG();function s(i){const a=(0,t.startOfYear)(i),o=(0,e.endOfYear)(i);return(0,n.eachWeekendOfInterval)({start:a,end:o})}return N0}var W0={},TV;function mne(){if(TV)return W0;TV=1,W0.eachYearOfInterval=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t.start),a=(0,n.toDate)(t.end);let o=+i>+a;const l=o?+i:+a,c=o?a:i;c.setHours(0,0,0,0),c.setMonth(0,1);let d=s?.step??1;if(!d)return[];d<0&&(d=-d,o=!o);const h=[];for(;+c<=l;)h.push((0,n.toDate)(c)),c.setFullYear(c.getFullYear()+d);return o?h.reverse():h}return W0}var V0={},EV;function Ine(){if(EV)return V0;EV=1,V0.endOfDecade=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getFullYear(),a=9+Math.floor(i/10)*10;return s.setFullYear(a,11,31),s.setHours(23,59,59,999),s}return V0}var _0={},DV;function Cne(){if(DV)return _0;DV=1,_0.endOfHour=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setMinutes(59,59,999),s}return _0}var j0={},X0={},LV;function BT(){if(LV)return X0;LV=1,X0.endOfWeek=t;var n=Je(),e=_r();function t(s,i){const a=(0,e.getDefaultOptions)(),o=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=(0,n.toDate)(s),c=l.getDay(),d=(c<o?-7:0)+6-(c-o);return l.setDate(l.getDate()+d),l.setHours(23,59,59,999),l}return X0}var PV;function fne(){if(PV)return j0;PV=1,j0.endOfISOWeek=e;var n=BT();function e(t){return(0,n.endOfWeek)(t,{weekStartsOn:1})}return j0}var J0={},KV;function pne(){if(KV)return J0;KV=1,J0.endOfISOWeekYear=s;var n=Wg(),e=Hl(),t=Cn();function s(i){const a=(0,n.getISOWeekYear)(i),o=(0,t.constructFrom)(i,0);o.setFullYear(a+1,0,4),o.setHours(0,0,0,0);const l=(0,e.startOfISOWeek)(o);return l.setMilliseconds(l.getMilliseconds()-1),l}return J0}var Y0={},OV;function Ane(){if(OV)return Y0;OV=1,Y0.endOfMinute=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setSeconds(59,999),s}return Y0}var F0={},zV;function bne(){if(zV)return F0;zV=1,F0.endOfQuarter=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getMonth(),a=i-i%3+3;return s.setMonth(a,0),s.setHours(23,59,59,999),s}return F0}var M0={},UV;function yne(){if(UV)return M0;UV=1,M0.endOfSecond=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setMilliseconds(999),s}return M0}var H0={},QV;function vne(){if(QV)return H0;QV=1,H0.endOfToday=e;var n=YG();function e(){return(0,n.endOfDay)(Date.now())}return H0}var T0={},qV;function xne(){if(qV)return T0;qV=1,T0.endOfTomorrow=n;function n(){const e=new Date,t=e.getFullYear(),s=e.getMonth(),i=e.getDate(),a=new Date(0);return a.setFullYear(t,s,i+1),a.setHours(23,59,59,999),a}return T0}var E0={},$V;function Sne(){if($V)return E0;$V=1,E0.endOfYesterday=n;function n(){const e=new Date,t=e.getFullYear(),s=e.getMonth(),i=e.getDate(),a=new Date(0);return a.setFullYear(t,s,i-1),a.setHours(23,59,59,999),a}return E0}var D0={},L0={},lC={},cC={},e1;function wne(){if(e1)return cC;e1=1,cC.formatDistance=void 0;const n={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},e=(t,s,i)=>{let a;const o=n[t];return typeof o=="string"?a=o:s===1?a=o.one:a=o.other.replace("{{count}}",s.toString()),i?.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};return cC.formatDistance=e,cC}var dC={},P0={},t1;function Zne(){if(t1)return P0;t1=1,P0.buildFormatLongFn=n;function n(e){return(t={})=>{const s=t.width?String(t.width):e.defaultWidth;return e.formats[s]||e.formats[e.defaultWidth]}}return P0}var n1;function Gne(){if(n1)return dC;n1=1,dC.formatLong=void 0;var n=Zne();const e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},t={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},s={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"};return dC.formatLong={date:(0,n.buildFormatLongFn)({formats:e,defaultWidth:"full"}),time:(0,n.buildFormatLongFn)({formats:t,defaultWidth:"full"}),dateTime:(0,n.buildFormatLongFn)({formats:s,defaultWidth:"full"})},dC}var gC={},s1;function Bne(){if(s1)return gC;s1=1,gC.formatRelative=void 0;const n={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},e=(t,s,i,a)=>n[t];return gC.formatRelative=e,gC}var uC={},K0={},r1;function Nne(){if(r1)return K0;r1=1,K0.buildLocalizeFn=n;function n(e){return(t,s)=>{const i=s?.context?String(s.context):"standalone";let a;if(i==="formatting"&&e.formattingValues){const l=e.defaultFormattingWidth||e.defaultWidth,c=s?.width?String(s.width):l;a=e.formattingValues[c]||e.formattingValues[l]}else{const l=e.defaultWidth,c=s?.width?String(s.width):e.defaultWidth;a=e.values[c]||e.values[l]}const o=e.argumentCallback?e.argumentCallback(t):t;return a[o]}}return K0}var i1;function kne(){if(i1)return uC;i1=1,uC.localize=void 0;var n=Nne();const e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},t={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},s={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},i={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},a={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},o={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},l=(c,d)=>{const h=Number(c),m=h%100;if(m>20||m<10)switch(m%10){case 1:return h+"st";case 2:return h+"nd";case 3:return h+"rd"}return h+"th"};return uC.localize={ordinalNumber:l,era:(0,n.buildLocalizeFn)({values:e,defaultWidth:"wide"}),quarter:(0,n.buildLocalizeFn)({values:t,defaultWidth:"wide",argumentCallback:c=>c-1}),month:(0,n.buildLocalizeFn)({values:s,defaultWidth:"wide"}),day:(0,n.buildLocalizeFn)({values:i,defaultWidth:"wide"}),dayPeriod:(0,n.buildLocalizeFn)({values:a,defaultWidth:"wide",formattingValues:o,defaultFormattingWidth:"wide"})},uC}var hC={},O0={},a1;function Rne(){if(a1)return O0;a1=1,O0.buildMatchFn=n;function n(s){return(i,a={})=>{const o=a.width,l=o&&s.matchPatterns[o]||s.matchPatterns[s.defaultMatchWidth],c=i.match(l);if(!c)return null;const d=c[0],h=o&&s.parsePatterns[o]||s.parsePatterns[s.defaultParseWidth],m=Array.isArray(h)?t(h,b=>b.test(d)):e(h,b=>b.test(d));let f;f=s.valueCallback?s.valueCallback(m):m,f=a.valueCallback?a.valueCallback(f):f;const p=i.slice(d.length);return{value:f,rest:p}}}function e(s,i){for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)&&i(s[a]))return a}function t(s,i){for(let a=0;a<s.length;a++)if(i(s[a]))return a}return O0}var z0={},o1;function Wne(){if(o1)return z0;o1=1,z0.buildMatchPatternFn=n;function n(e){return(t,s={})=>{const i=t.match(e.matchPattern);if(!i)return null;const a=i[0],o=t.match(e.parsePattern);if(!o)return null;let l=e.valueCallback?e.valueCallback(o[0]):o[0];l=s.valueCallback?s.valueCallback(l):l;const c=t.slice(a.length);return{value:l,rest:c}}}return z0}var l1;function Vne(){if(l1)return hC;l1=1,hC.match=void 0;var n=Rne(),e=Wne();const t=/^(\d+)(th|st|nd|rd)?/i,s=/\d+/i,i={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},a={any:[/^b/i,/^(a|c)/i]},o={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},l={any:[/1/i,/2/i,/3/i,/4/i]},c={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},d={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},h={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},m={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},f={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},p={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}};return hC.match={ordinalNumber:(0,e.buildMatchPatternFn)({matchPattern:t,parsePattern:s,valueCallback:b=>parseInt(b,10)}),era:(0,n.buildMatchFn)({matchPatterns:i,defaultMatchWidth:"wide",parsePatterns:a,defaultParseWidth:"any"}),quarter:(0,n.buildMatchFn)({matchPatterns:o,defaultMatchWidth:"wide",parsePatterns:l,defaultParseWidth:"any",valueCallback:b=>b+1}),month:(0,n.buildMatchFn)({matchPatterns:c,defaultMatchWidth:"wide",parsePatterns:d,defaultParseWidth:"any"}),day:(0,n.buildMatchFn)({matchPatterns:h,defaultMatchWidth:"wide",parsePatterns:m,defaultParseWidth:"any"}),dayPeriod:(0,n.buildMatchFn)({matchPatterns:f,defaultMatchWidth:"any",parsePatterns:p,defaultParseWidth:"any"})},hC}var c1;function NT(){if(c1)return lC;c1=1,lC.enUS=void 0;var n=wne(),e=Gne(),t=Bne(),s=kne(),i=Vne();return lC.enUS={code:"en-US",formatDistance:n.formatDistance,formatLong:e.formatLong,formatRelative:t.formatRelative,localize:s.localize,match:i.match,options:{weekStartsOn:0,firstWeekContainsDate:1}},lC}var d1;function sh(){return d1||(d1=1,(function(n){Object.defineProperty(n,"defaultLocale",{enumerable:!0,get:function(){return e.enUS}});var e=NT()})(L0)),L0}var mC={},U0={},g1;function kT(){if(g1)return U0;g1=1,U0.getDayOfYear=s;var n=md(),e=EG(),t=Je();function s(i){const a=(0,t.toDate)(i);return(0,n.differenceInCalendarDays)(a,(0,e.startOfYear)(a))+1}return U0}var Q0={},u1;function DG(){if(u1)return Q0;u1=1,Q0.getISOWeek=i;var n=qt(),e=Hl(),t=zm(),s=Je();function i(a){const o=(0,s.toDate)(a),l=+(0,e.startOfISOWeek)(o)-+(0,t.startOfISOWeekYear)(o);return Math.round(l/n.millisecondsInWeek)+1}return Q0}var q0={},$0={},ev={},h1;function Yp(){if(h1)return ev;h1=1,ev.getWeekYear=i;var n=Cn(),e=Jo(),t=Je(),s=_r();function i(a,o){const l=(0,t.toDate)(a),c=l.getFullYear(),d=(0,s.getDefaultOptions)(),h=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??d.firstWeekContainsDate??d.locale?.options?.firstWeekContainsDate??1,m=(0,n.constructFrom)(a,0);m.setFullYear(c+1,0,h),m.setHours(0,0,0,0);const f=(0,e.startOfWeek)(m,o),p=(0,n.constructFrom)(a,0);p.setFullYear(c,0,h),p.setHours(0,0,0,0);const b=(0,e.startOfWeek)(p,o);return l.getTime()>=f.getTime()?c+1:l.getTime()>=b.getTime()?c:c-1}return ev}var m1;function LG(){if(m1)return $0;m1=1,$0.startOfWeekYear=i;var n=Cn(),e=Yp(),t=Jo(),s=_r();function i(a,o){const l=(0,s.getDefaultOptions)(),c=o?.firstWeekContainsDate??o?.locale?.options?.firstWeekContainsDate??l.firstWeekContainsDate??l.locale?.options?.firstWeekContainsDate??1,d=(0,e.getWeekYear)(a,o),h=(0,n.constructFrom)(a,0);return h.setFullYear(d,0,c),h.setHours(0,0,0,0),(0,t.startOfWeek)(h,o)}return $0}var I1;function PG(){if(I1)return q0;I1=1,q0.getWeek=i;var n=qt(),e=Jo(),t=LG(),s=Je();function i(a,o){const l=(0,s.toDate)(a),c=+(0,e.startOfWeek)(l,o)-+(0,t.startOfWeekYear)(l,o);return Math.round(c/n.millisecondsInWeek)+1}return q0}var tv={},C1;function rh(){if(C1)return tv;C1=1,tv.addLeadingZeros=n;function n(e,t){const s=e<0?"-":"",i=Math.abs(e).toString().padStart(t,"0");return s+i}return tv}var IC={},f1;function RT(){if(f1)return IC;f1=1,IC.lightFormatters=void 0;var n=rh();return IC.lightFormatters={y(e,t){const s=e.getFullYear(),i=s>0?s:1-s;return(0,n.addLeadingZeros)(t==="yy"?i%100:i,t.length)},M(e,t){const s=e.getMonth();return t==="M"?String(s+1):(0,n.addLeadingZeros)(s+1,2)},d(e,t){return(0,n.addLeadingZeros)(e.getDate(),t.length)},a(e,t){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(e,t){return(0,n.addLeadingZeros)(e.getHours()%12||12,t.length)},H(e,t){return(0,n.addLeadingZeros)(e.getHours(),t.length)},m(e,t){return(0,n.addLeadingZeros)(e.getMinutes(),t.length)},s(e,t){return(0,n.addLeadingZeros)(e.getSeconds(),t.length)},S(e,t){const s=t.length,i=e.getMilliseconds(),a=Math.trunc(i*Math.pow(10,s-3));return(0,n.addLeadingZeros)(a,t.length)}},IC}var p1;function _ne(){if(p1)return mC;p1=1,mC.formatters=void 0;var n=kT(),e=DG(),t=Wg(),s=PG(),i=Yp(),a=rh(),o=RT();const l={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"};mC.formatters={G:function(m,f,p){const b=m.getFullYear()>0?1:0;switch(f){case"G":case"GG":case"GGG":return p.era(b,{width:"abbreviated"});case"GGGGG":return p.era(b,{width:"narrow"});case"GGGG":default:return p.era(b,{width:"wide"})}},y:function(m,f,p){if(f==="yo"){const b=m.getFullYear(),x=b>0?b:1-b;return p.ordinalNumber(x,{unit:"year"})}return o.lightFormatters.y(m,f)},Y:function(m,f,p,b){const x=(0,i.getWeekYear)(m,b),v=x>0?x:1-x;if(f==="YY"){const S=v%100;return(0,a.addLeadingZeros)(S,2)}return f==="Yo"?p.ordinalNumber(v,{unit:"year"}):(0,a.addLeadingZeros)(v,f.length)},R:function(m,f){const p=(0,t.getISOWeekYear)(m);return(0,a.addLeadingZeros)(p,f.length)},u:function(m,f){const p=m.getFullYear();return(0,a.addLeadingZeros)(p,f.length)},Q:function(m,f,p){const b=Math.ceil((m.getMonth()+1)/3);switch(f){case"Q":return String(b);case"QQ":return(0,a.addLeadingZeros)(b,2);case"Qo":return p.ordinalNumber(b,{unit:"quarter"});case"QQQ":return p.quarter(b,{width:"abbreviated",context:"formatting"});case"QQQQQ":return p.quarter(b,{width:"narrow",context:"formatting"});case"QQQQ":default:return p.quarter(b,{width:"wide",context:"formatting"})}},q:function(m,f,p){const b=Math.ceil((m.getMonth()+1)/3);switch(f){case"q":return String(b);case"qq":return(0,a.addLeadingZeros)(b,2);case"qo":return p.ordinalNumber(b,{unit:"quarter"});case"qqq":return p.quarter(b,{width:"abbreviated",context:"standalone"});case"qqqqq":return p.quarter(b,{width:"narrow",context:"standalone"});case"qqqq":default:return p.quarter(b,{width:"wide",context:"standalone"})}},M:function(m,f,p){const b=m.getMonth();switch(f){case"M":case"MM":return o.lightFormatters.M(m,f);case"Mo":return p.ordinalNumber(b+1,{unit:"month"});case"MMM":return p.month(b,{width:"abbreviated",context:"formatting"});case"MMMMM":return p.month(b,{width:"narrow",context:"formatting"});case"MMMM":default:return p.month(b,{width:"wide",context:"formatting"})}},L:function(m,f,p){const b=m.getMonth();switch(f){case"L":return String(b+1);case"LL":return(0,a.addLeadingZeros)(b+1,2);case"Lo":return p.ordinalNumber(b+1,{unit:"month"});case"LLL":return p.month(b,{width:"abbreviated",context:"standalone"});case"LLLLL":return p.month(b,{width:"narrow",context:"standalone"});case"LLLL":default:return p.month(b,{width:"wide",context:"standalone"})}},w:function(m,f,p,b){const x=(0,s.getWeek)(m,b);return f==="wo"?p.ordinalNumber(x,{unit:"week"}):(0,a.addLeadingZeros)(x,f.length)},I:function(m,f,p){const b=(0,e.getISOWeek)(m);return f==="Io"?p.ordinalNumber(b,{unit:"week"}):(0,a.addLeadingZeros)(b,f.length)},d:function(m,f,p){return f==="do"?p.ordinalNumber(m.getDate(),{unit:"date"}):o.lightFormatters.d(m,f)},D:function(m,f,p){const b=(0,n.getDayOfYear)(m);return f==="Do"?p.ordinalNumber(b,{unit:"dayOfYear"}):(0,a.addLeadingZeros)(b,f.length)},E:function(m,f,p){const b=m.getDay();switch(f){case"E":case"EE":case"EEE":return p.day(b,{width:"abbreviated",context:"formatting"});case"EEEEE":return p.day(b,{width:"narrow",context:"formatting"});case"EEEEEE":return p.day(b,{width:"short",context:"formatting"});case"EEEE":default:return p.day(b,{width:"wide",context:"formatting"})}},e:function(m,f,p,b){const x=m.getDay(),v=(x-b.weekStartsOn+8)%7||7;switch(f){case"e":return String(v);case"ee":return(0,a.addLeadingZeros)(v,2);case"eo":return p.ordinalNumber(v,{unit:"day"});case"eee":return p.day(x,{width:"abbreviated",context:"formatting"});case"eeeee":return p.day(x,{width:"narrow",context:"formatting"});case"eeeeee":return p.day(x,{width:"short",context:"formatting"});case"eeee":default:return p.day(x,{width:"wide",context:"formatting"})}},c:function(m,f,p,b){const x=m.getDay(),v=(x-b.weekStartsOn+8)%7||7;switch(f){case"c":return String(v);case"cc":return(0,a.addLeadingZeros)(v,f.length);case"co":return p.ordinalNumber(v,{unit:"day"});case"ccc":return p.day(x,{width:"abbreviated",context:"standalone"});case"ccccc":return p.day(x,{width:"narrow",context:"standalone"});case"cccccc":return p.day(x,{width:"short",context:"standalone"});case"cccc":default:return p.day(x,{width:"wide",context:"standalone"})}},i:function(m,f,p){const b=m.getDay(),x=b===0?7:b;switch(f){case"i":return String(x);case"ii":return(0,a.addLeadingZeros)(x,f.length);case"io":return p.ordinalNumber(x,{unit:"day"});case"iii":return p.day(b,{width:"abbreviated",context:"formatting"});case"iiiii":return p.day(b,{width:"narrow",context:"formatting"});case"iiiiii":return p.day(b,{width:"short",context:"formatting"});case"iiii":default:return p.day(b,{width:"wide",context:"formatting"})}},a:function(m,f,p){const x=m.getHours()/12>=1?"pm":"am";switch(f){case"a":case"aa":return p.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"aaa":return p.dayPeriod(x,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return p.dayPeriod(x,{width:"narrow",context:"formatting"});case"aaaa":default:return p.dayPeriod(x,{width:"wide",context:"formatting"})}},b:function(m,f,p){const b=m.getHours();let x;switch(b===12?x=l.noon:b===0?x=l.midnight:x=b/12>=1?"pm":"am",f){case"b":case"bb":return p.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"bbb":return p.dayPeriod(x,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return p.dayPeriod(x,{width:"narrow",context:"formatting"});case"bbbb":default:return p.dayPeriod(x,{width:"wide",context:"formatting"})}},B:function(m,f,p){const b=m.getHours();let x;switch(b>=17?x=l.evening:b>=12?x=l.afternoon:b>=4?x=l.morning:x=l.night,f){case"B":case"BB":case"BBB":return p.dayPeriod(x,{width:"abbreviated",context:"formatting"});case"BBBBB":return p.dayPeriod(x,{width:"narrow",context:"formatting"});case"BBBB":default:return p.dayPeriod(x,{width:"wide",context:"formatting"})}},h:function(m,f,p){if(f==="ho"){let b=m.getHours()%12;return b===0&&(b=12),p.ordinalNumber(b,{unit:"hour"})}return o.lightFormatters.h(m,f)},H:function(m,f,p){return f==="Ho"?p.ordinalNumber(m.getHours(),{unit:"hour"}):o.lightFormatters.H(m,f)},K:function(m,f,p){const b=m.getHours()%12;return f==="Ko"?p.ordinalNumber(b,{unit:"hour"}):(0,a.addLeadingZeros)(b,f.length)},k:function(m,f,p){let b=m.getHours();return b===0&&(b=24),f==="ko"?p.ordinalNumber(b,{unit:"hour"}):(0,a.addLeadingZeros)(b,f.length)},m:function(m,f,p){return f==="mo"?p.ordinalNumber(m.getMinutes(),{unit:"minute"}):o.lightFormatters.m(m,f)},s:function(m,f,p){return f==="so"?p.ordinalNumber(m.getSeconds(),{unit:"second"}):o.lightFormatters.s(m,f)},S:function(m,f){return o.lightFormatters.S(m,f)},X:function(m,f,p){const b=m.getTimezoneOffset();if(b===0)return"Z";switch(f){case"X":return d(b);case"XXXX":case"XX":return h(b);case"XXXXX":case"XXX":default:return h(b,":")}},x:function(m,f,p){const b=m.getTimezoneOffset();switch(f){case"x":return d(b);case"xxxx":case"xx":return h(b);case"xxxxx":case"xxx":default:return h(b,":")}},O:function(m,f,p){const b=m.getTimezoneOffset();switch(f){case"O":case"OO":case"OOO":return"GMT"+c(b,":");case"OOOO":default:return"GMT"+h(b,":")}},z:function(m,f,p){const b=m.getTimezoneOffset();switch(f){case"z":case"zz":case"zzz":return"GMT"+c(b,":");case"zzzz":default:return"GMT"+h(b,":")}},t:function(m,f,p){const b=Math.trunc(m.getTime()/1e3);return(0,a.addLeadingZeros)(b,f.length)},T:function(m,f,p){const b=m.getTime();return(0,a.addLeadingZeros)(b,f.length)}};function c(m,f=""){const p=m>0?"-":"+",b=Math.abs(m),x=Math.trunc(b/60),v=b%60;return v===0?p+String(x):p+String(x)+f+(0,a.addLeadingZeros)(v,2)}function d(m,f){return m%60===0?(m>0?"-":"+")+(0,a.addLeadingZeros)(Math.abs(m)/60,2):h(m,f)}function h(m,f=""){const p=m>0?"-":"+",b=Math.abs(m),x=(0,a.addLeadingZeros)(Math.trunc(b/60),2),v=(0,a.addLeadingZeros)(b%60,2);return p+x+f+v}return mC}var CC={},A1;function WT(){if(A1)return CC;A1=1,CC.longFormatters=void 0;const n=(s,i)=>{switch(s){case"P":return i.date({width:"short"});case"PP":return i.date({width:"medium"});case"PPP":return i.date({width:"long"});case"PPPP":default:return i.date({width:"full"})}},e=(s,i)=>{switch(s){case"p":return i.time({width:"short"});case"pp":return i.time({width:"medium"});case"ppp":return i.time({width:"long"});case"pppp":default:return i.time({width:"full"})}},t=(s,i)=>{const a=s.match(/(P+)(p+)?/)||[],o=a[1],l=a[2];if(!l)return n(s,i);let c;switch(o){case"P":c=i.dateTime({width:"short"});break;case"PP":c=i.dateTime({width:"medium"});break;case"PPP":c=i.dateTime({width:"long"});break;case"PPPP":default:c=i.dateTime({width:"full"});break}return c.replace("{{date}}",n(o,i)).replace("{{time}}",e(l,i))};return CC.longFormatters={p:e,P:t},CC}var Yh={},b1;function VT(){if(b1)return Yh;b1=1,Yh.isProtectedDayOfYearToken=s,Yh.isProtectedWeekYearToken=i,Yh.warnOrThrowProtectedError=a;const n=/^D+$/,e=/^Y+$/,t=["D","DD","YY","YYYY"];function s(l){return n.test(l)}function i(l){return e.test(l)}function a(l,c,d){const h=o(l,c,d);if(console.warn(h),t.includes(l))throw new RangeError(h)}function o(l,c,d){const h=l[0]==="Y"?"years":"days of the month";return`Use \`${l.toLowerCase()}\` instead of \`${l}\` (in \`${c}\`) for formatting ${h} to the input \`${d}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}return Yh}var y1;function _T(){return y1||(y1=1,(function(n){n.format=n.formatDate=p,Object.defineProperty(n,"formatters",{enumerable:!0,get:function(){return s.formatters}}),Object.defineProperty(n,"longFormatters",{enumerable:!0,get:function(){return i.longFormatters}});var e=sh(),t=_r(),s=_ne(),i=WT(),a=VT(),o=Id(),l=Je();const c=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,d=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,h=/^'([^]*?)'?$/,m=/''/g,f=/[a-zA-Z]/;function p(x,v,S){const B=(0,t.getDefaultOptions)(),V=S?.locale??B.locale??e.defaultLocale,R=S?.firstWeekContainsDate??S?.locale?.options?.firstWeekContainsDate??B.firstWeekContainsDate??B.locale?.options?.firstWeekContainsDate??1,W=S?.weekStartsOn??S?.locale?.options?.weekStartsOn??B.weekStartsOn??B.locale?.options?.weekStartsOn??0,_=(0,l.toDate)(x);if(!(0,o.isValid)(_))throw new RangeError("Invalid time value");let Y=v.match(d).map(M=>{const H=M[0];if(H==="p"||H==="P"){const D=i.longFormatters[H];return D(M,V.formatLong)}return M}).join("").match(c).map(M=>{if(M==="''")return{isToken:!1,value:"'"};const H=M[0];if(H==="'")return{isToken:!1,value:b(M)};if(s.formatters[H])return{isToken:!0,value:M};if(H.match(f))throw new RangeError("Format string contains an unescaped latin alphabet character `"+H+"`");return{isToken:!1,value:M}});V.localize.preprocessor&&(Y=V.localize.preprocessor(_,Y));const j={firstWeekContainsDate:R,weekStartsOn:W,locale:V};return Y.map(M=>{if(!M.isToken)return M.value;const H=M.value;(!S?.useAdditionalWeekYearTokens&&(0,a.isProtectedWeekYearToken)(H)||!S?.useAdditionalDayOfYearTokens&&(0,a.isProtectedDayOfYearToken)(H))&&(0,a.warnOrThrowProtectedError)(H,v,String(x));const D=s.formatters[H[0]];return D(_,H,V.localize,j)}).join("")}function b(x){const v=x.match(h);return v?v[1].replace(m,"'"):x}})(D0)),D0}var nv={},v1;function jT(){if(v1)return nv;v1=1,nv.formatDistance=c;var n=nh(),e=qt(),t=jp(),s=Xp(),i=Je(),a=sh(),o=_r(),l=hd();function c(d,h,m){const f=(0,o.getDefaultOptions)(),p=m?.locale??f.locale??a.defaultLocale,b=2520,x=(0,n.compareAsc)(d,h);if(isNaN(x))throw new RangeError("Invalid time value");const v=Object.assign({},m,{addSuffix:m?.addSuffix,comparison:x});let S,B;x>0?(S=(0,i.toDate)(h),B=(0,i.toDate)(d)):(S=(0,i.toDate)(d),B=(0,i.toDate)(h));const V=(0,s.differenceInSeconds)(B,S),R=((0,l.getTimezoneOffsetInMilliseconds)(B)-(0,l.getTimezoneOffsetInMilliseconds)(S))/1e3,W=Math.round((V-R)/60);let _;if(W<2)return m?.includeSeconds?V<5?p.formatDistance("lessThanXSeconds",5,v):V<10?p.formatDistance("lessThanXSeconds",10,v):V<20?p.formatDistance("lessThanXSeconds",20,v):V<40?p.formatDistance("halfAMinute",0,v):V<60?p.formatDistance("lessThanXMinutes",1,v):p.formatDistance("xMinutes",1,v):W===0?p.formatDistance("lessThanXMinutes",1,v):p.formatDistance("xMinutes",W,v);if(W<45)return p.formatDistance("xMinutes",W,v);if(W<90)return p.formatDistance("aboutXHours",1,v);if(W<e.minutesInDay){const Y=Math.round(W/60);return p.formatDistance("aboutXHours",Y,v)}else{if(W<b)return p.formatDistance("xDays",1,v);if(W<e.minutesInMonth){const Y=Math.round(W/e.minutesInDay);return p.formatDistance("xDays",Y,v)}else if(W<e.minutesInMonth*2)return _=Math.round(W/e.minutesInMonth),p.formatDistance("aboutXMonths",_,v)}if(_=(0,t.differenceInMonths)(B,S),_<12){const Y=Math.round(W/e.minutesInMonth);return p.formatDistance("xMonths",Y,v)}else{const Y=_%12,j=Math.trunc(_/12);return Y<3?p.formatDistance("aboutXYears",j,v):Y<9?p.formatDistance("overXYears",j,v):p.formatDistance("almostXYears",j+1,v)}}return nv}var sv={},x1;function XT(){if(x1)return sv;x1=1,sv.formatDistanceStrict=l;var n=sh(),e=_r(),t=Cd(),s=hd(),i=nh(),a=qt(),o=Je();function l(c,d,h){const m=(0,e.getDefaultOptions)(),f=h?.locale??m.locale??n.defaultLocale,p=(0,i.compareAsc)(c,d);if(isNaN(p))throw new RangeError("Invalid time value");const b=Object.assign({},h,{addSuffix:h?.addSuffix,comparison:p});let x,v;p>0?(x=(0,o.toDate)(d),v=(0,o.toDate)(c)):(x=(0,o.toDate)(c),v=(0,o.toDate)(d));const S=(0,t.getRoundingMethod)(h?.roundingMethod??"round"),B=v.getTime()-x.getTime(),V=B/a.millisecondsInMinute,R=(0,s.getTimezoneOffsetInMilliseconds)(v)-(0,s.getTimezoneOffsetInMilliseconds)(x),W=(B-R)/a.millisecondsInMinute,_=h?.unit;let Y;if(_?Y=_:V<1?Y="second":V<60?Y="minute":V<a.minutesInDay?Y="hour":W<a.minutesInMonth?Y="day":W<a.minutesInYear?Y="month":Y="year",Y==="second"){const j=S(B/1e3);return f.formatDistance("xSeconds",j,b)}else if(Y==="minute"){const j=S(V);return f.formatDistance("xMinutes",j,b)}else if(Y==="hour"){const j=S(V/60);return f.formatDistance("xHours",j,b)}else if(Y==="day"){const j=S(W/a.minutesInDay);return f.formatDistance("xDays",j,b)}else if(Y==="month"){const j=S(W/a.minutesInMonth);return j===12&&_!=="month"?f.formatDistance("xYears",1,b):f.formatDistance("xMonths",j,b)}else{const j=S(W/a.minutesInYear);return f.formatDistance("xYears",j,b)}}return sv}var rv={},S1;function jne(){if(S1)return rv;S1=1,rv.formatDistanceToNow=t;var n=ii(),e=jT();function t(s,i){return(0,e.formatDistance)(s,(0,n.constructNow)(s),i)}return rv}var iv={},w1;function Xne(){if(w1)return iv;w1=1,iv.formatDistanceToNowStrict=t;var n=XT(),e=ii();function t(s,i){return(0,n.formatDistanceStrict)(s,(0,e.constructNow)(s),i)}return iv}var av={},Z1;function Jne(){if(Z1)return av;Z1=1,av.formatDuration=s;var n=sh(),e=_r();const t=["years","months","weeks","days","hours","minutes","seconds"];function s(i,a){const o=(0,e.getDefaultOptions)(),l=a?.locale??o.locale??n.defaultLocale,c=a?.format??t,d=a?.zero??!1,h=a?.delimiter??" ";return l.formatDistance?c.reduce((f,p)=>{const b=`x${p.replace(/(^.)/,v=>v.toUpperCase())}`,x=i[p];return x!==void 0&&(d||i[p])?f.concat(l.formatDistance(b,x)):f},[]).join(h):""}return av}var ov={},G1;function Yne(){if(G1)return ov;G1=1,ov.formatISO=t;var n=Je(),e=rh();function t(s,i){const a=(0,n.toDate)(s);if(isNaN(a.getTime()))throw new RangeError("Invalid time value");const o=i?.format??"extended",l=i?.representation??"complete";let c="",d="";const h=o==="extended"?"-":"",m=o==="extended"?":":"";if(l!=="time"){const f=(0,e.addLeadingZeros)(a.getDate(),2),p=(0,e.addLeadingZeros)(a.getMonth()+1,2);c=`${(0,e.addLeadingZeros)(a.getFullYear(),4)}${h}${p}${h}${f}`}if(l!=="date"){const f=a.getTimezoneOffset();if(f!==0){const B=Math.abs(f),V=(0,e.addLeadingZeros)(Math.trunc(B/60),2),R=(0,e.addLeadingZeros)(B%60,2);d=`${f<0?"+":"-"}${V}:${R}`}else d="Z";const p=(0,e.addLeadingZeros)(a.getHours(),2),b=(0,e.addLeadingZeros)(a.getMinutes(),2),x=(0,e.addLeadingZeros)(a.getSeconds(),2),v=c===""?"":"T",S=[p,b,x].join(m);c=`${c}${v}${S}${d}`}return c}return ov}var lv={},B1;function Fne(){if(B1)return lv;B1=1,lv.formatISO9075=s;var n=Id(),e=Je(),t=rh();function s(i,a){const o=(0,e.toDate)(i);if(!(0,n.isValid)(o))throw new RangeError("Invalid time value");const l=a?.format??"extended",c=a?.representation??"complete";let d="";const h=l==="extended"?"-":"",m=l==="extended"?":":"";if(c!=="time"){const f=(0,t.addLeadingZeros)(o.getDate(),2),p=(0,t.addLeadingZeros)(o.getMonth()+1,2);d=`${(0,t.addLeadingZeros)(o.getFullYear(),4)}${h}${p}${h}${f}`}if(c!=="date"){const f=(0,t.addLeadingZeros)(o.getHours(),2),p=(0,t.addLeadingZeros)(o.getMinutes(),2),b=(0,t.addLeadingZeros)(o.getSeconds(),2);d=`${d}${d===""?"":" "}${f}${m}${p}${m}${b}`}return d}return lv}var cv={},N1;function Mne(){if(N1)return cv;N1=1,cv.formatISODuration=n;function n(e){const{years:t=0,months:s=0,days:i=0,hours:a=0,minutes:o=0,seconds:l=0}=e;return`P${t}Y${s}M${i}DT${a}H${o}M${l}S`}return cv}var dv={},k1;function Hne(){if(k1)return dv;k1=1,dv.formatRFC3339=s;var n=Id(),e=Je(),t=rh();function s(i,a){const o=(0,e.toDate)(i);if(!(0,n.isValid)(o))throw new RangeError("Invalid time value");const l=a?.fractionDigits??0,c=(0,t.addLeadingZeros)(o.getDate(),2),d=(0,t.addLeadingZeros)(o.getMonth()+1,2),h=o.getFullYear(),m=(0,t.addLeadingZeros)(o.getHours(),2),f=(0,t.addLeadingZeros)(o.getMinutes(),2),p=(0,t.addLeadingZeros)(o.getSeconds(),2);let b="";if(l>0){const S=o.getMilliseconds(),B=Math.trunc(S*Math.pow(10,l-3));b="."+(0,t.addLeadingZeros)(B,l)}let x="";const v=o.getTimezoneOffset();if(v!==0){const S=Math.abs(v),B=(0,t.addLeadingZeros)(Math.trunc(S/60),2),V=(0,t.addLeadingZeros)(S%60,2);x=`${v<0?"+":"-"}${B}:${V}`}else x="Z";return`${h}-${d}-${c}T${m}:${f}:${p}${b}${x}`}return dv}var gv={},R1;function Tne(){if(R1)return gv;R1=1,gv.formatRFC7231=a;var n=Id(),e=Je(),t=rh();const s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function a(o){const l=(0,e.toDate)(o);if(!(0,n.isValid)(l))throw new RangeError("Invalid time value");const c=s[l.getUTCDay()],d=(0,t.addLeadingZeros)(l.getUTCDate(),2),h=i[l.getUTCMonth()],m=l.getUTCFullYear(),f=(0,t.addLeadingZeros)(l.getUTCHours(),2),p=(0,t.addLeadingZeros)(l.getUTCMinutes(),2),b=(0,t.addLeadingZeros)(l.getUTCSeconds(),2);return`${c}, ${d} ${h} ${m} ${f}:${p}:${b} GMT`}return gv}var uv={},W1;function Ene(){if(W1)return uv;W1=1,uv.formatRelative=a;var n=md(),e=_T(),t=Je(),s=sh(),i=_r();function a(o,l,c){const d=(0,t.toDate)(o),h=(0,t.toDate)(l),m=(0,i.getDefaultOptions)(),f=c?.locale??m.locale??s.defaultLocale,p=c?.weekStartsOn??c?.locale?.options?.weekStartsOn??m.weekStartsOn??m.locale?.options?.weekStartsOn??0,b=(0,n.differenceInCalendarDays)(d,h);if(isNaN(b))throw new RangeError("Invalid time value");let x;b<-6?x="other":b<-1?x="lastWeek":b<0?x="yesterday":b<1?x="today":b<2?x="tomorrow":b<7?x="nextWeek":x="other";const v=f.formatRelative(x,d,h,{locale:f,weekStartsOn:p});return(0,e.format)(d,v,{locale:f,weekStartsOn:p})}return uv}var hv={},V1;function Dne(){if(V1)return hv;V1=1,hv.fromUnixTime=e;var n=Je();function e(t){return(0,n.toDate)(t*1e3)}return hv}var mv={},_1;function JT(){if(_1)return mv;_1=1,mv.getDate=e;var n=Je();function e(t){return(0,n.toDate)(t).getDate()}return mv}var Iv={},j1;function Fp(){if(j1)return Iv;j1=1,Iv.getDay=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()}return Iv}var Cv={},X1;function YT(){if(X1)return Cv;X1=1,Cv.getDaysInMonth=t;var n=Je(),e=Cn();function t(s){const i=(0,n.toDate)(s),a=i.getFullYear(),o=i.getMonth(),l=(0,e.constructFrom)(s,0);return l.setFullYear(a,o+1,0),l.setHours(0,0,0,0),l.getDate()}return Cv}var fv={},pv={},J1;function FT(){if(J1)return pv;J1=1,pv.isLeapYear=e;var n=Je();function e(t){const i=(0,n.toDate)(t).getFullYear();return i%400===0||i%4===0&&i%100!==0}return pv}var Y1;function Lne(){if(Y1)return fv;Y1=1,fv.getDaysInYear=t;var n=FT(),e=Je();function t(s){const i=(0,e.toDate)(s);return String(new Date(i))==="Invalid Date"?NaN:(0,n.isLeapYear)(i)?366:365}return fv}var Av={},F1;function Pne(){if(F1)return Av;F1=1,Av.getDecade=e;var n=Je();function e(t){const i=(0,n.toDate)(t).getFullYear();return Math.floor(i/10)*10}return Av}var bv={},M1;function MT(){if(M1)return bv;M1=1,bv.getDefaultOptions=e;var n=_r();function e(){return Object.assign({},(0,n.getDefaultOptions)())}return bv}var yv={},H1;function Kne(){if(H1)return yv;H1=1,yv.getHours=e;var n=Je();function e(t){return(0,n.toDate)(t).getHours()}return yv}var vv={},T1;function HT(){if(T1)return vv;T1=1,vv.getISODay=e;var n=Je();function e(t){let i=(0,n.toDate)(t).getDay();return i===0&&(i=7),i}return vv}var xv={},E1;function One(){if(E1)return xv;E1=1,xv.getISOWeeksInYear=s;var n=Vp(),e=qt(),t=zm();function s(i){const a=(0,t.startOfISOWeekYear)(i),l=+(0,t.startOfISOWeekYear)((0,n.addWeeks)(a,60))-+a;return Math.round(l/e.millisecondsInWeek)}return xv}var Sv={},D1;function zne(){if(D1)return Sv;D1=1,Sv.getMilliseconds=e;var n=Je();function e(t){return(0,n.toDate)(t).getMilliseconds()}return Sv}var wv={},L1;function Une(){if(L1)return wv;L1=1,wv.getMinutes=e;var n=Je();function e(t){return(0,n.toDate)(t).getMinutes()}return wv}var Zv={},P1;function Qne(){if(P1)return Zv;P1=1,Zv.getMonth=e;var n=Je();function e(t){return(0,n.toDate)(t).getMonth()}return Zv}var Gv={},K1;function qne(){if(K1)return Gv;K1=1,Gv.getOverlappingDaysInIntervals=s;var n=hd(),e=qt(),t=Je();function s(i,a){const[o,l]=[+(0,t.toDate)(i.start),+(0,t.toDate)(i.end)].sort((x,v)=>x-v),[c,d]=[+(0,t.toDate)(a.start),+(0,t.toDate)(a.end)].sort((x,v)=>x-v);if(!(o<d&&c<l))return 0;const m=c<o?o:c,f=m-(0,n.getTimezoneOffsetInMilliseconds)(m),p=d>l?l:d,b=p-(0,n.getTimezoneOffsetInMilliseconds)(p);return Math.ceil((b-f)/e.millisecondsInDay)}return Gv}var Bv={},O1;function $ne(){if(O1)return Bv;O1=1,Bv.getSeconds=e;var n=Je();function e(t){return(0,n.toDate)(t).getSeconds()}return Bv}var Nv={},z1;function ese(){if(z1)return Nv;z1=1,Nv.getTime=e;var n=Je();function e(t){return(0,n.toDate)(t).getTime()}return Nv}var kv={},U1;function tse(){if(U1)return kv;U1=1,kv.getUnixTime=e;var n=Je();function e(t){return Math.trunc(+(0,n.toDate)(t)/1e3)}return kv}var Rv={},Q1;function nse(){if(Q1)return Rv;Q1=1,Rv.getWeekOfMonth=i;var n=JT(),e=Fp(),t=Jp(),s=_r();function i(a,o){const l=(0,s.getDefaultOptions)(),c=o?.weekStartsOn??o?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,d=(0,n.getDate)(a);if(isNaN(d))return NaN;const h=(0,e.getDay)((0,t.startOfMonth)(a));let m=c-h;m<=0&&(m+=7);const f=d-m;return Math.ceil(f/7)+1}return Rv}var Wv={},Vv={},q1;function TT(){if(q1)return Vv;q1=1,Vv.lastDayOfMonth=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getMonth();return s.setFullYear(s.getFullYear(),i+1,0),s.setHours(0,0,0,0),s}return Vv}var $1;function sse(){if($1)return Wv;$1=1,Wv.getWeeksInMonth=s;var n=VG(),e=TT(),t=Jp();function s(i,a){return(0,n.differenceInCalendarWeeks)((0,e.lastDayOfMonth)(i),(0,t.startOfMonth)(i),a)+1}return Wv}var _v={},e_;function rse(){if(e_)return _v;e_=1,_v.getYear=e;var n=Je();function e(t){return(0,n.toDate)(t).getFullYear()}return _v}var jv={},t_;function ise(){if(t_)return jv;t_=1,jv.hoursToMilliseconds=e;var n=qt();function e(t){return Math.trunc(t*n.millisecondsInHour)}return jv}var Xv={},n_;function ase(){if(n_)return Xv;n_=1,Xv.hoursToMinutes=e;var n=qt();function e(t){return Math.trunc(t*n.minutesInHour)}return Xv}var Jv={},s_;function ose(){if(s_)return Jv;s_=1,Jv.hoursToSeconds=e;var n=qt();function e(t){return Math.trunc(t*n.secondsInHour)}return Jv}var Yv={},r_;function lse(){if(r_)return Yv;r_=1,Yv.interval=e;var n=Je();function e(t,s,i){const a=(0,n.toDate)(t);if(isNaN(+a))throw new TypeError("Start date is invalid");const o=(0,n.toDate)(s);if(isNaN(+o))throw new TypeError("End date is invalid");if(i?.assertPositive&&+a>+o)throw new TypeError("End date must be after start date");return{start:a,end:o}}return Yv}var Fv={},i_;function cse(){if(i_)return Fv;i_=1,Fv.intervalToDuration=c;var n=cT(),e=jG(),t=XG(),s=JG(),i=jp(),a=Xp(),o=wT(),l=Je();function c(d){const h=(0,l.toDate)(d.start),m=(0,l.toDate)(d.end),f={},p=(0,o.differenceInYears)(m,h);p&&(f.years=p);const b=(0,n.add)(h,{years:f.years}),x=(0,i.differenceInMonths)(m,b);x&&(f.months=x);const v=(0,n.add)(b,{months:f.months}),S=(0,e.differenceInDays)(m,v);S&&(f.days=S);const B=(0,n.add)(v,{days:f.days}),V=(0,t.differenceInHours)(m,B);V&&(f.hours=V);const R=(0,n.add)(B,{hours:f.hours}),W=(0,s.differenceInMinutes)(m,R);W&&(f.minutes=W);const _=(0,n.add)(R,{minutes:f.minutes}),Y=(0,a.differenceInSeconds)(m,_);return Y&&(f.seconds=Y),f}return Fv}var Mv={},a_;function dse(){if(a_)return Mv;a_=1,Mv.intlFormat=e;var n=Je();function e(s,i,a){let o;return t(i)?o=i:a=i,new Intl.DateTimeFormat(a?.locale,o).format((0,n.toDate)(s))}function t(s){return s!==void 0&&!("locale"in s)}return Mv}var Hv={},o_;function gse(){if(o_)return Hv;o_=1,Hv.intlFormatDistance=h;var n=qt(),e=md(),t=WG(),s=vT(),i=VG(),a=_G(),o=XG(),l=JG(),c=Xp(),d=Je();function h(m,f,p){let b=0,x;const v=(0,d.toDate)(m),S=(0,d.toDate)(f);if(p?.unit)x=p?.unit,x==="second"?b=(0,c.differenceInSeconds)(v,S):x==="minute"?b=(0,l.differenceInMinutes)(v,S):x==="hour"?b=(0,o.differenceInHours)(v,S):x==="day"?b=(0,e.differenceInCalendarDays)(v,S):x==="week"?b=(0,i.differenceInCalendarWeeks)(v,S):x==="month"?b=(0,t.differenceInCalendarMonths)(v,S):x==="quarter"?b=(0,s.differenceInCalendarQuarters)(v,S):x==="year"&&(b=(0,a.differenceInCalendarYears)(v,S));else{const V=(0,c.differenceInSeconds)(v,S);Math.abs(V)<n.secondsInMinute?(b=(0,c.differenceInSeconds)(v,S),x="second"):Math.abs(V)<n.secondsInHour?(b=(0,l.differenceInMinutes)(v,S),x="minute"):Math.abs(V)<n.secondsInDay&&Math.abs((0,e.differenceInCalendarDays)(v,S))<1?(b=(0,o.differenceInHours)(v,S),x="hour"):Math.abs(V)<n.secondsInWeek&&(b=(0,e.differenceInCalendarDays)(v,S))&&Math.abs(b)<7?x="day":Math.abs(V)<n.secondsInMonth?(b=(0,i.differenceInCalendarWeeks)(v,S),x="week"):Math.abs(V)<n.secondsInQuarter?(b=(0,t.differenceInCalendarMonths)(v,S),x="month"):Math.abs(V)<n.secondsInYear&&(0,s.differenceInCalendarQuarters)(v,S)<4?(b=(0,s.differenceInCalendarQuarters)(v,S),x="quarter"):(b=(0,a.differenceInCalendarYears)(v,S),x="year")}return new Intl.RelativeTimeFormat(p?.locale,{localeMatcher:p?.localeMatcher,numeric:p?.numeric||"auto",style:p?.style}).format(b,x)}return Hv}var Tv={},l_;function use(){if(l_)return Tv;l_=1,Tv.isAfter=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return i.getTime()>a.getTime()}return Tv}var Ev={},c_;function hse(){if(c_)return Ev;c_=1,Ev.isBefore=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return+i<+a}return Ev}var Dv={},d_;function mse(){if(d_)return Dv;d_=1,Dv.isEqual=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return+i==+a}return Dv}var Lv={},g_;function Ise(){if(g_)return Lv;g_=1,Lv.isExists=n;function n(e,t,s){const i=new Date(e,t,s);return i.getFullYear()===e&&i.getMonth()===t&&i.getDate()===s}return Lv}var Pv={},u_;function Cse(){if(u_)return Pv;u_=1,Pv.isFirstDayOfMonth=e;var n=Je();function e(t){return(0,n.toDate)(t).getDate()===1}return Pv}var Kv={},h_;function fse(){if(h_)return Kv;h_=1,Kv.isFriday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===5}return Kv}var Ov={},m_;function pse(){if(m_)return Ov;m_=1,Ov.isFuture=e;var n=Je();function e(t){return+(0,n.toDate)(t)>Date.now()}return Ov}var zv={},Uv={},fC={},pC={},AC={},Xc={},Qv={},I_;function ET(){if(I_)return Qv;I_=1,Qv.transpose=e;var n=Cn();function e(t,s){const i=s instanceof Date?(0,n.constructFrom)(s,0):new s(0);return i.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),i.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),i}return Qv}var C_;function DT(){if(C_)return Xc;C_=1,Xc.ValueSetter=Xc.Setter=Xc.DateToSystemTimezoneSetter=void 0;var n=ET(),e=Cn();const t=10;let s=class{subPriority=0;validate(l,c){return!0}};Xc.Setter=s;class i extends s{constructor(l,c,d,h,m){super(),this.value=l,this.validateValue=c,this.setValue=d,this.priority=h,m&&(this.subPriority=m)}validate(l,c){return this.validateValue(l,this.value,c)}set(l,c,d){return this.setValue(l,c,this.value,d)}}Xc.ValueSetter=i;class a extends s{priority=t;subPriority=-1;set(l,c){return c.timestampIsSet?l:(0,e.constructFrom)(l,(0,n.transpose)(l,Date))}}return Xc.DateToSystemTimezoneSetter=a,Xc}var f_;function yn(){if(f_)return AC;f_=1,AC.Parser=void 0;var n=DT();let e=class{run(s,i,a,o){const l=this.parse(s,i,a,o);return l?{setter:new n.ValueSetter(l.value,this.validate,this.set,this.priority,this.subPriority),rest:l.rest}:null}validate(s,i,a){return!0}};return AC.Parser=e,AC}var p_;function Ase(){if(p_)return pC;p_=1,pC.EraParser=void 0;var n=yn();let e=class extends n.Parser{priority=140;parse(s,i,a){switch(i){case"G":case"GG":case"GGG":return a.era(s,{width:"abbreviated"})||a.era(s,{width:"narrow"});case"GGGGG":return a.era(s,{width:"narrow"});case"GGGG":default:return a.era(s,{width:"wide"})||a.era(s,{width:"abbreviated"})||a.era(s,{width:"narrow"})}}set(s,i,a){return i.era=a,s.setFullYear(a,0,1),s.setHours(0,0,0,0),s}incompatibleTokens=["R","u","t","T"]};return pC.EraParser=e,pC}var bC={},Va={},lu={},A_;function jr(){return A_||(A_=1,lu.timezonePatterns=lu.numericPatterns=void 0,lu.numericPatterns={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},lu.timezonePatterns={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/}),lu}var b_;function kn(){if(b_)return Va;b_=1,Va.dayPeriodEnumToHours=c,Va.isLeapYearIndex=h,Va.mapValue=t,Va.normalizeTwoDigitYear=d,Va.parseAnyDigitsSigned=a,Va.parseNDigits=o,Va.parseNDigitsSigned=l,Va.parseNumericPattern=s,Va.parseTimezonePattern=i;var n=qt(),e=jr();function t(m,f){return m&&{value:f(m.value),rest:m.rest}}function s(m,f){const p=f.match(m);return p?{value:parseInt(p[0],10),rest:f.slice(p[0].length)}:null}function i(m,f){const p=f.match(m);if(!p)return null;if(p[0]==="Z")return{value:0,rest:f.slice(1)};const b=p[1]==="+"?1:-1,x=p[2]?parseInt(p[2],10):0,v=p[3]?parseInt(p[3],10):0,S=p[5]?parseInt(p[5],10):0;return{value:b*(x*n.millisecondsInHour+v*n.millisecondsInMinute+S*n.millisecondsInSecond),rest:f.slice(p[0].length)}}function a(m){return s(e.numericPatterns.anyDigitsSigned,m)}function o(m,f){switch(m){case 1:return s(e.numericPatterns.singleDigit,f);case 2:return s(e.numericPatterns.twoDigits,f);case 3:return s(e.numericPatterns.threeDigits,f);case 4:return s(e.numericPatterns.fourDigits,f);default:return s(new RegExp("^\\d{1,"+m+"}"),f)}}function l(m,f){switch(m){case 1:return s(e.numericPatterns.singleDigitSigned,f);case 2:return s(e.numericPatterns.twoDigitsSigned,f);case 3:return s(e.numericPatterns.threeDigitsSigned,f);case 4:return s(e.numericPatterns.fourDigitsSigned,f);default:return s(new RegExp("^-?\\d{1,"+m+"}"),f)}}function c(m){switch(m){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function d(m,f){const p=f>0,b=p?f:1-f;let x;if(b<=50)x=m||100;else{const v=b+50,S=Math.trunc(v/100)*100,B=m>=v%100;x=m+S-(B?100:0)}return p?x:1-x}function h(m){return m%400===0||m%4===0&&m%100!==0}return Va}var y_;function bse(){if(y_)return bC;y_=1,bC.YearParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(i,a,o){const l=c=>({year:c,isTwoDigitYear:a==="yy"});switch(a){case"y":return(0,e.mapValue)((0,e.parseNDigits)(4,i),l);case"yo":return(0,e.mapValue)(o.ordinalNumber(i,{unit:"year"}),l);default:return(0,e.mapValue)((0,e.parseNDigits)(a.length,i),l)}}validate(i,a){return a.isTwoDigitYear||a.year>0}set(i,a,o){const l=i.getFullYear();if(o.isTwoDigitYear){const d=(0,e.normalizeTwoDigitYear)(o.year,l);return i.setFullYear(d,0,1),i.setHours(0,0,0,0),i}const c=!("era"in a)||a.era===1?o.year:1-o.year;return i.setFullYear(c,0,1),i.setHours(0,0,0,0),i}};return bC.YearParser=t,bC}var yC={},v_;function yse(){if(v_)return yC;v_=1,yC.LocalWeekYearParser=void 0;var n=Yp(),e=Jo(),t=yn(),s=kn();let i=class extends t.Parser{priority=130;parse(o,l,c){const d=h=>({year:h,isTwoDigitYear:l==="YY"});switch(l){case"Y":return(0,s.mapValue)((0,s.parseNDigits)(4,o),d);case"Yo":return(0,s.mapValue)(c.ordinalNumber(o,{unit:"year"}),d);default:return(0,s.mapValue)((0,s.parseNDigits)(l.length,o),d)}}validate(o,l){return l.isTwoDigitYear||l.year>0}set(o,l,c,d){const h=(0,n.getWeekYear)(o,d);if(c.isTwoDigitYear){const f=(0,s.normalizeTwoDigitYear)(c.year,h);return o.setFullYear(f,0,d.firstWeekContainsDate),o.setHours(0,0,0,0),(0,e.startOfWeek)(o,d)}const m=!("era"in l)||l.era===1?c.year:1-c.year;return o.setFullYear(m,0,d.firstWeekContainsDate),o.setHours(0,0,0,0),(0,e.startOfWeek)(o,d)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]};return yC.LocalWeekYearParser=i,yC}var vC={},x_;function vse(){if(x_)return vC;x_=1,vC.ISOWeekYearParser=void 0;var n=Hl(),e=Cn(),t=yn(),s=kn();let i=class extends t.Parser{priority=130;parse(o,l){return l==="R"?(0,s.parseNDigitsSigned)(4,o):(0,s.parseNDigitsSigned)(l.length,o)}set(o,l,c){const d=(0,e.constructFrom)(o,0);return d.setFullYear(c,0,4),d.setHours(0,0,0,0),(0,n.startOfISOWeek)(d)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]};return vC.ISOWeekYearParser=i,vC}var xC={},S_;function xse(){if(S_)return xC;S_=1,xC.ExtendedYearParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=130;parse(i,a){return a==="u"?(0,e.parseNDigitsSigned)(4,i):(0,e.parseNDigitsSigned)(a.length,i)}set(i,a,o){return i.setFullYear(o,0,1),i.setHours(0,0,0,0),i}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]};return xC.ExtendedYearParser=t,xC}var SC={},w_;function Sse(){if(w_)return SC;w_=1,SC.QuarterParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=120;parse(i,a,o){switch(a){case"Q":case"QQ":return(0,e.parseNDigits)(a.length,i);case"Qo":return o.ordinalNumber(i,{unit:"quarter"});case"QQQ":return o.quarter(i,{width:"abbreviated",context:"formatting"})||o.quarter(i,{width:"narrow",context:"formatting"});case"QQQQQ":return o.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return o.quarter(i,{width:"wide",context:"formatting"})||o.quarter(i,{width:"abbreviated",context:"formatting"})||o.quarter(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=1&&a<=4}set(i,a,o){return i.setMonth((o-1)*3,1),i.setHours(0,0,0,0),i}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]};return SC.QuarterParser=t,SC}var wC={},Z_;function wse(){if(Z_)return wC;Z_=1,wC.StandAloneQuarterParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=120;parse(i,a,o){switch(a){case"q":case"qq":return(0,e.parseNDigits)(a.length,i);case"qo":return o.ordinalNumber(i,{unit:"quarter"});case"qqq":return o.quarter(i,{width:"abbreviated",context:"standalone"})||o.quarter(i,{width:"narrow",context:"standalone"});case"qqqqq":return o.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return o.quarter(i,{width:"wide",context:"standalone"})||o.quarter(i,{width:"abbreviated",context:"standalone"})||o.quarter(i,{width:"narrow",context:"standalone"})}}validate(i,a){return a>=1&&a<=4}set(i,a,o){return i.setMonth((o-1)*3,1),i.setHours(0,0,0,0),i}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]};return wC.StandAloneQuarterParser=t,wC}var ZC={},G_;function Zse(){if(G_)return ZC;G_=1,ZC.MonthParser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(a,o,l){const c=d=>d-1;switch(o){case"M":return(0,t.mapValue)((0,t.parseNumericPattern)(n.numericPatterns.month,a),c);case"MM":return(0,t.mapValue)((0,t.parseNDigits)(2,a),c);case"Mo":return(0,t.mapValue)(l.ordinalNumber(a,{unit:"month"}),c);case"MMM":return l.month(a,{width:"abbreviated",context:"formatting"})||l.month(a,{width:"narrow",context:"formatting"});case"MMMMM":return l.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return l.month(a,{width:"wide",context:"formatting"})||l.month(a,{width:"abbreviated",context:"formatting"})||l.month(a,{width:"narrow",context:"formatting"})}}validate(a,o){return o>=0&&o<=11}set(a,o,l){return a.setMonth(l,1),a.setHours(0,0,0,0),a}};return ZC.MonthParser=s,ZC}var GC={},B_;function Gse(){if(B_)return GC;B_=1,GC.StandAloneMonthParser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=110;parse(a,o,l){const c=d=>d-1;switch(o){case"L":return(0,t.mapValue)((0,t.parseNumericPattern)(n.numericPatterns.month,a),c);case"LL":return(0,t.mapValue)((0,t.parseNDigits)(2,a),c);case"Lo":return(0,t.mapValue)(l.ordinalNumber(a,{unit:"month"}),c);case"LLL":return l.month(a,{width:"abbreviated",context:"standalone"})||l.month(a,{width:"narrow",context:"standalone"});case"LLLLL":return l.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return l.month(a,{width:"wide",context:"standalone"})||l.month(a,{width:"abbreviated",context:"standalone"})||l.month(a,{width:"narrow",context:"standalone"})}}validate(a,o){return o>=0&&o<=11}set(a,o,l){return a.setMonth(l,1),a.setHours(0,0,0,0),a}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]};return GC.StandAloneMonthParser=s,GC}var BC={},qv={},N_;function LT(){if(N_)return qv;N_=1,qv.setWeek=t;var n=PG(),e=Je();function t(s,i,a){const o=(0,e.toDate)(s),l=(0,n.getWeek)(o,a)-i;return o.setDate(o.getDate()-l*7),o}return qv}var k_;function Bse(){if(k_)return BC;k_=1,BC.LocalWeekParser=void 0;var n=LT(),e=Jo(),t=jr(),s=yn(),i=kn();let a=class extends s.Parser{priority=100;parse(l,c,d){switch(c){case"w":return(0,i.parseNumericPattern)(t.numericPatterns.week,l);case"wo":return d.ordinalNumber(l,{unit:"week"});default:return(0,i.parseNDigits)(c.length,l)}}validate(l,c){return c>=1&&c<=53}set(l,c,d,h){return(0,e.startOfWeek)((0,n.setWeek)(l,d,h),h)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]};return BC.LocalWeekParser=a,BC}var NC={},$v={},R_;function PT(){if(R_)return $v;R_=1,$v.setISOWeek=t;var n=DG(),e=Je();function t(s,i){const a=(0,e.toDate)(s),o=(0,n.getISOWeek)(a)-i;return a.setDate(a.getDate()-o*7),a}return $v}var W_;function Nse(){if(W_)return NC;W_=1,NC.ISOWeekParser=void 0;var n=PT(),e=Hl(),t=jr(),s=yn(),i=kn();let a=class extends s.Parser{priority=100;parse(l,c,d){switch(c){case"I":return(0,i.parseNumericPattern)(t.numericPatterns.week,l);case"Io":return d.ordinalNumber(l,{unit:"week"});default:return(0,i.parseNDigits)(c.length,l)}}validate(l,c){return c>=1&&c<=53}set(l,c,d){return(0,e.startOfISOWeek)((0,n.setISOWeek)(l,d))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]};return NC.ISOWeekParser=a,NC}var kC={},V_;function kse(){if(V_)return kC;V_=1,kC.DateParser=void 0;var n=jr(),e=yn(),t=kn();const s=[31,28,31,30,31,30,31,31,30,31,30,31],i=[31,29,31,30,31,30,31,31,30,31,30,31];let a=class extends e.Parser{priority=90;subPriority=1;parse(l,c,d){switch(c){case"d":return(0,t.parseNumericPattern)(n.numericPatterns.date,l);case"do":return d.ordinalNumber(l,{unit:"date"});default:return(0,t.parseNDigits)(c.length,l)}}validate(l,c){const d=l.getFullYear(),h=(0,t.isLeapYearIndex)(d),m=l.getMonth();return h?c>=1&&c<=i[m]:c>=1&&c<=s[m]}set(l,c,d){return l.setDate(d),l.setHours(0,0,0,0),l}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]};return kC.DateParser=a,kC}var RC={},__;function Rse(){if(__)return RC;__=1,RC.DayOfYearParser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=90;subpriority=1;parse(a,o,l){switch(o){case"D":case"DD":return(0,t.parseNumericPattern)(n.numericPatterns.dayOfYear,a);case"Do":return l.ordinalNumber(a,{unit:"date"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){const l=a.getFullYear();return(0,t.isLeapYearIndex)(l)?o>=1&&o<=366:o>=1&&o<=365}set(a,o,l){return a.setMonth(0,l),a.setHours(0,0,0,0),a}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]};return RC.DayOfYearParser=s,RC}var WC={},ex={},j_;function Mp(){if(j_)return ex;j_=1,ex.setDay=s;var n=Ml(),e=Je(),t=_r();function s(i,a,o){const l=(0,t.getDefaultOptions)(),c=o?.weekStartsOn??o?.locale?.options?.weekStartsOn??l.weekStartsOn??l.locale?.options?.weekStartsOn??0,d=(0,e.toDate)(i),h=d.getDay(),f=(a%7+7)%7,p=7-c,b=a<0||a>6?a-(h+p)%7:(f+p)%7-(h+p)%7;return(0,n.addDays)(d,b)}return ex}var X_;function Wse(){if(X_)return WC;X_=1,WC.DayParser=void 0;var n=Mp(),e=yn();let t=class extends e.Parser{priority=90;parse(i,a,o){switch(a){case"E":case"EE":case"EEE":return o.day(i,{width:"abbreviated",context:"formatting"})||o.day(i,{width:"short",context:"formatting"})||o.day(i,{width:"narrow",context:"formatting"});case"EEEEE":return o.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return o.day(i,{width:"short",context:"formatting"})||o.day(i,{width:"narrow",context:"formatting"});case"EEEE":default:return o.day(i,{width:"wide",context:"formatting"})||o.day(i,{width:"abbreviated",context:"formatting"})||o.day(i,{width:"short",context:"formatting"})||o.day(i,{width:"narrow",context:"formatting"})}}validate(i,a){return a>=0&&a<=6}set(i,a,o,l){return i=(0,n.setDay)(i,o,l),i.setHours(0,0,0,0),i}incompatibleTokens=["D","i","e","c","t","T"]};return WC.DayParser=t,WC}var VC={},J_;function Vse(){if(J_)return VC;J_=1,VC.LocalDayParser=void 0;var n=Mp(),e=yn(),t=kn();let s=class extends e.Parser{priority=90;parse(a,o,l,c){const d=h=>{const m=Math.floor((h-1)/7)*7;return(h+c.weekStartsOn+6)%7+m};switch(o){case"e":case"ee":return(0,t.mapValue)((0,t.parseNDigits)(o.length,a),d);case"eo":return(0,t.mapValue)(l.ordinalNumber(a,{unit:"day"}),d);case"eee":return l.day(a,{width:"abbreviated",context:"formatting"})||l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"});case"eeeee":return l.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"});case"eeee":default:return l.day(a,{width:"wide",context:"formatting"})||l.day(a,{width:"abbreviated",context:"formatting"})||l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"})}}validate(a,o){return o>=0&&o<=6}set(a,o,l,c){return a=(0,n.setDay)(a,l,c),a.setHours(0,0,0,0),a}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]};return VC.LocalDayParser=s,VC}var _C={},Y_;function _se(){if(Y_)return _C;Y_=1,_C.StandAloneLocalDayParser=void 0;var n=Mp(),e=yn(),t=kn();let s=class extends e.Parser{priority=90;parse(a,o,l,c){const d=h=>{const m=Math.floor((h-1)/7)*7;return(h+c.weekStartsOn+6)%7+m};switch(o){case"c":case"cc":return(0,t.mapValue)((0,t.parseNDigits)(o.length,a),d);case"co":return(0,t.mapValue)(l.ordinalNumber(a,{unit:"day"}),d);case"ccc":return l.day(a,{width:"abbreviated",context:"standalone"})||l.day(a,{width:"short",context:"standalone"})||l.day(a,{width:"narrow",context:"standalone"});case"ccccc":return l.day(a,{width:"narrow",context:"standalone"});case"cccccc":return l.day(a,{width:"short",context:"standalone"})||l.day(a,{width:"narrow",context:"standalone"});case"cccc":default:return l.day(a,{width:"wide",context:"standalone"})||l.day(a,{width:"abbreviated",context:"standalone"})||l.day(a,{width:"short",context:"standalone"})||l.day(a,{width:"narrow",context:"standalone"})}}validate(a,o){return o>=0&&o<=6}set(a,o,l,c){return a=(0,n.setDay)(a,l,c),a.setHours(0,0,0,0),a}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]};return _C.StandAloneLocalDayParser=s,_C}var jC={},tx={},F_;function KT(){if(F_)return tx;F_=1,tx.setISODay=s;var n=Ml(),e=HT(),t=Je();function s(i,a){const o=(0,t.toDate)(i),l=(0,e.getISODay)(o),c=a-l;return(0,n.addDays)(o,c)}return tx}var M_;function jse(){if(M_)return jC;M_=1,jC.ISODayParser=void 0;var n=KT(),e=yn(),t=kn();let s=class extends e.Parser{priority=90;parse(a,o,l){const c=d=>d===0?7:d;switch(o){case"i":case"ii":return(0,t.parseNDigits)(o.length,a);case"io":return l.ordinalNumber(a,{unit:"day"});case"iii":return(0,t.mapValue)(l.day(a,{width:"abbreviated",context:"formatting"})||l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"}),c);case"iiiii":return(0,t.mapValue)(l.day(a,{width:"narrow",context:"formatting"}),c);case"iiiiii":return(0,t.mapValue)(l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"}),c);case"iiii":default:return(0,t.mapValue)(l.day(a,{width:"wide",context:"formatting"})||l.day(a,{width:"abbreviated",context:"formatting"})||l.day(a,{width:"short",context:"formatting"})||l.day(a,{width:"narrow",context:"formatting"}),c)}}validate(a,o){return o>=1&&o<=7}set(a,o,l){return a=(0,n.setISODay)(a,l),a.setHours(0,0,0,0),a}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]};return jC.ISODayParser=s,jC}var XC={},H_;function Xse(){if(H_)return XC;H_=1,XC.AMPMParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=80;parse(i,a,o){switch(a){case"a":case"aa":case"aaa":return o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaaa":return o.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return o.dayPeriod(i,{width:"wide",context:"formatting"})||o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,o){return i.setHours((0,e.dayPeriodEnumToHours)(o),0,0,0),i}incompatibleTokens=["b","B","H","k","t","T"]};return XC.AMPMParser=t,XC}var JC={},T_;function Jse(){if(T_)return JC;T_=1,JC.AMPMMidnightParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=80;parse(i,a,o){switch(a){case"b":case"bb":case"bbb":return o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbbb":return o.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return o.dayPeriod(i,{width:"wide",context:"formatting"})||o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,o){return i.setHours((0,e.dayPeriodEnumToHours)(o),0,0,0),i}incompatibleTokens=["a","B","H","k","t","T"]};return JC.AMPMMidnightParser=t,JC}var YC={},E_;function Yse(){if(E_)return YC;E_=1,YC.DayPeriodParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=80;parse(i,a,o){switch(a){case"B":case"BB":case"BBB":return o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBBB":return o.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return o.dayPeriod(i,{width:"wide",context:"formatting"})||o.dayPeriod(i,{width:"abbreviated",context:"formatting"})||o.dayPeriod(i,{width:"narrow",context:"formatting"})}}set(i,a,o){return i.setHours((0,e.dayPeriodEnumToHours)(o),0,0,0),i}incompatibleTokens=["a","b","t","T"]};return YC.DayPeriodParser=t,YC}var FC={},D_;function Fse(){if(D_)return FC;D_=1,FC.Hour1to12Parser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=70;parse(a,o,l){switch(o){case"h":return(0,t.parseNumericPattern)(n.numericPatterns.hour12h,a);case"ho":return l.ordinalNumber(a,{unit:"hour"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=1&&o<=12}set(a,o,l){const c=a.getHours()>=12;return c&&l<12?a.setHours(l+12,0,0,0):!c&&l===12?a.setHours(0,0,0,0):a.setHours(l,0,0,0),a}incompatibleTokens=["H","K","k","t","T"]};return FC.Hour1to12Parser=s,FC}var MC={},L_;function Mse(){if(L_)return MC;L_=1,MC.Hour0to23Parser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=70;parse(a,o,l){switch(o){case"H":return(0,t.parseNumericPattern)(n.numericPatterns.hour23h,a);case"Ho":return l.ordinalNumber(a,{unit:"hour"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=0&&o<=23}set(a,o,l){return a.setHours(l,0,0,0),a}incompatibleTokens=["a","b","h","K","k","t","T"]};return MC.Hour0to23Parser=s,MC}var HC={},P_;function Hse(){if(P_)return HC;P_=1,HC.Hour0To11Parser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=70;parse(a,o,l){switch(o){case"K":return(0,t.parseNumericPattern)(n.numericPatterns.hour11h,a);case"Ko":return l.ordinalNumber(a,{unit:"hour"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=0&&o<=11}set(a,o,l){return a.getHours()>=12&&l<12?a.setHours(l+12,0,0,0):a.setHours(l,0,0,0),a}incompatibleTokens=["h","H","k","t","T"]};return HC.Hour0To11Parser=s,HC}var TC={},K_;function Tse(){if(K_)return TC;K_=1,TC.Hour1To24Parser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=70;parse(a,o,l){switch(o){case"k":return(0,t.parseNumericPattern)(n.numericPatterns.hour24h,a);case"ko":return l.ordinalNumber(a,{unit:"hour"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=1&&o<=24}set(a,o,l){const c=l<=24?l%24:l;return a.setHours(c,0,0,0),a}incompatibleTokens=["a","b","h","H","K","t","T"]};return TC.Hour1To24Parser=s,TC}var EC={},O_;function Ese(){if(O_)return EC;O_=1,EC.MinuteParser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=60;parse(a,o,l){switch(o){case"m":return(0,t.parseNumericPattern)(n.numericPatterns.minute,a);case"mo":return l.ordinalNumber(a,{unit:"minute"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=0&&o<=59}set(a,o,l){return a.setMinutes(l,0,0),a}incompatibleTokens=["t","T"]};return EC.MinuteParser=s,EC}var DC={},z_;function Dse(){if(z_)return DC;z_=1,DC.SecondParser=void 0;var n=jr(),e=yn(),t=kn();let s=class extends e.Parser{priority=50;parse(a,o,l){switch(o){case"s":return(0,t.parseNumericPattern)(n.numericPatterns.second,a);case"so":return l.ordinalNumber(a,{unit:"second"});default:return(0,t.parseNDigits)(o.length,a)}}validate(a,o){return o>=0&&o<=59}set(a,o,l){return a.setSeconds(l,0),a}incompatibleTokens=["t","T"]};return DC.SecondParser=s,DC}var LC={},U_;function Lse(){if(U_)return LC;U_=1,LC.FractionOfSecondParser=void 0;var n=yn(),e=kn();let t=class extends n.Parser{priority=30;parse(i,a){const o=l=>Math.trunc(l*Math.pow(10,-a.length+3));return(0,e.mapValue)((0,e.parseNDigits)(a.length,i),o)}set(i,a,o){return i.setMilliseconds(o),i}incompatibleTokens=["t","T"]};return LC.FractionOfSecondParser=t,LC}var PC={},Q_;function Pse(){if(Q_)return PC;Q_=1,PC.ISOTimezoneWithZParser=void 0;var n=Cn(),e=hd(),t=jr(),s=yn(),i=kn();let a=class extends s.Parser{priority=10;parse(l,c){switch(c){case"X":return(0,i.parseTimezonePattern)(t.timezonePatterns.basicOptionalMinutes,l);case"XX":return(0,i.parseTimezonePattern)(t.timezonePatterns.basic,l);case"XXXX":return(0,i.parseTimezonePattern)(t.timezonePatterns.basicOptionalSeconds,l);case"XXXXX":return(0,i.parseTimezonePattern)(t.timezonePatterns.extendedOptionalSeconds,l);case"XXX":default:return(0,i.parseTimezonePattern)(t.timezonePatterns.extended,l)}}set(l,c,d){return c.timestampIsSet?l:(0,n.constructFrom)(l,l.getTime()-(0,e.getTimezoneOffsetInMilliseconds)(l)-d)}incompatibleTokens=["t","T","x"]};return PC.ISOTimezoneWithZParser=a,PC}var KC={},q_;function Kse(){if(q_)return KC;q_=1,KC.ISOTimezoneParser=void 0;var n=Cn(),e=hd(),t=jr(),s=yn(),i=kn();let a=class extends s.Parser{priority=10;parse(l,c){switch(c){case"x":return(0,i.parseTimezonePattern)(t.timezonePatterns.basicOptionalMinutes,l);case"xx":return(0,i.parseTimezonePattern)(t.timezonePatterns.basic,l);case"xxxx":return(0,i.parseTimezonePattern)(t.timezonePatterns.basicOptionalSeconds,l);case"xxxxx":return(0,i.parseTimezonePattern)(t.timezonePatterns.extendedOptionalSeconds,l);case"xxx":default:return(0,i.parseTimezonePattern)(t.timezonePatterns.extended,l)}}set(l,c,d){return c.timestampIsSet?l:(0,n.constructFrom)(l,l.getTime()-(0,e.getTimezoneOffsetInMilliseconds)(l)-d)}incompatibleTokens=["t","T","X"]};return KC.ISOTimezoneParser=a,KC}var OC={},$_;function Ose(){if($_)return OC;$_=1,OC.TimestampSecondsParser=void 0;var n=Cn(),e=yn(),t=kn();let s=class extends e.Parser{priority=40;parse(a){return(0,t.parseAnyDigitsSigned)(a)}set(a,o,l){return[(0,n.constructFrom)(a,l*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"};return OC.TimestampSecondsParser=s,OC}var zC={},ej;function zse(){if(ej)return zC;ej=1,zC.TimestampMillisecondsParser=void 0;var n=Cn(),e=yn(),t=kn();let s=class extends e.Parser{priority=20;parse(a){return(0,t.parseAnyDigitsSigned)(a)}set(a,o,l){return[(0,n.constructFrom)(a,l),{timestampIsSet:!0}]}incompatibleTokens="*"};return zC.TimestampMillisecondsParser=s,zC}var tj;function Use(){if(tj)return fC;tj=1,fC.parsers=void 0;var n=Ase(),e=bse(),t=yse(),s=vse(),i=xse(),a=Sse(),o=wse(),l=Zse(),c=Gse(),d=Bse(),h=Nse(),m=kse(),f=Rse(),p=Wse(),b=Vse(),x=_se(),v=jse(),S=Xse(),B=Jse(),V=Yse(),R=Fse(),W=Mse(),_=Hse(),Y=Tse(),j=Ese(),M=Dse(),H=Lse(),D=Pse(),z=Kse(),O=Ose(),E=zse();return fC.parsers={G:new n.EraParser,y:new e.YearParser,Y:new t.LocalWeekYearParser,R:new s.ISOWeekYearParser,u:new i.ExtendedYearParser,Q:new a.QuarterParser,q:new o.StandAloneQuarterParser,M:new l.MonthParser,L:new c.StandAloneMonthParser,w:new d.LocalWeekParser,I:new h.ISOWeekParser,d:new m.DateParser,D:new f.DayOfYearParser,E:new p.DayParser,e:new b.LocalDayParser,c:new x.StandAloneLocalDayParser,i:new v.ISODayParser,a:new S.AMPMParser,b:new B.AMPMMidnightParser,B:new V.DayPeriodParser,h:new R.Hour1to12Parser,H:new W.Hour0to23Parser,K:new _.Hour0To11Parser,k:new Y.Hour1To24Parser,m:new j.MinuteParser,s:new M.SecondParser,S:new H.FractionOfSecondParser,X:new D.ISOTimezoneWithZParser,x:new z.ISOTimezoneParser,t:new O.TimestampSecondsParser,T:new E.TimestampMillisecondsParser},fC}var nj;function OT(){return nj||(nj=1,(function(n){Object.defineProperty(n,"longFormatters",{enumerable:!0,get:function(){return a.longFormatters}}),n.parse=x,Object.defineProperty(n,"parsers",{enumerable:!0,get:function(){return l.parsers}});var e=Cn(),t=MT(),s=sh(),i=Je(),a=WT(),o=VT(),l=Use(),c=DT();const d=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,h=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,m=/^'([^]*?)'?$/,f=/''/g,p=/\S/,b=/[a-zA-Z]/;function x(S,B,V,R){const W=(0,t.getDefaultOptions)(),_=R?.locale??W.locale??s.defaultLocale,Y=R?.firstWeekContainsDate??R?.locale?.options?.firstWeekContainsDate??W.firstWeekContainsDate??W.locale?.options?.firstWeekContainsDate??1,j=R?.weekStartsOn??R?.locale?.options?.weekStartsOn??W.weekStartsOn??W.locale?.options?.weekStartsOn??0;if(B==="")return S===""?(0,i.toDate)(V):(0,e.constructFrom)(V,NaN);const M={firstWeekContainsDate:Y,weekStartsOn:j,locale:_},H=[new c.DateToSystemTimezoneSetter],D=B.match(h).map(q=>{const de=q[0];if(de in a.longFormatters){const U=a.longFormatters[de];return U(q,_.formatLong)}return q}).join("").match(d),z=[];for(let q of D){!R?.useAdditionalWeekYearTokens&&(0,o.isProtectedWeekYearToken)(q)&&(0,o.warnOrThrowProtectedError)(q,B,S),!R?.useAdditionalDayOfYearTokens&&(0,o.isProtectedDayOfYearToken)(q)&&(0,o.warnOrThrowProtectedError)(q,B,S);const de=q[0],U=l.parsers[de];if(U){const{incompatibleTokens:P}=U;if(Array.isArray(P)){const K=z.find(re=>P.includes(re.token)||re.token===de);if(K)throw new RangeError(`The format string mustn't contain \`${K.fullToken}\` and \`${q}\` at the same time`)}else if(U.incompatibleTokens==="*"&&z.length>0)throw new RangeError(`The format string mustn't contain \`${q}\` and any other token at the same time`);z.push({token:de,fullToken:q});const ne=U.run(S,q,_.match,M);if(!ne)return(0,e.constructFrom)(V,NaN);H.push(ne.setter),S=ne.rest}else{if(de.match(b))throw new RangeError("Format string contains an unescaped latin alphabet character `"+de+"`");if(q==="''"?q="'":de==="'"&&(q=v(q)),S.indexOf(q)===0)S=S.slice(q.length);else return(0,e.constructFrom)(V,NaN)}}if(S.length>0&&p.test(S))return(0,e.constructFrom)(V,NaN);const O=H.map(q=>q.priority).sort((q,de)=>de-q).filter((q,de,U)=>U.indexOf(q)===de).map(q=>H.filter(de=>de.priority===q).sort((de,U)=>U.subPriority-de.subPriority)).map(q=>q[0]);let E=(0,i.toDate)(V);if(isNaN(E.getTime()))return(0,e.constructFrom)(V,NaN);const te={};for(const q of O){if(!q.validate(E,M))return(0,e.constructFrom)(V,NaN);const de=q.set(E,te,M);Array.isArray(de)?(E=de[0],Object.assign(te,de[1])):E=de}return(0,e.constructFrom)(V,E)}function v(S){return S.match(m)[1].replace(f,"'")}})(Uv)),Uv}var sj;function Qse(){if(sj)return zv;sj=1,zv.isMatch=t;var n=Id(),e=OT();function t(s,i,a){return(0,n.isValid)((0,e.parse)(s,i,new Date,a))}return zv}var nx={},rj;function qse(){if(rj)return nx;rj=1,nx.isMonday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===1}return nx}var sx={},ij;function $se(){if(ij)return sx;ij=1,sx.isPast=e;var n=Je();function e(t){return+(0,n.toDate)(t)<Date.now()}return sx}var rx={},ix={},aj;function zT(){if(aj)return ix;aj=1,ix.startOfHour=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setMinutes(0,0,0),s}return ix}var oj;function UT(){if(oj)return rx;oj=1,rx.isSameHour=e;var n=zT();function e(t,s){const i=(0,n.startOfHour)(t),a=(0,n.startOfHour)(s);return+i==+a}return rx}var ax={},ox={},lj;function KG(){if(lj)return ox;lj=1,ox.isSameWeek=e;var n=Jo();function e(t,s,i){const a=(0,n.startOfWeek)(t,i),o=(0,n.startOfWeek)(s,i);return+a==+o}return ox}var cj;function QT(){if(cj)return ax;cj=1,ax.isSameISOWeek=e;var n=KG();function e(t,s){return(0,n.isSameWeek)(t,s,{weekStartsOn:1})}return ax}var lx={},dj;function ere(){if(dj)return lx;dj=1,lx.isSameISOWeekYear=e;var n=zm();function e(t,s){const i=(0,n.startOfISOWeekYear)(t),a=(0,n.startOfISOWeekYear)(s);return+i==+a}return lx}var cx={},gj;function qT(){if(gj)return cx;gj=1,cx.isSameMinute=e;var n=MG();function e(t,s){const i=(0,n.startOfMinute)(t),a=(0,n.startOfMinute)(s);return+i==+a}return cx}var dx={},uj;function $T(){if(uj)return dx;uj=1,dx.isSameMonth=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()}return dx}var gx={},hj;function eE(){if(hj)return gx;hj=1,gx.isSameQuarter=e;var n=HG();function e(t,s){const i=(0,n.startOfQuarter)(t),a=(0,n.startOfQuarter)(s);return+i==+a}return gx}var ux={},hx={},mj;function tE(){if(mj)return hx;mj=1,hx.startOfSecond=e;var n=Je();function e(t){const s=(0,n.toDate)(t);return s.setMilliseconds(0),s}return hx}var Ij;function nE(){if(Ij)return ux;Ij=1,ux.isSameSecond=e;var n=tE();function e(t,s){const i=(0,n.startOfSecond)(t),a=(0,n.startOfSecond)(s);return+i==+a}return ux}var mx={},Cj;function sE(){if(Cj)return mx;Cj=1,mx.isSameYear=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t),a=(0,n.toDate)(s);return i.getFullYear()===a.getFullYear()}return mx}var Ix={},fj;function tre(){if(fj)return Ix;fj=1,Ix.isThisHour=t;var n=ii(),e=UT();function t(s){return(0,e.isSameHour)(s,(0,n.constructNow)(s))}return Ix}var Cx={},pj;function nre(){if(pj)return Cx;pj=1,Cx.isThisISOWeek=t;var n=ii(),e=QT();function t(s){return(0,e.isSameISOWeek)(s,(0,n.constructNow)(s))}return Cx}var fx={},Aj;function sre(){if(Aj)return fx;Aj=1,fx.isThisMinute=t;var n=ii(),e=qT();function t(s){return(0,e.isSameMinute)(s,(0,n.constructNow)(s))}return fx}var px={},bj;function rre(){if(bj)return px;bj=1,px.isThisMonth=t;var n=ii(),e=$T();function t(s){return(0,e.isSameMonth)(s,(0,n.constructNow)(s))}return px}var Ax={},yj;function ire(){if(yj)return Ax;yj=1,Ax.isThisQuarter=t;var n=ii(),e=eE();function t(s){return(0,e.isSameQuarter)(s,(0,n.constructNow)(s))}return Ax}var bx={},vj;function are(){if(vj)return bx;vj=1,bx.isThisSecond=t;var n=ii(),e=nE();function t(s){return(0,e.isSameSecond)(s,(0,n.constructNow)(s))}return bx}var yx={},xj;function ore(){if(xj)return yx;xj=1,yx.isThisWeek=t;var n=ii(),e=KG();function t(s,i){return(0,e.isSameWeek)(s,(0,n.constructNow)(s),i)}return yx}var vx={},Sj;function lre(){if(Sj)return vx;Sj=1,vx.isThisYear=t;var n=ii(),e=sE();function t(s){return(0,e.isSameYear)(s,(0,n.constructNow)(s))}return vx}var xx={},wj;function cre(){if(wj)return xx;wj=1,xx.isThursday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===4}return xx}var Sx={},Zj;function dre(){if(Zj)return Sx;Zj=1,Sx.isToday=t;var n=ii(),e=Um();function t(s){return(0,e.isSameDay)(s,(0,n.constructNow)(s))}return Sx}var wx={},Gj;function gre(){if(Gj)return wx;Gj=1,wx.isTomorrow=s;var n=Ml(),e=ii(),t=Um();function s(i){return(0,t.isSameDay)(i,(0,n.addDays)((0,e.constructNow)(i),1))}return wx}var Zx={},Bj;function ure(){if(Bj)return Zx;Bj=1,Zx.isTuesday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===2}return Zx}var Gx={},Nj;function hre(){if(Nj)return Gx;Nj=1,Gx.isWednesday=e;var n=Je();function e(t){return(0,n.toDate)(t).getDay()===3}return Gx}var Bx={},kj;function mre(){if(kj)return Bx;kj=1,Bx.isWithinInterval=e;var n=Je();function e(t,s){const i=+(0,n.toDate)(t),[a,o]=[+(0,n.toDate)(s.start),+(0,n.toDate)(s.end)].sort((l,c)=>l-c);return i>=a&&i<=o}return Bx}var Nx={},kx={},Rj;function Hp(){if(Rj)return kx;Rj=1,kx.subDays=e;var n=Ml();function e(t,s){return(0,n.addDays)(t,-s)}return kx}var Wj;function Ire(){if(Wj)return Nx;Wj=1,Nx.isYesterday=s;var n=ii(),e=Um(),t=Hp();function s(i){return(0,e.isSameDay)(i,(0,t.subDays)((0,n.constructNow)(i),1))}return Nx}var Rx={},Vj;function Cre(){if(Vj)return Rx;Vj=1,Rx.lastDayOfDecade=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getFullYear(),a=9+Math.floor(i/10)*10;return s.setFullYear(a+1,0,0),s.setHours(0,0,0,0),s}return Rx}var Wx={},Vx={},_j;function rE(){if(_j)return Vx;_j=1,Vx.lastDayOfWeek=t;var n=Je(),e=_r();function t(s,i){const a=(0,e.getDefaultOptions)(),o=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,l=(0,n.toDate)(s),c=l.getDay(),d=(c<o?-7:0)+6-(c-o);return l.setHours(0,0,0,0),l.setDate(l.getDate()+d),l}return Vx}var jj;function fre(){if(jj)return Wx;jj=1,Wx.lastDayOfISOWeek=e;var n=rE();function e(t){return(0,n.lastDayOfWeek)(t,{weekStartsOn:1})}return Wx}var _x={},Xj;function pre(){if(Xj)return _x;Xj=1,_x.lastDayOfISOWeekYear=s;var n=Wg(),e=Hl(),t=Cn();function s(i){const a=(0,n.getISOWeekYear)(i),o=(0,t.constructFrom)(i,0);o.setFullYear(a+1,0,4),o.setHours(0,0,0,0);const l=(0,e.startOfISOWeek)(o);return l.setDate(l.getDate()-1),l}return _x}var jx={},Jj;function Are(){if(Jj)return jx;Jj=1,jx.lastDayOfQuarter=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getMonth(),a=i-i%3+3;return s.setMonth(a,0),s.setHours(0,0,0,0),s}return jx}var Xx={},Yj;function bre(){if(Yj)return Xx;Yj=1,Xx.lastDayOfYear=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getFullYear();return s.setFullYear(i+1,0,0),s.setHours(0,0,0,0),s}return Xx}var Jx={},Fj;function yre(){return Fj||(Fj=1,(function(n){n.lightFormat=c,Object.defineProperty(n,"lightFormatters",{enumerable:!0,get:function(){return s.lightFormatters}});var e=Id(),t=Je(),s=RT();const i=/(\w)\1*|''|'(''|[^'])+('|$)|./g,a=/^'([^]*?)'?$/,o=/''/g,l=/[a-zA-Z]/;function c(h,m){const f=(0,t.toDate)(h);if(!(0,e.isValid)(f))throw new RangeError("Invalid time value");const p=m.match(i);return p?p.map(x=>{if(x==="''")return"'";const v=x[0];if(v==="'")return d(x);const S=s.lightFormatters[v];if(S)return S(f,x);if(v.match(l))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return x}).join(""):""}function d(h){const m=h.match(a);return m?m[1].replace(o,"'"):h}})(Jx)),Jx}var Yx={},Mj;function vre(){if(Mj)return Yx;Mj=1,Yx.milliseconds=e;var n=qt();function e({years:t,months:s,weeks:i,days:a,hours:o,minutes:l,seconds:c}){let d=0;t&&(d+=t*n.daysInYear),s&&(d+=s*(n.daysInYear/12)),i&&(d+=i*7),a&&(d+=a);let h=d*24*60*60;return o&&(h+=o*60*60),l&&(h+=l*60),c&&(h+=c),Math.trunc(h*1e3)}return Yx}var Fx={},Hj;function xre(){if(Hj)return Fx;Hj=1,Fx.millisecondsToHours=e;var n=qt();function e(t){const s=t/n.millisecondsInHour;return Math.trunc(s)}return Fx}var Mx={},Tj;function Sre(){if(Tj)return Mx;Tj=1,Mx.millisecondsToMinutes=e;var n=qt();function e(t){const s=t/n.millisecondsInMinute;return Math.trunc(s)}return Mx}var Hx={},Ej;function wre(){if(Ej)return Hx;Ej=1,Hx.millisecondsToSeconds=e;var n=qt();function e(t){const s=t/n.millisecondsInSecond;return Math.trunc(s)}return Hx}var Tx={},Dj;function Zre(){if(Dj)return Tx;Dj=1,Tx.minutesToHours=e;var n=qt();function e(t){const s=t/n.minutesInHour;return Math.trunc(s)}return Tx}var Ex={},Lj;function Gre(){if(Lj)return Ex;Lj=1,Ex.minutesToMilliseconds=e;var n=qt();function e(t){return Math.trunc(t*n.millisecondsInMinute)}return Ex}var Dx={},Pj;function Bre(){if(Pj)return Dx;Pj=1,Dx.minutesToSeconds=e;var n=qt();function e(t){return Math.trunc(t*n.secondsInMinute)}return Dx}var Lx={},Kj;function Nre(){if(Kj)return Lx;Kj=1,Lx.monthsToQuarters=e;var n=qt();function e(t){const s=t/n.monthsInQuarter;return Math.trunc(s)}return Lx}var Px={},Oj;function kre(){if(Oj)return Px;Oj=1,Px.monthsToYears=e;var n=qt();function e(t){const s=t/n.monthsInYear;return Math.trunc(s)}return Px}var Kx={},zj;function fd(){if(zj)return Kx;zj=1,Kx.nextDay=t;var n=Ml(),e=Fp();function t(s,i){let a=i-(0,e.getDay)(s);return a<=0&&(a+=7),(0,n.addDays)(s,a)}return Kx}var Ox={},Uj;function Rre(){if(Uj)return Ox;Uj=1,Ox.nextFriday=e;var n=fd();function e(t){return(0,n.nextDay)(t,5)}return Ox}var zx={},Qj;function Wre(){if(Qj)return zx;Qj=1,zx.nextMonday=e;var n=fd();function e(t){return(0,n.nextDay)(t,1)}return zx}var Ux={},qj;function Vre(){if(qj)return Ux;qj=1,Ux.nextSaturday=e;var n=fd();function e(t){return(0,n.nextDay)(t,6)}return Ux}var Qx={},$j;function _re(){if($j)return Qx;$j=1,Qx.nextSunday=e;var n=fd();function e(t){return(0,n.nextDay)(t,0)}return Qx}var qx={},eX;function jre(){if(eX)return qx;eX=1,qx.nextThursday=e;var n=fd();function e(t){return(0,n.nextDay)(t,4)}return qx}var $x={},tX;function Xre(){if(tX)return $x;tX=1,$x.nextTuesday=e;var n=fd();function e(t){return(0,n.nextDay)(t,2)}return $x}var eS={},nX;function Jre(){if(nX)return eS;nX=1,eS.nextWednesday=e;var n=fd();function e(t){return(0,n.nextDay)(t,3)}return eS}var tS={},sX;function Yre(){if(sX)return tS;sX=1,tS.parseISO=e;var n=qt();function e(W,_){const Y=_?.additionalDigits??2,j=o(W);let M;if(j.date){const O=l(j.date,Y);M=c(O.restDateString,O.year)}if(!M||isNaN(M.getTime()))return new Date(NaN);const H=M.getTime();let D=0,z;if(j.time&&(D=h(j.time),isNaN(D)))return new Date(NaN);if(j.timezone){if(z=f(j.timezone),isNaN(z))return new Date(NaN)}else{const O=new Date(H+D),E=new Date(0);return E.setFullYear(O.getUTCFullYear(),O.getUTCMonth(),O.getUTCDate()),E.setHours(O.getUTCHours(),O.getUTCMinutes(),O.getUTCSeconds(),O.getUTCMilliseconds()),E}return new Date(H+D+z)}const t={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},s=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,i=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,a=/^([+-])(\d{2})(?::?(\d{2}))?$/;function o(W){const _={},Y=W.split(t.dateTimeDelimiter);let j;if(Y.length>2)return _;if(/:/.test(Y[0])?j=Y[0]:(_.date=Y[0],j=Y[1],t.timeZoneDelimiter.test(_.date)&&(_.date=W.split(t.timeZoneDelimiter)[0],j=W.substr(_.date.length,W.length))),j){const M=t.timezone.exec(j);M?(_.time=j.replace(M[1],""),_.timezone=M[1]):_.time=j}return _}function l(W,_){const Y=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+_)+"})|(\\d{2}|[+-]\\d{"+(2+_)+"})$)"),j=W.match(Y);if(!j)return{year:NaN,restDateString:""};const M=j[1]?parseInt(j[1]):null,H=j[2]?parseInt(j[2]):null;return{year:H===null?M:H*100,restDateString:W.slice((j[1]||j[2]).length)}}function c(W,_){if(_===null)return new Date(NaN);const Y=W.match(s);if(!Y)return new Date(NaN);const j=!!Y[4],M=d(Y[1]),H=d(Y[2])-1,D=d(Y[3]),z=d(Y[4]),O=d(Y[5])-1;if(j)return B(_,z,O)?p(_,z,O):new Date(NaN);{const E=new Date(0);return!v(_,H,D)||!S(_,M)?new Date(NaN):(E.setUTCFullYear(_,H,Math.max(M,D)),E)}}function d(W){return W?parseInt(W):1}function h(W){const _=W.match(i);if(!_)return NaN;const Y=m(_[1]),j=m(_[2]),M=m(_[3]);return V(Y,j,M)?Y*n.millisecondsInHour+j*n.millisecondsInMinute+M*1e3:NaN}function m(W){return W&&parseFloat(W.replace(",","."))||0}function f(W){if(W==="Z")return 0;const _=W.match(a);if(!_)return 0;const Y=_[1]==="+"?-1:1,j=parseInt(_[2]),M=_[3]&&parseInt(_[3])||0;return R(j,M)?Y*(j*n.millisecondsInHour+M*n.millisecondsInMinute):NaN}function p(W,_,Y){const j=new Date(0);j.setUTCFullYear(W,0,4);const M=j.getUTCDay()||7,H=(_-1)*7+Y+1-M;return j.setUTCDate(j.getUTCDate()+H),j}const b=[31,null,31,30,31,30,31,31,30,31,30,31];function x(W){return W%400===0||W%4===0&&W%100!==0}function v(W,_,Y){return _>=0&&_<=11&&Y>=1&&Y<=(b[_]||(x(W)?29:28))}function S(W,_){return _>=1&&_<=(x(W)?366:365)}function B(W,_,Y){return _>=1&&_<=53&&Y>=0&&Y<=6}function V(W,_,Y){return W===24?_===0&&Y===0:Y>=0&&Y<60&&_>=0&&_<60&&W>=0&&W<25}function R(W,_){return _>=0&&_<=59}return tS}var nS={},rX;function Fre(){if(rX)return nS;rX=1,nS.parseJSON=n;function n(e){const t=e.match(/(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2})(?:\.(\d{0,7}))?(?:Z|(.)(\d{2}):?(\d{2})?)?/);return t?new Date(Date.UTC(+t[1],+t[2]-1,+t[3],+t[4]-(+t[9]||0)*(t[8]=="-"?-1:1),+t[5]-(+t[10]||0)*(t[8]=="-"?-1:1),+t[6],+((t[7]||"0")+"00").substring(0,3))):new Date(NaN)}return nS}var sS={},iX;function pd(){if(iX)return sS;iX=1,sS.previousDay=t;var n=Fp(),e=Hp();function t(s,i){let a=(0,n.getDay)(s)-i;return a<=0&&(a+=7),(0,e.subDays)(s,a)}return sS}var rS={},aX;function Mre(){if(aX)return rS;aX=1,rS.previousFriday=e;var n=pd();function e(t){return(0,n.previousDay)(t,5)}return rS}var iS={},oX;function Hre(){if(oX)return iS;oX=1,iS.previousMonday=e;var n=pd();function e(t){return(0,n.previousDay)(t,1)}return iS}var aS={},lX;function Tre(){if(lX)return aS;lX=1,aS.previousSaturday=e;var n=pd();function e(t){return(0,n.previousDay)(t,6)}return aS}var oS={},cX;function Ere(){if(cX)return oS;cX=1,oS.previousSunday=e;var n=pd();function e(t){return(0,n.previousDay)(t,0)}return oS}var lS={},dX;function Dre(){if(dX)return lS;dX=1,lS.previousThursday=e;var n=pd();function e(t){return(0,n.previousDay)(t,4)}return lS}var cS={},gX;function Lre(){if(gX)return cS;gX=1,cS.previousTuesday=e;var n=pd();function e(t){return(0,n.previousDay)(t,2)}return cS}var dS={},uX;function Pre(){if(uX)return dS;uX=1,dS.previousWednesday=e;var n=pd();function e(t){return(0,n.previousDay)(t,3)}return dS}var gS={},hX;function Kre(){if(hX)return gS;hX=1,gS.quartersToMonths=e;var n=qt();function e(t){return Math.trunc(t*n.monthsInQuarter)}return gS}var uS={},mX;function Ore(){if(mX)return uS;mX=1,uS.quartersToYears=e;var n=qt();function e(t){const s=t/n.quartersInYear;return Math.trunc(s)}return uS}var hS={},IX;function zre(){if(IX)return hS;IX=1,hS.roundToNearestHours=s;var n=Cd(),e=Cn(),t=Je();function s(i,a){const o=a?.nearestTo??1;if(o<1||o>12)return(0,e.constructFrom)(i,NaN);const l=(0,t.toDate)(i),c=l.getMinutes()/60,d=l.getSeconds()/60/60,h=l.getMilliseconds()/1e3/60/60,m=l.getHours()+c+d+h,f=a?.roundingMethod??"round",b=(0,n.getRoundingMethod)(f)(m/o)*o,x=(0,e.constructFrom)(i,l);return x.setHours(b,0,0,0),x}return hS}var mS={},CX;function Ure(){if(CX)return mS;CX=1,mS.roundToNearestMinutes=s;var n=Cd(),e=Cn(),t=Je();function s(i,a){const o=a?.nearestTo??1;if(o<1||o>30)return(0,e.constructFrom)(i,NaN);const l=(0,t.toDate)(i),c=l.getSeconds()/60,d=l.getMilliseconds()/1e3/60,h=l.getMinutes()+c+d,m=a?.roundingMethod??"round",p=(0,n.getRoundingMethod)(m)(h/o)*o,b=(0,e.constructFrom)(i,l);return b.setMinutes(p,0,0),b}return mS}var IS={},fX;function Qre(){if(fX)return IS;fX=1,IS.secondsToHours=e;var n=qt();function e(t){const s=t/n.secondsInHour;return Math.trunc(s)}return IS}var CS={},pX;function qre(){if(pX)return CS;pX=1,CS.secondsToMilliseconds=e;var n=qt();function e(t){return t*n.millisecondsInSecond}return CS}var fS={},AX;function $re(){if(AX)return fS;AX=1,fS.secondsToMinutes=e;var n=qt();function e(t){const s=t/n.secondsInMinute;return Math.trunc(s)}return fS}var pS={},AS={},bX;function OG(){if(bX)return AS;bX=1,AS.setMonth=s;var n=Cn(),e=YT(),t=Je();function s(i,a){const o=(0,t.toDate)(i),l=o.getFullYear(),c=o.getDate(),d=(0,n.constructFrom)(i,0);d.setFullYear(l,a,15),d.setHours(0,0,0,0);const h=(0,e.getDaysInMonth)(d);return o.setMonth(a,Math.min(c,h)),o}return AS}var yX;function eie(){if(yX)return pS;yX=1,pS.set=s;var n=Cn(),e=OG(),t=Je();function s(i,a){let o=(0,t.toDate)(i);return isNaN(+o)?(0,n.constructFrom)(i,NaN):(a.year!=null&&o.setFullYear(a.year),a.month!=null&&(o=(0,e.setMonth)(o,a.month)),a.date!=null&&o.setDate(a.date),a.hours!=null&&o.setHours(a.hours),a.minutes!=null&&o.setMinutes(a.minutes),a.seconds!=null&&o.setSeconds(a.seconds),a.milliseconds!=null&&o.setMilliseconds(a.milliseconds),o)}return pS}var bS={},vX;function tie(){if(vX)return bS;vX=1,bS.setDate=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setDate(s),i}return bS}var yS={},xX;function nie(){if(xX)return yS;xX=1,yS.setDayOfYear=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setMonth(0),i.setDate(s),i}return yS}var vS={},SX;function sie(){if(SX)return vS;SX=1,vS.setDefaultOptions=e;var n=_r();function e(t){const s={},i=(0,n.getDefaultOptions)();for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(s[a]=i[a]);for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(t[a]===void 0?delete s[a]:s[a]=t[a]);(0,n.setDefaultOptions)(s)}return vS}var xS={},wX;function rie(){if(wX)return xS;wX=1,xS.setHours=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setHours(s),i}return xS}var SS={},ZX;function iie(){if(ZX)return SS;ZX=1,SS.setMilliseconds=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setMilliseconds(s),i}return SS}var wS={},GX;function aie(){if(GX)return wS;GX=1,wS.setMinutes=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setMinutes(s),i}return wS}var ZS={},BX;function oie(){if(BX)return ZS;BX=1,ZS.setQuarter=t;var n=OG(),e=Je();function t(s,i){const a=(0,e.toDate)(s),o=Math.trunc(a.getMonth()/3)+1,l=i-o;return(0,n.setMonth)(a,a.getMonth()+l*3)}return ZS}var GS={},NX;function lie(){if(NX)return GS;NX=1,GS.setSeconds=e;var n=Je();function e(t,s){const i=(0,n.toDate)(t);return i.setSeconds(s),i}return GS}var BS={},kX;function cie(){if(kX)return BS;kX=1,BS.setWeekYear=a;var n=Cn(),e=md(),t=LG(),s=Je(),i=_r();function a(o,l,c){const d=(0,i.getDefaultOptions)(),h=c?.firstWeekContainsDate??c?.locale?.options?.firstWeekContainsDate??d.firstWeekContainsDate??d.locale?.options?.firstWeekContainsDate??1;let m=(0,s.toDate)(o);const f=(0,e.differenceInCalendarDays)(m,(0,t.startOfWeekYear)(m,c)),p=(0,n.constructFrom)(o,0);return p.setFullYear(l,0,h),p.setHours(0,0,0,0),m=(0,t.startOfWeekYear)(p,c),m.setDate(m.getDate()+f),m}return BS}var NS={},RX;function die(){if(RX)return NS;RX=1,NS.setYear=t;var n=Cn(),e=Je();function t(s,i){const a=(0,e.toDate)(s);return isNaN(+a)?(0,n.constructFrom)(s,NaN):(a.setFullYear(i),a)}return NS}var kS={},WX;function gie(){if(WX)return kS;WX=1,kS.startOfDecade=e;var n=Je();function e(t){const s=(0,n.toDate)(t),i=s.getFullYear(),a=Math.floor(i/10)*10;return s.setFullYear(a,0,1),s.setHours(0,0,0,0),s}return kS}var RS={},VX;function uie(){if(VX)return RS;VX=1,RS.startOfToday=e;var n=Wp();function e(){return(0,n.startOfDay)(Date.now())}return RS}var WS={},_X;function hie(){if(_X)return WS;_X=1,WS.startOfTomorrow=n;function n(){const e=new Date,t=e.getFullYear(),s=e.getMonth(),i=e.getDate(),a=new Date(0);return a.setFullYear(t,s,i+1),a.setHours(0,0,0,0),a}return WS}var VS={},jX;function mie(){if(jX)return VS;jX=1,VS.startOfYesterday=n;function n(){const e=new Date,t=e.getFullYear(),s=e.getMonth(),i=e.getDate(),a=new Date(0);return a.setFullYear(t,s,i-1),a.setHours(0,0,0,0),a}return VS}var _S={},jS={},XX;function iE(){if(XX)return jS;XX=1,jS.subMonths=e;var n=Km();function e(t,s){return(0,n.addMonths)(t,-s)}return jS}var JX;function Iie(){if(JX)return _S;JX=1,_S.sub=s;var n=Hp(),e=iE(),t=Cn();function s(i,a){const{years:o=0,months:l=0,weeks:c=0,days:d=0,hours:h=0,minutes:m=0,seconds:f=0}=a,p=(0,e.subMonths)(i,l+o*12),b=(0,n.subDays)(p,d+c*7),x=m+h*60,S=(f+x*60)*1e3;return(0,t.constructFrom)(i,b.getTime()-S)}return _S}var XS={},YX;function Cie(){if(YX)return XS;YX=1,XS.subBusinessDays=e;var n=uT();function e(t,s){return(0,n.addBusinessDays)(t,-s)}return XS}var JS={},FX;function fie(){if(FX)return JS;FX=1,JS.subHours=e;var n=NG();function e(t,s){return(0,n.addHours)(t,-s)}return JS}var YS={},MX;function pie(){if(MX)return YS;MX=1,YS.subMilliseconds=e;var n=Om();function e(t,s){return(0,n.addMilliseconds)(t,-s)}return YS}var FS={},HX;function Aie(){if(HX)return FS;HX=1,FS.subMinutes=e;var n=kG();function e(t,s){return(0,n.addMinutes)(t,-s)}return FS}var MS={},TX;function bie(){if(TX)return MS;TX=1,MS.subQuarters=e;var n=RG();function e(t,s){return(0,n.addQuarters)(t,-s)}return MS}var HS={},EX;function yie(){if(EX)return HS;EX=1,HS.subSeconds=e;var n=IT();function e(t,s){return(0,n.addSeconds)(t,-s)}return HS}var TS={},DX;function vie(){if(DX)return TS;DX=1,TS.subWeeks=e;var n=Vp();function e(t,s){return(0,n.addWeeks)(t,-s)}return TS}var ES={},LX;function xie(){if(LX)return ES;LX=1,ES.subYears=e;var n=CT();function e(t,s){return(0,n.addYears)(t,-s)}return ES}var DS={},PX;function Sie(){if(PX)return DS;PX=1,DS.weeksToDays=e;var n=qt();function e(t){return Math.trunc(t*n.daysInWeek)}return DS}var LS={},KX;function wie(){if(KX)return LS;KX=1,LS.yearsToDays=e;var n=qt();function e(t){return Math.trunc(t*n.daysInYear)}return LS}var PS={},OX;function Zie(){if(OX)return PS;OX=1,PS.yearsToMonths=e;var n=qt();function e(t){return Math.trunc(t*n.monthsInYear)}return PS}var KS={},zX;function Gie(){if(zX)return KS;zX=1,KS.yearsToQuarters=e;var n=qt();function e(t){return Math.trunc(t*n.quartersInYear)}return KS}var UX;function Vg(){return UX||(UX=1,(function(n){var e=cT();Object.keys(e).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===e[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return e[C]}})});var t=uT();Object.keys(t).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===t[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return t[C]}})});var s=Ml();Object.keys(s).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===s[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return s[C]}})});var i=NG();Object.keys(i).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===i[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return i[C]}})});var a=mT();Object.keys(a).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===a[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return a[C]}})});var o=Om();Object.keys(o).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===o[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return o[C]}})});var l=kG();Object.keys(l).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===l[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return l[C]}})});var c=Km();Object.keys(c).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===c[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return c[C]}})});var d=RG();Object.keys(d).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===d[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return d[C]}})});var h=IT();Object.keys(h).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===h[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return h[C]}})});var m=Vp();Object.keys(m).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===m[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return m[C]}})});var f=CT();Object.keys(f).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===f[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return f[C]}})});var p=Ute();Object.keys(p).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===p[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return p[C]}})});var b=Qte();Object.keys(b).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===b[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return b[C]}})});var x=qte();Object.keys(x).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===x[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return x[C]}})});var v=$te();Object.keys(v).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===v[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return v[C]}})});var S=nh();Object.keys(S).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===S[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return S[C]}})});var B=ene();Object.keys(B).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===B[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return B[C]}})});var V=Cn();Object.keys(V).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===V[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return V[C]}})});var R=ii();Object.keys(R).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===R[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return R[C]}})});var W=tne();Object.keys(W).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===W[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return W[C]}})});var _=nne();Object.keys(_).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===_[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return _[C]}})});var Y=md();Object.keys(Y).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Y[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Y[C]}})});var j=bT();Object.keys(j).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===j[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return j[C]}})});var M=sne();Object.keys(M).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===M[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return M[C]}})});var H=WG();Object.keys(H).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===H[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return H[C]}})});var D=vT();Object.keys(D).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===D[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return D[C]}})});var z=VG();Object.keys(z).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===z[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return z[C]}})});var O=_G();Object.keys(O).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===O[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return O[C]}})});var E=jG();Object.keys(E).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===E[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return E[C]}})});var te=XG();Object.keys(te).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===te[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return te[C]}})});var q=rne();Object.keys(q).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===q[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return q[C]}})});var de=_p();Object.keys(de).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===de[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return de[C]}})});var U=JG();Object.keys(U).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===U[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return U[C]}})});var P=jp();Object.keys(P).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===P[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return P[C]}})});var ne=ine();Object.keys(ne).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ne[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ne[C]}})});var K=Xp();Object.keys(K).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===K[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return K[C]}})});var re=ane();Object.keys(re).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===re[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return re[C]}})});var le=wT();Object.keys(le).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===le[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return le[C]}})});var ue=ZT();Object.keys(ue).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ue[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ue[C]}})});var ae=one();Object.keys(ae).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ae[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ae[C]}})});var Ce=lne();Object.keys(Ce).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ce[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ce[C]}})});var ie=cne();Object.keys(ie).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ie[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ie[C]}})});var ge=dne();Object.keys(ge).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ge[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ge[C]}})});var xe=gne();Object.keys(xe).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===xe[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return xe[C]}})});var _e=TG();Object.keys(_e).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===_e[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return _e[C]}})});var Be=une();Object.keys(Be).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Be[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Be[C]}})});var Se=hne();Object.keys(Se).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Se[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Se[C]}})});var Re=mne();Object.keys(Re).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Re[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Re[C]}})});var Ye=YG();Object.keys(Ye).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ye[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ye[C]}})});var De=Ine();Object.keys(De).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===De[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return De[C]}})});var Me=Cne();Object.keys(Me).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Me[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Me[C]}})});var Le=fne();Object.keys(Le).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Le[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Le[C]}})});var nt=pne();Object.keys(nt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===nt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return nt[C]}})});var st=Ane();Object.keys(st).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===st[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return st[C]}})});var ee=FG();Object.keys(ee).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ee[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ee[C]}})});var oe=bne();Object.keys(oe).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===oe[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return oe[C]}})});var Ie=yne();Object.keys(Ie).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ie[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ie[C]}})});var Ne=vne();Object.keys(Ne).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ne[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ne[C]}})});var Ge=xne();Object.keys(Ge).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ge[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ge[C]}})});var je=BT();Object.keys(je).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===je[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return je[C]}})});var Fe=GT();Object.keys(Fe).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Fe[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Fe[C]}})});var ze=Sne();Object.keys(ze).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ze[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ze[C]}})});var lt=_T();Object.keys(lt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===lt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return lt[C]}})});var Dt=jT();Object.keys(Dt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Dt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Dt[C]}})});var kt=XT();Object.keys(kt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===kt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return kt[C]}})});var $t=jne();Object.keys($t).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===$t[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return $t[C]}})});var wn=Xne();Object.keys(wn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===wn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return wn[C]}})});var Rt=Jne();Object.keys(Rt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Rt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Rt[C]}})});var cn=Yne();Object.keys(cn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===cn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return cn[C]}})});var en=Fne();Object.keys(en).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===en[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return en[C]}})});var on=Mne();Object.keys(on).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===on[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return on[C]}})});var Ut=Hne();Object.keys(Ut).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ut[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ut[C]}})});var dn=Tne();Object.keys(dn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===dn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return dn[C]}})});var fn=Ene();Object.keys(fn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===fn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return fn[C]}})});var Ft=Dne();Object.keys(Ft).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ft[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ft[C]}})});var it=JT();Object.keys(it).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===it[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return it[C]}})});var pn=Fp();Object.keys(pn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===pn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return pn[C]}})});var un=kT();Object.keys(un).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===un[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return un[C]}})});var ls=YT();Object.keys(ls).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ls[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ls[C]}})});var Cs=Lne();Object.keys(Cs).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Cs[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Cs[C]}})});var br=Pne();Object.keys(br).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===br[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return br[C]}})});var Ia=MT();Object.keys(Ia).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ia[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ia[C]}})});var Xr=Kne();Object.keys(Xr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Xr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Xr[C]}})});var Rn=HT();Object.keys(Rn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Rn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Rn[C]}})});var nr=DG();Object.keys(nr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===nr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return nr[C]}})});var Jr=Wg();Object.keys(Jr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Jr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Jr[C]}})});var Gs=One();Object.keys(Gs).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Gs[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Gs[C]}})});var Yo=zne();Object.keys(Yo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Yo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Yo[C]}})});var fs=Une();Object.keys(fs).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===fs[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return fs[C]}})});var gt=Qne();Object.keys(gt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===gt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return gt[C]}})});var Ca=qne();Object.keys(Ca).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ca[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ca[C]}})});var Pa=yT();Object.keys(Pa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Pa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Pa[C]}})});var Tl=$ne();Object.keys(Tl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Tl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Tl[C]}})});var El=ese();Object.keys(El).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===El[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return El[C]}})});var Fo=tse();Object.keys(Fo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Fo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Fo[C]}})});var Yr=PG();Object.keys(Yr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Yr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Yr[C]}})});var ai=nse();Object.keys(ai).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ai[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ai[C]}})});var Mo=Yp();Object.keys(Mo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Mo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Mo[C]}})});var yd=sse();Object.keys(yd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===yd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return yd[C]}})});var Dl=rse();Object.keys(Dl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Dl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Dl[C]}})});var Ll=ise();Object.keys(Ll).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ll[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ll[C]}})});var Pl=ase();Object.keys(Pl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Pl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Pl[C]}})});var Ho=ose();Object.keys(Ho).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ho[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ho[C]}})});var vd=lse();Object.keys(vd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===vd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return vd[C]}})});var Ka=cse();Object.keys(Ka).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ka[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ka[C]}})});var jn=dse();Object.keys(jn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===jn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return jn[C]}})});var xd=gse();Object.keys(xd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===xd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return xd[C]}})});var To=use();Object.keys(To).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===To[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return To[C]}})});var Kl=hse();Object.keys(Kl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Kl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Kl[C]}})});var Oa=AT();Object.keys(Oa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Oa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Oa[C]}})});var Eo=mse();Object.keys(Eo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Eo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Eo[C]}})});var Vi=Ise();Object.keys(Vi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Vi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Vi[C]}})});var fa=Cse();Object.keys(fa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===fa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return fa[C]}})});var Es=fse();Object.keys(Es).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Es[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Es[C]}})});var pa=pse();Object.keys(pa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===pa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return pa[C]}})});var Wt=ST();Object.keys(Wt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Wt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Wt[C]}})});var Zn=FT();Object.keys(Zn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Zn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Zn[C]}})});var za=Qse();Object.keys(za).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===za[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return za[C]}})});var _i=qse();Object.keys(_i).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===_i[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return _i[C]}})});var yr=$se();Object.keys(yr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===yr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return yr[C]}})});var ji=Um();Object.keys(ji).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ji[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ji[C]}})});var Nt=UT();Object.keys(Nt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Nt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Nt[C]}})});var vn=QT();Object.keys(vn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===vn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return vn[C]}})});var Do=ere();Object.keys(Do).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Do[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Do[C]}})});var Ua=qT();Object.keys(Ua).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ua[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ua[C]}})});var ps=$T();Object.keys(ps).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ps[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ps[C]}})});var Ol=eE();Object.keys(Ol).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ol[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ol[C]}})});var Xi=nE();Object.keys(Xi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Xi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Xi[C]}})});var Ds=KG();Object.keys(Ds).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ds[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ds[C]}})});var Fn=sE();Object.keys(Fn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Fn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Fn[C]}})});var vr=dT();Object.keys(vr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===vr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return vr[C]}})});var zt=gT();Object.keys(zt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===zt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return zt[C]}})});var Ji=tre();Object.keys(Ji).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ji[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ji[C]}})});var Qa=nre();Object.keys(Qa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Qa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Qa[C]}})});var oi=sre();Object.keys(oi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===oi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return oi[C]}})});var qa=rre();Object.keys(qa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===qa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return qa[C]}})});var $a=ire();Object.keys($a).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===$a[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return $a[C]}})});var Aa=are();Object.keys(Aa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Aa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Aa[C]}})});var ba=ore();Object.keys(ba).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ba[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ba[C]}})});var Yi=lre();Object.keys(Yi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Yi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Yi[C]}})});var Ls=cre();Object.keys(Ls).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ls[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ls[C]}})});var xr=dre();Object.keys(xr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===xr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return xr[C]}})});var sr=gre();Object.keys(sr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===sr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return sr[C]}})});var ya=ure();Object.keys(ya).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ya[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ya[C]}})});var wt=Id();Object.keys(wt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===wt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return wt[C]}})});var qn=hre();Object.keys(qn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===qn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return qn[C]}})});var hn=Rp();Object.keys(hn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===hn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return hn[C]}})});var Lo=mre();Object.keys(Lo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Lo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Lo[C]}})});var li=Ire();Object.keys(li).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===li[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return li[C]}})});var Po=Cre();Object.keys(Po).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Po[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Po[C]}})});var eo=fre();Object.keys(eo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===eo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return eo[C]}})});var rr=pre();Object.keys(rr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===rr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return rr[C]}})});var to=TT();Object.keys(to).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===to[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return to[C]}})});var va=Are();Object.keys(va).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===va[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return va[C]}})});var Xn=rE();Object.keys(Xn).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Xn[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Xn[C]}})});var Ps=bre();Object.keys(Ps).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ps[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ps[C]}})});var ci=yre();Object.keys(ci).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ci[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ci[C]}})});var xa=fT();Object.keys(xa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===xa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return xa[C]}})});var Sd=vre();Object.keys(Sd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Sd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Sd[C]}})});var zl=xre();Object.keys(zl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===zl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return zl[C]}})});var Sa=Sre();Object.keys(Sa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Sa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Sa[C]}})});var no=wre();Object.keys(no).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===no[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return no[C]}})});var so=pT();Object.keys(so).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===so[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return so[C]}})});var Pt=Zre();Object.keys(Pt).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Pt[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Pt[C]}})});var Fr=Gre();Object.keys(Fr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Fr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Fr[C]}})});var Bs=Bre();Object.keys(Bs).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Bs[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Bs[C]}})});var Mr=Nre();Object.keys(Mr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Mr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Mr[C]}})});var Ko=kre();Object.keys(Ko).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ko[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ko[C]}})});var ro=fd();Object.keys(ro).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ro[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ro[C]}})});var Fi=Rre();Object.keys(Fi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Fi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Fi[C]}})});var Ul=Wre();Object.keys(Ul).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ul[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ul[C]}})});var As=Vre();Object.keys(As).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===As[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return As[C]}})});var Mi=_re();Object.keys(Mi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Mi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Mi[C]}})});var Oo=jre();Object.keys(Oo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Oo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Oo[C]}})});var di=Xre();Object.keys(di).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===di[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return di[C]}})});var wd=Jre();Object.keys(wd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===wd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return wd[C]}})});var Js=OT();Object.keys(Js).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Js[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Js[C]}})});var zo=Yre();Object.keys(zo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===zo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return zo[C]}})});var Hi=Fre();Object.keys(Hi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Hi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Hi[C]}})});var Ks=pd();Object.keys(Ks).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ks[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ks[C]}})});var Uo=Mre();Object.keys(Uo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Uo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Uo[C]}})});var Ql=Hre();Object.keys(Ql).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ql[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ql[C]}})});var Qo=Tre();Object.keys(Qo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Qo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Qo[C]}})});var Zd=Ere();Object.keys(Zd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Zd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Zd[C]}})});var io=Dre();Object.keys(io).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===io[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return io[C]}})});var ql=Lre();Object.keys(ql).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ql[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ql[C]}})});var Gd=Pre();Object.keys(Gd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Gd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Gd[C]}})});var Bd=Kre();Object.keys(Bd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Bd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Bd[C]}})});var qo=Ore();Object.keys(qo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===qo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return qo[C]}})});var Nd=zre();Object.keys(Nd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Nd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Nd[C]}})});var $o=Ure();Object.keys($o).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===$o[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return $o[C]}})});var $l=Qre();Object.keys($l).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===$l[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return $l[C]}})});var ao=qre();Object.keys(ao).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ao[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ao[C]}})});var gi=$re();Object.keys(gi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===gi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return gi[C]}})});var kd=eie();Object.keys(kd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===kd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return kd[C]}})});var ui=tie();Object.keys(ui).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ui[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ui[C]}})});var Ys=Mp();Object.keys(Ys).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ys[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ys[C]}})});var ec=nie();Object.keys(ec).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ec[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ec[C]}})});var tc=sie();Object.keys(tc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===tc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return tc[C]}})});var nc=rie();Object.keys(nc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===nc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return nc[C]}})});var el=KT();Object.keys(el).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===el[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return el[C]}})});var tl=PT();Object.keys(tl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===tl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return tl[C]}})});var Rd=hT();Object.keys(Rd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Rd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Rd[C]}})});var Wd=iie();Object.keys(Wd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Wd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Wd[C]}})});var sc=aie();Object.keys(sc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===sc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return sc[C]}})});var Vd=OG();Object.keys(Vd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Vd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Vd[C]}})});var Os=oie();Object.keys(Os).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Os[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Os[C]}})});var Hr=lie();Object.keys(Hr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Hr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Hr[C]}})});var wa=LT();Object.keys(wa).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===wa[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return wa[C]}})});var Sr=cie();Object.keys(Sr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Sr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Sr[C]}})});var rc=die();Object.keys(rc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===rc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return rc[C]}})});var hi=Wp();Object.keys(hi).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===hi[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return hi[C]}})});var ic=gie();Object.keys(ic).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ic[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ic[C]}})});var Ti=zT();Object.keys(Ti).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ti[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ti[C]}})});var nl=Hl();Object.keys(nl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===nl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return nl[C]}})});var wr=zm();Object.keys(wr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===wr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return wr[C]}})});var _d=MG();Object.keys(_d).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===_d[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return _d[C]}})});var Tr=Jp();Object.keys(Tr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Tr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Tr[C]}})});var oo=HG();Object.keys(oo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===oo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return oo[C]}})});var ac=tE();Object.keys(ac).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ac[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ac[C]}})});var lo=uie();Object.keys(lo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===lo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return lo[C]}})});var Za=hie();Object.keys(Za).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Za[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Za[C]}})});var Ns=Jo();Object.keys(Ns).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ns[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ns[C]}})});var jd=LG();Object.keys(jd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===jd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return jd[C]}})});var Zr=EG();Object.keys(Zr).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Zr[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Zr[C]}})});var Xd=mie();Object.keys(Xd).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Xd[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Xd[C]}})});var ir=Iie();Object.keys(ir).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ir[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ir[C]}})});var Ei=Cie();Object.keys(Ei).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ei[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ei[C]}})});var co=Hp();Object.keys(co).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===co[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return co[C]}})});var go=fie();Object.keys(go).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===go[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return go[C]}})});var Ga=xT();Object.keys(Ga).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Ga[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Ga[C]}})});var uo=pie();Object.keys(uo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===uo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return uo[C]}})});var ho=Aie();Object.keys(ho).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===ho[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return ho[C]}})});var Di=iE();Object.keys(Di).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Di[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Di[C]}})});var mo=bie();Object.keys(mo).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===mo[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return mo[C]}})});var sl=yie();Object.keys(sl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===sl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return sl[C]}})});var oc=vie();Object.keys(oc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===oc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return oc[C]}})});var zs=xie();Object.keys(zs).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===zs[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return zs[C]}})});var Er=Je();Object.keys(Er).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===Er[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return Er[C]}})});var lc=ET();Object.keys(lc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===lc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return lc[C]}})});var rl=Sie();Object.keys(rl).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===rl[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return rl[C]}})});var cc=wie();Object.keys(cc).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===cc[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return cc[C]}})});var il=Zie();Object.keys(il).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===il[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return il[C]}})});var al=Gie();Object.keys(al).forEach(function(C){C==="default"||C==="__esModule"||C in n&&n[C]===al[C]||Object.defineProperty(n,C,{enumerable:!0,get:function(){return al[C]}})})})(dy)),dy}var QX;function Tp(){if(QX)return eg;QX=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.rangeShape=eg.default=void 0;var n=o(Ar()),e=i(La()),t=i(Rg()),s=Vg();function i(p){return p&&p.__esModule?p:{default:p}}function a(p){if(typeof WeakMap!="function")return null;var b=new WeakMap,x=new WeakMap;return(a=function(v){return v?x:b})(p)}function o(p,b){if(p&&p.__esModule)return p;if(p===null||typeof p!="object"&&typeof p!="function")return{default:p};var x=a(b);if(x&&x.has(p))return x.get(p);var v={__proto__:null},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in p)if(B!=="default"&&Object.prototype.hasOwnProperty.call(p,B)){var V=S?Object.getOwnPropertyDescriptor(p,B):null;V&&(V.get||V.set)?Object.defineProperty(v,B,V):v[B]=p[B]}return v.default=p,x&&x.set(p,v),v}function l(){return l=Object.assign?Object.assign.bind():function(p){for(var b=1;b<arguments.length;b++){var x=arguments[b];for(var v in x)Object.prototype.hasOwnProperty.call(x,v)&&(p[v]=x[v])}return p},l.apply(this,arguments)}function c(p,b,x){return b=d(b),b in p?Object.defineProperty(p,b,{value:x,enumerable:!0,configurable:!0,writable:!0}):p[b]=x,p}function d(p){var b=h(p,"string");return typeof b=="symbol"?b:String(b)}function h(p,b){if(typeof p!="object"||!p)return p;var x=p[Symbol.toPrimitive];if(x!==void 0){var v=x.call(p,b);if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(b==="string"?String:Number)(p)}let m=class extends n.Component{constructor(b,x){super(b,x),c(this,"handleKeyEvent",v=>{const{day:S,onMouseDown:B,onMouseUp:V}=this.props;[13,32].includes(v.keyCode)&&(v.type==="keydown"?B(S):V(S))}),c(this,"handleMouseEvent",v=>{const{day:S,disabled:B,onPreviewChange:V,onMouseEnter:R,onMouseDown:W,onMouseUp:_}=this.props,Y={};if(B){V();return}switch(v.type){case"mouseenter":R(S),V(S),Y.hover=!0;break;case"blur":case"mouseleave":Y.hover=!1;break;case"mousedown":Y.active=!0,W(S);break;case"mouseup":v.stopPropagation(),Y.active=!1,_(S);break;case"focus":V(S);break}Object.keys(Y).length&&this.setState(Y)}),c(this,"getClassNames",()=>{const{isPassive:v,isToday:S,isWeekend:B,isStartOfWeek:V,isEndOfWeek:R,isStartOfMonth:W,isEndOfMonth:_,disabled:Y,styles:j}=this.props;return(0,t.default)(j.day,{[j.dayPassive]:v,[j.dayDisabled]:Y,[j.dayToday]:S,[j.dayWeekend]:B,[j.dayStartOfWeek]:V,[j.dayEndOfWeek]:R,[j.dayStartOfMonth]:W,[j.dayEndOfMonth]:_,[j.dayHovered]:this.state.hover,[j.dayActive]:this.state.active})}),c(this,"renderPreviewPlaceholder",()=>{const{preview:v,day:S,styles:B}=this.props;if(!v)return null;const V=v.startDate?(0,s.endOfDay)(v.startDate):null,R=v.endDate?(0,s.startOfDay)(v.endDate):null,W=(!V||(0,s.isAfter)(S,V))&&(!R||(0,s.isBefore)(S,R)),_=!W&&(0,s.isSameDay)(S,V),Y=!W&&(0,s.isSameDay)(S,R);return n.default.createElement("span",{className:(0,t.default)({[B.dayStartPreview]:_,[B.dayInPreview]:W,[B.dayEndPreview]:Y}),style:{color:v.color}})}),c(this,"renderSelectionPlaceholders",()=>{const{styles:v,ranges:S,day:B}=this.props;return this.props.displayMode==="date"?(0,s.isSameDay)(this.props.day,this.props.date)?n.default.createElement("span",{className:v.selected,style:{color:this.props.color}}):null:S.reduce((R,W)=>{let _=W.startDate,Y=W.endDate;_&&Y&&(0,s.isBefore)(Y,_)&&([_,Y]=[Y,_]),_=_?(0,s.endOfDay)(_):null,Y=Y?(0,s.startOfDay)(Y):null;const j=(!_||(0,s.isAfter)(B,_))&&(!Y||(0,s.isBefore)(B,Y)),M=!j&&(0,s.isSameDay)(B,_),H=!j&&(0,s.isSameDay)(B,Y);return j||M||H?[...R,{isStartEdge:M,isEndEdge:H,isInRange:j,...W}]:R},[]).map((R,W)=>n.default.createElement("span",{key:W,className:(0,t.default)({[v.startEdge]:R.isStartEdge,[v.endEdge]:R.isEndEdge,[v.inRange]:R.isInRange}),style:{color:R.color||this.props.color}}))}),this.state={hover:!1,active:!1}}render(){const{dayContentRenderer:b}=this.props;return n.default.createElement("button",l({type:"button",onMouseEnter:this.handleMouseEvent,onMouseLeave:this.handleMouseEvent,onFocus:this.handleMouseEvent,onMouseDown:this.handleMouseEvent,onMouseUp:this.handleMouseEvent,onBlur:this.handleMouseEvent,onPauseCapture:this.handleMouseEvent,onKeyDown:this.handleKeyEvent,onKeyUp:this.handleKeyEvent,className:this.getClassNames(this.props.styles)},this.props.disabled||this.props.isPassive?{tabIndex:-1}:{},{style:{color:this.props.color}}),this.renderSelectionPlaceholders(),this.renderPreviewPlaceholder(),n.default.createElement("span",{className:this.props.styles.dayNumber},b?.(this.props.day)||n.default.createElement("span",null,(0,s.format)(this.props.day,this.props.dayDisplayFormat))))}};m.defaultProps={};const f=eg.rangeShape=e.default.shape({startDate:e.default.object,endDate:e.default.object,color:e.default.string,key:e.default.string,autoFocus:e.default.bool,disabled:e.default.bool,showDateDisplay:e.default.bool});return m.propTypes={day:e.default.object.isRequired,dayDisplayFormat:e.default.string,date:e.default.object,ranges:e.default.arrayOf(f),preview:e.default.shape({startDate:e.default.object,endDate:e.default.object,color:e.default.string}),onPreviewChange:e.default.func,previewColor:e.default.string,disabled:e.default.bool,isPassive:e.default.bool,isToday:e.default.bool,isWeekend:e.default.bool,isStartOfWeek:e.default.bool,isEndOfWeek:e.default.bool,isStartOfMonth:e.default.bool,isEndOfMonth:e.default.bool,color:e.default.string,displayMode:e.default.oneOf(["dateRange","date"]),styles:e.default.object,onMouseDown:e.default.func,onMouseUp:e.default.func,onMouseEnter:e.default.func,dayContentRenderer:e.default.func},eg.default=m,eg}var Fh={},tg={},qX;function Ep(){if(qX)return tg;qX=1,Object.defineProperty(tg,"__esModule",{value:!0}),tg.calcFocusDate=s,tg.findNextRangeIndex=i,tg.generateStyles=o,tg.getMonthDisplayRange=a;var n=t(Rg()),e=Vg();function t(l){return l&&l.__esModule?l:{default:l}}function s(l,c){const{shownDate:d,date:h,months:m,ranges:f,focusedRange:p,displayMode:b}=c;let x;if(b==="dateRange"){const S=f[p[0]]||{};x={start:S.startDate,end:S.endDate}}else x={start:h,end:h};x.start=(0,e.startOfMonth)(x.start||new Date),x.end=(0,e.endOfMonth)(x.end||x.start);const v=x.start||x.end||d||new Date;return l?(0,e.differenceInCalendarMonths)(x.start,x.end)>m?l:v:d||v}function i(l){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1;const d=l.findIndex((h,m)=>m>c&&h.autoFocus!==!1&&!h.disabled);return d!==-1?d:l.findIndex(h=>h.autoFocus!==!1&&!h.disabled)}function a(l,c,d){const h=(0,e.startOfMonth)(l,c),m=(0,e.endOfMonth)(l,c),f=(0,e.startOfWeek)(h,c);let p=(0,e.endOfWeek)(m,c);return d&&(0,e.differenceInCalendarDays)(p,f)<=34&&(p=(0,e.addDays)(p,7)),{start:f,end:p,startDateOfMonth:h,endDateOfMonth:m}}function o(l){return l.length?l.filter(d=>!!d).reduce((d,h)=>(Object.keys(h).forEach(m=>{d[m]=(0,n.default)(d[m],h[m])}),d),{}):{}}return tg}var $X;function Bie(){if($X)return Fh;$X=1,Object.defineProperty(Fh,"__esModule",{value:!0}),Fh.default=void 0;var n=l(Ar()),e=a(La()),t=l(Tp()),s=Vg(),i=Ep();function a(m){return m&&m.__esModule?m:{default:m}}function o(m){if(typeof WeakMap!="function")return null;var f=new WeakMap,p=new WeakMap;return(o=function(b){return b?p:f})(m)}function l(m,f){if(m&&m.__esModule)return m;if(m===null||typeof m!="object"&&typeof m!="function")return{default:m};var p=o(f);if(p&&p.has(m))return p.get(m);var b={__proto__:null},x=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in m)if(v!=="default"&&Object.prototype.hasOwnProperty.call(m,v)){var S=x?Object.getOwnPropertyDescriptor(m,v):null;S&&(S.get||S.set)?Object.defineProperty(b,v,S):b[v]=m[v]}return b.default=m,p&&p.set(m,b),b}function c(){return c=Object.assign?Object.assign.bind():function(m){for(var f=1;f<arguments.length;f++){var p=arguments[f];for(var b in p)Object.prototype.hasOwnProperty.call(p,b)&&(m[b]=p[b])}return m},c.apply(this,arguments)}function d(m,f,p){const b=new Date;return n.default.createElement("div",{className:m.weekDays},(0,s.eachDayOfInterval)({start:(0,s.startOfWeek)(b,f),end:(0,s.endOfWeek)(b,f)}).map((x,v)=>n.default.createElement("span",{className:m.weekDay,key:v},(0,s.format)(x,p,f))))}let h=class extends n.PureComponent{render(){const f=new Date,{displayMode:p,focusedRange:b,drag:x,styles:v,disabledDates:S,disabledDay:B}=this.props,V=this.props.minDate&&(0,s.startOfDay)(this.props.minDate),R=this.props.maxDate&&(0,s.endOfDay)(this.props.maxDate),W=(0,i.getMonthDisplayRange)(this.props.month,this.props.dateOptions,this.props.fixedHeight);let _=this.props.ranges;if(p==="dateRange"&&x.status){let{startDate:j,endDate:M}=x.range;_=_.map((H,D)=>D!==b[0]?H:{...H,startDate:j,endDate:M})}const Y=this.props.showPreview&&!x.disablePreview;return n.default.createElement("div",{className:v.month,style:this.props.style},this.props.showMonthName?n.default.createElement("div",{className:v.monthName},(0,s.format)(this.props.month,this.props.monthDisplayFormat,this.props.dateOptions)):null,this.props.showWeekDays&&d(v,this.props.dateOptions,this.props.weekdayDisplayFormat),n.default.createElement("div",{className:v.days,onMouseLeave:this.props.onMouseLeave},(0,s.eachDayOfInterval)({start:W.start,end:W.end}).map((j,M)=>{const H=(0,s.isSameDay)(j,W.startDateOfMonth),D=(0,s.isSameDay)(j,W.endDateOfMonth),z=V&&(0,s.isBefore)(j,V)||R&&(0,s.isAfter)(j,R),O=S.some(te=>(0,s.isSameDay)(te,j)),E=B(j);return n.default.createElement(t.default,c({},this.props,{ranges:_,day:j,preview:Y?this.props.preview:null,isWeekend:(0,s.isWeekend)(j,this.props.dateOptions),isToday:(0,s.isSameDay)(j,f),isStartOfWeek:(0,s.isSameDay)(j,(0,s.startOfWeek)(j,this.props.dateOptions)),isEndOfWeek:(0,s.isSameDay)(j,(0,s.endOfWeek)(j,this.props.dateOptions)),isStartOfMonth:H,isEndOfMonth:D,key:M,disabled:z||O||E,isPassive:!(0,s.isWithinInterval)(j,{start:W.startDateOfMonth,end:W.endDateOfMonth}),styles:v,onMouseDown:this.props.onDragSelectionStart,onMouseUp:this.props.onDragSelectionEnd,onMouseEnter:this.props.onDragSelectionMove,dragRange:x.range,drag:x.status}))})))}};return h.defaultProps={},h.propTypes={style:e.default.object,styles:e.default.object,month:e.default.object,drag:e.default.object,dateOptions:e.default.object,disabledDates:e.default.array,disabledDay:e.default.func,preview:e.default.shape({startDate:e.default.object,endDate:e.default.object}),showPreview:e.default.bool,displayMode:e.default.oneOf(["dateRange","date"]),minDate:e.default.object,maxDate:e.default.object,ranges:e.default.arrayOf(t.rangeShape),focusedRange:e.default.arrayOf(e.default.number),onDragSelectionStart:e.default.func,onDragSelectionEnd:e.default.func,onDragSelectionMove:e.default.func,onMouseLeave:e.default.func,monthDisplayFormat:e.default.string,weekdayDisplayFormat:e.default.string,dayDisplayFormat:e.default.string,showWeekDays:e.default.bool,showMonthName:e.default.bool,fixedHeight:e.default.bool},Fh.default=h,Fh}var Mh={},eJ;function Nie(){if(eJ)return Mh;eJ=1,Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.default=void 0;var n=o(Ar()),e=i(La()),t=i(Rg()),s=Vg();function i(m){return m&&m.__esModule?m:{default:m}}function a(m){if(typeof WeakMap!="function")return null;var f=new WeakMap,p=new WeakMap;return(a=function(b){return b?p:f})(m)}function o(m,f){if(m&&m.__esModule)return m;if(m===null||typeof m!="object"&&typeof m!="function")return{default:m};var p=a(f);if(p&&p.has(m))return p.get(m);var b={__proto__:null},x=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in m)if(v!=="default"&&Object.prototype.hasOwnProperty.call(m,v)){var S=x?Object.getOwnPropertyDescriptor(m,v):null;S&&(S.get||S.set)?Object.defineProperty(b,v,S):b[v]=m[v]}return b.default=m,p&&p.set(m,b),b}function l(m,f,p){return f=c(f),f in m?Object.defineProperty(m,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):m[f]=p,m}function c(m){var f=d(m,"string");return typeof f=="symbol"?f:String(f)}function d(m,f){if(typeof m!="object"||!m)return m;var p=m[Symbol.toPrimitive];if(p!==void 0){var b=p.call(m,f);if(typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(m)}let h=class extends n.PureComponent{constructor(f,p){super(f,p),l(this,"onKeyDown",b=>{const{value:x}=this.state;b.key==="Enter"&&this.update(x)}),l(this,"onChange",b=>{this.setState({value:b.target.value,changed:!0,invalid:!1})}),l(this,"onBlur",()=>{const{value:b}=this.state;this.update(b)}),this.state={invalid:!1,changed:!1,value:this.formatDate(f)}}componentDidUpdate(f){const{value:p}=f;(0,s.isEqual)(p,this.props.value)||this.setState({value:this.formatDate(this.props)})}formatDate(f){let{value:p,dateDisplayFormat:b,dateOptions:x}=f;return p&&(0,s.isValid)(p)?(0,s.format)(p,b,x):""}update(f){const{invalid:p,changed:b}=this.state;if(p||!b||!f)return;const{onChange:x,dateDisplayFormat:v,dateOptions:S}=this.props,B=(0,s.parse)(f,v,new Date,S);(0,s.isValid)(B)?this.setState({changed:!1},()=>x(B)):this.setState({invalid:!0})}render(){const{className:f,readOnly:p,placeholder:b,ariaLabel:x,disabled:v,onFocus:S}=this.props,{value:B,invalid:V}=this.state;return n.default.createElement("span",{className:(0,t.default)("rdrDateInput",f)},n.default.createElement("input",{readOnly:p,disabled:v,value:B,placeholder:b,"aria-label":x,onKeyDown:this.onKeyDown,onChange:this.onChange,onBlur:this.onBlur,onFocus:S}),V&&n.default.createElement("span",{className:"rdrWarning"},""))}};return h.propTypes={value:e.default.object,placeholder:e.default.string,disabled:e.default.bool,readOnly:e.default.bool,dateOptions:e.default.object,dateDisplayFormat:e.default.string,ariaLabel:e.default.string,className:e.default.string,onFocus:e.default.func.isRequired,onChange:e.default.func.isRequired},h.defaultProps={readOnly:!0,disabled:!1,dateDisplayFormat:"MMM D, YYYY"},Mh.default=h,Mh}var UC={},tJ;function kie(){return tJ||(tJ=1,(function(n){(function(e,t){t(n,Ar(),dF())})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:UC,function(e,t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function i(re){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(le){return typeof le}:function(le){return le&&typeof Symbol=="function"&&le.constructor===Symbol&&le!==Symbol.prototype?"symbol":typeof le},i(re)}function a(re,le){if(!(re instanceof le))throw new TypeError("Cannot call a class as a function")}function o(re,le){for(var ue=0;ue<le.length;ue++){var ae=le[ue];ae.enumerable=ae.enumerable||!1,ae.configurable=!0,"value"in ae&&(ae.writable=!0),Object.defineProperty(re,B(ae.key),ae)}}function l(re,le,ue){return le&&o(re.prototype,le),ue&&o(re,ue),Object.defineProperty(re,"prototype",{writable:!1}),re}function c(re,le,ue){return le=f(le),d(re,m()?Reflect.construct(le,ue||[],f(re).constructor):le.apply(re,ue))}function d(re,le){if(le&&(i(le)=="object"||typeof le=="function"))return le;if(le!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return h(re)}function h(re){if(re===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return re}function m(){try{var re=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(m=function(){return!!re})()}function f(re){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(le){return le.__proto__||Object.getPrototypeOf(le)},f(re)}function p(re,le){if(typeof le!="function"&&le!==null)throw new TypeError("Super expression must either be null or a function");re.prototype=Object.create(le&&le.prototype,{constructor:{value:re,writable:!0,configurable:!0}}),Object.defineProperty(re,"prototype",{writable:!1}),le&&b(re,le)}function b(re,le){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(ue,ae){return ue.__proto__=ae,ue},b(re,le)}function x(re,le){var ue=Object.keys(re);if(Object.getOwnPropertySymbols){var ae=Object.getOwnPropertySymbols(re);le&&(ae=ae.filter(function(Ce){return Object.getOwnPropertyDescriptor(re,Ce).enumerable})),ue.push.apply(ue,ae)}return ue}function v(re){for(var le=1;le<arguments.length;le++){var ue=arguments[le]!=null?arguments[le]:{};le%2?x(Object(ue),!0).forEach(function(ae){S(re,ae,ue[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(re,Object.getOwnPropertyDescriptors(ue)):x(Object(ue)).forEach(function(ae){Object.defineProperty(re,ae,Object.getOwnPropertyDescriptor(ue,ae))})}return re}function S(re,le,ue){return(le=B(le))in re?Object.defineProperty(re,le,{value:ue,enumerable:!0,configurable:!0,writable:!0}):re[le]=ue,re}function B(re){var le=V(re,"string");return i(le)=="symbol"?le:le+""}function V(re,le){if(i(re)!="object"||!re)return re;var ue=re[Symbol.toPrimitive];if(ue!==void 0){var ae=ue.call(re,le);if(i(ae)!="object")return ae;throw new TypeError("@@toPrimitive must return a primitive value.")}return(le==="string"?String:Number)(re)}var R={x:"clientWidth",y:"clientHeight"},W={x:"clientTop",y:"clientLeft"},_={x:"innerWidth",y:"innerHeight"},Y={x:"offsetWidth",y:"offsetHeight"},j={x:"offsetLeft",y:"offsetTop"},M={x:"overflowX",y:"overflowY"},H={x:"scrollWidth",y:"scrollHeight"},D={x:"scrollLeft",y:"scrollTop"},z={x:"width",y:"height"},O=function(){},E=(function(){if(typeof window>"u")return!1;var re=!1;try{document.createElement("div").addEventListener("test",O,{get passive(){return re=!0,!1}})}catch{}return re})()?{passive:!0}:!1,te="ReactList failed to reach a stable state.",q=40,de=function(le,ue){for(var ae in ue)if(le[ae]!==ue[ae])return!1;return!0},U=function(le){for(var ue=le.props.axis,ae=le.getEl(),Ce=M[ue];ae=ae.parentElement;)switch(window.getComputedStyle(ae)[Ce]){case"auto":case"scroll":case"overlay":return ae}return window},P=function(le){var ue=le.props.axis,ae=le.scrollParent;return ae===window?window[_[ue]]:ae[R[ue]]},ne=function(le,ue){var ae=le.length,Ce=le.minSize,ie=le.type,ge=ue.from,xe=ue.size,_e=ue.itemsPerRow;xe=Math.max(xe,Ce);var Be=xe%_e;return Be&&(xe+=_e-Be),xe>ae&&(xe=ae),ge=ie==="simple"||!ge?0:Math.max(Math.min(ge,ae-xe),0),(Be=ge%_e)&&(ge-=Be,xe+=Be),ge===ue.from&&xe===ue.size?ue:v(v({},ue),{},{from:ge,size:xe})},K=e.default=(function(re){function le(ue){var ae;return a(this,le),ae=c(this,le,[ue]),ae.state=ne(ue,{itemsPerRow:1,from:ue.initialIndex,size:0}),ae.cache={},ae.cachedScrollPosition=null,ae.prevPrevState={},ae.unstable=!1,ae.updateCounter=0,ae}return p(le,re),l(le,[{key:"componentDidMount",value:function(){this.updateFrameAndClearCache=this.updateFrameAndClearCache.bind(this),window.addEventListener("resize",this.updateFrameAndClearCache),this.updateFrame(this.scrollTo.bind(this,this.props.initialIndex))}},{key:"componentDidUpdate",value:function(ae){var Ce=this;if(this.props.axis!==ae.axis&&this.clearSizeCache(),!this.unstable){if(++this.updateCounter>q)return this.unstable=!0,console.error(te);this.updateCounterTimeoutId||(this.updateCounterTimeoutId=setTimeout(function(){Ce.updateCounter=0,delete Ce.updateCounterTimeoutId},0)),this.updateFrame()}}},{key:"maybeSetState",value:function(ae,Ce){if(de(this.state,ae))return Ce();this.setState(ae,Ce)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateFrameAndClearCache),this.scrollParent.removeEventListener("scroll",this.updateFrameAndClearCache,E),this.scrollParent.removeEventListener("mousewheel",O,E)}},{key:"getOffset",value:function(ae){var Ce=this.props.axis,ie=ae[W[Ce]]||0,ge=j[Ce];do ie+=ae[ge]||0;while(ae=ae.offsetParent);return ie}},{key:"getEl",value:function(){return this.el||this.items}},{key:"getScrollPosition",value:function(){if(typeof this.cachedScrollPosition=="number")return this.cachedScrollPosition;var ae=this.scrollParent,Ce=this.props.axis,ie=D[Ce],ge=ae===window?document.body[ie]||document.documentElement[ie]:ae[ie],xe=this.getScrollSize()-this.props.scrollParentViewportSizeGetter(this),_e=Math.max(0,Math.min(ge,xe)),Be=this.getEl();return this.cachedScrollPosition=this.getOffset(ae)+_e-this.getOffset(Be),this.cachedScrollPosition}},{key:"setScroll",value:function(ae){var Ce=this.scrollParent,ie=this.props.axis;if(ae+=this.getOffset(this.getEl()),Ce===window)return window.scrollTo(0,ae);ae-=this.getOffset(this.scrollParent),Ce[D[ie]]=ae}},{key:"getScrollSize",value:function(){var ae=this.scrollParent,Ce=document,ie=Ce.body,ge=Ce.documentElement,xe=H[this.props.axis];return ae===window?Math.max(ie[xe],ge[xe]):ae[xe]}},{key:"hasDeterminateSize",value:function(){var ae=this.props,Ce=ae.itemSizeGetter,ie=ae.type;return ie==="uniform"||Ce}},{key:"getStartAndEnd",value:function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.threshold,Ce=this.getScrollPosition(),ie=Math.max(0,Ce-ae),ge=Ce+this.props.scrollParentViewportSizeGetter(this)+ae;return this.hasDeterminateSize()&&(ge=Math.min(ge,this.getSpaceBefore(this.props.length))),{start:ie,end:ge}}},{key:"getItemSizeAndItemsPerRow",value:function(){var ae=this.props,Ce=ae.axis,ie=ae.useStaticSize,ge=this.state,xe=ge.itemSize,_e=ge.itemsPerRow;if(ie&&xe&&_e)return{itemSize:xe,itemsPerRow:_e};var Be=this.items.children;if(!Be.length)return{};var Se=Be[0],Re=Se[Y[Ce]],Ye=Math.abs(Re-xe);if((isNaN(Ye)||Ye>=1)&&(xe=Re),!xe)return{};var De=j[Ce],Me=Se[De];_e=1;for(var Le=Be[_e];Le&&Le[De]===Me;Le=Be[_e])++_e;return{itemSize:xe,itemsPerRow:_e}}},{key:"clearSizeCache",value:function(){this.cachedScrollPosition=null}},{key:"updateFrameAndClearCache",value:function(ae){return this.clearSizeCache(),this.updateFrame(ae)}},{key:"updateFrame",value:function(ae){switch(this.updateScrollParent(),typeof ae!="function"&&(ae=O),this.props.type){case"simple":return this.updateSimpleFrame(ae);case"variable":return this.updateVariableFrame(ae);case"uniform":return this.updateUniformFrame(ae)}}},{key:"updateScrollParent",value:function(){var ae=this.scrollParent;this.scrollParent=this.props.scrollParentGetter(this),ae!==this.scrollParent&&(ae&&(ae.removeEventListener("scroll",this.updateFrameAndClearCache),ae.removeEventListener("mousewheel",O)),this.clearSizeCache(),this.scrollParent.addEventListener("scroll",this.updateFrameAndClearCache,E),this.scrollParent.addEventListener("mousewheel",O,E))}},{key:"updateSimpleFrame",value:function(ae){var Ce=this.getStartAndEnd(),ie=Ce.end,ge=this.items.children,xe=0;if(ge.length){var _e=this.props.axis,Be=ge[0],Se=ge[ge.length-1];xe=this.getOffset(Se)+Se[Y[_e]]-this.getOffset(Be)}if(xe>ie)return ae();var Re=this.props,Ye=Re.pageSize,De=Re.length,Me=Math.min(this.state.size+Ye,De);this.maybeSetState({size:Me},ae)}},{key:"updateVariableFrame",value:function(ae){this.props.itemSizeGetter||this.cacheSizes();for(var Ce=this.getStartAndEnd(),ie=Ce.start,ge=Ce.end,xe=this.props,_e=xe.length,Be=xe.pageSize,Se=0,Re=0,Ye=0,De=_e-1;Re<De;){var Me=this.getSizeOfItem(Re);if(Me==null||Se+Me>ie)break;Se+=Me,++Re}for(var Le=_e-Re;Ye<Le&&Se<ge;){var nt=this.getSizeOfItem(Re+Ye);if(nt==null){Ye=Math.min(Ye+Be,Le);break}Se+=nt,++Ye}this.maybeSetState(ne(this.props,{from:Re,itemsPerRow:1,size:Ye}),ae)}},{key:"updateUniformFrame",value:function(ae){var Ce=this.getItemSizeAndItemsPerRow(),ie=Ce.itemSize,ge=Ce.itemsPerRow;if(!ie||!ge)return ae();var xe=this.getStartAndEnd(),_e=xe.start,Be=xe.end,Se=ne(this.props,{from:Math.floor(_e/ie)*ge,size:(Math.ceil((Be-_e)/ie)+1)*ge,itemsPerRow:ge}),Re=Se.from,Ye=Se.size;return this.maybeSetState({itemsPerRow:ge,from:Re,itemSize:ie,size:Ye},ae)}},{key:"getSpaceBefore",value:function(ae){var Ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ce[ae]!=null)return Ce[ae];var ie=this.state,ge=ie.itemSize,xe=ie.itemsPerRow;if(ge)return Ce[ae]=Math.floor(ae/xe)*ge;for(var _e=ae;_e>0&&Ce[--_e]==null;);for(var Be=Ce[_e]||0,Se=_e;Se<ae;++Se){Ce[Se]=Be;var Re=this.getSizeOfItem(Se);if(Re==null)break;Be+=Re}return Ce[ae]=Be}},{key:"cacheSizes",value:function(){for(var ae=this.cache,Ce=this.state.from,ie=this.items.children,ge=Y[this.props.axis],xe=0,_e=ie.length;xe<_e;++xe)ae[Ce+xe]=ie[xe][ge]}},{key:"getSizeOfItem",value:function(ae){var Ce=this.cache,ie=this.items,ge=this.props,xe=ge.axis,_e=ge.itemSizeGetter,Be=ge.itemSizeEstimator,Se=ge.type,Re=this.state,Ye=Re.from,De=Re.itemSize,Me=Re.size;if(De)return De;if(_e)return _e(ae);if(ae in Ce)return Ce[ae];if(Se==="simple"&&ae>=Ye&&ae<Ye+Me&&ie){var Le=ie.children[ae-Ye];if(Le)return Le[Y[xe]]}if(Be)return Be(ae,Ce)}},{key:"scrollTo",value:function(ae){ae!=null&&this.setScroll(this.getSpaceBefore(ae))}},{key:"scrollAround",value:function(ae){var Ce=this.getScrollPosition(),ie=this.getSpaceBefore(ae),ge=ie-this.props.scrollParentViewportSizeGetter(this)+this.getSizeOfItem(ae),xe=Math.min(ge,ie),_e=Math.max(ge,ie);if(Ce<=xe)return this.setScroll(xe);if(Ce>_e)return this.setScroll(_e)}},{key:"getVisibleRange",value:function(){for(var ae=this.state,Ce=ae.from,ie=ae.size,ge=this.getStartAndEnd(0),xe=ge.start,_e=ge.end,Be={},Se,Re,Ye=Ce;Ye<Ce+ie;++Ye){var De=this.getSpaceBefore(Ye,Be),Me=De+this.getSizeOfItem(Ye);Se==null&&Me>xe&&(Se=Ye),Se!=null&&De<_e&&(Re=Ye)}return[Se,Re]}},{key:"renderItems",value:function(){for(var ae=this,Ce=this.props,ie=Ce.itemRenderer,ge=Ce.itemsRenderer,xe=this.state,_e=xe.from,Be=xe.size,Se=[],Re=0;Re<Be;++Re)Se.push(ie(_e+Re,Re));return ge(Se,function(Ye){return ae.items=Ye})}},{key:"render",value:function(){var ae=this,Ce=this.props,ie=Ce.axis,ge=Ce.length,xe=Ce.type,_e=Ce.useTranslate3d,Be=this.state,Se=Be.from,Re=Be.itemsPerRow,Ye=this.renderItems();if(xe==="simple")return Ye;var De={position:"relative"},Me={},Le=Math.ceil(ge/Re)*Re,nt=this.getSpaceBefore(Le,Me);nt&&(De[z[ie]]=nt,ie==="x"&&(De.overflowX="hidden"));var st=this.getSpaceBefore(Se,Me),ee=ie==="x"?st:0,oe=ie==="y"?st:0,Ie=_e?"translate3d(".concat(ee,"px, ").concat(oe,"px, 0)"):"translate(".concat(ee,"px, ").concat(oe,"px)"),Ne={msTransform:Ie,WebkitTransform:Ie,transform:Ie};return(0,s.jsx)("div",{style:De,ref:function(je){return ae.el=je},children:(0,s.jsx)("div",{style:Ne,children:Ye})})}}],[{key:"getDerivedStateFromProps",value:function(ae,Ce){var ie=ne(ae,Ce);return ie===Ce?null:ie}}])})(t.Component);S(K,"displayName","ReactList"),S(K,"defaultProps",{axis:"y",itemRenderer:function(le,ue){return(0,s.jsx)("div",{children:le},ue)},itemsRenderer:function(le,ue){return(0,s.jsx)("div",{ref:ue,children:le})},length:0,minSize:1,pageSize:10,scrollParentGetter:U,scrollParentViewportSizeGetter:P,threshold:100,type:"simple",useStaticSize:!1,useTranslate3d:!1})})})(UC)),UC}function Rie(n,e){if(n===e)return!0;if(!n||!e)return!1;var t=Object.keys(n),s=Object.keys(e),i=t.length;if(s.length!==i)return!1;for(var a=0;a<i;a++){var o=t[a];if(n[o]!==e[o]||!Object.prototype.hasOwnProperty.call(e,o))return!1}return!0}function Wie(n,e){if(n===e)return!0;if(!n||!e)return!1;var t=n.length;if(e.length!==t)return!1;for(var s=0;s<t;s++)if(n[s]!==e[s])return!1;return!0}const Vie=Object.freeze(Object.defineProperty({__proto__:null,shallowEqualArrays:Wie,shallowEqualObjects:Rie},Symbol.toStringTag,{value:"Module"})),_ie=cF(Vie);var Hh={},nJ;function Dp(){return nJ||(nJ=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.default=void 0,Hh.default={dateRangeWrapper:"rdrDateRangeWrapper",calendarWrapper:"rdrCalendarWrapper",dateDisplay:"rdrDateDisplay",dateDisplayItem:"rdrDateDisplayItem",dateDisplayItemActive:"rdrDateDisplayItemActive",monthAndYearWrapper:"rdrMonthAndYearWrapper",monthAndYearPickers:"rdrMonthAndYearPickers",nextPrevButton:"rdrNextPrevButton",month:"rdrMonth",weekDays:"rdrWeekDays",weekDay:"rdrWeekDay",days:"rdrDays",day:"rdrDay",dayNumber:"rdrDayNumber",dayPassive:"rdrDayPassive",dayToday:"rdrDayToday",dayStartOfWeek:"rdrDayStartOfWeek",dayEndOfWeek:"rdrDayEndOfWeek",daySelected:"rdrDaySelected",dayDisabled:"rdrDayDisabled",dayStartOfMonth:"rdrDayStartOfMonth",dayEndOfMonth:"rdrDayEndOfMonth",dayWeekend:"rdrDayWeekend",dayStartPreview:"rdrDayStartPreview",dayInPreview:"rdrDayInPreview",dayEndPreview:"rdrDayEndPreview",dayHovered:"rdrDayHovered",dayActive:"rdrDayActive",inRange:"rdrInRange",endEdge:"rdrEndEdge",startEdge:"rdrStartEdge",prevButton:"rdrPprevButton",nextButton:"rdrNextButton",selected:"rdrSelected",months:"rdrMonths",monthPicker:"rdrMonthPicker",yearPicker:"rdrYearPicker",dateDisplayWrapper:"rdrDateDisplayWrapper",definedRangesWrapper:"rdrDefinedRangesWrapper",staticRanges:"rdrStaticRanges",staticRange:"rdrStaticRange",inputRanges:"rdrInputRanges",inputRange:"rdrInputRange",inputRangeInput:"rdrInputRangeInput",dateRangePickerWrapper:"rdrDateRangePickerWrapper",staticRangeLabel:"rdrStaticRangeLabel",staticRangeSelected:"rdrStaticRangeSelected",monthName:"rdrMonthName",infiniteMonths:"rdrInfiniteMonths",monthsVertical:"rdrMonthsVertical",monthsHorizontal:"rdrMonthsHorizontal"}),Hh}var Th={},sJ;function jie(){if(sJ)return Th;sJ=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.ariaLabelsShape=void 0;var n=e(La());function e(t){return t&&t.__esModule?t:{default:t}}return Th.ariaLabelsShape=n.default.shape({dateInput:n.default.objectOf(n.default.shape({startDate:n.default.string,endDate:n.default.string})),monthPicker:n.default.string,yearPicker:n.default.string,prevButton:n.default.string,nextButton:n.default.string}),Th}var rJ;function aE(){if(rJ)return Jh;rJ=1,Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.default=void 0;var n=x(Ar()),e=p(La()),t=Tp(),s=p(Bie()),i=p(Nie()),a=Ep(),o=p(Rg()),l=p(kie()),c=_ie,d=Vg(),h=NT(),m=p(Dp()),f=jie();function p(W){return W&&W.__esModule?W:{default:W}}function b(W){if(typeof WeakMap!="function")return null;var _=new WeakMap,Y=new WeakMap;return(b=function(j){return j?Y:_})(W)}function x(W,_){if(W&&W.__esModule)return W;if(W===null||typeof W!="object"&&typeof W!="function")return{default:W};var Y=b(_);if(Y&&Y.has(W))return Y.get(W);var j={__proto__:null},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in W)if(H!=="default"&&Object.prototype.hasOwnProperty.call(W,H)){var D=M?Object.getOwnPropertyDescriptor(W,H):null;D&&(D.get||D.set)?Object.defineProperty(j,H,D):j[H]=W[H]}return j.default=W,Y&&Y.set(W,j),j}function v(){return v=Object.assign?Object.assign.bind():function(W){for(var _=1;_<arguments.length;_++){var Y=arguments[_];for(var j in Y)Object.prototype.hasOwnProperty.call(Y,j)&&(W[j]=Y[j])}return W},v.apply(this,arguments)}function S(W,_,Y){return _=B(_),_ in W?Object.defineProperty(W,_,{value:Y,enumerable:!0,configurable:!0,writable:!0}):W[_]=Y,W}function B(W){var _=V(W,"string");return typeof _=="symbol"?_:String(_)}function V(W,_){if(typeof W!="object"||!W)return W;var Y=W[Symbol.toPrimitive];if(Y!==void 0){var j=Y.call(W,_);if(typeof j!="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(W)}let R=class wZ extends n.PureComponent{constructor(_,Y){var j;super(_,Y),j=this,S(this,"focusToDate",function(M){let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:j.props,D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!H.scroll.enabled){if(D&&H.preventSnapRefocus){const E=(0,d.differenceInCalendarMonths)(M,j.state.focusedDate),te=H.calendarFocus==="forwards"&&E>=0,q=H.calendarFocus==="backwards"&&E<=0;if((te||q)&&Math.abs(E)<H.months)return}j.setState({focusedDate:M});return}const z=(0,d.differenceInCalendarMonths)(M,H.minDate,j.dateOptions),O=j.list.getVisibleRange();D&&O.includes(z)||(j.isFirstRender=!0,j.list.scrollTo(z),j.setState({focusedDate:M}))}),S(this,"updateShownDate",function(){let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j.props;const H=M.scroll.enabled?{...M,months:j.list.getVisibleRange().length}:M,D=(0,a.calcFocusDate)(j.state.focusedDate,H);j.focusToDate(D,H)}),S(this,"updatePreview",M=>{if(!M){this.setState({preview:null});return}const H={startDate:M,endDate:M,color:this.props.color};this.setState({preview:H})}),S(this,"changeShownDate",function(M){let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"set";const{focusedDate:D}=j.state,{onShownDateChange:z,minDate:O,maxDate:E}=j.props,te={monthOffset:()=>(0,d.addMonths)(D,M),setMonth:()=>(0,d.setMonth)(D,M),setYear:()=>(0,d.setYear)(D,M),set:()=>M},q=(0,d.min)([(0,d.max)([te[H](),O]),E]);j.focusToDate(q,j.props,!1),z&&z(q)}),S(this,"handleRangeFocusChange",(M,H)=>{this.props.onRangeFocusChange&&this.props.onRangeFocusChange([M,H])}),S(this,"handleScroll",()=>{const{onShownDateChange:M,minDate:H}=this.props,{focusedDate:D}=this.state,{isFirstRender:z}=this,O=this.list.getVisibleRange();if(O[0]===void 0)return;const E=(0,d.addMonths)(H,O[0]||0);!(0,d.isSameMonth)(E,D)&&!z&&(this.setState({focusedDate:E}),M&&M(E)),this.isFirstRender=!1}),S(this,"renderMonthAndYear",(M,H,D)=>{const{showMonthArrow:z,minDate:O,maxDate:E,showMonthAndYearPickers:te,ariaLabels:q}=D,de=(E||wZ.defaultProps.maxDate).getFullYear(),U=(O||wZ.defaultProps.minDate).getFullYear(),P=this.styles;return n.default.createElement("div",{onMouseUp:ne=>ne.stopPropagation(),className:P.monthAndYearWrapper},z?n.default.createElement("button",{type:"button",className:(0,o.default)(P.nextPrevButton,P.prevButton),onClick:()=>H(-1,"monthOffset"),"aria-label":q.prevButton},n.default.createElement("i",null)):null,te?n.default.createElement("span",{className:P.monthAndYearPickers},n.default.createElement("span",{className:P.monthPicker},n.default.createElement("select",{value:M.getMonth(),onChange:ne=>H(ne.target.value,"setMonth"),"aria-label":q.monthPicker},this.state.monthNames.map((ne,K)=>n.default.createElement("option",{key:K,value:K},ne)))),n.default.createElement("span",{className:P.monthAndYearDivider}),n.default.createElement("span",{className:P.yearPicker},n.default.createElement("select",{value:M.getFullYear(),onChange:ne=>H(ne.target.value,"setYear"),"aria-label":q.yearPicker},new Array(de-U+1).fill(de).map((ne,K)=>{const re=ne-K;return n.default.createElement("option",{key:re,value:re},re)})))):n.default.createElement("span",{className:P.monthAndYearPickers},this.state.monthNames[M.getMonth()]," ",M.getFullYear()),z?n.default.createElement("button",{type:"button",className:(0,o.default)(P.nextPrevButton,P.nextButton),onClick:()=>H(1,"monthOffset"),"aria-label":q.nextButton},n.default.createElement("i",null)):null)}),S(this,"renderDateDisplay",()=>{const{focusedRange:M,color:H,ranges:D,rangeColors:z,dateDisplayFormat:O,editableDateInputs:E,startDatePlaceholder:te,endDatePlaceholder:q,ariaLabels:de}=this.props,U=z[M[0]]||H,P=this.styles;return n.default.createElement("div",{className:P.dateDisplayWrapper},D.map((ne,K)=>ne.showDateDisplay===!1||ne.disabled&&!ne.showDateDisplay?null:n.default.createElement("div",{className:P.dateDisplay,key:K,style:{color:ne.color||U}},n.default.createElement(i.default,{className:(0,o.default)(P.dateDisplayItem,{[P.dateDisplayItemActive]:M[0]===K&&M[1]===0}),readOnly:!E,disabled:ne.disabled,value:ne.startDate,placeholder:te,dateOptions:this.dateOptions,dateDisplayFormat:O,ariaLabel:de.dateInput&&de.dateInput[ne.key]&&de.dateInput[ne.key].startDate,onChange:this.onDragSelectionEnd,onFocus:()=>this.handleRangeFocusChange(K,0)}),n.default.createElement(i.default,{className:(0,o.default)(P.dateDisplayItem,{[P.dateDisplayItemActive]:M[0]===K&&M[1]===1}),readOnly:!E,disabled:ne.disabled,value:ne.endDate,placeholder:q,dateOptions:this.dateOptions,dateDisplayFormat:O,ariaLabel:de.dateInput&&de.dateInput[ne.key]&&de.dateInput[ne.key].endDate,onChange:this.onDragSelectionEnd,onFocus:()=>this.handleRangeFocusChange(K,1)}))))}),S(this,"onDragSelectionStart",M=>{const{onChange:H,dragSelectionEnabled:D}=this.props;D?this.setState({drag:{status:!0,range:{startDate:M,endDate:M},disablePreview:!0}}):H&&H(M)}),S(this,"onDragSelectionEnd",M=>{const{updateRange:H,displayMode:D,onChange:z,dragSelectionEnabled:O}=this.props;if(!O)return;if(D==="date"||!this.state.drag.status){z&&z(M);return}const E={startDate:this.state.drag.range.startDate,endDate:M};D!=="dateRange"||(0,d.isSameDay)(E.startDate,M)?this.setState({drag:{status:!1,range:{}}},()=>z&&z(M)):this.setState({drag:{status:!1,range:{}}},()=>{H&&H(E)})}),S(this,"onDragSelectionMove",M=>{const{drag:H}=this.state;!H.status||!this.props.dragSelectionEnabled||this.setState({drag:{status:H.status,range:{startDate:H.range.startDate,endDate:M},disablePreview:!0}})}),S(this,"estimateMonthSize",(M,H)=>{const{direction:D,minDate:z}=this.props,{scrollArea:O}=this.state;if(H&&(this.listSizeCache=H,H[M]))return H[M];if(D==="horizontal")return O.monthWidth;const E=(0,d.addMonths)(z,M),{start:te,end:q}=(0,a.getMonthDisplayRange)(E,this.dateOptions);return(0,d.differenceInDays)(q,te,this.dateOptions)+1>35?O.longMonthHeight:O.monthHeight}),this.dateOptions={locale:_.locale},_.weekStartsOn!==void 0&&(this.dateOptions.weekStartsOn=_.weekStartsOn),this.styles=(0,a.generateStyles)([m.default,_.classNames]),this.listSizeCache={},this.isFirstRender=!0,this.state={monthNames:this.getMonthNames(),focusedDate:(0,a.calcFocusDate)(null,_),drag:{status:!1,range:{startDate:null,endDate:null},disablePreview:!1},scrollArea:this.calcScrollArea(_)}}getMonthNames(){return[...Array(12).keys()].map(_=>this.props.locale.localize.month(_))}calcScrollArea(_){const{direction:Y,months:j,scroll:M}=_;if(!M.enabled)return{enabled:!1};const H=M.longMonthHeight||M.monthHeight;return Y==="vertical"?{enabled:!0,monthHeight:M.monthHeight||220,longMonthHeight:H||260,calendarWidth:"auto",calendarHeight:(M.calendarHeight||H||240)*j}:{enabled:!0,monthWidth:M.monthWidth||332,calendarWidth:(M.calendarWidth||M.monthWidth||332)*j,monthHeight:H||300,calendarHeight:H||300}}componentDidMount(){this.props.scroll.enabled&&setTimeout(()=>this.focusToDate(this.state.focusedDate))}componentDidUpdate(_){const j={dateRange:"ranges",date:"date"}[this.props.displayMode];this.props[j]!==_[j]&&this.updateShownDate(this.props),(_.locale!==this.props.locale||_.weekStartsOn!==this.props.weekStartsOn)&&(this.dateOptions={locale:this.props.locale},this.props.weekStartsOn!==void 0&&(this.dateOptions.weekStartsOn=this.props.weekStartsOn),this.setState({monthNames:this.getMonthNames()})),(0,c.shallowEqualObjects)(_.scroll,this.props.scroll)||this.setState({scrollArea:this.calcScrollArea(this.props)})}renderWeekdays(){const _=new Date;return n.default.createElement("div",{className:this.styles.weekDays},(0,d.eachDayOfInterval)({start:(0,d.startOfWeek)(_,this.dateOptions),end:(0,d.endOfWeek)(_,this.dateOptions)}).map((Y,j)=>n.default.createElement("span",{className:this.styles.weekDay,key:j},(0,d.format)(Y,this.props.weekdayDisplayFormat,this.dateOptions))))}render(){const{showDateDisplay:_,onPreviewChange:Y,scroll:j,direction:M,disabledDates:H,disabledDay:D,maxDate:z,minDate:O,rangeColors:E,color:te,navigatorRenderer:q,className:de,preview:U}=this.props,{scrollArea:P,focusedDate:ne}=this.state,K=M==="vertical",re=q||this.renderMonthAndYear,le=this.props.ranges.map((ue,ae)=>({...ue,color:ue.color||E[ae]||te}));return n.default.createElement("div",{className:(0,o.default)(this.styles.calendarWrapper,de),onMouseUp:()=>this.setState({drag:{status:!1,range:{}}}),onMouseLeave:()=>{this.setState({drag:{status:!1,range:{}}})}},_&&this.renderDateDisplay(),re(ne,this.changeShownDate,this.props),j.enabled?n.default.createElement("div",null,K&&this.renderWeekdays(this.dateOptions),n.default.createElement("div",{className:(0,o.default)(this.styles.infiniteMonths,K?this.styles.monthsVertical:this.styles.monthsHorizontal),onMouseLeave:()=>Y&&Y(),style:{width:P.calendarWidth+11,height:P.calendarHeight+11},onScroll:this.handleScroll},n.default.createElement(l.default,{length:(0,d.differenceInCalendarMonths)((0,d.endOfMonth)(z),(0,d.addDays)((0,d.startOfMonth)(O),-1),this.dateOptions),treshold:500,type:"variable",ref:ue=>this.list=ue,itemSizeEstimator:this.estimateMonthSize,axis:K?"y":"x",itemRenderer:(ue,ae)=>{const Ce=(0,d.addMonths)(O,ue);return n.default.createElement(s.default,v({},this.props,{onPreviewChange:Y||this.updatePreview,preview:U||this.state.preview,ranges:le,key:ae,drag:this.state.drag,dateOptions:this.dateOptions,disabledDates:H,disabledDay:D,month:Ce,onDragSelectionStart:this.onDragSelectionStart,onDragSelectionEnd:this.onDragSelectionEnd,onDragSelectionMove:this.onDragSelectionMove,onMouseLeave:()=>Y&&Y(),styles:this.styles,style:K?{height:this.estimateMonthSize(ue)}:{height:P.monthHeight,width:this.estimateMonthSize(ue)},showMonthName:!0,showWeekDays:!K}))}}))):n.default.createElement("div",{className:(0,o.default)(this.styles.months,K?this.styles.monthsVertical:this.styles.monthsHorizontal)},new Array(this.props.months).fill(null).map((ue,ae)=>{let Ce=(0,d.addMonths)(this.state.focusedDate,ae);return this.props.calendarFocus==="backwards"&&(Ce=(0,d.subMonths)(this.state.focusedDate,this.props.months-1-ae)),n.default.createElement(s.default,v({},this.props,{onPreviewChange:Y||this.updatePreview,preview:U||this.state.preview,ranges:le,key:ae,drag:this.state.drag,dateOptions:this.dateOptions,disabledDates:H,disabledDay:D,month:Ce,onDragSelectionStart:this.onDragSelectionStart,onDragSelectionEnd:this.onDragSelectionEnd,onDragSelectionMove:this.onDragSelectionMove,onMouseLeave:()=>Y&&Y(),styles:this.styles,showWeekDays:!K||ae===0,showMonthName:!K||ae>0}))})))}};return R.defaultProps={showMonthArrow:!0,showMonthAndYearPickers:!0,disabledDates:[],disabledDay:()=>{},classNames:{},locale:h.enUS,ranges:[],focusedRange:[0,0],dateDisplayFormat:"MMM d, yyyy",monthDisplayFormat:"MMM yyyy",weekdayDisplayFormat:"E",dayDisplayFormat:"d",showDateDisplay:!0,showPreview:!0,displayMode:"date",months:1,color:"#3d91ff",scroll:{enabled:!1},direction:"vertical",maxDate:(0,d.addYears)(new Date,20),minDate:(0,d.addYears)(new Date,-100),rangeColors:["#3d91ff","#3ecf8e","#fed14c"],startDatePlaceholder:"Early",endDatePlaceholder:"Continuous",editableDateInputs:!1,dragSelectionEnabled:!0,fixedHeight:!1,calendarFocus:"forwards",preventSnapRefocus:!1,ariaLabels:{}},R.propTypes={showMonthArrow:e.default.bool,showMonthAndYearPickers:e.default.bool,disabledDates:e.default.array,disabledDay:e.default.func,minDate:e.default.object,maxDate:e.default.object,date:e.default.object,onChange:e.default.func,onPreviewChange:e.default.func,onRangeFocusChange:e.default.func,classNames:e.default.object,locale:e.default.object,shownDate:e.default.object,onShownDateChange:e.default.func,ranges:e.default.arrayOf(t.rangeShape),preview:e.default.shape({startDate:e.default.object,endDate:e.default.object,color:e.default.string}),dateDisplayFormat:e.default.string,monthDisplayFormat:e.default.string,weekdayDisplayFormat:e.default.string,weekStartsOn:e.default.number,dayDisplayFormat:e.default.string,focusedRange:e.default.arrayOf(e.default.number),initialFocusedRange:e.default.arrayOf(e.default.number),months:e.default.number,className:e.default.string,showDateDisplay:e.default.bool,showPreview:e.default.bool,displayMode:e.default.oneOf(["dateRange","date"]),color:e.default.string,updateRange:e.default.func,scroll:e.default.shape({enabled:e.default.bool,monthHeight:e.default.number,longMonthHeight:e.default.number,monthWidth:e.default.number,calendarWidth:e.default.number,calendarHeight:e.default.number}),direction:e.default.oneOf(["vertical","horizontal"]),startDatePlaceholder:e.default.string,endDatePlaceholder:e.default.string,navigatorRenderer:e.default.func,rangeColors:e.default.arrayOf(e.default.string),editableDateInputs:e.default.bool,dragSelectionEnabled:e.default.bool,fixedHeight:e.default.bool,calendarFocus:e.default.string,preventSnapRefocus:e.default.bool,ariaLabels:f.ariaLabelsShape},Jh.default=R,Jh}var iJ;function oE(){if(iJ)return Xh;iJ=1,Object.defineProperty(Xh,"__esModule",{value:!0}),Xh.default=void 0;var n=h(Ar()),e=c(La()),t=c(aE()),s=Tp(),i=Ep(),a=Vg(),o=c(Rg()),l=c(Dp());function c(v){return v&&v.__esModule?v:{default:v}}function d(v){if(typeof WeakMap!="function")return null;var S=new WeakMap,B=new WeakMap;return(d=function(V){return V?B:S})(v)}function h(v,S){if(v&&v.__esModule)return v;if(v===null||typeof v!="object"&&typeof v!="function")return{default:v};var B=d(S);if(B&&B.has(v))return B.get(v);var V={__proto__:null},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in v)if(W!=="default"&&Object.prototype.hasOwnProperty.call(v,W)){var _=R?Object.getOwnPropertyDescriptor(v,W):null;_&&(_.get||_.set)?Object.defineProperty(V,W,_):V[W]=v[W]}return V.default=v,B&&B.set(v,V),V}function m(){return m=Object.assign?Object.assign.bind():function(v){for(var S=1;S<arguments.length;S++){var B=arguments[S];for(var V in B)Object.prototype.hasOwnProperty.call(B,V)&&(v[V]=B[V])}return v},m.apply(this,arguments)}function f(v,S,B){return S=p(S),S in v?Object.defineProperty(v,S,{value:B,enumerable:!0,configurable:!0,writable:!0}):v[S]=B,v}function p(v){var S=b(v,"string");return typeof S=="symbol"?S:String(S)}function b(v,S){if(typeof v!="object"||!v)return v;var B=v[Symbol.toPrimitive];if(B!==void 0){var V=B.call(v,S);if(typeof V!="object")return V;throw new TypeError("@@toPrimitive must return a primitive value.")}return(S==="string"?String:Number)(v)}let x=class extends n.Component{constructor(S,B){var V;super(S,B),V=this,f(this,"calcNewSelection",function(R){let W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const _=V.props.focusedRange||V.state.focusedRange,{ranges:Y,onChange:j,maxDate:M,moveRangeOnFirstSelection:H,retainEndDateOnFirstSelection:D,disabledDates:z}=V.props,O=_[0],E=Y[O];if(!E||!j)return{};let{startDate:te,endDate:q}=E;const de=new Date;let U;if(!W)te=R.startDate,q=R.endDate;else if(_[1]===0){const K=(0,a.differenceInCalendarDays)(q||de,te),re=()=>H?(0,a.addDays)(R,K):D?!q||(0,a.isBefore)(R,q)?q:R:R||de;te=R,q=re(),M&&(q=(0,a.min)([q,M])),U=[_[0],1]}else q=R;let P=_[1]===0;(0,a.isBefore)(q,te)&&(P=!P,[te,q]=[q,te]);const ne=z.filter(K=>(0,a.isWithinInterval)(K,{start:te,end:q}));return ne.length>0&&(P?te=(0,a.addDays)((0,a.max)(ne),1):q=(0,a.addDays)((0,a.min)(ne),-1)),U||(U=[(0,i.findNextRangeIndex)(V.props.ranges,_[0]),0]),{wasValid:!(ne.length>0),range:{startDate:te,endDate:q},nextFocusRange:U}}),f(this,"setSelection",(R,W)=>{const{onChange:_,ranges:Y,onRangeFocusChange:j}=this.props,H=(this.props.focusedRange||this.state.focusedRange)[0],D=Y[H];if(!D)return;const z=this.calcNewSelection(R,W);_({[D.key||`range${H+1}`]:{...D,...z.range}}),this.setState({focusedRange:z.nextFocusRange,preview:null}),j&&j(z.nextFocusRange)}),f(this,"handleRangeFocusChange",R=>{this.setState({focusedRange:R}),this.props.onRangeFocusChange&&this.props.onRangeFocusChange(R)}),f(this,"updatePreview",R=>{if(!R){this.setState({preview:null});return}const{rangeColors:W,ranges:_}=this.props,Y=this.props.focusedRange||this.state.focusedRange,j=_[Y[0]]?.color||W[Y[0]]||j;this.setState({preview:{...R.range,color:j}})}),this.state={focusedRange:S.initialFocusedRange||[(0,i.findNextRangeIndex)(S.ranges),0],preview:null},this.styles=(0,i.generateStyles)([l.default,S.classNames])}render(){return n.default.createElement(t.default,m({focusedRange:this.state.focusedRange,onRangeFocusChange:this.handleRangeFocusChange,preview:this.state.preview,onPreviewChange:S=>{this.updatePreview(S?this.calcNewSelection(S):null)}},this.props,{displayMode:"dateRange",className:(0,o.default)(this.styles.dateRangeWrapper,this.props.className),onChange:this.setSelection,updateRange:S=>this.setSelection(S,!1),ref:S=>{this.calendar=S}}))}};return x.defaultProps={classNames:{},ranges:[],moveRangeOnFirstSelection:!1,retainEndDateOnFirstSelection:!1,rangeColors:["#3d91ff","#3ecf8e","#fed14c"],disabledDates:[]},x.propTypes={...t.default.propTypes,onChange:e.default.func,onRangeFocusChange:e.default.func,className:e.default.string,ranges:e.default.arrayOf(s.rangeShape),moveRangeOnFirstSelection:e.default.bool,retainEndDateOnFirstSelection:e.default.bool},Xh.default=x,Xh}var Eh={},Dh={},Jc={},aJ;function lE(){if(aJ)return Jc;aJ=1,Object.defineProperty(Jc,"__esModule",{value:!0}),Jc.createStaticRanges=s,Jc.defaultStaticRanges=Jc.defaultInputRanges=void 0;var n=Vg();const e={startOfWeek:(0,n.startOfWeek)(new Date),endOfWeek:(0,n.endOfWeek)(new Date),startOfLastWeek:(0,n.startOfWeek)((0,n.addDays)(new Date,-7)),endOfLastWeek:(0,n.endOfWeek)((0,n.addDays)(new Date,-7)),startOfToday:(0,n.startOfDay)(new Date),endOfToday:(0,n.endOfDay)(new Date),startOfYesterday:(0,n.startOfDay)((0,n.addDays)(new Date,-1)),endOfYesterday:(0,n.endOfDay)((0,n.addDays)(new Date,-1)),startOfMonth:(0,n.startOfMonth)(new Date),endOfMonth:(0,n.endOfMonth)(new Date),startOfLastMonth:(0,n.startOfMonth)((0,n.addMonths)(new Date,-1)),endOfLastMonth:(0,n.endOfMonth)((0,n.addMonths)(new Date,-1))},t={range:{},isSelected(i){const a=this.range();return(0,n.isSameDay)(i.startDate,a.startDate)&&(0,n.isSameDay)(i.endDate,a.endDate)}};function s(i){return i.map(a=>({...t,...a}))}return Jc.defaultStaticRanges=s([{label:"Today",range:()=>({startDate:e.startOfToday,endDate:e.endOfToday})},{label:"Yesterday",range:()=>({startDate:e.startOfYesterday,endDate:e.endOfYesterday})},{label:"This Week",range:()=>({startDate:e.startOfWeek,endDate:e.endOfWeek})},{label:"Last Week",range:()=>({startDate:e.startOfLastWeek,endDate:e.endOfLastWeek})},{label:"This Month",range:()=>({startDate:e.startOfMonth,endDate:e.endOfMonth})},{label:"Last Month",range:()=>({startDate:e.startOfLastMonth,endDate:e.endOfLastMonth})}]),Jc.defaultInputRanges=[{label:"days up to today",range(i){return{startDate:(0,n.addDays)(e.startOfToday,(Math.max(Number(i),1)-1)*-1),endDate:e.endOfToday}},getCurrentValue(i){return(0,n.isSameDay)(i.endDate,e.endOfToday)?i.startDate?(0,n.differenceInCalendarDays)(e.endOfToday,i.startDate)+1:"":"-"}},{label:"days starting today",range(i){const a=new Date;return{startDate:a,endDate:(0,n.addDays)(a,Math.max(Number(i),1)-1)}},getCurrentValue(i){return(0,n.isSameDay)(i.startDate,e.startOfToday)?i.endDate?(0,n.differenceInCalendarDays)(i.endDate,e.startOfToday)+1:"":"-"}}],Jc}var Lh={},oJ;function Xie(){if(oJ)return Lh;oJ=1,Object.defineProperty(Lh,"__esModule",{value:!0}),Lh.default=void 0;var n=i(Ar()),e=t(La());function t(m){return m&&m.__esModule?m:{default:m}}function s(m){if(typeof WeakMap!="function")return null;var f=new WeakMap,p=new WeakMap;return(s=function(b){return b?p:f})(m)}function i(m,f){if(m&&m.__esModule)return m;if(m===null||typeof m!="object"&&typeof m!="function")return{default:m};var p=s(f);if(p&&p.has(m))return p.get(m);var b={__proto__:null},x=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in m)if(v!=="default"&&Object.prototype.hasOwnProperty.call(m,v)){var S=x?Object.getOwnPropertyDescriptor(m,v):null;S&&(S.get||S.set)?Object.defineProperty(b,v,S):b[v]=m[v]}return b.default=m,p&&p.set(m,b),b}function a(m,f,p){return f=o(f),f in m?Object.defineProperty(m,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):m[f]=p,m}function o(m){var f=l(m,"string");return typeof f=="symbol"?f:String(f)}function l(m,f){if(typeof m!="object"||!m)return m;var p=m[Symbol.toPrimitive];if(p!==void 0){var b=p.call(m,f);if(typeof b!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(m)}const c=0,d=99999;let h=class extends n.Component{constructor(f,p){super(f,p),a(this,"onChange",b=>{const{onChange:x}=this.props;let v=parseInt(b.target.value,10);v=isNaN(v)?0:Math.max(Math.min(d,v),c),x(v)})}shouldComponentUpdate(f){const{value:p,label:b,placeholder:x}=this.props;return p!==f.value||b!==f.label||x!==f.placeholder}render(){const{label:f,placeholder:p,value:b,styles:x,onBlur:v,onFocus:S}=this.props;return n.default.createElement("div",{className:x.inputRange},n.default.createElement("input",{className:x.inputRangeInput,placeholder:p,value:b,min:c,max:d,onChange:this.onChange,onFocus:S,onBlur:v}),n.default.createElement("span",{className:x.inputRangeLabel},f))}};return h.propTypes={value:e.default.oneOfType([e.default.string,e.default.number]),label:e.default.oneOfType([e.default.element,e.default.node]).isRequired,placeholder:e.default.string,styles:e.default.shape({inputRange:e.default.string,inputRangeInput:e.default.string,inputRangeLabel:e.default.string}).isRequired,onBlur:e.default.func.isRequired,onFocus:e.default.func.isRequired,onChange:e.default.func.isRequired},h.defaultProps={value:"",placeholder:"-"},Lh.default=h,Lh}var lJ;function cE(){if(lJ)return Dh;lJ=1,Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.default=void 0;var n=d(Ar()),e=l(La()),t=l(Dp()),s=lE(),i=Tp(),a=l(Xie()),o=l(Rg());function l(b){return b&&b.__esModule?b:{default:b}}function c(b){if(typeof WeakMap!="function")return null;var x=new WeakMap,v=new WeakMap;return(c=function(S){return S?v:x})(b)}function d(b,x){if(b&&b.__esModule)return b;if(b===null||typeof b!="object"&&typeof b!="function")return{default:b};var v=c(x);if(v&&v.has(b))return v.get(b);var S={__proto__:null},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in b)if(V!=="default"&&Object.prototype.hasOwnProperty.call(b,V)){var R=B?Object.getOwnPropertyDescriptor(b,V):null;R&&(R.get||R.set)?Object.defineProperty(S,V,R):S[V]=b[V]}return S.default=b,v&&v.set(b,S),S}function h(b,x,v){return x=m(x),x in b?Object.defineProperty(b,x,{value:v,enumerable:!0,configurable:!0,writable:!0}):b[x]=v,b}function m(b){var x=f(b,"string");return typeof x=="symbol"?x:String(x)}function f(b,x){if(typeof b!="object"||!b)return b;var v=b[Symbol.toPrimitive];if(v!==void 0){var S=v.call(b,x);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(b)}let p=class extends n.Component{constructor(x){super(x),h(this,"handleRangeChange",v=>{const{onChange:S,ranges:B,focusedRange:V}=this.props,R=B[V[0]];!S||!R||S({[R.key||`range${V[0]+1}`]:{...R,...v}})}),this.state={rangeOffset:0,focusedInput:-1}}getRangeOptionValue(x){const{ranges:v=[],focusedRange:S=[]}=this.props;if(typeof x.getCurrentValue!="function")return"";const B=v[S[0]]||{};return x.getCurrentValue(B)||""}getSelectedRange(x,v){const S=x.findIndex(V=>!V.startDate||!V.endDate||V.disabled?!1:v.isSelected(V));return{selectedRange:x[S],focusedRangeIndex:S}}render(){const{headerContent:x,footerContent:v,onPreviewChange:S,inputRanges:B,staticRanges:V,ranges:R,renderStaticRangeLabel:W,rangeColors:_,className:Y}=this.props;return n.default.createElement("div",{className:(0,o.default)(t.default.definedRangesWrapper,Y)},x,n.default.createElement("div",{className:t.default.staticRanges},V.map((j,M)=>{const{selectedRange:H,focusedRangeIndex:D}=this.getSelectedRange(R,j);let z;return j.hasCustomRendering?z=W(j):z=j.label,n.default.createElement("button",{type:"button",className:(0,o.default)(t.default.staticRange,{[t.default.staticRangeSelected]:!!H}),style:{color:H?H.color||_[D]:null},key:M,onClick:()=>this.handleRangeChange(j.range(this.props)),onFocus:()=>S&&S(j.range(this.props)),onMouseOver:()=>S&&S(j.range(this.props)),onMouseLeave:()=>{S&&S()}},n.default.createElement("span",{tabIndex:-1,className:t.default.staticRangeLabel},z))})),n.default.createElement("div",{className:t.default.inputRanges},B.map((j,M)=>n.default.createElement(a.default,{key:M,styles:t.default,label:j.label,onFocus:()=>this.setState({focusedInput:M,rangeOffset:0}),onBlur:()=>this.setState({rangeOffset:0}),onChange:H=>this.handleRangeChange(j.range(H,this.props)),value:this.getRangeOptionValue(j)}))),v)}};return p.propTypes={inputRanges:e.default.array,staticRanges:e.default.array,ranges:e.default.arrayOf(i.rangeShape),focusedRange:e.default.arrayOf(e.default.number),onPreviewChange:e.default.func,onChange:e.default.func,footerContent:e.default.any,headerContent:e.default.any,rangeColors:e.default.arrayOf(e.default.string),className:e.default.string,renderStaticRangeLabel:e.default.func},p.defaultProps={inputRanges:s.defaultInputRanges,staticRanges:s.defaultStaticRanges,ranges:[],rangeColors:["#3d91ff","#3ecf8e","#fed14c"],focusedRange:[0,0]},Dh.default=p,Dh}var cJ;function Jie(){if(cJ)return Eh;cJ=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.default=void 0;var n=d(Ar()),e=l(La()),t=l(oE()),s=l(cE()),i=Ep(),a=l(Rg()),o=l(Dp());function l(f){return f&&f.__esModule?f:{default:f}}function c(f){if(typeof WeakMap!="function")return null;var p=new WeakMap,b=new WeakMap;return(c=function(x){return x?b:p})(f)}function d(f,p){if(f&&f.__esModule)return f;if(f===null||typeof f!="object"&&typeof f!="function")return{default:f};var b=c(p);if(b&&b.has(f))return b.get(f);var x={__proto__:null},v=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in f)if(S!=="default"&&Object.prototype.hasOwnProperty.call(f,S)){var B=v?Object.getOwnPropertyDescriptor(f,S):null;B&&(B.get||B.set)?Object.defineProperty(x,S,B):x[S]=f[S]}return x.default=f,b&&b.set(f,x),x}function h(){return h=Object.assign?Object.assign.bind():function(f){for(var p=1;p<arguments.length;p++){var b=arguments[p];for(var x in b)Object.prototype.hasOwnProperty.call(b,x)&&(f[x]=b[x])}return f},h.apply(this,arguments)}let m=class extends n.Component{constructor(p){super(p),this.state={focusedRange:[(0,i.findNextRangeIndex)(p.ranges),0]},this.styles=(0,i.generateStyles)([o.default,p.classNames])}render(){const{focusedRange:p}=this.state;return n.default.createElement("div",{className:(0,a.default)(this.styles.dateRangePickerWrapper,this.props.className)},n.default.createElement(s.default,h({focusedRange:p,onPreviewChange:b=>this.dateRange.updatePreview(b?this.dateRange.calcNewSelection(b,typeof b=="string"):null)},this.props,{range:this.props.ranges[p[0]],className:void 0})),n.default.createElement(t.default,h({onRangeFocusChange:b=>this.setState({focusedRange:b}),focusedRange:p},this.props,{ref:b=>this.dateRange=b,className:void 0})))}};return m.defaultProps={},m.propTypes={...t.default.propTypes,...s.default.propTypes,className:e.default.string},Eh.default=m,Eh}var dJ;function Yie(){return dJ||(dJ=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Calendar",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(n,"DateRange",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(n,"DateRangePicker",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"DefinedRange",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"createStaticRanges",{enumerable:!0,get:function(){return a.createStaticRanges}}),Object.defineProperty(n,"defaultInputRanges",{enumerable:!0,get:function(){return a.defaultInputRanges}}),Object.defineProperty(n,"defaultStaticRanges",{enumerable:!0,get:function(){return a.defaultStaticRanges}});var e=o(oE()),t=o(aE()),s=o(Jie()),i=o(cE()),a=lE();function o(l){return l&&l.__esModule?l:{default:l}}})(iy)),iy}var Wm=Yie();const Vn=({label:n,id:e,error:t,value:s,onChange:i,maxDate:a,minDate:o,align:l="left",...c})=>{const[d,h]=k.useState(!1),[m,f]=k.useState(!1),p=k.useRef(null),{theme:b}=Fl(),x=b==="dark";k.useEffect(()=>{f(document.body.classList.contains("field-officer-dark-theme"))},[]);const v=Y=>{i&&i(He(Y,"yyyy-MM-dd")),h(!1)};k.useEffect(()=>{const Y=j=>{p.current&&!p.current.contains(j.target)&&h(!1)};return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[]);const{className:S,...B}=c,W=`${m?"fo-input":"form-input"} ${t?m?"fo-input--error":"form-input--error":""} flex justify-between items-center cursor-pointer ${S||""}`,_=s?new Date(s+"T12:00:00"):new Date;return r.jsxs("div",{ref:p,children:[n&&r.jsx("label",{htmlFor:e,className:"block text-sm font-medium text-muted",children:n}),r.jsxs("div",{className:n?"mt-1 relative":"relative",children:[r.jsxs("div",{id:e,className:W,onClick:()=>h(!d),role:"button","aria-haspopup":"dialog","aria-expanded":d,"aria-label":`Date picker for ${n}`,children:[r.jsx("span",{className:s?"":"text-muted",children:s?He(_,"dd MMM, yyyy"):"Select date"}),r.jsx(ra,{className:"h-4 w-4 text-muted"})]}),d&&r.jsx("div",{className:`absolute z-50 mt-1 rounded-lg shadow-lg overflow-hidden ${l==="right"?"right-0":"left-0"} ${x?"dark-calendar bg-[#041b0f] border border-[#1f3d2b]":"bg-white border border-gray-200"}`,children:r.jsx(Wm.Calendar,{date:_,onChange:v,maxDate:a,minDate:o,color:x?"#10B981":"#005D22"})})]}),t&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:t})]})},dE=["Apartment","Villa","Vilament","Rowhouse","Combined","Commercial Office","Commercial Retail","Commercial","Public",""],Fie=Bt({organizationId:pe().required(),location:pe().optional().nullable(),entityId:pe().optional(),billingName:pe().optional().nullable(),registeredAddress:pe().optional().nullable(),gstNumber:pe().optional().nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,{message:"Invalid GST Number format",excludeEmptyString:!0}),panNumber:pe().optional().nullable().transform(n=>n?.toUpperCase()||"").matches(/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,{message:"Invalid PAN format",excludeEmptyString:!0}),email1:pe().email("Invalid email format").optional().nullable(),email2:pe().email("Invalid email format").optional().nullable(),email3:pe().email("Invalid email format").optional().nullable(),eShramNumber:pe().optional().nullable(),shopAndEstablishmentCode:pe().optional().nullable(),keyAccountManager:pe().optional(),siteAreaSqFt:mr().typeError("Must be a number").nullable().optional(),projectType:pe().oneOf(dE).optional(),apartmentCount:mr().typeError("Must be a number").nullable().optional(),agreementDetails:Bt({fromDate:pe().optional().nullable(),toDate:pe().optional().nullable().test("is-after-from","To Date must be after From Date",function(n){const{fromDate:e}=this.parent;return!e||!n?!0:new Date(n.replace(/-/g,"/"))>=new Date(e.replace(/-/g,"/"))}),renewalIntervalDays:mr().typeError("Must be a number").nullable().optional().min(0,"Cannot be negative"),softCopy:Et().nullable().optional(),scannedCopy:Et().nullable().optional(),agreementDate:pe().optional().nullable(),addendum1Date:pe().optional().nullable(),addendum2Date:pe().optional().nullable()}).optional(),siteOperations:Bt({form6Applicable:hr().default(!1),form6RenewalTaskCreation:hr().optional(),form6ValidityFrom:pe().nullable().when("form6Applicable",{is:!0,then:n=>n.required("From Date is required")}),form6ValidityTo:pe().nullable().when("form6Applicable",{is:!0,then:n=>n.required("To Date is required")}),form6Document:Et().nullable().when("form6Applicable",{is:!0,then:n=>n.required("Document is required")}),minWageRevisionApplicable:hr().default(!1),minWageRevisionTaskCreation:hr().optional(),minWageRevisionValidityFrom:pe().nullable().when("minWageRevisionApplicable",{is:!0,then:n=>n.required("From Date is required")}),minWageRevisionValidityTo:pe().nullable().when("minWageRevisionApplicable",{is:!0,then:n=>n.required("To Date is required")}),minWageRevisionDocument:Et().nullable().when("minWageRevisionApplicable",{is:!0,then:n=>n.required("Document is required")}),holidays:Bt({numberOfDays:mr().nullable().min(0),list:Rr().of(Bt({id:pe(),date:pe().required(),description:pe().required()})),salaryPayment:pe().oneOf(["Full Payment","Duty Payment","Nil Payment",""]),billing:pe().oneOf(["Full Payment","Duty Payment","Nil Payment",""])}).optional(),costingSheetLink:pe().url("Must be a valid URL").nullable().optional(),tools:Bt({dcCopy1:Et().nullable().optional(),dcCopy2:Et().nullable().optional(),list:Rr().of(Bt({id:pe(),name:pe().required(),brand:pe().optional(),size:pe().optional(),quantity:mr().nullable().min(0),issueDate:pe().required(),picture:Et().nullable().optional()}))}).optional(),sims:Bt({issuedCount:mr().nullable().min(0),details:Rr().of(Bt({id:pe(),mobileNumber:pe().required().matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit number"),allocatedTo:pe().optional(),plan:pe().optional(),ownerName:pe().optional()}))}).optional(),equipment:Bt({issued:Rr().of(Bt({id:pe(),name:pe().required(),brand:pe().optional(),modelNumber:pe().optional(),serialNumber:pe().optional(),accessories:pe().optional(),condition:pe().oneOf(["New","Old",""]),issueDate:pe().required(),picture:Et().nullable().optional()})),intermittent:Bt({billing:pe().oneOf(["To Be Billed","Not to be Billed",""]),frequency:pe().oneOf(["Monthly","Bi-Monthly","Quarterly","Half Yearly","Yearly",""]),taskCreation:hr().default(!1),durationDays:mr().nullable().min(0)}).optional()}).optional(),billingCycleFrom:pe().nullable().optional(),uniformDeductions:hr().default(!1)}).optional(),insuranceStatus:Bt({isCompliant:hr().required()}).optional().nullable(),assets:Rr().optional(),issuedTools:Rr().optional()}).defined(),gJ=({title:n,children:e})=>{const[t,s]=k.useState(!1);return r.jsxs("div",{className:"border border-border rounded-lg bg-page",children:[r.jsxs("button",{type:"button",onClick:()=>s(!t),className:"w-full flex justify-between items-center p-3 font-medium text-left text-primary-text",children:[r.jsx("span",{children:n}),r.jsx(kg,{className:`h-5 w-5 transform transition-transform ${t?"rotate-180":""}`})]}),t&&r.jsx("div",{className:"p-4 border-t border-border bg-card",children:e})]})},gE=({isOpen:n,onClose:e,onSave:t,organization:s,allClients:i,initialData:a})=>{const[o,l]=k.useState("General"),c=jt("(max-width: 767px)"),{register:d,handleSubmit:h,control:m,watch:f,setValue:p,formState:{errors:b},reset:x}=tn({resolver:Yn(Fie),defaultValues:{siteOperations:{form6Applicable:!1,minWageRevisionApplicable:!1,uniformDeductions:!1}}}),{fields:v,append:S,remove:B}=Wr({control:m,name:"siteOperations.holidays.list"});Wr({control:m,name:"siteOperations.tools.list"}),Wr({control:m,name:"siteOperations.sims.details"}),Wr({control:m,name:"siteOperations.equipment.issued"}),k.useEffect(()=>{n&&x(a||{organizationId:s.id})},[n,a,s.id,x]);const V=f("entityId"),R=f("siteOperations.form6Applicable"),W=f("siteOperations.minWageRevisionApplicable");k.useEffect(()=>{if(V){const j=i.find(M=>M.id===V);j&&(p("registeredAddress",j.registeredAddress||""),p("gstNumber",j.gstNumber||""),p("panNumber",j.panNumber||""),p("email1",j.email||""),p("eShramNumber",j.eShramNumber||""),p("shopAndEstablishmentCode",j.shopAndEstablishmentCode||""))}},[V,i,p]);const _=j=>{t(s.id,j)},Y=({tabName:j})=>r.jsx("button",{type:"button",onClick:()=>l(j),className:`px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 ${o===j?"border-accent text-accent":"border-transparent text-muted hover:text-primary-text"}`,children:j});return n?r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 p-4 flex items-center justify-center",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card w-full max-w-4xl my-8 animate-fade-in-scale",onClick:j=>j.stopPropagation(),children:r.jsxs("form",{onSubmit:h(_),className:"p-6",children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Site Configuration"}),r.jsxs("p",{className:"text-sm text-muted mb-4",children:["For: ",s.shortName]}),r.jsx("div",{className:"mb-6",children:c?r.jsxs(Oe,{label:"Configuration Section",id:"site-config-tabs",value:o,onChange:j=>l(j.target.value),className:"pro-select pro-select-arrow",children:[r.jsx("option",{value:"General",children:"General"}),r.jsx("option",{value:"Compliance",children:"Compliance"}),r.jsx("option",{value:"Agreement",children:"Agreement"}),r.jsx("option",{value:"Site Operations",children:"Site Operations"})]}):r.jsx("div",{className:"border-b border-border",children:r.jsxs("nav",{className:"-mb-px flex space-x-4",children:[r.jsx(Y,{tabName:"General"}),r.jsx(Y,{tabName:"Compliance"}),r.jsx(Y,{tabName:"Agreement"}),r.jsx(Y,{tabName:"Site Operations"})]})})}),r.jsxs("div",{className:"max-h-[60vh] overflow-y-auto pr-2 space-y-4",children:[o==="General"&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[r.jsx(be,{label:"Location",id:"location",registration:d("location"),error:b.location?.message}),r.jsx(be,{label:"Billing Name",id:"billingName",registration:d("billingName"),error:b.billingName?.message}),r.jsx(be,{label:"Key Account Manager",id:"keyAccountManager",registration:d("keyAccountManager"),error:b.keyAccountManager?.message}),r.jsx(be,{label:"Site Area (Sq.ft)",id:"siteAreaSqFt",type:"number",registration:d("siteAreaSqFt"),error:b.siteAreaSqFt?.message}),r.jsxs(Oe,{label:"Type of Project",id:"projectType",registration:d("projectType"),error:b.projectType?.message,children:[r.jsx("option",{value:"",children:"-- Select Type --"}),dE.filter(Boolean).map(j=>r.jsx("option",{value:j,children:j},j))]}),r.jsx(be,{label:"No of Apartments/Villas",id:"apartmentCount",type:"number",registration:d("apartmentCount"),error:b.apartmentCount?.message})]}),o==="Compliance"&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(ye,{name:"entityId",control:m,render:({field:j})=>r.jsxs(Oe,{label:"Link to Client (Prefills data)",id:"entityId",...j,error:b.entityId?.message,children:[r.jsx("option",{value:"",children:"-- Select Client --"}),i.map(M=>r.jsxs("option",{value:M.id,children:[M.name," (",M.companyName,")"]},M.id))]})})}),r.jsx(be,{label:"GST Number",id:"gstNumber",registration:d("gstNumber"),error:b.gstNumber?.message}),r.jsx(be,{label:"PAN Number",id:"panNumber",registration:d("panNumber"),error:b.panNumber?.message}),r.jsx(be,{label:"Email Address 1",id:"email1",registration:d("email1"),error:b.email1?.message}),r.jsx(be,{label:"Email Address 2",id:"email2",registration:d("email2"),error:b.email2?.message}),r.jsx(be,{label:"Email Address 3",id:"email3",registration:d("email3"),error:b.email3?.message}),r.jsx(be,{label:"E-Shram Number",id:"eShramNumber",registration:d("eShramNumber"),error:b.eShramNumber?.message}),r.jsx(be,{label:"Shop & Establishment Code",id:"shopAndEstablishmentCode",registration:d("shopAndEstablishmentCode"),error:b.shopAndEstablishmentCode?.message})]}),o==="Agreement"&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[r.jsx(ye,{name:"agreementDetails.fromDate",control:m,render:({field:j})=>r.jsx(Vn,{label:"From Date",id:"agreementDetails.fromDate",value:j.value,onChange:j.onChange,error:b.agreementDetails?.fromDate?.message})}),r.jsx(ye,{name:"agreementDetails.toDate",control:m,render:({field:j})=>r.jsx(Vn,{label:"To Date",id:"agreementDetails.toDate",value:j.value,onChange:j.onChange,error:b.agreementDetails?.toDate?.message})}),r.jsx(be,{label:"Renewal Interval (Days)",id:"agreementDetails.renewalIntervalDays",type:"number",registration:d("agreementDetails.renewalIntervalDays"),error:b.agreementDetails?.renewalIntervalDays?.message}),r.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(ye,{name:"agreementDetails.softCopy",control:m,render:({field:j})=>r.jsx(pt,{label:"Soft Copy",file:j.value,onFileChange:j.onChange})}),r.jsx(ye,{name:"agreementDetails.scannedCopy",control:m,render:({field:j})=>r.jsx(pt,{label:"Scanned Copy",file:j.value,onFileChange:j.onChange})})]}),r.jsx(ye,{name:"agreementDetails.agreementDate",control:m,render:({field:j})=>r.jsx(Vn,{label:"Agreement Dated",id:"agreementDetails.agreementDate",value:j.value,onChange:j.onChange,error:b.agreementDetails?.agreementDate?.message})}),r.jsx(ye,{name:"agreementDetails.addendum1Date",control:m,render:({field:j})=>r.jsx(Vn,{label:"Addendum 1 Dated",id:"agreementDetails.addendum1Date",value:j.value,onChange:j.onChange,error:b.agreementDetails?.addendum1Date?.message})}),r.jsx(ye,{name:"agreementDetails.addendum2Date",control:m,render:({field:j})=>r.jsx(Vn,{label:"Addendum 2 Dated",id:"agreementDetails.addendum2Date",value:j.value,onChange:j.onChange,error:b.agreementDetails?.addendum2Date?.message})})]}),o==="Site Operations"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx(gJ,{title:"Compliance Forms",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(ye,{name:"siteOperations.form6Applicable",control:m,render:({field:j})=>r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:j.value,onChange:j.onChange})," Form 6 Applicable"]})}),R&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 pl-6",children:[r.jsx(ye,{name:"siteOperations.form6ValidityFrom",control:m,render:({field:j})=>r.jsx(Vn,{label:"Valid From",id:"form6from",value:j.value,onChange:j.onChange,error:b.siteOperations?.form6ValidityFrom?.message})}),r.jsx(ye,{name:"siteOperations.form6ValidityTo",control:m,render:({field:j})=>r.jsx(Vn,{label:"Valid To",id:"form6to",value:j.value,onChange:j.onChange,error:b.siteOperations?.form6ValidityTo?.message})}),r.jsx("div",{className:"md:col-span-2",children:r.jsx(ye,{name:"siteOperations.form6Document",control:m,render:({field:j})=>r.jsx(pt,{label:"Form 6 Document",file:j.value,onFileChange:j.onChange,error:b.siteOperations?.form6Document?.message})})})]})]}),r.jsxs("div",{children:[r.jsx(ye,{name:"siteOperations.minWageRevisionApplicable",control:m,render:({field:j})=>r.jsxs("label",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:j.value,onChange:j.onChange})," Min. Wage Revision Applicable"]})}),W&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 pl-6",children:[r.jsx(ye,{name:"siteOperations.minWageRevisionValidityFrom",control:m,render:({field:j})=>r.jsx(Vn,{label:"Valid From",id:"minwagefrom",value:j.value,onChange:j.onChange,error:b.siteOperations?.minWageRevisionValidityFrom?.message})}),r.jsx(ye,{name:"siteOperations.minWageRevisionValidityTo",control:m,render:({field:j})=>r.jsx(Vn,{label:"Valid To",id:"minwageto",value:j.value,onChange:j.onChange,error:b.siteOperations?.minWageRevisionValidityTo?.message})}),r.jsx("div",{className:"md:col-span-2",children:r.jsx(ye,{name:"siteOperations.minWageRevisionDocument",control:m,render:({field:j})=>r.jsx(pt,{label:"Min. Wage Document",file:j.value,onFileChange:j.onChange,error:b.siteOperations?.minWageRevisionDocument?.message})})})]})]})]})}),r.jsx(gJ,{title:"Holidays",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx(be,{label:"Number of National & Festival Holidays",id:"holiday-count",type:"number",registration:d("siteOperations.holidays.numberOfDays")}),r.jsxs(Oe,{label:"Salary Payment for Holiday",id:"holiday-salary",registration:d("siteOperations.holidays.salaryPayment"),children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Full Payment"}),r.jsx("option",{children:"Duty Payment"}),r.jsx("option",{children:"Nil Payment"})]}),r.jsxs(Oe,{label:"Billing for Holiday",id:"holiday-billing",registration:d("siteOperations.holidays.billing"),children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Full Payment"}),r.jsx("option",{children:"Duty Payment"}),r.jsx("option",{children:"Nil Payment"})]}),r.jsx("h5",{className:"font-semibold pt-2 border-t",children:"Holiday List"}),v.map((j,M)=>r.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[r.jsx("div",{className:"col-span-6",children:r.jsx(be,{label:"Description",id:`holiday-desc-${M}`,...d(`siteOperations.holidays.list.${M}.description`)})}),r.jsx("div",{className:"col-span-5",children:r.jsx(ye,{name:`siteOperations.holidays.list.${M}.date`,control:m,render:({field:H})=>r.jsx(Vn,{label:"Date",id:`holiday-date-${M}`,value:H.value,onChange:H.onChange})})}),r.jsx("div",{className:"col-span-1",children:r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>B(M),children:r.jsx(rn,{className:"h-4 text-red-500"})})})]},j.id)),r.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:()=>S({id:`hol_${Date.now()}`,date:"",description:""}),children:[r.jsx(Tt,{className:"h-4 mr-1"})," Add Holiday"]})]})})]})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t border-border flex justify-end space-x-3",children:[r.jsx(se,{type:"button",onClick:e,variant:"secondary",children:"Cancel"}),r.jsx(se,{type:"submit",children:"Save Configuration"})]})]})})}):null},Mie=({isOpen:n,onClose:e,siteName:t,details:s,isLoading:i,onSave:a,designations:o})=>{const[l,c]=k.useState([]),[d,h]=k.useState(!1),m=k.useRef(null),[f,p]=k.useState(!1),b=k.useMemo(()=>{const _=new Set;return o.filter(Y=>_.has(Y.designation)?!1:(_.add(Y.designation),!0)).sort((Y,j)=>Y.designation.localeCompare(j.designation))},[o]),x=()=>{const _=m.current;if(_){const Y=_.scrollHeight>_.clientHeight,j=_.scrollHeight-_.scrollTop<=_.clientHeight+1;p(Y&&!j)}else p(!1)};k.useEffect(()=>{if(n){c(JSON.parse(JSON.stringify(s)));const _=setTimeout(x,150);return()=>clearTimeout(_)}},[s,n,i]);const v=(_,Y,j)=>{const M=[...l],H=M[_];if(Y==="count"){const D=Number(j);H.count=isNaN(D)?0:D}else H.designation=String(j);c(M)},S=()=>{c([...l,{designation:"",count:0,tempId:`new_${Date.now()}`}]),setTimeout(x,50)},B=_=>{const Y=l.filter((j,M)=>M!==_);c(Y),setTimeout(x,50)},V=async()=>{h(!0);const _=l.filter(Y=>Y.designation.trim()!=="").map(({tempId:Y,...j})=>j);await a(_),h(!1)},R=ot.useMemo(()=>l.reduce((_,Y)=>_+(Number(Y.count)||0),0),[l]),W=_=>{if(_.key!=="ArrowUp"&&_.key!=="ArrowDown")return;const Y=_.target;if(Y.tagName!=="INPUT"&&Y.tagName!=="SELECT")return;const j=Y.getAttribute("data-row-index"),M=Y.getAttribute("data-col-index");if(!j||!M||Y.type==="number")return;_.preventDefault();const H=_.currentTarget,D=parseInt(j,10),z=parseInt(M,10),O=_.key==="ArrowUp"?D-1:D+1,E=H.querySelector(`[data-row-index="${O}"][data-col-index="${z}"]`);E&&E.focus()};return n?uF.createPortal(r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-sm sm:max-w-lg md:max-w-2xl m-4 animate-fade-in-scale flex flex-col",onClick:_=>_.stopPropagation(),children:[r.jsx("h3",{className:"text-lg font-bold text-primary-text",children:"Allocate Manpower"}),r.jsxs("p",{className:"text-sm text-muted mb-4",children:["For site: ",t]}),r.jsxs("div",{className:"flex-grow relative overflow-hidden",children:[r.jsx("div",{ref:m,onScroll:x,onKeyDown:W,className:"overflow-y-auto pr-2 min-h-[300px] max-h-[60vh] h-full",children:i?r.jsx("div",{className:"flex justify-center items-center h-full",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"grid grid-cols-12 gap-4 sticky top-0 bg-page p-2 rounded-t-lg z-10",children:[r.jsx("div",{className:"col-span-6 font-medium text-sm text-muted",children:"Designation"}),r.jsx("div",{className:"col-span-4 font-medium text-sm text-muted",children:"Count"}),r.jsx("div",{className:"col-span-2"})]}),l.length>0?l.map((_,Y)=>r.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[r.jsx("div",{className:"col-span-6",children:r.jsxs(Oe,{id:`designation-${Y}`,value:_.designation,onChange:j=>v(Y,"designation",j.target.value),className:"py-1.5","data-row-index":Y,"data-col-index":0,"aria-label":`Designation for row ${Y+1}`,children:[r.jsx("option",{value:"",children:"Select Designation"}),b.map(j=>r.jsx("option",{value:j.designation,children:j.designation},j.id))]})}),r.jsx("div",{className:"col-span-4",children:r.jsx(be,{id:`count-${Y}`,type:"number",value:_.count,onChange:j=>v(Y,"count",j.target.value),min:"0",step:"0.01",className:"py-1.5","data-row-index":Y,"data-col-index":1,"aria-label":`Count for row ${Y+1}`})}),r.jsx("div",{className:"col-span-2 text-right",children:r.jsx(se,{variant:"icon",size:"sm",onClick:()=>B(Y),title:"Remove row","aria-label":`Remove row ${Y+1}`,children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})})]},_.tempId||Y)):r.jsx("p",{className:"text-center text-muted py-10",children:"No designations added yet. Click below to start."}),r.jsxs(se,{variant:"outline",size:"sm",onClick:S,className:"mt-4",children:[r.jsx(Tt,{className:"h-4 w-4 mr-2"})," Add Designation"]})]})}),f&&r.jsx("div",{className:"absolute bottom-0 left-0 right-2 h-16 bg-gradient-to-t from-card to-transparent pointer-events-none"})]}),r.jsxs("div",{className:"mt-6 pt-4 border-t flex justify-between items-center",children:[r.jsxs("div",{className:"font-semibold",children:["Total Manpower: ",r.jsx("span",{className:"text-accent",children:R.toFixed(2)})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(se,{onClick:e,variant:"secondary",disabled:d,children:"Cancel"}),r.jsx(se,{onClick:V,isLoading:d,disabled:i,children:"Save Changes"})]})]})]})}),document.getElementById("modal-root")):null},OS=["id","shortName","fullName","address","manpowerApprovedCount","reportingManagerName","managerName","fieldOfficerNames","backendFieldOfficerNames"],Hie=(n,e)=>{const t=e.join(","),s=n.map(i=>e.map(a=>{let o=i[a];return Array.isArray(o)&&(o=o.join(";")),o=o==null?"":String(o),o.includes(",")||o.includes('"')||o.includes(`
`)?`"${o.replace(/"/g,'""')}"`:o}).join(","));return[t,...s].join(`
`)},Tie=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)return[];const t=e[0].split(",").map(i=>i.trim().replace(/"/g,"")),s=[];for(let i=1;i<e.length;i++){const a={},o=e[i].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];t.forEach((l,c)=>{let d=(o[c]||"").trim();d.startsWith('"')&&d.endsWith('"')&&(d=d.substring(1,d.length-1).replace(/""/g,'"')),a[l]=d}),s.push(a)}return s},Eie=()=>{const n=vt(),[e,t]=k.useState([]),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState([]),[d,h]=k.useState(!0),[m,f]=k.useState(!1),[p,b]=k.useState(!1),[x,v]=k.useState(!1),[S,B]=k.useState(null),[V,R]=k.useState(null),[W,_]=k.useState(null),[Y,j]=k.useState([]),[M,H]=k.useState(!1),D=k.useRef(null),z=jt("(max-width: 767px)"),{siteManagement:O}=wi(),E=k.useCallback(async()=>{h(!0);try{const[le,ue,ae,Ce]=await Promise.all([ce.getOrganizations().catch(ge=>(console.error("Failed to fetch organizations:",ge),[])),ce.getOrganizationStructure().catch(ge=>(console.error("Failed to fetch organization structure:",ge),[])),ce.getSiteConfigurations().catch(ge=>(console.error("Failed to fetch site configurations:",ge),[])),ce.getSiteStaffDesignations().catch(ge=>(console.error("Failed to fetch site staff designations:",ge),_({message:"Could not load designation list. Manpower editing may be affected.",type:"error"}),[]))]);t(le),i(ae),c(Ce);const ie=ue.flatMap(ge=>ge.companies.flatMap(xe=>xe.entities.map(_e=>({..._e,companyName:xe.name}))));o(ie)}catch{_({message:"An unexpected error occurred while fetching data.",type:"error"})}finally{h(!1)}},[]);k.useEffect(()=>{E()},[E]);const te=le=>{B(le),f(!0)},q=le=>{R(le),b(!0)},de=(le,ue)=>{i(ae=>{const Ce=[...ae],ie=Ce.findIndex(ge=>ge.organizationId===le);return ie>-1?Ce[ie]=ue:Ce.push(ue),Ce}),_({message:"Site configuration saved.",type:"success"}),f(!1)},U=async()=>{V&&(t(le=>le.filter(ue=>ue.id!==V.id)),i(le=>le.filter(ue=>ue.organizationId!==V.id)),_({message:"Site deleted.",type:"success"}),b(!1))},P=async le=>{R(le),H(!0),v(!0);try{const ue=await ce.getManpowerDetails(le.id);j(ue)}catch{_({message:"Could not load manpower details.",type:"error"})}finally{H(!1)}},ne=async le=>{if(V)try{await ce.updateManpowerDetails(V.id,le);const ue=le.reduce((ae,Ce)=>ae+(Number(Ce.count)||0),0);t(ae=>ae.map(Ce=>Ce.id===V.id?{...Ce,manpowerApprovedCount:ue}:Ce)),v(!1),_({message:"Manpower details updated successfully.",type:"success"})}catch{_({message:"Failed to save manpower details.",type:"error"})}},K=()=>{const le=Hie(e,OS),ue=new Blob([le],{type:"text/csv;charset=utf-8;"}),ae=document.createElement("a");ae.href=URL.createObjectURL(ue),ae.setAttribute("download","sites_export.csv"),document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),_({message:"Sites exported successfully.",type:"success"})},re=le=>{const ue=le.target.files?.[0];if(!ue)return;const ae=new FileReader;ae.onload=async Ce=>{try{const ie=Ce.target?.result;if(!ie)throw new Error("File is empty or could not be read.");const ge=Tie(ie);if(ge.length===0)throw new Error("No data rows found in the CSV file.");const xe=Object.keys(ge[0]);if(!OS.every(Re=>xe.includes(Re)))throw new Error(`CSV is missing headers. Required: ${OS.join(", ")}`);const Be=ge.map(Re=>({id:Re.id,shortName:Re.shortName,fullName:Re.fullName,address:Re.address,manpowerApprovedCount:parseFloat(Re.manpowerApprovedCount)||0,reportingManagerName:Re.reportingManagerName||void 0,managerName:Re.managerName||void 0,fieldOfficerNames:Re.fieldOfficerNames?Re.fieldOfficerNames.split(";").map(Ye=>Ye.trim()).filter(Ye=>Ye):void 0,backendFieldOfficerNames:Re.backendFieldOfficerNames?Re.backendFieldOfficerNames.split(";").map(Ye=>Ye.trim()).filter(Ye=>Ye):void 0})),{count:Se}=await ce.bulkUploadOrganizations(Be);_({message:`${Se} sites imported/updated successfully.`,type:"success"}),E()}catch(ie){_({message:ie.message||"Failed to import CSV.",type:"error"})}finally{le.target&&(le.target.value="")}},ae.readAsText(ue)};return r.jsxs("div",{className:"p-4 md:p-8",children:[W&&r.jsx(It,{message:W.message,type:W.type,onDismiss:()=>_(null)}),r.jsx("input",{type:"file",ref:D,className:"hidden",accept:".csv",onChange:re}),r.jsx("input",{type:"file",ref:D,className:"hidden",accept:".csv",onChange:re}),m&&S&&r.jsx(gE,{isOpen:m,onClose:()=>f(!1),onSave:de,organization:S,allClients:a,initialData:s.find(le=>le.organizationId===S.id)}),V&&r.jsx(Mie,{isOpen:x,onClose:()=>v(!1),siteName:V.shortName,details:Y,isLoading:M,onSave:ne,designations:l}),r.jsxs(tr,{isOpen:p,onClose:()=>b(!1),onConfirm:U,title:"Confirm Deletion",children:['Are you sure you want to delete the site "',V?.shortName,'"? This action cannot be undone.']}),r.jsxs("div",{className:"bg-card p-4 rounded-2xl mb-4",children:[r.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4 mb-6",children:[r.jsx("h2",{className:"text-2xl font-semibold text-primary-text",children:"Site Management"}),!z&&r.jsxs("div",{className:"flex-shrink-0 flex items-center flex-wrap gap-2",children:[r.jsxs(se,{variant:"outline",onClick:()=>n("/admin/sites/quick-add"),className:"mr-2 hover:bg-gray-100",children:[r.jsx(Tt,{className:"w-5 h-5 mr-2"}),"Quick Add Site"]}),r.jsxs(se,{onClick:()=>n("/admin/sites/add"),className:"mr-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5",children:[r.jsx(Tt,{className:"w-5 h-5 mr-2"}),"Add Site"]}),r.jsxs(se,{variant:"outline",onClick:()=>D.current?.click(),className:"mr-2 hover:bg-gray-100",children:[r.jsx(td,{className:"w-5 h-5 mr-2"}),"Import"]}),r.jsxs(se,{variant:"outline",onClick:K,className:"hover:bg-gray-100",children:[r.jsx(si,{className:"w-5 h-5 mr-2"}),"Export"]})]})]}),z&&r.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[r.jsxs(se,{onClick:()=>n("/admin/sites/add"),className:"w-full justify-center bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-0.5",children:[r.jsx(Tt,{className:"w-5 h-5 mr-2"}),"Add Site"]}),r.jsxs(se,{variant:"outline",onClick:()=>n("/admin/sites/quick-add"),className:"w-full justify-center hover:bg-gray-100",children:[r.jsx(Tt,{className:"w-5 h-5 mr-2"}),"Quick Add Site"]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs(se,{variant:"outline",onClick:()=>D.current?.click(),className:"w-full justify-center hover:bg-gray-100",children:[r.jsx(td,{className:"w-5 h-5 mr-2"}),"Import"]}),r.jsxs(se,{variant:"outline",onClick:K,className:"w-full justify-center hover:bg-gray-100",children:[r.jsx(si,{className:"w-5 h-5 mr-2"}),"Export"]})]})]})]}),r.jsx("div",{className:"bg-card rounded-2xl shadow-sm border border-border overflow-hidden",children:d?r.jsx("div",{className:"overflow-x-auto",children:r.jsx("table",{className:"w-full",children:r.jsx("tbody",{className:"divide-y divide-border",children:r.jsx(Ea,{cols:5,rows:5})})})}):e.length===0?r.jsxs("div",{className:"p-8 text-center text-muted",children:[r.jsx(oa,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),r.jsx("p",{children:"No sites found. Add a new site to get started."})]}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-muted/50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Site Name"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Location"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-muted uppercase tracking-wider",children:"Manpower"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Key Staff"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-muted uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border",children:e.map(le=>{s.find(Ce=>Ce.organizationId===le.id);const ue=!!le.provisionalCreationDate,ae=ue&&le.provisionalCreationDate?90-cP(new Date,new Date(le.provisionalCreationDate)):0;return r.jsxs("tr",{className:"hover:bg-muted/5 transition-colors",children:[r.jsx("td",{className:"px-6 py-4",children:r.jsx("div",{className:"flex items-center",children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-primary-text",children:le.shortName}),r.jsx("div",{className:"text-xs text-muted",children:le.fullName}),ue&&r.jsxs("div",{className:`mt-1 text-xs px-2 py-0.5 rounded-full inline-flex items-center gap-1 ${ae>30?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[r.jsx(gG,{className:"w-3 h-3"}),ae>0?`${ae} days left`:"Expired"]})]})})}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("div",{className:"text-sm text-primary-text max-w-xs truncate",title:le.address,children:le.address})}),r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:le.manpowerApprovedCount||0})}),r.jsx("td",{className:"px-6 py-4",children:r.jsxs("div",{className:"text-xs space-y-1",children:[le.reportingManagerName&&r.jsxs("div",{className:"flex items-center gap-1",title:"Reporting Manager",children:[r.jsx("span",{className:"font-semibold text-primary-text",children:"RM:"})," ",le.reportingManagerName]}),le.managerName&&r.jsxs("div",{className:"flex items-center gap-1",title:"Site Manager",children:[r.jsx("span",{className:"font-semibold text-primary-text",children:"SM:"})," ",le.managerName]}),le.fieldOfficerNames&&le.fieldOfficerNames.length>0&&r.jsxs("div",{className:"flex items-start gap-1",title:"Field Officers",children:[r.jsx("span",{className:"font-semibold text-primary-text whitespace-nowrap",children:"FO:"}),r.jsx("span",{className:"truncate max-w-[150px]",children:le.fieldOfficerNames.join(", ")})]}),le.backendFieldOfficerNames&&le.backendFieldOfficerNames.length>0&&r.jsxs("div",{className:"flex items-start gap-1",title:"Backend Field Officers",children:[r.jsx("span",{className:"font-semibold text-primary-text whitespace-nowrap",children:"BFO:"}),r.jsx("span",{className:"truncate max-w-[150px]",children:le.backendFieldOfficerNames.join(", ")})]})]})}),r.jsx("td",{className:"px-6 py-4 text-right whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>P(le),title:"Manpower Details",children:r.jsx(Ni,{className:"w-4 h-4 text-blue-600"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>te(le),title:"Configure Site",children:r.jsx(Lm,{className:"w-4 h-4 text-gray-600"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>q(le),title:"Delete Site",children:r.jsx(rn,{className:"w-4 h-4 text-red-600"})})]})})]},le.id)})})]})})})]})},Die=({isOpen:n,onClose:e,onSave:t,title:s,initialName:i=""})=>{const[a,o]=k.useState(i),[l,c]=k.useState("");k.useEffect(()=>{n&&(o(i),c(""))},[n,i]);const d=()=>{if(!a.trim()){c("Role name cannot be empty.");return}t(a.trim()),e()};return n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-sm m-4 animate-fade-in-scale",onClick:h=>h.stopPropagation(),children:r.jsxs("form",{onSubmit:h=>{h.preventDefault(),d()},children:[r.jsx("h3",{className:"text-lg font-bold text-primary-text mb-4",children:s}),r.jsx(be,{label:"Role Display Name",id:"role-name",value:a,onChange:h=>o(h.target.value),error:l,autoFocus:!0}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx(se,{type:"button",onClick:e,variant:"secondary",children:"Cancel"}),r.jsx(se,{type:"submit",children:"Save"})]})]})})}):null},Ou=[{key:"apply_for_leave",name:"Apply for Leave",description:"Allows users to request time off."},{key:"create_enrollment",name:"Create Enrollment",description:"Access the multi-step form to onboard new employees."},{key:"view_developer_settings",name:"Developer Settings",description:"Access API settings and other developer tools."},{key:"download_attendance_report",name:"Download Attendance Report",description:"Generate and download attendance reports in CSV format."},{key:"manage_approval_workflow",name:"Manage Approval Workflow",description:"Set up reporting managers for leave approvals."},{key:"manage_attendance_rules",name:"Manage Attendance Rules",description:"Set work hours, holidays, and leave allocations."},{key:"manage_enrollment_rules",name:"Manage Enrollment Rules",description:"Set rules for ESI/GMC, manpower limits, and documents."},{key:"manage_insurance",name:"Manage Insurance",description:"Create and manage company insurance plans."},{key:"manage_leave_requests",name:"Manage Leave Requests",description:"Approve or reject leave requests for employees."},{key:"manage_modules",name:"Manage Modules",description:"Create, edit, and group permissions into modules."},{key:"manage_policies",name:"Manage Policies",description:"Create and manage company policies."},{key:"manage_roles_and_permissions",name:"Manage Roles & Permissions",description:"Access this page to edit role permissions."},{key:"manage_sites",name:"Manage Sites",description:"Create, edit, and delete organizations/sites."},{key:"manage_tasks",name:"Manage Tasks",description:"Create, assign, and manage all organizational tasks, including escalations."},{key:"manage_uniforms",name:"Manage Uniforms",description:"Manage uniform requests and site configurations."},{key:"manage_users",name:"Manage Users",description:"Create, edit, and delete user accounts."},{key:"view_operations_dashboard",name:"Operations Dashboard",description:"View the operations management dashboard."},{key:"view_site_dashboard",name:"Site Dashboard",description:"View the dashboard for a specific site/organization."},{key:"view_all_attendance",name:"View All Attendance",description:"Allows users to see attendance records for all employees."},{key:"view_all_submissions",name:"View All Submissions",description:"Access the main dashboard to view all employee submissions."},{key:"view_entity_management",name:"View Entity Management",description:"Access the HR dashboard for managing company entities."},{key:"view_field_officer_tracking",name:"View Field Officer Tracking",description:"Track user check-in/out locations and activity on a map."},{key:"view_invoice_summary",name:"View Invoice Summary",description:"View and generate monthly invoices for sites."},{key:"view_own_attendance",name:"View Own Attendance",description:"Allows users to see their own attendance records."},{key:"view_verification_costing",name:"View Verification Costing",description:"Analyze costs associated with third-party document verifications."}].sort((n,e)=>n.name.localeCompare(e.name)),Lie=()=>{const n=vt(),{permissions:e,setRolePermissions:t,addRolePermissionEntry:s,removeRolePermissionEntry:i,renameRolePermissionEntry:a}=ha(),[o,l]=k.useState([]),[c,d]=k.useState([]),[h,m]=k.useState(!0),[f,p]=k.useState(null),[b,x]=k.useState(!1),[v,S]=k.useState(!1),[B,V]=k.useState(null),[R,W]=k.useState(!1),[_,Y]=k.useState(null),j=k.useRef(null),M=jt("(max-width: 767px)");k.useEffect(()=>{(async()=>{m(!0);try{const[de,U]=await Promise.all([ce.getRoles(),ce.getModules()]);l(de),d(U.sort((P,ne)=>P.name.localeCompare(ne.name)))}catch(de){console.error("Failed to load data",de),p({message:"Failed to load page data.",type:"error"})}finally{m(!1)}})()},[]),k.useEffect(()=>{const q=de=>{j.current&&!j.current.contains(de.target)&&Y(null)};return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[]);const H=(q,de,U)=>{const P=e[q]||[],ne=U?[...P,de]:P.filter(K=>K!==de);t(q,ne)},D=async q=>{const de=q.toLowerCase().replace(/\s+/g,"_");if(R&&B){if(B.id==="admin"){p({message:"The Admin role cannot be renamed.",type:"error"});return}if(o.some(P=>P.id===de&&P.id!==B.id)){p({message:`A role with ID '${de}' already exists.`,type:"error"});return}const U=o.map(P=>P.id===B.id?{...P,displayName:q,id:de}:P);await ce.saveRoles(U),l(U),a(B.id,de),p({message:"Role renamed.",type:"success"})}else{if(o.some(ne=>ne.id===de)){p({message:`A role with ID '${de}' already exists.`,type:"error"});return}const U={id:de,displayName:q},P=[...o,U];await ce.saveRoles(P),l(P),s(U),p({message:"Role added successfully.",type:"success"})}},z=async()=>{if(!B||B.id==="admin"){p({message:"This role cannot be deleted.",type:"error"}),S(!1);return}const q=o.filter(de=>de.id!==B.id);await ce.saveRoles(q),l(q),i(B.id),p({message:`Role '${B.displayName}' deleted.`,type:"success"}),S(!1)},O=k.useMemo(()=>new Map(Ou.map(q=>[q.key,q])),[]),E=k.useMemo(()=>{const q=new Set(c.flatMap(de=>de.permissions));return Ou.filter(de=>!q.has(de.key))},[c]),te=q=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Permission",className:"px-4 py-4",children:r.jsxs("div",{className:"flex flex-col items-end text-right md:items-start md:text-left",children:[r.jsx("div",{className:"font-semibold text-primary-text",children:q.name}),r.jsx("div",{className:"text-xs text-muted",children:q.description})]})}),o.map(de=>{const U=e[de.id]?.includes(q.key),P=de.id==="admin",ne=P?"Admin role has all permissions by default and cannot be changed.":"";return r.jsx("td",{"data-label":de.displayName,className:"px-4 py-4 text-center align-middle",children:r.jsx("div",{className:"flex justify-center",children:r.jsxs("label",{className:`relative flex items-center justify-center w-5 h-5 ${P?"cursor-not-allowed":"cursor-pointer"}`,children:[r.jsx("input",{type:"checkbox",className:"sr-only peer",checked:U,onChange:K=>H(de.id,q.key,K.target.checked),disabled:P,title:ne}),r.jsx("span",{className:`w-5 h-5 bg-white border border-gray-300 rounded flex items-center justify-center peer-focus-visible:ring-2 peer-focus-visible:ring-offset-2 peer-focus-visible:ring-accent-dark peer-checked:border-accent ${P?"opacity-50":""}`,children:U?r.jsx(Rl,{className:"w-4 h-4 text-accent"}):r.jsx(Zi,{className:"w-4 h-4 text-red-500"})})]})})},de.id)})]},q.key);return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)}),r.jsx(Die,{isOpen:b,onClose:()=>x(!1),onSave:D,title:R?"Rename Role":"Add New Role",initialName:R?B?.displayName:""}),r.jsxs(tr,{isOpen:v,onClose:()=>S(!1),onConfirm:z,title:"Confirm Deletion",children:['Are you sure you want to delete the role "',B?.displayName,'"? This action cannot be undone.']}),r.jsx(ma,{title:"Role & Permission Management",children:r.jsxs("button",{onClick:()=>n("/admin/roles/add"),className:"btn btn-primary btn-md",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Role"]})}),r.jsx("p",{className:"text-muted text-sm -mt-4 mb-6",children:"Assign permissions to user roles. Changes are saved automatically."}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-4 py-3 text-left font-bold text-primary-text",children:"Permission"}),o.map(q=>r.jsx("th",{scope:"col",className:"px-4 py-3 text-center font-bold text-primary-text w-40",children:r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("span",{children:q.displayName}),q.id!=="admin"&&r.jsxs("div",{className:"relative",children:[r.jsx("button",{onClick:()=>Y(q.id===_?null:q.id),children:r.jsx(U6,{className:"h-4 w-4 text-muted"})}),_===q.id&&r.jsxs("div",{ref:j,className:"absolute right-0 mt-2 w-32 bg-card border rounded-md shadow-lg z-10",children:[r.jsxs("button",{onClick:()=>{n(`/admin/roles/edit/${q.id}`),Y(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-page flex items-center",children:[r.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edit"]}),r.jsxs("button",{onClick:()=>{V(q),S(!0),Y(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-page flex items-center text-red-600",children:[r.jsx(rn,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})},q.id))]})}),h?r.jsx("tbody",{children:M?r.jsx("tr",{children:r.jsx("td",{colSpan:o.length+1||2,children:r.jsx(Ea,{rows:3,cols:2,isMobile:!0})})}):r.jsx(Ea,{rows:10,cols:o.length+1||5})}):r.jsxs(r.Fragment,{children:[c.map(q=>r.jsxs("tbody",{className:"divide-y divide-border",children:[r.jsx("tr",{className:"bg-page/50",children:r.jsx("td",{colSpan:o.length+1,className:"p-2 font-bold text-primary-text",children:q.name})}),q.permissions.map(de=>{const U=O.get(de);return U?te(U):null})]},q.id)),E.length>0&&r.jsxs("tbody",{className:"divide-y divide-border",children:[r.jsx("tr",{className:"bg-page/50",children:r.jsx("td",{colSpan:o.length+1,className:"p-2 font-bold text-primary-text",children:"Uncategorized"})}),E.map(te)]})]})]})})]})},Pie=Bt({id:pe().required(),name:pe().required("Module name is required"),description:pe().required("Description is required"),permissions:Rr().of(pe().required()).min(1,"At least one permission must be selected")}).defined(),Kie=({isOpen:n,onClose:e,onSave:t,initialData:s})=>{const{register:i,handleSubmit:a,control:o,reset:l,formState:{errors:c}}=tn({resolver:Yn(Pie)});return k.useEffect(()=>{n&&l(s||{id:`mod_${Date.now()}`,name:"",description:"",permissions:[]})},[n,s,l]),n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card w-full max-w-2xl my-8 animate-fade-in-scale flex flex-col",onClick:d=>d.stopPropagation(),children:r.jsxs("form",{onSubmit:a(t),children:[r.jsx("div",{className:"p-4 border-b",children:r.jsxs("h3",{className:"text-xl font-bold",children:[s?"Edit":"Add"," Module"]})}),r.jsxs("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:[r.jsx(be,{label:"Module Name",...i("name"),error:c.name?.message}),r.jsx(be,{label:"Description",...i("description"),error:c.description?.message}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Permissions"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 p-4 border rounded-lg h-64 overflow-y-auto bg-page",children:r.jsx(ye,{name:"permissions",control:o,render:({field:d})=>r.jsx(r.Fragment,{children:Ou.map(h=>r.jsx(Nn,{id:`perm-${h.key}`,label:h.name,checked:d.value?.includes(h.key)||!1,onChange:m=>{const f=m?[...d.value||[],h.key]:(d.value||[]).filter(p=>p!==h.key);d.onChange(f)}},h.key))})})}),c.permissions&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:Array.isArray(c.permissions)?c.permissions[0]?.message:c.permissions.message})]})]}),r.jsxs("div",{className:"p-4 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:e,children:"Cancel"}),r.jsx(se,{type:"submit",children:"Save Module"})]})]})})}):null},Oie=({count:n=6})=>r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:n}).map((e,t)=>r.jsxs("div",{className:"bg-page p-4 rounded-lg border border-border flex flex-col space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx($s,{className:"h-5 w-5 rounded-full"}),r.jsx($s,{className:"h-5 w-1/2"})]}),r.jsx($s,{className:"h-4 w-full"}),r.jsx($s,{className:"h-4 w-3/4"}),r.jsx($s,{className:"h-3 w-1/4"})]},t))}),zie=()=>{const n=vt(),[e,t]=k.useState([]),[s,i]=k.useState(!0),[a,o]=k.useState(null),[l,c]=k.useState(!1),[d,h]=k.useState(!1),[m,f]=k.useState(null);k.useEffect(()=>{(async()=>{i(!0);try{const S=await ce.getModules();t(S)}catch{o({message:"Failed to load modules.",type:"error"})}finally{i(!1)}})()},[]);const p=async v=>{const S=[...e],B=S.findIndex(V=>V.id===v.id);B>-1?S[B]=v:S.push(v);try{await ce.saveModules(S),t(S.sort((V,R)=>V.name.localeCompare(R.name))),o({message:`Module '${v.name}' saved.`,type:"success"}),c(!1)}catch{o({message:"Failed to save module.",type:"error"})}},b=async()=>{if(!m)return;const v=e.filter(S=>S.id!==m.id);try{await ce.saveModules(v),t(v),o({message:`Module '${m.name}' deleted.`,type:"success"}),h(!1)}catch{o({message:"Failed to delete module.",type:"error"})}},x=async()=>{i(!0);const v=[{id:"mod_admin",name:"Admin & Access Control",description:"Permissions for managing users, roles, and system modules.",permissions:["manage_users","manage_roles_and_permissions","manage_modules"]},{id:"mod_billing",name:"Billing & Costing",description:"Permissions related to invoices and verification cost analysis.",permissions:["view_invoice_summary","view_verification_costing"]},{id:"mod_dashboards",name:"Dashboards & Tracking",description:"Access to various dashboards and user activity tracking.",permissions:["view_operations_dashboard","view_site_dashboard","view_field_officer_tracking"]},{id:"mod_self_service",name:"Employee Self-Service",description:"Basic permissions for all employees.",permissions:["view_own_attendance","apply_for_leave","download_attendance_report"]},{id:"mod_hr_tasks",name:"HR Tasks & Management",description:"Manage leaves, policies, insurance, uniforms, and tasks.",permissions:["manage_leave_requests","manage_policies","manage_insurance","manage_uniforms","manage_approval_workflow","view_all_attendance","manage_tasks"]},{id:"mod_office_staff",name:"Office Staff",description:"Office Staff permissions.",permissions:["view_all_attendance","view_all_submissions"]},{id:"mod_org_setup",name:"Organization & HR Setup",description:"Manage sites, clients, and rules for enrollment and attendance.",permissions:["view_entity_management","manage_attendance_rules","manage_enrollment_rules","manage_sites"]},{id:"mod_submissions",name:"Submissions & Verification",description:"View and manage employee onboarding submissions and approval workflows.",permissions:["view_all_submissions","create_enrollment"]},{id:"mod_support",name:"Support Desk",description:"Access and manage support tickets.",permissions:["access_support_desk"]},{id:"mod_system",name:"System & Developer",description:"Access developer settings and system configurations.",permissions:["view_developer_settings"]},{id:"mod_ops",name:"OPS",description:"OPS Management.",permissions:["manage_sites","manage_tasks"]}];try{await ce.saveModules(v),t(v.sort((S,B)=>S.name.localeCompare(B.name))),o({message:"Default modules seeded successfully.",type:"success"})}catch(S){console.error(S),o({message:"Failed to seed modules.",type:"error"})}finally{i(!1)}};return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[a&&r.jsx(It,{...a,onDismiss:()=>o(null)}),r.jsx(Kie,{isOpen:l,onClose:()=>c(!1),onSave:p,initialData:m}),r.jsxs(tr,{isOpen:d,onClose:()=>h(!1),onConfirm:b,title:"Confirm Deletion",children:['Are you sure you want to delete the module "',m?.name,'"?']}),r.jsx(ma,{title:"Module Management",children:r.jsxs(se,{onClick:()=>n("/admin/modules/add"),children:[r.jsx(Tt,{className:"mr-2 h-4"})," Add Module"]})}),s?r.jsx(Oie,{count:6}):e.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center border-2 border-dashed border-border rounded-xl bg-page/50",children:[r.jsx(Tu,{className:"h-12 w-12 text-muted mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-primary-text",children:"No Modules Found"}),r.jsx("p",{className:"text-muted max-w-sm mb-6",children:"It looks like the system hasn't been initialized with modules yet."}),r.jsx(se,{onClick:x,variant:"accent",children:"Initialize Default Modules"})]}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(v=>r.jsxs("div",{className:"bg-page p-4 rounded-lg border border-border flex flex-col",children:[r.jsxs("div",{className:"flex-grow",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(Tu,{className:"h-5 w-5 text-accent"}),r.jsx("h4",{className:"font-bold text-primary-text",children:v.name})]}),r.jsx("p",{className:"text-sm text-muted mb-3",children:v.description}),r.jsxs("p",{className:"text-xs font-semibold text-muted",children:[v.permissions.length," permissions"]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border flex justify-end gap-2",children:[r.jsx(se,{variant:"icon",onClick:()=>{f(v),c(!0)},title:`Edit ${v.name}`,className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:r.jsx(ms,{className:"h-5 w-5"})}),r.jsx(se,{variant:"icon",onClick:()=>{f(v),h(!0)},title:`Delete ${v.name}`,className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]},v.id))})]})},zS=({title:n,icon:e,children:t})=>r.jsxs("div",{className:"bg-page p-4 rounded-lg",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx(e,{className:"h-5 w-5 text-accent-dark mr-3"}),r.jsx("h4",{className:"font-semibold text-primary-text",children:n})]}),r.jsx("div",{className:"space-y-4",children:t})]}),Uie=({isOpen:n,onClose:e})=>{const{currentLogo:t,defaultLogo:s,setCurrentLogo:i,setDefaultLogo:a,resetToDefault:o,resetToOriginal:l}=Dm(),{backgroundImages:c,addBackgroundImage:d,removeBackgroundImage:h}=RH(),m=BH(),{appTitle:f,setAppTitle:p}=an(),[b,x]=k.useState(f),[v,S]=k.useState(null);ot.useEffect(()=>{x(f)},[f]);const B=async()=>{p(b);try{const{settings:j}=await ce.getInitialAppData(),M=j.apiSettings||{};await ce.updateSettings({apiSettings:{...M,appTitle:b}}),S({message:"Application title updated globally.",type:"success"})}catch(j){console.error("Failed to save app title:",j),S({message:"Title set locally, but failed to save globally.",type:"error"})}},V=j=>{if(j){const M=new FileReader;M.readAsDataURL(j.file),M.onloadend=()=>{const H=M.result;i(H),S({message:"Active logo updated!",type:"success"})},M.onerror=()=>{S({message:"Failed to read logo file.",type:"error"})}}},R=async()=>{a();try{const{settings:j}=await ce.getInitialAppData(),M=j.apiSettings||{};await ce.updateSettings({apiSettings:{...M,globalLogo:t}}),S({message:"Active logo has been set as the global default.",type:"success"})}catch(j){console.error("Failed to save global logo:",j),S({message:"Logo set locally, but failed to save globally.",type:"error"})}},W=()=>{o(),S({message:"Logo has been reset to your default.",type:"success"})},_=()=>{l(),S({message:"Logo has been reset to the system original.",type:"success"})},Y=j=>{if(j&&!j.url){const M=new FileReader;M.readAsDataURL(j.file),M.onloadend=()=>{const H=M.result,D=d(H);S(D?{message:"Background image added.",type:"success"}:{message:"This image has already been added.",type:"error"})},M.onerror=()=>{S({message:"Failed to read image file.",type:"error"})}}};return n?r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:[v&&r.jsx(It,{message:v.message,type:v.type,onDismiss:()=>S(null)}),r.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-4xl my-8 animate-fade-in-scale flex flex-col",onClick:j=>j.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Page Interface Settings"}),r.jsx(se,{variant:"icon",onClick:e,children:r.jsx(Zi,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-6 max-h-[75vh]",children:[r.jsxs(zS,{title:"Branding & Logo",icon:mH,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Manage the active and default logos for your application."}),r.jsxs("div",{className:"pt-2 pb-4 border-b mb-4",children:[r.jsx("h4",{className:"font-semibold text-primary-text mb-2",children:"Application Title"}),r.jsxs("div",{className:"flex gap-2 items-end",children:[r.jsx("div",{className:"flex-grow",children:r.jsx(be,{value:b,onChange:j=>x(j.target.value),placeholder:"Enter App Title (e.g. Paradigm Employee Onboarding)"})}),r.jsx(se,{onClick:B,children:"Save Title"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4 items-start",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:"Active Logo"}),r.jsx("div",{className:"p-4 border rounded-lg bg-page flex justify-center items-center min-h-[120px]",children:r.jsx("img",{src:t,alt:"Current Active Logo",className:"max-h-24 w-auto"})}),r.jsx(pt,{label:"Change Active Logo",file:null,onFileChange:V,allowedTypes:["image/jpeg","image/png"]})]}),r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:"Default Logo"}),r.jsx("div",{className:"p-4 border rounded-lg bg-page flex justify-center items-center min-h-[120px]",children:r.jsx("img",{src:s,alt:"Default Logo",className:"max-h-24 w-auto"})})]}),r.jsx("div",{className:"flex-grow"}),r.jsxs("div",{className:"space-y-2 mt-4",children:[r.jsx(se,{type:"button",className:"w-full",onClick:R,children:"Set Active Logo as Default"}),r.jsx(se,{type:"button",className:"w-full",variant:"outline",onClick:W,children:"Use Default Logo"}),r.jsx("div",{className:"text-center pt-2",children:r.jsx("button",{type:"button",onClick:_,className:"text-xs text-muted hover:text-primary-text underline",children:"Reset to System Original"})})]})]})]})]}),r.jsxs(zS,{title:"Login Screen Background",icon:IH,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Manage the background images for the login screen carousel."}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:c.map((j,M)=>r.jsxs("div",{className:"relative group aspect-video bg-page rounded-md overflow-hidden",children:[r.jsx("img",{src:j,className:"w-full h-full object-cover",alt:`Background ${M+1}`}),r.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:r.jsx(se,{variant:"icon",onClick:()=>h(M),className:"!rounded-full !bg-white/20 hover:!bg-white/40",children:r.jsx(rn,{className:"h-5 w-5 text-white"})})})]},`${j.substring(0,30)}-${M}`))}),r.jsx("div",{className:"mt-4",children:r.jsx(pt,{label:"Add new background image",file:null,onFileChange:Y,allowedTypes:["image/jpeg","image/png","image/webp"]})})]}),r.jsxs(zS,{title:"Interaction Settings",icon:d$,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Customize hover and auto-scroll behaviors for easier navigation."}),r.jsxs("div",{className:"space-y-4 pt-4",children:[r.jsx(Nn,{id:"auto-click-hover-modal",label:"Enable Auto-Click on Hover",description:"Automatically switch tabs or pages by hovering over them.",checked:m.autoClickOnHover,onChange:j=>m.setAutoClickOnHover(j.target.checked)}),r.jsx(Nn,{id:"auto-scroll-hover-modal",label:"Enable Auto-Scroll on Hover",description:"Automatically scroll the page by hovering over the up/down arrows.",checked:m.autoScrollOnHover,onChange:j=>m.setAutoScrollOnHover(j.target.checked)})]})]})]}),r.jsx("div",{className:"p-4 border-t flex justify-end",children:r.jsx(se,{variant:"primary",onClick:e,children:"Done"})})]})]}):null},ng=({title:n,icon:e,children:t,className:s})=>r.jsxs("div",{className:`border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card ${s||""}`,children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(e,{className:"h-6 w-6 text-accent-dark"})}),r.jsx("div",{children:r.jsx("h3",{className:"text-lg font-bold text-primary-text",children:n})})]}),r.jsx("div",{className:"space-y-4",children:t})]}),Qie=()=>{const n=wi(),{colorScheme:e,setColorScheme:t}=an(),[s,i]=k.useState(!1),[a,o]=k.useState(null),[l,c]=k.useState(!1),[d,h]=k.useState(!1),m=async()=>{i(!0),o(null);try{const b=await ce.exportAllData(),x=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(b,null,2))}`,v=document.createElement("a");v.href=x,v.download=`paradigm_backup_${new Date().toISOString()}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),o({message:"Data exported successfully!",type:"success"})}catch{o({message:"Failed to export data.",type:"error"})}finally{i(!1)}},f={green:"Paradigm Green",purple:"Royal Purple",red:"Crimson Red",amber:"Amber Gold","professional-blue":"Professional Blue","dark-saas":"Dark SaaS","teal-mint":"Teal & Mint","indigo-violet":"Indigo & Violet","green-finance":"Green Finance","orange-energy":"Orange Energy","red-alert":"Red Alert","neutral-gray":"Neutral Gray","cyan-tech":"Cyan Tech","black-gold":"Premium Black & Gold"},p=async(b,x)=>{if(t(b),x!==void 0?x:d)try{const{settings:S}=await ce.getInitialAppData(),B=S.apiSettings||{};await ce.updateSettings({apiSettings:{...B,colorScheme:b}}),o({message:`Global theme updated to ${f[b]}!`,type:"success"})}catch(S){console.error("Failed to save theme globally:",S),o({message:"Failed to save theme setting globally.",type:"error"})}else o({message:`Color scheme changed to ${f[b]}!`,type:"success"})};return r.jsxs("div",{className:"space-y-8 p-4 md:p-0",children:[a&&r.jsx(It,{message:a.message,type:a.type,onDismiss:()=>o(null)}),r.jsx(Uie,{isOpen:l,onClose:()=>c(!1)}),r.jsx("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"System Settings"})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:[r.jsxs("div",{className:"space-y-8",children:[r.jsxs(ng,{title:"Color Scheme",icon:m$,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Choose the application's primary color scheme."}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-4",children:[[{id:"green",label:"Paradigm Green",desc:"Nature theme",color:"#006B3F",border:"border-green-500",bg:"bg-green-50",ring:"ring-green-200",icon:"P"},{id:"professional-blue",label:"Professional Blue",desc:"Enterprise / Admin",color:"#2563EB",border:"border-blue-600",bg:"bg-blue-50",ring:"ring-blue-200",icon:"B"},{id:"purple",label:"Royal Purple",desc:"Premium theme",color:"#5B21B6",border:"border-purple-500",bg:"bg-purple-50",ring:"ring-purple-200",icon:"R"},{id:"red",label:"Crimson Red",desc:"Bold theme",color:"#991B1B",border:"border-red-500",bg:"bg-red-50",ring:"ring-red-200",icon:"C"},{id:"amber",label:"Amber Gold",desc:"Warm theme",color:"#B45309",border:"border-orange-500",bg:"bg-orange-50",ring:"ring-orange-200",icon:"A"},{id:"dark-saas",label:"Dark SaaS",desc:"Modern / Developer",color:"#0F172A",border:"border-slate-800",bg:"bg-slate-900",ring:"ring-slate-700",icon:"D"},{id:"teal-mint",label:"Teal & Mint",desc:"Health / Facility",color:"#0D9488",border:"border-teal-500",bg:"bg-teal-50",ring:"ring-teal-200",icon:"T"},{id:"indigo-violet",label:"Indigo & Violet",desc:"HR / Productivity",color:"#4F46E5",border:"border-indigo-500",bg:"bg-indigo-50",ring:"ring-indigo-200",icon:"I"},{id:"green-finance",label:"Green Finance",desc:"Billing / Payroll",color:"#15803D",border:"border-emerald-600",bg:"bg-emerald-50",ring:"ring-emerald-200",icon:"G"},{id:"orange-energy",label:"Orange Energy",desc:"Operations / Field",color:"#EA580C",border:"border-orange-600",bg:"bg-orange-50",ring:"ring-orange-200",icon:"O"},{id:"red-alert",label:"Red Alert",desc:"Security / Critical",color:"#DC2626",border:"border-red-600",bg:"bg-red-50",ring:"ring-red-200",icon:"R"},{id:"neutral-gray",label:"Neutral Gray",desc:"Minimal / Data",color:"#374151",border:"border-gray-500",bg:"bg-gray-50",ring:"ring-gray-200",icon:"N"},{id:"cyan-tech",label:"Cyan Tech",desc:"Smart Systems",color:"#0891B2",border:"border-cyan-500",bg:"bg-cyan-50",ring:"ring-cyan-200",icon:"C"},{id:"black-gold",label:"Premium Black & Gold",desc:"Management / Exec",color:"#111827",border:"border-yellow-600",bg:"bg-gray-900",ring:"ring-yellow-500",icon:"G"}].map(b=>r.jsxs("button",{type:"button",onClick:()=>p(b.id),className:`flex items-center gap-3 p-4 rounded-xl border-2 transition-all ${e===b.id?`${b.border} ${b.bg} ring-2 ${b.ring}`:"border-border hover:border-gray-300"}`,children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:b.color},children:r.jsx("span",{className:`font-bold text-sm ${["dark-saas","black-gold"].includes(b.id),"text-white"}`,children:b.icon})}),r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:`font-semibold ${["dark-saas","black-gold"].includes(b.id)&&e===b.id,"text-primary-text"}`,children:b.label}),r.jsx("p",{className:"text-xs text-muted",children:b.desc})]})]},b.id)),r.jsx("div",{className:"col-span-1 sm:col-span-2 mt-4 pt-4 border-t border-border",children:r.jsx(Nn,{id:"global-theme-default",label:"Set as Global Default",description:"If checked, the selected color scheme will be applied to all users who haven't set a preference.",checked:d,onChange:b=>{const x=b.target.checked;h(x),x&&p(e,!0)}})})]})]}),r.jsxs(ng,{title:"Page Interface",icon:mH,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Customize the application's branding, login screen, and user interaction settings."}),r.jsx("div",{className:"pt-4",children:r.jsx(se,{type:"button",onClick:()=>c(!0),children:"Open Interface Settings"})})]}),r.jsxs(ng,{title:"Verification APIs",icon:Nm,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Configure third-party services for employee verification."}),r.jsxs("div",{className:"space-y-6 pt-4",children:[r.jsx("div",{className:"p-4 border border-border rounded-lg api-setting-item-bg",children:r.jsx(Nn,{id:"gemini-enabled",label:"Enable Gemini API OCR Verification",description:"Use Google's Gemini API for document data extraction. This is a powerful fallback or primary OCR. API key must be configured on the backend.",checked:n.geminiApi.enabled,onChange:b=>n.updateGeminiApiSettings({enabled:b.target.checked})})}),r.jsxs("div",{className:"p-4 border border-border rounded-lg api-setting-item-bg",children:[r.jsx(Nn,{id:"perfios-enabled",label:"Enable Perfios API Verification",description:"Use Perfios for Bank, Aadhaar, and UAN verification.",checked:n.perfiosApi.enabled,onChange:b=>n.updatePerfiosApiSettings({enabled:b.target.checked})}),r.jsxs("div",{className:`mt-4 space-y-4 transition-opacity ${n.perfiosApi.enabled?"opacity-100":"opacity-50 pointer-events-none"}`,children:[r.jsx(be,{label:"Perfios Client ID",value:n.perfiosApi.clientId,onChange:b=>n.updatePerfiosApiSettings({clientId:b.target.value})}),r.jsx(be,{label:"Perfios Client Secret",type:"password",value:n.perfiosApi.clientSecret,onChange:b=>n.updatePerfiosApiSettings({clientSecret:b.target.value})})]})]})]})]}),r.jsxs(ng,{title:"Authentication Settings",icon:Eu,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Manage how users sign in to the application."}),r.jsx("div",{className:"space-y-6 pt-4",children:r.jsx(Nn,{id:"otp-enabled",label:"Enable OTP Phone Sign-In",description:"Allow users to sign in using a one-time password sent via SMS.",checked:n.otp.enabled,onChange:b=>n.updateOtpSettings({enabled:b.target.checked})})})]})]}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs(ng,{title:"Client & Site Management",icon:oa,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Control workflows for site creation and management."}),r.jsx("div",{className:"space-y-6 pt-4",children:r.jsx(Nn,{id:"enable-provisional-sites",label:"Enable Provisional Site Creation",description:"Allows HR/Admins to create a site with just a name, providing a 90-day grace period to complete the full configuration for easier onboarding.",checked:n.siteManagement.enableProvisionalSites,onChange:b=>n.updateSiteManagementSettings({enableProvisionalSites:b.target.checked})})})]}),r.jsxs(ng,{title:"System & Data",icon:Lm,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Manage core system settings and data operations."}),r.jsxs("div",{className:"space-y-6 pt-4",children:[r.jsx(Nn,{id:"pincode-verification",label:"Enable Pincode API Verification",description:"Auto-fill City/State from pincode during onboarding.",checked:n.address.enablePincodeVerification,onChange:b=>n.updateAddressSettings({enablePincodeVerification:b.target.checked})}),r.jsxs("div",{className:"pt-4 border-t",children:[r.jsx("h4",{className:"font-semibold text-primary-text mb-2",children:"Backup & Export"}),r.jsx("p",{className:"text-sm text-muted mb-4",children:"Download all data from the active data source (Mock Data)."}),r.jsxs(se,{type:"button",variant:"outline",onClick:m,isLoading:s,children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export All Data"]})]})]})]}),r.jsxs(ng,{title:"Notification Settings",icon:th,children:[r.jsx("p",{className:"text-sm text-muted -mt-2",children:"Configure how the system sends notifications."}),r.jsx("div",{className:"space-y-6 pt-4",children:r.jsx(Nn,{id:"email-notif-enabled",label:"Enable Email Notifications",description:"Send emails for important events like task assignments. SMTP must be configured on the backend.",checked:n.notifications.email.enabled,onChange:b=>n.updateNotificationSettings({email:{enabled:b.target.checked}})})})]})]})]})]})},Xs=({title:n,subtitle:e})=>r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text form-header-title",children:n}),r.jsx("p",{className:"mt-2 text-sm text-muted",children:e})]}),qie=({title:n,value:e,icon:t})=>r.jsxs("div",{className:"p-4 rounded-2xl flex flex-col md:flex-row items-start md:items-center col-span-1 gap-3 md:gap-0 transition-colors bg-card shadow-sm",children:[r.jsx("div",{className:"p-3 rounded-full md:mr-4 bg-accent-light",children:r.jsx(t,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted",children:n}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:e})]})]}),ko=ot.memo(qie),$ie=()=>{const n=vt(),{colorScheme:e}=an(),t=Is(e),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState([]),[d,h]=k.useState(!0),[m,f]=k.useState(null),[p,b]=k.useState([{startDate:new Date(new Date().setMonth(new Date().getMonth()-1)),endDate:new Date,key:"selection"}]),[x,v]=k.useState(!1),[S,B]=k.useState(""),[V,R]=k.useState(""),[W,_]=k.useState(He(new Date,"yyyy-MM-dd"));k.useEffect(()=>{(async()=>{h(!0);try{const[z,O,E]=await Promise.all([ce.getVerificationSubmissions(),ce.getFieldOfficers(),ce.getOrganizations()]);i(z),o(O),c(E)}catch{f({message:"Failed to load dashboard data.",type:"error"})}finally{h(!1)}})()},[]);const Y=k.useMemo(()=>{const D=p[0].startDate,z=p[0].endDate;if(!D||!z)return s;const O=new Date(z);return O.setHours(23,59,59,999),s.filter(E=>{const te=new Date(E.enrollmentDate.replace(/-/g,"/"));return te>=D&&te<=O})},[s,p]),j=k.useMemo(()=>({total:Y.length,verified:Y.filter(D=>D.status==="verified").length,rejected:Y.filter(D=>D.status==="rejected").length}),[Y]),M=async D=>{if(D.preventDefault(),!S||!V||!W){f({message:"Please fill all fields for assignment.",type:"error"});return}try{await ce.createAssignment(S,V,W),f({message:"Assignment created successfully (mocked).",type:"success"})}catch{f({message:"Failed to create assignment.",type:"error"})}},H=p[0].startDate&&p[0].endDate?`${He(p[0].startDate,"MMM d, yyyy")} - ${He(p[0].endDate,"MMM d, yyyy")}`:"Select Date";return r.jsxs("div",{className:"p-4 space-y-8",children:[m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)}),r.jsx("div",{className:"bg-card p-4 rounded-2xl",children:r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Operations Dashboard"}),r.jsxs("div",{className:"relative",children:[r.jsxs(se,{variant:"outline",onClick:()=>v(!x),children:[r.jsx(ra,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:H})]}),x&&r.jsx("div",{className:"absolute top-full right-0 mt-2 z-10 bg-card border rounded-lg shadow-lg",children:r.jsx(Wm.DateRangePicker,{onChange:D=>{b([D.selection]),v(!1)},months:1,ranges:p,direction:"horizontal"})})]})]})}),r.jsx("div",{className:"bg-gradient-to-br from-accent/10 to-accent/5 border-2 border-accent/30 rounded-2xl p-6 cursor-pointer hover:border-accent hover:shadow-lg transition-all group",onClick:()=>n("/operations/team-activity"),children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"bg-accent rounded-xl p-3 group-hover:scale-110 transition-transform",children:r.jsx(sm,{className:"h-6 w-6 text-white"})}),r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Team Activity Monitor"})]}),r.jsx("p",{className:"text-muted mb-4",children:"Track your field team in real-time. Monitor check-ins, working hours, locations, and communicate instantly with your team members."}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("span",{className:"px-3 py-1 bg-green-500/10 text-green-600 rounded-full text-xs font-medium",children:"Real-time tracking"}),r.jsx("span",{className:"px-3 py-1 bg-blue-500/10 text-blue-600 rounded-full text-xs font-medium",children:"Location monitoring"}),r.jsx("span",{className:"px-3 py-1 bg-purple-500/10 text-purple-600 rounded-full text-xs font-medium",children:"Quick communication"})]})]}),r.jsx("div",{className:"flex-shrink-0 ml-4",children:r.jsx(se,{onClick:D=>{D.stopPropagation(),n("/operations/team-activity")},style:{backgroundColor:t.activeItemBg,color:"#FFFFFF"},children:"View Team Activity "})})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx(ko,{title:"Total Submissions",value:j.total,icon:Cr}),r.jsx(ko,{title:"Verified Employees",value:j.verified,icon:Sg}),r.jsx(ko,{title:"Rejected Applications",value:j.rejected,icon:Of})]}),r.jsxs("div",{className:"bg-card p-6 rounded-2xl",children:[r.jsx(Xs,{title:"Assign Field Officer",subtitle:"Assign a field officer to an organization for a specific date."}),r.jsxs("form",{onSubmit:M,className:"grid grid-cols-1 md:grid-cols-4 gap-6 items-end",children:[r.jsx("div",{className:"md:col-span-1",children:r.jsxs(Oe,{label:"Field Officer",id:"officer",value:S,onChange:D=>B(D.target.value),children:[r.jsx("option",{value:"",children:"Select Officer"}),a.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]})}),r.jsx("div",{className:"md:col-span-1",children:r.jsxs(Oe,{label:"Organization/Site",id:"site",value:V,onChange:D=>R(D.target.value),children:[r.jsx("option",{value:"",children:"Select Site"}),l.map(D=>r.jsx("option",{value:D.id,children:D.shortName},D.id))]})}),r.jsx("div",{className:"md:col-span-1",children:r.jsx(Vn,{label:"Assignment Date",id:"assignmentDate",value:W,onChange:_})}),r.jsx("div",{className:"md:col-span-1",children:r.jsxs(se,{type:"submit",className:"w-full",children:[r.jsx(CG,{className:"mr-2 h-4 w-4"}),"Assign"]})})]})]})]})},eae=()=>{const{user:n}=bt(),{colorScheme:e}=an(),t=Is(e),[s,i]=k.useState([]),[a,o]=k.useState(!0),[l,c]=k.useState(null),d=jt("(max-width: 767px)");k.useEffect(()=>{h();const v=setInterval(h,3e4);return()=>clearInterval(v)},[n]);const h=async()=>{if(n)try{o(!0);const v=await ce.getUsers();let S=[];n.role==="admin"||n.role==="developer"?S=v.filter(W=>W.role==="operation_manager"||W.role==="field_officer"):n.role==="operation_manager"&&(S=v.filter(W=>W.role==="field_officer"&&W.reportingManagerId===n.id));const B=new Date;B.setHours(0,0,0,0);const V=new Date;V.setHours(23,59,59,999);const R=await Promise.all(S.map(async W=>{try{const Y=(await ce.getAttendanceEvents(W.id,B.toISOString(),V.toISOString())).sort((E,te)=>new Date(te.timestamp).getTime()-new Date(E.timestamp).getTime()),j=Y.filter(E=>E.type.toLowerCase().replace(/[-_\s]/g,"")==="checkin"),M=Y.filter(E=>E.type.toLowerCase().replace(/[-_\s]/g,"")==="checkout"),H=j[0],D=M[0];let z=0;for(let E=0;E<M.length;E++){const te=M[E],q=j.find(de=>new Date(de.timestamp)<new Date(te.timestamp));if(q){const de=new Date(te.timestamp).getTime()-new Date(q.timestamp).getTime();z+=de/(1e3*60*60)}}const O=H&&(!D||new Date(H.timestamp)>new Date(D.timestamp));if(O&&H){const E=Date.now()-new Date(H.timestamp).getTime();z+=E/(1e3*60*60)}return{...W,lastCheckIn:H?.timestamp,lastCheckOut:D?.timestamp,currentLocation:H?{latitude:H.latitude||0,longitude:H.longitude||0,address:H.address||void 0}:void 0,todayWorkingHours:z,todayTravelDistance:0,isCurrentlyWorking:O,isPresent:j.length>0}}catch(_){return console.error(`Error fetching data for ${W.name}:`,_),{...W,isPresent:!1,isCurrentlyWorking:!1}}}));i(R)}catch(v){console.error("Error fetching team members:",v)}finally{o(!1)}},m=v=>{if(!v)return;const S=v.replace(/\D/g,"").slice(-10);window.location.href=`tel:+91${S}`},f=v=>{if(!v)return;const S=v.replace(/\D/g,"").slice(-10);window.location.href=`sms:+91${S}`},p=v=>{if(!v)return"0h 0m";const S=Math.floor(v),B=Math.floor((v-S)*60);return`${S}h ${B}m`};if(a)return r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})});const b=({member:v})=>r.jsx("div",{className:"bg-card border border-border rounded-xl p-4 hover:border-accent transition-all cursor-pointer",onClick:()=>c(v),children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(ia,{photoUrl:v.photoUrl,seed:v.id,className:"w-12 h-12 rounded-full"}),r.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 block h-4 w-4 rounded-full ring-2 ring-white ${v.isCurrentlyWorking?"bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.8)]":v.isPresent?"bg-yellow-500 shadow-[0_0_10px_rgba(234,179,8,0.8)]":"bg-gray-400"}`})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-bold text-primary-text truncate",children:v.name}),r.jsx("p",{className:"text-xs text-muted",children:v.role.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase())}),r.jsxs("div",{className:"mt-2 space-y-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-xs",children:v.isCurrentlyWorking?r.jsxs(r.Fragment,{children:[r.jsx(sm,{className:"h-3 w-3 text-green-500"}),r.jsx("span",{className:"text-green-500 font-medium",children:"Working"})]}):v.isPresent?r.jsxs(r.Fragment,{children:[r.jsx(N2,{className:"h-3 w-3 text-yellow-500"}),r.jsx("span",{className:"text-yellow-500",children:"Checked Out"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Gm,{className:"h-3 w-3 text-gray-400"}),r.jsx("span",{className:"text-gray-400",children:"Absent"})]})}),v.todayWorkingHours>0&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted",children:[r.jsx(jo,{className:"h-3 w-3"}),r.jsx("span",{children:p(v.todayWorkingHours)})]})]})]}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:S=>{S.stopPropagation(),m(v.phone)},className:"hover:bg-accent/10",style:{backgroundColor:t.activeItemBg,color:"#FFFFFF"},children:r.jsx(Eu,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:S=>{S.stopPropagation(),f(v.phone)},className:"hover:bg-accent/10",style:{backgroundColor:t.activeItemBg,color:"#FFFFFF"},children:r.jsx(Bm,{className:"h-4 w-4"})})]})]})}),x=({member:v})=>r.jsxs("div",{className:"bg-card border border-border rounded-xl p-6",children:[r.jsxs("div",{className:"flex items-start justify-between mb-6",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ia,{photoUrl:v.photoUrl,seed:v.id,className:"w-16 h-16 rounded-full"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:v.name}),r.jsx("p",{className:"text-sm text-muted",children:v.role.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase())})]})]}),d&&r.jsx(se,{variant:"secondary",size:"sm",onClick:()=>c(null),children:"Close"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Kf,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Last Check In"})]}),r.jsx("p",{className:"text-sm font-bold text-primary-text",children:v.lastCheckIn?He(new Date(v.lastCheckIn),"hh:mm a"):"Not checked in"}),v.lastCheckIn&&r.jsx("p",{className:"text-xs text-muted mt-1",children:Vl(new Date(v.lastCheckIn),{addSuffix:!0})})]}),r.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(No,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Last Check Out"})]}),r.jsx("p",{className:"text-sm font-bold text-primary-text",children:v.lastCheckOut?He(new Date(v.lastCheckOut),"hh:mm a"):"Not checked out"}),v.lastCheckOut&&r.jsx("p",{className:"text-xs text-muted mt-1",children:Vl(new Date(v.lastCheckOut),{addSuffix:!0})})]}),r.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(jo,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Working Hours Today"})]}),r.jsx("p",{className:"text-lg font-bold text-primary-text",children:p(v.todayWorkingHours)})]}),r.jsxs("div",{className:"bg-accent/5 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(sm,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Status"})]}),r.jsx("p",{className:`text-lg font-bold ${v.isCurrentlyWorking?"text-green-500":v.isPresent?"text-yellow-500":"text-gray-400"}`,children:v.isCurrentlyWorking?"Working":v.isPresent?"Checked Out":"Absent"})]})]}),v.currentLocation&&r.jsxs("div",{className:"bg-accent/5 rounded-lg p-4 mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Bi,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Current Location"})]}),r.jsx("p",{className:"text-sm text-primary-text",children:v.currentLocation.address||"Location not available"}),v.currentLocation.latitude!==0&&r.jsx("a",{href:`https://www.google.com/maps?q=${v.currentLocation.latitude},${v.currentLocation.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent hover:underline mt-2 inline-block",children:"View on map "})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(se,{onClick:()=>m(v.phone),className:"flex-1",style:{backgroundColor:t.activeItemBg,color:"#FFFFFF"},children:[r.jsx(Eu,{className:"h-4 w-4 mr-2"}),"Call"]}),r.jsxs(se,{onClick:()=>f(v.phone),className:"flex-1",style:{backgroundColor:t.activeItemBg,color:"#FFFFFF"},children:[r.jsx(Bm,{className:"h-4 w-4 mr-2"}),"Message"]})]})]});return r.jsxs("div",{className:"p-4 lg:p-8 space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-primary-text",children:"Team Activity"}),r.jsx("p",{className:"text-sm text-muted mt-1",children:n?.role==="operation_manager"?"Monitor your field team in real-time":"Monitor all operation managers and field officers"})]}),r.jsxs(se,{onClick:h,variant:"secondary",size:"sm",children:[r.jsx(sm,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Jl,{className:"h-4 w-4 text-accent"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Total Team"})]}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:s.length})]}),r.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(sm,{className:"h-4 w-4 text-green-500"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Working Now"})]}),r.jsx("p",{className:"text-2xl font-bold text-green-500",children:s.filter(v=>v.isCurrentlyWorking).length})]}),r.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(N2,{className:"h-4 w-4 text-yellow-500"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Present"})]}),r.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:s.filter(v=>v.isPresent).length})]}),r.jsxs("div",{className:"bg-card border border-border rounded-xl p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Gm,{className:"h-4 w-4 text-gray-400"}),r.jsx("span",{className:"text-xs font-medium text-muted",children:"Absent"})]}),r.jsx("p",{className:"text-2xl font-bold text-gray-400",children:s.filter(v=>!v.isPresent).length})]})]}),d&&l?r.jsx(x,{member:l}):r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsx("div",{className:"lg:col-span-2 space-y-3",children:s.length===0?r.jsxs("div",{className:"bg-card border border-border rounded-xl p-12 text-center",children:[r.jsx(Jl,{className:"h-12 w-12 mx-auto text-muted mb-4 opacity-50"}),r.jsx("p",{className:"text-muted",children:"No team members found"})]}):s.map(v=>r.jsx(b,{member:v},v.id))}),!d&&l&&r.jsx("div",{className:"lg:col-span-1 sticky top-6 self-start",children:r.jsx(x,{member:l})})]})]})},tae=({status:n})=>{if(!n)return r.jsx("span",{className:"text-sm font-medium text-muted",children:"-"});const e={pending_sync:"sync-chip--pending_sync",synced:"sync-chip--synced",failed:"sync-chip--failed"},t={pending_sync:"Pending Sync",synced:"Synced",failed:"Failed"},s=e[n];return r.jsx("span",{className:`sync-chip ${s}`,children:t[n]})},nae=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),[i,a]=k.useState("all"),[o,l]=k.useState(""),[c,d]=k.useState(null),h=vt(),{user:m}=bt(),f=jt("(max-width: 767px)"),{colorScheme:p}=an(),b=Is(p),[x,v]=k.useState([]),[S,B]=k.useState(m?.organizationId),V=m&&m.role==="admin";k.useEffect(()=>{V&&ce.getOrganizations().then(j=>{v(j),j.length>0&&!S&&B(j[0].id)})},[V,S]);const R=k.useCallback(async()=>{if(!S){m?.organizationId&&s(!1);return}s(!0);try{const j=await ce.getVerificationSubmissions(i==="all"?void 0:i,S);e(j)}catch(j){console.error("Failed to fetch submissions",j)}finally{s(!1)}},[i,S,m?.organizationId]);k.useEffect(()=>{R()},[R]);const W=k.useMemo(()=>n.filter(j=>j.personal.firstName.toLowerCase().includes(o.toLowerCase())||j.personal.lastName.toLowerCase().includes(o.toLowerCase())||j.personal.employeeId.toLowerCase().includes(o.toLowerCase())),[n,o]),_=x.find(j=>j.id===S)?.shortName||m?.organizationName,Y=["all","pending","verified","rejected"];return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[c&&r.jsx(It,{message:c.message,type:c.type,onDismiss:()=>d(null)}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Site Dashboard"}),r.jsxs("p",{className:"text-muted",children:["Viewing submissions for site: ",r.jsx("span",{className:"font-semibold text-accent-dark",children:_||"N/A"})]})]}),!f&&r.jsxs("div",{className:"flex items-center gap-4",children:[V&&r.jsx("div",{className:"w-full sm:w-56",children:r.jsxs(Oe,{label:"",id:"org-selector",value:S||"",onChange:j=>B(j.target.value),children:[r.jsx("option",{value:"",children:"Select a Site"}),x.map(j=>r.jsx("option",{value:j.id,children:j.shortName},j.id))]})}),r.jsxs(se,{onClick:()=>h("/onboarding/select-organization"),style:{backgroundColor:b.activeItemBg,color:"#FFFFFF",borderColor:b.sidebarBorder},className:"border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(nd,{className:"mr-2 h-4 w-4"}),"New Enrollment"]})]})]}),f&&r.jsxs("div",{className:"flex flex-col gap-4 mt-6",children:[V&&r.jsxs(Oe,{label:"Select Site",id:"org-selector-mobile",value:S||"",onChange:j=>B(j.target.value),children:[r.jsx("option",{value:"",children:"Select a Site"}),x.map(j=>r.jsx("option",{value:j.id,children:j.shortName},j.id))]}),r.jsxs(se,{onClick:()=>h("/onboarding/select-organization"),style:{backgroundColor:b.activeItemBg,color:"#FFFFFF",borderColor:b.sidebarBorder},className:"w-full justify-center border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(nd,{className:"mr-2 h-4 w-4"}),"New Enrollment"]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center my-6 gap-4",children:[r.jsx("div",{className:"w-full sm:w-auto border-b border-border",children:r.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:Y.map(j=>r.jsx("button",{onClick:()=>a(j),className:`${i===j?"border-emerald-500 text-emerald-700":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm capitalize transition-colors duration-200`,children:j},j))})}),r.jsxs("div",{className:"relative w-full sm:w-auto sm:max-w-xs",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(la,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"text",placeholder:"Search by name or ID...",value:o,onChange:j=>l(j.target.value),className:"block w-full pl-10 pr-3 py-2 border border-border rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-accent focus:border-accent sm:text-sm"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Employee"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Status"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Portal Sync"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{children:t?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Loading submissions..."})}):S?W.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"No submissions found for this site."})}):W.map(j=>r.jsxs("tr",{children:[r.jsxs("td",{"data-label":"Employee",className:"px-6 py-4 whitespace-nowrap",children:[r.jsxs("div",{className:"text-sm font-medium text-primary-text",children:[j.personal.firstName," ",j.personal.lastName]}),r.jsx("div",{className:"text-sm text-muted",children:j.personal.employeeId})]}),r.jsx("td",{"data-label":"Status",className:"px-6 py-4 whitespace-nowrap",children:r.jsx(GG,{status:j.status})}),r.jsx("td",{"data-label":"Portal Sync",className:"px-6 py-4 whitespace-nowrap",children:r.jsx(tae,{status:j.portalSyncStatus})}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>h(`/onboarding/add/personal?id=${j.id}`),title:"View/Edit Details",children:r.jsx(jl,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>h(`/onboarding/pdf/${j.id}`),title:"Download Forms",children:r.jsx(Cr,{className:"h-4 w-4"})})]})})]},j.id)):r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Please select a site to view submissions."})})})]})})]})},ZZ=({file:n,onFileChange:e})=>{const[t,s]=k.useState(!1),[i,a]=k.useState(""),[o,l]=k.useState(!1),c=k.useCallback(async p=>{if(p&&p.type.startsWith("image/")){a("");const b={name:p.name,type:p.type,size:p.size,preview:URL.createObjectURL(p),file:p};e(b)}},[e]),d=async p=>{const b=p.target.files?.[0];b&&c(b)},h=k.useCallback(async(p,b)=>{const x=await(await fetch(`data:${b};base64,${p}`)).blob(),v=new File([x],`capture-${Date.now()}.jpg`,{type:b});c(v)},[c]),m=()=>{n&&URL.revokeObjectURL(n.preview),e(null),a("")},f="avatar-upload";return r.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[o&&r.jsx(BG,{isOpen:o,onClose:()=>l(!1),onCapture:h,captureGuidance:"profile"}),r.jsxs("div",{className:"relative w-40 h-40",children:[r.jsx("div",{className:`w-full h-full rounded-full bg-page flex items-center justify-center overflow-hidden border-2 transition-colors ${i?"border-red-500":"border-border"}`,children:t?r.jsxs("div",{className:"flex flex-col items-center text-muted",children:[r.jsx(xt,{className:"h-8 w-8 animate-spin"}),r.jsx("span",{className:"text-xs mt-2",children:"Processing..."})]}):n?.preview?r.jsx("img",{src:n.preview,alt:"Profile preview",className:"w-full h-full object-cover"}):r.jsx(ia,{})}),n&&!t&&r.jsx("button",{type:"button",onClick:m,id:"avatar-delete-button",className:"avatar-delete-btn btn-icon absolute top-2 right-2 p-1.5 rounded-full transition-colors !bg-white/90 !text-red-600 hover:!bg-red-100","aria-label":"Remove photo",children:r.jsx(rn,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("label",{htmlFor:f,className:`cursor-pointer inline-flex items-center justify-center font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200 rounded-full bg-accent text-white hover:bg-accent-dark focus:ring-accent px-4 py-2 text-sm ${t?"opacity-50 cursor-not-allowed":""}`,children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),n?"Change":"Upload"]}),r.jsx("input",{id:f,name:f,type:"file",className:"sr-only",onChange:d,accept:"image/*",disabled:t}),r.jsxs("button",{type:"button",onClick:()=>l(!0),disabled:t,className:`avatar-capture-btn inline-flex items-center justify-center px-4 py-2 font-semibold rounded-full transition-colors duration-200 text-sm border border-red-200 !text-red-600 hover:!bg-red-50 !bg-card/70 backdrop-blur-sm ${t?"opacity-50 cursor-not-allowed":""}`,children:[r.jsx(dG,{className:"w-4 h-4 mr-2"}),"Capture"]})]}),i&&r.jsxs("p",{className:"text-xs text-red-600 text-center max-w-[160px] flex items-center gap-1",children:[r.jsx(ca,{className:"h-3 w-3 flex-shrink-0"})," ",i]})]})},sae=Bt({name:pe().required("Name is required"),email:pe().email("Must be a valid email").required("Email is required"),phone:pe().matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit Indian mobile number").optional().nullable()}).defined(),rae=()=>{const{user:n,updateUserProfile:e,isCheckedIn:t,isAttendanceLoading:s,toggleCheckInStatus:i,logout:a,lastCheckInTime:o,lastCheckOutTime:l,checkAttendanceStatus:c}=bt(),{permissions:d}=ha(),h=vt(),{theme:m,setTheme:f,isAutomatic:p,setAutomatic:b}=Fl(),{colorScheme:x}=an(),v=Is(x),[S,B]=k.useState(!1),[V,R]=k.useState(!1),[W,_]=k.useState(null),[Y,j]=k.useState("prompt"),H=jt("(max-width: 767px)");k.useEffect(()=>{const ae=async()=>{if(!navigator.permissions?.query){j("prompt");return}try{const Ce=await navigator.permissions.query({name:"camera"}),ie=await navigator.permissions.query({name:"geolocation"});Ce.state==="granted"&&ie.state==="granted"?j("granted"):Ce.state==="denied"||ie.state==="denied"?j("denied"):j("prompt");const ge=()=>ae();Ce.onchange=ge,ie.onchange=ge}catch(Ce){console.warn("Permissions API not fully supported. Defaulting to 'prompt'.",Ce),j("prompt")}};ae()},[]);const{register:D,handleSubmit:z,formState:{errors:O,isDirty:E},getValues:te,trigger:q,reset:de}=tn({resolver:Yn(sae),defaultValues:{name:n?.name||"",email:n?.email||"",phone:n?.phone||""}});k.useEffect(()=>{n&&de({name:n.name||"",email:n.email||"",phone:n.phone||""})},[n,de]);const U=async ae=>{if(!n)return;const Ce=n.photoUrl;e({photoUrl:ae?.preview});try{let ie=null;ae&&ae.file&&(ie=await new Promise((xe,_e)=>{const Be=new FileReader;Be.onloadend=()=>xe(Be.result),Be.onerror=_e,Be.readAsDataURL(ae.file)}));const ge=await ce.updateUser(n.id,{photoUrl:ie});e(ge),_({message:`Profile photo ${ie?"updated":"removed"}.`,type:"success"})}catch(ie){console.error(ie),_({message:"Failed to save photo.",type:"error"}),e({photoUrl:Ce})}},P=async ae=>{if(n){B(!0);try{const Ce=await ce.updateUser(n.id,ae);e(Ce),de(ae),_({message:"Profile updated successfully!",type:"success"})}catch{_({message:"Failed to update profile.",type:"error"})}finally{B(!1)}}},ne=V,K=()=>{h("/auth/logout")},re=ae=>ae?He(new Date(ae),"hh:mm a"):"--:--";n&&d[n.role]?.includes("manage_tasks");const le=ae=>ae.replace(/_/g," ").replace(/\b\w/g,Ce=>Ce.toUpperCase());if(!n)return r.jsx("div",{children:"Loading user profile..."});const ue=n.photoUrl?{preview:n.photoUrl,name:"Profile Photo",type:"image/jpeg",size:0}:null;return H?r.jsxs("div",{className:"p-4 space-y-8 md:bg-transparent",style:{backgroundColor:v.mobileBg},children:[W&&r.jsx(It,{message:W.message,type:W.type,onDismiss:()=>_(null)}),r.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[r.jsx(ZZ,{file:ue,onFileChange:U}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold",style:{color:v.isDark?"white":"#111827"},children:n.name}),r.jsx("p",{style:{color:v.isDark?"#9ca3af":"#6b7280"},children:n.role.replace(/_/g," ").replace(/\b\w/g,ae=>ae.toUpperCase())})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("section",{children:[r.jsx("h3",{className:"fo-section-title mb-4",style:{color:v.isDark?"white":"#111827",borderColor:v.isDark?"#374151":"#e5e7eb"},children:"Profile Details"}),r.jsxs("form",{onSubmit:z(P),className:"space-y-4",children:[r.jsx(be,{label:"Full Name",id:"name",error:O.name?.message,registration:D("name"),className:"",style:{backgroundColor:v.isDark?"#1f2937":"#f9fafb",borderColor:v.isDark?"#374151":"#e5e7eb",color:v.isDark?"white":"#111827"},labelClassName:v.isDark?"text-gray-300":"text-gray-700"}),r.jsx(be,{label:"Email Address",id:"email",type:"email",error:O.email?.message,registration:D("email"),readOnly:!0,className:"",style:{backgroundColor:v.isDark?"#374151":"#f3f4f6",borderColor:v.isDark?"#4b5563":"#e5e7eb",color:v.isDark?"#9ca3af":"#6b7280"},labelClassName:v.isDark?"text-gray-300":"text-gray-700"}),r.jsx(be,{label:"Phone Number",id:"phone",type:"tel",error:O.phone?.message,registration:D("phone"),className:"",style:{backgroundColor:v.isDark?"#1f2937":"#f9fafb",borderColor:v.isDark?"#374151":"#e5e7eb",color:v.isDark?"white":"#111827"},labelClassName:v.isDark?"text-gray-300":"text-gray-700"}),r.jsx("div",{className:"flex justify-end pt-2",children:r.jsx(se,{type:"submit",isLoading:S,disabled:!E,children:"Save Changes"})})]})]}),r.jsxs("section",{className:"hidden md:block",children:[r.jsx("h3",{className:`fo-section-title mb-4 ${v.isDark?"":"text-gray-900"}`,children:"Appearance"}),r.jsxs("div",{className:"p-4 rounded-lg border space-y-4",style:{backgroundColor:v.isDark?v.sidebarBg:"#f9fafb",borderColor:v.isDark?"#374151":"#e5e7eb"},children:[r.jsx(Nn,{id:"theme-automatic-mobile",label:"Automatic",description:"Switch themes based on screen size.",checked:p,onChange:ae=>b(ae.target.checked)}),r.jsx(Nn,{id:"theme-dark-mode-mobile",label:"Dark Mode",description:"Manually enable or disable dark mode.",checked:m==="dark",onChange:ae=>f(ae.target.checked?"dark":"light"),disabled:p})]})]}),r.jsxs("section",{children:[r.jsx("h3",{className:`fo-section-title mb-4 ${v.isDark?"":"text-gray-900 border-gray-200"}`,children:"Work Hours Tracking"}),r.jsxs("div",{className:"fo-attendance-card space-y-4",style:{backgroundColor:v.isDark?"transparent":"#f9fafb",borderColor:v.isDark?void 0:"#e5e7eb",borderWidth:v.isDark?0:1},children:[r.jsxs("div",{className:"flex justify-around",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"fo-attendance-time",style:{color:v.isDark?void 0:"#6b7280"},children:"Last Check In"}),r.jsx("p",{className:"fo-attendance-time",style:{color:v.isDark?void 0:"#111827"},children:r.jsx("strong",{children:re(o)})})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"fo-attendance-time",style:{color:v.isDark?void 0:"#6b7280"},children:"Last Check Out"}),r.jsx("p",{className:"fo-attendance-time",style:{color:v.isDark?void 0:"#111827"},children:r.jsx("strong",{children:re(l)})})]})]}),s?r.jsx("div",{className:"flex items-center justify-center text-muted h-[56px]",children:r.jsx(xt,{className:"h-6 w-6 animate-spin"})}):r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(se,{onClick:()=>h("/attendance/check-in"),variant:"primary",className:"flex-1 !py-4 text-lg font-bold shadow-lg transition-all rounded-2xl",disabled:t||ne,children:[r.jsx(Kf,{className:"mr-3 h-6 w-6"})," Check In"]}),r.jsxs(se,{onClick:()=>h("/attendance/check-out"),variant:"danger",className:"flex-1 !py-4 text-lg font-bold shadow-lg transition-all rounded-2xl",disabled:!t||ne,children:[r.jsx(No,{className:"mr-3 h-6 w-6"})," Check Out"]})]})]})]}),r.jsxs("section",{children:[r.jsx("h3",{className:`fo-section-title mb-4 ${v.isDark?"":"text-gray-900 border-gray-200"}`,children:"Account Actions"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs(se,{onClick:()=>h("/leaves/dashboard"),variant:"secondary",className:"w-full justify-center !py-3",style:v.isDark?{}:{backgroundColor:"#f3f4f6",color:"#1f2937"},title:"View your leave history and balances",children:[r.jsx(gZ,{className:"mr-2 h-5 w-5"})," Leave Tracker"]}),r.jsxs(se,{onClick:K,variant:"danger",className:"w-full justify-center !py-3",children:[r.jsx(No,{className:"mr-2 h-5 w-5"})," Log Out"]})]})]})]})]}):r.jsxs("div",{className:"w-full space-y-8",children:[W&&r.jsx(It,{message:W.message,type:W.type,onDismiss:()=>_(null)}),r.jsxs("div",{className:"relative overflow-hidden md:bg-white md:p-6 md:rounded-2xl md:shadow-lg flex flex-col md:flex-row items-center gap-6 border border-gray-100",children:[r.jsx("div",{className:"absolute top-0 left-0 w-full h-32 border-b-4 shadow-lg",style:{backgroundColor:v.mobileBg,borderColor:v.sidebarBorder||v.mobileBg}}),r.jsx("div",{className:"relative z-10",children:r.jsx(ZZ,{file:ue,onFileChange:U})}),r.jsxs("div",{className:"text-center md:text-left relative z-10 flex-1 mt-16 md:mt-0",children:[r.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-primary-text tracking-tight",children:n.name}),r.jsx("div",{className:"flex items-center justify-center md:justify-start gap-2 mt-1.5",children:r.jsx("span",{className:"px-2.5 py-0.5 rounded-full bg-emerald-100 text-emerald-800 border border-emerald-200 text-xs md:text-sm font-medium",children:le(n.role)})}),r.jsx("p",{className:"text-gray-500 mt-1.5 font-medium text-sm md:text-base",children:n.email})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"md:bg-white md:p-6 md:rounded-2xl md:shadow-lg border border-gray-100",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[r.jsx("div",{className:"p-1.5 bg-blue-50 rounded-lg",children:r.jsx(Jl,{className:"h-5 w-5 text-blue-600"})}),r.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Profile Details"})]}),r.jsxs("form",{onSubmit:z(P),className:"space-y-5",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[r.jsx(be,{label:"Full Name",id:"name",error:O.name?.message,registration:D("name"),className:"bg-gray-50 border-gray-200 focus:bg-white transition-colors"}),r.jsx(be,{label:"Phone Number",id:"phone",type:"tel",error:O.phone?.message,registration:D("phone"),className:"bg-gray-50 border-gray-200 focus:bg-white transition-colors"}),r.jsx("div",{className:"md:col-span-2",children:r.jsx(be,{label:"Email Address",id:"email",type:"email",error:O.email?.message,registration:D("email"),readOnly:!0,className:"bg-gray-100/50 text-gray-500 cursor-not-allowed border-gray-200"})})]}),r.jsx("div",{className:"flex justify-end pt-3 border-t border-gray-100",children:r.jsx(se,{type:"submit",isLoading:S,disabled:!E,className:"px-6",children:"Save Changes"})})]})]}),r.jsxs("div",{className:"md:bg-white md:p-6 md:rounded-2xl md:shadow-lg border border-gray-100",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[r.jsx("div",{className:"p-1.5 bg-purple-50 rounded-lg",children:r.jsx(uG,{className:"h-5 w-5 text-purple-600"})}),r.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Work Hours Tracking"})]}),r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[r.jsxs("div",{className:"text-center bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-xl border border-gray-200",children:[r.jsx("p",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1",children:"Last Check In"}),r.jsx("p",{className:"text-2xl md:text-3xl font-bold text-emerald-600",children:re(o)})]}),r.jsxs("div",{className:"text-center bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-xl border border-gray-200",children:[r.jsx("p",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1",children:"Last Check Out"}),r.jsx("p",{className:"text-2xl md:text-3xl font-bold text-rose-600",children:re(l)})]})]}),s?r.jsx("div",{className:"flex items-center justify-center h-[56px] bg-gray-50 rounded-xl",children:r.jsx(xt,{className:"h-6 w-6 animate-spin text-gray-400"})}):r.jsxs("div",{className:"flex gap-4",children:[r.jsxs(se,{onClick:()=>h("/attendance/check-in"),variant:"primary",className:"flex-1 !py-3 text-base md:text-lg shadow-lg shadow-emerald-100 hover:shadow-emerald-200 transition-all",disabled:t||ne,children:[r.jsx(Kf,{className:"mr-2 h-5 w-5"})," Check In"]}),r.jsxs(se,{onClick:()=>h("/attendance/check-out"),variant:"danger",className:"flex-1 !py-3 text-base md:text-lg shadow-lg shadow-red-100 hover:shadow-red-200 transition-all",disabled:!t||ne,children:[r.jsx(No,{className:"mr-2 h-5 w-5"})," Check Out"]})]})]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"md:bg-white md:p-6 md:rounded-2xl md:shadow-lg border border-gray-100",children:[r.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-900",children:"Appearance"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"p-4 rounded-xl bg-gray-50 border border-gray-100",children:r.jsx(Nn,{id:"theme-automatic-desktop",label:"Automatic",description:"Switch themes based on screen size.",checked:p,onChange:ae=>b(ae.target.checked)})}),r.jsx("div",{className:"p-4 rounded-xl bg-gray-50 border border-gray-100",children:r.jsx(Nn,{id:"theme-dark-mode-desktop",label:"Dark Mode",description:"Manually enable or disable dark mode.",checked:m==="dark",onChange:ae=>f(ae.target.checked?"dark":"light"),disabled:p})})]})]}),r.jsxs("div",{className:"md:bg-white md:p-6 md:rounded-2xl md:shadow-lg border border-gray-100",children:[r.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-900",children:"Account Actions"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs(se,{onClick:()=>h("/leaves/dashboard"),variant:"secondary",className:"w-full justify-center py-3 bg-gray-50 hover:bg-gray-100 border-gray-200",title:"View your leave history and balances",children:[r.jsx(gZ,{className:"mr-2 h-4 w-4"})," Leave Tracker"]}),r.jsxs(se,{onClick:K,variant:"danger",className:"w-full justify-center py-3",isLoading:S,children:[r.jsx(No,{className:"mr-2 h-4 w-4"})," Log Out"]})]})]})]})]})]})};function Qm(n){return n+.5|0}const Lc=(n,e,t)=>Math.max(Math.min(n,t),e);function rm(n){return Lc(Qm(n*2.55),0,255)}function qc(n){return Lc(Qm(n*255),0,255)}function Gl(n){return Lc(Qm(n/2.55)/100,0,1)}function uJ(n){return Lc(Qm(n*100),0,100)}const ea={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},GZ=[..."0123456789ABCDEF"],iae=n=>GZ[n&15],aae=n=>GZ[(n&240)>>4]+GZ[n&15],QC=n=>(n&240)>>4===(n&15),oae=n=>QC(n.r)&&QC(n.g)&&QC(n.b)&&QC(n.a);function lae(n){var e=n.length,t;return n[0]==="#"&&(e===4||e===5?t={r:255&ea[n[1]]*17,g:255&ea[n[2]]*17,b:255&ea[n[3]]*17,a:e===5?ea[n[4]]*17:255}:(e===7||e===9)&&(t={r:ea[n[1]]<<4|ea[n[2]],g:ea[n[3]]<<4|ea[n[4]],b:ea[n[5]]<<4|ea[n[6]],a:e===9?ea[n[7]]<<4|ea[n[8]]:255})),t}const cae=(n,e)=>n<255?e(n):"";function dae(n){var e=oae(n)?iae:aae;return n?"#"+e(n.r)+e(n.g)+e(n.b)+cae(n.a,e):void 0}const gae=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function uE(n,e,t){const s=e*Math.min(t,1-t),i=(a,o=(a+n/30)%12)=>t-s*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function uae(n,e,t){const s=(i,a=(i+n/60)%6)=>t-t*e*Math.max(Math.min(a,4-a,1),0);return[s(5),s(3),s(1)]}function hae(n,e,t){const s=uE(n,1,.5);let i;for(e+t>1&&(i=1/(e+t),e*=i,t*=i),i=0;i<3;i++)s[i]*=1-e-t,s[i]+=e;return s}function mae(n,e,t,s,i){return n===i?(e-t)/s+(e<t?6:0):e===i?(t-n)/s+2:(n-e)/s+4}function zG(n){const t=n.r/255,s=n.g/255,i=n.b/255,a=Math.max(t,s,i),o=Math.min(t,s,i),l=(a+o)/2;let c,d,h;return a!==o&&(h=a-o,d=l>.5?h/(2-a-o):h/(a+o),c=mae(t,s,i,h,a),c=c*60+.5),[c|0,d||0,l]}function UG(n,e,t,s){return(Array.isArray(e)?n(e[0],e[1],e[2]):n(e,t,s)).map(qc)}function QG(n,e,t){return UG(uE,n,e,t)}function Iae(n,e,t){return UG(hae,n,e,t)}function Cae(n,e,t){return UG(uae,n,e,t)}function hE(n){return(n%360+360)%360}function fae(n){const e=gae.exec(n);let t=255,s;if(!e)return;e[5]!==s&&(t=e[6]?rm(+e[5]):qc(+e[5]));const i=hE(+e[2]),a=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?s=Iae(i,a,o):e[1]==="hsv"?s=Cae(i,a,o):s=QG(i,a,o),{r:s[0],g:s[1],b:s[2],a:t}}function pae(n,e){var t=zG(n);t[0]=hE(t[0]+e),t=QG(t),n.r=t[0],n.g=t[1],n.b=t[2]}function Aae(n){if(!n)return;const e=zG(n),t=e[0],s=uJ(e[1]),i=uJ(e[2]);return n.a<255?`hsla(${t}, ${s}%, ${i}%, ${Gl(n.a)})`:`hsl(${t}, ${s}%, ${i}%)`}const hJ={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},mJ={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function bae(){const n={},e=Object.keys(mJ),t=Object.keys(hJ);let s,i,a,o,l;for(s=0;s<e.length;s++){for(o=l=e[s],i=0;i<t.length;i++)a=t[i],l=l.replace(a,hJ[a]);a=parseInt(mJ[o],16),n[l]=[a>>16&255,a>>8&255,a&255]}return n}let qC;function yae(n){qC||(qC=bae(),qC.transparent=[0,0,0,0]);const e=qC[n.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const vae=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function xae(n){const e=vae.exec(n);let t=255,s,i,a;if(e){if(e[7]!==s){const o=+e[7];t=e[8]?rm(o):Lc(o*255,0,255)}return s=+e[1],i=+e[3],a=+e[5],s=255&(e[2]?rm(s):Lc(s,0,255)),i=255&(e[4]?rm(i):Lc(i,0,255)),a=255&(e[6]?rm(a):Lc(a,0,255)),{r:s,g:i,b:a,a:t}}}function Sae(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Gl(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const US=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,cu=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function wae(n,e,t){const s=cu(Gl(n.r)),i=cu(Gl(n.g)),a=cu(Gl(n.b));return{r:qc(US(s+t*(cu(Gl(e.r))-s))),g:qc(US(i+t*(cu(Gl(e.g))-i))),b:qc(US(a+t*(cu(Gl(e.b))-a))),a:n.a+t*(e.a-n.a)}}function $C(n,e,t){if(n){let s=zG(n);s[e]=Math.max(0,Math.min(s[e]+s[e]*t,e===0?360:1)),s=QG(s),n.r=s[0],n.g=s[1],n.b=s[2]}}function mE(n,e){return n&&Object.assign(e||{},n)}function IJ(n){var e={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(e={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(e.a=qc(n[3]))):(e=mE(n,{r:0,g:0,b:0,a:1}),e.a=qc(e.a)),e}function Zae(n){return n.charAt(0)==="r"?xae(n):fae(n)}class Vm{constructor(e){if(e instanceof Vm)return e;const t=typeof e;let s;t==="object"?s=IJ(e):t==="string"&&(s=lae(e)||yae(e)||Zae(e)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var e=mE(this._rgb);return e&&(e.a=Gl(e.a)),e}set rgb(e){this._rgb=IJ(e)}rgbString(){return this._valid?Sae(this._rgb):void 0}hexString(){return this._valid?dae(this._rgb):void 0}hslString(){return this._valid?Aae(this._rgb):void 0}mix(e,t){if(e){const s=this.rgb,i=e.rgb;let a;const o=t===a?.5:t,l=2*o-1,c=s.a-i.a,d=((l*c===-1?l:(l+c)/(1+l*c))+1)/2;a=1-d,s.r=255&d*s.r+a*i.r+.5,s.g=255&d*s.g+a*i.g+.5,s.b=255&d*s.b+a*i.b+.5,s.a=o*s.a+(1-o)*i.a,this.rgb=s}return this}interpolate(e,t){return e&&(this._rgb=wae(this._rgb,e._rgb,t)),this}clone(){return new Vm(this.rgb)}alpha(e){return this._rgb.a=qc(e),this}clearer(e){const t=this._rgb;return t.a*=1-e,this}greyscale(){const e=this._rgb,t=Qm(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=t,this}opaquer(e){const t=this._rgb;return t.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return $C(this._rgb,2,e),this}darken(e){return $C(this._rgb,2,-e),this}saturate(e){return $C(this._rgb,1,e),this}desaturate(e){return $C(this._rgb,1,-e),this}rotate(e){return pae(this._rgb,e),this}}function yl(){}const Gae=(()=>{let n=0;return()=>n++})();function Sn(n){return n==null}function _s(n){if(Array.isArray&&Array.isArray(n))return!0;const e=Object.prototype.toString.call(n);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function sn(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function pr(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function yo(n,e){return pr(n)?n:e}function Kt(n,e){return typeof n>"u"?e:n}const Bae=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/e,IE=(n,e)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*e:+n;function Pn(n,e,t){if(n&&typeof n.call=="function")return n.apply(t,e)}function Bn(n,e,t,s){let i,a,o;if(_s(n))for(a=n.length,i=0;i<a;i++)e.call(t,n[i],i);else if(sn(n))for(o=Object.keys(n),a=o.length,i=0;i<a;i++)e.call(t,n[o[i]],o[i])}function tp(n,e){let t,s,i,a;if(!n||!e||n.length!==e.length)return!1;for(t=0,s=n.length;t<s;++t)if(i=n[t],a=e[t],i.datasetIndex!==a.datasetIndex||i.index!==a.index)return!1;return!0}function np(n){if(_s(n))return n.map(np);if(sn(n)){const e=Object.create(null),t=Object.keys(n),s=t.length;let i=0;for(;i<s;++i)e[t[i]]=np(n[t[i]]);return e}return n}function CE(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Nae(n,e,t,s){if(!CE(n))return;const i=e[n],a=t[n];sn(i)&&sn(a)?_m(i,a,s):e[n]=np(a)}function _m(n,e,t){const s=_s(e)?e:[e],i=s.length;if(!sn(n))return n;t=t||{};const a=t.merger||Nae;let o;for(let l=0;l<i;++l){if(o=s[l],!sn(o))continue;const c=Object.keys(o);for(let d=0,h=c.length;d<h;++d)a(c[d],n,o,t)}return n}function hm(n,e){return _m(n,e,{merger:kae})}function kae(n,e,t){if(!CE(n))return;const s=e[n],i=t[n];sn(s)&&sn(i)?hm(s,i):Object.prototype.hasOwnProperty.call(e,n)||(e[n]=np(i))}const CJ={"":n=>n,x:n=>n.x,y:n=>n.y};function Rae(n){const e=n.split("."),t=[];let s="";for(const i of e)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(t.push(s),s="");return t}function Wae(n){const e=Rae(n);return t=>{for(const s of e){if(s==="")break;t=t&&t[s]}return t}}function wg(n,e){return(CJ[e]||(CJ[e]=Wae(e)))(n)}function qG(n){return n.charAt(0).toUpperCase()+n.slice(1)}const jm=n=>typeof n<"u",sd=n=>typeof n=="function",fJ=(n,e)=>{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0};function Vae(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Jn=Math.PI,rs=2*Jn,_ae=rs+Jn,sp=Number.POSITIVE_INFINITY,jae=Jn/180,js=Jn/2,sg=Jn/4,pJ=Jn*2/3,fE=Math.log10,Wo=Math.sign;function mm(n,e,t){return Math.abs(n-e)<t}function AJ(n){const e=Math.round(n);n=mm(n,e,n/1e3)?e:n;const t=Math.pow(10,Math.floor(fE(n))),s=n/t;return(s<=1?1:s<=2?2:s<=5?5:10)*t}function Xae(n){const e=[],t=Math.sqrt(n);let s;for(s=1;s<t;s++)n%s===0&&(e.push(s),e.push(n/s));return t===(t|0)&&e.push(t),e.sort((i,a)=>i-a).pop(),e}function Jae(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Xm(n){return!Jae(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function Yae(n,e){const t=Math.round(n);return t-e<=n&&t+e>=n}function Fae(n,e,t){let s,i,a;for(s=0,i=n.length;s<i;s++)a=n[s][t],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function Nl(n){return n*(Jn/180)}function Mae(n){return n*(180/Jn)}function bJ(n){if(!pr(n))return;let e=1,t=0;for(;Math.round(n*e)/e!==n;)e*=10,t++;return t}function pE(n,e){const t=e.x-n.x,s=e.y-n.y,i=Math.sqrt(t*t+s*s);let a=Math.atan2(s,t);return a<-.5*Jn&&(a+=rs),{angle:a,distance:i}}function BZ(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function Hae(n,e){return(n-e+_ae)%rs-Jn}function bi(n){return(n%rs+rs)%rs}function Jm(n,e,t,s){const i=bi(n),a=bi(e),o=bi(t),l=bi(a-i),c=bi(o-i),d=bi(i-a),h=bi(i-o);return i===a||i===o||s&&a===o||l>c&&d<h}function Ir(n,e,t){return Math.max(e,Math.min(t,n))}function Tae(n){return Ir(n,-32768,32767)}function kl(n,e,t,s=1e-6){return n>=Math.min(e,t)-s&&n<=Math.max(e,t)+s}function $G(n,e,t){t=t||(o=>n[o]<e);let s=n.length-1,i=0,a;for(;s-i>1;)a=i+s>>1,t(a)?i=a:s=a;return{lo:i,hi:s}}const Cg=(n,e,t,s)=>$G(n,t,s?i=>{const a=n[i][e];return a<t||a===t&&n[i+1][e]===t}:i=>n[i][e]<t),Eae=(n,e,t)=>$G(n,t,s=>n[s][e]>=t);function Dae(n,e,t){let s=0,i=n.length;for(;s<i&&n[s]<e;)s++;for(;i>s&&n[i-1]>t;)i--;return s>0||i<n.length?n.slice(s,i):n}const AE=["push","pop","shift","splice","unshift"];function Lae(n,e){if(n._chartjs){n._chartjs.listeners.push(e);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),AE.forEach(t=>{const s="_onData"+qG(t),i=n[t];Object.defineProperty(n,t,{configurable:!0,enumerable:!1,value(...a){const o=i.apply(this,a);return n._chartjs.listeners.forEach(l=>{typeof l[s]=="function"&&l[s](...a)}),o}})})}function yJ(n,e){const t=n._chartjs;if(!t)return;const s=t.listeners,i=s.indexOf(e);i!==-1&&s.splice(i,1),!(s.length>0)&&(AE.forEach(a=>{delete n[a]}),delete n._chartjs)}function bE(n){const e=new Set(n);return e.size===n.length?n:Array.from(e)}const yE=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function vE(n,e){let t=[],s=!1;return function(...i){t=i,s||(s=!0,yE.call(window,()=>{s=!1,n.apply(e,t)}))}}function Pae(n,e){let t;return function(...s){return e?(clearTimeout(t),t=setTimeout(n,e,s)):n.apply(this,s),e}}const xE=n=>n==="start"?"left":n==="end"?"right":"center",pi=(n,e,t)=>n==="start"?e:n==="end"?t:(e+t)/2,Kae=(n,e,t,s)=>n===(s?"left":"right")?t:n==="center"?(e+t)/2:e;function Oae(n,e,t){const s=e.length;let i=0,a=s;if(n._sorted){const{iScale:o,vScale:l,_parsed:c}=n,d=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,h=o.axis,{min:m,max:f,minDefined:p,maxDefined:b}=o.getUserBounds();if(p){if(i=Math.min(Cg(c,h,m).lo,t?s:Cg(e,h,o.getPixelForValue(m)).lo),d){const x=c.slice(0,i+1).reverse().findIndex(v=>!Sn(v[l.axis]));i-=Math.max(0,x)}i=Ir(i,0,s-1)}if(b){let x=Math.max(Cg(c,o.axis,f,!0).hi+1,t?0:Cg(e,h,o.getPixelForValue(f),!0).hi+1);if(d){const v=c.slice(x-1).findIndex(S=>!Sn(S[l.axis]));x+=Math.max(0,v)}a=Ir(x,i,s)-i}else a=s-i}return{start:i,count:a}}function zae(n){const{xScale:e,yScale:t,_scaleRanges:s}=n,i={xmin:e.min,xmax:e.max,ymin:t.min,ymax:t.max};if(!s)return n._scaleRanges=i,!0;const a=s.xmin!==e.min||s.xmax!==e.max||s.ymin!==t.min||s.ymax!==t.max;return Object.assign(s,i),a}const ef=n=>n===0||n===1,vJ=(n,e,t)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-e)*rs/t)),xJ=(n,e,t)=>Math.pow(2,-10*n)*Math.sin((n-e)*rs/t)+1,Im={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*js)+1,easeOutSine:n=>Math.sin(n*js),easeInOutSine:n=>-.5*(Math.cos(Jn*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>ef(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>ef(n)?n:vJ(n,.075,.3),easeOutElastic:n=>ef(n)?n:xJ(n,.075,.3),easeInOutElastic(n){return ef(n)?n:n<.5?.5*vJ(n*2,.1125,.45):.5+.5*xJ(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let e=1.70158;return(n/=.5)<1?.5*(n*n*(((e*=1.525)+1)*n-e)):.5*((n-=2)*n*(((e*=1.525)+1)*n+e)+2)},easeInBounce:n=>1-Im.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Im.easeInBounce(n*2)*.5:Im.easeOutBounce(n*2-1)*.5+.5};function eB(n){if(n&&typeof n=="object"){const e=n.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function SJ(n){return eB(n)?n:new Vm(n)}function QS(n){return eB(n)?n:new Vm(n).saturate(.5).darken(.1).hexString()}const Uae=["x","y","borderWidth","radius","tension"],Qae=["color","borderColor","backgroundColor"];function qae(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),n.set("animations",{colors:{type:"color",properties:Qae},numbers:{type:"number",properties:Uae}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function $ae(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const wJ=new Map;function eoe(n,e){e=e||{};const t=n+JSON.stringify(e);let s=wJ.get(t);return s||(s=new Intl.NumberFormat(n,e),wJ.set(t,s)),s}function tB(n,e,t){return eoe(e,t).format(n)}const toe={values(n){return _s(n)?n:""+n},numeric(n,e,t){if(n===0)return"0";const s=this.chart.options.locale;let i,a=n;if(t.length>1){const d=Math.max(Math.abs(t[0].value),Math.abs(t[t.length-1].value));(d<1e-4||d>1e15)&&(i="scientific"),a=noe(n,t)}const o=fE(Math.abs(a)),l=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:i,minimumFractionDigits:l,maximumFractionDigits:l};return Object.assign(c,this.options.ticks.format),tB(n,s,c)}};function noe(n,e){let t=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(t)>=1&&n!==Math.floor(n)&&(t=n-Math.floor(n)),t}var SE={formatters:toe};function soe(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:SE.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Zg=Object.create(null),NZ=Object.create(null);function Cm(n,e){if(!e)return n;const t=e.split(".");for(let s=0,i=t.length;s<i;++s){const a=t[s];n=n[a]||(n[a]=Object.create(null))}return n}function qS(n,e,t){return typeof e=="string"?_m(Cm(n,e),t):_m(Cm(n,""),e)}class roe{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>QS(i.backgroundColor),this.hoverBorderColor=(s,i)=>QS(i.borderColor),this.hoverColor=(s,i)=>QS(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return qS(this,e,t)}get(e){return Cm(this,e)}describe(e,t){return qS(NZ,e,t)}override(e,t){return qS(Zg,e,t)}route(e,t,s,i){const a=Cm(this,e),o=Cm(this,s),l="_"+t;Object.defineProperties(a,{[l]:{value:a[t],writable:!0},[t]:{enumerable:!0,get(){const c=this[l],d=o[i];return sn(c)?Object.assign({},d,c):Kt(c,d)},set(c){this[l]=c}}})}apply(e){e.forEach(t=>t(this))}}var hs=new roe({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[qae,$ae,soe]);function ioe(n){return!n||Sn(n.size)||Sn(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function ZJ(n,e,t,s,i){let a=e[i];return a||(a=e[i]=n.measureText(i).width,t.push(i)),a>s&&(s=a),s}function rg(n,e,t){const s=n.currentDevicePixelRatio,i=t!==0?Math.max(t/2,.5):0;return Math.round((e-i)*s)/s+i}function GJ(n,e){!e&&!n||(e=e||n.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,n.width,n.height),e.restore())}function kZ(n,e,t,s){wE(n,e,t,s,null)}function wE(n,e,t,s,i){let a,o,l,c,d,h,m,f;const p=e.pointStyle,b=e.rotation,x=e.radius;let v=(b||0)*jae;if(p&&typeof p=="object"&&(a=p.toString(),a==="[object HTMLImageElement]"||a==="[object HTMLCanvasElement]")){n.save(),n.translate(t,s),n.rotate(v),n.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),n.restore();return}if(!(isNaN(x)||x<=0)){switch(n.beginPath(),p){default:i?n.ellipse(t,s,i/2,x,0,0,rs):n.arc(t,s,x,0,rs),n.closePath();break;case"triangle":h=i?i/2:x,n.moveTo(t+Math.sin(v)*h,s-Math.cos(v)*x),v+=pJ,n.lineTo(t+Math.sin(v)*h,s-Math.cos(v)*x),v+=pJ,n.lineTo(t+Math.sin(v)*h,s-Math.cos(v)*x),n.closePath();break;case"rectRounded":d=x*.516,c=x-d,o=Math.cos(v+sg)*c,m=Math.cos(v+sg)*(i?i/2-d:c),l=Math.sin(v+sg)*c,f=Math.sin(v+sg)*(i?i/2-d:c),n.arc(t-m,s-l,d,v-Jn,v-js),n.arc(t+f,s-o,d,v-js,v),n.arc(t+m,s+l,d,v,v+js),n.arc(t-f,s+o,d,v+js,v+Jn),n.closePath();break;case"rect":if(!b){c=Math.SQRT1_2*x,h=i?i/2:c,n.rect(t-h,s-c,2*h,2*c);break}v+=sg;case"rectRot":m=Math.cos(v)*(i?i/2:x),o=Math.cos(v)*x,l=Math.sin(v)*x,f=Math.sin(v)*(i?i/2:x),n.moveTo(t-m,s-l),n.lineTo(t+f,s-o),n.lineTo(t+m,s+l),n.lineTo(t-f,s+o),n.closePath();break;case"crossRot":v+=sg;case"cross":m=Math.cos(v)*(i?i/2:x),o=Math.cos(v)*x,l=Math.sin(v)*x,f=Math.sin(v)*(i?i/2:x),n.moveTo(t-m,s-l),n.lineTo(t+m,s+l),n.moveTo(t+f,s-o),n.lineTo(t-f,s+o);break;case"star":m=Math.cos(v)*(i?i/2:x),o=Math.cos(v)*x,l=Math.sin(v)*x,f=Math.sin(v)*(i?i/2:x),n.moveTo(t-m,s-l),n.lineTo(t+m,s+l),n.moveTo(t+f,s-o),n.lineTo(t-f,s+o),v+=sg,m=Math.cos(v)*(i?i/2:x),o=Math.cos(v)*x,l=Math.sin(v)*x,f=Math.sin(v)*(i?i/2:x),n.moveTo(t-m,s-l),n.lineTo(t+m,s+l),n.moveTo(t+f,s-o),n.lineTo(t-f,s+o);break;case"line":o=i?i/2:Math.cos(v)*x,l=Math.sin(v)*x,n.moveTo(t-o,s-l),n.lineTo(t+o,s+l);break;case"dash":n.moveTo(t,s),n.lineTo(t+Math.cos(v)*(i?i/2:x),s+Math.sin(v)*x);break;case!1:n.closePath();break}n.fill(),e.borderWidth>0&&n.stroke()}}function Ym(n,e,t){return t=t||.5,!e||n&&n.x>e.left-t&&n.x<e.right+t&&n.y>e.top-t&&n.y<e.bottom+t}function Lp(n,e){n.save(),n.beginPath(),n.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),n.clip()}function Pp(n){n.restore()}function aoe(n,e,t,s,i){if(!e)return n.lineTo(t.x,t.y);if(i==="middle"){const a=(e.x+t.x)/2;n.lineTo(a,e.y),n.lineTo(a,t.y)}else i==="after"!=!!s?n.lineTo(e.x,t.y):n.lineTo(t.x,e.y);n.lineTo(t.x,t.y)}function ooe(n,e,t,s){if(!e)return n.lineTo(t.x,t.y);n.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?t.cp2x:t.cp1x,s?t.cp2y:t.cp1y,t.x,t.y)}function loe(n,e){e.translation&&n.translate(e.translation[0],e.translation[1]),Sn(e.rotation)||n.rotate(e.rotation),e.color&&(n.fillStyle=e.color),e.textAlign&&(n.textAlign=e.textAlign),e.textBaseline&&(n.textBaseline=e.textBaseline)}function coe(n,e,t,s,i){if(i.strikethrough||i.underline){const a=n.measureText(s),o=e-a.actualBoundingBoxLeft,l=e+a.actualBoundingBoxRight,c=t-a.actualBoundingBoxAscent,d=t+a.actualBoundingBoxDescent,h=i.strikethrough?(c+d)/2:d;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(o,h),n.lineTo(l,h),n.stroke()}}function doe(n,e){const t=n.fillStyle;n.fillStyle=e.color,n.fillRect(e.left,e.top,e.width,e.height),n.fillStyle=t}function rp(n,e,t,s,i,a={}){const o=_s(e)?e:[e],l=a.strokeWidth>0&&a.strokeColor!=="";let c,d;for(n.save(),n.font=i.string,loe(n,a),c=0;c<o.length;++c)d=o[c],a.backdrop&&doe(n,a.backdrop),l&&(a.strokeColor&&(n.strokeStyle=a.strokeColor),Sn(a.strokeWidth)||(n.lineWidth=a.strokeWidth),n.strokeText(d,t,s,a.maxWidth)),n.fillText(d,t,s,a.maxWidth),coe(n,t,s,d,a),s+=Number(i.lineHeight);n.restore()}function ip(n,e){const{x:t,y:s,w:i,h:a,radius:o}=e;n.arc(t+o.topLeft,s+o.topLeft,o.topLeft,1.5*Jn,Jn,!0),n.lineTo(t,s+a-o.bottomLeft),n.arc(t+o.bottomLeft,s+a-o.bottomLeft,o.bottomLeft,Jn,js,!0),n.lineTo(t+i-o.bottomRight,s+a),n.arc(t+i-o.bottomRight,s+a-o.bottomRight,o.bottomRight,js,0,!0),n.lineTo(t+i,s+o.topRight),n.arc(t+i-o.topRight,s+o.topRight,o.topRight,0,-js,!0),n.lineTo(t+o.topLeft,s)}const goe=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,uoe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function hoe(n,e){const t=(""+n).match(goe);if(!t||t[1]==="normal")return e*1.2;switch(n=+t[2],t[3]){case"px":return n;case"%":n/=100;break}return e*n}const moe=n=>+n||0;function nB(n,e){const t={},s=sn(e),i=s?Object.keys(e):e,a=sn(n)?s?o=>Kt(n[o],n[e[o]]):o=>n[o]:()=>n;for(const o of i)t[o]=moe(a(o));return t}function ZE(n){return nB(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Zu(n){return nB(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Da(n){const e=ZE(n);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function ni(n,e){n=n||{},e=e||hs.font;let t=Kt(n.size,e.size);typeof t=="string"&&(t=parseInt(t,10));let s=Kt(n.style,e.style);s&&!(""+s).match(uoe)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:Kt(n.family,e.family),lineHeight:hoe(Kt(n.lineHeight,e.lineHeight),t),size:t,style:s,weight:Kt(n.weight,e.weight),string:""};return i.string=ioe(i),i}function tf(n,e,t,s){let i,a,o;for(i=0,a=n.length;i<a;++i)if(o=n[i],o!==void 0&&o!==void 0)return o}function Ioe(n,e,t){const{min:s,max:i}=n,a=IE(e,(i-s)/2),o=(l,c)=>t&&l===0?0:l+c;return{min:o(s,-Math.abs(a)),max:o(i,a)}}function _g(n,e){return Object.assign(Object.create(n),e)}function sB(n,e=[""],t,s,i=()=>n[0]){const a=t||n;typeof s>"u"&&(s=kE("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:a,_fallback:s,_getTarget:i,override:l=>sB([l,...n],e,a,s)};return new Proxy(o,{deleteProperty(l,c){return delete l[c],delete l._keys,delete n[0][c],!0},get(l,c){return BE(l,c,()=>xoe(c,e,n,l))},getOwnPropertyDescriptor(l,c){return Reflect.getOwnPropertyDescriptor(l._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(l,c){return NJ(l).includes(c)},ownKeys(l){return NJ(l)},set(l,c,d){const h=l._storage||(l._storage=i());return l[c]=h[c]=d,delete l._keys,!0}})}function zu(n,e,t,s){const i={_cacheable:!1,_proxy:n,_context:e,_subProxy:t,_stack:new Set,_descriptors:GE(n,s),setContext:a=>zu(n,a,t,s),override:a=>zu(n.override(a),e,t,s)};return new Proxy(i,{deleteProperty(a,o){return delete a[o],delete n[o],!0},get(a,o,l){return BE(a,o,()=>foe(a,o,l))},getOwnPropertyDescriptor(a,o){return a._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(a,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(a,o,l){return n[o]=l,delete a[o],!0}})}function GE(n,e={scriptable:!0,indexable:!0}){const{_scriptable:t=e.scriptable,_indexable:s=e.indexable,_allKeys:i=e.allKeys}=n;return{allKeys:i,scriptable:t,indexable:s,isScriptable:sd(t)?t:()=>t,isIndexable:sd(s)?s:()=>s}}const Coe=(n,e)=>n?n+qG(e):e,rB=(n,e)=>sn(e)&&n!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function BE(n,e,t){if(Object.prototype.hasOwnProperty.call(n,e)||e==="constructor")return n[e];const s=t();return n[e]=s,s}function foe(n,e,t){const{_proxy:s,_context:i,_subProxy:a,_descriptors:o}=n;let l=s[e];return sd(l)&&o.isScriptable(e)&&(l=poe(e,l,n,t)),_s(l)&&l.length&&(l=Aoe(e,l,n,o.isIndexable)),rB(e,l)&&(l=zu(l,i,a&&a[e],o)),l}function poe(n,e,t,s){const{_proxy:i,_context:a,_subProxy:o,_stack:l}=t;if(l.has(n))throw new Error("Recursion detected: "+Array.from(l).join("->")+"->"+n);l.add(n);let c=e(a,o||s);return l.delete(n),rB(n,c)&&(c=iB(i._scopes,i,n,c)),c}function Aoe(n,e,t,s){const{_proxy:i,_context:a,_subProxy:o,_descriptors:l}=t;if(typeof a.index<"u"&&s(n))return e[a.index%e.length];if(sn(e[0])){const c=e,d=i._scopes.filter(h=>h!==c);e=[];for(const h of c){const m=iB(d,i,n,h);e.push(zu(m,a,o&&o[n],l))}}return e}function NE(n,e,t){return sd(n)?n(e,t):n}const boe=(n,e)=>n===!0?e:typeof n=="string"?wg(e,n):void 0;function yoe(n,e,t,s,i){for(const a of e){const o=boe(t,a);if(o){n.add(o);const l=NE(o._fallback,t,i);if(typeof l<"u"&&l!==t&&l!==s)return l}else if(o===!1&&typeof s<"u"&&t!==s)return null}return!1}function iB(n,e,t,s){const i=e._rootScopes,a=NE(e._fallback,t,s),o=[...n,...i],l=new Set;l.add(s);let c=BJ(l,o,t,a||t,s);return c===null||typeof a<"u"&&a!==t&&(c=BJ(l,o,a,c,s),c===null)?!1:sB(Array.from(l),[""],i,a,()=>voe(e,t,s))}function BJ(n,e,t,s,i){for(;t;)t=yoe(n,e,t,s,i);return t}function voe(n,e,t){const s=n._getTarget();e in s||(s[e]={});const i=s[e];return _s(i)&&sn(t)?t:i||{}}function xoe(n,e,t,s){let i;for(const a of e)if(i=kE(Coe(a,n),t),typeof i<"u")return rB(n,i)?iB(t,s,n,i):i}function kE(n,e){for(const t of e){if(!t)continue;const s=t[n];if(typeof s<"u")return s}}function NJ(n){let e=n._keys;return e||(e=n._keys=Soe(n._scopes)),e}function Soe(n){const e=new Set;for(const t of n)for(const s of Object.keys(t).filter(i=>!i.startsWith("_")))e.add(s);return Array.from(e)}const woe=Number.EPSILON||1e-14,Uu=(n,e)=>e<n.length&&!n[e].skip&&n[e],RE=n=>n==="x"?"y":"x";function Zoe(n,e,t,s){const i=n.skip?e:n,a=e,o=t.skip?e:t,l=BZ(a,i),c=BZ(o,a);let d=l/(l+c),h=c/(l+c);d=isNaN(d)?0:d,h=isNaN(h)?0:h;const m=s*d,f=s*h;return{previous:{x:a.x-m*(o.x-i.x),y:a.y-m*(o.y-i.y)},next:{x:a.x+f*(o.x-i.x),y:a.y+f*(o.y-i.y)}}}function Goe(n,e,t){const s=n.length;let i,a,o,l,c,d=Uu(n,0);for(let h=0;h<s-1;++h)if(c=d,d=Uu(n,h+1),!(!c||!d)){if(mm(e[h],0,woe)){t[h]=t[h+1]=0;continue}i=t[h]/e[h],a=t[h+1]/e[h],l=Math.pow(i,2)+Math.pow(a,2),!(l<=9)&&(o=3/Math.sqrt(l),t[h]=i*o*e[h],t[h+1]=a*o*e[h])}}function Boe(n,e,t="x"){const s=RE(t),i=n.length;let a,o,l,c=Uu(n,0);for(let d=0;d<i;++d){if(o=l,l=c,c=Uu(n,d+1),!l)continue;const h=l[t],m=l[s];o&&(a=(h-o[t])/3,l[`cp1${t}`]=h-a,l[`cp1${s}`]=m-a*e[d]),c&&(a=(c[t]-h)/3,l[`cp2${t}`]=h+a,l[`cp2${s}`]=m+a*e[d])}}function Noe(n,e="x"){const t=RE(e),s=n.length,i=Array(s).fill(0),a=Array(s);let o,l,c,d=Uu(n,0);for(o=0;o<s;++o)if(l=c,c=d,d=Uu(n,o+1),!!c){if(d){const h=d[e]-c[e];i[o]=h!==0?(d[t]-c[t])/h:0}a[o]=l?d?Wo(i[o-1])!==Wo(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}Goe(n,i,a),Boe(n,a,e)}function nf(n,e,t){return Math.max(Math.min(n,t),e)}function koe(n,e){let t,s,i,a,o,l=Ym(n[0],e);for(t=0,s=n.length;t<s;++t)o=a,a=l,l=t<s-1&&Ym(n[t+1],e),a&&(i=n[t],o&&(i.cp1x=nf(i.cp1x,e.left,e.right),i.cp1y=nf(i.cp1y,e.top,e.bottom)),l&&(i.cp2x=nf(i.cp2x,e.left,e.right),i.cp2y=nf(i.cp2y,e.top,e.bottom)))}function Roe(n,e,t,s,i){let a,o,l,c;if(e.spanGaps&&(n=n.filter(d=>!d.skip)),e.cubicInterpolationMode==="monotone")Noe(n,i);else{let d=s?n[n.length-1]:n[0];for(a=0,o=n.length;a<o;++a)l=n[a],c=Zoe(d,l,n[Math.min(a+1,o-(s?0:1))%o],e.tension),l.cp1x=c.previous.x,l.cp1y=c.previous.y,l.cp2x=c.next.x,l.cp2y=c.next.y,d=l}e.capBezierPoints&&koe(n,t)}function aB(){return typeof window<"u"&&typeof document<"u"}function oB(n){let e=n.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function ap(n,e,t){let s;return typeof n=="string"?(s=parseInt(n,10),n.indexOf("%")!==-1&&(s=s/100*e.parentNode[t])):s=n,s}const Kp=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function Woe(n,e){return Kp(n).getPropertyValue(e)}const Voe=["top","right","bottom","left"];function bg(n,e,t){const s={};t=t?"-"+t:"";for(let i=0;i<4;i++){const a=Voe[i];s[a]=parseFloat(n[e+"-"+a+t])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const _oe=(n,e,t)=>(n>0||e>0)&&(!t||!t.shadowRoot);function joe(n,e){const t=n.touches,s=t&&t.length?t[0]:n,{offsetX:i,offsetY:a}=s;let o=!1,l,c;if(_oe(i,a,n.target))l=i,c=a;else{const d=e.getBoundingClientRect();l=s.clientX-d.left,c=s.clientY-d.top,o=!0}return{x:l,y:c,box:o}}function cg(n,e){if("native"in n)return n;const{canvas:t,currentDevicePixelRatio:s}=e,i=Kp(t),a=i.boxSizing==="border-box",o=bg(i,"padding"),l=bg(i,"border","width"),{x:c,y:d,box:h}=joe(n,t),m=o.left+(h&&l.left),f=o.top+(h&&l.top);let{width:p,height:b}=e;return a&&(p-=o.width+l.width,b-=o.height+l.height),{x:Math.round((c-m)/p*t.width/s),y:Math.round((d-f)/b*t.height/s)}}function Xoe(n,e,t){let s,i;if(e===void 0||t===void 0){const a=n&&oB(n);if(!a)e=n.clientWidth,t=n.clientHeight;else{const o=a.getBoundingClientRect(),l=Kp(a),c=bg(l,"border","width"),d=bg(l,"padding");e=o.width-d.width-c.width,t=o.height-d.height-c.height,s=ap(l.maxWidth,a,"clientWidth"),i=ap(l.maxHeight,a,"clientHeight")}}return{width:e,height:t,maxWidth:s||sp,maxHeight:i||sp}}const Pc=n=>Math.round(n*10)/10;function Joe(n,e,t,s){const i=Kp(n),a=bg(i,"margin"),o=ap(i.maxWidth,n,"clientWidth")||sp,l=ap(i.maxHeight,n,"clientHeight")||sp,c=Xoe(n,e,t);let{width:d,height:h}=c;if(i.boxSizing==="content-box"){const f=bg(i,"border","width"),p=bg(i,"padding");d-=p.width+f.width,h-=p.height+f.height}return d=Math.max(0,d-a.width),h=Math.max(0,s?d/s:h-a.height),d=Pc(Math.min(d,o,c.maxWidth)),h=Pc(Math.min(h,l,c.maxHeight)),d&&!h&&(h=Pc(d/2)),(e!==void 0||t!==void 0)&&s&&c.height&&h>c.height&&(h=c.height,d=Pc(Math.floor(h*s))),{width:d,height:h}}function kJ(n,e,t){const s=e||1,i=Pc(n.height*s),a=Pc(n.width*s);n.height=Pc(n.height),n.width=Pc(n.width);const o=n.canvas;return o.style&&(t||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==s||o.height!==i||o.width!==a?(n.currentDevicePixelRatio=s,o.height=i,o.width=a,n.ctx.setTransform(s,0,0,s,0,0),!0):!1}const Yoe=(function(){let n=!1;try{const e={get passive(){return n=!0,!1}};aB()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return n})();function RJ(n,e){const t=Woe(n,e),s=t&&t.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function dg(n,e,t,s){return{x:n.x+t*(e.x-n.x),y:n.y+t*(e.y-n.y)}}function Foe(n,e,t,s){return{x:n.x+t*(e.x-n.x),y:s==="middle"?t<.5?n.y:e.y:s==="after"?t<1?n.y:e.y:t>0?e.y:n.y}}function Moe(n,e,t,s){const i={x:n.cp2x,y:n.cp2y},a={x:e.cp1x,y:e.cp1y},o=dg(n,i,t),l=dg(i,a,t),c=dg(a,e,t),d=dg(o,l,t),h=dg(l,c,t);return dg(d,h,t)}const Hoe=function(n,e){return{x(t){return n+n+e-t},setWidth(t){e=t},textAlign(t){return t==="center"?t:t==="right"?"left":"right"},xPlus(t,s){return t-s},leftForLtr(t,s){return t-s}}},Toe=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,e){return n+e},leftForLtr(n,e){return n}}};function Gu(n,e,t){return n?Hoe(e,t):Toe()}function WE(n,e){let t,s;(e==="ltr"||e==="rtl")&&(t=n.canvas.style,s=[t.getPropertyValue("direction"),t.getPropertyPriority("direction")],t.setProperty("direction",e,"important"),n.prevTextDirection=s)}function VE(n,e){e!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",e[0],e[1]))}function _E(n){return n==="angle"?{between:Jm,compare:Hae,normalize:bi}:{between:kl,compare:(e,t)=>e-t,normalize:e=>e}}function WJ({start:n,end:e,count:t,loop:s,style:i}){return{start:n%t,end:e%t,loop:s&&(e-n+1)%t===0,style:i}}function Eoe(n,e,t){const{property:s,start:i,end:a}=t,{between:o,normalize:l}=_E(s),c=e.length;let{start:d,end:h,loop:m}=n,f,p;if(m){for(d+=c,h+=c,f=0,p=c;f<p&&o(l(e[d%c][s]),i,a);++f)d--,h--;d%=c,h%=c}return h<d&&(h+=c),{start:d,end:h,loop:m,style:n.style}}function jE(n,e,t){if(!t)return[n];const{property:s,start:i,end:a}=t,o=e.length,{compare:l,between:c,normalize:d}=_E(s),{start:h,end:m,loop:f,style:p}=Eoe(n,e,t),b=[];let x=!1,v=null,S,B,V;const R=()=>c(i,V,S)&&l(i,V)!==0,W=()=>l(a,S)===0||c(a,V,S),_=()=>x||R(),Y=()=>!x||W();for(let j=h,M=h;j<=m;++j)B=e[j%o],!B.skip&&(S=d(B[s]),S!==V&&(x=c(S,i,a),v===null&&_()&&(v=l(S,i)===0?j:M),v!==null&&Y()&&(b.push(WJ({start:v,end:j,loop:f,count:o,style:p})),v=null),M=j,V=S));return v!==null&&b.push(WJ({start:v,end:m,loop:f,count:o,style:p})),b}function XE(n,e){const t=[],s=n.segments;for(let i=0;i<s.length;i++){const a=jE(s[i],n.points,e);a.length&&t.push(...a)}return t}function Doe(n,e,t,s){let i=0,a=e-1;if(t&&!s)for(;i<e&&!n[i].skip;)i++;for(;i<e&&n[i].skip;)i++;for(i%=e,t&&(a+=i);a>i&&n[a%e].skip;)a--;return a%=e,{start:i,end:a}}function Loe(n,e,t,s){const i=n.length,a=[];let o=e,l=n[e],c;for(c=e+1;c<=t;++c){const d=n[c%i];d.skip||d.stop?l.skip||(s=!1,a.push({start:e%i,end:(c-1)%i,loop:s}),e=o=d.stop?c:null):(o=c,l.skip&&(e=c)),l=d}return o!==null&&a.push({start:e%i,end:o%i,loop:s}),a}function Poe(n,e){const t=n.points,s=n.options.spanGaps,i=t.length;if(!i)return[];const a=!!n._loop,{start:o,end:l}=Doe(t,i,a,s);if(s===!0)return VJ(n,[{start:o,end:l,loop:a}],t,e);const c=l<o?l+i:l,d=!!n._fullLoop&&o===0&&l===i-1;return VJ(n,Loe(t,o,c,d),t,e)}function VJ(n,e,t,s){return!s||!s.setContext||!t?e:Koe(n,e,t,s)}function Koe(n,e,t,s){const i=n._chart.getContext(),a=_J(n.options),{_datasetIndex:o,options:{spanGaps:l}}=n,c=t.length,d=[];let h=a,m=e[0].start,f=m;function p(b,x,v,S){const B=l?-1:1;if(b!==x){for(b+=c;t[b%c].skip;)b-=B;for(;t[x%c].skip;)x+=B;b%c!==x%c&&(d.push({start:b%c,end:x%c,loop:v,style:S}),h=S,m=x%c)}}for(const b of e){m=l?m:b.start;let x=t[m%c],v;for(f=m+1;f<=b.end;f++){const S=t[f%c];v=_J(s.setContext(_g(i,{type:"segment",p0:x,p1:S,p0DataIndex:(f-1)%c,p1DataIndex:f%c,datasetIndex:o}))),Ooe(v,h)&&p(m,f-1,b.loop,h),x=S,h=v}m<f-1&&p(m,f-1,b.loop,h)}return d}function _J(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function Ooe(n,e){if(!e)return!1;const t=[],s=function(i,a){return eB(a)?(t.includes(a)||t.push(a),t.indexOf(a)):a};return JSON.stringify(n,s)!==JSON.stringify(e,s)}function sf(n,e,t){return n.options.clip?n[t]:e[t]}function zoe(n,e){const{xScale:t,yScale:s}=n;return t&&s?{left:sf(t,e,"left"),right:sf(t,e,"right"),top:sf(s,e,"top"),bottom:sf(s,e,"bottom")}:e}function JE(n,e){const t=e._clip;if(t.disabled)return!1;const s=zoe(e,n.chartArea);return{left:t.left===!1?0:s.left-(t.left===!0?0:t.left),right:t.right===!1?n.width:s.right+(t.right===!0?0:t.right),top:t.top===!1?0:s.top-(t.top===!0?0:t.top),bottom:t.bottom===!1?n.height:s.bottom+(t.bottom===!0?0:t.bottom)}}class Uoe{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,s,i){const a=t.listeners[i],o=t.duration;a.forEach(l=>l({chart:e,initial:t.initial,numSteps:o,currentStep:Math.min(s-t.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=yE.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const a=s.items;let o=a.length-1,l=!1,c;for(;o>=0;--o)c=a[o],c._active?(c._total>s.duration&&(s.duration=c._total),c.tick(e),l=!0):(a[o]=a[a.length-1],a.pop());l&&(i.draw(),this._notify(i,s,e,"progress")),a.length||(s.running=!1,this._notify(i,s,e,"complete"),s.initial=!1),t+=a.length}),this._lastDate=e,t===0&&(this._running=!1)}_getAnims(e){const t=this._charts;let s=t.get(e);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,s)),s}listen(e,t,s){this._getAnims(e).listeners[t].push(s)}add(e,t){!t||!t.length||this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!(!t||!t.running||!t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const s=t.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var xl=new Uoe;const jJ="transparent",Qoe={boolean(n,e,t){return t>.5?e:n},color(n,e,t){const s=SJ(n||jJ),i=s.valid&&SJ(e||jJ);return i&&i.valid?i.mix(s,t).hexString():e},number(n,e,t){return n+(e-n)*t}};class qoe{constructor(e,t,s,i){const a=t[s];i=tf([e.to,i,a,e.from]);const o=tf([e.from,a,i]);this._active=!0,this._fn=e.fn||Qoe[e.type||typeof o],this._easing=Im[e.easing]||Im.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=s,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,s){if(this._active){this._notify(!1);const i=this._target[this._prop],a=s-this._start,o=this._duration-a;this._start=s,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=a,this._loop=!!e.loop,this._to=tf([e.to,t,i,e.from]),this._from=tf([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,s=this._duration,i=this._prop,a=this._from,o=this._loop,l=this._to;let c;if(this._active=a!==l&&(o||t<s),!this._active){this._target[i]=l,this._notify(!0);return}if(t<0){this._target[i]=a;return}c=t/s%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[i]=this._fn(a,l,c)}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,s)=>{e.push({res:t,rej:s})})}_notify(e){const t=e?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][t]()}}class YE{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!sn(e))return;const t=Object.keys(hs.animation),s=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const a=e[i];if(!sn(a))return;const o={};for(const l of t)o[l]=a[l];(_s(a.properties)&&a.properties||[i]).forEach(l=>{(l===i||!s.has(l))&&s.set(l,o)})})}_animateOptions(e,t){const s=t.options,i=ele(e,s);if(!i)return[];const a=this._createAnimations(i,s);return s.$shared&&$oe(e.options.$animations,s).then(()=>{e.options=s},()=>{}),a}_createAnimations(e,t){const s=this._properties,i=[],a=e.$animations||(e.$animations={}),o=Object.keys(t),l=Date.now();let c;for(c=o.length-1;c>=0;--c){const d=o[c];if(d.charAt(0)==="$")continue;if(d==="options"){i.push(...this._animateOptions(e,t));continue}const h=t[d];let m=a[d];const f=s.get(d);if(m)if(f&&m.active()){m.update(f,h,l);continue}else m.cancel();if(!f||!f.duration){e[d]=h;continue}a[d]=m=new qoe(f,e,d,h),i.push(m)}return i}update(e,t){if(this._properties.size===0){Object.assign(e,t);return}const s=this._createAnimations(e,t);if(s.length)return xl.add(this._chart,s),!0}}function $oe(n,e){const t=[],s=Object.keys(e);for(let i=0;i<s.length;i++){const a=n[s[i]];a&&a.active()&&t.push(a.wait())}return Promise.all(t)}function ele(n,e){if(!e)return;let t=n.options;if(!t){n.options=e;return}return t.$shared&&(n.options=t=Object.assign({},t,{$shared:!1,$animations:{}})),t}function XJ(n,e){const t=n&&n.options||{},s=t.reverse,i=t.min===void 0?e:0,a=t.max===void 0?e:0;return{start:s?a:i,end:s?i:a}}function tle(n,e,t){if(t===!1)return!1;const s=XJ(n,t),i=XJ(e,t);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function nle(n){let e,t,s,i;return sn(n)?(e=n.top,t=n.right,s=n.bottom,i=n.left):e=t=s=i=n,{top:e,right:t,bottom:s,left:i,disabled:n===!1}}function FE(n,e){const t=[],s=n._getSortedDatasetMetas(e);let i,a;for(i=0,a=s.length;i<a;++i)t.push(s[i].index);return t}function JJ(n,e,t,s={}){const i=n.keys,a=s.mode==="single";let o,l,c,d;if(e===null)return;let h=!1;for(o=0,l=i.length;o<l;++o){if(c=+i[o],c===t){if(h=!0,s.all)continue;break}d=n.values[c],pr(d)&&(a||e===0||Wo(e)===Wo(d))&&(e+=d)}return!h&&!s.all?0:e}function sle(n,e){const{iScale:t,vScale:s}=e,i=t.axis==="x"?"x":"y",a=s.axis==="x"?"x":"y",o=Object.keys(n),l=new Array(o.length);let c,d,h;for(c=0,d=o.length;c<d;++c)h=o[c],l[c]={[i]:h,[a]:n[h]};return l}function $S(n,e){const t=n&&n.options.stacked;return t||t===void 0&&e.stack!==void 0}function rle(n,e,t){return`${n.id}.${e.id}.${t.stack||t.type}`}function ile(n){const{min:e,max:t,minDefined:s,maxDefined:i}=n.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:i?t:Number.POSITIVE_INFINITY}}function ale(n,e,t){const s=n[e]||(n[e]={});return s[t]||(s[t]={})}function YJ(n,e,t,s){for(const i of e.getMatchingVisibleMetas(s).reverse()){const a=n[i.index];if(t&&a>0||!t&&a<0)return i.index}return null}function FJ(n,e){const{chart:t,_cachedMeta:s}=n,i=t._stacks||(t._stacks={}),{iScale:a,vScale:o,index:l}=s,c=a.axis,d=o.axis,h=rle(a,o,s),m=e.length;let f;for(let p=0;p<m;++p){const b=e[p],{[c]:x,[d]:v}=b,S=b._stacks||(b._stacks={});f=S[d]=ale(i,h,x),f[l]=v,f._top=YJ(f,o,!0,s.type),f._bottom=YJ(f,o,!1,s.type);const B=f._visualValues||(f._visualValues={});B[l]=v}}function ew(n,e){const t=n.scales;return Object.keys(t).filter(s=>t[s].axis===e).shift()}function ole(n,e){return _g(n,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function lle(n,e,t){return _g(n,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"})}function Ph(n,e){const t=n.controller.index,s=n.vScale&&n.vScale.axis;if(s){e=e||n._parsed;for(const i of e){const a=i._stacks;if(!a||a[s]===void 0||a[s][t]===void 0)return;delete a[s][t],a[s]._visualValues!==void 0&&a[s]._visualValues[t]!==void 0&&delete a[s]._visualValues[t]}}}const tw=n=>n==="reset"||n==="none",MJ=(n,e)=>e?n:Object.assign({},n),cle=(n,e,t)=>n&&!e.hidden&&e._stacked&&{keys:FE(t,!0),values:null};class Op{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=$S(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Ph(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,s=this.getDataset(),i=(m,f,p,b)=>m==="x"?f:m==="r"?b:p,a=t.xAxisID=Kt(s.xAxisID,ew(e,"x")),o=t.yAxisID=Kt(s.yAxisID,ew(e,"y")),l=t.rAxisID=Kt(s.rAxisID,ew(e,"r")),c=t.indexAxis,d=t.iAxisID=i(c,a,o,l),h=t.vAxisID=i(c,o,a,l);t.xScale=this.getScaleForId(a),t.yScale=this.getScaleForId(o),t.rScale=this.getScaleForId(l),t.iScale=this.getScaleForId(d),t.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&yJ(this._data,this),e._stacked&&Ph(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),s=this._data;if(sn(t)){const i=this._cachedMeta;this._data=sle(t,i)}else if(s!==t){if(s){yJ(s,this);const i=this._cachedMeta;Ph(i),i._parsed=[]}t&&Object.isExtensible(t)&&Lae(t,this),this._syncList=[],this._data=t}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const a=t._stacked;t._stacked=$S(t.vScale,t),t.stack!==s.stack&&(i=!0,Ph(t),t.stack=s.stack),this._resyncElements(e),(i||a!==t._stacked)&&(FJ(this,t._parsed),t._stacked=$S(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),s=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:s,_data:i}=this,{iScale:a,_stacked:o}=s,l=a.axis;let c=e===0&&t===i.length?!0:s._sorted,d=e>0&&s._parsed[e-1],h,m,f;if(this._parsing===!1)s._parsed=i,s._sorted=!0,f=i;else{_s(i[e])?f=this.parseArrayData(s,i,e,t):sn(i[e])?f=this.parseObjectData(s,i,e,t):f=this.parsePrimitiveData(s,i,e,t);const p=()=>m[l]===null||d&&m[l]<d[l];for(h=0;h<t;++h)s._parsed[h+e]=m=f[h],c&&(p()&&(c=!1),d=m);s._sorted=c}o&&FJ(this,f)}parsePrimitiveData(e,t,s,i){const{iScale:a,vScale:o}=e,l=a.axis,c=o.axis,d=a.getLabels(),h=a===o,m=new Array(i);let f,p,b;for(f=0,p=i;f<p;++f)b=f+s,m[f]={[l]:h||a.parse(d[b],b),[c]:o.parse(t[b],b)};return m}parseArrayData(e,t,s,i){const{xScale:a,yScale:o}=e,l=new Array(i);let c,d,h,m;for(c=0,d=i;c<d;++c)h=c+s,m=t[h],l[c]={x:a.parse(m[0],h),y:o.parse(m[1],h)};return l}parseObjectData(e,t,s,i){const{xScale:a,yScale:o}=e,{xAxisKey:l="x",yAxisKey:c="y"}=this._parsing,d=new Array(i);let h,m,f,p;for(h=0,m=i;h<m;++h)f=h+s,p=t[f],d[h]={x:a.parse(wg(p,l),f),y:o.parse(wg(p,c),f)};return d}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,s){const i=this.chart,a=this._cachedMeta,o=t[e.axis],l={keys:FE(i,!0),values:t._stacks[e.axis]._visualValues};return JJ(l,o,a.index,{mode:s})}updateRangeFromParsed(e,t,s,i){const a=s[t.axis];let o=a===null?NaN:a;const l=i&&s._stacks[t.axis];i&&l&&(i.values=l,o=JJ(i,a,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,t){const s=this._cachedMeta,i=s._parsed,a=s._sorted&&e===s.iScale,o=i.length,l=this._getOtherScale(e),c=cle(t,s,this.chart),d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:m}=ile(l);let f,p;function b(){p=i[f];const x=p[l.axis];return!pr(p[e.axis])||h>x||m<x}for(f=0;f<o&&!(!b()&&(this.updateRangeFromParsed(d,e,p,c),a));++f);if(a){for(f=o-1;f>=0;--f)if(!b()){this.updateRangeFromParsed(d,e,p,c);break}}return d}getAllParsedValues(e){const t=this._cachedMeta._parsed,s=[];let i,a,o;for(i=0,a=t.length;i<a;++i)o=t[i][e.axis],pr(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,s=t.iScale,i=t.vScale,a=this.getParsed(e);return{label:s?""+s.getLabelForValue(a[s.axis]):"",value:i?""+i.getLabelForValue(a[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=nle(Kt(this.options.clip,tle(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,s=this._cachedMeta,i=s.data||[],a=t.chartArea,o=[],l=this._drawStart||0,c=this._drawCount||i.length-l,d=this.options.drawActiveElementsOnTop;let h;for(s.dataset&&s.dataset.draw(e,a,l,c),h=l;h<l+c;++h){const m=i[h];m.hidden||(m.active&&d?o.push(m):m.draw(e,a))}for(h=0;h<o.length;++h)o[h].draw(e,a)}getStyle(e,t){const s=t?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(e||0,s)}getContext(e,t,s){const i=this.getDataset();let a;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];a=o.$context||(o.$context=lle(this.getContext(),e,o)),a.parsed=this.getParsed(e),a.raw=i.data[e],a.index=a.dataIndex=e}else a=this.$context||(this.$context=ole(this.chart.getContext(),this.index)),a.dataset=i,a.index=a.datasetIndex=this.index;return a.active=!!t,a.mode=s,a}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",s){const i=t==="active",a=this._cachedDataOpts,o=e+"-"+t,l=a[o],c=this.enableOptionSharing&&jm(s);if(l)return MJ(l,c);const d=this.chart.config,h=d.datasetElementScopeKeys(this._type,e),m=i?[`${e}Hover`,"hover",e,""]:[e,""],f=d.getOptionScopes(this.getDataset(),h),p=Object.keys(hs.elements[e]),b=()=>this.getContext(s,i,t),x=d.resolveNamedOptions(f,p,b,m);return x.$shared&&(x.$shared=c,a[o]=Object.freeze(MJ(x,c))),x}_resolveAnimations(e,t,s){const i=this.chart,a=this._cachedDataOpts,o=`animation-${t}`,l=a[o];if(l)return l;let c;if(i.options.animation!==!1){const h=this.chart.config,m=h.datasetAnimationScopeKeys(this._type,t),f=h.getOptionScopes(this.getDataset(),m);c=h.createResolver(f,this.getContext(e,s,t))}const d=new YE(i,c&&c.animations);return c&&c._cacheable&&(a[o]=Object.freeze(d)),d}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||tw(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const s=this.resolveDataElementOptions(e,t),i=this._sharedOptions,a=this.getSharedOptions(s),o=this.includeOptions(t,a)||a!==i;return this.updateSharedOptions(a,t,s),{sharedOptions:a,includeOptions:o}}updateElement(e,t,s,i){tw(i)?Object.assign(e,s):this._resolveAnimations(t,i).update(e,s)}updateSharedOptions(e,t,s){e&&!tw(t)&&this._resolveAnimations(void 0,t).update(e,s)}_setStyle(e,t,s,i){e.active=i;const a=this.getStyle(t,i);this._resolveAnimations(t,s,i).update(e,{options:!i&&this.getSharedOptions(a)||a})}removeHoverStyle(e,t,s){this._setStyle(e,s,"active",!1)}setHoverStyle(e,t,s){this._setStyle(e,s,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,s=this._cachedMeta.data;for(const[l,c,d]of this._syncList)this[l](c,d);this._syncList=[];const i=s.length,a=t.length,o=Math.min(a,i);o&&this.parse(0,o),a>i?this._insertElements(i,a-i,e):a<i&&this._removeElements(a,i-a)}_insertElements(e,t,s=!0){const i=this._cachedMeta,a=i.data,o=e+t;let l;const c=d=>{for(d.length+=t,l=d.length-1;l>=o;l--)d[l]=d[l-t]};for(c(a),l=e;l<o;++l)a[l]=new this.dataElementType;this._parsing&&c(i._parsed),this.parse(e,t),s&&this.updateElements(a,e,t,"reset")}updateElements(e,t,s,i){}_removeElements(e,t){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(e,t);s._stacked&&Ph(s,i)}s.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,s,i]=e;this[t](s,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const s=arguments.length-2;s&&this._sync(["_insertElements",e,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function dle(n,e){if(!n._cache.$bar){const t=n.getMatchingVisibleMetas(e);let s=[];for(let i=0,a=t.length;i<a;i++)s=s.concat(t[i].controller.getAllParsedValues(n));n._cache.$bar=bE(s.sort((i,a)=>i-a))}return n._cache.$bar}function gle(n){const e=n.iScale,t=dle(e,n.type);let s=e._length,i,a,o,l;const c=()=>{o===32767||o===-32768||(jm(l)&&(s=Math.min(s,Math.abs(o-l)||s)),l=o)};for(i=0,a=t.length;i<a;++i)o=e.getPixelForValue(t[i]),c();for(l=void 0,i=0,a=e.ticks.length;i<a;++i)o=e.getPixelForTick(i),c();return s}function ule(n,e,t,s){const i=t.barThickness;let a,o;return Sn(i)?(a=e.min*t.categoryPercentage,o=t.barPercentage):(a=i*s,o=1),{chunk:a/s,ratio:o,start:e.pixels[n]-a/2}}function hle(n,e,t,s){const i=e.pixels,a=i[n];let o=n>0?i[n-1]:null,l=n<i.length-1?i[n+1]:null;const c=t.categoryPercentage;o===null&&(o=a-(l===null?e.end-e.start:l-a)),l===null&&(l=a+a-o);const d=a-(a-Math.min(o,l))/2*c;return{chunk:Math.abs(l-o)/2*c/s,ratio:t.barPercentage,start:d}}function mle(n,e,t,s){const i=t.parse(n[0],s),a=t.parse(n[1],s),o=Math.min(i,a),l=Math.max(i,a);let c=o,d=l;Math.abs(o)>Math.abs(l)&&(c=l,d=o),e[t.axis]=d,e._custom={barStart:c,barEnd:d,start:i,end:a,min:o,max:l}}function ME(n,e,t,s){return _s(n)?mle(n,e,t,s):e[t.axis]=t.parse(n,s),e}function HJ(n,e,t,s){const i=n.iScale,a=n.vScale,o=i.getLabels(),l=i===a,c=[];let d,h,m,f;for(d=t,h=t+s;d<h;++d)f=e[d],m={},m[i.axis]=l||i.parse(o[d],d),c.push(ME(f,m,a,d));return c}function nw(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function Ile(n,e,t){return n!==0?Wo(n):(e.isHorizontal()?1:-1)*(e.min>=t?1:-1)}function Cle(n){let e,t,s,i,a;return n.horizontal?(e=n.base>n.x,t="left",s="right"):(e=n.base<n.y,t="bottom",s="top"),e?(i="end",a="start"):(i="start",a="end"),{start:t,end:s,reverse:e,top:i,bottom:a}}function fle(n,e,t,s){let i=e.borderSkipped;const a={};if(!i){n.borderSkipped=a;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:l,reverse:c,top:d,bottom:h}=Cle(n);i==="middle"&&t&&(n.enableBorderRadius=!0,(t._top||0)===s?i=d:(t._bottom||0)===s?i=h:(a[TJ(h,o,l,c)]=!0,i=d)),a[TJ(i,o,l,c)]=!0,n.borderSkipped=a}function TJ(n,e,t,s){return s?(n=ple(n,e,t),n=EJ(n,t,e)):n=EJ(n,e,t),n}function ple(n,e,t){return n===e?t:n===t?e:n}function EJ(n,e,t){return n==="start"?e:n==="end"?t:n}function Ale(n,{inflateAmount:e},t){n.inflateAmount=e==="auto"?t===1?.33:0:e}class ble extends Op{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,s,i){return HJ(e,t,s,i)}parseArrayData(e,t,s,i){return HJ(e,t,s,i)}parseObjectData(e,t,s,i){const{iScale:a,vScale:o}=e,{xAxisKey:l="x",yAxisKey:c="y"}=this._parsing,d=a.axis==="x"?l:c,h=o.axis==="x"?l:c,m=[];let f,p,b,x;for(f=s,p=s+i;f<p;++f)x=t[f],b={},b[a.axis]=a.parse(wg(x,d),f),m.push(ME(wg(x,h),b,o,f));return m}updateRangeFromParsed(e,t,s,i){super.updateRangeFromParsed(e,t,s,i);const a=s._custom;a&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,a.min),e.max=Math.max(e.max,a.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:s,vScale:i}=t,a=this.getParsed(e),o=a._custom,l=nw(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(a[i.axis]);return{label:""+s.getLabelForValue(a[s.axis]),value:l}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,s,i){const a=i==="reset",{index:o,_cachedMeta:{vScale:l}}=this,c=l.getBasePixel(),d=l.isHorizontal(),h=this._getRuler(),{sharedOptions:m,includeOptions:f}=this._getSharedOptions(t,i);for(let p=t;p<t+s;p++){const b=this.getParsed(p),x=a||Sn(b[l.axis])?{base:c,head:c}:this._calculateBarValuePixels(p),v=this._calculateBarIndexPixels(p,h),S=(b._stacks||{})[l.axis],B={horizontal:d,base:x.base,enableBorderRadius:!S||nw(b._custom)||o===S._top||o===S._bottom,x:d?x.head:v.center,y:d?v.center:x.head,height:d?v.size:Math.abs(x.size),width:d?Math.abs(x.size):v.size};f&&(B.options=m||this.resolveDataElementOptions(p,e[p].active?"active":i));const V=B.options||e[p].options;fle(B,V,S,o),Ale(B,V,h.ratio),this.updateElement(e[p],p,B,i)}}_getStacks(e,t){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),a=s.options.stacked,o=[],l=this._cachedMeta.controller.getParsed(t),c=l&&l[s.axis],d=h=>{const m=h._parsed.find(p=>p[s.axis]===c),f=m&&m[h.vScale.axis];if(Sn(f)||isNaN(f))return!0};for(const h of i)if(!(t!==void 0&&d(h))&&((a===!1||o.indexOf(h.stack)===-1||a===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===e))break;return o.length||o.push(void 0),o}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(s=>e[s].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)e[Kt(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,s){const i=this._getStacks(e,s),a=t!==void 0?i.indexOf(t):-1;return a===-1?i.length-1:a}_getRuler(){const e=this.options,t=this._cachedMeta,s=t.iScale,i=[];let a,o;for(a=0,o=t.data.length;a<o;++a)i.push(s.getPixelForValue(this.getParsed(a)[s.axis],a));const l=e.barThickness;return{min:l||gle(t),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:e.grouped,ratio:l?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:s,index:i},options:{base:a,minBarLength:o}}=this,l=a||0,c=this.getParsed(e),d=c._custom,h=nw(d);let m=c[t.axis],f=0,p=s?this.applyStack(t,c,s):m,b,x;p!==m&&(f=p-m,p=m),h&&(m=d.barStart,p=d.barEnd-d.barStart,m!==0&&Wo(m)!==Wo(d.barEnd)&&(f=0),f+=m);const v=!Sn(a)&&!h?a:f;let S=t.getPixelForValue(v);if(this.chart.getDataVisibility(e)?b=t.getPixelForValue(f+p):b=S,x=b-S,Math.abs(x)<o){x=Ile(x,t,l)*o,m===l&&(S-=x/2);const B=t.getPixelForDecimal(0),V=t.getPixelForDecimal(1),R=Math.min(B,V),W=Math.max(B,V);S=Math.max(Math.min(S,W),R),b=S+x,s&&!h&&(c._stacks[t.axis]._visualValues[i]=t.getValueForPixel(b)-t.getValueForPixel(S))}if(S===t.getPixelForValue(l)){const B=Wo(x)*t.getLineWidthForValue(l)/2;S+=B,x-=B}return{size:x,base:S,head:b,center:b+x/2}}_calculateBarIndexPixels(e,t){const s=t.scale,i=this.options,a=i.skipNull,o=Kt(i.maxBarThickness,1/0);let l,c;const d=this._getAxisCount();if(t.grouped){const h=a?this._getStackCount(e):t.stackCount,m=i.barThickness==="flex"?hle(e,t,i,h*d):ule(e,t,i,h*d),f=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,p=this._getAxis().indexOf(Kt(f,this.getFirstScaleIdForIndexAxis())),b=this._getStackIndex(this.index,this._cachedMeta.stack,a?e:void 0)+p;l=m.start+m.chunk*b+m.chunk/2,c=Math.min(o,m.chunk*m.ratio)}else l=s.getPixelForValue(this.getParsed(e)[s.axis],e),c=Math.min(o,t.min*t.ratio);return{base:l-c/2,head:l+c/2,center:l,size:c}}draw(){const e=this._cachedMeta,t=e.vScale,s=e.data,i=s.length;let a=0;for(;a<i;++a)this.getParsed(a)[t.axis]!==null&&!s[a].hidden&&s[a].draw(this._ctx)}}function yle(n,e,t){let s=1,i=1,a=0,o=0;if(e<rs){const l=n,c=l+e,d=Math.cos(l),h=Math.sin(l),m=Math.cos(c),f=Math.sin(c),p=(V,R,W)=>Jm(V,l,c,!0)?1:Math.max(R,R*t,W,W*t),b=(V,R,W)=>Jm(V,l,c,!0)?-1:Math.min(R,R*t,W,W*t),x=p(0,d,m),v=p(js,h,f),S=b(Jn,d,m),B=b(Jn+js,h,f);s=(x-S)/2,i=(v-B)/2,a=-(x+S)/2,o=-(v+B)/2}return{ratioX:s,ratioY:i,offsetX:a,offsetY:o}}class vle extends Op{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data,{labels:{pointStyle:s,textAlign:i,color:a,useBorderRadius:o,borderRadius:l}}=e.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((c,d)=>{const m=e.getDatasetMeta(0).controller.getStyle(d);return{text:c,fillStyle:m.backgroundColor,fontColor:a,hidden:!e.getDataVisibility(d),lineDash:m.borderDash,lineDashOffset:m.borderDashOffset,lineJoin:m.borderJoinStyle,lineWidth:m.borderWidth,strokeStyle:m.borderColor,textAlign:i,pointStyle:s,borderRadius:o&&(l||m.borderRadius),index:d}}):[]}},onClick(e,t,s){s.chart.toggleDataVisibility(t.index),s.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let a=c=>+s[c];if(sn(s[e])){const{key:c="value"}=this._parsing;a=d=>+wg(s[d],c)}let o,l;for(o=e,l=e+t;o<l;++o)i._parsed[o]=a(o)}}_getRotation(){return Nl(this.options.rotation-90)}_getCircumference(){return Nl(this.options.circumference)}_getRotationExtents(){let e=rs,t=-rs;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,a=i._getRotation(),o=i._getCircumference();e=Math.min(e,a),t=Math.max(t,a+o)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:s}=t,i=this._cachedMeta,a=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(a)+this.options.spacing,l=Math.max((Math.min(s.width,s.height)-o)/2,0),c=Math.min(Bae(this.options.cutout,l),1),d=this._getRingWeight(this.index),{circumference:h,rotation:m}=this._getRotationExtents(),{ratioX:f,ratioY:p,offsetX:b,offsetY:x}=yle(m,h,c),v=(s.width-o)/f,S=(s.height-o)/p,B=Math.max(Math.min(v,S)/2,0),V=IE(this.options.radius,B),R=Math.max(V*c,0),W=(V-R)/this._getVisibleDatasetWeightTotal();this.offsetX=b*V,this.offsetY=x*V,i.total=this.calculateTotal(),this.outerRadius=V-W*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-W*d,0),this.updateElements(a,0,a.length,e)}_circumference(e,t){const s=this.options,i=this._cachedMeta,a=this._getCircumference();return t&&s.animation.animateRotate||!this.chart.getDataVisibility(e)||i._parsed[e]===null||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*a/rs)}updateElements(e,t,s,i){const a=i==="reset",o=this.chart,l=o.chartArea,d=o.options.animation,h=(l.left+l.right)/2,m=(l.top+l.bottom)/2,f=a&&d.animateScale,p=f?0:this.innerRadius,b=f?0:this.outerRadius,{sharedOptions:x,includeOptions:v}=this._getSharedOptions(t,i);let S=this._getRotation(),B;for(B=0;B<t;++B)S+=this._circumference(B,a);for(B=t;B<t+s;++B){const V=this._circumference(B,a),R=e[B],W={x:h+this.offsetX,y:m+this.offsetY,startAngle:S,endAngle:S+V,circumference:V,outerRadius:b,innerRadius:p};v&&(W.options=x||this.resolveDataElementOptions(B,R.active?"active":i)),S+=V,this.updateElement(R,B,W,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let s=0,i;for(i=0;i<t.length;i++){const a=e._parsed[i];a!==null&&!isNaN(a)&&this.chart.getDataVisibility(i)&&!t[i].hidden&&(s+=Math.abs(a))}return s}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?rs*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,s=this.chart,i=s.data.labels||[],a=tB(t._parsed[e],s.options.locale);return{label:i[e]||"",value:a}}getMaxBorderWidth(e){let t=0;const s=this.chart;let i,a,o,l,c;if(!e){for(i=0,a=s.data.datasets.length;i<a;++i)if(s.isDatasetVisible(i)){o=s.getDatasetMeta(i),e=o.data,l=o.controller;break}}if(!e)return 0;for(i=0,a=e.length;i<a;++i)c=l.resolveDataElementOptions(i),c.borderAlign!=="inner"&&(t=Math.max(t,c.borderWidth||0,c.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let s=0,i=e.length;s<i;++s){const a=this.resolveDataElementOptions(s);t=Math.max(t,a.offset||0,a.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let s=0;s<e;++s)this.chart.isDatasetVisible(s)&&(t+=this._getRingWeight(s));return t}_getRingWeight(e){return Math.max(Kt(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class xle extends Op{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:s,data:i=[],_dataset:a}=t,o=this.chart._animationsDisabled;let{start:l,count:c}=Oae(t,i,o);this._drawStart=l,this._drawCount=c,zae(t)&&(l=0,c=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!a._decimated,s.points=i;const d=this.resolveDatasetElementOptions(e);this.options.showLine||(d.borderWidth=0),d.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:d},e),this.updateElements(i,l,c,e)}updateElements(e,t,s,i){const a=i==="reset",{iScale:o,vScale:l,_stacked:c,_dataset:d}=this._cachedMeta,{sharedOptions:h,includeOptions:m}=this._getSharedOptions(t,i),f=o.axis,p=l.axis,{spanGaps:b,segment:x}=this.options,v=Xm(b)?b:Number.POSITIVE_INFINITY,S=this.chart._animationsDisabled||a||i==="none",B=t+s,V=e.length;let R=t>0&&this.getParsed(t-1);for(let W=0;W<V;++W){const _=e[W],Y=S?_:{};if(W<t||W>=B){Y.skip=!0;continue}const j=this.getParsed(W),M=Sn(j[p]),H=Y[f]=o.getPixelForValue(j[f],W),D=Y[p]=a||M?l.getBasePixel():l.getPixelForValue(c?this.applyStack(l,j,c):j[p],W);Y.skip=isNaN(H)||isNaN(D)||M,Y.stop=W>0&&Math.abs(j[f]-R[f])>v,x&&(Y.parsed=j,Y.raw=d.data[W]),m&&(Y.options=h||this.resolveDataElementOptions(W,_.active?"active":i)),S||this.updateElement(_,W,Y,i),R=j}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,s=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return s;const a=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,a,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}function ig(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class lB{static override(e){Object.assign(lB.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return ig()}parse(){return ig()}format(){return ig()}add(){return ig()}diff(){return ig()}startOf(){return ig()}endOf(){return ig()}}var Sle={_date:lB};function wle(n,e,t,s){const{controller:i,data:a,_sorted:o}=n,l=i._cachedMeta.iScale,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(l&&e===l.axis&&e!=="r"&&o&&a.length){const d=l._reversePixels?Eae:Cg;if(s){if(i._sharedOptions){const h=a[0],m=typeof h.getRange=="function"&&h.getRange(e);if(m){const f=d(a,e,t-m),p=d(a,e,t+m);return{lo:f.lo,hi:p.hi}}}}else{const h=d(a,e,t);if(c){const{vScale:m}=i._cachedMeta,{_parsed:f}=n,p=f.slice(0,h.lo+1).reverse().findIndex(x=>!Sn(x[m.axis]));h.lo-=Math.max(0,p);const b=f.slice(h.hi).findIndex(x=>!Sn(x[m.axis]));h.hi+=Math.max(0,b)}return h}}return{lo:0,hi:a.length-1}}function zp(n,e,t,s,i){const a=n.getSortedVisibleDatasetMetas(),o=t[e];for(let l=0,c=a.length;l<c;++l){const{index:d,data:h}=a[l],{lo:m,hi:f}=wle(a[l],e,o,i);for(let p=m;p<=f;++p){const b=h[p];b.skip||s(b,d,p)}}}function Zle(n){const e=n.indexOf("x")!==-1,t=n.indexOf("y")!==-1;return function(s,i){const a=e?Math.abs(s.x-i.x):0,o=t?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(a,2)+Math.pow(o,2))}}function sw(n,e,t,s,i){const a=[];return!i&&!n.isPointInArea(e)||zp(n,t,e,function(l,c,d){!i&&!Ym(l,n.chartArea,0)||l.inRange(e.x,e.y,s)&&a.push({element:l,datasetIndex:c,index:d})},!0),a}function Gle(n,e,t,s){let i=[];function a(o,l,c){const{startAngle:d,endAngle:h}=o.getProps(["startAngle","endAngle"],s),{angle:m}=pE(o,{x:e.x,y:e.y});Jm(m,d,h)&&i.push({element:o,datasetIndex:l,index:c})}return zp(n,t,e,a),i}function Ble(n,e,t,s,i,a){let o=[];const l=Zle(t);let c=Number.POSITIVE_INFINITY;function d(h,m,f){const p=h.inRange(e.x,e.y,i);if(s&&!p)return;const b=h.getCenterPoint(i);if(!(!!a||n.isPointInArea(b))&&!p)return;const v=l(e,b);v<c?(o=[{element:h,datasetIndex:m,index:f}],c=v):v===c&&o.push({element:h,datasetIndex:m,index:f})}return zp(n,t,e,d),o}function rw(n,e,t,s,i,a){return!a&&!n.isPointInArea(e)?[]:t==="r"&&!s?Gle(n,e,t,i):Ble(n,e,t,s,i,a)}function DJ(n,e,t,s,i){const a=[],o=t==="x"?"inXRange":"inYRange";let l=!1;return zp(n,t,e,(c,d,h)=>{c[o]&&c[o](e[t],i)&&(a.push({element:c,datasetIndex:d,index:h}),l=l||c.inRange(e.x,e.y,i))}),s&&!l?[]:a}var Nle={modes:{index(n,e,t,s){const i=cg(e,n),a=t.axis||"x",o=t.includeInvisible||!1,l=t.intersect?sw(n,i,a,s,o):rw(n,i,a,!1,s,o),c=[];return l.length?(n.getSortedVisibleDatasetMetas().forEach(d=>{const h=l[0].index,m=d.data[h];m&&!m.skip&&c.push({element:m,datasetIndex:d.index,index:h})}),c):[]},dataset(n,e,t,s){const i=cg(e,n),a=t.axis||"xy",o=t.includeInvisible||!1;let l=t.intersect?sw(n,i,a,s,o):rw(n,i,a,!1,s,o);if(l.length>0){const c=l[0].datasetIndex,d=n.getDatasetMeta(c).data;l=[];for(let h=0;h<d.length;++h)l.push({element:d[h],datasetIndex:c,index:h})}return l},point(n,e,t,s){const i=cg(e,n),a=t.axis||"xy",o=t.includeInvisible||!1;return sw(n,i,a,s,o)},nearest(n,e,t,s){const i=cg(e,n),a=t.axis||"xy",o=t.includeInvisible||!1;return rw(n,i,a,t.intersect,s,o)},x(n,e,t,s){const i=cg(e,n);return DJ(n,i,"x",t.intersect,s)},y(n,e,t,s){const i=cg(e,n);return DJ(n,i,"y",t.intersect,s)}}};const HE=["left","top","right","bottom"];function Kh(n,e){return n.filter(t=>t.pos===e)}function LJ(n,e){return n.filter(t=>HE.indexOf(t.pos)===-1&&t.box.axis===e)}function Oh(n,e){return n.sort((t,s)=>{const i=e?s:t,a=e?t:s;return i.weight===a.weight?i.index-a.index:i.weight-a.weight})}function kle(n){const e=[];let t,s,i,a,o,l;for(t=0,s=(n||[]).length;t<s;++t)i=n[t],{position:a,options:{stack:o,stackWeight:l=1}}=i,e.push({index:t,box:i,pos:a,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&a+o,stackWeight:l});return e}function Rle(n){const e={};for(const t of n){const{stack:s,pos:i,stackWeight:a}=t;if(!s||!HE.includes(i))continue;const o=e[s]||(e[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=a}return e}function Wle(n,e){const t=Rle(n),{vBoxMaxWidth:s,hBoxMaxHeight:i}=e;let a,o,l;for(a=0,o=n.length;a<o;++a){l=n[a];const{fullSize:c}=l.box,d=t[l.stack],h=d&&l.stackWeight/d.weight;l.horizontal?(l.width=h?h*s:c&&e.availableWidth,l.height=i):(l.width=s,l.height=h?h*i:c&&e.availableHeight)}return t}function Vle(n){const e=kle(n),t=Oh(e.filter(d=>d.box.fullSize),!0),s=Oh(Kh(e,"left"),!0),i=Oh(Kh(e,"right")),a=Oh(Kh(e,"top"),!0),o=Oh(Kh(e,"bottom")),l=LJ(e,"x"),c=LJ(e,"y");return{fullSize:t,leftAndTop:s.concat(a),rightAndBottom:i.concat(c).concat(o).concat(l),chartArea:Kh(e,"chartArea"),vertical:s.concat(i).concat(c),horizontal:a.concat(o).concat(l)}}function PJ(n,e,t,s){return Math.max(n[t],e[t])+Math.max(n[s],e[s])}function TE(n,e){n.top=Math.max(n.top,e.top),n.left=Math.max(n.left,e.left),n.bottom=Math.max(n.bottom,e.bottom),n.right=Math.max(n.right,e.right)}function _le(n,e,t,s){const{pos:i,box:a}=t,o=n.maxPadding;if(!sn(i)){t.size&&(n[i]-=t.size);const m=s[t.stack]||{size:0,count:1};m.size=Math.max(m.size,t.horizontal?a.height:a.width),t.size=m.size/m.count,n[i]+=t.size}a.getPadding&&TE(o,a.getPadding());const l=Math.max(0,e.outerWidth-PJ(o,n,"left","right")),c=Math.max(0,e.outerHeight-PJ(o,n,"top","bottom")),d=l!==n.w,h=c!==n.h;return n.w=l,n.h=c,t.horizontal?{same:d,other:h}:{same:h,other:d}}function jle(n){const e=n.maxPadding;function t(s){const i=Math.max(e[s]-n[s],0);return n[s]+=i,i}n.y+=t("top"),n.x+=t("left"),t("right"),t("bottom")}function Xle(n,e){const t=e.maxPadding;function s(i){const a={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{a[o]=Math.max(e[o],t[o])}),a}return s(n?["left","right"]:["top","bottom"])}function im(n,e,t,s){const i=[];let a,o,l,c,d,h;for(a=0,o=n.length,d=0;a<o;++a){l=n[a],c=l.box,c.update(l.width||e.w,l.height||e.h,Xle(l.horizontal,e));const{same:m,other:f}=_le(e,t,l,s);d|=m&&i.length,h=h||f,c.fullSize||i.push(l)}return d&&im(i,e,t,s)||h}function rf(n,e,t,s,i){n.top=t,n.left=e,n.right=e+s,n.bottom=t+i,n.width=s,n.height=i}function KJ(n,e,t,s){const i=t.padding;let{x:a,y:o}=e;for(const l of n){const c=l.box,d=s[l.stack]||{placed:0,weight:1},h=l.stackWeight/d.weight||1;if(l.horizontal){const m=e.w*h,f=d.size||c.height;jm(d.start)&&(o=d.start),c.fullSize?rf(c,i.left,o,t.outerWidth-i.right-i.left,f):rf(c,e.left+d.placed,o,m,f),d.start=o,d.placed+=m,o=c.bottom}else{const m=e.h*h,f=d.size||c.width;jm(d.start)&&(a=d.start),c.fullSize?rf(c,a,i.top,f,t.outerHeight-i.bottom-i.top):rf(c,a,e.top+d.placed,f,m),d.start=a,d.placed+=m,a=c.right}}e.x=a,e.y=o}var Kc={addBox(n,e){n.boxes||(n.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},n.boxes.push(e)},removeBox(n,e){const t=n.boxes?n.boxes.indexOf(e):-1;t!==-1&&n.boxes.splice(t,1)},configure(n,e,t){e.fullSize=t.fullSize,e.position=t.position,e.weight=t.weight},update(n,e,t,s){if(!n)return;const i=Da(n.options.layout.padding),a=Math.max(e-i.width,0),o=Math.max(t-i.height,0),l=Vle(n.boxes),c=l.vertical,d=l.horizontal;Bn(n.boxes,x=>{typeof x.beforeLayout=="function"&&x.beforeLayout()});const h=c.reduce((x,v)=>v.box.options&&v.box.options.display===!1?x:x+1,0)||1,m=Object.freeze({outerWidth:e,outerHeight:t,padding:i,availableWidth:a,availableHeight:o,vBoxMaxWidth:a/2/h,hBoxMaxHeight:o/2}),f=Object.assign({},i);TE(f,Da(s));const p=Object.assign({maxPadding:f,w:a,h:o,x:i.left,y:i.top},i),b=Wle(c.concat(d),m);im(l.fullSize,p,m,b),im(c,p,m,b),im(d,p,m,b)&&im(c,p,m,b),jle(p),KJ(l.leftAndTop,p,m,b),p.x+=p.w,p.y+=p.h,KJ(l.rightAndBottom,p,m,b),n.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},Bn(l.chartArea,x=>{const v=x.box;Object.assign(v,n.chartArea),v.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class EE{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,s){}removeEventListener(e,t,s){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,s,i){return t=Math.max(0,t||e.width),s=s||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):s)}}isAttached(e){return!0}updateConfig(e){}}class Jle extends EE{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Bf="$chartjs",Yle={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},OJ=n=>n===null||n==="";function Fle(n,e){const t=n.style,s=n.getAttribute("height"),i=n.getAttribute("width");if(n[Bf]={initial:{height:s,width:i,style:{display:t.display,height:t.height,width:t.width}}},t.display=t.display||"block",t.boxSizing=t.boxSizing||"border-box",OJ(i)){const a=RJ(n,"width");a!==void 0&&(n.width=a)}if(OJ(s))if(n.style.height==="")n.height=n.width/(e||2);else{const a=RJ(n,"height");a!==void 0&&(n.height=a)}return n}const DE=Yoe?{passive:!0}:!1;function Mle(n,e,t){n&&n.addEventListener(e,t,DE)}function Hle(n,e,t){n&&n.canvas&&n.canvas.removeEventListener(e,t,DE)}function Tle(n,e){const t=Yle[n.type]||n.type,{x:s,y:i}=cg(n,e);return{type:t,chart:e,native:n,x:s!==void 0?s:null,y:i!==void 0?i:null}}function op(n,e){for(const t of n)if(t===e||t.contains(e))return!0}function Ele(n,e,t){const s=n.canvas,i=new MutationObserver(a=>{let o=!1;for(const l of a)o=o||op(l.addedNodes,s),o=o&&!op(l.removedNodes,s);o&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}function Dle(n,e,t){const s=n.canvas,i=new MutationObserver(a=>{let o=!1;for(const l of a)o=o||op(l.removedNodes,s),o=o&&!op(l.addedNodes,s);o&&t()});return i.observe(document,{childList:!0,subtree:!0}),i}const Fm=new Map;let zJ=0;function LE(){const n=window.devicePixelRatio;n!==zJ&&(zJ=n,Fm.forEach((e,t)=>{t.currentDevicePixelRatio!==n&&e()}))}function Lle(n,e){Fm.size||window.addEventListener("resize",LE),Fm.set(n,e)}function Ple(n){Fm.delete(n),Fm.size||window.removeEventListener("resize",LE)}function Kle(n,e,t){const s=n.canvas,i=s&&oB(s);if(!i)return;const a=vE((l,c)=>{const d=i.clientWidth;t(l,c),d<i.clientWidth&&t()},window),o=new ResizeObserver(l=>{const c=l[0],d=c.contentRect.width,h=c.contentRect.height;d===0&&h===0||a(d,h)});return o.observe(i),Lle(n,a),o}function iw(n,e,t){t&&t.disconnect(),e==="resize"&&Ple(n)}function Ole(n,e,t){const s=n.canvas,i=vE(a=>{n.ctx!==null&&t(Tle(a,n))},n);return Mle(s,e,i),i}class zle extends EE{acquireContext(e,t){const s=e&&e.getContext&&e.getContext("2d");return s&&s.canvas===e?(Fle(e,t),s):null}releaseContext(e){const t=e.canvas;if(!t[Bf])return!1;const s=t[Bf].initial;["height","width"].forEach(a=>{const o=s[a];Sn(o)?t.removeAttribute(a):t.setAttribute(a,o)});const i=s.style||{};return Object.keys(i).forEach(a=>{t.style[a]=i[a]}),t.width=t.width,delete t[Bf],!0}addEventListener(e,t,s){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),o={attach:Ele,detach:Dle,resize:Kle}[t]||Ole;i[t]=o(e,t,s)}removeEventListener(e,t){const s=e.$proxies||(e.$proxies={}),i=s[t];if(!i)return;({attach:iw,detach:iw,resize:iw}[t]||Hle)(e,t,i),s[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,s,i){return Joe(e,t,s,i)}isAttached(e){const t=e&&oB(e);return!!(t&&t.isConnected)}}function Ule(n){return!aB()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Jle:zle}let Ad=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:t,y:s}=this.getProps(["x","y"],e);return{x:t,y:s}}hasValue(){return Xm(this.x)&&Xm(this.y)}getProps(e,t){const s=this.$animations;if(!t||!s)return this;const i={};return e.forEach(a=>{i[a]=s[a]&&s[a].active()?s[a]._to:this[a]}),i}};function Qle(n,e){const t=n.options.ticks,s=qle(n),i=Math.min(t.maxTicksLimit||s,s),a=t.major.enabled?ece(e):[],o=a.length,l=a[0],c=a[o-1],d=[];if(o>i)return tce(e,d,a,o/i),d;const h=$le(a,e,i);if(o>0){let m,f;const p=o>1?Math.round((c-l)/(o-1)):null;for(af(e,d,h,Sn(p)?0:l-p,l),m=0,f=o-1;m<f;m++)af(e,d,h,a[m],a[m+1]);return af(e,d,h,c,Sn(p)?e.length:c+p),d}return af(e,d,h),d}function qle(n){const e=n.options.offset,t=n._tickSize(),s=n._length/t+(e?0:1),i=n._maxLength/t;return Math.floor(Math.min(s,i))}function $le(n,e,t){const s=nce(n),i=e.length/t;if(!s)return Math.max(i,1);const a=Xae(s);for(let o=0,l=a.length-1;o<l;o++){const c=a[o];if(c>i)return c}return Math.max(i,1)}function ece(n){const e=[];let t,s;for(t=0,s=n.length;t<s;t++)n[t].major&&e.push(t);return e}function tce(n,e,t,s){let i=0,a=t[0],o;for(s=Math.ceil(s),o=0;o<n.length;o++)o===a&&(e.push(n[o]),i++,a=t[i*s])}function af(n,e,t,s,i){const a=Kt(s,0),o=Math.min(Kt(i,n.length),n.length);let l=0,c,d,h;for(t=Math.ceil(t),i&&(c=i-s,t=c/Math.floor(c/t)),h=a;h<0;)l++,h=Math.round(a+l*t);for(d=Math.max(a,0);d<o;d++)d===h&&(e.push(n[d]),l++,h=Math.round(a+l*t))}function nce(n){const e=n.length;let t,s;if(e<2)return!1;for(s=n[0],t=1;t<e;++t)if(n[t]-n[t-1]!==s)return!1;return s}const sce=n=>n==="left"?"right":n==="right"?"left":n,UJ=(n,e,t)=>e==="top"||e==="left"?n[e]+t:n[e]-t,QJ=(n,e)=>Math.min(e||n,n);function qJ(n,e){const t=[],s=n.length/e,i=n.length;let a=0;for(;a<i;a+=s)t.push(n[Math.floor(a)]);return t}function rce(n,e,t){const s=n.ticks.length,i=Math.min(e,s-1),a=n._startPixel,o=n._endPixel,l=1e-6;let c=n.getPixelForTick(i),d;if(!(t&&(s===1?d=Math.max(c-a,o-c):e===0?d=(n.getPixelForTick(1)-c)/2:d=(c-n.getPixelForTick(i-1))/2,c+=i<e?d:-d,c<a-l||c>o+l)))return c}function ice(n,e){Bn(n,t=>{const s=t.gc,i=s.length/2;let a;if(i>e){for(a=0;a<i;++a)delete t.data[s[a]];s.splice(0,i)}})}function zh(n){return n.drawTicks?n.tickLength:0}function $J(n,e){if(!n.display)return 0;const t=ni(n.font,e),s=Da(n.padding);return(_s(n.text)?n.text.length:1)*t.lineHeight+s.height}function ace(n,e){return _g(n,{scale:e,type:"scale"})}function oce(n,e,t){return _g(n,{tick:t,index:e,type:"tick"})}function lce(n,e,t){let s=xE(n);return(t&&e!=="right"||!t&&e==="right")&&(s=sce(s)),s}function cce(n,e,t,s){const{top:i,left:a,bottom:o,right:l,chart:c}=n,{chartArea:d,scales:h}=c;let m=0,f,p,b;const x=o-i,v=l-a;if(n.isHorizontal()){if(p=pi(s,a,l),sn(t)){const S=Object.keys(t)[0],B=t[S];b=h[S].getPixelForValue(B)+x-e}else t==="center"?b=(d.bottom+d.top)/2+x-e:b=UJ(n,t,e);f=l-a}else{if(sn(t)){const S=Object.keys(t)[0],B=t[S];p=h[S].getPixelForValue(B)-v+e}else t==="center"?p=(d.left+d.right)/2-v+e:p=UJ(n,t,e);b=pi(s,o,i),m=t==="left"?-js:js}return{titleX:p,titleY:b,maxWidth:f,rotation:m}}class ih extends Ad{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:s,_suggestedMax:i}=this;return e=yo(e,Number.POSITIVE_INFINITY),t=yo(t,Number.NEGATIVE_INFINITY),s=yo(s,Number.POSITIVE_INFINITY),i=yo(i,Number.NEGATIVE_INFINITY),{min:yo(e,s),max:yo(t,i),minDefined:pr(e),maxDefined:pr(t)}}getMinMax(e){let{min:t,max:s,minDefined:i,maxDefined:a}=this.getUserBounds(),o;if(i&&a)return{min:t,max:s};const l=this.getMatchingVisibleMetas();for(let c=0,d=l.length;c<d;++c)o=l[c].controller.getMinMax(this,e),i||(t=Math.min(t,o.min)),a||(s=Math.max(s,o.max));return t=a&&t>s?s:t,s=i&&t>s?t:s,{min:yo(t,yo(s,t)),max:yo(s,yo(t,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Pn(this.options.beforeUpdate,[this])}update(e,t,s){const{beginAtZero:i,grace:a,ticks:o}=this.options,l=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Ioe(this,a,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=l<this.ticks.length;this._convertTicksToLabels(c?qJ(this.ticks,l):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=Qle(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,t,s;this.isHorizontal()?(t=this.left,s=this.right):(t=this.top,s=this.bottom,e=!e),this._startPixel=t,this._endPixel=s,this._reversePixels=e,this._length=s-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Pn(this.options.afterUpdate,[this])}beforeSetDimensions(){Pn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Pn(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Pn(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Pn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let s,i,a;for(s=0,i=e.length;s<i;s++)a=e[s],a.label=Pn(t.callback,[a.value,s,e],this)}afterTickToLabelConversion(){Pn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Pn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,s=QJ(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,a=t.maxRotation;let o=i,l,c,d;if(!this._isVisible()||!t.display||i>=a||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const h=this._getLabelSizes(),m=h.widest.width,f=h.highest.height,p=Ir(this.chart.width-m,0,this.maxWidth);l=e.offset?this.maxWidth/s:p/(s-1),m+6>l&&(l=p/(s-(e.offset?.5:1)),c=this.maxHeight-zh(e.grid)-t.padding-$J(e.title,this.chart.options.font),d=Math.sqrt(m*m+f*f),o=Mae(Math.min(Math.asin(Ir((h.highest.height+6)/l,-1,1)),Math.asin(Ir(c/d,-1,1))-Math.asin(Ir(f/d,-1,1)))),o=Math.max(i,Math.min(a,o))),this.labelRotation=o}afterCalculateLabelRotation(){Pn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Pn(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:s,title:i,grid:a}}=this,o=this._isVisible(),l=this.isHorizontal();if(o){const c=$J(i,t.options.font);if(l?(e.width=this.maxWidth,e.height=zh(a)+c):(e.height=this.maxHeight,e.width=zh(a)+c),s.display&&this.ticks.length){const{first:d,last:h,widest:m,highest:f}=this._getLabelSizes(),p=s.padding*2,b=Nl(this.labelRotation),x=Math.cos(b),v=Math.sin(b);if(l){const S=s.mirror?0:v*m.width+x*f.height;e.height=Math.min(this.maxHeight,e.height+S+p)}else{const S=s.mirror?0:x*m.width+v*f.height;e.width=Math.min(this.maxWidth,e.width+S+p)}this._calculatePadding(d,h,v,x)}}this._handleMargins(),l?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,s,i){const{ticks:{align:a,padding:o},position:l}=this.options,c=this.labelRotation!==0,d=l!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,m=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,p=0;c?d?(f=i*e.width,p=s*t.height):(f=s*e.height,p=i*t.width):a==="start"?p=t.width:a==="end"?f=e.width:a!=="inner"&&(f=e.width/2,p=t.width/2),this.paddingLeft=Math.max((f-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((p-m+o)*this.width/(this.width-m),0)}else{let h=t.height/2,m=e.height/2;a==="start"?(h=0,m=e.height):a==="end"&&(h=t.height,m=0),this.paddingTop=h+o,this.paddingBottom=m+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Pn(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return t==="top"||t==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let t,s;for(t=0,s=e.length;t<s;t++)Sn(e[t].label)&&(e.splice(t,1),s--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let s=this.ticks;t<s.length&&(s=qJ(s,t)),this._labelSizes=e=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,s){const{ctx:i,_longestTextCache:a}=this,o=[],l=[],c=Math.floor(t/QJ(t,s));let d=0,h=0,m,f,p,b,x,v,S,B,V,R,W;for(m=0;m<t;m+=c){if(b=e[m].label,x=this._resolveTickFontOptions(m),i.font=v=x.string,S=a[v]=a[v]||{data:{},gc:[]},B=x.lineHeight,V=R=0,!Sn(b)&&!_s(b))V=ZJ(i,S.data,S.gc,V,b),R=B;else if(_s(b))for(f=0,p=b.length;f<p;++f)W=b[f],!Sn(W)&&!_s(W)&&(V=ZJ(i,S.data,S.gc,V,W),R+=B);o.push(V),l.push(R),d=Math.max(V,d),h=Math.max(R,h)}ice(a,t);const _=o.indexOf(d),Y=l.indexOf(h),j=M=>({width:o[M]||0,height:l[M]||0});return{first:j(0),last:j(t-1),widest:j(_),highest:j(Y),widths:o,heights:l}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return Tae(this._alignToPixels?rg(this.chart,t,0):t)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const s=t[e];return s.$context||(s.$context=oce(this.getContext(),e,s))}return this.$context||(this.$context=ace(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,t=Nl(this.labelRotation),s=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),a=this._getLabelSizes(),o=e.autoSkipPadding||0,l=a?a.widest.width+o:0,c=a?a.highest.height+o:0;return this.isHorizontal()?c*s>l*i?l/s:c/i:c*i<l*s?c/s:l/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,s=this.chart,i=this.options,{grid:a,position:o,border:l}=i,c=a.offset,d=this.isHorizontal(),m=this.ticks.length+(c?1:0),f=zh(a),p=[],b=l.setContext(this.getContext()),x=b.display?b.width:0,v=x/2,S=function(q){return rg(s,q,x)};let B,V,R,W,_,Y,j,M,H,D,z,O;if(o==="top")B=S(this.bottom),Y=this.bottom-f,M=B-v,D=S(e.top)+v,O=e.bottom;else if(o==="bottom")B=S(this.top),D=e.top,O=S(e.bottom)-v,Y=B+v,M=this.top+f;else if(o==="left")B=S(this.right),_=this.right-f,j=B-v,H=S(e.left)+v,z=e.right;else if(o==="right")B=S(this.left),H=e.left,z=S(e.right)-v,_=B+v,j=this.left+f;else if(t==="x"){if(o==="center")B=S((e.top+e.bottom)/2+.5);else if(sn(o)){const q=Object.keys(o)[0],de=o[q];B=S(this.chart.scales[q].getPixelForValue(de))}D=e.top,O=e.bottom,Y=B+v,M=Y+f}else if(t==="y"){if(o==="center")B=S((e.left+e.right)/2);else if(sn(o)){const q=Object.keys(o)[0],de=o[q];B=S(this.chart.scales[q].getPixelForValue(de))}_=B-v,j=_-f,H=e.left,z=e.right}const E=Kt(i.ticks.maxTicksLimit,m),te=Math.max(1,Math.ceil(m/E));for(V=0;V<m;V+=te){const q=this.getContext(V),de=a.setContext(q),U=l.setContext(q),P=de.lineWidth,ne=de.color,K=U.dash||[],re=U.dashOffset,le=de.tickWidth,ue=de.tickColor,ae=de.tickBorderDash||[],Ce=de.tickBorderDashOffset;R=rce(this,V,c),R!==void 0&&(W=rg(s,R,P),d?_=j=H=z=W:Y=M=D=O=W,p.push({tx1:_,ty1:Y,tx2:j,ty2:M,x1:H,y1:D,x2:z,y2:O,width:P,color:ne,borderDash:K,borderDashOffset:re,tickWidth:le,tickColor:ue,tickBorderDash:ae,tickBorderDashOffset:Ce}))}return this._ticksLength=m,this._borderValue=B,p}_computeLabelItems(e){const t=this.axis,s=this.options,{position:i,ticks:a}=s,o=this.isHorizontal(),l=this.ticks,{align:c,crossAlign:d,padding:h,mirror:m}=a,f=zh(s.grid),p=f+h,b=m?-h:p,x=-Nl(this.labelRotation),v=[];let S,B,V,R,W,_,Y,j,M,H,D,z,O="middle";if(i==="top")_=this.bottom-b,Y=this._getXAxisLabelAlignment();else if(i==="bottom")_=this.top+b,Y=this._getXAxisLabelAlignment();else if(i==="left"){const te=this._getYAxisLabelAlignment(f);Y=te.textAlign,W=te.x}else if(i==="right"){const te=this._getYAxisLabelAlignment(f);Y=te.textAlign,W=te.x}else if(t==="x"){if(i==="center")_=(e.top+e.bottom)/2+p;else if(sn(i)){const te=Object.keys(i)[0],q=i[te];_=this.chart.scales[te].getPixelForValue(q)+p}Y=this._getXAxisLabelAlignment()}else if(t==="y"){if(i==="center")W=(e.left+e.right)/2-p;else if(sn(i)){const te=Object.keys(i)[0],q=i[te];W=this.chart.scales[te].getPixelForValue(q)}Y=this._getYAxisLabelAlignment(f).textAlign}t==="y"&&(c==="start"?O="top":c==="end"&&(O="bottom"));const E=this._getLabelSizes();for(S=0,B=l.length;S<B;++S){V=l[S],R=V.label;const te=a.setContext(this.getContext(S));j=this.getPixelForTick(S)+a.labelOffset,M=this._resolveTickFontOptions(S),H=M.lineHeight,D=_s(R)?R.length:1;const q=D/2,de=te.color,U=te.textStrokeColor,P=te.textStrokeWidth;let ne=Y;o?(W=j,Y==="inner"&&(S===B-1?ne=this.options.reverse?"left":"right":S===0?ne=this.options.reverse?"right":"left":ne="center"),i==="top"?d==="near"||x!==0?z=-D*H+H/2:d==="center"?z=-E.highest.height/2-q*H+H:z=-E.highest.height+H/2:d==="near"||x!==0?z=H/2:d==="center"?z=E.highest.height/2-q*H:z=E.highest.height-D*H,m&&(z*=-1),x!==0&&!te.showLabelBackdrop&&(W+=H/2*Math.sin(x))):(_=j,z=(1-D)*H/2);let K;if(te.showLabelBackdrop){const re=Da(te.backdropPadding),le=E.heights[S],ue=E.widths[S];let ae=z-re.top,Ce=0-re.left;switch(O){case"middle":ae-=le/2;break;case"bottom":ae-=le;break}switch(Y){case"center":Ce-=ue/2;break;case"right":Ce-=ue;break;case"inner":S===B-1?Ce-=ue:S>0&&(Ce-=ue/2);break}K={left:Ce,top:ae,width:ue+re.width,height:le+re.height,color:te.backdropColor}}v.push({label:R,font:M,textOffset:z,options:{rotation:x,color:de,strokeColor:U,strokeWidth:P,textAlign:ne,textBaseline:O,translation:[W,_],backdrop:K}})}return v}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Nl(this.labelRotation))return e==="top"?"left":"right";let i="center";return t.align==="start"?i="left":t.align==="end"?i="right":t.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:s,mirror:i,padding:a}}=this.options,o=this._getLabelSizes(),l=e+a,c=o.widest.width;let d,h;return t==="left"?i?(h=this.right+a,s==="near"?d="left":s==="center"?(d="center",h+=c/2):(d="right",h+=c)):(h=this.right-l,s==="near"?d="right":s==="center"?(d="center",h-=c/2):(d="left",h=this.left)):t==="right"?i?(h=this.left+a,s==="near"?d="right":s==="center"?(d="center",h-=c/2):(d="left",h-=c)):(h=this.left+l,s==="near"?d="left":s==="center"?(d="center",h+=c/2):(d="right",h=this.right)):d="right",{textAlign:d,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;if(t==="left"||t==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(t==="top"||t==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:s,top:i,width:a,height:o}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(s,i,a,o),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const i=this.ticks.findIndex(a=>a.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const t=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let a,o;const l=(c,d,h)=>{!h.width||!h.color||(s.save(),s.lineWidth=h.width,s.strokeStyle=h.color,s.setLineDash(h.borderDash||[]),s.lineDashOffset=h.borderDashOffset,s.beginPath(),s.moveTo(c.x,c.y),s.lineTo(d.x,d.y),s.stroke(),s.restore())};if(t.display)for(a=0,o=i.length;a<o;++a){const c=i[a];t.drawOnChartArea&&l({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),t.drawTicks&&l({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:s,grid:i}}=this,a=s.setContext(this.getContext()),o=s.display?a.width:0;if(!o)return;const l=i.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let d,h,m,f;this.isHorizontal()?(d=rg(e,this.left,o)-o/2,h=rg(e,this.right,l)+l/2,m=f=c):(m=rg(e,this.top,o)-o/2,f=rg(e,this.bottom,l)+l/2,d=h=c),t.save(),t.lineWidth=a.width,t.strokeStyle=a.color,t.beginPath(),t.moveTo(d,m),t.lineTo(h,f),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&Lp(s,i);const a=this.getLabelItems(e);for(const o of a){const l=o.options,c=o.font,d=o.label,h=o.textOffset;rp(s,d,0,h,c,l)}i&&Pp(s)}drawTitle(){const{ctx:e,options:{position:t,title:s,reverse:i}}=this;if(!s.display)return;const a=ni(s.font),o=Da(s.padding),l=s.align;let c=a.lineHeight/2;t==="bottom"||t==="center"||sn(t)?(c+=o.bottom,_s(s.text)&&(c+=a.lineHeight*(s.text.length-1))):c+=o.top;const{titleX:d,titleY:h,maxWidth:m,rotation:f}=cce(this,c,t,l);rp(e,s.text,0,0,a,{color:s.color,maxWidth:m,rotation:f,textAlign:lce(l,t,i),textBaseline:"middle",translation:[d,h]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,s=Kt(e.grid&&e.grid.z,-1),i=Kt(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==ih.prototype.draw?[{z:t,draw:a=>{this.draw(a)}}]:[{z:s,draw:a=>{this.drawBackground(),this.drawGrid(a),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:a=>{this.drawLabels(a)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let a,o;for(a=0,o=t.length;a<o;++a){const l=t[a];l[s]===this.id&&(!e||l.type===e)&&i.push(l)}return i}_resolveTickFontOptions(e){const t=this.options.ticks.setContext(this.getContext(e));return ni(t.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class of{constructor(e,t,s){this.type=e,this.scope=t,this.override=s,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let s;uce(t)&&(s=this.register(t));const i=this.items,a=e.id,o=this.scope+"."+a;if(!a)throw new Error("class does not have id: "+e);return a in i||(i[a]=e,dce(e,o,s),this.override&&hs.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const t=this.items,s=e.id,i=this.scope;s in t&&delete t[s],i&&s in hs[i]&&(delete hs[i][s],this.override&&delete Zg[s])}}function dce(n,e,t){const s=_m(Object.create(null),[t?hs.get(t):{},hs.get(e),n.defaults]);hs.set(e,s),n.defaultRoutes&&gce(e,n.defaultRoutes),n.descriptors&&hs.describe(e,n.descriptors)}function gce(n,e){Object.keys(e).forEach(t=>{const s=t.split("."),i=s.pop(),a=[n].concat(s).join("."),o=e[t].split("."),l=o.pop(),c=o.join(".");hs.route(a,i,c,l)})}function uce(n){return"id"in n&&"defaults"in n}class hce{constructor(){this.controllers=new of(Op,"datasets",!0),this.elements=new of(Ad,"elements"),this.plugins=new of(Object,"plugins"),this.scales=new of(ih,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,s){[...t].forEach(i=>{const a=s||this._getRegistryForType(i);s||a.isForType(i)||a===this.plugins&&i.id?this._exec(e,a,i):Bn(i,o=>{const l=s||this._getRegistryForType(o);this._exec(e,l,o)})})}_exec(e,t,s){const i=qG(e);Pn(s["before"+i],[],s),t[e](s),Pn(s["after"+i],[],s)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const s=this._typedRegistries[t];if(s.isForType(e))return s}return this.plugins}_get(e,t,s){const i=t.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+s+".");return i}}var xo=new hce;class mce{constructor(){this._init=void 0}notify(e,t,s,i){if(t==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const a=i?this._descriptors(e).filter(i):this._descriptors(e),o=this._notify(a,e,t,s);return t==="afterDestroy"&&(this._notify(a,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),o}_notify(e,t,s,i){i=i||{};for(const a of e){const o=a.plugin,l=o[s],c=[t,i,a.options];if(Pn(l,c,o)===!1&&i.cancelable)return!1}return!0}invalidate(){Sn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const s=e&&e.config,i=Kt(s.options&&s.options.plugins,{}),a=Ice(s);return i===!1&&!t?[]:fce(e,a,i,t)}_notifyStateChanges(e){const t=this._oldCache||[],s=this._cache,i=(a,o)=>a.filter(l=>!o.some(c=>l.plugin.id===c.plugin.id));this._notify(i(t,s),e,"stop"),this._notify(i(s,t),e,"start")}}function Ice(n){const e={},t=[],s=Object.keys(xo.plugins.items);for(let a=0;a<s.length;a++)t.push(xo.getPlugin(s[a]));const i=n.plugins||[];for(let a=0;a<i.length;a++){const o=i[a];t.indexOf(o)===-1&&(t.push(o),e[o.id]=!0)}return{plugins:t,localIds:e}}function Cce(n,e){return!e&&n===!1?null:n===!0?{}:n}function fce(n,{plugins:e,localIds:t},s,i){const a=[],o=n.getContext();for(const l of e){const c=l.id,d=Cce(s[c],i);d!==null&&a.push({plugin:l,options:pce(n.config,{plugin:l,local:t[c]},d,o)})}return a}function pce(n,{plugin:e,local:t},s,i){const a=n.pluginScopeKeys(e),o=n.getOptionScopes(s,a);return t&&e.defaults&&o.push(e.defaults),n.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function RZ(n,e){const t=hs.datasets[n]||{};return((e.datasets||{})[n]||{}).indexAxis||e.indexAxis||t.indexAxis||"x"}function Ace(n,e){let t=n;return n==="_index_"?t=e:n==="_value_"&&(t=e==="x"?"y":"x"),t}function bce(n,e){return n===e?"_index_":"_value_"}function eY(n){if(n==="x"||n==="y"||n==="r")return n}function yce(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function WZ(n,...e){if(eY(n))return n;for(const t of e){const s=t.axis||yce(t.position)||n.length>1&&eY(n[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function tY(n,e,t){if(t[e+"AxisID"]===n)return{axis:e}}function vce(n,e){if(e.data&&e.data.datasets){const t=e.data.datasets.filter(s=>s.xAxisID===n||s.yAxisID===n);if(t.length)return tY(n,"x",t[0])||tY(n,"y",t[0])}return{}}function xce(n,e){const t=Zg[n.type]||{scales:{}},s=e.scales||{},i=RZ(n.type,e),a=Object.create(null);return Object.keys(s).forEach(o=>{const l=s[o];if(!sn(l))return console.error(`Invalid scale configuration for scale: ${o}`);if(l._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const c=WZ(o,l,vce(o,n),hs.scales[l.type]),d=bce(c,i),h=t.scales||{};a[o]=hm(Object.create(null),[{axis:c},l,h[c],h[d]])}),n.data.datasets.forEach(o=>{const l=o.type||n.type,c=o.indexAxis||RZ(l,e),h=(Zg[l]||{}).scales||{};Object.keys(h).forEach(m=>{const f=Ace(m,c),p=o[f+"AxisID"]||f;a[p]=a[p]||Object.create(null),hm(a[p],[{axis:f},s[p],h[m]])})}),Object.keys(a).forEach(o=>{const l=a[o];hm(l,[hs.scales[l.type],hs.scale])}),a}function PE(n){const e=n.options||(n.options={});e.plugins=Kt(e.plugins,{}),e.scales=xce(n,e)}function KE(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Sce(n){return n=n||{},n.data=KE(n.data),PE(n),n}const nY=new Map,OE=new Set;function lf(n,e){let t=nY.get(n);return t||(t=e(),nY.set(n,t),OE.add(t)),t}const Uh=(n,e,t)=>{const s=wg(e,t);s!==void 0&&n.add(s)};class wce{constructor(e){this._config=Sce(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=KE(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),PE(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return lf(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return lf(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return lf(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){const t=e.id,s=this.type;return lf(`${s}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const s=this._scopeCache;let i=s.get(e);return(!i||t)&&(i=new Map,s.set(e,i)),i}getOptionScopes(e,t,s){const{options:i,type:a}=this,o=this._cachedScopes(e,s),l=o.get(t);if(l)return l;const c=new Set;t.forEach(h=>{e&&(c.add(e),h.forEach(m=>Uh(c,e,m))),h.forEach(m=>Uh(c,i,m)),h.forEach(m=>Uh(c,Zg[a]||{},m)),h.forEach(m=>Uh(c,hs,m)),h.forEach(m=>Uh(c,NZ,m))});const d=Array.from(c);return d.length===0&&d.push(Object.create(null)),OE.has(t)&&o.set(t,d),d}chartOptionScopes(){const{options:e,type:t}=this;return[e,Zg[t]||{},hs.datasets[t]||{},{type:t},hs,NZ]}resolveNamedOptions(e,t,s,i=[""]){const a={$shared:!0},{resolver:o,subPrefixes:l}=sY(this._resolverCache,e,i);let c=o;if(Gce(o,t)){a.$shared=!1,s=sd(s)?s():s;const d=this.createResolver(e,s,l);c=zu(o,s,d)}for(const d of t)a[d]=c[d];return a}createResolver(e,t,s=[""],i){const{resolver:a}=sY(this._resolverCache,e,s);return sn(t)?zu(a,t,void 0,i):a}}function sY(n,e,t){let s=n.get(e);s||(s=new Map,n.set(e,s));const i=t.join();let a=s.get(i);return a||(a={resolver:sB(e,t),subPrefixes:t.filter(l=>!l.toLowerCase().includes("hover"))},s.set(i,a)),a}const Zce=n=>sn(n)&&Object.getOwnPropertyNames(n).some(e=>sd(n[e]));function Gce(n,e){const{isScriptable:t,isIndexable:s}=GE(n);for(const i of e){const a=t(i),o=s(i),l=(o||a)&&n[i];if(a&&(sd(l)||Zce(l))||o&&_s(l))return!0}return!1}var Bce="4.5.1";const Nce=["top","bottom","left","right","chartArea"];function rY(n,e){return n==="top"||n==="bottom"||Nce.indexOf(n)===-1&&e==="x"}function iY(n,e){return function(t,s){return t[n]===s[n]?t[e]-s[e]:t[n]-s[n]}}function aY(n){const e=n.chart,t=e.options.animation;e.notifyPlugins("afterRender"),Pn(t&&t.onComplete,[n],e)}function kce(n){const e=n.chart,t=e.options.animation;Pn(t&&t.onProgress,[n],e)}function zE(n){return aB()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Nf={},oY=n=>{const e=zE(n);return Object.values(Nf).filter(t=>t.canvas===e).pop()};function Rce(n,e,t){const s=Object.keys(n);for(const i of s){const a=+i;if(a>=e){const o=n[i];delete n[i],(t>0||a>e)&&(n[a+t]=o)}}}function Wce(n,e,t,s){return!t||n.type==="mouseout"?null:s?e:n}class Up{static defaults=hs;static instances=Nf;static overrides=Zg;static registry=xo;static version=Bce;static getChart=oY;static register(...e){xo.add(...e),lY()}static unregister(...e){xo.remove(...e),lY()}constructor(e,t){const s=this.config=new wce(t),i=zE(e),a=oY(i);if(a)throw new Error("Canvas is already in use. Chart with ID '"+a.id+"' must be destroyed before the canvas with ID '"+a.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||Ule(i)),this.platform.updateConfig(s);const l=this.platform.acquireContext(i,o.aspectRatio),c=l&&l.canvas,d=c&&c.height,h=c&&c.width;if(this.id=Gae(),this.ctx=l,this.canvas=c,this.width=h,this.height=d,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new mce,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Pae(m=>this.update(m),o.resizeDelay||0),this._dataChanges=[],Nf[this.id]=this,!l||!c){console.error("Failed to create chart: can't acquire context from the given item");return}xl.listen(this,"complete",aY),xl.listen(this,"progress",kce),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:s,height:i,_aspectRatio:a}=this;return Sn(e)?t&&a?a:i?s/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return xo}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():kJ(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return GJ(this.canvas,this.ctx),this}stop(){return xl.stop(this),this}resize(e,t){xl.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const s=this.options,i=this.canvas,a=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,e,t,a),l=s.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,kJ(this,l,!0)&&(this.notifyPlugins("resize",{size:o}),Pn(s.onResize,[this,o],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const t=this.options.scales||{};Bn(t,(s,i)=>{s.id=i})}buildOrUpdateScales(){const e=this.options,t=e.scales,s=this.scales,i=Object.keys(s).reduce((o,l)=>(o[l]=!1,o),{});let a=[];t&&(a=a.concat(Object.keys(t).map(o=>{const l=t[o],c=WZ(o,l),d=c==="r",h=c==="x";return{options:l,dposition:d?"chartArea":h?"bottom":"left",dtype:d?"radialLinear":h?"category":"linear"}}))),Bn(a,o=>{const l=o.options,c=l.id,d=WZ(c,l),h=Kt(l.type,o.dtype);(l.position===void 0||rY(l.position,d)!==rY(o.dposition))&&(l.position=o.dposition),i[c]=!0;let m=null;if(c in s&&s[c].type===h)m=s[c];else{const f=xo.getScale(h);m=new f({id:c,type:h,ctx:this.ctx,chart:this}),s[m.id]=m}m.init(l,e)}),Bn(i,(o,l)=>{o||delete s[l]}),Bn(s,o=>{Kc.configure(this,o,o.options),Kc.addBox(this,o)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,s=e.length;if(e.sort((i,a)=>i.index-a.index),s>t){for(let i=t;i<s;++i)this._destroyDatasetMeta(i);e.splice(t,s-t)}this._sortedMetasets=e.slice(0).sort(iY("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((s,i)=>{t.filter(a=>a===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=t.length;s<i;s++){const a=t[s];let o=this.getDatasetMeta(s);const l=a.type||this.config.type;if(o.type&&o.type!==l&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=l,o.indexAxis=a.indexAxis||RZ(l,this.options),o.order=a.order||0,o.index=s,o.label=""+a.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const c=xo.getController(l),{datasetElementType:d,dataElementType:h}=hs.datasets[l];Object.assign(c,{dataElementType:xo.getElement(h),datasetElementType:d&&xo.getElement(d)}),o.controller=new c(this,s),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){Bn(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const s=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const a=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let d=0,h=this.data.datasets.length;d<h;d++){const{controller:m}=this.getDatasetMeta(d),f=!i&&a.indexOf(m)===-1;m.buildOrUpdateElements(f),o=Math.max(+m.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),i||Bn(a,d=>{d.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(iY("z","_idx"));const{_active:l,_lastEvent:c}=this;c?this._eventHandler(c,!0):l.length&&this._updateHoverStyles(l,l,!0),this.render()}_updateScales(){Bn(this.scales,e=>{Kc.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),s=new Set(e.events);(!fJ(t,s)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:a}of t){const o=s==="_removeElements"?-a:a;Rce(e,i,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,s=a=>new Set(e.filter(o=>o[0]===a).map((o,l)=>l+","+o.splice(1).join(","))),i=s(0);for(let a=1;a<t;a++)if(!fJ(i,s(a)))return;return Array.from(i).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Kc.update(this,this.width,this.height,e);const t=this.chartArea,s=t.width<=0||t.height<=0;this._layers=[],Bn(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,a)=>{i._idx=a}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let t=0,s=this.data.datasets.length;t<s;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,s=this.data.datasets.length;t<s;++t)this._updateDataset(t,sd(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const s=this.getDatasetMeta(e),i={meta:s,index:e,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(xl.has(this)?this.attached&&!xl.running(this)&&xl.start(this):(this.draw(),aY({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,s=[];let i,a;for(i=0,a=t.length;i<a;++i){const o=t[i];(!e||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,s={meta:e,index:e.index,cancelable:!0},i=JE(this,e);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&Lp(t,i),e.controller.draw(),i&&Pp(t),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(e){return Ym(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,s,i){const a=Nle.modes[t];return typeof a=="function"?a(this,e,s,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],s=this._metasets;let i=s.filter(a=>a&&a._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=_g(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const s=this.getDatasetMeta(e);return typeof s.hidden=="boolean"?!s.hidden:!t.hidden}setDatasetVisibility(e,t){const s=this.getDatasetMeta(e);s.hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,s){const i=s?"show":"hide",a=this.getDatasetMeta(e),o=a.controller._resolveAnimations(void 0,i);jm(t)?(a.data[t].hidden=!s,this.update()):(this.setDatasetVisibility(e,s),o.update(a,{visible:s}),this.update(l=>l.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),xl.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),GJ(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Nf[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,s=(a,o)=>{t.addEventListener(this,a,o),e[a]=o},i=(a,o,l)=>{a.offsetX=o,a.offsetY=l,this._eventHandler(a)};Bn(this.options.events,a=>s(a,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,s=(c,d)=>{t.addEventListener(this,c,d),e[c]=d},i=(c,d)=>{e[c]&&(t.removeEventListener(this,c,d),delete e[c])},a=(c,d)=>{this.canvas&&this.resize(c,d)};let o;const l=()=>{i("attach",l),this.attached=!0,this.resize(),s("resize",a),s("detach",o)};o=()=>{this.attached=!1,i("resize",a),this._stop(),this._resize(0,0),s("attach",l)},t.isAttached(this.canvas)?l():o()}unbindEvents(){Bn(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Bn(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,s){const i=s?"set":"remove";let a,o,l,c;for(t==="dataset"&&(a=this.getDatasetMeta(e[0].datasetIndex),a.controller["_"+i+"DatasetHoverStyle"]()),l=0,c=e.length;l<c;++l){o=e[l];const d=o&&this.getDatasetMeta(o.datasetIndex).controller;d&&d[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],s=e.map(({datasetIndex:a,index:o})=>{const l=this.getDatasetMeta(a);if(!l)throw new Error("No dataset found at index "+a);return{datasetIndex:a,element:l.data[o],index:o}});!tp(s,t)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,t))}notifyPlugins(e,t,s){return this._plugins.notify(this,e,t,s)}isPluginEnabled(e){return this._plugins._cache.filter(t=>t.plugin.id===e).length===1}_updateHoverStyles(e,t,s){const i=this.options.hover,a=(c,d)=>c.filter(h=>!d.some(m=>h.datasetIndex===m.datasetIndex&&h.index===m.index)),o=a(t,e),l=s?e:a(e,t);o.length&&this.updateHoverStyle(o,i.mode,!1),l.length&&i.mode&&this.updateHoverStyle(l,i.mode,!0)}_eventHandler(e,t){const s={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const a=this._handleEvent(e,t,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(a||s.changed)&&this.render(),this}_handleEvent(e,t,s){const{_active:i=[],options:a}=this,o=t,l=this._getActiveElements(e,i,s,o),c=Vae(e),d=Wce(e,this._lastEvent,s,c);s&&(this._lastEvent=null,Pn(a.onHover,[e,l,this],this),c&&Pn(a.onClick,[e,l,this],this));const h=!tp(l,i);return(h||t)&&(this._active=l,this._updateHoverStyles(l,i,t)),this._lastEvent=d,h}_getActiveElements(e,t,s,i){if(e.type==="mouseout")return[];if(!s)return t;const a=this.options.hover;return this.getElementsAtEventForMode(e,a.mode,a,i)}}function lY(){return Bn(Up.instances,n=>n._plugins.invalidate())}function Vce(n,e,t){const{startAngle:s,x:i,y:a,outerRadius:o,innerRadius:l,options:c}=e,{borderWidth:d,borderJoinStyle:h}=c,m=Math.min(d/o,bi(s-t));if(n.beginPath(),n.arc(i,a,o-d/2,s+m/2,t-m/2),l>0){const f=Math.min(d/l,bi(s-t));n.arc(i,a,l+d/2,t-f/2,s+f/2,!0)}else{const f=Math.min(d/2,o*bi(s-t));if(h==="round")n.arc(i,a,f,t-Jn/2,s+Jn/2,!0);else if(h==="bevel"){const p=2*f*f,b=-p*Math.cos(t+Jn/2)+i,x=-p*Math.sin(t+Jn/2)+a,v=p*Math.cos(s+Jn/2)+i,S=p*Math.sin(s+Jn/2)+a;n.lineTo(b,x),n.lineTo(v,S)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function _ce(n,e,t){const{startAngle:s,pixelMargin:i,x:a,y:o,outerRadius:l,innerRadius:c}=e;let d=i/l;n.beginPath(),n.arc(a,o,l,s-d,t+d),c>i?(d=i/c,n.arc(a,o,c,t+d,s-d,!0)):n.arc(a,o,i,t+js,s-js),n.closePath(),n.clip()}function jce(n){return nB(n,["outerStart","outerEnd","innerStart","innerEnd"])}function Xce(n,e,t,s){const i=jce(n.options.borderRadius),a=(t-e)/2,o=Math.min(a,s*e/2),l=c=>{const d=(t-Math.min(a,c))*s/2;return Ir(c,0,Math.min(a,d))};return{outerStart:l(i.outerStart),outerEnd:l(i.outerEnd),innerStart:Ir(i.innerStart,0,o),innerEnd:Ir(i.innerEnd,0,o)}}function du(n,e,t,s){return{x:t+n*Math.cos(e),y:s+n*Math.sin(e)}}function lp(n,e,t,s,i,a){const{x:o,y:l,startAngle:c,pixelMargin:d,innerRadius:h}=e,m=Math.max(e.outerRadius+s+t-d,0),f=h>0?h+s+t+d:0;let p=0;const b=i-c;if(s){const te=h>0?h-s:0,q=m>0?m-s:0,de=(te+q)/2,U=de!==0?b*de/(de+s):b;p=(b-U)/2}const x=Math.max(.001,b*m-t/Jn)/m,v=(b-x)/2,S=c+v+p,B=i-v-p,{outerStart:V,outerEnd:R,innerStart:W,innerEnd:_}=Xce(e,f,m,B-S),Y=m-V,j=m-R,M=S+V/Y,H=B-R/j,D=f+W,z=f+_,O=S+W/D,E=B-_/z;if(n.beginPath(),a){const te=(M+H)/2;if(n.arc(o,l,m,M,te),n.arc(o,l,m,te,H),R>0){const P=du(j,H,o,l);n.arc(P.x,P.y,R,H,B+js)}const q=du(z,B,o,l);if(n.lineTo(q.x,q.y),_>0){const P=du(z,E,o,l);n.arc(P.x,P.y,_,B+js,E+Math.PI)}const de=(B-_/f+(S+W/f))/2;if(n.arc(o,l,f,B-_/f,de,!0),n.arc(o,l,f,de,S+W/f,!0),W>0){const P=du(D,O,o,l);n.arc(P.x,P.y,W,O+Math.PI,S-js)}const U=du(Y,S,o,l);if(n.lineTo(U.x,U.y),V>0){const P=du(Y,M,o,l);n.arc(P.x,P.y,V,S-js,M)}}else{n.moveTo(o,l);const te=Math.cos(M)*m+o,q=Math.sin(M)*m+l;n.lineTo(te,q);const de=Math.cos(H)*m+o,U=Math.sin(H)*m+l;n.lineTo(de,U)}n.closePath()}function Jce(n,e,t,s,i){const{fullCircles:a,startAngle:o,circumference:l}=e;let c=e.endAngle;if(a){lp(n,e,t,s,c,i);for(let d=0;d<a;++d)n.fill();isNaN(l)||(c=o+(l%rs||rs))}return lp(n,e,t,s,c,i),n.fill(),c}function Yce(n,e,t,s,i){const{fullCircles:a,startAngle:o,circumference:l,options:c}=e,{borderWidth:d,borderJoinStyle:h,borderDash:m,borderDashOffset:f,borderRadius:p}=c,b=c.borderAlign==="inner";if(!d)return;n.setLineDash(m||[]),n.lineDashOffset=f,b?(n.lineWidth=d*2,n.lineJoin=h||"round"):(n.lineWidth=d,n.lineJoin=h||"bevel");let x=e.endAngle;if(a){lp(n,e,t,s,x,i);for(let v=0;v<a;++v)n.stroke();isNaN(l)||(x=o+(l%rs||rs))}b&&_ce(n,e,x),c.selfJoin&&x-o>=Jn&&p===0&&h!=="miter"&&Vce(n,e,x),a||(lp(n,e,t,s,x,i),n.stroke())}class Fce extends Ad{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,s){const i=this.getProps(["x","y"],s),{angle:a,distance:o}=pE(i,{x:e,y:t}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:h,circumference:m}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,p=Kt(m,c-l),b=Jm(a,l,c)&&l!==c,x=p>=rs||b,v=kl(o,d+f,h+f);return x&&v}getCenterPoint(e){const{x:t,y:s,startAngle:i,endAngle:a,innerRadius:o,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,h=(i+a)/2,m=(o+l+d+c)/2;return{x:t+Math.cos(h)*m,y:s+Math.sin(h)*m}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:s}=this,i=(t.offset||0)/4,a=(t.spacing||0)/2,o=t.circular;if(this.pixelMargin=t.borderAlign==="inner"?.33:0,this.fullCircles=s>rs?Math.floor(s/rs):0,s===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*i,Math.sin(l)*i);const c=1-Math.sin(Math.min(Jn,s||0)),d=i*c;e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,Jce(e,this,d,a,o),Yce(e,this,d,a,o),e.restore()}}function UE(n,e,t=e){n.lineCap=Kt(t.borderCapStyle,e.borderCapStyle),n.setLineDash(Kt(t.borderDash,e.borderDash)),n.lineDashOffset=Kt(t.borderDashOffset,e.borderDashOffset),n.lineJoin=Kt(t.borderJoinStyle,e.borderJoinStyle),n.lineWidth=Kt(t.borderWidth,e.borderWidth),n.strokeStyle=Kt(t.borderColor,e.borderColor)}function Mce(n,e,t){n.lineTo(t.x,t.y)}function Hce(n){return n.stepped?aoe:n.tension||n.cubicInterpolationMode==="monotone"?ooe:Mce}function QE(n,e,t={}){const s=n.length,{start:i=0,end:a=s-1}=t,{start:o,end:l}=e,c=Math.max(i,o),d=Math.min(a,l),h=i<o&&a<o||i>l&&a>l;return{count:s,start:c,loop:e.loop,ilen:d<c&&!h?s+d-c:d-c}}function Tce(n,e,t,s){const{points:i,options:a}=e,{count:o,start:l,loop:c,ilen:d}=QE(i,t,s),h=Hce(a);let{move:m=!0,reverse:f}=s||{},p,b,x;for(p=0;p<=d;++p)b=i[(l+(f?d-p:p))%o],!b.skip&&(m?(n.moveTo(b.x,b.y),m=!1):h(n,x,b,f,a.stepped),x=b);return c&&(b=i[(l+(f?d:0))%o],h(n,x,b,f,a.stepped)),!!c}function Ece(n,e,t,s){const i=e.points,{count:a,start:o,ilen:l}=QE(i,t,s),{move:c=!0,reverse:d}=s||{};let h=0,m=0,f,p,b,x,v,S;const B=R=>(o+(d?l-R:R))%a,V=()=>{x!==v&&(n.lineTo(h,v),n.lineTo(h,x),n.lineTo(h,S))};for(c&&(p=i[B(0)],n.moveTo(p.x,p.y)),f=0;f<=l;++f){if(p=i[B(f)],p.skip)continue;const R=p.x,W=p.y,_=R|0;_===b?(W<x?x=W:W>v&&(v=W),h=(m*h+R)/++m):(V(),n.lineTo(R,W),b=_,m=0,x=v=W),S=W}V()}function VZ(n){const e=n.options,t=e.borderDash&&e.borderDash.length;return!n._decimated&&!n._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!t?Ece:Tce}function Dce(n){return n.stepped?Foe:n.tension||n.cubicInterpolationMode==="monotone"?Moe:dg}function Lce(n,e,t,s){let i=e._path;i||(i=e._path=new Path2D,e.path(i,t,s)&&i.closePath()),UE(n,e.options),n.stroke(i)}function Pce(n,e,t,s){const{segments:i,options:a}=e,o=VZ(e);for(const l of i)UE(n,a,l.style),n.beginPath(),o(n,e,l,{start:t,end:t+s-1})&&n.closePath(),n.stroke()}const Kce=typeof Path2D=="function";function Oce(n,e,t,s){Kce&&!e.options.segment?Lce(n,e,t,s):Pce(n,e,t,s)}class Qp extends Ad{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;Roe(this._points,s,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Poe(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,s=e.length;return s&&t[e[s-1].end]}interpolate(e,t){const s=this.options,i=e[t],a=this.points,o=XE(this,{property:t,start:i,end:i});if(!o.length)return;const l=[],c=Dce(s);let d,h;for(d=0,h=o.length;d<h;++d){const{start:m,end:f}=o[d],p=a[m],b=a[f];if(p===b){l.push(p);continue}const x=Math.abs((i-p[t])/(b[t]-p[t])),v=c(p,b,x,s.stepped);v[t]=e[t],l.push(v)}return l.length===1?l[0]:l}pathSegment(e,t,s){return VZ(this)(e,this,t,s)}path(e,t,s){const i=this.segments,a=VZ(this);let o=this._loop;t=t||0,s=s||this.points.length-t;for(const l of i)o&=a(e,this,l,{start:t,end:t+s-1});return!!o}draw(e,t,s,i){const a=this.options||{};(this.points||[]).length&&a.borderWidth&&(e.save(),Oce(e,this,s,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function cY(n,e,t,s){const i=n.options,{[t]:a}=n.getProps([t],s);return Math.abs(e-a)<i.radius+i.hitRadius}class zce extends Ad{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,s){const i=this.options,{x:a,y:o}=this.getProps(["x","y"],s);return Math.pow(e-a,2)+Math.pow(t-o,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return cY(this,e,"x",t)}inYRange(e,t){return cY(this,e,"y",t)}getCenterPoint(e){const{x:t,y:s}=this.getProps(["x","y"],e);return{x:t,y:s}}size(e){e=e||this.options||{};let t=e.radius||0;t=Math.max(t,t&&e.hoverRadius||0);const s=t&&e.borderWidth||0;return(t+s)*2}draw(e,t){const s=this.options;this.skip||s.radius<.1||!Ym(this,t,this.size(s)/2)||(e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.fillStyle=s.backgroundColor,kZ(e,s,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function qE(n,e){const{x:t,y:s,base:i,width:a,height:o}=n.getProps(["x","y","base","width","height"],e);let l,c,d,h,m;return n.horizontal?(m=o/2,l=Math.min(t,i),c=Math.max(t,i),d=s-m,h=s+m):(m=a/2,l=t-m,c=t+m,d=Math.min(s,i),h=Math.max(s,i)),{left:l,top:d,right:c,bottom:h}}function Oc(n,e,t,s){return n?0:Ir(e,t,s)}function Uce(n,e,t){const s=n.options.borderWidth,i=n.borderSkipped,a=ZE(s);return{t:Oc(i.top,a.top,0,t),r:Oc(i.right,a.right,0,e),b:Oc(i.bottom,a.bottom,0,t),l:Oc(i.left,a.left,0,e)}}function Qce(n,e,t){const{enableBorderRadius:s}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,a=Zu(i),o=Math.min(e,t),l=n.borderSkipped,c=s||sn(i);return{topLeft:Oc(!c||l.top||l.left,a.topLeft,0,o),topRight:Oc(!c||l.top||l.right,a.topRight,0,o),bottomLeft:Oc(!c||l.bottom||l.left,a.bottomLeft,0,o),bottomRight:Oc(!c||l.bottom||l.right,a.bottomRight,0,o)}}function qce(n){const e=qE(n),t=e.right-e.left,s=e.bottom-e.top,i=Uce(n,t/2,s/2),a=Qce(n,t/2,s/2);return{outer:{x:e.left,y:e.top,w:t,h:s,radius:a},inner:{x:e.left+i.l,y:e.top+i.t,w:t-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,a.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(i.b,i.r))}}}}function aw(n,e,t,s){const i=e===null,a=t===null,l=n&&!(i&&a)&&qE(n,s);return l&&(i||kl(e,l.left,l.right))&&(a||kl(t,l.top,l.bottom))}function $ce(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function ede(n,e){n.rect(e.x,e.y,e.w,e.h)}function ow(n,e,t={}){const s=n.x!==t.x?-e:0,i=n.y!==t.y?-e:0,a=(n.x+n.w!==t.x+t.w?e:0)-s,o=(n.y+n.h!==t.y+t.h?e:0)-i;return{x:n.x+s,y:n.y+i,w:n.w+a,h:n.h+o,radius:n.radius}}class tde extends Ad{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:s,backgroundColor:i}}=this,{inner:a,outer:o}=qce(this),l=$ce(o.radius)?ip:ede;e.save(),(o.w!==a.w||o.h!==a.h)&&(e.beginPath(),l(e,ow(o,t,a)),e.clip(),l(e,ow(a,-t,o)),e.fillStyle=s,e.fill("evenodd")),e.beginPath(),l(e,ow(a,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,s){return aw(this,e,t,s)}inXRange(e,t){return aw(this,e,null,t)}inYRange(e,t){return aw(this,null,e,t)}getCenterPoint(e){const{x:t,y:s,base:i,horizontal:a}=this.getProps(["x","y","base","horizontal"],e);return{x:a?(t+i)/2:t,y:a?s:(s+i)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}function nde(n,e,t){const s=n.segments,i=n.points,a=e.points,o=[];for(const l of s){let{start:c,end:d}=l;d=qp(c,d,i);const h=_Z(t,i[c],i[d],l.loop);if(!e.segments){o.push({source:l,target:h,start:i[c],end:i[d]});continue}const m=XE(e,h);for(const f of m){const p=_Z(t,a[f.start],a[f.end],f.loop),b=jE(l,i,p);for(const x of b)o.push({source:x,target:f,start:{[t]:dY(h,p,"start",Math.max)},end:{[t]:dY(h,p,"end",Math.min)}})}}return o}function _Z(n,e,t,s){if(s)return;let i=e[n],a=t[n];return n==="angle"&&(i=bi(i),a=bi(a)),{property:n,start:i,end:a}}function sde(n,e){const{x:t=null,y:s=null}=n||{},i=e.points,a=[];return e.segments.forEach(({start:o,end:l})=>{l=qp(o,l,i);const c=i[o],d=i[l];s!==null?(a.push({x:c.x,y:s}),a.push({x:d.x,y:s})):t!==null&&(a.push({x:t,y:c.y}),a.push({x:t,y:d.y}))}),a}function qp(n,e,t){for(;e>n;e--){const s=t[e];if(!isNaN(s.x)&&!isNaN(s.y))break}return e}function dY(n,e,t,s){return n&&e?s(n[t],e[t]):n?n[t]:e?e[t]:0}function $E(n,e){let t=[],s=!1;return _s(n)?(s=!0,t=n):t=sde(n,e),t.length?new Qp({points:t,options:{tension:0},_loop:s,_fullLoop:s}):null}function gY(n){return n&&n.fill!==!1}function rde(n,e,t){let i=n[e].fill;const a=[e];let o;if(!t)return i;for(;i!==!1&&a.indexOf(i)===-1;){if(!pr(i))return i;if(o=n[i],!o)return!1;if(o.visible)return i;a.push(i),i=o.fill}return!1}function ide(n,e,t){const s=cde(n);if(sn(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return pr(i)&&Math.floor(i)===i?ade(s[0],e,i,t):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function ade(n,e,t,s){return(n==="-"||n==="+")&&(t=e+t),t===e||t<0||t>=s?!1:t}function ode(n,e){let t=null;return n==="start"?t=e.bottom:n==="end"?t=e.top:sn(n)?t=e.getPixelForValue(n.value):e.getBasePixel&&(t=e.getBasePixel()),t}function lde(n,e,t){let s;return n==="start"?s=t:n==="end"?s=e.options.reverse?e.min:e.max:sn(n)?s=n.value:s=e.getBaseValue(),s}function cde(n){const e=n.options,t=e.fill;let s=Kt(t&&t.target,t);return s===void 0&&(s=!!e.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function dde(n){const{scale:e,index:t,line:s}=n,i=[],a=s.segments,o=s.points,l=gde(e,t);l.push($E({x:null,y:e.bottom},s));for(let c=0;c<a.length;c++){const d=a[c];for(let h=d.start;h<=d.end;h++)ude(i,o[h],l)}return new Qp({points:i,options:{}})}function gde(n,e){const t=[],s=n.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const a=s[i];if(a.index===e)break;a.hidden||t.unshift(a.dataset)}return t}function ude(n,e,t){const s=[];for(let i=0;i<t.length;i++){const a=t[i],{first:o,last:l,point:c}=hde(a,e,"x");if(!(!c||o&&l)){if(o)s.unshift(c);else if(n.push(c),!l)break}}n.push(...s)}function hde(n,e,t){const s=n.interpolate(e,t);if(!s)return{};const i=s[t],a=n.segments,o=n.points;let l=!1,c=!1;for(let d=0;d<a.length;d++){const h=a[d],m=o[h.start][t],f=o[h.end][t];if(kl(i,m,f)){l=i===m,c=i===f;break}}return{first:l,last:c,point:s}}class eD{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,s){const{x:i,y:a,radius:o}=this;return t=t||{start:0,end:rs},e.arc(i,a,o,t.end,t.start,!0),!s.bounds}interpolate(e){const{x:t,y:s,radius:i}=this,a=e.angle;return{x:t+Math.cos(a)*i,y:s+Math.sin(a)*i,angle:a}}}function mde(n){const{chart:e,fill:t,line:s}=n;if(pr(t))return Ide(e,t);if(t==="stack")return dde(n);if(t==="shape")return!0;const i=Cde(n);return i instanceof eD?i:$E(i,s)}function Ide(n,e){const t=n.getDatasetMeta(e);return t&&n.isDatasetVisible(e)?t.dataset:null}function Cde(n){return(n.scale||{}).getPointPositionForValue?pde(n):fde(n)}function fde(n){const{scale:e={},fill:t}=n,s=ode(t,e);if(pr(s)){const i=e.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function pde(n){const{scale:e,fill:t}=n,s=e.options,i=e.getLabels().length,a=s.reverse?e.max:e.min,o=lde(t,e,a),l=[];if(s.grid.circular){const c=e.getPointPositionForValue(0,a);return new eD({x:c.x,y:c.y,radius:e.getDistanceFromCenterForValue(o)})}for(let c=0;c<i;++c)l.push(e.getPointPositionForValue(c,o));return l}function lw(n,e,t){const s=mde(e),{chart:i,index:a,line:o,scale:l,axis:c}=e,d=o.options,h=d.fill,m=d.backgroundColor,{above:f=m,below:p=m}=h||{},b=i.getDatasetMeta(a),x=JE(i,b);s&&o.points.length&&(Lp(n,t),Ade(n,{line:o,target:s,above:f,below:p,area:t,scale:l,axis:c,clip:x}),Pp(n))}function Ade(n,e){const{line:t,target:s,above:i,below:a,area:o,scale:l,clip:c}=e,d=t._loop?"angle":e.axis;n.save();let h=a;a!==i&&(d==="x"?(uY(n,s,o.top),cw(n,{line:t,target:s,color:i,scale:l,property:d,clip:c}),n.restore(),n.save(),uY(n,s,o.bottom)):d==="y"&&(hY(n,s,o.left),cw(n,{line:t,target:s,color:a,scale:l,property:d,clip:c}),n.restore(),n.save(),hY(n,s,o.right),h=i)),cw(n,{line:t,target:s,color:h,scale:l,property:d,clip:c}),n.restore()}function uY(n,e,t){const{segments:s,points:i}=e;let a=!0,o=!1;n.beginPath();for(const l of s){const{start:c,end:d}=l,h=i[c],m=i[qp(c,d,i)];a?(n.moveTo(h.x,h.y),a=!1):(n.lineTo(h.x,t),n.lineTo(h.x,h.y)),o=!!e.pathSegment(n,l,{move:o}),o?n.closePath():n.lineTo(m.x,t)}n.lineTo(e.first().x,t),n.closePath(),n.clip()}function hY(n,e,t){const{segments:s,points:i}=e;let a=!0,o=!1;n.beginPath();for(const l of s){const{start:c,end:d}=l,h=i[c],m=i[qp(c,d,i)];a?(n.moveTo(h.x,h.y),a=!1):(n.lineTo(t,h.y),n.lineTo(h.x,h.y)),o=!!e.pathSegment(n,l,{move:o}),o?n.closePath():n.lineTo(t,m.y)}n.lineTo(t,e.first().y),n.closePath(),n.clip()}function cw(n,e){const{line:t,target:s,property:i,color:a,scale:o,clip:l}=e,c=nde(t,s,i);for(const{source:d,target:h,start:m,end:f}of c){const{style:{backgroundColor:p=a}={}}=d,b=s!==!0;n.save(),n.fillStyle=p,bde(n,o,l,b&&_Z(i,m,f)),n.beginPath();const x=!!t.pathSegment(n,d);let v;if(b){x?n.closePath():mY(n,s,f,i);const S=!!s.pathSegment(n,h,{move:x,reverse:!0});v=x&&S,v||mY(n,s,m,i)}n.closePath(),n.fill(v?"evenodd":"nonzero"),n.restore()}}function bde(n,e,t,s){const i=e.chart.chartArea,{property:a,start:o,end:l}=s||{};if(a==="x"||a==="y"){let c,d,h,m;a==="x"?(c=o,d=i.top,h=l,m=i.bottom):(c=i.left,d=o,h=i.right,m=l),n.beginPath(),t&&(c=Math.max(c,t.left),h=Math.min(h,t.right),d=Math.max(d,t.top),m=Math.min(m,t.bottom)),n.rect(c,d,h-c,m-d),n.clip()}}function mY(n,e,t,s){const i=e.interpolate(t,s);i&&n.lineTo(i.x,i.y)}var yde={id:"filler",afterDatasetsUpdate(n,e,t){const s=(n.data.datasets||[]).length,i=[];let a,o,l,c;for(o=0;o<s;++o)a=n.getDatasetMeta(o),l=a.dataset,c=null,l&&l.options&&l instanceof Qp&&(c={visible:n.isDatasetVisible(o),index:o,fill:ide(l,o,s),chart:n,axis:a.controller.options.indexAxis,scale:a.vScale,line:l}),a.$filler=c,i.push(c);for(o=0;o<s;++o)c=i[o],!(!c||c.fill===!1)&&(c.fill=rde(i,o,t.propagate))},beforeDraw(n,e,t){const s=t.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),a=n.chartArea;for(let o=i.length-1;o>=0;--o){const l=i[o].$filler;l&&(l.line.updateControlPoints(a,l.axis),s&&l.fill&&lw(n.ctx,l,a))}},beforeDatasetsDraw(n,e,t){if(t.drawTime!=="beforeDatasetsDraw")return;const s=n.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const a=s[i].$filler;gY(a)&&lw(n.ctx,a,n.chartArea)}},beforeDatasetDraw(n,e,t){const s=e.meta.$filler;!gY(s)||t.drawTime!=="beforeDatasetDraw"||lw(n.ctx,s,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const IY=(n,e)=>{let{boxHeight:t=e,boxWidth:s=e}=n;return n.usePointStyle&&(t=Math.min(t,e),s=n.pointStyleWidth||Math.min(s,e)),{boxWidth:s,boxHeight:t,itemHeight:Math.max(e,t)}},vde=(n,e)=>n!==null&&e!==null&&n.datasetIndex===e.datasetIndex&&n.index===e.index;class CY extends Ad{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,s){this.maxWidth=e,this.maxHeight=t,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Pn(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(s=>e.filter(s,this.chart.data))),e.sort&&(t=t.sort((s,i)=>e.sort(s,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display){this.width=this.height=0;return}const s=e.labels,i=ni(s.font),a=i.size,o=this._computeTitleHeight(),{boxWidth:l,itemHeight:c}=IY(s,a);let d,h;t.font=i.string,this.isHorizontal()?(d=this.maxWidth,h=this._fitRows(o,a,l,c)+10):(h=this.maxHeight,d=this._fitCols(o,i,l,c)+10),this.width=Math.min(d,e.maxWidth||this.maxWidth),this.height=Math.min(h,e.maxHeight||this.maxHeight)}_fitRows(e,t,s,i){const{ctx:a,maxWidth:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],d=this.lineWidths=[0],h=i+l;let m=e;a.textAlign="left",a.textBaseline="middle";let f=-1,p=-h;return this.legendItems.forEach((b,x)=>{const v=s+t/2+a.measureText(b.text).width;(x===0||d[d.length-1]+v+2*l>o)&&(m+=h,d[d.length-(x>0?0:1)]=0,p+=h,f++),c[x]={left:0,top:p,row:f,width:v,height:i},d[d.length-1]+=v+l}),m}_fitCols(e,t,s,i){const{ctx:a,maxHeight:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],d=this.columnSizes=[],h=o-e;let m=l,f=0,p=0,b=0,x=0;return this.legendItems.forEach((v,S)=>{const{itemWidth:B,itemHeight:V}=xde(s,t,a,v,i);S>0&&p+V+2*l>h&&(m+=f+l,d.push({width:f,height:p}),b+=f+l,x++,f=p=0),c[S]={left:b,top:p,col:x,width:B,height:V},f=Math.max(f,B),p+=V+l}),m+=f,d.push({width:f,height:p}),m}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:s,labels:{padding:i},rtl:a}}=this,o=Gu(a,this.left,this.width);if(this.isHorizontal()){let l=0,c=pi(s,this.left+i,this.right-this.lineWidths[l]);for(const d of t)l!==d.row&&(l=d.row,c=pi(s,this.left+i,this.right-this.lineWidths[l])),d.top+=this.top+e+i,d.left=o.leftForLtr(o.x(c),d.width),c+=d.width+i}else{let l=0,c=pi(s,this.top+e+i,this.bottom-this.columnSizes[l].height);for(const d of t)d.col!==l&&(l=d.col,c=pi(s,this.top+e+i,this.bottom-this.columnSizes[l].height)),d.top=c,d.left+=this.left+i,d.left=o.leftForLtr(o.x(d.left),d.width),c+=d.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Lp(e,this),this._draw(),Pp(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:s,ctx:i}=this,{align:a,labels:o}=e,l=hs.color,c=Gu(e.rtl,this.left,this.width),d=ni(o.font),{padding:h}=o,m=d.size,f=m/2;let p;this.drawTitle(),i.textAlign=c.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=d.string;const{boxWidth:b,boxHeight:x,itemHeight:v}=IY(o,m),S=function(_,Y,j){if(isNaN(b)||b<=0||isNaN(x)||x<0)return;i.save();const M=Kt(j.lineWidth,1);if(i.fillStyle=Kt(j.fillStyle,l),i.lineCap=Kt(j.lineCap,"butt"),i.lineDashOffset=Kt(j.lineDashOffset,0),i.lineJoin=Kt(j.lineJoin,"miter"),i.lineWidth=M,i.strokeStyle=Kt(j.strokeStyle,l),i.setLineDash(Kt(j.lineDash,[])),o.usePointStyle){const H={radius:x*Math.SQRT2/2,pointStyle:j.pointStyle,rotation:j.rotation,borderWidth:M},D=c.xPlus(_,b/2),z=Y+f;wE(i,H,D,z,o.pointStyleWidth&&b)}else{const H=Y+Math.max((m-x)/2,0),D=c.leftForLtr(_,b),z=Zu(j.borderRadius);i.beginPath(),Object.values(z).some(O=>O!==0)?ip(i,{x:D,y:H,w:b,h:x,radius:z}):i.rect(D,H,b,x),i.fill(),M!==0&&i.stroke()}i.restore()},B=function(_,Y,j){rp(i,j.text,_,Y+v/2,d,{strikethrough:j.hidden,textAlign:c.textAlign(j.textAlign)})},V=this.isHorizontal(),R=this._computeTitleHeight();V?p={x:pi(a,this.left+h,this.right-s[0]),y:this.top+h+R,line:0}:p={x:this.left+h,y:pi(a,this.top+R+h,this.bottom-t[0].height),line:0},WE(this.ctx,e.textDirection);const W=v+h;this.legendItems.forEach((_,Y)=>{i.strokeStyle=_.fontColor,i.fillStyle=_.fontColor;const j=i.measureText(_.text).width,M=c.textAlign(_.textAlign||(_.textAlign=o.textAlign)),H=b+f+j;let D=p.x,z=p.y;c.setWidth(this.width),V?Y>0&&D+H+h>this.right&&(z=p.y+=W,p.line++,D=p.x=pi(a,this.left+h,this.right-s[p.line])):Y>0&&z+W>this.bottom&&(D=p.x=D+t[p.line].width+h,p.line++,z=p.y=pi(a,this.top+R+h,this.bottom-t[p.line].height));const O=c.x(D);if(S(O,z,_),D=Kae(M,D+b+f,V?D+H:this.right,e.rtl),B(c.x(D),z,_),V)p.x+=H+h;else if(typeof _.text!="string"){const E=d.lineHeight;p.y+=tD(_,E)+h}else p.y+=W}),VE(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,s=ni(t.font),i=Da(t.padding);if(!t.display)return;const a=Gu(e.rtl,this.left,this.width),o=this.ctx,l=t.position,c=s.size/2,d=i.top+c;let h,m=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),h=this.top+d,m=pi(e.align,m,this.right-f);else{const b=this.columnSizes.reduce((x,v)=>Math.max(x,v.height),0);h=d+pi(e.align,this.top,this.bottom-b-e.labels.padding-this._computeTitleHeight())}const p=pi(l,m,m+f);o.textAlign=a.textAlign(xE(l)),o.textBaseline="middle",o.strokeStyle=t.color,o.fillStyle=t.color,o.font=s.string,rp(o,t.text,p,h,s)}_computeTitleHeight(){const e=this.options.title,t=ni(e.font),s=Da(e.padding);return e.display?t.lineHeight+s.height:0}_getLegendItemAt(e,t){let s,i,a;if(kl(e,this.left,this.right)&&kl(t,this.top,this.bottom)){for(a=this.legendHitBoxes,s=0;s<a.length;++s)if(i=a[s],kl(e,i.left,i.left+i.width)&&kl(t,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(e){const t=this.options;if(!Zde(e.type,t))return;const s=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,a=vde(i,s);i&&!a&&Pn(t.onLeave,[e,i,this],this),this._hoveredItem=s,s&&!a&&Pn(t.onHover,[e,s,this],this)}else s&&Pn(t.onClick,[e,s,this],this)}}function xde(n,e,t,s,i){const a=Sde(s,n,e,t),o=wde(i,s,e.lineHeight);return{itemWidth:a,itemHeight:o}}function Sde(n,e,t,s){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((a,o)=>a.length>o.length?a:o)),e+t.size/2+s.measureText(i).width}function wde(n,e,t){let s=n;return typeof e.text!="string"&&(s=tD(e,t)),s}function tD(n,e){const t=n.text?n.text.length:0;return e*t}function Zde(n,e){return!!((n==="mousemove"||n==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(n==="click"||n==="mouseup"))}var Gde={id:"legend",_element:CY,start(n,e,t){const s=n.legend=new CY({ctx:n.ctx,options:t,chart:n});Kc.configure(n,s,t),Kc.addBox(n,s)},stop(n){Kc.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,e,t){const s=n.legend;Kc.configure(n,s,t),s.options=t},afterUpdate(n){const e=n.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(n,e){e.replay||n.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,e,t){const s=e.datasetIndex,i=t.chart;i.isDatasetVisible(s)?(i.hide(s),e.hidden=!0):(i.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const e=n.data.datasets,{labels:{usePointStyle:t,pointStyle:s,textAlign:i,color:a,useBorderRadius:o,borderRadius:l}}=n.legend.options;return n._getSortedDatasetMetas().map(c=>{const d=c.controller.getStyle(t?0:void 0),h=Da(d.borderWidth);return{text:e[c.index].label,fillStyle:d.backgroundColor,fontColor:a,hidden:!c.visible,lineCap:d.borderCapStyle,lineDash:d.borderDash,lineDashOffset:d.borderDashOffset,lineJoin:d.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:d.borderColor,pointStyle:s||d.pointStyle,rotation:d.rotation,textAlign:i||d.textAlign,borderRadius:o&&(l||d.borderRadius),datasetIndex:c.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};const am={average(n){if(!n.length)return!1;let e,t,s=new Set,i=0,a=0;for(e=0,t=n.length;e<t;++e){const l=n[e].element;if(l&&l.hasValue()){const c=l.tooltipPosition();s.add(c.x),i+=c.y,++a}}return a===0||s.size===0?!1:{x:[...s].reduce((l,c)=>l+c)/s.size,y:i/a}},nearest(n,e){if(!n.length)return!1;let t=e.x,s=e.y,i=Number.POSITIVE_INFINITY,a,o,l;for(a=0,o=n.length;a<o;++a){const c=n[a].element;if(c&&c.hasValue()){const d=c.getCenterPoint(),h=BZ(e,d);h<i&&(i=h,l=c)}}if(l){const c=l.tooltipPosition();t=c.x,s=c.y}return{x:t,y:s}}};function vo(n,e){return e&&(_s(e)?Array.prototype.push.apply(n,e):n.push(e)),n}function Sl(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function Bde(n,e){const{element:t,datasetIndex:s,index:i}=e,a=n.getDatasetMeta(s).controller,{label:o,value:l}=a.getLabelAndValue(i);return{chart:n,label:o,parsed:a.getParsed(i),raw:n.data.datasets[s].data[i],formattedValue:l,dataset:a.getDataset(),dataIndex:i,datasetIndex:s,element:t}}function fY(n,e){const t=n.chart.ctx,{body:s,footer:i,title:a}=n,{boxWidth:o,boxHeight:l}=e,c=ni(e.bodyFont),d=ni(e.titleFont),h=ni(e.footerFont),m=a.length,f=i.length,p=s.length,b=Da(e.padding);let x=b.height,v=0,S=s.reduce((R,W)=>R+W.before.length+W.lines.length+W.after.length,0);if(S+=n.beforeBody.length+n.afterBody.length,m&&(x+=m*d.lineHeight+(m-1)*e.titleSpacing+e.titleMarginBottom),S){const R=e.displayColors?Math.max(l,c.lineHeight):c.lineHeight;x+=p*R+(S-p)*c.lineHeight+(S-1)*e.bodySpacing}f&&(x+=e.footerMarginTop+f*h.lineHeight+(f-1)*e.footerSpacing);let B=0;const V=function(R){v=Math.max(v,t.measureText(R).width+B)};return t.save(),t.font=d.string,Bn(n.title,V),t.font=c.string,Bn(n.beforeBody.concat(n.afterBody),V),B=e.displayColors?o+2+e.boxPadding:0,Bn(s,R=>{Bn(R.before,V),Bn(R.lines,V),Bn(R.after,V)}),B=0,t.font=h.string,Bn(n.footer,V),t.restore(),v+=b.width,{width:v,height:x}}function Nde(n,e){const{y:t,height:s}=e;return t<s/2?"top":t>n.height-s/2?"bottom":"center"}function kde(n,e,t,s){const{x:i,width:a}=s,o=t.caretSize+t.caretPadding;if(n==="left"&&i+a+o>e.width||n==="right"&&i-a-o<0)return!0}function Rde(n,e,t,s){const{x:i,width:a}=t,{width:o,chartArea:{left:l,right:c}}=n;let d="center";return s==="center"?d=i<=(l+c)/2?"left":"right":i<=a/2?d="left":i>=o-a/2&&(d="right"),kde(d,n,e,t)&&(d="center"),d}function pY(n,e,t){const s=t.yAlign||e.yAlign||Nde(n,t);return{xAlign:t.xAlign||e.xAlign||Rde(n,e,t,s),yAlign:s}}function Wde(n,e){let{x:t,width:s}=n;return e==="right"?t-=s:e==="center"&&(t-=s/2),t}function Vde(n,e,t){let{y:s,height:i}=n;return e==="top"?s+=t:e==="bottom"?s-=i+t:s-=i/2,s}function AY(n,e,t,s){const{caretSize:i,caretPadding:a,cornerRadius:o}=n,{xAlign:l,yAlign:c}=t,d=i+a,{topLeft:h,topRight:m,bottomLeft:f,bottomRight:p}=Zu(o);let b=Wde(e,l);const x=Vde(e,c,d);return c==="center"?l==="left"?b+=d:l==="right"&&(b-=d):l==="left"?b-=Math.max(h,f)+i:l==="right"&&(b+=Math.max(m,p)+i),{x:Ir(b,0,s.width-e.width),y:Ir(x,0,s.height-e.height)}}function cf(n,e,t){const s=Da(t.padding);return e==="center"?n.x+n.width/2:e==="right"?n.x+n.width-s.right:n.x+s.left}function bY(n){return vo([],Sl(n))}function _de(n,e,t){return _g(n,{tooltip:e,tooltipItems:t,type:"tooltip"})}function yY(n,e){const t=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return t?n.override(t):n}const nD={beforeTitle:yl,title(n){if(n.length>0){const e=n[0],t=e.chart.data.labels,s=t?t.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return t[e.dataIndex]}return""},afterTitle:yl,beforeBody:yl,beforeLabel:yl,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let e=n.dataset.label||"";e&&(e+=": ");const t=n.formattedValue;return Sn(t)||(e+=t),e},labelColor(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const t=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:yl,afterBody:yl,beforeFooter:yl,footer:yl,afterFooter:yl};function Ur(n,e,t,s){const i=n[e].call(t,s);return typeof i>"u"?nD[e].call(t,s):i}class vY extends Ad{static positioners=am;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&t.options.animation&&s.animations,a=new YE(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(a)),a}getContext(){return this.$context||(this.$context=_de(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,t){const{callbacks:s}=t,i=Ur(s,"beforeTitle",this,e),a=Ur(s,"title",this,e),o=Ur(s,"afterTitle",this,e);let l=[];return l=vo(l,Sl(i)),l=vo(l,Sl(a)),l=vo(l,Sl(o)),l}getBeforeBody(e,t){return bY(Ur(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:s}=t,i=[];return Bn(e,a=>{const o={before:[],lines:[],after:[]},l=yY(s,a);vo(o.before,Sl(Ur(l,"beforeLabel",this,a))),vo(o.lines,Ur(l,"label",this,a)),vo(o.after,Sl(Ur(l,"afterLabel",this,a))),i.push(o)}),i}getAfterBody(e,t){return bY(Ur(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:s}=t,i=Ur(s,"beforeFooter",this,e),a=Ur(s,"footer",this,e),o=Ur(s,"afterFooter",this,e);let l=[];return l=vo(l,Sl(i)),l=vo(l,Sl(a)),l=vo(l,Sl(o)),l}_createItems(e){const t=this._active,s=this.chart.data,i=[],a=[],o=[];let l=[],c,d;for(c=0,d=t.length;c<d;++c)l.push(Bde(this.chart,t[c]));return e.filter&&(l=l.filter((h,m,f)=>e.filter(h,m,f,s))),e.itemSort&&(l=l.sort((h,m)=>e.itemSort(h,m,s))),Bn(l,h=>{const m=yY(e.callbacks,h);i.push(Ur(m,"labelColor",this,h)),a.push(Ur(m,"labelPointStyle",this,h)),o.push(Ur(m,"labelTextColor",this,h))}),this.labelColors=i,this.labelPointStyles=a,this.labelTextColors=o,this.dataPoints=l,l}update(e,t){const s=this.options.setContext(this.getContext()),i=this._active;let a,o=[];if(!i.length)this.opacity!==0&&(a={opacity:0});else{const l=am[s.position].call(this,i,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const c=this._size=fY(this,s),d=Object.assign({},l,c),h=pY(this.chart,s,d),m=AY(s,d,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,a={opacity:1,x:m.x,y:m.y,width:c.width,height:c.height,caretX:l.x,caretY:l.y}}this._tooltipItems=o,this.$context=void 0,a&&this._resolveAnimations().update(this,a),e&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,s,i){const a=this.getCaretPosition(e,s,i);t.lineTo(a.x1,a.y1),t.lineTo(a.x2,a.y2),t.lineTo(a.x3,a.y3)}getCaretPosition(e,t,s){const{xAlign:i,yAlign:a}=this,{caretSize:o,cornerRadius:l}=s,{topLeft:c,topRight:d,bottomLeft:h,bottomRight:m}=Zu(l),{x:f,y:p}=e,{width:b,height:x}=t;let v,S,B,V,R,W;return a==="center"?(R=p+x/2,i==="left"?(v=f,S=v-o,V=R+o,W=R-o):(v=f+b,S=v+o,V=R-o,W=R+o),B=v):(i==="left"?S=f+Math.max(c,h)+o:i==="right"?S=f+b-Math.max(d,m)-o:S=this.caretX,a==="top"?(V=p,R=V-o,v=S-o,B=S+o):(V=p+x,R=V+o,v=S+o,B=S-o),W=V),{x1:v,x2:S,x3:B,y1:V,y2:R,y3:W}}drawTitle(e,t,s){const i=this.title,a=i.length;let o,l,c;if(a){const d=Gu(s.rtl,this.x,this.width);for(e.x=cf(this,s.titleAlign,s),t.textAlign=d.textAlign(s.titleAlign),t.textBaseline="middle",o=ni(s.titleFont),l=s.titleSpacing,t.fillStyle=s.titleColor,t.font=o.string,c=0;c<a;++c)t.fillText(i[c],d.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+l,c+1===a&&(e.y+=s.titleMarginBottom-l)}}_drawColorBox(e,t,s,i,a){const o=this.labelColors[s],l=this.labelPointStyles[s],{boxHeight:c,boxWidth:d}=a,h=ni(a.bodyFont),m=cf(this,"left",a),f=i.x(m),p=c<h.lineHeight?(h.lineHeight-c)/2:0,b=t.y+p;if(a.usePointStyle){const x={radius:Math.min(d,c)/2,pointStyle:l.pointStyle,rotation:l.rotation,borderWidth:1},v=i.leftForLtr(f,d)+d/2,S=b+c/2;e.strokeStyle=a.multiKeyBackground,e.fillStyle=a.multiKeyBackground,kZ(e,x,v,S),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,kZ(e,x,v,S)}else{e.lineWidth=sn(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const x=i.leftForLtr(f,d),v=i.leftForLtr(i.xPlus(f,1),d-2),S=Zu(o.borderRadius);Object.values(S).some(B=>B!==0)?(e.beginPath(),e.fillStyle=a.multiKeyBackground,ip(e,{x,y:b,w:d,h:c,radius:S}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),ip(e,{x:v,y:b+1,w:d-2,h:c-2,radius:S}),e.fill()):(e.fillStyle=a.multiKeyBackground,e.fillRect(x,b,d,c),e.strokeRect(x,b,d,c),e.fillStyle=o.backgroundColor,e.fillRect(v,b+1,d-2,c-2))}e.fillStyle=this.labelTextColors[s]}drawBody(e,t,s){const{body:i}=this,{bodySpacing:a,bodyAlign:o,displayColors:l,boxHeight:c,boxWidth:d,boxPadding:h}=s,m=ni(s.bodyFont);let f=m.lineHeight,p=0;const b=Gu(s.rtl,this.x,this.width),x=function(j){t.fillText(j,b.x(e.x+p),e.y+f/2),e.y+=f+a},v=b.textAlign(o);let S,B,V,R,W,_,Y;for(t.textAlign=o,t.textBaseline="middle",t.font=m.string,e.x=cf(this,v,s),t.fillStyle=s.bodyColor,Bn(this.beforeBody,x),p=l&&v!=="right"?o==="center"?d/2+h:d+2+h:0,R=0,_=i.length;R<_;++R){for(S=i[R],B=this.labelTextColors[R],t.fillStyle=B,Bn(S.before,x),V=S.lines,l&&V.length&&(this._drawColorBox(t,e,R,b,s),f=Math.max(m.lineHeight,c)),W=0,Y=V.length;W<Y;++W)x(V[W]),f=m.lineHeight;Bn(S.after,x)}p=0,f=m.lineHeight,Bn(this.afterBody,x),e.y-=a}drawFooter(e,t,s){const i=this.footer,a=i.length;let o,l;if(a){const c=Gu(s.rtl,this.x,this.width);for(e.x=cf(this,s.footerAlign,s),e.y+=s.footerMarginTop,t.textAlign=c.textAlign(s.footerAlign),t.textBaseline="middle",o=ni(s.footerFont),t.fillStyle=s.footerColor,t.font=o.string,l=0;l<a;++l)t.fillText(i[l],c.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+s.footerSpacing}}drawBackground(e,t,s,i){const{xAlign:a,yAlign:o}=this,{x:l,y:c}=e,{width:d,height:h}=s,{topLeft:m,topRight:f,bottomLeft:p,bottomRight:b}=Zu(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(l+m,c),o==="top"&&this.drawCaret(e,t,s,i),t.lineTo(l+d-f,c),t.quadraticCurveTo(l+d,c,l+d,c+f),o==="center"&&a==="right"&&this.drawCaret(e,t,s,i),t.lineTo(l+d,c+h-b),t.quadraticCurveTo(l+d,c+h,l+d-b,c+h),o==="bottom"&&this.drawCaret(e,t,s,i),t.lineTo(l+p,c+h),t.quadraticCurveTo(l,c+h,l,c+h-p),o==="center"&&a==="left"&&this.drawCaret(e,t,s,i),t.lineTo(l,c+m),t.quadraticCurveTo(l,c,l+m,c),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,s=this.$animations,i=s&&s.x,a=s&&s.y;if(i||a){const o=am[e.position].call(this,this._active,this._eventPosition);if(!o)return;const l=this._size=fY(this,e),c=Object.assign({},o,this._size),d=pY(t,e,c),h=AY(e,c,d,t);(i._to!==h.x||a._to!==h.y)&&(this.xAlign=d.xAlign,this.yAlign=d.yAlign,this.width=l.width,this.height=l.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},a={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=Da(t.padding),l=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&l&&(e.save(),e.globalAlpha=s,this.drawBackground(a,e,i,t),WE(e,t.textDirection),a.y+=o.top,this.drawTitle(a,e,t),this.drawBody(a,e,t),this.drawFooter(a,e,t),VE(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const s=this._active,i=e.map(({datasetIndex:l,index:c})=>{const d=this.chart.getDatasetMeta(l);if(!d)throw new Error("Cannot find a dataset at index "+l);return{datasetIndex:l,element:d.data[c],index:c}}),a=!tp(s,i),o=this._positionChanged(i,t);(a||o)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,s=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,a=this._active||[],o=this._getActiveElements(e,a,t,s),l=this._positionChanged(o,e),c=t||!tp(o,a)||l;return c&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),c}_getActiveElements(e,t,s,i){const a=this.options;if(e.type==="mouseout")return[];if(!i)return t.filter(l=>this.chart.data.datasets[l.datasetIndex]&&this.chart.getDatasetMeta(l.datasetIndex).controller.getParsed(l.index)!==void 0);const o=this.chart.getElementsAtEventForMode(e,a.mode,a,s);return a.reverse&&o.reverse(),o}_positionChanged(e,t){const{caretX:s,caretY:i,options:a}=this,o=am[a.position].call(this,e,t);return o!==!1&&(s!==o.x||i!==o.y)}}var jde={id:"tooltip",_element:vY,positioners:am,afterInit(n,e,t){t&&(n.tooltip=new vY({chart:n,options:t}))},beforeUpdate(n,e,t){n.tooltip&&n.tooltip.initialize(t)},reset(n,e,t){n.tooltip&&n.tooltip.initialize(t)},afterDraw(n){const e=n.tooltip;if(e&&e._willRender()){const t={tooltip:e};if(n.notifyPlugins("beforeTooltipDraw",{...t,cancelable:!0})===!1)return;e.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",t)}},afterEvent(n,e){if(n.tooltip){const t=e.replay;n.tooltip.handleEvent(e.event,t,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,e)=>e.bodyFont.size,boxWidth:(n,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:nD},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Xde=(n,e,t,s)=>(typeof e=="string"?(t=n.push(e)-1,s.unshift({index:t,label:e})):isNaN(e)&&(t=null),t);function Jde(n,e,t,s){const i=n.indexOf(e);if(i===-1)return Xde(n,e,t,s);const a=n.lastIndexOf(e);return i!==a?t:i}const Yde=(n,e)=>n===null?null:Ir(Math.round(n),0,e);function xY(n){const e=this.getLabels();return n>=0&&n<e.length?e[n]:n}class Fde extends ih{static id="category";static defaults={ticks:{callback:xY}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const s=this.getLabels();for(const{index:i,label:a}of t)s[i]===a&&s.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Sn(e))return null;const s=this.getLabels();return t=isFinite(t)&&s[t]===e?t:Jde(s,e,Kt(t,e),this._addedLabels),Yde(t,s.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(s=0),t||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const e=this.min,t=this.max,s=this.options.offset,i=[];let a=this.getLabels();a=e===0&&t===a.length-1?a:a.slice(e,t+1),this._valueRange=Math.max(a.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=e;o<=t;o++)i.push({value:o});return i}getLabelForValue(e){return xY.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function Mde(n,e){const t=[],{bounds:i,step:a,min:o,max:l,precision:c,count:d,maxTicks:h,maxDigits:m,includeBounds:f}=n,p=a||1,b=h-1,{min:x,max:v}=e,S=!Sn(o),B=!Sn(l),V=!Sn(d),R=(v-x)/(m+1);let W=AJ((v-x)/b/p)*p,_,Y,j,M;if(W<1e-14&&!S&&!B)return[{value:x},{value:v}];M=Math.ceil(v/W)-Math.floor(x/W),M>b&&(W=AJ(M*W/b/p)*p),Sn(c)||(_=Math.pow(10,c),W=Math.ceil(W*_)/_),i==="ticks"?(Y=Math.floor(x/W)*W,j=Math.ceil(v/W)*W):(Y=x,j=v),S&&B&&a&&Yae((l-o)/a,W/1e3)?(M=Math.round(Math.min((l-o)/W,h)),W=(l-o)/M,Y=o,j=l):V?(Y=S?o:Y,j=B?l:j,M=d-1,W=(j-Y)/M):(M=(j-Y)/W,mm(M,Math.round(M),W/1e3)?M=Math.round(M):M=Math.ceil(M));const H=Math.max(bJ(W),bJ(Y));_=Math.pow(10,Sn(c)?H:c),Y=Math.round(Y*_)/_,j=Math.round(j*_)/_;let D=0;for(S&&(f&&Y!==o?(t.push({value:o}),Y<o&&D++,mm(Math.round((Y+D*W)*_)/_,o,SY(o,R,n))&&D++):Y<o&&D++);D<M;++D){const z=Math.round((Y+D*W)*_)/_;if(B&&z>l)break;t.push({value:z})}return B&&f&&j!==l?t.length&&mm(t[t.length-1].value,l,SY(l,R,n))?t[t.length-1].value=l:t.push({value:l}):(!B||j===l)&&t.push({value:j}),t}function SY(n,e,{horizontal:t,minRotation:s}){const i=Nl(s),a=(t?Math.sin(i):Math.cos(i))||.001,o=.75*e*(""+n).length;return Math.min(e/a,o)}class Hde extends ih{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Sn(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:s}=this.getUserBounds();let{min:i,max:a}=this;const o=c=>i=t?i:c,l=c=>a=s?a:c;if(e){const c=Wo(i),d=Wo(a);c<0&&d<0?l(0):c>0&&d>0&&o(0)}if(i===a){let c=a===0?1:Math.abs(a*.05);l(a+c),e||o(i-c)}this.min=i,this.max=a}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:t,stepSize:s}=e,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),t=t||11),t&&(i=Math.min(t,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:t.includeBounds!==!1},a=this._range||this,o=Mde(i,a);return e.bounds==="ticks"&&Fae(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let t=this.min,s=this.max;if(super.configure(),this.options.offset&&e.length){const i=(s-t)/Math.max(e.length-1,1)/2;t-=i,s+=i}this._startValue=t,this._endValue=s,this._valueRange=s-t}getLabelForValue(e){return tB(e,this.chart.options.locale,this.options.ticks.format)}}class Tde extends Hde{static id="linear";static defaults={ticks:{callback:SE.formatters.numeric}};determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=pr(e)?e:0,this.max=pr(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,s=Nl(this.options.ticks.minRotation),i=(e?Math.sin(s):Math.cos(s))||.001,a=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,a.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const $p={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},$r=Object.keys($p);function wY(n,e){return n-e}function ZY(n,e){if(Sn(e))return null;const t=n._adapter,{parser:s,round:i,isoWeekday:a}=n._parseOpts;let o=e;return typeof s=="function"&&(o=s(o)),pr(o)||(o=typeof s=="string"?t.parse(o,s):t.parse(o)),o===null?null:(i&&(o=i==="week"&&(Xm(a)||a===!0)?t.startOf(o,"isoWeek",a):t.startOf(o,i)),+o)}function GY(n,e,t,s){const i=$r.length;for(let a=$r.indexOf(n);a<i-1;++a){const o=$p[$r[a]],l=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((t-e)/(l*o.size))<=s)return $r[a]}return $r[i-1]}function Ede(n,e,t,s,i){for(let a=$r.length-1;a>=$r.indexOf(t);a--){const o=$r[a];if($p[o].common&&n._adapter.diff(i,s,o)>=e-1)return o}return $r[t?$r.indexOf(t):0]}function Dde(n){for(let e=$r.indexOf(n)+1,t=$r.length;e<t;++e)if($p[$r[e]].common)return $r[e]}function BY(n,e,t){if(!t)n[e]=!0;else if(t.length){const{lo:s,hi:i}=$G(t,e),a=t[s]>=e?t[s]:t[i];n[a]=!0}}function Lde(n,e,t,s){const i=n._adapter,a=+i.startOf(e[0].value,s),o=e[e.length-1].value;let l,c;for(l=a;l<=o;l=+i.add(l,1,s))c=t[l],c>=0&&(e[c].major=!0);return e}function NY(n,e,t){const s=[],i={},a=e.length;let o,l;for(o=0;o<a;++o)l=e[o],i[l]=o,s.push({value:l,major:!1});return a===0||!t?s:Lde(n,s,i,t)}class kY extends ih{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){const s=e.time||(e.time={}),i=this._adapter=new Sle._date(e.adapters.date);i.init(t),hm(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return e===void 0?null:ZY(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,s=e.time.unit||"day";let{min:i,max:a,minDefined:o,maxDefined:l}=this.getUserBounds();function c(d){!o&&!isNaN(d.min)&&(i=Math.min(i,d.min)),!l&&!isNaN(d.max)&&(a=Math.max(a,d.max))}(!o||!l)&&(c(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&c(this.getMinMax(!1))),i=pr(i)&&!isNaN(i)?i:+t.startOf(Date.now(),s),a=pr(a)&&!isNaN(a)?a:+t.endOf(Date.now(),s)+1,this.min=Math.min(i,a-1),this.max=Math.max(i+1,a)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],s=e[e.length-1]),{min:t,max:s}}buildTicks(){const e=this.options,t=e.time,s=e.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const a=this.min,o=this.max,l=Dae(i,a,o);return this._unit=t.unit||(s.autoSkip?GY(t.minUnit,this.min,this.max,this._getLabelCapacity(a)):Ede(this,l.length,t.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:Dde(this._unit),this.initOffsets(i),e.reverse&&l.reverse(),NY(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t=0,s=0,i,a;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?t=1-i:t=(this.getDecimalForValue(e[1])-i)/2,a=this.getDecimalForValue(e[e.length-1]),e.length===1?s=a:s=(a-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;t=Ir(t,0,o),s=Ir(s,0,o),this._offsets={start:t,end:s,factor:1/(t+1+s)}}_generate(){const e=this._adapter,t=this.min,s=this.max,i=this.options,a=i.time,o=a.unit||GY(a.minUnit,t,s,this._getLabelCapacity(t)),l=Kt(i.ticks.stepSize,1),c=o==="week"?a.isoWeekday:!1,d=Xm(c)||c===!0,h={};let m=t,f,p;if(d&&(m=+e.startOf(m,"isoWeek",c)),m=+e.startOf(m,d?"day":o),e.diff(s,t,o)>1e5*l)throw new Error(t+" and "+s+" are too far apart with stepSize of "+l+" "+o);const b=i.ticks.source==="data"&&this.getDataTimestamps();for(f=m,p=0;f<s;f=+e.add(f,l,o),p++)BY(h,f,b);return(f===s||i.bounds==="ticks"||p===1)&&BY(h,f,b),Object.keys(h).sort(wY).map(x=>+x)}getLabelForValue(e){const t=this._adapter,s=this.options.time;return s.tooltipFormat?t.format(e,s.tooltipFormat):t.format(e,s.displayFormats.datetime)}format(e,t){const i=this.options.time.displayFormats,a=this._unit,o=t||i[a];return this._adapter.format(e,o)}_tickFormatFunction(e,t,s,i){const a=this.options,o=a.ticks.callback;if(o)return Pn(o,[e,t,s],this);const l=a.time.displayFormats,c=this._unit,d=this._majorUnit,h=c&&l[c],m=d&&l[d],f=s[t],p=d&&m&&f&&f.major;return this._adapter.format(e,i||(p?m:h))}generateTickLabels(e){let t,s,i;for(t=0,s=e.length;t<s;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,s=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+s)*t.factor)}getValueForPixel(e){const t=this._offsets,s=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+s*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,s=this.ctx.measureText(e).width,i=Nl(this.isHorizontal()?t.maxRotation:t.minRotation),a=Math.cos(i),o=Math.sin(i),l=this._resolveTickFontOptions(0).size;return{w:s*a+l*o,h:s*o+l*a}}_getLabelCapacity(e){const t=this.options.time,s=t.displayFormats,i=s[t.unit]||s.millisecond,a=this._tickFormatFunction(e,0,NY(this,[e],this._majorUnit),i),o=this._getLabelSize(a),l=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return l>0?l:1}getDataTimestamps(){let e=this._cache.data||[],t,s;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,s=i.length;t<s;++t)e=e.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let t,s;if(e.length)return e;const i=this.getLabels();for(t=0,s=i.length;t<s;++t)e.push(ZY(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return bE(e.sort(wY))}}function df(n,e,t){let s=0,i=n.length-1,a,o,l,c;t?(e>=n[s].pos&&e<=n[i].pos&&({lo:s,hi:i}=Cg(n,"pos",e)),{pos:a,time:l}=n[s],{pos:o,time:c}=n[i]):(e>=n[s].time&&e<=n[i].time&&({lo:s,hi:i}=Cg(n,"time",e)),{time:a,pos:l}=n[s],{time:o,pos:c}=n[i]);const d=o-a;return d?l+(c-l)*(e-a)/d:l}class ICe extends kY{static id="timeseries";static defaults=kY.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=df(t,this.min),this._tableRange=df(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:s}=this,i=[],a=[];let o,l,c,d,h;for(o=0,l=e.length;o<l;++o)d=e[o],d>=t&&d<=s&&i.push(d);if(i.length<2)return[{time:t,pos:0},{time:s,pos:1}];for(o=0,l=i.length;o<l;++o)h=i[o+1],c=i[o-1],d=i[o],Math.round((h+c)/2)!==d&&a.push({time:d,pos:o/(l-1)});return a}_generate(){const e=this.min,t=this.max;let s=super.getDataTimestamps();return(!s.includes(e)||!s.length)&&s.splice(0,0,e),(!s.includes(t)||s.length===1)&&s.push(t),s.sort((i,a)=>i-a)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),s=this.getLabelTimestamps();return t.length&&s.length?e=this.normalize(t.concat(s)):e=t.length?t:s,e=this._cache.all=e,e}getDecimalForValue(e){return(df(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,s=this.getDecimalForPixel(e)/t.factor-t.end;return df(this._table,s*this._tableRange+this._minPos,!0)}}Up.register(ble,tde,Fde,Tde,xle,Qp,zce,vle,Fce,jde,Gde,yde);const Pde=n=>{const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;n=n.replace(e,(s,i,a,o)=>i+i+a+a+o+o);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:"0, 0, 0"},RY=({title:n,icon:e,children:t})=>r.jsxs("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-card col-span-1",children:[r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx(e,{className:"h-5 w-5 mr-3 text-muted"}),r.jsx("h3",{className:"font-semibold text-primary-text",children:n})]}),r.jsx("div",{className:"h-64 md:h-80 relative",children:t})]}),Kde=({data:n})=>{const e=k.useRef(null),t=k.useRef(null),{colorScheme:s}=an();return k.useEffect(()=>{if(e.current){const i=e.current.getContext("2d");if(i){const a=Is(s),o=a.activeItemBg,l=a.sidebarBorder;t.current?(t.current.data.labels=n.labels,t.current.data.datasets[0].data=n.present,t.current.data.datasets[0].backgroundColor=o,t.current.data.datasets[0].borderColor=l,t.current.data.datasets[1].data=n.absent,t.current.update()):t.current=new Up(i,{type:"bar",data:{labels:n.labels,datasets:[{label:"Present",data:n.present,backgroundColor:o,borderColor:l,borderWidth:1,borderRadius:4},{label:"Absent",data:n.absent,backgroundColor:"#EF4444",borderColor:"#DC2626",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(128,128,128,0.1)"}},x:{grid:{display:!1},ticks:{maxRotation:0,minRotation:0,autoSkip:!0,maxTicksLimit:7}}},plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"rectRounded",boxWidth:12,padding:20,font:{family:"'Manrope', sans-serif",size:12}}},tooltip:{backgroundColor:"#0F172A",titleFont:{family:"'Manrope', sans-serif"},bodyFont:{family:"'Manrope', sans-serif"},cornerRadius:8,padding:10,displayColors:!0,boxPadding:4}}}})}}},[n,s]),k.useEffect(()=>()=>{t.current&&(t.current.destroy(),t.current=null)},[]),r.jsx("div",{className:"h-full w-full flex flex-col",children:r.jsx("div",{className:"flex-grow relative",children:r.jsx("canvas",{ref:e})})})},Ode=({data:n})=>{const e=k.useRef(null),t=k.useRef(null),{colorScheme:s}=an();return k.useEffect(()=>{if(e.current){const i=e.current.getContext("2d");if(i){const o=Is(s).activeItemBg,l=Pde(o),c=i.createLinearGradient(0,0,0,200);c.addColorStop(0,`rgba(${l}, 0.4)`),c.addColorStop(1,`rgba(${l}, 0)`),t.current?(t.current.data.labels=n.labels,t.current.data.datasets[0].data=n.hours,t.current.data.datasets[0].borderColor=o,t.current.data.datasets[0].backgroundColor=c,t.current.data.datasets[0].pointBackgroundColor=o,t.current.update()):t.current=new Up(i,{type:"line",data:{labels:n.labels,datasets:[{label:"Average Hours Worked",data:n.hours,borderColor:o,backgroundColor:c,fill:!0,tension:.4,pointBackgroundColor:o,pointRadius:0,pointHoverRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(128,128,128,0.1)"},ticks:{stepSize:1,precision:0,callback:d=>{const h=typeof d=="string"?parseFloat(d):d;return Math.round(h)}}},x:{grid:{display:!1},ticks:{maxRotation:0,minRotation:0,autoSkip:!0,maxTicksLimit:7}}},plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"rectRounded",boxWidth:12,padding:20,font:{family:"'Manrope', sans-serif",size:12}}},tooltip:{backgroundColor:"#0F172A",titleFont:{family:"'Manrope', sans-serif"},bodyFont:{family:"'Manrope', sans-serif"},cornerRadius:8,padding:10,displayColors:!0,boxPadding:4}}}})}}},[n,s]),k.useEffect(()=>()=>{t.current&&(t.current.destroy(),t.current=null)},[]),r.jsx("div",{className:"h-full w-full flex flex-col",children:r.jsx("div",{className:"flex-grow relative",children:r.jsx("canvas",{ref:e})})})},zde=({data:n,dateRange:e,colorScheme:t})=>r.jsxs("div",{className:"p-8 font-sans text-sm text-black bg-white",children:[r.jsxs("div",{className:"flex justify-between items-center border-b pb-4 mb-6",children:[r.jsx(da,{className:"h-10",localPath:cG(t)}),r.jsxs("div",{className:"text-right",children:[r.jsx("h1",{className:"text-xl font-bold",children:"Attendance Log"}),r.jsxs("p",{className:"text-gray-600",children:[He(e.startDate,"dd MMM yyyy")," to ",He(e.endDate,"dd MMM yyyy")]})]})]}),r.jsxs("table",{className:"w-full mt-6 text-left border-collapse",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100",children:[r.jsx("th",{className:"p-2 border border-gray-300",children:"User"}),r.jsx("th",{className:"p-2 border border-gray-300",children:"Date"}),r.jsx("th",{className:"p-2 border border-gray-300",children:"Time"}),r.jsx("th",{className:"p-2 border border-gray-300",children:"Event"}),r.jsx("th",{className:"p-2 border border-gray-300",children:"Location"})]})}),r.jsx("tbody",{children:n.map((s,i)=>r.jsxs("tr",{className:"border-b",children:[r.jsx("td",{className:"p-2 border border-gray-300",children:s.userName}),r.jsx("td",{className:"p-2 border border-gray-300",children:s.date}),r.jsx("td",{className:"p-2 border border-gray-300",children:s.time}),r.jsx("td",{className:"p-2 border border-gray-300 capitalize",children:s.type.replace("-"," ")}),r.jsx("td",{className:"p-2 border border-gray-300",children:s.locationName||(s.latitude?`${s.latitude?.toFixed(4)}, ${s.longitude?.toFixed(4)}`:"N/A")})]},`${s.userName}-${s.date}-${s.time}-${i}`))})]})]}),Ude=({data:n,dateRange:e,colorScheme:t})=>{const i=[];for(let a=0;a<n.length;a+=15)i.push(n.slice(a,a+15));return i.length===0?null:r.jsx("div",{children:i.map((a,o)=>{const l=15-a.length,c=o===i.length-1;return r.jsxs("div",{style:{padding:"40px",marginBottom:"20px",fontFamily:'"Courier New", Courier, monospace',fontSize:"14px",color:"#000",backgroundColor:"#fff",width:"1123px",height:"794px",boxSizing:"border-box",letterSpacing:"0.5px",pageBreakAfter:c?"auto":"always",position:"relative",display:"flex",flexDirection:"column",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[r.jsx("table",{style:{width:"100%",borderBottom:"2px solid #000",marginBottom:"16px",paddingBottom:"8px"},children:r.jsx("tbody",{children:r.jsxs("tr",{children:[r.jsx("td",{style:{width:"50%",verticalAlign:"top",textAlign:"left"},children:r.jsx(da,{className:"h-14",localPath:cG(t)})}),r.jsxs("td",{style:{width:"50%",verticalAlign:"top",textAlign:"right"},children:[r.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"1px"},children:"Basic Attendance Report"}),r.jsxs("div",{style:{fontSize:"12px",color:"#333",marginBottom:"4px"},children:[He(e.startDate,"dd MMM yyyy")," -"," ",He(e.endDate,"dd MMM yyyy")]}),r.jsxs("div",{style:{fontSize:"10px",color:"#666"},children:["Generated: ",He(new Date,"dd MMM yyyy HH:mm")]})]})]})})}),r.jsx("div",{style:{flexGrow:1},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #000",tableLayout:"fixed"},children:[r.jsx("thead",{style:{display:"table-header-group"},children:r.jsxs("tr",{style:{backgroundColor:"#f2f2f2"},children:[r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"28%",fontSize:"11px",fontWeight:"bold"},children:"Employee Name"}),r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"14%",fontSize:"11px",fontWeight:"bold"},children:"Date"}),r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"14%",fontSize:"11px",fontWeight:"bold"},children:"Status"}),r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"12%",fontSize:"11px",fontWeight:"bold"},children:"Check In"}),r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"12%",fontSize:"11px",fontWeight:"bold"},children:"Check Out"}),r.jsx("th",{style:{border:"1px solid #000",padding:"10px 5px",textAlign:"center",width:"15%",fontSize:"11px",fontWeight:"bold"},children:"Hours"})]})}),r.jsxs("tbody",{children:[a.map((d,h)=>r.jsxs("tr",{style:{backgroundColor:h%2===0?"#fff":"#fafafa"},children:[r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle",wordWrap:"break-word",whiteSpace:"normal",lineHeight:"1.4"},children:d.userName}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:He(new Date(String(d.date).replace(/-/g,"/")),"dd MMM yyyy")}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:d.status}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:d.checkIn||"-"}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:d.checkOut||"-"}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",textAlign:"center",verticalAlign:"middle"},children:d.duration||"-"})]},`${d.userName}-${d.date}-${h}`)),Array.from({length:l}).map((d,h)=>r.jsxs("tr",{style:{backgroundColor:"#fff"},children:[r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px",height:"33px"},children:""}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:""}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:""}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:""}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:""}),r.jsx("td",{style:{border:"1px solid #ccc",padding:"8px 5px"},children:""})]},`empty-${h}`))]})]})}),r.jsxs("div",{style:{marginTop:"10px",borderTop:"1px solid #ccc",paddingTop:"8px",textAlign:"center",fontSize:"10px",color:"#888"},children:[x6(t)," - Confidential Report - Page ",o+1," of ",i.length]})]},o)})})},Qde=({data:n,dateRange:e,colorScheme:t})=>{const s=wo({start:e.startDate,end:e.endDate});return r.jsxs("div",{className:"p-8 font-sans text-[9px] text-black bg-white",children:[r.jsxs("div",{className:"flex justify-between items-center border-b pb-4 mb-4",children:[r.jsx(da,{className:"h-8",localPath:cG(t)}),r.jsxs("div",{className:"text-right",children:[r.jsx("h1",{className:"text-lg font-bold",children:"Monthly Attendance Report"}),r.jsxs("p",{className:"text-gray-600",children:[He(e.startDate,"dd MMM yyyy")," to ",He(e.endDate,"dd MMM yyyy")]})]})]}),r.jsxs("table",{className:"w-full border-collapse border border-gray-400 text-center",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-200 font-bold",children:[r.jsx("td",{className:"border p-1 border-gray-400 text-left",children:"Employee Name"}),s.map((i,a)=>r.jsx("td",{className:"border p-1 border-gray-400",children:He(i,"d")},a)),r.jsx("td",{className:"border p-1 border-gray-400",children:"P"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"1/2P"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"A"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"WO"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"H"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"WOP"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"HP"}),r.jsx("td",{className:"border p-1 border-gray-400",children:"Total"})]})}),r.jsx("tbody",{children:n.map((i,a)=>r.jsxs("tr",{children:[r.jsx("td",{className:"border p-1 border-gray-400 text-left",children:i.userName}),i.statuses.map((o,l)=>r.jsx("td",{className:"border p-1 border-gray-400",children:o},l)),r.jsx("td",{className:"border p-1 border-gray-400",children:i.presentDays}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.halfDays}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.absentDays}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.weekOffs}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.holidays}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.weekendPresents}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.holidayPresents}),r.jsx("td",{className:"border p-1 border-gray-400",children:i.totalPayableDays})]},a))})]})]})},qde=()=>{const n=jt("(max-width: 639px)"),{user:e}=bt(),{permissions:t}=ha(),{recurringHolidays:s}=wi(),{colorScheme:i}=an(),a=Is(i),[o,l]=k.useState([]),[c,d]=k.useState([]),[h,m]=k.useState(null),[f,p]=k.useState(!0),[b,x]=k.useState(0),[v,S]=k.useState({startDate:bf(),endDate:jb(),key:"selection"}),B=k.useMemo(()=>[v],[v]),[V,R]=k.useState("Today"),[W,_]=k.useState(!1),Y=k.useRef(null),[j,M]=k.useState("all"),[H,D]=k.useState("all"),[z,O]=k.useState("all"),[E,te]=k.useState("basic"),[q,de]=k.useState(!1),[U,P]=k.useState(null),[ne,K]=k.useState({}),re=k.useRef(null),le=e&&t[e.role]?.includes("download_attendance_report"),ae=!(e&&t[e.role]?.includes("view_all_attendance")),[Ce,ie]=k.useState({present:0,absent:0,ot:0,compOff:0}),[ge,xe]=k.useState([]);k.useEffect(()=>{const ee=oe=>{Y.current&&!Y.current.contains(oe.target)&&_(!1)};return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[]),k.useEffect(()=>{le&&ce.getUsers().then(l)},[le]),k.useEffect(()=>{(async()=>{if(!(!ae||!e||!v.startDate||!v.endDate)){p(!0);try{const oe=xu(v.startDate,7),Ie=oe.toISOString(),Ne=v.endDate.toISOString(),[Ge,je]=await Promise.all([ce.getAttendanceEvents(e.id,Ie,Ne),ce.getCompOffLogs(e.id)]);let ze=wo({start:oe,end:v.endDate}).map(Rt=>{const cn=He(Rt,"yyyy-MM-dd"),en=Ge.filter(un=>He(new Date(un.timestamp),"yyyy-MM-dd")===cn);let on="Absent",Ut="-",dn="-",fn=0;const Ft=He(Rt,"EEEE"),it=Ft==="Sunday";if(s.some(un=>{if(un.day.toLowerCase()!==Ft.toLowerCase())return!1;const ls=Math.ceil(Rt.getDate()/7),Cs=e.role==="field_officer"?"field":"office";return un.n===ls&&(un.type||"office")===Cs})?on="Holiday":it&&(on="Weekend"),en.length>0){on="Present",en.sort((Cs,br)=>new Date(Cs.timestamp).getTime()-new Date(br.timestamp).getTime());const un=en.find(Cs=>Cs.type==="check-in"),ls=[...en].reverse().find(Cs=>Cs.type==="check-out");if(un&&(Ut=He(new Date(un.timestamp),"hh:mm a")),ls&&(dn=He(new Date(ls.timestamp),"hh:mm a"),un)){const br=Uc(new Date(ls.timestamp),new Date(un.timestamp))/60;br>8&&(fn=Math.round((br-8)*10)/10)}}return{rawDate:Rt,date:He(Rt,"dd MMM, yyyy"),day:Ft,checkIn:Ut,checkOut:dn,status:on,ot:fn}});ze.forEach((Rt,cn)=>{if(Rt.status==="Weekend"&&Rt.day==="Sunday"){let en=0;const on=Math.max(0,cn-6);for(let Ut=cn-1;Ut>=on;Ut--)ze[Ut].status==="Absent"&&en++;en>=4&&(Rt.status="Absent")}});const lt=ze.filter(Rt=>Rt.rawDate>=v.startDate),Dt=lt.filter(Rt=>Rt.status==="Present").length,kt=lt.filter(Rt=>Rt.status==="Absent"&&Rt.rawDate<=new Date).length,$t=lt.reduce((Rt,cn)=>Rt+cn.ot,0),wn=je.filter(Rt=>{const cn=new Date(Rt.dateEarned);return cn>=v.startDate&&cn<=v.endDate&&Rt.status==="earned"}).length;ie({present:Dt,absent:kt,ot:Math.round($t*10)/10,compOff:wn}),xe(lt.reverse())}catch(oe){console.error("Failed to fetch employee attendance",oe)}finally{p(!1)}}})()},[ae,e,v,s]);const _e=k.useRef(null),Be=k.useCallback(async(ee,oe)=>{_e.current&&(clearInterval(_e.current),_e.current=null),p(!0),x(0),_e.current=setInterval(()=>{x(Ie=>Ie>=90?(_e.current&&clearInterval(_e.current),90):Ie+10)},100);try{let Ie=o;Ie.length===0&&(Ie=await ce.getUsers(),l(Ie));const Ne=new Date,Ge=ee<Ne?ee:bf(),je=oe>Ne?oe:jb(),[Fe,ze]=await Promise.all([ce.getAllAttendanceEvents(Ge.toISOString(),je.toISOString()),ce.getLeaveRequests({startDate:Ge.toISOString(),endDate:je.toISOString(),status:"approved"})]);d(Fe);const lt=He(Ne,"yyyy-MM-dd"),Dt=Fe.filter(Ft=>He(new Date(Ft.timestamp),"yyyy-MM-dd")===lt),kt=new Set(Dt.map(Ft=>Ft.userId)).size,$t=ze.filter(Ft=>{const it=new Date(Ft.startDate),pn=new Date(Ft.endDate);return Ne>=it&&Ne<=pn}),wn=new Set($t.map(Ft=>Ft.userId)).size,Rt=Ie.length,cn=Math.max(0,Rt-kt-wn),en=wo({start:ee,end:oe}),on=en.map(Ft=>He(Ft,"dd MMM")),Ut=[],dn=[],fn=[];en.forEach(Ft=>{const it=He(Ft,"yyyy-MM-dd"),pn=Fe.filter(Rn=>He(new Date(Rn.timestamp),"yyyy-MM-dd")===it),un=new Set(pn.map(Rn=>Rn.userId)).size,ls=ze.filter(Rn=>{const nr=new Date(Rn.startDate),Jr=new Date(Rn.endDate);return Ft>=nr&&Ft<=Jr}),Cs=new Set(ls.map(Rn=>Rn.userId)).size,br=Math.max(0,Rt-un-Cs);Ut.push(un),dn.push(br);let Ia=0;const Xr={};pn.forEach(Rn=>{Xr[Rn.userId]||(Xr[Rn.userId]=[]),Xr[Rn.userId].push(Rn)}),Object.values(Xr).forEach(Rn=>{Rn.sort((Gs,Yo)=>new Date(Gs.timestamp).getTime()-new Date(Yo.timestamp).getTime());const nr=Rn.find(Gs=>Gs.type==="check-in"),Jr=[...Rn].reverse().find(Gs=>Gs.type==="check-out");if(nr&&Jr){const Gs=Uc(new Date(Jr.timestamp),new Date(nr.timestamp));Ia+=Gs/60}}),fn.push(un>0?parseFloat((Ia/un).toFixed(1)):0)}),m({totalEmployees:Rt,presentToday:kt,absentToday:cn,onLeaveToday:wn,attendanceTrend:{labels:on,present:Ut,absent:dn},productivityTrend:{labels:on,hours:fn}}),_e.current&&clearInterval(_e.current),_e.current=setInterval(()=>{x(Ft=>Ft>=100?(_e.current&&clearInterval(_e.current),setTimeout(()=>{p(!1)},200),100):Math.min(Ft+10,100))},50)}catch(Ie){console.error("Failed to load dashboard data",Ie),_e.current&&clearInterval(_e.current),x(100),setTimeout(()=>{p(!1)},200)}},[o]);k.useEffect(()=>()=>{_e.current&&clearInterval(_e.current)},[]),k.useEffect(()=>{v.startDate&&v.endDate&&Be(v.startDate,v.endDate)},[v,Be]),k.useEffect(()=>{if(E!=="log"||!v.startDate||!v.endDate)return;const ee=Ie=>parseFloat(Ie.toFixed(6));(async()=>{const Ie=j==="all"?o:o.filter(Fe=>Fe.id===j),Ne=new Set(Ie.map(Fe=>Fe.id)),Ge=c.filter(Fe=>{if(!Ne.has(Fe.userId)||new Date(Fe.timestamp)<v.startDate||new Date(Fe.timestamp)>v.endDate||Fe.locationName||!Fe.latitude||!Fe.longitude)return!1;const ze=`${ee(Fe.latitude)},${ee(Fe.longitude)}`;return!ne[ze]});if(console.log("Geocoding: Events to process:",Ge.length),Ge.length===0)return;const je=Ge.map(Fe=>({lat:Fe.latitude,lon:Fe.longitude}));console.log("Geocoding: Fetching addresses for",je.length,"unique coordinates");try{const Fe=await ce.batchResolveAddresses(je);console.log("Geocoding: Resolved addresses:",Object.keys(Fe).length),K(ze=>({...ze,...Fe}))}catch(Fe){console.error("Batch geocoding failed:",Fe)}})()},[c,v,j,E,o]);const Se=ee=>{R(ee);const oe=new Date;let Ie=bf(),Ne=jb();ee==="This Month"?(Ie=Si(oe),Ne=Ha(oe)):ee==="This Year"?(Ie=wM(oe),Ne=hP(oe)):ee==="Last 7 Days"?Ie=xu(oe,6):ee==="Last 30 Days"&&(Ie=xu(oe,29)),Ne>oe&&(Ne=oe),S({startDate:Ie,endDate:Ne,key:"selection"})},Re=ee=>{S(ee.selection),R("Custom"),_(!1)},Ye=k.useMemo(()=>{const ee=v.endDate,oe=new Date;return He(ee,"yyyy-MM-dd")===He(oe,"yyyy-MM-dd")?"Today":`on ${He(ee,"MMM d")}`},[v]),De=k.useMemo(()=>{if(!v.startDate||!v.endDate)return[];const ee=[],oe=wo({start:v.startDate,end:v.endDate});(j==="all"?o:o.filter(Ge=>Ge.id===j)).forEach(Ge=>{oe.forEach(je=>{const Fe=He(je,"yyyy-MM-dd"),ze=c.filter(en=>en.userId===Ge.id&&He(new Date(en.timestamp),"yyyy-MM-dd")===Fe);let lt="Absent",Dt="",kt="",$t="";const wn=He(je,"EEEE"),Rt=wn==="Sunday";if(s.some(en=>{if(en.day.toLowerCase()!==wn.toLowerCase())return!1;const on=je.getDate(),Ut=Math.ceil(on/7),dn=Ge.role==="field_staff"?"field":"office",fn=en.type||"office";return en.n===Ut&&fn===dn})?lt="Holiday":Rt&&(lt="Weekend"),ze.length>0){const en=[...ze].sort((dn,fn)=>new Date(dn.timestamp).getTime()-new Date(fn.timestamp).getTime()),on=en.find(dn=>dn.type==="check-in"),Ut=[...en].reverse().find(dn=>dn.type==="check-out");if(on&&(lt="Present",Dt=He(new Date(on.timestamp),"HH:mm")),Ut&&(kt=He(new Date(Ut.timestamp),"HH:mm")),on&&Ut){const dn=new Date(on.timestamp),fn=new Date(Ut.timestamp),Ft=Uc(fn,dn),it=Math.floor(Ft/60),pn=Ft%60;$t=`${it}h ${pn}m`}}ee.push({userName:Ge.name,date:Fe,status:lt,checkIn:Dt,checkOut:kt,duration:$t})})});let Ne=H==="all"?ee:ee.filter(Ge=>Ge.status===H);return z!=="all"&&(Ne=Ne.filter(Ge=>{const je=Ge.checkIn&&Ge.checkIn!=="-"&&Ge.checkIn!=="",Fe=Ge.checkOut&&Ge.checkOut!=="-"&&Ge.checkOut!=="";switch(z){case"complete":return je&&Fe;case"missing_checkout":return je&&!Fe;case"missing_checkin":return!je&&Fe;case"incomplete":return!je||!Fe;default:return!0}})),Ne},[o,c,v,j,H,z,s]),Me=k.useMemo(()=>{if(!v.startDate||!v.endDate)return[];const ee=Ne=>parseFloat(Ne.toFixed(6)),oe=j==="all"?o:o.filter(Ne=>Ne.id===j),Ie=new Set(oe.map(Ne=>Ne.id));return c.filter(Ne=>Ie.has(Ne.userId)).map(Ne=>{const Ge=o.find(ze=>ze.id===Ne.userId),je=Ne.latitude&&Ne.longitude?`${ee(Ne.latitude)},${ee(Ne.longitude)}`:"",Fe=ne[je];return{userName:Ge?.name||"Unknown",date:He(new Date(Ne.timestamp),"yyyy-MM-dd"),time:He(new Date(Ne.timestamp),"HH:mm:ss"),type:Ne.type,locationName:Ne.locationName||Fe||(Ne.latitude?`${Ne.latitude.toFixed(4)}, ${Ne.longitude.toFixed(4)}`:"N/A"),latitude:Ne.latitude,longitude:Ne.longitude}}).sort((Ne,Ge)=>Ne.date!==Ge.date?Ne.date.localeCompare(Ge.date):Ne.time.localeCompare(Ge.time))},[o,c,v,j,ne]),Le=k.useMemo(()=>{if(!v.startDate||!v.endDate)return[];const ee=wo({start:v.startDate,end:v.endDate});return(j==="all"?o:o.filter(Ie=>Ie.id===j)).map(Ie=>{const Ne=[];let Ge=0,je=0,Fe=0,ze=0,lt=0,Dt=0,kt=0;ee.forEach(wn=>{const Rt=He(wn,"yyyy-MM-dd"),en=c.filter(Ft=>Ft.userId===Ie.id&&He(new Date(Ft.timestamp),"yyyy-MM-dd")===Rt).some(Ft=>Ft.type==="check-in"),on=He(wn,"EEEE"),Ut=on==="Sunday",dn=s.some(Ft=>{if(Ft.day.toLowerCase()!==on.toLowerCase())return!1;const it=wn.getDate(),pn=Math.ceil(it/7),un=Ie.role==="field_staff"?"field":"office",ls=Ft.type||"office";return Ft.n===pn&&ls===un});let fn="";en?dn?(fn="HP",kt++):Ut?(fn="WOP",Dt++):(fn="P",Ge++):dn?(fn="H",lt++):Ut?(fn="WO",ze++):(fn="A",je++),Ne.push(fn)});const $t=Ge+ze+lt+Dt+kt+Fe*.5;return{userName:Ie.name,statuses:Ne,presentDays:Ge,absentDays:je,halfDays:Fe,weekOffs:ze,holidays:lt,weekendPresents:Dt,holidayPresents:kt,totalPayableDays:$t}})},[o,c,v,j,s]),nt=k.useMemo(()=>E==="basic"?r.jsx(Ude,{data:De,dateRange:v,colorScheme:i}):E==="log"?r.jsx(zde,{data:Me,dateRange:v,colorScheme:i}):E==="monthly"?r.jsx(Qde,{data:Le,dateRange:v,colorScheme:i}):null,[E,De,Me,Le,v,i]),st=()=>{de(!0);try{let ee="data:text/csv;charset=utf-8,",oe=`Attendance_Report_${He(new Date,"yyyy-MM-dd")}.csv`;if(E==="basic")ee+=`Employee Name,Date,Status,Check In,Check Out,Hours
`,De.forEach(Ge=>{ee+=`"${Ge.userName}","${Ge.date}","${Ge.status}","${Ge.checkIn}","${Ge.checkOut}","${Ge.duration}"
`});else if(E==="log")ee+=`User,Date,Time,Event,Location,Latitude,Longitude
`,Me.forEach(Ge=>{ee+=`"${Ge.userName}","${Ge.date}","${Ge.time}","${Ge.type}","${Ge.locationName||""}","${Ge.latitude||""}","${Ge.longitude||""}"
`});else if(E==="monthly"){const je=wo({start:v.startDate,end:v.endDate}).map(Fe=>He(Fe,"dd MMM")).join(",");ee+=`Employee Name,${je},Present,Absent,Half Days,Week Offs,Holidays,Weekend Presents,Holiday Presents,Total Payable Days
`,Le.forEach(Fe=>{const ze=Fe.statuses.join(",");ee+=`"${Fe.userName}",${ze},"${Fe.presentDays}","${Fe.absentDays}","${Fe.halfDays}","${Fe.weekOffs}","${Fe.holidays}","${Fe.weekendPresents}","${Fe.holidayPresents}","${Fe.totalPayableDays}"
`})}const Ie=encodeURI(ee),Ne=document.createElement("a");Ne.setAttribute("href",Ie),Ne.setAttribute("download",oe),document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),P({message:"CSV downloaded successfully.",type:"success"})}catch(ee){console.error("CSV generation failed:",ee),P({message:"Failed to generate CSV.",type:"error"})}finally{de(!1)}};return ae?r.jsxs("div",{className:"p-4 space-y-6 pb-24 md:bg-transparent",style:{backgroundColor:n?a.mobileBg:void 0},children:[r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"My Attendance"}),r.jsxs("div",{className:"bg-card p-3 rounded-xl shadow-sm border border-border flex flex-wrap items-center gap-2",children:[["Today","This Month","Last 30 Days"].map(ee=>r.jsx(se,{type:"button",variant:V===ee?"primary":"outline",onClick:()=>Se(ee),className:V===ee?"!text-white shadow-md border":"bg-card text-primary-text border border-border hover:bg-accent-light",style:V===ee?{backgroundColor:a.activeItemBg,borderColor:a.sidebarBorder}:{},children:ee},ee)),r.jsxs("div",{className:"relative",ref:Y,children:[r.jsxs(se,{type:"button",variant:V==="Custom"?"primary":"outline",onClick:()=>_(!W),className:V==="Custom"?"!text-white shadow-md border":"bg-card text-primary-text border border-border hover:bg-accent-light",style:V==="Custom"?{backgroundColor:a.activeItemBg,borderColor:a.sidebarBorder}:{},children:[r.jsx(ra,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:V==="Custom"?`${He(v.startDate,"dd MMM")} - ${He(v.endDate,"dd MMM")}`:"Custom"})]}),W&&r.jsx("div",{className:"absolute top-full right-0 mt-2 z-50 bg-white dark:bg-gray-950 border border-border rounded-lg shadow-xl w-[300px] sm:w-auto overflow-hidden",children:r.jsx("div",{className:"text-gray-900",children:r.jsx(Wm.DateRangePicker,{onChange:Re,months:1,ranges:B,direction:"horizontal",maxDate:new Date})})})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow bg-card",children:[r.jsx("div",{className:"p-4 rounded-full mb-3 shadow-lg text-white",style:{backgroundColor:a.activeItemBg},children:r.jsx(Sg,{className:"h-8 w-8"})}),r.jsx("p",{className:"text-sm font-medium mb-1 text-muted",children:"Present"}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:Ce.present})]}),r.jsxs("div",{className:"p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow bg-card",children:[r.jsx("div",{className:"p-4 rounded-full mb-3 shadow-lg text-white",style:{backgroundColor:a.activeItemBg},children:r.jsx(Of,{className:"h-8 w-8"})}),r.jsx("p",{className:"text-sm font-medium mb-1 text-muted",children:"Absent"}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:Ce.absent})]}),r.jsxs("div",{className:"p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow bg-card",children:[r.jsx("div",{className:"p-4 rounded-full mb-3 shadow-lg text-white",style:{backgroundColor:a.activeItemBg},children:r.jsx(jo,{className:"h-8 w-8"})}),r.jsx("p",{className:"text-sm font-medium mb-1 text-muted",children:"Overtime"}),r.jsxs("p",{className:"text-2xl font-bold text-primary-text",children:[Ce.ot,"h"]})]}),r.jsxs("div",{className:"p-6 rounded-xl shadow-sm border border-border flex flex-col items-center justify-center text-center hover:shadow-md transition-shadow bg-card",children:[r.jsx("div",{className:"p-4 rounded-full mb-3 shadow-lg text-white",style:{backgroundColor:a.activeItemBg},children:r.jsx(V2,{className:"h-8 w-8"})}),r.jsx("p",{className:"text-sm font-medium mb-1 text-muted",children:"Comp Offs"}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:Ce.compOff})]})]}),r.jsxs("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:[r.jsx("div",{className:"p-4 border-b border-border font-semibold text-primary-text",children:"Attendance Logs"}),r.jsx("div",{className:"divide-y divide-border",children:f?r.jsx("div",{className:"p-8 text-center text-muted",children:r.jsx(xt,{className:"h-6 w-6 animate-spin mx-auto"})}):ge.length===0?r.jsx("div",{className:"p-8 text-center text-muted",children:"No records found for this period."}):ge.map((ee,oe)=>r.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-primary-text",children:ee.date}),r.jsx("p",{className:"text-xs text-muted",children:ee.day})]}),r.jsxs("div",{className:"flex flex-col items-end gap-1.5",children:[r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm
                                            ${ee.status==="Present"?"bg-emerald-500 text-white dark:bg-emerald-600":ee.status==="Absent"?"bg-rose-500 text-white dark:bg-rose-600":ee.status==="Holiday"?"bg-amber-500 text-white dark:bg-amber-600":ee.status==="Weekend"?"bg-indigo-500 text-white dark:bg-indigo-600":"bg-gray-500 text-white dark:bg-gray-600"}`,children:ee.status}),(ee.checkIn!=="-"||ee.checkOut!=="-")&&r.jsxs("div",{className:"text-xs text-muted font-medium",children:[ee.checkIn," - ",ee.checkOut]}),ee.ot>0&&r.jsxs("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 font-bold",children:["+",ee.ot,"h OT"]})]})]},oe))})]})]}):r.jsxs("div",{className:"p-4 space-y-6 relative h-full overflow-hidden",children:[f&&r.jsxs("div",{className:`absolute inset-0 z-50 flex flex-col justify-center items-center backdrop-blur-sm rounded-xl transition-all duration-300
                    ${h?"bg-white/80 dark:bg-gray-950/80":"bg-white dark:bg-gray-950"}`,children:[r.jsx(xt,{className:"h-12 w-12 animate-spin mb-4",style:{color:a.activeItemBg}}),r.jsx("div",{className:"w-64 bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-2",children:r.jsx("div",{className:"h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${b}%`,backgroundColor:a.activeItemBg}})}),r.jsxs("p",{className:"text-sm font-medium text-muted",children:["Loading Data... ",b,"%"]})]}),r.jsx("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Attendance Dashboard"})}),r.jsxs("div",{className:"hidden md:flex bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex-wrap items-end gap-4",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["Today","Last 7 Days","This Month"].map(ee=>r.jsx(se,{type:"button",onClick:()=>Se(ee),className:V===ee?"!text-white shadow-md border":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50",style:V===ee?{backgroundColor:a.activeItemBg,borderColor:a.sidebarBorder}:{},children:ee},ee)),r.jsxs("div",{className:"relative",ref:Y,children:[r.jsxs(se,{type:"button",variant:"outline",onClick:()=>_(!W),className:"hover:bg-gray-100",children:[r.jsx(ra,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:V==="Custom"?`${He(v.startDate,"dd MMM, yyyy")} - ${He(v.endDate,"dd MMM, yyyy")}`:"Custom Range"})]}),W&&r.jsxs("div",{className:"absolute top-full left-0 mt-2 z-50 bg-card border rounded-lg shadow-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 p-3",children:[r.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:He(v.startDate,"yyyy-MM-dd"),max:He(new Date,"yyyy-MM-dd"),onChange:ee=>{const oe=new Date(ee.target.value);let Ie=v.endDate;oe>Ie&&(Ie=oe),S({startDate:oe,endDate:Ie,key:"selection"}),R("Custom")}}),r.jsx("span",{className:"text-sm",children:"to"}),r.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:He(v.endDate,"yyyy-MM-dd"),max:He(new Date,"yyyy-MM-dd"),onChange:ee=>{const oe=new Date(ee.target.value);let Ie=v.startDate;oe<Ie&&(Ie=oe),S({startDate:Ie,endDate:oe,key:"selection"}),R("Custom")}})]}),r.jsx(Wm.DateRangePicker,{onChange:Re,months:n?1:2,ranges:B,direction:"horizontal",maxDate:new Date})]})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Report Type"}),r.jsxs("select",{className:"border rounded-md px-3 py-1.5 text-sm bg-white focus:ring-2 outline-none",style:{borderColor:"transparent"},value:E,onChange:ee=>te(ee.target.value),children:[r.jsx("option",{value:"basic",children:"Basic Report"}),r.jsx("option",{value:"log",children:"Attendance Log"}),r.jsx("option",{value:"monthly",children:"Monthly Report"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Employee"}),r.jsxs("select",{className:"border rounded-md px-3 py-1.5 text-sm bg-white focus:ring-2 outline-none max-w-[200px]",value:j,onChange:ee=>M(ee.target.value),children:[r.jsx("option",{value:"all",children:"All Employees"}),o.map(ee=>r.jsx("option",{value:ee.id,children:ee.name},ee.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Status"}),r.jsxs("select",{className:"border rounded-md px-3 py-1.5 text-sm bg-white focus:ring-2 outline-none max-w-[200px]",value:H,onChange:ee=>D(ee.target.value),children:[r.jsx("option",{value:"all",children:"All Status"}),r.jsx("option",{value:"Present",children:"Present"}),r.jsx("option",{value:"Half Day",children:"Half Day"}),r.jsx("option",{value:"Absent",children:"Absent"}),r.jsx("option",{value:"On Leave (Full)",children:"On Leave (Full)"}),r.jsx("option",{value:"On Leave (Half)",children:"On Leave (Half)"}),r.jsx("option",{value:"Holiday",children:"Holiday"}),r.jsx("option",{value:"Weekend",children:"Weekend"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Record Type"}),r.jsxs("select",{className:"border rounded-md px-3 py-1.5 text-sm bg-white focus:ring-2 outline-none max-w-[200px]",value:z,onChange:ee=>O(ee.target.value),children:[r.jsx("option",{value:"all",children:"All Records"}),r.jsx("option",{value:"complete",children:"Complete (Check-in & Check-out)"}),r.jsx("option",{value:"missing_checkout",children:"Missing Check-out"}),r.jsx("option",{value:"missing_checkin",children:"Missing Check-in"}),r.jsx("option",{value:"incomplete",children:"Incomplete (Any Missing)"})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r.jsx(ko,{title:"Total Employees",value:h?.totalEmployees||0,icon:Ni}),r.jsx(ko,{title:`Present ${Ye}`,value:h?.presentToday||0,icon:Sg}),r.jsx(ko,{title:`Absent ${Ye}`,value:h?.absentToday||0,icon:Of}),r.jsx(ko,{title:`On Leave ${Ye}`,value:h?.onLeaveToday||0,icon:jo})]}),r.jsxs("div",{className:"hidden md:grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx(RY,{title:"Attendance Trend",icon:j6,children:h&&r.jsx(Kde,{data:h.attendanceTrend})}),r.jsx(RY,{title:"Productivity Trend (Avg. Hours)",icon:V2,children:h&&r.jsx(Ode,{data:h.productivityTrend})})]}),r.jsx("div",{style:{position:"fixed",top:"0",left:"0",width:"1123px",zIndex:-1e3,opacity:0,pointerEvents:"none"},children:r.jsx("div",{ref:re,className:"w-full bg-white",children:nt})}),r.jsxs("div",{className:"hidden md:block bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-auto max-h-[600px]",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Report Preview"}),le&&r.jsxs(se,{type:"button",onClick:st,disabled:q,style:{backgroundColor:a.activeItemBg,color:"#FFFFFF",borderColor:a.sidebarBorder},className:"border hover:opacity-90 !text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[q?r.jsx(xt,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(gH,{className:"mr-2 h-4 w-4"}),q?"Generating...":"Download CSV"]})]}),r.jsx("div",{className:"border p-4 rounded bg-gray-50",children:nt})]}),U&&r.jsx(It,{message:U.message,type:U.type,onDismiss:()=>P(null)})]})},$de=n=>n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),ege=(n,e,t,s)=>{const a=n*Math.PI/180,o=t*Math.PI/180,l=(t-n)*Math.PI/180,c=(s-e)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},tge=()=>{const{user:n}=bt(),[e,t]=k.useState([]),[s,i]=k.useState([]),[a,o]=k.useState(!0),[l,c]=k.useState(!1),[d,h]=k.useState(null),[m,f]=k.useState(""),[p,b]=k.useState(""),[x,v]=k.useState(""),[S,B]=k.useState(""),[V,R]=k.useState(null),[W,_]=k.useState([]),[Y,j]=k.useState(!1),[M,H]=k.useState(""),D=n&&["admin","hr"].includes(n.role);k.useEffect(()=>{(async()=>{if(n)try{const[re,le]=await Promise.all([ce.getUserLocations(n.id),ce.getLocations()]);t(re),i(le)}catch(re){console.error(re),h({message:"Failed to load locations.",type:"error"})}finally{o(!1)}})()},[n]);const z=K=>{const re=K.target.value,le=$de(re);f(le)},O=async()=>{c(!0);try{const K=await vp().catch(()=>null);let re,le;if(K&&K.coords&&(re=K.coords.latitude,le=K.coords.longitude),re===void 0||le===void 0){const ue=await new Promise(ae=>{navigator.geolocation.getCurrentPosition(Ce=>ae(Ce),()=>ae(null),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});ue&&ue.coords&&(re=ue.coords.latitude,le=ue.coords.longitude)}if(re===void 0||le===void 0)throw new Error("Unable to retrieve current location.");b(re.toString()),v(le.toString());try{const ue=await wm(re,le);B(ue)}catch(ue){console.warn("Reverse geocode failed:",ue)}h({message:"Coordinates and address filled. Please enter a location name.",type:"success"})}catch(K){console.error(K),h({message:K.message||"Failed to get current location.",type:"error"})}finally{c(!1)}},E=async()=>{if(!n||W.length===0){h({message:"Please select at least one location.",type:"error"});return}j(!0);try{await Promise.all(W.map(re=>ce.assignLocationToUser(n.id,re))),h({message:"Locations assigned successfully!",type:"success"}),_([]);const K=await ce.getUserLocations(n.id);t(K)}catch(K){console.error(K),h({message:K.message||"Failed to assign locations.",type:"error"})}finally{j(!1)}},te=K=>{_(re=>re.includes(K)?re.filter(le=>le!==K):[...re,K])},q=async()=>{if(!n)return;if(!V&&!D){h({message:"You do not have permission to add locations.",type:"error"});return}if(!m.trim()){h({message:"Please enter a location name.",type:"error"});return}const K=parseFloat(p),re=parseFloat(x);if(isNaN(K)||isNaN(re)){h({message:"Please provide valid coordinates.",type:"error"});return}if(s.find(ue=>ue.id!==V&&ue.name?.toLowerCase()===m.toLowerCase())){h({message:`Location "${m}" already exists. Please use a different name.`,type:"error"});return}if(!V&&s.find(ae=>ege(K,re,ae.latitude,ae.longitude)<10)){h({message:"A location already exists at these coordinates.",type:"error"});return}c(!0);try{if(V)await ce.updateLocation(V,{name:m,latitude:K,longitude:re,radius:100,address:S||null}),h({message:"Location updated successfully.",type:"success"});else{const ie=await ce.createLocation({name:m,latitude:K,longitude:re,radius:100,address:S||null,createdBy:n.id});await ce.assignLocationToUser(n.id,ie.id),h({message:"Location added successfully.",type:"success"})}const[ae,Ce]=await Promise.all([ce.getUserLocations(n.id),ce.getLocations()]);t(ae),i(Ce),P()}catch(ue){console.error(ue),h({message:ue.message||"Failed to save location.",type:"error"})}finally{c(!1)}},de=K=>{R(K.id),f(K.name||""),b(K.latitude.toString()),v(K.longitude.toString()),B(K.address||""),window.scrollTo({top:0,behavior:"smooth"})},U=async K=>{if(!n||!D){h({message:"You do not have permission to delete locations.",type:"error"});return}if(window.confirm("Are you sure you want to delete this location? It will be removed from all users."))try{await ce.deleteLocation(K),h({message:"Location deleted successfully.",type:"success"});const[re,le]=await Promise.all([ce.getUserLocations(n.id),ce.getLocations()]);t(re),i(le)}catch(re){console.error(re),h({message:re.message||"Failed to delete location.",type:"error"})}},P=()=>{f(""),b(""),v(""),B(""),R(null)},ne=e.filter((K,re,le)=>K.address?re===le.findIndex(ue=>ue.address===K.address):!0);return r.jsxs("div",{className:"p-4 md:p-6 w-full",children:[d&&r.jsx(It,{message:d.message,type:d.type,onDismiss:()=>h(null)}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center",children:[r.jsx(Bi,{className:"h-6 w-6 mr-2"})," My Locations"]}),r.jsxs("p",{className:"text-muted mb-6",children:["These are the geofenced locations assigned to you. You may check in/out only when within one of these locations. ",D?"Use the form below to add a new location.":"You can edit location names by clicking the edit button."]}),(D||V)&&r.jsxs("div",{className:"bg-gray-50 border border-border rounded-lg p-4 mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:V?"Edit Location":"Add New Location"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r.jsx(be,{label:"Location Name (required) *",id:"locationName",value:m,onChange:z,placeholder:"e.g. Office HQ",required:!0}),r.jsx(be,{label:"Latitude",id:"latitude",type:"number",value:p,onChange:K=>b(K.target.value),placeholder:"12.9716",step:"any",disabled:V&&!D}),r.jsx(be,{label:"Longitude",id:"longitude",type:"number",value:x,onChange:K=>v(K.target.value),placeholder:"77.5946",step:"any",disabled:V&&!D}),r.jsx(be,{label:"Address (optional)",id:"address",value:S,onChange:K=>B(K.target.value),placeholder:"Street, City, State",disabled:V&&!D})]}),r.jsxs("div",{className:"flex gap-4 flex-wrap",children:[D&&r.jsxs(se,{onClick:O,variant:"secondary",isLoading:l,disabled:l,children:[r.jsx(pH,{className:"h-4 w-4 mr-2"})," Use Current Location"]}),r.jsx(se,{onClick:q,isLoading:l,disabled:l||!m.trim(),children:V?"Save Changes":"Add Location"}),V&&r.jsx(se,{onClick:P,variant:"secondary",children:"Cancel"})]})]})]}),r.jsx("div",{className:"mt-6",children:a?r.jsx("p",{children:"Loading locations..."}):e.length===0?r.jsx("div",{children:D?r.jsx("p",{className:"text-muted text-center md:text-left",children:"No locations assigned. Use the form above to add one."}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Select Your Locations"}),r.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"You don't have any locations assigned yet. Please select the locations where you'll be working from the list below."})]}),s.length===0?r.jsx("p",{className:"text-muted text-center",children:"No locations available. Contact your administrator."}):r.jsxs("div",{children:[r.jsx("div",{className:"mb-4",children:r.jsx(be,{type:"text",placeholder:"Search by name or address...",value:M,onChange:K=>H(K.target.value)})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:s.filter(K=>M===""||K.name?.toLowerCase().includes(M.toLowerCase())||K.address?.toLowerCase().includes(M.toLowerCase())).map(K=>r.jsx("div",{onClick:()=>te(K.id),className:`border rounded-lg p-4 cursor-pointer transition-all ${W.includes(K.id)?"border-accent bg-accent/10 shadow-md":"border-border hover:border-accent/50 hover:bg-gray-50"}`,children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("input",{type:"checkbox",checked:W.includes(K.id),onChange:()=>{},className:"mt-1 mr-3 h-5 w-5 text-accent rounded focus:ring-accent"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:K.name||"Unnamed Location"}),r.jsx("button",{type:"button",onClick:re=>{re.stopPropagation(),de(K)},className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit Name",children:r.jsx(ms,{className:"h-4 w-4"})})]}),r.jsx("p",{className:"text-sm text-muted mt-1",children:K.address||"No address"}),r.jsxs("p",{className:"text-xs text-muted mt-2",children:["Coordinates: ",K.latitude.toFixed(4),", ",K.longitude.toFixed(4),"  Radius: ",K.radius,"m"]})]})]})},K.id))}),r.jsx("div",{className:"flex justify-center",children:r.jsx(se,{onClick:E,isLoading:Y,disabled:Y||W.length===0,children:W.length===0?"Select Locations Above":`Assign ${W.length} Location${W.length>1?"s":""}`})})]})]})}):r.jsxs("div",{className:"space-y-4 md:space-y-0 md:grid md:grid-cols-1 md:gap-4",children:[r.jsx("div",{className:"md:hidden space-y-4",children:ne.map(K=>r.jsxs("div",{className:"bg-card rounded-lg shadow-card p-4 border border-border",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-bold text-primary-text",children:K.name||K.address||"Unnamed Location"}),r.jsx("p",{className:"text-sm text-muted",children:K.address})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"button",className:"text-blue-500 hover:text-blue-700 p-1",title:D?"Edit Location":"Edit Name",onClick:()=>de(K),children:r.jsx(ms,{className:"h-5 w-5"})}),D&&r.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-1",title:"Delete Location",onClick:()=>U(K.id),children:r.jsx(rn,{className:"h-5 w-5"})})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Radius"}),r.jsxs("p",{children:[K.radius,"m"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Coordinates"}),r.jsxs("p",{children:[K.latitude?.toFixed(4),", ",K.longitude?.toFixed(4)]})]})]})]},K.id))}),r.jsx("div",{className:"hidden md:block overflow-x-auto border border-border rounded-lg",children:r.jsxs("table",{className:"min-w-full border-collapse text-sm",children:[r.jsx("thead",{className:"bg-page text-primary-text",children:r.jsxs("tr",{children:[r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Name"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Radius (m)"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Coordinates"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Address"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Actions"})]})}),r.jsx("tbody",{children:ne.map(K=>r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-3",children:K.name||"-"}),r.jsx("td",{className:"p-3",children:K.radius}),r.jsxs("td",{className:"p-3",children:[K.latitude?.toFixed(4),", ",K.longitude?.toFixed(4)]}),r.jsx("td",{className:"p-3",children:K.address||"-"}),r.jsxs("td",{className:"p-3 flex gap-2",children:[r.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-800",title:D?"Edit Location":"Edit Name",onClick:()=>de(K),children:r.jsx(ms,{className:"h-4 w-4"})}),D&&r.jsx("button",{type:"button",className:"text-red-600 hover:text-red-800",title:"Delete Location",onClick:()=>U(K.id),children:r.jsx(rn,{className:"h-4 w-4"})})]})]},K.id))})]})})]})})]})},WY=()=>{const n=vt(),e=er(),{toggleCheckInStatus:t,isCheckedIn:s}=bt(),[i,a]=k.useState(!1),[o,l]=k.useState(null),c=e.pathname.includes("check-in"),d=c?"Check In":"Check Out",h=c?Kf:No,m=c?"bg-emerald-100":"bg-red-100",f=c?"text-emerald-600":"text-red-600",p=async()=>{a(!0);const{success:x,message:v}=await t();l({message:v,type:x?"success":"error"}),a(!1),x&&setTimeout(()=>{n("/profile",{replace:!0})},1500)},b=()=>{n(-1)};return r.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 relative",children:[o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)}),r.jsxs("div",{className:"w-full max-w-md bg-card rounded-2xl shadow-card p-8 text-center relative z-10",children:[r.jsx("div",{className:"flex justify-center mb-6",children:r.jsx("div",{className:`p-4 rounded-full ${m}`,children:r.jsx(h,{className:`h-10 w-10 ${f}`})})}),r.jsx("h1",{className:"text-2xl font-bold text-primary-text mb-2",children:d}),r.jsxs("p",{className:"text-muted mb-8",children:["Are you sure you want to ",d.toLowerCase(),"?"]}),r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs(se,{onClick:p,variant:c?"primary":"danger",className:"w-full !py-3 !text-lg shadow-lg",isLoading:i,children:["Yes, ",d]}),r.jsx(se,{onClick:b,variant:"secondary",className:"w-full !py-3",disabled:i,children:"Cancel"})]})]})]})},nge=()=>{const{attendance:n,officeHolidays:e,fieldHolidays:t,recurringHolidays:s,addHoliday:i,removeHoliday:a,addRecurringHoliday:o,removeRecurringHoliday:l,updateAttendanceSettings:c}=wi(),d={minimumHoursFullDay:8,minimumHoursHalfDay:4,annualEarnedLeaves:5,annualSickLeaves:12,monthlyFloatingLeaves:1,annualCompOffLeaves:5,enableAttendanceNotifications:!1,sickLeaveCertificateThreshold:2},h={office:{...d,...n?.office},field:{...d,...n?.field}},[m,f]=k.useState(h),[p,b]=k.useState(!1),[x,v]=k.useState(!1),[S,B]=k.useState("office"),[V,R]=k.useState(""),[W,_]=k.useState(""),[Y,j]=k.useState(3),[M,H]=k.useState("Saturday"),[D,z]=k.useState(null);k.useEffect(()=>{f({office:{...d,...n?.office},field:{...d,...n?.field}})},[n]),k.useEffect(()=>{b(JSON.stringify(m)!==JSON.stringify(n))},[m,n]);const O=m[S],E=S==="office"?e:t,te=async U=>{if(U.preventDefault(),V&&W){if(E.some(P=>P.date===W)){z({message:"A holiday for this date already exists.",type:"error"});return}try{await i(S,{name:V,date:W}),R(""),_(""),z({message:"Holiday added successfully.",type:"success"})}catch{z({message:"Failed to add holiday.",type:"error"})}}else z({message:"Please provide both a name and a date.",type:"error"})},q=(U,P)=>{f(ne=>({...ne,[S]:{...ne[S],[U]:P}}))},de=async()=>{v(!0);try{await ce.saveAttendanceSettings(m),c(m),z({message:"Attendance rules saved successfully!",type:"success"})}catch{z({message:"Failed to save attendance rules.",type:"error"})}finally{v(!1)}};return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full pb-40",children:[D&&r.jsx(It,{message:D.message,type:D.type,onDismiss:()=>z(null)}),r.jsx(ma,{title:"Attendance & Leave Rules",children:r.jsxs(se,{onClick:de,isLoading:x,disabled:!p,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Rules"]})}),r.jsx("p",{className:"text-muted -mt-4 mb-6",children:"Set company-wide rules for attendance and leave calculation."}),r.jsx("div",{className:"mb-6 border-b border-border",children:r.jsxs("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:[r.jsx("button",{onClick:()=>B("office"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${S==="office"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Office Staff"}),r.jsx("button",{onClick:()=>B("field"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${S==="field"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-accent-dark hover:border-accent"}`,children:"Field Staff"})]})}),S==="office"&&r.jsx("p",{className:"text-sm text-white -mt-4 mb-4",children:"These rules apply to Admin, HR, and Finance roles."}),S==="field"&&r.jsx("p",{className:"text-sm text-white -mt-4 mb-4",children:"These rules apply to all other roles (e.g., Field Officers, Managers)."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("section",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(jo,{className:"mr-2 h-5 w-5 text-muted"}),"Work Hours"]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[r.jsx(be,{label:"Minimum Hours for Full Day",id:"minHoursFull",type:"number",value:O.minimumHoursFullDay,onChange:U=>q("minimumHoursFullDay",parseFloat(U.target.value)||0)}),r.jsx(be,{label:"Minimum Hours for Half Day",id:"minHoursHalf",type:"number",value:O.minimumHoursHalfDay,onChange:U=>q("minimumHoursHalfDay",parseFloat(U.target.value)||0)})]})]}),r.jsxs("section",{className:"pt-6 border-t border-border",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(Pf,{className:"mr-2 h-5 w-5 text-muted"}),"Leave Allocation"]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsx(be,{label:"Annual Earned Leaves",id:"annualEarnedLeaves",type:"number",value:O.annualEarnedLeaves,onChange:U=>q("annualEarnedLeaves",parseInt(U.target.value,10)||0)}),r.jsx(be,{label:"Annual Sick Leaves",id:"annualSickLeaves",type:"number",value:O.annualSickLeaves,onChange:U=>q("annualSickLeaves",parseInt(U.target.value,10)||0)}),r.jsx(be,{label:"Monthly Floating Holidays",id:"monthlyFloatingLeaves",type:"number",value:O.monthlyFloatingLeaves,onChange:U=>q("monthlyFloatingLeaves",parseInt(U.target.value,10)||0)}),r.jsx(be,{label:"Annual Compensatory Off",id:"annualCompOffLeaves",type:"number",value:O.annualCompOffLeaves,onChange:U=>q("annualCompOffLeaves",parseInt(U.target.value,10)||0)}),r.jsx(be,{label:"Sick Leave Cert. After (Days)",id:"sickLeaveCertThreshold",type:"number",value:O.sickLeaveCertificateThreshold,onChange:U=>q("sickLeaveCertificateThreshold",parseInt(U.target.value,10)||0),title:"Require a doctor's certificate if total sick leave taken exceeds this number of days."})]})]}),r.jsxs("section",{className:"pt-6 border-t border-border",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(Mu,{className:"mr-2 h-5 w-5 text-muted"}),"Notifications"]}),r.jsx(Nn,{id:"attendance-notifications",label:"Enable Check-in/Check-out Notifications",description:"Send a notification to Site Managers, Ops Managers, and HR when a Field Officer checks in or out.",checked:O.enableAttendanceNotifications,onChange:U=>q("enableAttendanceNotifications",U.target.checked)})]}),r.jsxs("section",{className:"pt-6 border-t border-border",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(ra,{className:"mr-2 h-5 w-5 text-muted"}),"Recurring Holidays"]}),r.jsxs("div",{className:"p-4 bg-page rounded-lg",children:[r.jsx("h4",{className:"font-semibold mb-2",children:"Add Recurring Holiday"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[r.jsxs(Oe,{label:"Occurrence",value:Y,onChange:U=>j(parseInt(U.target.value)),children:[r.jsx("option",{value:1,children:"1st"}),r.jsx("option",{value:2,children:"2nd"}),r.jsx("option",{value:3,children:"3rd"}),r.jsx("option",{value:4,children:"4th"}),r.jsx("option",{value:5,children:"5th"})]}),r.jsxs(Oe,{label:"Day",value:M,onChange:U=>H(U.target.value),children:[r.jsx("option",{value:"Monday",children:"Monday"}),r.jsx("option",{value:"Tuesday",children:"Tuesday"}),r.jsx("option",{value:"Wednesday",children:"Wednesday"}),r.jsx("option",{value:"Thursday",children:"Thursday"}),r.jsx("option",{value:"Friday",children:"Friday"}),r.jsx("option",{value:"Saturday",children:"Saturday"}),r.jsx("option",{value:"Sunday",children:"Sunday"})]}),r.jsxs(se,{type:"button",onClick:async()=>{try{await o({day:M,n:Y,type:S}),z({message:"Recurring holiday added successfully.",type:"success"})}catch{z({message:"Failed to add recurring holiday.",type:"error"})}},size:"sm",className:"w-full sm:w-auto",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Rule"]})]})]}),r.jsxs("div",{className:"mt-4 space-y-2",children:[s.filter(U=>(U.type||"office")===S).map((U,P)=>r.jsxs("div",{className:"flex justify-between items-start p-4 pr-6 border border-white/10 rounded-lg bg-white/5 mb-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("p",{className:"font-medium text-primary-text truncate",children:[U.n===1?"1st":U.n===2?"2nd":U.n===3?"3rd":U.n+"th"," ",U.day]}),r.jsx("p",{className:"text-sm text-muted",children:"Repeats every month"})]}),r.jsx("div",{className:"ml-4 shrink-0",children:r.jsx(se,{variant:"icon",onClick:async()=>{if(U.id)try{await l(U.id),z({message:"Recurring holiday removed successfully.",type:"success"})}catch{z({message:"Failed to remove recurring holiday.",type:"error"})}},className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})})]},U.id||P)),s.filter(U=>(U.type||"office")===S).length===0&&r.jsx("p",{className:"text-center text-muted py-4",children:"No recurring holidays configured."})]})]}),r.jsxs("section",{className:"pt-6 border-t border-border",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(ra,{className:"mr-2 h-5 w-5 text-muted"}),"Holiday List"]}),r.jsxs("div",{className:"p-4 bg-page rounded-lg",children:[r.jsx("h4",{className:"font-semibold mb-2",children:"Add New Holiday"}),r.jsxs("form",{onSubmit:te,className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-end",children:[r.jsx(be,{label:"Holiday Name",id:"holidayName",value:V,onChange:U=>R(U.target.value)}),r.jsx(Vn,{label:"Date",id:"holidayDate",value:W,onChange:_}),r.jsxs(se,{type:"submit",size:"sm",className:"w-full sm:w-auto",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add"]})]})]}),r.jsx("div",{className:"mt-4 space-y-2",children:E.length>0?E.map(U=>r.jsxs("div",{className:"flex justify-between items-start p-4 pr-6 border border-white/10 rounded-lg bg-white/5 mb-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-medium text-primary-text truncate",children:U.name}),r.jsx("p",{className:"text-sm text-muted",children:new Date(U.date.replace(/-/g,"/")).toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})})]}),r.jsx("div",{className:"ml-4 shrink-0",children:r.jsx(se,{variant:"icon",onClick:()=>a(S,U.id),"aria-label":`Remove ${U.name}`,className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})})]},U.id)):r.jsxs("p",{className:"text-center text-muted py-4",children:["No holidays added yet for ",S," staff."]})})]})]})]})},sge=()=>{const{user:n}=bt(),{officeHolidays:e,fieldHolidays:t,attendance:s,recurringHolidays:i}=wi(),[a,o]=k.useState(new Date),[l,c]=k.useState([]),[d,h]=k.useState(!1),m=k.useMemo(()=>n?.role==="field_officer"?t:e,[n,t,e]),f=k.useMemo(()=>{const V=n?.role==="field_officer"?"field":"office";return i.filter(R=>(R.type||"office")===V)},[n,i]);k.useEffect(()=>{console.log("Active Recurring Rules:",f)},[f]);const p=k.useMemo(()=>{const V=[],R=Si(a),W=Ha(a),_=wo({start:R,end:W}),Y=(n?.role==="field_officer"?s?.field?.monthlyFloatingLeaves:s?.office?.monthlyFloatingLeaves)??0;let j=0;return f.forEach(M=>{if(j>=Y)return;let H=0;for(const D of _)if(He(D,"EEEE").toLowerCase()===M.day.toLowerCase()&&(H++,H===M.n)){V.push(D),j++;break}}),V},[a,f,s,n]);k.useEffect(()=>{console.log("Calculated Recurring Holiday Dates:",p)},[p]),k.useEffect(()=>{const V=async()=>{if(n){h(!0);try{const _=Si(a).toISOString(),Y=Ha(a).toISOString(),j=await ce.getAttendanceEvents(n.id,_,Y);c(j)}catch(_){console.error("Failed to fetch attendance events",_)}finally{h(!1)}}},R=async()=>{try{console.log("Fetching attendance settings...");const _=await ce.getAttendanceSettings();console.log("Fetched settings:",_),wi.getState().updateAttendanceSettings(_)}catch(_){console.error("Failed to fetch attendance settings",_)}},W=async()=>{try{console.log("Fetching recurring holidays...");const _=await ce.getRecurringHolidays();console.log("Fetched recurring holidays:",_),wi.setState({recurringHolidays:_})}catch(_){console.error("Failed to fetch recurring holidays",_)}};V(),R(),W()},[n,a]);const b=k.useMemo(()=>wo({start:Si(a),end:Ha(a)}),[a]),x=V=>{const R=l.some(j=>vu(new Date(j.timestamp),V)&&(j.type.toLowerCase().includes("check")||j.type.toLowerCase().includes("in"))),W=p.some(j=>vu(j,V)),_=m.some(j=>vu(new Date(j.date),V));return(W||_)&&R?"holiday-present":W?"floating-holiday":_?"holiday":R?"present":lK($c(new Date),$c(V))?"absent":"neutral"},v=V=>{switch(V){case"present":return"bg-emerald-500 text-white border-emerald-600 shadow-sm";case"absent":return"bg-rose-500 text-white border-rose-600 shadow-sm";case"holiday":return"bg-red-600 text-white border-red-700 shadow-sm";case"floating-holiday":return"bg-amber-500 text-white border-amber-600 shadow-sm";case"holiday-present":return"bg-violet-600 text-white border-violet-700 shadow-sm";default:return"bg-gray-50 text-gray-400 border-gray-100"}},S=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],B=tG(Si(a));return r.jsxs("div",{className:"md:bg-card md:p-3 md:rounded-xl md:shadow-card border-none bg-transparent p-3 rounded-xl shadow-none w-full md:w-full md:max-w-[320px]",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"Attendance Calendar"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>o(rG(a)),children:r.jsx(xp,{className:"h-3 w-3"})}),r.jsx("span",{className:"font-medium min-w-[80px] text-center text-sm",children:He(a,"MMMM yyyy")}),r.jsx(se,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>o(Cp(a,1)),children:r.jsx(Hu,{className:"h-3 w-3"})})]})]}),d?r.jsx("div",{className:"flex justify-center py-5",children:r.jsx(xt,{className:"h-5 w-5 animate-spin text-muted"})}):r.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[S.map(V=>r.jsx("div",{className:"text-center text-xs font-medium text-muted py-1",children:V},V)),Array.from({length:B}).map((V,R)=>r.jsx("div",{className:"aspect-square"},`empty-${R}`)),b.map(V=>{const R=x(V),W=v(R);return r.jsx("div",{className:`aspect-square rounded border flex flex-col items-center justify-center ${W} transition-colors`,children:r.jsx("span",{className:"text-sm font-semibold",children:He(V,"d")})},V.toISOString())})]}),r.jsxs("div",{className:"mt-3 flex gap-3 text-xs text-muted justify-center flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-emerald-500 border border-emerald-600 rounded-sm"})," Present"]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-rose-500 border border-rose-600 rounded-sm"})," Absent"]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-red-600 border border-red-700 rounded-sm"})," Holiday"]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-amber-500 border border-amber-600 rounded-sm"})," Floating Holiday"]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 bg-violet-600 border border-violet-700 rounded-sm"})," Holiday Present"]})]})]})},rge=({logs:n,isLoading:e=!1})=>{const{colorScheme:t}=an(),s=Is(t),[i,a]=k.useState(new Date),o=k.useMemo(()=>wo({start:Si(i),end:Ha(i)}),[i]),l=m=>n.some(p=>{const b=new Date(p.dateEarned.replace(/-/g,"/"));return vu(b,m)})?"earned":"neutral",c=m=>{switch(m){case"earned":return{backgroundColor:s.activeItemBg,color:"white",borderColor:s.sidebarBorder};default:return{backgroundColor:"#f9fafb",color:"#9ca3af",borderColor:"#f3f4f6"}}},d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=tG(Si(i));return r.jsxs("div",{className:"md:bg-card md:p-3 md:rounded-xl md:shadow-card border-none bg-transparent p-3 rounded-xl shadow-none w-full md:w-full md:max-w-[320px]",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"Comp Off Tracker"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>a(rG(i)),children:r.jsx(xp,{className:"h-3 w-3"})}),r.jsx("span",{className:"font-medium min-w-[80px] text-center text-sm",children:He(i,"MMMM yyyy")}),r.jsx(se,{variant:"secondary",size:"sm",className:"btn-icon !p-1 h-6 w-6",onClick:()=>a(Cp(i,1)),children:r.jsx(Hu,{className:"h-3 w-3"})})]})]}),e?r.jsx("div",{className:"flex justify-center py-5",children:r.jsx(xt,{className:"h-5 w-5 animate-spin text-muted"})}):r.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[d.map(m=>r.jsx("div",{className:"text-center text-xs font-medium text-muted py-1",children:m},m)),Array.from({length:h}).map((m,f)=>r.jsx("div",{className:"aspect-square"},`empty-${f}`)),o.map(m=>{const f=l(m),p=c(f);return r.jsx("div",{className:"aspect-square rounded border flex flex-col items-center justify-center transition-colors",style:p,children:r.jsx("span",{className:"text-sm font-semibold",children:He(m,"d")})},m.toISOString())})]}),r.jsx("div",{className:"mt-3 flex gap-3 text-xs text-muted justify-center",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 border rounded-sm",style:{backgroundColor:s.activeItemBg,borderColor:s.sidebarBorder}})," Comp Off Earned"]})})]})},ige=()=>{const{colorScheme:n}=an(),e=Is(n),{user:t}=bt(),[s,i]=k.useState(new Date),[a,o]=k.useState([]),[l,c]=k.useState(!1);k.useEffect(()=>{(async()=>{if(t){c(!0);try{const b=Si(s).toISOString(),x=Ha(s).toISOString(),v=await ce.getAttendanceEvents(t.id,b,x);o(v)}catch(b){console.error("Failed to fetch attendance events",b)}finally{c(!1)}}})()},[t,s]);const d=k.useMemo(()=>wo({start:Si(s),end:Ha(s)}),[s]),h=p=>{const b=a.filter(R=>vu(new Date(R.timestamp),p));if(b.length===0)return 0;const x=[...b].sort((R,W)=>new Date(R.timestamp).getTime()-new Date(W.timestamp).getTime());let v=0,S=null;x.forEach(R=>{const W=new Date(R.timestamp);R.type==="check-in"?S=W:R.type==="check-out"&&S&&(v+=Uc(W,S),S=null)});const B=v/60,V=Math.max(0,B-8);return parseFloat(V.toFixed(1))},m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],f=tG(Si(s));return r.jsxs("div",{className:"md:bg-card md:p-3 md:rounded-xl md:shadow-card border-0 bg-transparent p-3 rounded-xl shadow-none w-full",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h3",{className:"text-sm font-semibold text-primary-text",children:"OT Calendar"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"secondary",size:"sm",className:"!p-1 h-6 w-6",onClick:()=>i(rG(s)),children:r.jsx(xp,{className:"h-3 w-3"})}),r.jsx("span",{className:"font-medium min-w-[80px] text-center text-xs",children:He(s,"MMMM yyyy")}),r.jsx(se,{variant:"secondary",size:"sm",className:"!p-1 h-6 w-6",onClick:()=>i(Cp(s,1)),children:r.jsx(Hu,{className:"h-3 w-3"})})]})]}),l?r.jsx("div",{className:"flex justify-center py-5",children:r.jsx(xt,{className:"h-5 w-5 animate-spin text-muted"})}):r.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[m.map(p=>r.jsx("div",{className:"text-center text-[10px] font-medium text-muted py-1",children:p},p)),Array.from({length:f}).map((p,b)=>r.jsx("div",{className:"aspect-square"},`empty-${b}`)),d.map(p=>{const b=h(p),x=b>0;return r.jsxs("div",{className:"aspect-square rounded border flex flex-col items-center justify-center transition-colors",style:x?{backgroundColor:e.activeItemBg,color:"white",borderColor:e.sidebarBorder}:{backgroundColor:"#f9fafb",color:"#9ca3af",borderColor:"#f3f4f6"},children:[r.jsx("span",{className:"text-xs font-semibold",children:He(p,"d")}),x&&r.jsxs("span",{className:"text-[8px] font-bold",children:["+",b,"h"]})]},p.toISOString())})]}),r.jsx("div",{className:"mt-3 flex gap-3 text-[10px] text-muted justify-center flex-wrap",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-2 h-2 border rounded-sm",style:{backgroundColor:e.activeItemBg,borderColor:e.sidebarBorder}})," Overtime (>8h)"]})})]})},age=()=>{const{user:n}=bt(),[e,t]=k.useState([]),[s,i]=k.useState(!0),[a,o]=k.useState("day"),[l,c]=k.useState(new Date),[d,h]=k.useState({});jt("(max-width: 767px)");const m=async()=>{if(n){i(!0);try{let S,B;switch(a){case"day":S=$c(l),B=qZ(l);break;case"week":S=Vo(l,{weekStartsOn:1}),B=Kk(l,{weekStartsOn:1});break;case"month":S=Si(l),B=Ha(l);break}const V=await ce.getAttendanceEvents(n.id,S.toISOString(),B.toISOString());t(V);const R=V.filter(W=>W.latitude&&W.longitude).map(W=>({lat:W.latitude,lon:W.longitude}));if(R.length>0)try{const W=await ce.batchResolveAddresses(R);h(W)}catch(W){console.error("Failed to fetch location addresses:",W)}}catch(S){console.error("Failed to fetch attendance events:",S)}finally{i(!1)}}};k.useEffect(()=>{m()},[n,a,l]);const f=k.useMemo(()=>{const S={};return e.forEach(B=>{const V=He(new Date(B.timestamp),"yyyy-MM-dd");S[V]||(S[V]={date:V,events:[],checkIns:[],checkOuts:[],totalMinutes:0}),S[V].events.push(B),B.type==="check-in"?S[V].checkIns.push(B):B.type==="check-out"&&S[V].checkOuts.push(B)}),Object.values(S).forEach(B=>{const V=[...B.events].sort((_,Y)=>new Date(_.timestamp).getTime()-new Date(Y.timestamp).getTime());let R=0,W=null;V.forEach(_=>{const Y=new Date(_.timestamp);_.type==="check-in"?W=Y:_.type==="check-out"&&W&&(R+=Uc(Y,W),W=null)}),B.totalMinutes=R}),Object.values(S).sort((B,V)=>V.date.localeCompare(B.date))},[e]),p=S=>{const B=Math.floor(S/60),V=S%60;return`${B}h ${V}m`},b=S=>{o(S)},x=S=>{const B=new Date(l);switch(a){case"day":B.setDate(B.getDate()+(S==="next"?1:-1));break;case"week":B.setDate(B.getDate()+(S==="next"?7:-7));break;case"month":B.setMonth(B.getMonth()+(S==="next"?1:-1));break}c(B)},v=()=>{switch(a){case"day":return He(l,"dd MMM, yyyy");case"week":const S=Vo(l,{weekStartsOn:1}),B=Kk(l,{weekStartsOn:1});return`${He(S,"dd MMM")} - ${He(B,"dd MMM, yyyy")}`;case"month":return He(l,"MMMM yyyy")}};return n?r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[r.jsx("div",{className:"p-1.5 bg-indigo-50 rounded-lg",children:r.jsx(jo,{className:"h-5 w-5 text-indigo-600"})}),r.jsx("h3",{className:"text-lg md:text-xl font-bold text-gray-900",children:"Employee Log"})]}),r.jsxs("div",{className:"mb-6 space-y-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>b("day"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${a==="day"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Day"}),r.jsx("button",{onClick:()=>b("week"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${a==="week"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Week"}),r.jsx("button",{onClick:()=>b("month"),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${a==="month"?"bg-indigo-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Month"})]}),r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-3",children:[r.jsx("button",{onClick:()=>x("prev"),className:"px-3 py-1 bg-white rounded-md shadow-sm hover:bg-gray-100 transition-colors",children:""}),r.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-900",children:[r.jsx(ra,{className:"h-4 w-4"}),r.jsx("span",{children:v()})]}),r.jsx("button",{onClick:()=>x("next"),className:"px-3 py-1 bg-white rounded-md shadow-sm hover:bg-gray-100 transition-colors",children:""})]})]}),r.jsx("div",{className:"space-y-4",children:s?r.jsx("div",{className:"flex items-center justify-center py-10",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-indigo-600"})}):f.length===0?r.jsxs("div",{className:"text-center py-10 text-gray-500",children:[r.jsx(ra,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),r.jsx("p",{className:"font-medium",children:"No attendance records found"}),r.jsx("p",{className:"text-sm mt-1",children:"Check-in to start tracking your attendance"})]}):f.map(S=>r.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-200 overflow-hidden",children:[r.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-500 px-4 py-3 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center gap-2 text-white",children:[r.jsx(ra,{className:"h-4 w-4"}),r.jsx("span",{className:"font-semibold",children:He(new Date(S.date),"EEEE, dd MMMM yyyy")})]}),r.jsx("div",{className:"text-white text-sm font-medium bg-white/20 px-3 py-1 rounded-full",children:p(S.totalMinutes)})]}),r.jsx("div",{className:"p-4 space-y-3",children:S.events.sort((B,V)=>new Date(B.timestamp).getTime()-new Date(V.timestamp).getTime()).map((B,V)=>r.jsx("div",{className:`p-3 rounded-lg border-l-4 ${B.type==="check-in"?"bg-emerald-50 border-emerald-500":"bg-rose-50 border-rose-500"}`,children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${B.type==="check-in"?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:r.jsx(jo,{className:"h-4 w-4"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-semibold text-gray-900 capitalize",children:B.type.replace("-"," ")}),r.jsx("div",{className:"text-sm text-gray-600",children:He(new Date(B.timestamp),"hh:mm a")})]})]}),B.latitude&&B.longitude&&r.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 bg-white px-3 py-1.5 rounded-lg border border-gray-200 max-w-md",children:[r.jsx(Bi,{className:"h-4 w-4 text-indigo-600 flex-shrink-0 mt-0.5"}),r.jsx("span",{className:"text-xs break-words",children:d[`${B.latitude.toFixed(6)},${B.longitude.toFixed(6)}`]||`${B.latitude.toFixed(4)}, ${B.longitude.toFixed(4)}`})]})]})},`${B.timestamp}-${V}`))}),r.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Check-ins:"}),r.jsx("span",{className:"ml-2 font-semibold text-emerald-600",children:S.checkIns.length})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Check-outs:"}),r.jsx("span",{className:"ml-2 font-semibold text-rose-600",children:S.checkOuts.length})]})]})})]},S.date))})]}):null},VY=({title:n,value:e,icon:t})=>r.jsxs("div",{className:"bg-card p-3 md:p-4 rounded-xl flex flex-col md:flex-row items-center md:items-center gap-2 md:gap-4 border border-border text-center md:text-left w-full",children:[r.jsx("div",{className:"bg-accent-light p-2 md:p-3 rounded-full flex-shrink-0",children:r.jsx(t,{className:"h-5 w-5 md:h-6 md:w-6 text-accent-dark"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-xs md:text-sm text-muted font-medium",children:n}),r.jsx("p",{className:"text-lg md:text-2xl font-bold text-primary-text",children:e})]})]}),oge=({status:n})=>{const e={pending_manager_approval:"leave-status-chip--pending_manager_approval",pending_hr_confirmation:"leave-status-chip--pending_hr_confirmation",approved:"leave-status-chip--approved",rejected:"leave-status-chip--rejected"},t=n.replace(/_/g," ");return r.jsx("span",{className:`leave-status-chip ${e[n]}`,children:t})},lge=n=>Bt({leaveType:pe().oneOf(["Earned","Sick","Floating","Comp Off"]).required("Leave type is required"),startDate:pe().required("Start date is required"),endDate:pe().required("End date is required").test("is-after-start","End date must be on or after start date",function(e){const{startDate:t}=this.parent;return!t||!e?!0:new Date(e.replace(/-/g,"/"))>=new Date(t.replace(/-/g,"/"))}),reason:pe().required("A reason for the leave is required").min(10,"Please provide a more detailed reason."),dayOption:pe().oneOf(["full","half"]).optional(),doctorCertificate:Et().when(["leaveType","startDate","endDate"],{is:(e,t,s)=>e!=="Sick"||!t||!s?!1:Tm(new Date(s.replace(/-/g,"/")),new Date(t.replace(/-/g,"/")))+1>n,then:e=>e.required(`A doctor's certificate is required for sick leave longer than ${n} days.`),otherwise:e=>e.nullable().optional()})}),cge=({isOpen:n,onClose:e,onSuccess:t,user:s,isMobile:i,setToast:a})=>{const{attendance:{office:{sickLeaveCertificateThreshold:o}}}=wi(),l=k.useMemo(()=>lge(o),[o]),{register:c,control:d,handleSubmit:h,watch:m,formState:{errors:f},reset:p}=tn({resolver:Yn(l),defaultValues:{leaveType:"Earned",startDate:He(new Date,"yyyy-MM-dd"),endDate:He(new Date,"yyyy-MM-dd"),dayOption:"full"}}),b=m("startDate"),x=m("endDate"),v=m("leaveType"),B=k.useMemo(()=>!b||!x?!1:vu(new Date(b.replace(/-/g,"/")),new Date(x.replace(/-/g,"/"))),[b,x])&&v==="Earned",V=k.useMemo(()=>v!=="Sick"||!b||!x?!1:Tm(new Date(x.replace(/-/g,"/")),new Date(b.replace(/-/g,"/")))+1>o,[v,b,x,o]),R=async W=>{try{await ce.submitLeaveRequest({...W,userId:s.id,userName:s.name}),t()}catch{a({message:"Failed to submit leave request.",type:"error"})}};return n?r.jsx("div",{className:`fixed inset-0 z-40 bg-card ${i?"flex flex-col":"flex items-center justify-center bg-black/50 p-4"}`,children:r.jsxs("div",{className:`w-full ${i?"flex flex-col h-full":"max-w-2xl bg-card rounded-xl shadow-lg"}`,children:[r.jsxs("header",{className:`p-4 flex-shrink-0 flex items-center gap-4 ${i?"fo-mobile-header":"border-b"}`,children:[r.jsx(se,{variant:"icon",onClick:e,"aria-label":"Go back",children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsx("h1",{className:"text-lg font-semibold",children:i?"New Leave Request":"Submit a New Leave Request"})]}),r.jsxs("form",{id:"leave-form",onSubmit:h(R),className:"flex-grow overflow-y-auto p-4 space-y-4",children:[r.jsx(ye,{name:"leaveType",control:d,render:({field:W})=>r.jsxs(Oe,{label:"Leave Type",...W,error:f.leaveType?.message,className:i?"pro-select pro-select-arrow":"",children:[r.jsx("option",{children:"Earned"}),r.jsx("option",{children:"Sick"}),r.jsx("option",{children:"Floating"}),r.jsx("option",{children:"Comp Off"})]})}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(ye,{name:"startDate",control:d,render:({field:W})=>r.jsx(Vn,{label:"Start Date",id:"startDate",value:W.value,onChange:W.onChange,error:f.startDate?.message})}),r.jsx(ye,{name:"endDate",control:d,render:({field:W})=>r.jsx(Vn,{label:"End Date",id:"endDate",value:W.value,onChange:W.onChange,error:f.endDate?.message})})]}),B&&r.jsx(ye,{name:"dayOption",control:d,render:({field:W})=>r.jsxs(Oe,{label:"Day Option",...W,className:i?"pro-select pro-select-arrow":"",children:[r.jsx("option",{value:"full",children:"Full Day"}),r.jsx("option",{value:"half",children:"Half Day"})]})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted",children:"Reason"}),r.jsx("textarea",{...c("reason"),rows:4,className:`mt-1 form-input ${f.reason?"form-input--error":""}`}),f.reason&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:f.reason.message})]}),V&&r.jsx(ye,{name:"doctorCertificate",control:d,render:({field:W,fieldState:_})=>r.jsx(pt,{label:"Doctor's Certificate (Required)",file:W.value,onFileChange:W.onChange,error:_.error?.message,allowCapture:!0})})]}),r.jsxs("footer",{className:`p-4 flex-shrink-0 flex items-center justify-end gap-2 ${i?"":"border-t"}`,children:[r.jsx(se,{type:"button",variant:"secondary",onClick:e,children:"Cancel"}),r.jsx(se,{type:"submit",form:"leave-form",children:"Submit Request"})]})]})}):null},dge=()=>{const{user:n}=bt(),[e,t]=k.useState(null),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState(!0),[d,h]=k.useState(!1),[m,f]=k.useState("all"),[p,b]=k.useState(null),x=jt("(max-width: 767px)"),[v,S]=k.useState(!1),[B,V]=k.useState(0),R=k.useCallback(async()=>{if(n){c(!0),h(!1);try{const[M,H,D]=await Promise.all([ce.getLeaveBalancesForUser(n.id),ce.getLeaveRequests({userId:n.id,status:m==="all"?void 0:m}),ce.getCompOffLogs(n.id).catch(z=>{if(z&&z.message&&(z.message.includes("comp_off_logs")||z.message.includes('relation "public.comp_off_logs" does not exist')))return h(!0),[];throw z})]);if(t(M),i(H),o(D),n.role==="field_officer"){const z=new Date,O=Si(z).toISOString(),E=Ha(z).toISOString(),te=await ce.getAttendanceEvents(n.id,O,E),q={};te.forEach(U=>{const P=He(new Date(U.timestamp),"yyyy-MM-dd");q[P]||(q[P]=[]),q[P].push(U)});let de=0;Object.values(q).forEach(U=>{const P=[...U].sort((le,ue)=>new Date(le.timestamp).getTime()-new Date(ue.timestamp).getTime());let ne=0,K=null;P.forEach(le=>{const ue=new Date(le.timestamp);le.type==="check-in"?K=ue:le.type==="check-out"&&K&&(ne+=Uc(ue,K),K=null)});const re=ne/60;re>8&&(de+=re-8)}),V(parseFloat(de.toFixed(1)))}}catch(M){let H="Failed to load leave data.";M&&typeof M.message=="string"&&M.message.includes('relation "leave_requests" does not exist')&&(H='Database setup error: The "leave_requests" table is missing.'),console.error("Failed to load leave data",M),d||b({message:H,type:"error"})}finally{c(!1)}}},[n,m]);k.useEffect(()=>{R()},[R]);const W=()=>{b({message:"Leave request submitted successfully!",type:"success"}),S(!1),R()},_=M=>M.replace(/_/g," ").replace(/\b\w/g,H=>H.toUpperCase()),Y=["all","pending_manager_approval","pending_hr_confirmation","approved","rejected"],j=e?[{title:"Earned Leave",value:`${e.earnedTotal-e.earnedUsed} / ${e.earnedTotal}`,icon:lH},{title:"Sick Leave",value:`${e.sickTotal-e.sickUsed} / ${e.sickTotal}`,icon:hG},{title:"Floating Holiday",value:`${e.floatingTotal-e.floatingUsed} / ${e.floatingTotal}`,icon:C$},{title:"Compensatory Off",value:`${e.compOffTotal-e.compOffUsed} / ${e.compOffTotal}`,icon:H6}]:[];return r.jsxs("div",{className:"p-4 space-y-6",children:[p&&r.jsx(It,{message:p.message,type:p.type,onDismiss:()=>b(null)}),n&&r.jsx(cge,{isOpen:v,onClose:()=>S(!1),onSuccess:W,user:n,isMobile:x,setToast:b}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"My Leave Requests"}),!x&&r.jsxs(se,{onClick:()=>S(!0),children:[r.jsx(Tt,{className:"mr-2 h-4"})," New Request"]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-6 justify-items-center md:justify-items-start",children:[j.map(M=>r.jsx(VY,{...M},M.title)),n?.role==="field_officer"&&r.jsx(VY,{title:"Overtime Hours",value:`${B} hrs`,icon:jo})]}),r.jsxs("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[r.jsx(sge,{}),r.jsx(rge,{logs:a,isLoading:l}),n?.role==="field_officer"&&r.jsx(ige,{})]}),x&&r.jsx("div",{className:"my-4 w-full",children:r.jsxs(se,{onClick:()=>S(!0),size:"lg",className:"w-full justify-center text-lg",children:[r.jsx(Tt,{className:"mr-2 h-5"})," New Request"]})}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full md:w-full",children:[r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"w-full sm:w-auto md:border-b border-border",children:r.jsx("nav",{className:"flex flex-col md:flex-row md:space-x-6 space-y-2 md:space-y-0","aria-label":"Tabs",children:Y.map(M=>r.jsx("button",{onClick:()=>f(M),className:`whitespace-nowrap font-medium text-base rounded-lg md:rounded-none w-full md:w-auto text-left px-4 py-2 md:px-1 md:py-3 md:bg-transparent md:border-b-2
                                    ${m===M?"bg-accent-light text-accent-dark md:border-accent":"text-muted hover:bg-accent-light hover:text-accent-dark md:border-transparent md:hover:border-accent"}`,children:_(M)},M))})})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Type"}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Dates"}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Reason"}),r.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-muted uppercase",children:"Status"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:l?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Loading..."})}):s.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted text-lg",children:"No requests found."})}):s.map(M=>r.jsxs("tr",{children:[r.jsxs("td",{"data-label":"Type",className:"px-4 py-3 font-medium text-base",children:[M.leaveType," ",M.dayOption&&`(${M.dayOption})`]}),r.jsxs("td",{"data-label":"Dates",className:"px-4 py-3 text-muted text-base",children:[He(new Date(M.startDate.replace(/-/g,"/")),"dd MMM")," - ",He(new Date(M.endDate.replace(/-/g,"/")),"dd MMM")]}),r.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted max-w-xs truncate text-base",children:M.reason}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3 text-base",children:r.jsx(oge,{status:M.status})})]},M.id))})]})})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card w-full md:w-full",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary-text",children:"Compensatory Off Tracker"}),d?r.jsxs("div",{className:"text-center py-10 text-muted bg-page rounded-lg",children:[r.jsx(ca,{className:"h-8 w-8 mx-auto mb-2 text-yellow-500"}),r.jsx("p",{className:"font-semibold",children:"Feature Unavailable"}),r.jsx("p",{className:"text-sm",children:"The Compensatory Off feature is disabled because the required 'comp_off_logs' table is missing in the database."})]}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Date Earned"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reason for Comp-Off"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Granted By"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Status"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:l?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"Loading..."})}):a.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted text-lg",children:"No comp-off history found."})}):a.map(M=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Date Earned",className:"px-4 py-3 font-medium",children:He(new Date(M.dateEarned.replace(/-/g,"/")),"dd MMM, yyyy")}),r.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted",children:M.reason}),r.jsx("td",{"data-label":"Granted By",className:"px-4 py-3 text-muted",children:M.grantedByName||"-"}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full capitalize ${M.status==="earned"?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-800"}`,children:M.status})})]},M.id))})]})})]}),r.jsx(age,{})]})},gge=({isOpen:n,onClose:e,onConfirm:t,isConfirming:s})=>{const[i,a]=k.useState(""),[o,l]=k.useState(""),c=()=>{if(!i.trim()){l("A reason for rejection is required.");return}t(i)},d=()=>{a(""),l(""),e()};return n?r.jsx(tr,{isOpen:n,onClose:d,onConfirm:c,title:"Reject Claim",confirmButtonText:"Confirm Rejection",isConfirming:s,children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("p",{children:"Please provide a reason for rejecting this claim. This will be visible to the employee."}),r.jsxs("div",{children:[r.jsx("textarea",{value:i,onChange:h=>{a(h.target.value),o&&l("")},rows:3,className:`mt-1 form-input ${o?"form-input--error":""}`,placeholder:"e.g., Overtime was not pre-approved."}),o&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:o})]})]})}):null},uge=({status:n})=>{const e={pending_manager_approval:"bg-yellow-100 text-yellow-800",pending_hr_confirmation:"bg-blue-100 text-blue-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"},t=n.replace(/_/g," ");return r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full capitalize ${e[n]}`,children:t})},hge=({status:n})=>{const e={Pending:"bg-yellow-100 text-yellow-800",Approved:"bg-green-100 text-green-800",Rejected:"bg-red-100 text-red-800"};return r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full capitalize ${e[n]}`,children:n})},mge=()=>{const n=vt(),{user:e}=bt(),{colorScheme:t}=an(),s=Is(t),[i,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState(!0),[h,m]=k.useState("pending_manager_approval"),[f,p]=k.useState(null),[b,x]=k.useState(null),v=jt("(max-width: 767px)"),[S,B]=k.useState(!0),[V,R]=k.useState(!1),[W,_]=k.useState(null);k.useEffect(()=>{(async()=>{try{await ce.checkCompOffTableExists(),B(!0)}catch{B(!1)}})()},[]);const Y=k.useCallback(async()=>{if(e){d(!0);try{const E=["admin","hr","operation_manager","site_manager"].includes(e.role),[te,q]=await Promise.all([ce.getLeaveRequests({forApproverId:e.id,status:h!=="all"&&h!=="claims"?h:void 0}),E?ce.getExtraWorkLogs():Promise.resolve([])]);a(te),l(q)}catch{p({message:"Failed to load approval data.",type:"error"})}finally{d(!1)}}},[e,h]);k.useEffect(()=>{Y()},[Y]);const j=async(E,te)=>{if(e){x(E);try{switch(te){case"approve":await ce.approveLeaveRequest(E,e.id);break;case"reject":await ce.rejectLeaveRequest(E,e.id);break;case"confirm":await ce.confirmLeaveByHR(E,e.id);break}p({message:"Request actioned successfully.",type:"success"}),Y()}catch{p({message:"Failed to update request.",type:"error"})}finally{x(null)}}},M=async E=>{if(e){x(E);try{await ce.approveExtraWorkClaim(E,e.id),p({message:"Claim approved successfully.",type:"success"}),Y()}catch{p({message:"Failed to approve claim.",type:"error"})}finally{x(null)}}},H=async E=>{if(!(!e||!W)){x(W.id);try{await ce.rejectExtraWorkClaim(W.id,e.id,E),p({message:"Claim rejected successfully.",type:"success"}),Y()}catch{p({message:"Failed to reject claim.",type:"error"})}finally{x(null),R(!1),_(null)}}},D=["pending_manager_approval","claims","pending_hr_confirmation","approved","rejected","all"],z=({request:E})=>{if(!e||E.status==="approved"||E.status==="rejected")return null;if(E.currentApproverId===e.id){if(E.status==="pending_manager_approval")return r.jsxs("div",{className:"flex gap-2",children:[r.jsx(se,{size:"sm",variant:"icon",onClick:()=>j(E.id,"approve"),disabled:b===E.id,title:"Approve","aria-label":"Approve request",children:r.jsx(Rl,{className:"h-4 w-4 text-green-600"})}),r.jsx(se,{size:"sm",variant:"icon",onClick:()=>j(E.id,"reject"),disabled:b===E.id,title:"Reject","aria-label":"Reject request",children:r.jsx(Zi,{className:"h-4 w-4 text-red-600"})})]});if(E.status==="pending_hr_confirmation"&&(e.role==="hr"||e.role==="admin"))return r.jsxs("div",{className:"flex gap-2",children:[r.jsx(se,{size:"sm",variant:"icon",onClick:()=>j(E.id,"confirm"),disabled:b===E.id,title:"Confirm & Finalize","aria-label":"Confirm and finalize request",children:r.jsx(Rl,{className:"h-4 w-4 text-blue-600"})}),r.jsx(se,{size:"sm",variant:"icon",onClick:()=>j(E.id,"reject"),disabled:b===E.id,title:"Reject","aria-label":"Reject request",children:r.jsx(Zi,{className:"h-4 w-4 text-red-600"})})]})}return null},O=E=>E.replace(/_/g," ").replace(/\b\w/g,te=>te.toUpperCase());return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)}),r.jsx(gge,{isOpen:V,onClose:()=>{R(!1),_(null)},onConfirm:H,isConfirming:!!b}),r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Leave Approval Inbox"}),!v&&r.jsxs(se,{onClick:()=>n("/hr/leave-management/grant-comp-off"),disabled:!S,title:S?"Grant a compensatory off day":"Feature disabled: 'comp_off_logs' table missing in database.",style:{backgroundColor:s.activeItemBg,color:"#FFFFFF",borderColor:s.sidebarBorder},className:"border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Grant Comp Off"]})]}),v&&r.jsx("div",{className:"mb-6",children:r.jsxs(se,{onClick:()=>n("/hr/leave-management/grant-comp-off"),disabled:!S,title:S?"Grant a compensatory off day":"Feature disabled: 'comp_off_logs' table missing in database.",style:{backgroundColor:s.activeItemBg,color:"#FFFFFF",borderColor:s.sidebarBorder},className:"w-full justify-center border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Grant Comp Off"]})}),r.jsx("div",{className:"mb-6",children:r.jsx("div",{className:"w-full sm:w-auto md:border-b border-border",children:r.jsx("nav",{className:"flex flex-col md:flex-row md:space-x-6 md:overflow-x-auto space-y-1 md:space-y-0","aria-label":"Tabs",children:D.map(E=>{const te=h===E,q=t==="professional-blue"?"#1a3a6e":"#047857",de=t==="professional-blue"?"#eff6ff":"#ecfdf5";return r.jsx("button",{onClick:()=>m(E),style:{color:te?q:void 0,backgroundColor:te?v?de:"transparent":void 0,borderColor:te&&!v?q:"transparent"},className:`whitespace-nowrap font-medium text-sm rounded-lg md:rounded-none w-full md:w-auto text-left md:text-center px-4 py-3 md:px-1 md:py-3 transition-colors duration-200
                                    ${te?"":"text-muted hover:bg-gray-50"}
                                    ${v?"":"md:border-b-2"}
                                    `,children:O(E)},E)})})})}),h==="claims"?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Employee"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Date & Type"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Claim"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reason"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Status"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:c?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"text-center py-10",children:r.jsx(xt,{className:"h-6 w-6 animate-spin mx-auto"})})}):o.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"text-center py-10 text-muted",children:"No pending claims found."})}):o.map(E=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Employee",className:"px-4 py-3 font-medium",children:E.userName}),r.jsxs("td",{"data-label":"Date & Type",className:"px-4 py-3 text-muted",children:[He(new Date(E.workDate),"dd MMM, yyyy")," (",E.workType,")"]}),r.jsxs("td",{"data-label":"Claim",className:"px-4 py-3 text-muted",children:[E.claimType,E.claimType==="OT"?` (${E.hoursWorked} hrs)`:""]}),r.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted max-w-xs truncate",children:E.reason}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:r.jsx(hge,{status:E.status})}),r.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:r.jsxs("div",{className:"flex md:justify-start justify-end gap-2",children:[r.jsx(se,{size:"sm",variant:"icon",onClick:()=>M(E.id),disabled:b===E.id,title:"Approve Claim",children:r.jsx(Rl,{className:"h-4 w-4 text-green-600"})}),r.jsx(se,{size:"sm",variant:"icon",onClick:()=>{_(E),R(!0)},disabled:b===E.id,title:"Reject Claim",children:r.jsx(Zi,{className:"h-4 w-4 text-red-600"})})]})})]},E.id))})]})}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Employee"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Type"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Dates"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Reason"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Status"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:c?v?r.jsx("tr",{children:r.jsx("td",{colSpan:6,children:r.jsx(Ea,{rows:3,cols:6,isMobile:!0})})}):r.jsx(Ea,{rows:5,cols:6}):i.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"text-center py-10 text-muted",children:"No requests found for this filter."})}):i.map(E=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Employee",className:"px-4 py-3 font-medium",children:E.userName}),r.jsxs("td",{"data-label":"Type",className:"px-4 py-3 text-muted",children:[E.leaveType," ",E.dayOption&&`(${E.dayOption})`]}),r.jsxs("td",{"data-label":"Dates",className:"px-4 py-3 text-muted",children:[He(new Date(E.startDate.replace(/-/g,"/")),"dd MMM")," - ",He(new Date(E.endDate.replace(/-/g,"/")),"dd MMM")]}),r.jsx("td",{"data-label":"Reason",className:"px-4 py-3 text-muted max-w-xs truncate",children:E.reason}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:r.jsx(uge,{status:E.status})}),r.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:r.jsx("div",{className:"flex md:justify-start justify-end",children:b===E.id?r.jsx(xt,{className:"h-4 w-4 animate-spin"}):r.jsx(z,{request:E})})})]},E.id))})]})})]})},sD=({users:n,externalSearchQuery:e,externalZoom:t,showControls:s=!0})=>{const i=k.useRef(null),a=k.useRef(null),[o,l]=k.useState(null),[c,d]=k.useState(null),[h,m]=k.useState({x:0,y:0}),[f,p]=k.useState(""),[b,x]=k.useState(1),[v,S]=k.useState({x:0,y:0}),B=e!==void 0?e:f,V=t!==void 0?t:b,R=p,W=x,_=k.useRef(null),Y=k.useRef(!1),j=k.useRef({x:0,y:0}),M=k.useRef(!1),H=k.useRef({x:0,y:0}),D=k.useRef(0),z=k.useRef(new Map),O=k.useRef(window.devicePixelRatio||1);k.useEffect(()=>{n.forEach(ie=>{if(ie.photoUrl&&!z.current.has(ie.id)){const ge=new Image;ge.crossOrigin="anonymous",ge.src=ie.photoUrl,ge.onload=()=>{z.current.set(ie.id,ge)}}})},[n]);const E=()=>{const ie=new Map;n.forEach(xe=>{ie.set(xe.id,{...xe,children:[]})});const ge=[];return n.forEach(xe=>{const _e=ie.get(xe.id);if(xe.reportingManagerId){const Be=ie.get(xe.reportingManagerId);Be?Be.children.push(_e):ge.push(_e)}else ge.push(_e)}),ge},te=(ie,ge=50,xe=50,_e=0)=>{let De=ge;const Me=[];let Le=1/0,nt=-1/0,st=1/0,ee=-1/0;ie.forEach(Ie=>{if(Ie.level=_e,Ie.children&&Ie.children.length>0){const Ne=te(Ie.children,De,xe+120+120,_e+1),Ge=Ne.width,je=De+Ge/2-180/2;Ie.x=je,Ie.y=xe,Me.push(Ie),Me.push(...Ne.nodes),Le=Math.min(Le,je,Ne.bounds.minX),nt=Math.max(nt,je+180,Ne.bounds.maxX),st=Math.min(st,xe,Ne.bounds.minY),ee=Math.max(ee,xe+120,Ne.bounds.maxY),De+=Ge+20}else Ie.x=De,Ie.y=xe,Me.push(Ie),Le=Math.min(Le,De),nt=Math.max(nt,De+180),st=Math.min(st,xe),ee=Math.max(ee,xe+120),De+=200});const oe=Math.max(0,De-ge-20);return{width:Math.max(oe,180),nodes:Me,bounds:{minX:isFinite(Le)?Le:0,maxX:isFinite(nt)?nt:180,minY:isFinite(st)?st:0,maxY:isFinite(ee)?ee:300}}},q=(ie,ge,xe,_e)=>{if(ge.x===void 0||ge.y===void 0||xe.x===void 0||xe.y===void 0)return;const Be=(ge.x+90)*V+v.x,Se=(ge.y+120)*V+v.y,Re=(xe.x+90)*V+v.x,Ye=xe.y*V+v.y,De=ie.createLinearGradient(Be,Se,Re,Ye),Me=_e*5e-4%1;De.addColorStop(0,"#E0E7FF"),De.addColorStop(Me,"#818CF8"),De.addColorStop(1,"#E0E7FF"),ie.save(),ie.strokeStyle=De,ie.lineWidth=2*V,ie.lineCap="round",ie.shadowColor="rgba(99, 102, 241, 0.2)",ie.shadowBlur=4,ie.beginPath(),ie.moveTo(Be,Se);const Le=(Se+Ye)/2;ie.bezierCurveTo(Be,Le,Re,Le,Re,Ye),ie.stroke(),ie.restore();const st=(_e*5e-4+ge.id.charCodeAt(0)*.1)%1,ee={x:Be,y:Se},oe={x:Be,y:(Se+Ye)/2},Ie={x:Re,y:(Se+Ye)/2},Ne={x:Re,y:Ye},Ge=3*(oe.x-ee.x),je=3*(Ie.x-oe.x)-Ge,Fe=Ne.x-ee.x-Ge-je,ze=3*(oe.y-ee.y),lt=3*(Ie.y-oe.y)-ze,Dt=Ne.y-ee.y-ze-lt,kt=Fe*st*st*st+je*st*st+Ge*st+ee.x,$t=Dt*st*st*st+lt*st*st+ze*st+ee.y;ie.save(),ie.fillStyle="#6366F1",ie.shadowColor="#6366F1",ie.shadowBlur=8,ie.beginPath(),ie.arc(kt,$t,3*V,0,Math.PI*2),ie.fill(),ie.restore()},de=(ie,ge,xe,_e,Be)=>{if(ge.x===void 0||ge.y===void 0)return null;const Se=ge.x*V+v.x,Re=ge.y*V+v.y,Ye=180*V,De=120*V,Me=48*V,Le=!!B&&ge.name.toLowerCase().includes(B.toLowerCase());ie.save(),ie.shadowColor=_e?"rgba(99, 102, 241, 0.4)":"rgba(0, 0, 0, 0.08)",ie.shadowBlur=(_e?24:12)*V,ie.shadowOffsetY=(_e?8:4)*V;const nt=ie.createLinearGradient(Se,Re,Se,Re+De);nt.addColorStop(0,"#FFFFFF"),nt.addColorStop(1,"#FAFAFA"),ie.fillStyle=nt;const st=16*V;ie.beginPath(),ie.roundRect?ie.roundRect(Se,Re,Ye,De,st):(ie.moveTo(Se+st,Re),ie.lineTo(Se+Ye-st,Re),ie.quadraticCurveTo(Se+Ye,Re,Se+Ye,Re+st),ie.lineTo(Se+Ye,Re+De-st),ie.quadraticCurveTo(Se+Ye,Re+De,Se+Ye-st,Re+De),ie.lineTo(Se+st,Re+De),ie.quadraticCurveTo(Se,Re+De,Se,Re+De-st),ie.lineTo(Se,Re+st),ie.quadraticCurveTo(Se,Re,Se+st,Re)),ie.fill(),ie.lineWidth=(_e?2:1)*V,ie.strokeStyle=_e?"#6366F1":xe?"#A5B4FC":Le?"#22C55E":"#E5E7EB",ie.stroke(),ie.restore(),(_e||Le)&&(ie.save(),ie.globalAlpha=.05,ie.fillStyle=_e?"#6366F1":"#22C55E",ie.beginPath(),ie.roundRect&&ie.roundRect(Se,Re,Ye,De,st),ie.fill(),ie.restore());const ee=Se+(Ye-Me)/2,oe=Re+16*V;ie.save(),ie.beginPath(),ie.arc(ee+Me/2,oe+Me/2,Me/2,0,Math.PI*2),ie.clip();const Ie=z.current.get(ge.id);if(Ie&&Ie.complete)ie.drawImage(Ie,ee,oe,Me,Me);else{const lt=ie.createLinearGradient(ee,oe,ee+Me,oe+Me);lt.addColorStop(0,"#818CF8"),lt.addColorStop(1,"#4F46E5"),ie.fillStyle=lt,ie.fillRect(ee,oe,Me,Me),ie.fillStyle="#FFF",ie.font=`600 ${Math.max(12,16*V)}px "Inter", sans-serif`,ie.textAlign="center",ie.textBaseline="middle";const Dt=ge.name.split(" ").map(kt=>kt[0]).join("").substring(0,2).toUpperCase();ie.fillText(Dt,ee+Me/2,oe+Me/2+1*V)}if(ie.restore(),ie.save(),ie.strokeStyle=_e?"#6366F1":"#FFF",ie.lineWidth=2*V,ie.beginPath(),ie.arc(ee+Me/2,oe+Me/2,Me/2,0,Math.PI*2),ie.stroke(),ie.restore(),ge.level!==void 0&&ge.level>0){const lt=18*V,Dt=ee+Me-lt/2,kt=oe+Me-lt/2;ie.save(),ie.fillStyle="#10B981",ie.shadowColor="rgba(16, 185, 129, 0.4)",ie.shadowBlur=4*V,ie.beginPath(),ie.arc(Dt,kt,lt/2,0,Math.PI*2),ie.fill(),ie.fillStyle="#FFF",ie.font=`700 ${Math.max(8,9*V)}px "Inter", sans-serif`,ie.textAlign="center",ie.textBaseline="middle",ie.fillText(`L${ge.level}`,Dt,kt+1*V),ie.restore()}ie.save(),ie.fillStyle="#111827",ie.font=`600 ${Math.max(11,13*V)}px "Inter", sans-serif`,ie.textAlign="center",ie.textBaseline="top";const Ne=oe+Me+12*V;let Ge=ge.name;const je=Ye-24*V;if(ie.measureText(Ge).width>je){for(;ie.measureText(Ge+"...").width>je&&Ge.length>0;)Ge=Ge.substring(0,Ge.length-1);Ge+="..."}ie.fillText(Ge,Se+Ye/2,Ne),ie.fillStyle="#6B7280",ie.font=`500 ${Math.max(9,11*V)}px "Inter", sans-serif`;const Fe=Ne+18*V;let ze=(ge.role||"").replace(/_/g," ");if(ze=ze?ze.charAt(0).toUpperCase()+ze.slice(1).toLowerCase():"",ie.measureText(ze).width>je){for(;ie.measureText(ze+"...").width>je&&ze.length>0;)ze=ze.substring(0,ze.length-1);ze+="..."}return ie.fillText(ze,Se+Ye/2,Fe),ie.restore(),{x:Se,y:Re,width:Ye,height:De}},U=(ie,ge)=>{const xe=E(),_e=te(xe),Be=new Map;return _e.nodes.forEach(Se=>{Se.children&&Se.children.forEach(Re=>{q(ie,Se,Re,ge)})}),_e.nodes.forEach(Se=>{const Re=o?.id===Se.id,Ye=c?.id===Se.id,De=de(ie,Se,Re,Ye);De&&Be.set(Se.id,De)}),{nodePositions:Be,layout:_e}},P=ie=>{const ge=ie??i.current;if(!ge)return;const xe=ge.getBoundingClientRect(),_e=E(),Se=te(_e).bounds,Re=180,Ye=120,De=Math.max(1,Se.maxX-Se.minX+Re),Me=Math.max(1,Se.maxY-Se.minY+Ye),Le=Se.minX+De/2,nt=Se.minY+Me/2,st=.98,ee=xe.width*st/De,oe=xe.height*st/Me;let Ie=Math.min(ee,oe);Ie=Math.max(.3,Math.min(Ie,1.5));const Ne=t!==void 0?t:Ie,Ge=xe.width/2-Le*Ne,je=xe.height/2-nt*Ne;t===void 0&&W(Ie),S({x:Ge,y:je})};k.useEffect(()=>{if(n.length>0){const ie=setTimeout(()=>P(),100);return()=>clearTimeout(ie)}},[n.length]),k.useEffect(()=>{t!==void 0&&n.length>0&&P()},[t]),k.useEffect(()=>{const ie=()=>{const ge=i.current,xe=a.current;if(!ge||!xe)return;const _e=window.devicePixelRatio||1;O.current=_e;const Be=xe.getBoundingClientRect(),Se=Math.max(1,Be.width),Re=Math.max(1,Be.height);ge.width=Math.round(Se*_e),ge.height=Math.round(Re*_e),ge.style.width=`${Se}px`,ge.style.height=`${Re}px`;const Ye=ge.getContext("2d");Ye&&(Ye.setTransform(_e,0,0,_e,0,0),P(ge))};return ie(),window.addEventListener("resize",ie),()=>window.removeEventListener("resize",ie)},[n]),k.useEffect(()=>{const ie=i.current,ge=ie?.getContext("2d");if(!ie||!ge)return;const xe=O.current;let _e=0;const Be=()=>{D.current+=16,ge.clearRect(0,0,ie.width/xe,ie.height/xe);const Se=ie.width/xe,Re=ie.height/xe,Ye=ge.createLinearGradient(0,0,Se,Re);Ye.addColorStop(0,"#FAFAFA"),Ye.addColorStop(1,"#F3F4F6"),ge.fillStyle=Ye,ge.fillRect(0,0,Se,Re);const{nodePositions:De}=U(ge,D.current);let Me=!1;for(const[Le,nt]of De.entries())if(h.x>=nt.x&&h.x<=nt.x+nt.width&&h.y>=nt.y&&h.y<=nt.y+nt.height){const st=n.find(ee=>ee.id===Le);if(st){l(st),Me=!0;break}}!Me&&o&&l(null),_e=requestAnimationFrame(Be),_.current=_e};return _.current=requestAnimationFrame(Be),()=>{_.current&&cancelAnimationFrame(_.current)}},[n,o,c,h,V,v,B]);const ne=ie=>{Y.current=!0,M.current=!1;const ge=ie.nativeEvent.offsetX,xe=ie.nativeEvent.offsetY;H.current={x:ge,y:xe},j.current={x:ge,y:xe}},K=ie=>{const ge=ie.nativeEvent.offsetX,xe=ie.nativeEvent.offsetY;if(m({x:ge,y:xe}),Y.current){const _e=(ge-H.current.x)*1.3,Be=(xe-H.current.y)*1.3;Math.sqrt(Math.pow(ge-j.current.x,2)+Math.pow(xe-j.current.y,2))>5&&(M.current=!0),S(Re=>({x:Re.x+_e,y:Re.y+Be})),H.current={x:ge,y:xe}}},re=()=>{Y.current=!1},le=()=>{o&&!M.current&&d(c?.id===o.id?null:o),M.current=!1},ue=()=>W(ie=>Math.min(ie+.2,2.5)),ae=()=>W(ie=>Math.max(ie-.2,.4)),Ce=()=>{P(),d(null),R("")};return r.jsxs("div",{className:"relative w-full h-full bg-gradient-to-br from-slate-50 to-slate-100",ref:a,children:[s&&r.jsxs("div",{className:"absolute top-4 left-4 z-20 flex flex-col gap-3",children:[r.jsxs("div",{className:"bg-white/90 backdrop-blur-md border border-slate-200 rounded-xl shadow-xl p-3 min-w-[280px]",children:[r.jsxs("div",{className:"relative",children:[r.jsx(la,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),r.jsx("input",{type:"text",placeholder:"Search employees...",value:B,onChange:ie=>R(ie.target.value),className:"w-full pl-10 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),B&&r.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:[n.filter(ie=>ie.name.toLowerCase().includes(B.toLowerCase())).length," results"]})]}),r.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-white/20 rounded-2xl shadow-lg p-3 flex flex-col gap-3 min-w-[240px]",children:[r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx("button",{onClick:ae,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Zoom Out",children:r.jsx(pG,{className:"w-5 h-5"})}),r.jsx("div",{className:"flex-1 px-2",children:r.jsx("input",{type:"range",min:"40",max:"250",value:Math.round(V*100),onChange:ie=>W(parseInt(ie.target.value)/100),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-indigo-500 [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-md [&::-webkit-slider-thumb]:transition-transform [&::-webkit-slider-thumb]:hover:scale-110 [&::-moz-range-thumb]:w-4 [&::-moz-range-thumb]:h-4 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-indigo-500 [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0 [&::-moz-range-thumb]:shadow-md",title:"Zoom Slider"})}),r.jsx("button",{onClick:ue,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Zoom In",children:r.jsx(fG,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"px-2 min-w-[60px] text-center font-semibold text-slate-700 text-sm tabular-nums bg-slate-100 rounded-lg py-1",children:[Math.round(V*100),"%"]}),r.jsx("div",{className:"w-px h-6 bg-slate-200"}),r.jsx("button",{onClick:Ce,className:"p-2 hover:bg-slate-100/80 rounded-xl transition-all duration-200 text-slate-600 hover:text-slate-900 active:scale-95",title:"Reset View",children:r.jsx(mZ,{className:"w-5 h-5"})})]})]})]}),r.jsx("canvas",{ref:i,className:"w-full h-full cursor-grab active:cursor-grabbing",onMouseDown:ne,onMouseMove:K,onMouseUp:re,onMouseLeave:re,onClick:le}),o&&o.x!==void 0&&o.y!==void 0&&r.jsx("div",{className:"absolute pointer-events-none z-10 transform -translate-x-1/2 transition-all duration-200",style:{left:`${o.x*V+v.x+90*V}px`,top:`${Math.max(10,o.y*V+v.y-10)}px`},children:r.jsx("div",{className:"bg-white/95 backdrop-blur-xl border border-indigo-200 rounded-2xl shadow-2xl p-5 min-w-[320px] animate-fade-in-scale",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs("div",{className:"flex-shrink-0 relative",children:[o.photoUrl?r.jsx("img",{src:o.photoUrl,alt:o.name,className:"w-20 h-20 rounded-2xl object-cover border-3 border-indigo-500 shadow-lg"}):r.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold text-2xl border-3 border-white shadow-lg",children:o.name.split(" ").map(ie=>ie[0]).join("").substring(0,2).toUpperCase()}),o.level!==void 0&&o.level>0&&r.jsxs("div",{className:"absolute -bottom-2 -right-2 bg-emerald-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg",children:["L",o.level]})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-bold text-slate-900 text-xl mb-1 truncate",children:o.name}),r.jsx("p",{className:"text-sm text-indigo-600 font-medium capitalize mb-3 truncate",children:o.role.replace(/_/g," ")}),r.jsxs("div",{className:"space-y-2",children:[o.email&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx(th,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),r.jsx("span",{className:"truncate",children:o.email})]}),o.phone&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx(Eu,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),r.jsx("span",{children:o.phone})]}),o.managerName&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx(Ni,{className:"w-4 h-4 flex-shrink-0 text-indigo-500"}),r.jsxs("span",{className:"truncate",children:["Reports to: ",r.jsx("strong",{children:o.managerName})]})]})]}),r.jsx("div",{className:"mt-3 pt-3 border-t border-slate-200",children:r.jsxs("p",{className:"text-xs text-slate-500 italic",children:["Click to ",c?.id===o.id?"deselect":"select and focus"]})})]})]})})}),s&&r.jsx("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-md px-6 py-3 rounded-full border border-slate-200 shadow-xl",children:r.jsxs("p",{className:"text-sm text-slate-700 font-medium flex items-center gap-3",children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-pulse"}),"Drag to pan"]}),r.jsx("span",{className:"text-slate-300",children:""}),r.jsx("span",{children:"Hover for details"}),r.jsx("span",{className:"text-slate-300",children:""}),r.jsx("span",{children:"Click to select"})]})}),s&&r.jsxs("div",{className:"absolute top-4 right-4 bg-white/90 backdrop-blur-md border border-slate-200 rounded-2xl shadow-xl p-4 max-w-[200px]",children:[r.jsxs("h4",{className:"text-sm font-bold text-slate-900 mb-3 flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"}),"Org Hierarchy"]}),r.jsxs("div",{className:"space-y-2.5",children:[r.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[r.jsx("div",{className:"w-5 h-5 rounded bg-gradient-to-br from-purple-500 to-indigo-600 border-2 border-white shadow-md flex-shrink-0"}),r.jsx("span",{children:"Team Member"})]}),r.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[r.jsx("div",{className:"w-5 h-5 rounded bg-gradient-to-br from-emerald-400 to-emerald-600 border-2 border-white shadow-md flex-shrink-0"}),r.jsx("span",{children:"Search Match"})]}),r.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[r.jsx("div",{className:"w-8 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-500 flex-shrink-0 shadow-sm"}),r.jsx("span",{children:"Reports To"})]}),r.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-600",children:[r.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500 text-white text-[8px] font-bold flex items-center justify-center flex-shrink-0",children:"L2"}),r.jsx("span",{children:"Level Badge"})]})]}),c&&r.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[r.jsx("p",{className:"text-xs font-semibold text-indigo-600 mb-1",children:"Selected:"}),r.jsx("p",{className:"text-xs text-slate-700 font-medium truncate",children:c.name})]})]}),r.jsxs("div",{className:"absolute bottom-6 right-6 bg-slate-900/80 backdrop-blur-sm text-white text-xs px-3 py-2 rounded-full font-mono",children:[n.length," employees"]})]})},Ige=({users:n})=>{const[e,t]=k.useState(!1),[s,i]=k.useState(""),[a,o]=k.useState(null),[l,c]=k.useState(!0),d=()=>{i(""),o(null),setTimeout(()=>{},100)},h=()=>o(p=>Math.min((p??80)+10,250)),m=()=>o(p=>Math.max((p??80)-10,40)),f=r.jsxs("div",{className:`flex flex-col ${e?"h-screen":"h-[75vh] min-h-[500px]"}`,children:[r.jsx("div",{className:"flex-shrink-0 bg-white border-b border-slate-200 px-4 py-3",children:r.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3",children:[r.jsxs("div",{className:"relative flex-shrink-0 w-full md:w-64",children:[r.jsx(la,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),r.jsx("input",{type:"text",placeholder:"Search employees...",value:s,onChange:p=>i(p.target.value),className:"w-full pl-10 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),r.jsx("div",{className:"flex-1"}),r.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 rounded-lg px-3 py-2 border border-slate-200",children:[r.jsx("button",{onClick:m,className:"p-1.5 hover:bg-slate-200/60 rounded-md transition-colors text-slate-600 hover:text-slate-900",title:"Zoom Out",children:r.jsx(pG,{className:"w-4 h-4"})}),r.jsx("input",{type:"range",min:"40",max:"250",value:a??80,disabled:a===null,onChange:p=>o(parseInt(p.target.value)),className:"w-24 h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-primary [&::-webkit-slider-thumb]:cursor-pointer [&::-moz-range-thumb]:w-3 [&::-moz-range-thumb]:h-3 [&::-moz-range-thumb]:rounded-full [&::-moz-range-thumb]:bg-primary [&::-moz-range-thumb]:cursor-pointer [&::-moz-range-thumb]:border-0"}),r.jsx("span",{className:"text-xs font-semibold text-slate-700 min-w-[45px] text-center",children:a?`${a}%`:"Auto"}),r.jsx("button",{onClick:h,className:"p-1.5 hover:bg-slate-200/60 rounded-md transition-colors text-slate-600 hover:text-slate-900",title:"Zoom In",children:r.jsx(fG,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:d,className:"px-3 py-2 text-sm font-medium text-slate-700 hover:text-slate-900 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(mZ,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Reset"})]}),r.jsxs("button",{onClick:()=>t(!e),className:"px-3 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-lg transition-colors flex items-center gap-2",children:[e?r.jsx(c$,{className:"w-4 h-4"}):r.jsx(mZ,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:e?"Exit":"Full Screen"})]})]})]})}),r.jsxs("div",{className:"flex-1 bg-slate-50 relative overflow-hidden",children:[r.jsx(sD,{users:n,externalSearchQuery:s,externalZoom:a!==null?a/100:void 0,showControls:!1}),r.jsx("div",{className:`absolute bottom-4 right-4 z-20 ${l?"block":"hidden"} md:block`,children:r.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-slate-200 rounded-xl shadow-lg px-4 py-3 min-w-[200px]",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h4",{className:"text-xs font-bold text-slate-900 flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"}),"Legend"]}),r.jsx("button",{onClick:()=>c(!l),className:"md:hidden text-slate-400 hover:text-slate-600",children:r.jsx(fg,{className:"w-3 h-3"})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-purple-500 to-indigo-600 border border-white shadow-sm flex-shrink-0"}),r.jsx("span",{children:"Team Member"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-emerald-400 to-emerald-600 border border-white shadow-sm flex-shrink-0"}),r.jsx("span",{children:"Search Match"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx("div",{className:"w-6 h-0.5 bg-gradient-to-r from-indigo-400 to-purple-500 flex-shrink-0 shadow-sm"}),r.jsx("span",{children:"Reports To"})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[r.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-500 text-white text-[8px] font-bold flex items-center justify-center flex-shrink-0",children:"L2"}),r.jsx("span",{children:"Level Badge"})]})]})]})}),r.jsx("button",{onClick:()=>c(!l),className:"md:hidden absolute bottom-4 right-4 z-30 bg-white border border-slate-200 rounded-full p-2 shadow-lg",children:r.jsx(fg,{className:"w-5 h-5 text-slate-600"})})]}),s&&r.jsx("div",{className:"flex-shrink-0 bg-white border-t border-slate-200 px-4 py-2",children:r.jsxs("p",{className:"text-xs text-slate-600",children:[n.filter(p=>p.name.toLowerCase().includes(s.toLowerCase())).length," results found"]})})]});return e?r.jsx("div",{className:"fixed inset-0 z-50 bg-white",children:f}):r.jsx("div",{className:"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden",children:f})},Cge=()=>{vt();const[n,e]=k.useState([]),[t,s]=k.useState([]),[i,a]=k.useState("hr"),[o,l]=k.useState(!0),[c,d]=k.useState(!1),[h,m]=k.useState(null),[f,p]=k.useState("table"),b=k.useCallback(async()=>{l(!0);try{const[S,B,V]=await Promise.all([ce.getUsersWithManagers(),ce.getApprovalWorkflowSettings(),ce.getRoles()]);e(S),a(B.finalConfirmationRole),s(V.filter(R=>["admin","hr","operation_manager"].includes(R.id)))}catch{m({message:"Failed to load workflow data.",type:"error"})}finally{l(!1)}},[]);k.useEffect(()=>{b()},[b]);const x=(S,B)=>{e(V=>V.map(R=>R.id===S?{...R,reportingManagerId:B||void 0}:R))},v=async()=>{d(!0);try{await Promise.all(n.map(S=>ce.updateUserReportingManager(S.id,S.reportingManagerId||null))),await ce.updateApprovalWorkflowSettings(i),m({message:"Workflow saved successfully!",type:"success"}),b()}catch{m({message:"Failed to save workflow.",type:"error"})}finally{d(!1)}};return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)}),r.jsx(ma,{title:"Leave Approval Settings",children:r.jsxs(se,{onClick:v,isLoading:c,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Workflow"]})}),r.jsxs("section",{className:"mb-8",children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text mb-2",children:"Final Confirmation Step"}),r.jsx("p",{className:"text-sm text-muted mb-4",children:"Select the role responsible for the final confirmation of a leave request after it has been approved by the reporting manager chain."}),r.jsx("div",{className:"max-w-xs",children:r.jsx(Oe,{label:"Final Confirmation Role",id:"final-approver",value:i,onChange:S=>a(S.target.value),children:t.map(S=>r.jsx("option",{value:S.id,children:S.displayName},S.id))})})]}),r.jsxs("section",{children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-1",children:"Reporting Structure"}),r.jsx("p",{className:"text-sm text-muted",children:"View and manage organizational hierarchy"})]})}),r.jsx("div",{className:"border-b border-border mb-6",children:r.jsxs("div",{className:"flex gap-1 overflow-x-auto",children:[r.jsxs("button",{onClick:()=>p("table"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap border-b-2 ${f==="table"?"border-primary text-primary":"border-transparent text-muted hover:text-primary-text hover:border-border"}`,children:[r.jsx(A$,{className:"w-4 h-4"}),"Table View"]}),r.jsxs("button",{onClick:()=>p("2d"),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors whitespace-nowrap border-b-2 ${f==="2d"?"border-primary text-primary":"border-transparent text-muted hover:text-primary-text hover:border-border"}`,children:[r.jsx(u$,{className:"w-4 h-4"}),"2D Workflow Chart"]})]})}),o?r.jsx("div",{className:"flex justify-center items-center py-10",children:r.jsx(xt,{className:"h-6 w-6 animate-spin text-muted"})}):r.jsxs(r.Fragment,{children:[f==="table"&&r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"text-sm text-muted mb-4",children:"For each employee, assign a reporting manager. Leave requests will be sent to this manager for first-level approval."}),r.jsx("div",{className:"overflow-x-auto hidden md:block border border-border rounded-lg",children:r.jsxs("table",{className:"min-w-full",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Employee"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Role"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase w-1/2",children:"Reporting Manager"})]})}),r.jsx("tbody",{className:"bg-card divide-y divide-border",children:n.map(S=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 font-medium text-primary-text",children:S.name}),r.jsx("td",{className:"px-6 py-4 text-sm text-muted capitalize",children:t.find(B=>B.id===S.role)?.displayName||S.role.replace(/_/g," ")}),r.jsx("td",{className:"px-6 py-4",children:r.jsxs(Oe,{label:"",id:`manager-for-desktop-${S.id}`,value:S.reportingManagerId||"",onChange:B=>x(S.id,B.target.value),className:"w-full",children:[r.jsx("option",{value:"",children:"None (Reports to Final Approver)"}),n.filter(B=>B.id!==S.id).map(B=>r.jsx("option",{value:B.id,children:B.name},B.id))]})})]},S.id))})]})}),r.jsx("div",{className:"space-y-3 md:hidden",children:n.map(S=>r.jsxs("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:[r.jsxs("div",{className:"p-3",children:[r.jsx("p",{className:"font-semibold text-primary-text",children:S.name}),r.jsx("p",{className:"text-sm text-muted capitalize",children:t.find(B=>B.id===S.role)?.displayName||S.role.replace(/_/g," ")})]}),r.jsxs("div",{className:"p-3 border-t border-border",children:[r.jsx("label",{className:"text-sm text-muted block mb-1",children:"Manager"}),r.jsxs(Oe,{id:`manager-for-mobile-${S.id}`,value:S.reportingManagerId||"",onChange:B=>x(S.id,B.target.value),children:[r.jsx("option",{value:"",children:"None"}),n.filter(B=>B.id!==S.id).map(B=>r.jsx("option",{value:B.id,children:B.name},B.id))]})]})]},S.id))})]}),f==="2d"&&r.jsx(Ige,{users:n})]})]})]})},fge=()=>{const n=vt(),[e,t]=k.useState([]),[s,i]=k.useState(!0);k.useEffect(()=>{(async()=>{try{const l=await ce.getUsersWithManagers();t(l)}catch(l){console.error("Failed to load users",l)}finally{i(!1)}})()},[]);const a=()=>{n("/admin/approval-workflow")};return s?r.jsx("div",{className:"w-screen h-screen flex items-center justify-center bg-slate-50",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-primary"})}):r.jsxs("div",{className:"w-screen h-screen relative bg-slate-50 overflow-hidden",children:[r.jsx("button",{onClick:a,className:"absolute top-4 right-4 z-50 p-3 bg-white rounded-full shadow-xl hover:bg-gray-50 transition-all duration-200 border border-gray-200 group",title:"Close Full Screen",children:r.jsx(Zi,{className:"h-6 w-6 text-gray-600 group-hover:text-red-500 transition-colors"})}),r.jsx(sD,{users:e})]})},cB=ga(n=>({tasks:[],isLoading:!1,error:null,fetchTasks:async()=>{n({isLoading:!0,error:null});try{const e=await ce.getTasks();n({tasks:e,isLoading:!1})}catch{n({error:"Failed to fetch tasks.",isLoading:!1})}},createTask:async e=>{try{const t=await ce.createTask(e);n(s=>({tasks:[t,...s.tasks]}))}catch(t){throw console.error("Failed to create task",t),new Error("Failed to create task.")}},updateTask:async(e,t)=>{try{const s=await ce.updateTask(e,t);n(i=>({tasks:i.tasks.map(a=>a.id===e?s:a)}))}catch(s){throw console.error("Failed to update task",s),new Error("Failed to update task.")}},deleteTask:async e=>{try{await ce.deleteTask(e),n(t=>({tasks:t.tasks.filter(s=>s.id!==e)}))}catch(t){throw console.error("Failed to delete task",t),new Error("Failed to delete task.")}},runAutomaticEscalations:async()=>{try{const{updatedTasks:e,newNotifications:t}=await ce.runAutomaticEscalations();if(e.length>0&&n(s=>({tasks:s.tasks.map(i=>e.find(a=>a.id===i.id)||i)})),t.length>0){const s=t.map(i=>ce.createNotification(i));await Promise.all(s),Sp.getState().fetchNotifications()}}catch(e){console.error("Failed to run automatic escalations",e)}}})),pge=Bt({completionNotes:pe().required("Completion notes are required").min(10,"Please provide more detail."),completionPhoto:Et().required("A photo proof of completion is required.").nullable()}).defined(),Age=({isOpen:n,onClose:e,task:t,setToast:s})=>{const{updateTask:i}=cB(),[a,o]=ot.useState(!1),{handleSubmit:l,formState:{errors:c},reset:d,control:h}=tn({resolver:Yn(pge),defaultValues:{completionNotes:"",completionPhoto:null}}),m=async f=>{o(!0);try{await i(t.id,{...f,status:"Done"}),s({message:"Task completed successfully!",type:"success"}),e()}catch{s({message:"Failed to complete task.",type:"error"})}finally{o(!1)}};return n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-lg m-4 animate-fade-in-scale",onClick:f=>f.stopPropagation(),children:r.jsxs("form",{onSubmit:l(m),children:[r.jsxs("h3",{className:"text-lg font-bold text-primary-text",children:["Complete Task: ",t.name]}),r.jsx("p",{className:"text-sm text-muted mb-4",children:"Provide a summary and photo proof of your work."}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"completionNotes",className:"block text-sm font-medium text-muted",children:"Completion Notes"}),r.jsx("textarea",{id:"completionNotes",rows:4,...h.register("completionNotes"),className:`mt-1 bg-card border ${c.completionNotes?"border-red-500":"border-border"} rounded-lg px-3 py-2.5 w-full sm:text-sm focus:ring-1 focus:ring-accent`}),c.completionNotes&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:c.completionNotes.message})]}),r.jsx(ye,{name:"completionPhoto",control:h,render:({field:f})=>r.jsx(pt,{label:"Upload Photo Proof",file:f.value,onFileChange:f.onChange,allowedTypes:["image/jpeg","image/png"]})}),c.completionPhoto&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:c.completionPhoto.message})]}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx(se,{type:"button",onClick:e,variant:"secondary",children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:a,children:"Mark as Done"})]})]})})}):null},bge=n=>{const e=new Date;e.setHours(0,0,0,0);const t=o=>o?new Date(o):null;if(n.status==="Done"||!n.dueDate)return{date:n.dueDate?He(t(n.dueDate),"dd MMM, yyyy"):"-",isOverdue:!1};let s=null;const i=t(n.dueDate);switch(n.escalationStatus){case"None":s=n.escalationLevel1DurationDays?Zl(i,n.escalationLevel1DurationDays):i;break;case"Level 1":if(n.escalationLevel1DurationDays&&n.escalationLevel2DurationDays){const o=Zl(i,n.escalationLevel1DurationDays);s=Zl(o,n.escalationLevel2DurationDays)}break;case"Level 2":if(n.escalationLevel1DurationDays&&n.escalationLevel2DurationDays&&n.escalationEmailDurationDays){const o=Zl(i,n.escalationLevel1DurationDays),l=Zl(o,n.escalationLevel2DurationDays);s=Zl(l,n.escalationEmailDurationDays)}break}s||(s=i);const a=s?s<e:!1;return{date:He(s,"dd MMM, yyyy"),isOverdue:a}},yge=()=>{const n=vt(),{user:e}=bt(),{tasks:t,isLoading:s,error:i,fetchTasks:a,deleteTask:o,runAutomaticEscalations:l}=cB(),{theme:c}=Fl(),{colorScheme:d}=an(),h=Is(d),m=c==="dark"||h.isDark,f="!text-white",p={backgroundColor:h.primary},b="text-white transition-colors",x={backgroundColor:h.activeItemBg},[v,S]=k.useState(!1),[B,V]=k.useState(!1),[R,W]=k.useState(null),[_,Y]=k.useState(null),[j,M]=k.useState([]),[H,D]=k.useState("all"),[z,O]=k.useState("all"),[E,te]=k.useState("all"),q=jt("(max-width: 767px)");k.useEffect(()=>{(async()=>{ce.getUsers().then(M),await a(),await l()})()},[a,l]);const de=()=>{n("/tasks/add")},U=ge=>{n(`/tasks/edit/${ge.id}`)},P=ge=>{W(ge),S(!0)},ne=ge=>{W(ge),V(!0)},K=async()=>{if(R)try{await o(R.id),Y({message:"Task deleted.",type:"success"}),V(!1)}catch{Y({message:"Failed to delete task.",type:"error"})}},re=k.useMemo(()=>t.filter(ge=>{if(H!=="all"&&ge.status!==H||z!=="all"&&ge.priority!==z)return!1;if(E==="unassigned"){if(ge.assignedToId)return!1}else if(E!=="all"&&ge.assignedToId!==E)return!1;return!0}),[t,H,z,E]),le=()=>{D("all"),O("all"),te("all")},ue=H!=="all"||z!=="all"||E!=="all",ae=ge=>{const xe={High:m?"bg-red-500/20 text-red-400":"bg-red-100 text-red-800",Medium:m?"bg-yellow-500/20 text-yellow-400":"bg-yellow-100 text-yellow-800",Low:m?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-800"};return r.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${xe[ge]}`,children:ge})},Ce=ge=>{const xe={"To Do":m?"bg-gray-500/20 text-gray-300":"bg-gray-100 text-gray-800","In Progress":m?"bg-indigo-500/20 text-indigo-300":"bg-indigo-100 text-indigo-800",Done:m?"bg-green-500/20 text-green-300":"bg-green-100 text-green-800"};return r.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${xe[ge]}`,children:ge})},ie=ge=>{if(ge==="None")return null;const xe={None:"","Level 1":m?"bg-orange-500/20 text-orange-400":"bg-orange-100 text-orange-800","Level 2":m?"bg-amber-500/20 text-amber-400":"bg-amber-100 text-amber-800","Email Sent":m?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-800"};return r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${xe[ge]}`,children:ge})};return r.jsxs("div",{className:`min-h-screen p-4 pb-24 md:p-6 md:rounded-xl md:shadow-card ${!q&&!m?"md:bg-card":""} ${q||m?"border border-white/10":""}`,style:{backgroundColor:q||m?h.mobileBg:void 0,color:q||m?h.isDark?"white":"#111827":void 0},children:[_&&r.jsx(It,{message:_.message,type:_.type,onDismiss:()=>Y(null)}),v&&R&&r.jsx(Age,{isOpen:v,onClose:()=>S(!1),task:R,setToast:Y}),r.jsxs(tr,{isOpen:B,onClose:()=>V(!1),onConfirm:K,title:"Confirm Deletion",children:['Are you sure you want to delete the task "',R?.name,'"?']}),r.jsx("div",{className:"mb-6",children:r.jsx("h1",{className:`text-2xl font-bold ${q||m||h.isDark?"text-white":"text-gray-900"}`,style:{color:q||m||h.isDark?"white":"#111827"},children:"Task Management"})}),r.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6 md:items-end justify-between",children:[r.jsxs("div",{className:"flex-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium",style:{color:q||m?"white":"#374151"},children:"Filter by Status"}),r.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-500",style:{backgroundColor:q||m?h.sidebarBg:"white",borderColor:q||m?h.sidebarBorder:"#d1d5db",color:q||m?"white":"#111827"},value:H,onChange:ge=>D(ge.target.value),children:[r.jsx("option",{value:"all",style:{backgroundColor:h.sidebarBg},children:"All Statuses"}),r.jsx("option",{value:"To Do",style:{backgroundColor:h.sidebarBg},children:"To Do"}),r.jsx("option",{value:"In Progress",style:{backgroundColor:h.sidebarBg},children:"In Progress"}),r.jsx("option",{value:"Done",style:{backgroundColor:h.sidebarBg},children:"Done"})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium",style:{color:q||m?"white":"#374151"},children:"Filter by Priority"}),r.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-500",style:{backgroundColor:q||m?h.sidebarBg:"white",borderColor:q||m?h.sidebarBorder:"#d1d5db",color:q||m?"white":"#111827"},value:z,onChange:ge=>O(ge.target.value),children:[r.jsx("option",{value:"all",style:{backgroundColor:h.sidebarBg},children:"All Priorities"}),r.jsx("option",{value:"Low",style:{backgroundColor:h.sidebarBg},children:"Low"}),r.jsx("option",{value:"Medium",style:{backgroundColor:h.sidebarBg},children:"Medium"}),r.jsx("option",{value:"High",style:{backgroundColor:h.sidebarBg},children:"High"})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium",style:{color:q||m?"white":"#374151"},children:"Filter by Assignee"}),r.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 outline-none focus:ring-2 focus:ring-emerald-500",style:{backgroundColor:q||m?h.sidebarBg:"white",borderColor:q||m?h.sidebarBorder:"#d1d5db",color:q||m?"white":"#111827"},value:E,onChange:ge=>te(ge.target.value),children:[r.jsx("option",{value:"all",style:{backgroundColor:h.sidebarBg},children:"All Users"}),r.jsx("option",{value:"unassigned",style:{backgroundColor:h.sidebarBg},children:"Unassigned"}),j.map(ge=>r.jsx("option",{value:ge.id,style:{backgroundColor:h.sidebarBg},children:ge.name},ge.id))]})]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 mt-4 md:mt-0",children:[ue&&r.jsxs(se,{variant:"secondary",onClick:le,className:q?"!bg-card !border-border":"!text-white !border-white/10",style:!q&&m?{backgroundColor:h.sidebarBg}:{},children:[r.jsx(Zi,{className:"mr-2 h-4 w-4"})," Clear Filters"]}),r.jsxs("button",{onClick:de,className:`flex items-center justify-center transition-colors ${q?f+" !font-bold !border-none shadow-none text-sm py-3 px-6 rounded-xl":b+" rounded-lg px-6 py-2.5 font-medium"}`,style:q?p:x,children:[r.jsx(Tt,{className:"mr-2 h-5 w-5"})," Add Task"]})]})]}),i&&r.jsx("p",{className:"text-red-500 mb-4",children:i}),r.jsxs("div",{className:"overflow-x-auto",children:[r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{className:q?"hidden":"bg-transparent border-b",style:{backgroundColor:!q&&m?"rgba(255,255,255,0.05)":void 0,color:q||m?"white":"#6b7280",borderColor:q||m?"rgba(255,255,255,0.1)":"#e5e7eb"},children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Task Name"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Priority"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Next Due Date"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Assigned To"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Status"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Escalation"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:`divide-y md:divide-y-0 ${q?"space-y-4 block":""}`,style:{borderColor:q||m?"rgba(255,255,255,0.1)":"#e5e7eb"},children:s?q?r.jsx("tr",{children:r.jsx("td",{colSpan:7,children:r.jsx(Ea,{rows:3,cols:7,isMobile:!0})})}):r.jsx(Ea,{rows:5,cols:7}):re.map(ge=>{const{date:xe,isOverdue:_e}=bge(ge);return q?r.jsxs("div",{className:"p-4 rounded-xl border mb-4",style:{backgroundColor:m?"rgba(255,255,255,0.05)":"white",borderColor:m?"rgba(255,255,255,0.1)":"#e5e7eb",color:m?"white":"#111827"},children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-lg",children:ge.name}),r.jsxs("p",{className:"text-sm mt-1",style:{color:m?"#9ca3af":"#6b7280"},children:["Due: ",r.jsx("span",{className:_e?"text-red-400 font-bold":"",children:xe||"-"})]})]}),ae(ge.priority)]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-4",children:[r.jsxs("div",{children:[r.jsx("span",{className:"block text-xs",style:{color:m?"#9ca3af":"#6b7280"},children:"Assigned To"}),r.jsx("span",{className:"",children:ge.assignedToName||"-"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"block text-xs",style:{color:m?"#9ca3af":"#6b7280"},children:"Status"}),r.jsx("span",{className:"",children:ge.status})]})]}),r.jsxs("div",{className:"flex justify-end gap-2 border-t pt-3",style:{borderColor:m?"rgba(255,255,255,0.1)":"#e5e7eb"},children:[r.jsx("button",{onClick:()=>U(ge),className:"p-2 rounded-lg transition-colors",style:{backgroundColor:m?"rgba(255,255,255,0.05)":"#f3f4f6",color:m?"#d1d5db":"#6b7280"},children:r.jsx(ms,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>ne(ge),className:"p-2 rounded-lg transition-colors",style:{backgroundColor:m?"rgba(239,68,68,0.1)":"#fef2f2",color:m?"#f87171":"#dc2626"},children:r.jsx(rn,{className:"h-4 w-4"})}),ge.assignedToId===e?.id&&ge.status!=="Done"&&r.jsxs("button",{onClick:()=>P(ge),className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:h.primary+"20",color:h.primary},children:[r.jsx(Gi,{className:"h-4 w-4 mr-1.5"})," Complete"]})]})]},ge.id):r.jsxs("tr",{className:`${_e?"bg-red-50":"hover:bg-black/5"} transition-colors`,style:!_e&&m?{backgroundColor:"transparent"}:{},children:[r.jsx("td",{"data-label":"Task Name",className:"px-6 py-4 font-medium",style:{color:m?"white":"#111827"},children:ge.name}),r.jsx("td",{"data-label":"Priority",className:"px-6 py-4",children:ae(ge.priority)}),r.jsx("td",{"data-label":"Next Due Date",className:`px-6 py-4 text-sm ${_e?"font-bold text-red-600":""}`,style:{color:_e?void 0:m?"#9ca3af":"#6b7280"},children:xe||"-"}),r.jsx("td",{"data-label":"Assigned To",className:"px-6 py-4 text-sm",style:{color:m?"#9ca3af":"#6b7280"},children:ge.assignedToName||"-"}),r.jsx("td",{"data-label":"Status",className:"px-6 py-4 text-sm",style:{color:m?"#9ca3af":"#6b7280"},children:Ce(ge.status)}),r.jsx("td",{"data-label":"Escalation",className:"px-6 py-4 text-sm",style:{color:m?"#9ca3af":"#6b7280"},children:ie(ge.escalationStatus)}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4",children:r.jsxs("div",{className:"flex items-center gap-2 justify-end md:justify-start",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>U(ge),title:"Edit Task",children:r.jsx(ms,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>ne(ge),title:"Delete Task",children:r.jsx(rn,{className:"h-4 w-4 text-red-600"})}),ge.assignedToId===e?.id&&ge.status!=="Done"&&r.jsxs(se,{variant:"outline",size:"sm",onClick:()=>P(ge),style:{borderColor:h.primary,color:h.primary},children:[r.jsx(Gi,{className:"h-4 w-4 mr-2"})," Complete"]})]})})]},ge.id)})})]}),!s&&re.length===0&&r.jsxs("div",{className:"text-center py-10 text-muted",children:[r.jsx("p",{className:q||m?"text-gray-400":"",children:"No tasks found matching your criteria."}),ue&&r.jsx(se,{variant:"secondary",size:"sm",className:"mt-2",onClick:le,children:"Clear filters"})]})]})]})},vge=Bt({id:pe().required(),name:pe().required("Client name is required"),organizationId:pe().optional(),location:pe().optional(),registeredAddress:pe().optional(),registrationType:pe().oneOf(["CIN","ROC","ROF","Society","Trust",""]).optional(),registrationNumber:pe().optional(),gstNumber:pe().optional().nullable().matches(/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/,"Invalid GST Number format").optional(),panNumber:pe().transform(n=>n?.toUpperCase()||"").matches(/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/,"Invalid PAN format").optional(),email:pe().email("Invalid email format").optional(),eShramNumber:pe().optional(),shopAndEstablishmentCode:pe().optional(),epfoCode:pe().optional(),esicCode:pe().optional(),psaraLicenseNumber:pe().optional(),psaraValidTill:pe().optional().nullable(),insuranceIds:Rr().of(pe().required()).optional(),policyIds:Rr().of(pe().required()).optional()}).defined(),xge=({isOpen:n,onClose:e,onSave:t,initialData:s,companyName:i})=>{const[a,o]=k.useState("General"),[l,c]=k.useState([]),[d,h]=k.useState([]),[m,f]=k.useState(!0),{register:p,handleSubmit:b,formState:{errors:x},reset:v,control:S}=tn({resolver:Yn(vge)}),B=!!s;k.useEffect(()=>{n&&(f(!0),Promise.all([ce.getPolicies(),ce.getInsurances()]).then(([W,_])=>{c(W),h(_),f(!1)}),v(s||{id:`new_${Date.now()}`,name:"",location:"",registeredAddress:"",registrationType:"",registrationNumber:"",gstNumber:"",panNumber:"",email:"",eShramNumber:"",shopAndEstablishmentCode:"",epfoCode:"",esicCode:"",psaraLicenseNumber:"",psaraValidTill:"",insuranceIds:[],policyIds:[]}))},[s,v,n]);const V=W=>{t(W)};if(!n)return null;const R=({tabName:W})=>r.jsx("button",{type:"button",onClick:()=>o(W),className:`px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 ${a===W?"border-accent text-accent":"border-transparent text-muted hover:text-primary-text"}`,children:W});return r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 p-4",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-3xl my-8 mx-auto animate-fade-in-scale",onClick:W=>W.stopPropagation(),children:r.jsxs("form",{onSubmit:b(V),children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:B?"Edit Client":"Add New Client"}),r.jsxs("p",{className:"text-sm text-muted",children:["for ",i]})]}),r.jsx("div",{className:"border-b border-border mb-6",children:r.jsxs("nav",{className:"-mb-px flex space-x-4",children:[r.jsx(R,{tabName:"General"}),r.jsx(R,{tabName:"Registration"}),r.jsx(R,{tabName:"Compliance"}),r.jsx(R,{tabName:"Policies & Insurance"})]})}),r.jsxs("div",{className:"space-y-6 min-h-[300px]",children:[a==="General"&&r.jsxs("div",{className:"space-y-4",children:[r.jsx(be,{label:"Client Name (as per document)",id:"name",registration:p("name"),error:x.name?.message}),r.jsx(be,{label:"Location / City",id:"location",registration:p("location"),error:x.location?.message}),r.jsx(be,{label:"Registered Address",id:"registeredAddress",registration:p("registeredAddress"),error:x.registeredAddress?.message})]}),a==="Registration"&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[r.jsxs(Oe,{label:"Registration Type",id:"registrationType",registration:p("registrationType"),error:x.registrationType?.message,children:[r.jsx("option",{value:"",children:"Select Type"}),r.jsx("option",{value:"CIN",children:"CIN"}),r.jsx("option",{value:"ROC",children:"ROC"}),r.jsx("option",{value:"ROF",children:"ROF"}),r.jsx("option",{value:"Society",children:"Society"}),r.jsx("option",{value:"Trust",children:"Trust"})]}),r.jsx(be,{label:"Registration Number",id:"registrationNumber",registration:p("registrationNumber"),error:x.registrationNumber?.message}),r.jsx(be,{label:"GST Number",id:"gstNumber",registration:p("gstNumber"),error:x.gstNumber?.message}),r.jsx(be,{label:"PAN Number",id:"panNumber",registration:p("panNumber"),error:x.panNumber?.message}),r.jsx(be,{label:"Email Address",id:"email",type:"email",registration:p("email"),error:x.email?.message})]}),a==="Compliance"&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[r.jsx(be,{label:"E-Shram Number",id:"eShramNumber",registration:p("eShramNumber"),error:x.eShramNumber?.message}),r.jsx(be,{label:"Shop & Establishment Code",id:"shopAndEstablishmentCode",registration:p("shopAndEstablishmentCode"),error:x.shopAndEstablishmentCode?.message}),r.jsx(be,{label:"EPFO Code",id:"epfoCode",registration:p("epfoCode"),error:x.epfoCode?.message}),r.jsx(be,{label:"ESIC Code",id:"esicCode",registration:p("esicCode"),error:x.esicCode?.message}),r.jsx(be,{label:"PSARA License Number",id:"psaraLicenseNumber",registration:p("psaraLicenseNumber"),error:x.psaraLicenseNumber?.message}),r.jsx(ye,{name:"psaraValidTill",control:S,render:({field:W})=>r.jsx(Vn,{label:"PSARA Valid Till",id:"psaraValidTill",value:W.value,onChange:W.onChange,error:x.psaraValidTill?.message})})]}),a==="Policies & Insurance"&&(m?r.jsx(xt,{className:"mx-auto h-6 w-6 animate-spin text-muted"}):r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsx(ye,{name:"policyIds",control:S,render:({field:W})=>r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"Policies"}),r.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-page",children:l.map(_=>r.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-card transition-colors",children:[r.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",checked:W.value?.includes(_.id),onChange:Y=>{const j=Y.target.checked?[...W.value||[],_.id]:(W.value||[]).filter(M=>M!==_.id);W.onChange(j)}}),r.jsx("span",{className:"ml-3 text-sm",children:_.name})]},_.id))})]})}),r.jsx(ye,{name:"insuranceIds",control:S,render:({field:W})=>r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold mb-2",children:"Insurance"}),r.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto p-3 border rounded-lg bg-page",children:d.map(_=>r.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-card transition-colors",children:[r.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",checked:W.value?.includes(_.id),onChange:Y=>{const j=Y.target.checked?[...W.value||[],_.id]:(W.value||[]).filter(M=>M!==_.id);W.onChange(j)}}),r.jsxs("span",{className:"ml-3 text-sm",children:[_.type," - ",_.provider]})]},_.id))})]})})]}))]}),r.jsxs("div",{className:"mt-8 pt-6 border-t border-border flex justify-end space-x-3",children:[r.jsx(se,{type:"button",onClick:e,variant:"secondary",children:"Cancel"}),r.jsx(se,{type:"submit",children:B?"Save Changes":"Add Client"})]})]})})})},gf=({number:n,title:e,children:t})=>r.jsxs("div",{children:[r.jsxs("h4",{className:"font-bold text-lg text-primary-text mb-2",children:["Step ",n,": ",e]}),r.jsx("div",{className:"text-sm text-muted space-y-2",children:t})]}),Sge=({isOpen:n,onClose:e})=>n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-3xl my-8 animate-fade-in-scale flex flex-col",onClick:t=>t.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b flex items-center gap-3",children:[r.jsx(Cr,{className:"h-6 w-6 text-accent"}),r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"How to Use Import Templates"})]}),r.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-6 max-h-[70vh]",children:[r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(ca,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-bold text-red-800",children:"The Golden Rule: Do Not Modify the Template Structure"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"You must **NEVER** add, delete, rename, or reorder columns. Any changes to the header row will cause the import to fail. This rule ensures data integrity."})]})]})}),r.jsxs(gf,{number:1,title:"Get the Template",children:[r.jsx("p",{children:"You have two options for getting a file to work with:"}),r.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[r.jsxs("li",{children:[r.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[r.jsx(Cr,{className:"h-4 w-4"})," Download Template:"]}),r.jsx("span",{children:"Provides a blank CSV file with only the correct header row. Use this for adding **new** records in bulk."})]}),r.jsxs("li",{children:[r.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[r.jsx(gH,{className:"h-4 w-4"})," Export Data:"]}),r.jsx("span",{children:"Provides a CSV file filled with all the current data from the system. Use this for **updating existing** records in bulk."})]})]})]}),r.jsx(gf,{number:2,title:"Edit Your Data",children:r.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[r.jsxs("li",{children:[r.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[r.jsx(ms,{className:"h-4 w-4"})," To Update Existing Data:"]}),r.jsx("span",{children:"Use the file from **Export Data**. Find the row you want to change and edit its values. Do **NOT** edit the ID columns (e.g., `GroupId`, `EntityId`). These are used by the system to identify records."})]}),r.jsxs("li",{children:[r.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[r.jsx(Tt,{className:"h-4 w-4"})," To Add New Data:"]}),r.jsx("span",{children:"Add a new row at the bottom of the file. Leave the ID columns blank; the system will generate them automatically. Fill in all other required information."})]}),r.jsxs("li",{children:[r.jsx("strong",{className:"text-primary-text",children:"Complex Data (JSON):"}),r.jsx("span",{children:"For Site Configuration, some columns like `agreementDetails` contain complex data. This is exported as a JSON text string. Only edit this text if you are familiar with JSON, as incorrect formatting will cause the import to fail."})]})]})}),r.jsx(gf,{number:3,title:"Save and Import",children:r.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[r.jsxs("li",{children:[r.jsx("strong",{className:"text-primary-text",children:"Save as CSV:"}),r.jsx("span",{children:"After making your changes, save your file. If you are using Excel or Google Sheets, make sure to **Save As** or **Download As** a **CSV (Comma-Separated Values)** file."})]}),r.jsxs("li",{children:[r.jsxs("strong",{className:"text-primary-text flex items-center gap-2",children:[r.jsx(e$,{className:"h-4 w-4"})," Import:"]}),r.jsx("span",{children:"Go back to the application, click **Import**, and select the CSV file you just saved."})]})]})}),r.jsx(gf,{number:4,title:"Review Feedback",children:r.jsxs("ul",{className:"list-disc list-inside pl-4 space-y-2",children:[r.jsxs("li",{children:[r.jsxs("strong",{className:"text-green-600 flex items-center gap-2",children:[r.jsx(Gi,{className:"h-4 w-4"})," Success:"]}),r.jsx("span",{children:"You will see a success message indicating how many records were imported."})]}),r.jsxs("li",{children:[r.jsxs("strong",{className:"text-red-600 flex items-center gap-2",children:[r.jsx(ca,{className:"h-4 w-4"})," Error:"]}),r.jsx("span",{children:'If the import fails, a specific error message will appear. The most common error is a "Header mismatch," which means you have violated the Golden Rule. If this happens, download a fresh template and carefully copy your data into it.'})]})]})})]}),r.jsx("div",{className:"p-4 border-t flex justify-end",children:r.jsx(se,{onClick:e,children:"Close"})})]})}):null,bd=({title:n})=>r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 bg-page rounded-lg min-h-[400px]",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text mb-2",children:n}),r.jsx("p",{className:"text-muted max-w-sm",children:"Configuration for this section will be available here. The form details will be provided in a future update."})]}),_Y=["Site Name","Designation","Quantity","Billing Rate","Billing Model","Holiday Billing Policy","Holiday Payment Policy","Uniform Deduction"],wge=n=>{if(n.length===0)return"";const e=Object.keys(n[0]);return[e.join(","),...n.map(s=>e.map(i=>{const a=String(s[i]??"");return a.includes(",")||a.includes('"')||a.includes(`
`)?`"${a.replace(/"/g,'""')}"`:a}).join(","))].join(`
`)},Zge=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)return[];const t=e[0].split(",").map(i=>i.trim()),s=[];for(let i=1;i<e.length;i++){const a={},o=e[i].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];t.forEach((l,c)=>{let d=(o[c]||"").trim();d.startsWith('"')&&d.endsWith('"')&&(d=d.substring(1,d.length-1).replace(/""/g,'""')),a[l]=d}),s.push(a)}return s},Gge=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),[i,a]=k.useState(!1),[o,l]=k.useState({}),[c,d]=k.useState(null),h=k.useRef(null),{register:m,control:f,handleSubmit:p,watch:b,setValue:x}=tn({defaultValues:{resources:[],serviceChargePercentage:10}}),{fields:v,append:S,remove:B,replace:V}=Wr({control:f,name:"resources"});k.useEffect(()=>{ce.getOrganizations().then(e).finally(()=>s(!1))},[]);const R=async te=>{if(!te){V([]);return}a(!0);try{const q=await ce.getManpowerDetails(te),de=q.filter(U=>U.count>0).map(U=>({id:`res_${U.designation.replace(/\s/g,"_")}_${Date.now()}`,siteId:te,designation:U.designation,quantity:U.count,billingRate:null,billingModel:"Per Month",holidayBillingPolicy:"",holidayPaymentPolicy:"",uniformDeduction:"Yes"}));if(!o[te]){const U=q.map(P=>P.designation);l(P=>({...P,[te]:U}))}V(de)}catch(q){console.error("Failed to load manpower",q),d({message:"Failed to load manpower details.",type:"error"})}finally{a(!1)}},W=async(te,q)=>{if(x(`resources.${q}.designation`,""),te&&!o[te])try{const U=(await ce.getManpowerDetails(te)).map(P=>P.designation);l(P=>({...P,[te]:U}))}catch(de){console.error(`Failed to load designations for site ${te}`,de)}},_=b("resources"),Y=b("serviceChargePercentage"),j=()=>{S({id:`res_${Date.now()}`,siteId:"",designation:"",quantity:1,billingRate:0,billingModel:"Per Month",holidayBillingPolicy:"",holidayPaymentPolicy:"",uniformDeduction:"Yes"})},{subTotal:M,serviceCharge:H,grandTotal:D}=ot.useMemo(()=>{const q=(Array.isArray(_)?_:[]).reduce((ne,K)=>{const re=Number(K.quantity)||0,le=Number(K.billingRate)||0;return ne+re*le},0),de=Number(Y)||0,U=q*(de/100),P=q+U;return{subTotal:q,serviceCharge:U,grandTotal:P}},[_,Y]),z=()=>{const te=[Object.fromEntries(_Y.map(P=>[P,""]))],q=wge(te),de=new Blob([q],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a");U.href=URL.createObjectURL(de),U.setAttribute("download","costing_resource_template.csv"),document.body.appendChild(U),U.click(),document.body.removeChild(U)},O=te=>{const q=te.target.files?.[0];if(!q)return;const de=new FileReader;de.onload=async U=>{try{const P=U.target?.result;if(!P)throw new Error("File is empty.");const ne=Zge(P);if(ne.length===0)throw new Error("No data rows found in CSV.");const K=Object.keys(ne[0]);if(!_Y.every(ie=>K.includes(ie)))throw new Error("CSV file is missing required headers.");const le=new Map(n.map(ie=>[ie.shortName.toLowerCase(),ie.id])),ue=new Set;for(const ie of ne){const ge=ie["Site Name"]?.trim().toLowerCase();if(ge){const xe=le.get(ge);typeof xe=="string"&&ue.add(xe)}}const ae=[...ue].filter(ie=>!o[ie]);if(ae.length>0){const ie=ae.map(xe=>ce.getManpowerDetails(xe).then(_e=>({siteId:xe,designations:_e.map(Be=>Be.designation)}))),ge=await Promise.all(ie);l(xe=>{const _e={...xe};return ge.forEach(Be=>{_e[Be.siteId]=Be.designations}),_e})}const Ce=ne.map(ie=>{const ge=ie["Site Name"]?.trim().toLowerCase(),xe=ge?le.get(ge):void 0;return xe?{id:`res_imported_${Date.now()}_${Math.random()}`,siteId:xe,designation:ie.Designation||"",quantity:parseFloat(ie.Quantity)||0,billingRate:parseFloat(ie["Billing Rate"])||0,billingModel:ie["Billing Model"]||"Per Month",holidayBillingPolicy:ie["Holiday Billing Policy"]||"",holidayPaymentPolicy:ie["Holiday Payment Policy"]||"",uniformDeduction:ie["Uniform Deduction"]||"Yes"}:null}).filter(ie=>ie!==null);V(Ce),d({message:`Successfully imported ${Ce.length} resources.`,type:"success"})}catch(P){d({message:P.message||"Failed to import CSV.",type:"error"})}finally{te.target&&(te.target.value="")}},de.readAsText(q)},E=te=>{console.log("Saving Costing & Resource Data:",te),d({message:"Configuration saved successfully (mocked).",type:"success"})};return r.jsxs("form",{onSubmit:p(E),className:"space-y-6",children:[c&&r.jsx(It,{message:c.message,type:c.type,onDismiss:()=>d(null)}),r.jsx("input",{type:"file",ref:h,className:"hidden",accept:".csv",onChange:O}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Costing & Resource Configuration"}),r.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[r.jsxs(Oe,{label:"Load Manpower from Site",id:"site-selector",onChange:te=>R(te.target.value),disabled:t||i,children:[r.jsx("option",{value:"",children:"-- Select a Site --"}),n.map(te=>r.jsx("option",{value:te.id,children:te.shortName},te.id))]}),i&&r.jsx(xt,{className:"absolute right-3 top-9 h-5 w-5 animate-spin text-muted"})]})]}),r.jsxs("div",{className:"grid grid-cols-4 gap-2 md:flex md:flex-wrap md:justify-end md:gap-2",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:z,className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Download Template",children:[r.jsx(si,{className:"h-5 w-5 md:mr-2"}),r.jsx("span",{className:"hidden md:inline",children:"Template"})]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>h.current?.click(),className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Import",children:[r.jsx(td,{className:"h-5 w-5 md:mr-2"}),r.jsx("span",{className:"hidden md:inline",children:"Import"})]}),r.jsxs(se,{type:"button",variant:"outline",onClick:j,className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Add Resource",children:[r.jsx(Tt,{className:"h-5 w-5 md:mr-2"}),r.jsx("span",{className:"hidden md:inline",children:"Add Resource"})]}),r.jsxs(se,{type:"submit",className:"!p-2 justify-center md:!px-4 md:!py-2",title:"Save",children:[r.jsx(fr,{className:"h-5 w-5 md:mr-2"}),r.jsx("span",{className:"hidden md:inline",children:"Save"})]})]}),r.jsx("div",{className:"space-y-4",children:v.map((te,q)=>{const de=b(`resources.${q}.siteId`);return r.jsxs("div",{className:"p-4 border border-border rounded-xl relative bg-page/50",children:[r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>B(q),className:"absolute top-2 right-2","aria-label":"Remove Resource",children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[r.jsx(ye,{control:f,name:`resources.${q}.siteId`,render:({field:U})=>r.jsxs(Oe,{label:"Site",id:`res-site-${q}`,...U,onChange:P=>{U.onChange(P),W(P.target.value,q)},children:[r.jsx("option",{value:"",children:"Select Site"}),n.map(P=>r.jsx("option",{value:P.id,children:P.shortName},P.id))]})}),r.jsxs(Oe,{label:"Designation",id:`res-desig-${q}`,...m(`resources.${q}.designation`),disabled:!de,children:[r.jsx("option",{value:"",children:"Select Designation"}),(o[de]||[]).map(U=>r.jsx("option",{value:U,children:U},U))]}),r.jsx(be,{label:"Quantity",id:`res-qty-${q}`,type:"number",step:"0.01",...m(`resources.${q}.quantity`)}),r.jsx(be,{label:"Billing Rate",id:`res-rate-${q}`,type:"number",step:"0.01",...m(`resources.${q}.billingRate`)}),r.jsxs(Oe,{label:"Billing Model",id:`res-billing-${q}`,...m(`resources.${q}.billingModel`),children:[r.jsx("option",{children:"Per Month"}),r.jsx("option",{children:"Per Day"}),r.jsx("option",{children:"Per Hour"}),r.jsx("option",{children:"Lumpsum"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:`res-hol-bill-${q}`,className:"block text-sm font-medium text-muted",children:"Holiday Billing Policy"}),r.jsx("textarea",{id:`res-hol-bill-${q}`,...m(`resources.${q}.holidayBillingPolicy`),rows:3,className:"mt-1 form-input"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:`res-hol-pay-${q}`,className:"block text-sm font-medium text-muted",children:"Holiday Payment Policy"}),r.jsx("textarea",{id:`res-hol-pay-${q}`,...m(`resources.${q}.holidayPaymentPolicy`),rows:3,className:"mt-1 form-input"})]}),r.jsxs(Oe,{label:"Uniform Deduction",id:`res-uniform-${q}`,...m(`resources.${q}.uniformDeduction`),children:[r.jsx("option",{children:"Yes"}),r.jsx("option",{children:"No"})]})]})]},te.id)})}),v.length>0&&r.jsx("div",{className:"flex justify-end pt-4 border-t border-border",children:r.jsxs("div",{className:"w-full max-w-sm space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center text-sm",children:[r.jsx("span",{className:"text-muted font-medium",children:"Sub Total"}),r.jsx("span",{className:"font-semibold text-primary-text",children:M.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]}),r.jsxs("div",{className:"flex justify-between items-center text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-muted font-medium",children:"Service Charges"}),r.jsx("div",{className:"w-20",children:r.jsx(be,{"aria-label":"Service charge percentage",id:"service-charge-perc",type:"number",...m("serviceChargePercentage")})}),r.jsx("span",{className:"text-muted font-medium",children:"%"})]}),r.jsx("span",{className:"font-semibold text-primary-text",children:H.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]}),r.jsxs("div",{className:"flex justify-between items-center pt-2 mt-2 border-t-2 border-primary-text",children:[r.jsx("span",{className:"font-bold text-lg",children:"Grand Total"}),r.jsx("span",{className:"font-bold text-lg",children:D.toLocaleString("en-IN",{style:"currency",currency:"INR"})})]})]})}),v.length===0&&r.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:t?r.jsx(xt,{className:"h-5 w-5 animate-spin mx-auto"}):'Select a site to load manpower or click "Add Resource" to begin.'})]})},rD=["Department","Designation","PermanentId","TemporaryId"],Bge=n=>{const e=rD.join(","),t=n.map(s=>[s.department,s.designation,s.permanentId,s.temporaryId].map(i=>{const a=String(i??"");return a.includes(",")?`"${a}"`:a}).join(","));return[e,...t].join(`
`)},Nge=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)return[];const t=e[0].split(",").map(i=>i.trim());if(!["Department","Designation","PermanentId","TemporaryId"].every(i=>t.includes(i)))throw new Error("CSV is missing required headers.");return e.slice(1).map(i=>{const a=i.split(","),o={};return t.forEach((l,c)=>{l==="Department"&&(o.department=a[c]),l==="Designation"&&(o.designation=a[c]),l==="PermanentId"&&(o.permanentId=a[c]),l==="TemporaryId"&&(o.temporaryId=a[c])}),o})},kge=()=>{const[n,e]=k.useState(!0),[t,s]=k.useState(null),i=k.useRef(null),{register:a,control:o,handleSubmit:l,reset:c,watch:d}=tn({defaultValues:{series:[]}}),{append:h,remove:m,replace:f}=Wr({control:o,name:"series"});k.useEffect(()=>{e(!0),ce.getBackOfficeIdSeries().then(R=>c({series:R})).catch(()=>s({message:"Failed to load data.",type:"error"})).finally(()=>e(!1))},[c]);const p=d("series"),b=k.useMemo(()=>Array.isArray(p)?p.reduce((R,W,_)=>{const Y=W.department||"Uncategorized";return R[Y]||(R[Y]=[]),R[Y].push({...W,originalIndex:_}),R},{}):{},[p]),x=()=>{h({id:`new_${Date.now()}`,department:"",designation:"",permanentId:"",temporaryId:""})},v=async R=>{try{await ce.updateBackOfficeIdSeries(R.series),s({message:"Configuration saved successfully.",type:"success"})}catch{s({message:"Failed to save configuration.",type:"error"})}},S=()=>{if(!Array.isArray(p)||p.length===0){s({message:"No data to export.",type:"error"});return}const R=Bge(p),W=new Blob([R],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(W),_.setAttribute("download","back_office_id_series.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_)},B=()=>{const R=rD.join(","),W=new Blob([R],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(W),_.setAttribute("download","id_series_template.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_)},V=R=>{const W=R.target.files?.[0];if(!W)return;const _=new FileReader;_.onload=Y=>{try{const j=Y.target?.result,H=Nge(j).map(D=>({id:`imported_${Date.now()}_${Math.random()}`,department:D.department||"",designation:D.designation||"",permanentId:D.permanentId||"",temporaryId:D.temporaryId||""}));f(H),s({message:`Imported ${H.length} records.`,type:"success"})}catch(j){s({message:j.message||"Failed to import CSV.",type:"error"})}finally{R.target&&(R.target.value="")}},_.readAsText(W)};return r.jsxs("form",{onSubmit:l(v),className:"bg-card p-6 rounded-xl shadow-card",children:[t&&r.jsx(It,{message:t.message,type:t.type,onDismiss:()=>s(null)}),r.jsx("input",{type:"file",ref:i,className:"hidden",accept:".csv",onChange:V}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Back Office Department & Emp ID Series"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:B,children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Template"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>i.current?.click(),children:[r.jsx(td,{className:"mr-2 h-4 w-4"})," Import"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:S,children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export"]}),r.jsxs(se,{type:"submit",children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),r.jsx("div",{className:"space-y-6",children:n?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):Object.keys(b).length===0?r.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No ID series defined. Click "Add Designation" to begin.'}):Object.entries(b).map(([R,W])=>r.jsxs("div",{className:"border border-border rounded-xl",children:[r.jsx("div",{className:"p-4 bg-page rounded-t-xl",children:r.jsx(be,{"aria-label":`Department for ${R}`,id:`series.${W[0].originalIndex}.department`,...a(`series.${W[0].originalIndex}.department`),className:"font-semibold text-lg !border-0 !p-0 !bg-transparent focus:!ring-0"})}),r.jsx("div",{className:"space-y-3 p-4",children:Array.isArray(W)&&W.map(_=>r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-10 gap-2 items-center",children:[r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Designation","aria-label":`Designation for ${R}`,id:`series.${_.originalIndex}.designation`,...a(`series.${_.originalIndex}.designation`)})}),r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Permanent ID","aria-label":`Permanent ID for ${_.designation}`,id:`series.${_.originalIndex}.permanentId`,...a(`series.${_.originalIndex}.permanentId`)})}),r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Temporary ID","aria-label":`Temporary ID for ${_.designation}`,id:`series.${_.originalIndex}.temporaryId`,...a(`series.${_.originalIndex}.temporaryId`)})}),r.jsx("div",{className:"md:col-span-1 text-right",children:r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>m(_.originalIndex),"aria-label":`Remove ${_.designation}`,title:`Remove ${_.designation}`,children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})})]},_.id))})]},R))}),r.jsxs(se,{type:"button",onClick:x,variant:"outline",className:"mt-6",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Designation"]})]})},cp=["Department","Designation","PermanentId","TemporaryId","MonthlySalary"],Rge=n=>{const e=cp.join(","),t=n.map(s=>[s.department,s.designation,s.permanentId,s.temporaryId,s.monthlySalary].map(i=>{const a=String(i??"");return a.includes(",")||a.includes('"')||a.includes(`
`)?`"${a.replace(/"/g,'""')}"`:a}).join(","));return[e,...t].join(`
`)},Wge=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)return[];const t=e[0].split(",").map(i=>i.trim().replace(/"/g,""));if(!cp.every(i=>t.includes(i)))throw new Error(`CSV is missing required headers: ${cp.join(", ")}`);const s=[];for(let i=1;i<e.length;i++){const a={},o=e[i].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];t.forEach((c,d)=>{let h=(o[d]||"").trim();h.startsWith('"')&&h.endsWith('"')&&(h=h.substring(1,h.length-1).replace(/""/g,'""')),a[c]=h});const l=parseFloat(a.MonthlySalary);s.push({department:a.Department,designation:a.Designation,permanentId:a.PermanentId,temporaryId:a.TemporaryId,monthlySalary:isNaN(l)?null:l})}return s},Vge=()=>{const[n,e]=k.useState(!0),[t,s]=k.useState(null),i=k.useRef(null),{register:a,control:o,handleSubmit:l,reset:c,watch:d}=tn({defaultValues:{designations:[]}}),{append:h,remove:m,replace:f}=Wr({control:o,name:"designations"});k.useEffect(()=>{e(!0),ce.getSiteStaffDesignations().then(R=>c({designations:R})).catch(()=>s({message:"Failed to load data.",type:"error"})).finally(()=>e(!1))},[c]);const p=d("designations"),b=k.useMemo(()=>Array.isArray(p)?p.reduce((R,W,_)=>{const Y=W.department||"Uncategorized";return R[Y]||(R[Y]=[]),R[Y].push({...W,originalIndex:_}),R},{}):{},[p]),x=()=>{h({id:`new_${Date.now()}`,department:"",designation:"",permanentId:"",temporaryId:"",monthlySalary:null})},v=async R=>{try{await ce.updateSiteStaffDesignations(R.designations),s({message:"Configuration saved successfully.",type:"success"})}catch{s({message:"Failed to save configuration.",type:"error"})}},S=()=>{if(!Array.isArray(p)||p.length===0){s({message:"No data to export.",type:"error"});return}const R=Rge(p),W=new Blob([R],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(W),_.setAttribute("download","site_staff_designations.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_)},B=()=>{const R=cp.join(","),W=new Blob([R],{type:"text/csv;charset=utf-8;"}),_=document.createElement("a");_.href=URL.createObjectURL(W),_.setAttribute("download","site_staff_template.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_)},V=R=>{const W=R.target.files?.[0];if(!W)return;const _=new FileReader;_.onload=Y=>{try{const j=Y.target?.result,H=Wge(j).map(D=>({id:`imported_${Date.now()}_${Math.random()}`,department:D.department||"",designation:D.designation||"",permanentId:D.permanentId||"",temporaryId:D.temporaryId||"",monthlySalary:D.monthlySalary||null}));f(H),s({message:`Imported ${H.length} records.`,type:"success"})}catch(j){s({message:j.message||"Failed to import CSV.",type:"error"})}finally{R.target&&(R.target.value="")}},_.readAsText(W)};return r.jsxs("form",{onSubmit:l(v),className:"bg-card p-6 rounded-xl shadow-card",children:[t&&r.jsx(It,{message:t.message,type:t.type,onDismiss:()=>s(null)}),r.jsx("input",{type:"file",ref:i,className:"hidden",accept:".csv",onChange:V}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[r.jsx("h4",{className:"text-lg font-semibold text-primary-text",children:"Staff Designation & ID Series"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:B,children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Template"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>i.current?.click(),children:[r.jsx(td,{className:"mr-2 h-4 w-4"})," Import"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:S,children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export"]}),r.jsxs(se,{type:"submit",children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),r.jsx("div",{className:"space-y-6",children:n?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):Object.keys(b).length===0?r.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No designations defined. Click "Add Designation" to begin.'}):Object.entries(b).map(([R,W])=>r.jsxs("div",{className:"border border-border rounded-xl",children:[r.jsx("div",{className:"p-4 bg-page rounded-t-xl",children:r.jsx(be,{"aria-label":`Department for ${R}`,id:`designations.${W[0].originalIndex}.department`,...a(`designations.${W[0].originalIndex}.department`),className:"font-semibold text-lg !border-0 !p-0 !bg-transparent focus:!ring-0"})}),r.jsx("div",{className:"space-y-3 p-4",children:Array.isArray(W)&&W.map(_=>r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 items-center",children:[r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Designation","aria-label":`Designation for ${R}`,id:`designations.${_.originalIndex}.designation`,...a(`designations.${_.originalIndex}.designation`)})}),r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Permanent ID","aria-label":`Permanent ID for ${_.designation}`,id:`designations.${_.originalIndex}.permanentId`,...a(`designations.${_.originalIndex}.permanentId`)})}),r.jsx("div",{className:"md:col-span-2",children:r.jsx(be,{placeholder:"Temporary ID","aria-label":`Temporary ID for ${_.designation}`,id:`designations.${_.originalIndex}.temporaryId`,...a(`designations.${_.originalIndex}.temporaryId`)})}),r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{placeholder:"Monthly Salary (Gross)","aria-label":`Salary for ${_.designation}`,id:`designations.${_.originalIndex}.monthlySalary`,type:"number",...a(`designations.${_.originalIndex}.monthlySalary`,{valueAsNumber:!0})})}),r.jsx("div",{className:"md:col-span-1 text-right",children:r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>m(_.originalIndex),"aria-label":`Remove ${_.designation}`,title:`Remove ${_.designation}`,children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})})]},_.id))})]},R))}),r.jsxs(se,{type:"button",onClick:x,variant:"outline",className:"mt-4",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Designation"]})]})},_ge=({id:n,label:e,checked:t,onChange:s,description:i,disabled:a})=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"flex-grow flex flex-col",children:[r.jsx("span",{className:"text-sm font-medium text-primary-text",children:e}),i&&r.jsx("span",{className:"text-sm text-muted",children:i})]}),r.jsxs("div",{className:"relative inline-flex items-center cursor-pointer",children:[r.jsx("input",{type:"checkbox",id:n,className:"sr-only peer",checked:t,onChange:o=>s(o.target.checked),disabled:a}),r.jsx("div",{className:"w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-accent-dark peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent"})]})]}),jZ=["Applicability","OptInDisclaimer","CoverageDetails","OptOutDisclaimer","RequireAlternateInsurance","CollectProvider","CollectStartDate","CollectEndDate","CollectExtentOfCover"],jge={applicability:"Optional - Opt-in Default",optInDisclaimer:"",coverageDetails:"",optOutDisclaimer:"",requireAlternateInsurance:!1,collectProvider:!1,collectStartDate:!1,collectEndDate:!1,collectExtentOfCover:!1},Xge=n=>{const e=jZ.join(","),t=jZ.map(s=>{const i=s.charAt(0).toLowerCase()+s.slice(1);let a=n[i];return typeof a=="string"&&(a.includes(",")||a.includes(`
`)||a.includes('"'))?`"${a.replace(/"/g,'""')}"`:a});return[e,t.join(",")].join(`
`)},Jge=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)throw new Error("CSV file must have a header and at least one data row.");const t=e[0].split(",").map(a=>a.trim()),s=e[1].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[],i={};return t.forEach((a,o)=>{const l=a.charAt(0).toLowerCase()+a.slice(1);let c=(s[o]||"").trim();c.startsWith('"')&&c.endsWith('"')&&(c=c.substring(1,c.length-1).replace(/""/g,'""')),l==="applicability"?i[l]=c:typeof jge[l]=="boolean"?i[l]=c.toLowerCase()==="true":i[l]=c}),i},uf=({label:n,...e})=>r.jsxs("label",{className:"flex items-center gap-2 text-sm text-muted",children:[r.jsx("input",{type:"checkbox",className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent",...e}),n]}),Yge=()=>{const{gmcPolicy:n,updateGmcPolicySettings:e}=wi(),[t,s]=k.useState(null),i=k.useRef(null),{register:a,handleSubmit:o,control:l,watch:c,reset:d,formState:{isDirty:h}}=tn({defaultValues:n});k.useEffect(()=>{d(n)},[n,d]);const m=c("requireAlternateInsurance"),f=c("applicability")==="Mandatory",p=S=>{e(S),s({message:"GMC policy settings saved.",type:"success"})},b=()=>{const S=Xge(n),B=new Blob([S],{type:"text/csv;charset=utf-8;"}),V=document.createElement("a");V.href=URL.createObjectURL(B),V.setAttribute("download","gmc_policy_settings.csv"),document.body.appendChild(V),V.click(),document.body.removeChild(V)},x=()=>{const S=jZ.join(","),B=new Blob([S],{type:"text/csv;charset=utf-8;"}),V=document.createElement("a");V.href=URL.createObjectURL(B),V.setAttribute("download","gmc_policy_template.csv"),document.body.appendChild(V),V.click(),document.body.removeChild(V)},v=S=>{const B=S.target.files?.[0];if(!B)return;const V=new FileReader;V.onload=R=>{try{const W=R.target?.result,_=Jge(W);d(_),s({message:"Settings imported from CSV. Review and save.",type:"success"})}catch(W){s({message:W.message||"Failed to import CSV.",type:"error"})}finally{S.target&&(S.target.value="")}},V.readAsText(B)};return r.jsxs("form",{onSubmit:o(p),className:"bg-card p-6 rounded-xl shadow-card",children:[t&&r.jsx(It,{message:t.message,type:t.type,onDismiss:()=>s(null)}),r.jsx("input",{type:"file",ref:i,className:"hidden",accept:".csv",onChange:v}),r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"GMC Policy Configuration"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:x,children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Template"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>i.current?.click(),children:[r.jsx(td,{className:"mr-2 h-4 w-4"})," Import"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:b,children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export"]}),r.jsxs(se,{type:"submit",disabled:!h,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save"]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{children:r.jsx(ye,{name:"applicability",control:l,render:({field:S})=>r.jsxs(Oe,{label:"Applicability",...S,children:[r.jsx("option",{children:"Mandatory"}),r.jsx("option",{children:"Optional - Opt-in Default"}),r.jsx("option",{children:"Optional - Opt-out Default"})]})})}),r.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:"Opt-In Details"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted",children:"Opt-In Disclaimer"}),r.jsx("textarea",{...a("optInDisclaimer"),rows:3,className:"form-input mt-1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted",children:"Coverage Details"}),r.jsx("textarea",{...a("coverageDetails"),rows:2,className:"form-input mt-1"})]})]}),!f&&r.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:"Opt-Out Details"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted",children:"Opt-Out Disclaimer"}),r.jsx("textarea",{...a("optOutDisclaimer"),rows:3,className:"form-input mt-1"})]}),r.jsx(ye,{name:"requireAlternateInsurance",control:l,render:({field:S})=>r.jsx(_ge,{id:"require-alt-ins",label:"Require proof of alternate insurance on opt-out",checked:S.value,onChange:S.onChange})}),m&&r.jsxs("div",{className:"p-4 bg-page rounded-lg space-y-3",children:[r.jsx("p",{className:"text-sm text-muted",children:"Collect the following from employees who opt out:"}),r.jsx(ye,{name:"collectProvider",control:l,render:({field:S})=>r.jsx(uf,{label:"Provider Name",checked:S.value,onChange:S.onChange})}),r.jsx(ye,{name:"collectStartDate",control:l,render:({field:S})=>r.jsx(uf,{label:"Policy Start Date",checked:S.value,onChange:S.onChange})}),r.jsx(ye,{name:"collectEndDate",control:l,render:({field:S})=>r.jsx(uf,{label:"Policy End Date",checked:S.value,onChange:S.onChange})}),r.jsx(ye,{name:"collectExtentOfCover",control:l,render:({field:S})=>r.jsx(uf,{label:"Extent of Cover (Sum Assured)",checked:S.value,onChange:S.onChange})})]})]})]})]})},iD=[{key:"Phone",label:"Phone",icon:yH},{key:"Computer",label:"Computer / Laptop",icon:o$},{key:"Vehicle",label:"Vehicle",icon:E6},{key:"Sim",label:"SIM Card",icon:O6},{key:"IdCard",label:"Identity Card",icon:K6},{key:"Petrocard",label:"Petrocard",icon:dH},{key:"Tools",label:"Tools",icon:i$},{key:"Other",label:"Other Asset",icon:Tu}],Fge=({assetType:n,...e})=>{switch(n){case"Phone":return r.jsx(Mge,{...e});case"Computer":return r.jsx(Tge,{...e});case"Vehicle":return r.jsx(Lge,{...e});case"Sim":return r.jsx(Hge,{...e});case"IdCard":return r.jsx(Ege,{...e});case"Petrocard":return r.jsx(Dge,{...e});case"Tools":return r.jsx(Pge,{...e});case"Other":return r.jsx(Kge,{...e});default:return null}},Mge=({index:n,control:e})=>r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pt-4",children:[r.jsx(ye,{name:`assets.${n}.brand`,control:e,render:({field:t})=>r.jsx(be,{label:"Brand",...t})}),r.jsx(ye,{name:`assets.${n}.imei`,control:e,render:({field:t})=>r.jsx(be,{label:"IMEI Number",...t})}),r.jsx(ye,{name:`assets.${n}.color`,control:e,render:({field:t})=>r.jsx(be,{label:"Colour",...t})}),r.jsx(ye,{name:`assets.${n}.condition`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"New / Used",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"New"}),r.jsx("option",{children:"Used"})]})}),r.jsx(ye,{name:`assets.${n}.chargerStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Charger",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Charger"}),r.jsx("option",{children:"Without Charger"})]})}),r.jsx(ye,{name:`assets.${n}.displayStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Display Condition",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Damages"}),r.jsx("option",{children:"Without Damages"})]})}),r.jsx(ye,{name:`assets.${n}.bodyStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Body Condition",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Damages"}),r.jsx("option",{children:"Without Damages"})]})}),r.jsx(ye,{name:`assets.${n}.picture`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture",file:t.value,onFileChange:t.onChange})})]}),Hge=({index:n,control:e})=>r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:r.jsx(ye,{name:`assets.${n}.number`,control:e,render:({field:t})=>r.jsx(be,{label:"SIM Number",...t})})}),Tge=({index:n,control:e})=>r.jsxs("div",{className:"space-y-4 pt-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.computerType`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Type",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Laptop"}),r.jsx("option",{children:"Desktop"}),r.jsx("option",{children:"Tab"})]})}),r.jsx(ye,{name:`assets.${n}.brand`,control:e,render:({field:t})=>r.jsx(be,{label:"Brand",...t})}),r.jsx(ye,{name:`assets.${n}.serialNumber`,control:e,render:({field:t})=>r.jsx(be,{label:"Serial Number",...t})}),r.jsx(ye,{name:`assets.${n}.windowsKey`,control:e,render:({field:t})=>r.jsx(be,{label:"Windows Key",...t})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.condition`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"New / Used",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"New"}),r.jsx("option",{children:"Used"})]})}),r.jsx(ye,{name:`assets.${n}.chargerStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Charger",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Charger"}),r.jsx("option",{children:"Without Charger"})]})}),r.jsx(ye,{name:`assets.${n}.bagStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Bag",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Bag"}),r.jsx("option",{children:"Without Bag"})]})}),r.jsx(ye,{name:`assets.${n}.mouseStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Mouse",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Mouse"}),r.jsx("option",{children:"Without Mouse"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.displayStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Display Condition",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Damages"}),r.jsx("option",{children:"Without Damages"})]})}),r.jsx(ye,{name:`assets.${n}.bodyStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Body Condition",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Damages"}),r.jsx("option",{children:"Without Damages"})]})}),r.jsx(ye,{name:`assets.${n}.officeStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"MS Office",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Office"}),r.jsx("option",{children:"Without Office"})]})}),r.jsx(ye,{name:`assets.${n}.antivirusStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Antivirus",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"With Antivirus"}),r.jsx("option",{children:"Without Antivirus"})]})})]}),r.jsx(ye,{name:`assets.${n}.picture`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture",file:t.value,onFileChange:t.onChange})})]}),Ege=({index:n,control:e})=>r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:r.jsx(ye,{name:`assets.${n}.issueDate`,control:e,render:({field:t})=>r.jsx(Vn,{label:"Date Issued",id:t.name,value:t.value,onChange:t.onChange})})}),Dge=({index:n,control:e})=>r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4",children:r.jsx(ye,{name:`assets.${n}.number`,control:e,render:({field:t})=>r.jsx(be,{label:"Petrocard Number",...t})})}),Lge=({index:n,control:e})=>r.jsxs("div",{className:"space-y-4 pt-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.vehicleType`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Vehicle Type",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Bicycle"}),r.jsx("option",{children:"Two Wheeler"}),r.jsx("option",{children:"Three Wheeler"}),r.jsx("option",{children:"Four Wheeler"})]})}),r.jsx(ye,{name:`assets.${n}.brand`,control:e,render:({field:t})=>r.jsx(be,{label:"Brand",...t})}),r.jsx(ye,{name:`assets.${n}.vehicleNumber`,control:e,render:({field:t})=>r.jsx(be,{label:"Vehicle Number",...t})}),r.jsx(ye,{name:`assets.${n}.chassisNumber`,control:e,render:({field:t})=>r.jsx(be,{label:"Chassis Number",...t})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.dlNumber`,control:e,render:({field:t})=>r.jsx(be,{label:"DL Number of User",...t})}),r.jsx(ye,{name:`assets.${n}.kmsAtIssue`,control:e,render:({field:t})=>r.jsx(be,{label:"Kms at issue",type:"number",...t})}),r.jsx(ye,{name:`assets.${n}.condition`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"New / Used",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"New"}),r.jsx("option",{children:"Used"})]})}),r.jsx(ye,{name:`assets.${n}.finesStatus`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"Violations / Fines",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Existing"}),r.jsx("option",{children:"Nil"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.insuranceValidity`,control:e,render:({field:t})=>r.jsx(Vn,{label:"Insurance Validity",id:t.name,value:t.value,onChange:t.onChange})}),r.jsx(ye,{name:`assets.${n}.pollutionCertValidity`,control:e,render:({field:t})=>r.jsx(Vn,{label:"Pollution Cert. Validity",id:t.name,value:t.value,onChange:t.onChange})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(ye,{name:`assets.${n}.dlFrontPic`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture of DL (Front)",file:t.value,onFileChange:t.onChange})}),r.jsx(ye,{name:`assets.${n}.dlBackPic`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture of DL (Back)",file:t.value,onFileChange:t.onChange})}),r.jsx(ye,{name:`assets.${n}.picture`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture of Vehicle",file:t.value,onFileChange:t.onChange})})]})]}),Pge=({index:n,control:e})=>{const{fields:t,append:s,remove:i}=Wr({control:e,name:`assets.${n}.toolList`});return r.jsxs("div",{className:"space-y-4 pt-4",children:[t.map((a,o)=>r.jsxs("div",{className:"flex items-end gap-2",children:[r.jsx("div",{className:"flex-1",children:r.jsx(ye,{name:`assets.${n}.toolList.${o}.name`,control:e,render:({field:l})=>r.jsx(be,{label:"Tool Name",...l})})}),r.jsx("div",{className:"flex-1",children:r.jsx(ye,{name:`assets.${n}.toolList.${o}.description`,control:e,render:({field:l})=>r.jsx(be,{label:"Description",...l})})}),r.jsx("div",{children:r.jsx(ye,{name:`assets.${n}.toolList.${o}.quantity`,control:e,render:({field:l})=>r.jsx(be,{label:"Quantity",type:"number",...l})})}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>i(o),children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})]},a.id)),r.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:()=>s({id:`tool_${Date.now()}`,name:"",description:"",quantity:1}),children:[r.jsx(Tt,{className:"mr-1 h-4 w-4"})," Add Tool"]}),r.jsx(ye,{name:`assets.${n}.picture`,control:e,render:({field:a})=>r.jsx(pt,{label:"Picture of Tools",file:a.value,onFileChange:a.onChange})})]})},Kge=({index:n,control:e})=>r.jsxs("div",{className:"space-y-4 pt-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(ye,{name:`assets.${n}.name`,control:e,render:({field:t})=>r.jsx(be,{label:"Asset Name",placeholder:"e.g. Printer",...t})}),r.jsx(ye,{name:`assets.${n}.brand`,control:e,render:({field:t})=>r.jsx(be,{label:"Brand",...t})}),r.jsx(ye,{name:`assets.${n}.model`,control:e,render:({field:t})=>r.jsx(be,{label:"Model No.",...t})}),r.jsx(ye,{name:`assets.${n}.serialNumber`,control:e,render:({field:t})=>r.jsx(be,{label:"Serial Number",...t})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(ye,{name:`assets.${n}.condition`,control:e,render:({field:t})=>r.jsxs(Oe,{label:"New / Used",...t,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"New"}),r.jsx("option",{children:"Used"})]})}),r.jsx(ye,{name:`assets.${n}.issueCondition`,control:e,render:({field:t})=>r.jsx(be,{label:"Condition at time of issue",...t})})]}),r.jsx("div",{children:r.jsx(ye,{name:`assets.${n}.accessories`,control:e,render:({field:t})=>r.jsxs(r.Fragment,{children:[r.jsx("label",{className:"block text-sm font-medium text-muted",children:"Accessories List"}),r.jsx("textarea",{...t,rows:3,className:"form-input mt-1"})]})})}),r.jsx(ye,{name:`assets.${n}.picture`,control:e,render:({field:t})=>r.jsx(pt,{label:"Picture of Asset",file:t.value,onFileChange:t.onChange})})]}),Oge=({item:n,index:e,control:t,errors:s,remove:i})=>{const[a,o]=k.useState(()=>n.id.startsWith("new_")),l=iD.find(m=>m.key===n.type),c=l?.icon||Tu,h=(m=>"brand"in m&&m.brand?`${m.brand} ${m.type}`:"number"in m&&m.number?`${m.type} - ${m.number}`:"name"in m&&m.name?m.name:"vehicleNumber"in m&&m.vehicleNumber?m.vehicleNumber:l?.label||"Asset")(n);return r.jsxs("div",{className:"border border-border rounded-xl bg-card",children:[r.jsxs("div",{className:"flex items-center p-3",children:[r.jsxs("button",{type:"button",onClick:()=>o(!a),className:"flex items-center gap-3 flex-grow text-left",children:[r.jsx(c,{className:"h-5 w-5 text-muted flex-shrink-0"}),r.jsx("span",{className:"font-semibold text-primary-text",children:h})]}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>i(e),children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>o(!a),children:r.jsx(kg,{className:`h-5 w-5 transform transition-transform ${a?"rotate-180":""}`})})]}),a&&r.jsx("div",{className:"p-4 border-t border-border",children:r.jsx(Fge,{assetType:n.type,index:e,control:t,errors:s})})]})},zge=({site:n,initialAssets:e,onSave:t,onBack:s,setToast:i})=>{const[a,o]=k.useState(!1),[l,c]=k.useState(!1),d=k.useRef(null),{control:h,handleSubmit:m,reset:f,formState:{errors:p}}=tn(),{fields:b,append:x,remove:v}=Wr({control:h,name:"assets"});k.useEffect(()=>{f({assets:e})},[e,f]),k.useEffect(()=>{const V=R=>{d.current&&!d.current.contains(R.target)&&c(!1)};return document.addEventListener("mousedown",V),()=>document.removeEventListener("mousedown",V)},[]);const S=V=>{const R={id:`new_${V}_${Date.now()}`,type:V};let W;switch(V){case"Phone":W={...R,type:"Phone",brand:"",condition:"",chargerStatus:"",displayStatus:"",bodyStatus:"",imei:"",color:""};break;case"Sim":W={...R,type:"Sim",number:""};break;case"Computer":W={...R,type:"Computer",computerType:"",brand:"",condition:"",bagStatus:"",mouseStatus:"",chargerStatus:"",displayStatus:"",bodyStatus:"",serialNumber:"",windowsKey:"",officeStatus:"",antivirusStatus:""};break;case"IdCard":W={...R,type:"IdCard",issueDate:""};break;case"Petrocard":W={...R,type:"Petrocard",number:""};break;case"Vehicle":W={...R,type:"Vehicle",vehicleType:"",brand:"",dlNumber:"",condition:"",kmsAtIssue:null,vehicleNumber:"",chassisNumber:"",insuranceValidity:"",pollutionCertValidity:"",finesStatus:""};break;case"Tools":W={...R,type:"Tools",toolList:[]};break;case"Other":W={...R,type:"Other",name:"",brand:"",model:"",serialNumber:"",condition:"",issueCondition:"",accessories:""};break;default:return}x(W),c(!1)},B=async V=>{o(!0);try{await t(n.id,V.assets)}catch{}finally{o(!1)}};return r.jsxs("form",{onSubmit:m(B),children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsxs("div",{children:[r.jsxs(se,{type:"button",onClick:s,variant:"outline",size:"sm",className:"mb-2",children:[r.jsx(Ri,{className:"mr-2 h-4 w-4"})," Back to List"]}),r.jsxs("h3",{className:"text-xl font-semibold text-primary-text",children:["Managing Assets for: ",n.shortName]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"relative",ref:d,children:[r.jsxs(se,{type:"button",onClick:()=>c(!l),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Asset"]}),l&&r.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-card border rounded-lg shadow-lg z-10",children:iD.map(V=>r.jsxs("button",{type:"button",className:"w-full text-left px-4 py-2 text-sm hover:bg-page flex items-center gap-3",onClick:()=>S(V.key),children:[r.jsx(V.icon,{className:"h-4 w-4 text-muted"}),r.jsx("span",{children:V.label})]},V.key))})]}),r.jsxs(se,{type:"submit",isLoading:a,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Changes"]})]})]}),r.jsx("div",{className:"space-y-4",children:b.length>0?b.map((V,R)=>r.jsx(Oge,{item:V,index:R,control:h,errors:p,remove:v},V.id)):r.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No assets found for this site. Click "Add Asset" to begin.'})})]})},Uge=({sites:n,allAssets:e,searchTerm:t,setSearchTerm:s,onViewDetails:i})=>{const a=(o=[])=>{if(!o||o.length===0)return"No assets assigned.";const l=o.reduce((c,d)=>(c[d.type]=(c[d.type]||0)+1,c),{});return Object.entries(l).map(([c,d])=>`${d} ${c}(s)`).join(", ")};return r.jsxs("div",{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Asset Overview"}),r.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[r.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),r.jsx(be,{id:"site-search",placeholder:"Search sites...",className:"pl-10",value:t,onChange:o=>s(o.target.value)})]})]}),r.jsxs("div",{className:"overflow-x-auto border border-border rounded-lg",children:[r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site Name"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Asset Summary"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border",children:n.map(o=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 font-medium",children:o.shortName}),r.jsx("td",{className:"px-4 py-3 text-muted",children:a(e[o.id])}),r.jsx("td",{className:"px-4 py-3",children:r.jsx(se,{variant:"icon",size:"sm",onClick:()=>i(o.id),title:"View Details",children:r.jsx(jl,{className:"h-4 w-4"})})})]},o.id))})]}),n.length===0&&r.jsx("p",{className:"text-center p-8 text-muted",children:"No sites match your search."})]})]})},Qge=()=>{const[n,e]=k.useState("list"),[t,s]=k.useState(null),[i,a]=k.useState([]),[o,l]=k.useState({}),[c,d]=k.useState(!0),[h,m]=k.useState(""),[f,p]=k.useState(null);k.useEffect(()=>{d(!0),Promise.all([ce.getOrganizations(),ce.getAllSiteAssets()]).then(([S,B])=>{a(S.sort((V,R)=>V.shortName.localeCompare(R.shortName))),l(B)}).catch(()=>p({message:"Failed to load asset configuration.",type:"error"})).finally(()=>d(!1))},[]);const b=async(S,B)=>{try{await ce.updateSiteAssets(S,B),l(V=>({...V,[S]:B})),p({message:"Assets saved successfully.",type:"success"})}catch(V){throw p({message:"Failed to save assets.",type:"error"}),V}},x=S=>{s(S),e("detail")},v=k.useMemo(()=>h?i.filter(S=>S.shortName.toLowerCase().includes(h.toLowerCase())):i,[i,h]);return c?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{children:[f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)}),n==="detail"&&t?r.jsx(zge,{site:i.find(S=>S.id===t),initialAssets:o[t]||[],onSave:b,onBack:()=>e("list"),setToast:p}):r.jsx(Uge,{sites:v,allAssets:o,searchTerm:h,setSearchTerm:m,onViewDetails:x})]})},qge=({control:n,index:e,remove:t,masterTools:s})=>{const[i,a]=k.useState(!0),o=pg({control:n,name:`tools.${e}.department`}),l=pg({control:n,name:`tools.${e}.name`}),c=o?s[o]||[]:[],d=l||"New Tool",h=o||"Select a department";return r.jsxs("div",{className:"border border-border rounded-xl bg-card",children:[r.jsxs("div",{className:"flex items-center p-3",children:[r.jsxs("button",{type:"button",onClick:()=>a(!i),className:"flex items-center gap-3 flex-grow text-left",children:[r.jsx(GH,{className:"h-5 w-5 text-muted flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("span",{className:"font-semibold text-primary-text",children:d}),r.jsx("p",{className:"text-sm text-muted",children:h})]})]}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>t(e),children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>a(!i),children:r.jsx(kg,{className:`h-5 w-5 transform transition-transform ${i?"rotate-180":""}`})})]}),i&&r.jsxs("div",{className:"p-4 border-t border-border space-y-4 animate-fade-in-down",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(ye,{name:`tools.${e}.department`,control:n,render:({field:m})=>r.jsxs(Oe,{label:"Department",...m,children:[r.jsx("option",{value:"",children:"Select Department"}),Object.keys(s).map(f=>r.jsx("option",{value:f,children:f},f))]})}),r.jsx(ye,{name:`tools.${e}.name`,control:n,render:({field:m})=>r.jsxs(Oe,{label:"Tool Name",...m,disabled:!o,children:[r.jsx("option",{value:"",children:"Select Tool"}),c.map(f=>r.jsx("option",{value:f.name,children:f.name},f.id))]})}),r.jsx(ye,{name:`tools.${e}.quantity`,control:n,render:({field:m})=>r.jsx(be,{label:"Quantity",type:"number",...m})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsx(ye,{name:`tools.${e}.picture`,control:n,render:({field:m})=>r.jsx(pt,{label:"Picture of Tool",file:m.value,onFileChange:m.onChange})}),r.jsx(ye,{name:`tools.${e}.inwardDcCopy`,control:n,render:({field:m})=>r.jsx(pt,{label:"Inward DC Copy",file:m.value,onFileChange:m.onChange})}),r.jsx(ye,{name:`tools.${e}.deliveryCopy`,control:n,render:({field:m})=>r.jsx(pt,{label:"Delivery Copy",file:m.value,onFileChange:m.onChange})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[r.jsx(ye,{name:`tools.${e}.invoiceCopy`,control:n,render:({field:m})=>r.jsx(pt,{label:"Invoice",file:m.value,onFileChange:m.onChange})}),r.jsx(ye,{name:`tools.${e}.signedReceipt`,control:n,render:({field:m})=>r.jsx(pt,{label:"Signed Receipt",file:m.value,onFileChange:m.onChange})}),r.jsx(ye,{name:`tools.${e}.receiverName`,control:n,render:({field:m})=>r.jsx(be,{label:"Receiver's Name",...m})})]})]})]})},$ge=({site:n,initialTools:e,masterTools:t,onSave:s,onBack:i})=>{const[a,o]=k.useState(!1),{control:l,handleSubmit:c,reset:d}=tn(),{fields:h,append:m,remove:f}=Wr({control:l,name:"tools"});k.useEffect(()=>{d({tools:e})},[e,d]);const p=()=>{m({id:`new_tool_${Date.now()}`,department:"",name:"",quantity:1})},b=async x=>{o(!0);try{await s(n.id,x.tools)}finally{o(!1)}};return r.jsxs("form",{onSubmit:c(b),children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsxs("div",{children:[r.jsxs(se,{type:"button",onClick:i,variant:"outline",size:"sm",className:"mb-2",children:[r.jsx(Ri,{className:"mr-2 h-4 w-4"})," Back to List"]}),r.jsxs("h3",{className:"text-xl font-semibold text-primary-text",children:["Managing Tools for: ",n.shortName]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(se,{type:"button",onClick:p,children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Tool"]}),r.jsxs(se,{type:"submit",isLoading:a,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Changes"]})]})]}),r.jsx("div",{className:"space-y-4",children:h.length>0?h.map((x,v)=>r.jsx(qge,{control:l,index:v,remove:f,masterTools:t},x.id)):r.jsx("div",{className:"text-center p-8 text-muted bg-page rounded-lg",children:'No tools found for this site. Click "Add Tool" to begin.'})})]})},eue=({sites:n,allIssuedTools:e,searchTerm:t,setSearchTerm:s,onViewDetails:i})=>{const a=(o=[])=>{if(!o||o.length===0)return"No tools issued.";const l=o.reduce((d,h)=>d+(h.quantity||0),0),c=new Set(o.map(d=>d.department)).size;return`${l} tools issued across ${c} department${c>1?"s":""}.`};return r.jsxs("div",{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Site Tools Overview"}),r.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[r.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),r.jsx(be,{id:"site-search",placeholder:"Search sites...",className:"pl-10",value:t,onChange:o=>s(o.target.value)})]})]}),r.jsxs("div",{className:"overflow-x-auto border border-border rounded-lg",children:[r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site Name"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Tools Summary"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border",children:n.map(o=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 font-medium",children:o.shortName}),r.jsx("td",{className:"px-4 py-3 text-muted",children:a(e[o.id])}),r.jsx("td",{className:"px-4 py-3",children:r.jsx(se,{variant:"icon",size:"sm",onClick:()=>i(o.id),title:"View Details",children:r.jsx(jl,{className:"h-4 w-4"})})})]},o.id))})]}),n.length===0&&r.jsx("p",{className:"text-center p-8 text-muted",children:"No sites match your search."})]})]})},tue=()=>{const[n,e]=k.useState(null),[t,s]=k.useState([]),[i,a]=k.useState({}),[o,l]=k.useState({}),[c,d]=k.useState(!0),[h,m]=k.useState(""),[f,p]=k.useState(null);k.useEffect(()=>{d(!0),Promise.all([ce.getOrganizations(),ce.getAllSiteIssuedTools(),ce.getToolsList()]).then(([v,S,B])=>{s(v.sort((V,R)=>V.shortName.localeCompare(R.shortName))),a(S),l(B)}).catch(()=>p({message:"Failed to load initial configuration.",type:"error"})).finally(()=>d(!1))},[]);const b=async(v,S)=>{try{await ce.updateSiteIssuedTools(v,S),a(B=>({...B,[v]:S})),p({message:"Tools list saved successfully.",type:"success"})}catch(B){throw p({message:"Failed to save tools list.",type:"error"}),B}},x=k.useMemo(()=>h?t.filter(v=>v.shortName.toLowerCase().includes(h.toLowerCase())):t,[t,h]);return c?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{children:[f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)}),n?r.jsx($ge,{site:t.find(v=>v.id===n),initialTools:i[n]||[],masterTools:o,onSave:b,onBack:()=>e(null)}):r.jsx(eue,{sites:x,allIssuedTools:i,searchTerm:h,setSearchTerm:m,onViewDetails:e})]})},nue=()=>r.jsx(bd,{title:"Attendance Format"}),sue=()=>r.jsx(bd,{title:"Attendance Overview"}),rue=()=>r.jsx(bd,{title:"Daily Attendance Summary"}),iue=()=>r.jsx(bd,{title:"Notification & Mail Configuration"}),aue=()=>r.jsx(bd,{title:"Onboarding Rejection Reasons"}),oue=()=>r.jsx(bd,{title:"Salary Breakup"}),lue=()=>r.jsx(bd,{title:"Salary Line Item"}),jY=(n,e)=>{const t=e.join(","),s=n.map(i=>e.map(a=>{const o=i[a]===null||i[a]===void 0?"":String(i[a]);return o.includes(",")||o.includes('"')||o.includes(`
`)?`"${o.replace(/"/g,'""')}"`:o}).join(","));return[t,...s].join(`
`)},XY=n=>{const e=n.trim().replace(/\r/g,"").split(`
`);if(e.length<2)return[];const t=e[0].split(",").map(i=>i.trim().replace(/"/g,"")),s=[];for(let i=1;i<e.length;i++){const a={},o=e[i].match(new RegExp('(?<=,|^)(?:"(?:[^"]|"")*"|[^,]*)',"g"))||[];t.forEach((l,c)=>{let d=(o[c]||"").trim();d.startsWith('"')&&d.endsWith('"')&&(d=d.substring(1,d.length-1).replace(/""/g,'"')),a[l]=d}),s.push(a)}return s},dw=["GroupId","GroupName","CompanyId","CompanyName","EntityId","EntityName","organizationId","Location","RegisteredAddress","RegistrationType","RegistrationNumber","GSTNumber","PANNumber","Email","EShramNumber","ShopAndEstablishmentCode","EPFOCode","ESICCode","PSARALicenseNumber","PSARAValidTill"],gw=["organizationId","organizationName","location","entityId","billingName","registeredAddress","gstNumber","panNumber","email1","email2","email3","eShramNumber","shopAndEstablishmentCode","keyAccountManager","siteAreaSqFt","projectType","apartmentCount","agreementDetails","siteOperations"],JY=(n,e)=>{const t=new Blob([n],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s)},cue=({isOpen:n,onClose:e,onSave:t,title:s,label:i,initialName:a=""})=>{const[o,l]=k.useState(a),[c,d]=k.useState("");k.useEffect(()=>{n&&l(a)},[n,a]);const h=()=>{if(!o.trim()){d("Name cannot be empty.");return}t(o),e()};return n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e,children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-md m-4",onClick:m=>m.stopPropagation(),children:[r.jsx("h3",{className:"text-lg font-bold",children:s}),r.jsx("div",{className:"mt-4",children:r.jsx(be,{label:i,id:"name-input",value:o,onChange:m=>{l(m.target.value),d("")},error:c})}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx(se,{onClick:e,variant:"secondary",children:"Cancel"}),r.jsx(se,{onClick:h,children:"Save"})]})]})}):null},uw=[{key:"client_structure",label:"Client Structure",icon:uG},{key:"site_configuration",label:"Site Configuration",icon:Lm},{key:"costing_resource",label:"Costing & Resource",icon:Y6},{key:"backoffice_heads",label:"Back Office & ID Series",icon:Ni},{key:"staff_designation",label:"Staff Designation",icon:_6},{key:"gmc_policy",label:"GMC Policy",icon:hG},{key:"asset",label:"Asset Management",icon:R6},{key:"tools_list",label:"Tools List",icon:GH},{key:"attendance_format",label:"Attendance Format",icon:T6},{key:"attendance_overview",label:"Attendance Overview",icon:X6},{key:"notification_template",label:"Notification & Mail",icon:th},{key:"onboard_reject_reason",label:"Onboarding Rejection Reasons",icon:Of},{key:"salary_template",label:"Salary Breakup",icon:Xl},{key:"salary_line_item",label:"Salary Line Item",icon:Xl}],due=()=>{const n=vt(),{colorScheme:e}=an(),[t,s]=k.useState([]),[i,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState(!0),[h,m]=k.useState(null),[f,p]=k.useState({}),[b,x]=k.useState("client_structure"),v=k.useRef(null),[S,B]=k.useState(""),[V,R]=k.useState(null),[W,_]=k.useState(!1),Y=jt("(max-width: 767px)"),[j,M]=k.useState({isOpen:!1,initialData:null,companyName:""}),[H,D]=k.useState({isOpen:!1,mode:"add",type:"group",title:"",label:""}),[z,O]=k.useState({isOpen:!1,type:"group",id:"",name:""}),[E,te]=k.useState({isOpen:!1,org:null}),q=k.useMemo(()=>t.flatMap(Be=>Be.companies.flatMap(Se=>Se.entities.map(Re=>({...Re,companyName:Se.name})))),[t]);k.useEffect(()=>{(async()=>{d(!0);try{const[Se,Re,Ye]=await Promise.all([ce.getOrganizationStructure(),ce.getOrganizations(),ce.getSiteConfigurations()]);s(Se),a(Re),l(Ye)}catch{m({message:"Failed to load data.",type:"error"})}finally{d(!1)}})()},[]);const de=k.useMemo(()=>{if(!S.trim())return t;const Be=S.toLowerCase();return t.map(Se=>{if(Se.name.toLowerCase().includes(Be))return Se;const Re=Se.companies.map(Ye=>{if(Ye.name.toLowerCase().includes(Be))return Ye;const De=Ye.entities.filter(Me=>Me.name.toLowerCase().includes(Be));return De.length>0?{...Ye,entities:De}:null}).filter(Boolean);return Re.length>0?{...Se,companies:Re}:null}).filter(Boolean)},[t,S]),U=k.useMemo(()=>{if(!S.trim())return i;const Be=S.toLowerCase();return i.filter(Se=>Se.shortName.toLowerCase().includes(Be))},[i,S]),P=Be=>p(Se=>({...Se,[Be]:!Se[Be]})),ne=()=>{m({message:"All changes saved successfully (mocked).",type:"success"})},K=Be=>M({isOpen:!0,initialData:null,companyName:Be}),re=(Be,Se)=>M({isOpen:!0,initialData:Be,companyName:Se}),le=Be=>{m({message:Be.id.startsWith("new_")?"Client added.":"Client updated.",type:"success"}),M({isOpen:!1,initialData:null,companyName:""})},ue=(Be,Se,Re)=>O({isOpen:!0,type:Be,id:Se,name:Re}),ae=()=>{const{type:Be,id:Se,name:Re}=z;Be==="group"?s(Ye=>Ye.filter(De=>De.id!==Se)):Be==="company"?s(Ye=>Ye.map(De=>({...De,companies:De.companies.filter(Me=>Me.id!==Se)}))):Be==="client"&&s(Ye=>Ye.map(De=>({...De,companies:De.companies.map(Me=>({...Me,entities:Me.entities.filter(Le=>Le.id!==Se)}))}))),m({message:`${Be.charAt(0).toUpperCase()+Be.slice(1)} '${Re}' deleted.`,type:"success"}),O({isOpen:!1,type:"group",id:"",name:""})},Ce=Be=>{const{mode:Se,type:Re,id:Ye,groupId:De}=H;if(Se==="add"){if(Re==="group"){const Me={id:`group_${Date.now()}`,name:Be,locations:[],companies:[]};s(Le=>[...Le,Me]),m({message:`Group '${Be}' added.`,type:"success"})}else if(Re==="company"&&De){const Me={id:`comp_${Date.now()}`,name:Be,entities:[]};s(Le=>Le.map(nt=>nt.id===De?{...nt,companies:[...nt.companies,Me]}:nt)),m({message:`Company '${Be}' added.`,type:"success"})}}else Re==="group"&&Ye?(s(Me=>Me.map(Le=>Le.id===Ye?{...Le,name:Be}:Le)),m({message:"Group updated.",type:"success"})):Re==="company"&&Ye&&De&&(s(Me=>Me.map(Le=>Le.id===De?{...Le,companies:Le.companies.map(nt=>nt.id===Ye?{...nt,name:Be}:nt)}:Le)),m({message:"Company updated.",type:"success"}));D({isOpen:!1,mode:"add",type:"group",title:"",label:""})},ie=()=>{let Be,Se,Re;if(b==="client_structure"){Re=dw;const Ye=t.flatMap(De=>De.companies.flatMap(Me=>Me.entities.map(Le=>({GroupId:De.id,GroupName:De.name,CompanyId:Me.id,CompanyName:Me.name,EntityId:Le.id,EntityName:Le.name,organizationId:Le.organizationId||"",Location:Le.location||"",RegisteredAddress:Le.registeredAddress||"",RegistrationType:Le.registrationType||"",RegistrationNumber:Le.registrationNumber||"",GSTNumber:Le.gstNumber||"",PANNumber:Le.panNumber||"",Email:Le.email||"",EShramNumber:Le.eShramNumber||"",ShopAndEstablishmentCode:Le.shopAndEstablishmentCode||"",EPFOCode:Le.epfoCode||"",ESICCode:Le.esicCode||"",PSARALicenseNumber:Le.psaraLicenseNumber||"",PSARAValidTill:Le.psaraValidTill||""}))));Be=jY(Ye,Re),Se="client_structure_export.csv"}else if(b==="site_configuration"){Re=gw;const Ye=i.map(De=>{const Me=o.find(Le=>Le.organizationId===De.id);return{organizationId:De.id,organizationName:De.shortName,...Me||{},agreementDetails:JSON.stringify(Me?.agreementDetails||{}),siteOperations:JSON.stringify(Me?.siteOperations||{})}});Be=jY(Ye,Re),Se="site_configuration_export.csv"}else{m({message:"Export not implemented for this view.",type:"error"});return}JY(Be,Se),m({message:"Data exported successfully.",type:"success"})},ge=()=>{let Be,Se;if(b==="client_structure")Be=dw,Se="client_structure_template.csv";else if(b==="site_configuration")Be=gw,Se="site_configuration_template.csv";else{m({message:"Template not available for this view.",type:"error"});return}JY(Be.join(","),Se)},xe=Be=>{const Se=Be.target.files?.[0];if(!Se)return;const Re=new FileReader;Re.onload=Ye=>{try{const De=Ye.target?.result;if(!De)throw new Error("File is empty.");const Me=De.trim().replace(/\r/g,"").split(`
`);if(Me.length<1)throw new Error("CSV file is empty.");const Le=Me[0].split(",").map(nt=>nt.trim().replace(/"/g,""));if(b==="client_structure"){if(Le.join(",")!==dw.join(","))throw new Error("Header mismatch. Please use the downloaded template.");const nt=XY(De);if(nt.length===0)throw new Error("No data rows found.");const st=new Map;for(const oe of nt){st.has(oe.GroupId)||st.set(oe.GroupId,{group:{id:oe.GroupId,name:oe.GroupName,locations:[],companies:[]},companiesMap:new Map});const Ie=st.get(oe.GroupId);Ie.companiesMap.has(oe.CompanyId)||Ie.companiesMap.set(oe.CompanyId,{id:oe.CompanyId,name:oe.CompanyName,entities:[]});const Ne=Ie.companiesMap.get(oe.CompanyId),Ge={id:oe.EntityId,name:oe.EntityName,organizationId:oe.organizationId,location:oe.Location,registeredAddress:oe.RegisteredAddress,registrationType:oe.RegistrationType||"",registrationNumber:oe.RegistrationNumber,gstNumber:oe.GSTNumber,panNumber:oe.PANNumber,email:oe.Email,eShramNumber:oe.EShramNumber,shopAndEstablishmentCode:oe.ShopAndEstablishmentCode,epfoCode:oe.EPFOCode,esicCode:oe.ESICCode,psaraLicenseNumber:oe.PSARALicenseNumber,psaraValidTill:oe.PSARAValidTill};Ne.entities.push(Ge)}const ee=Array.from(st.values()).map(oe=>(oe.group.companies=Array.from(oe.companiesMap.values()),oe.group));s(ee),m({message:`Successfully imported ${nt.length} client records.`,type:"success"})}else if(b==="site_configuration"){if(Le.join(",")!==gw.join(","))throw new Error("Header mismatch. Please use the downloaded template.");const nt=XY(De);if(nt.length===0)throw new Error("No data rows found.");const st=nt.map(ee=>{const oe={};for(const Ie of Object.keys(ee))if(Ie==="agreementDetails"||Ie==="siteOperations")try{oe[Ie]=JSON.parse(ee[Ie])}catch{console.warn(`Could not parse JSON for ${Ie} in row for site ${ee.organizationId}`),oe[Ie]={}}else oe[Ie]=ee[Ie];return oe});l(ee=>{const oe=[...ee];return st.forEach(Ie=>{const Ne=oe.findIndex(Ge=>Ge.organizationId===Ie.organizationId);Ne>-1?oe[Ne]=Ie:oe.push(Ie)}),oe}),m({message:`Successfully imported ${st.length} site configurations.`,type:"success"})}else m({message:"Import not implemented for this view.",type:"error"})}catch(De){m({message:De.message||"Failed to import CSV.",type:"error"})}finally{Be.target&&(Be.target.value="")}},Re.readAsText(Se)},_e=()=>{switch(b){case"client_structure":return r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[r.jsxs(se,{onClick:()=>n("/hr/entity-management/add-group"),className:"btn-primary border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(Tt,{className:"mr-2 h-4"}),"Add Group"]}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:ge,className:"hover:bg-gray-100",children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Template"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>v.current?.click(),className:"hover:bg-gray-100",children:[r.jsx(td,{className:"mr-2 h-4 w-4"})," Import"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:ie,className:"hover:bg-gray-100",children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export"]})]})]}),r.jsx("div",{className:"space-y-2",children:de.map(Se=>r.jsxs("div",{className:"border-b border-border",children:[r.jsxs("div",{className:"p-3 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>P(Se.id),children:r.jsx(Hu,{className:`h-5 w-5 transition-transform ${f[Se.id]?"rotate-90":""}`})}),r.jsx(oa,{className:"h-5 w-5 text-muted"}),r.jsx("span",{className:"font-semibold",children:Se.name})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(se,{size:"sm",className:"!p-1.5",onClick:()=>D({isOpen:!0,mode:"add",type:"company",groupId:Se.id,title:`Add Company to ${Se.name}`,label:"Company Name"}),title:"Add Company",children:r.jsx(Tt,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",onClick:()=>D({isOpen:!0,mode:"edit",type:"group",id:Se.id,initialName:Se.name,title:"Edit Group Name",label:"Group Name"}),title:"Edit group name",className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:r.jsx(ms,{className:"h-5 w-5"})}),r.jsx(se,{variant:"icon",onClick:()=>ue("group",Se.id,Se.name),title:"Delete group",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]}),f[Se.id]&&r.jsx("div",{className:"pl-6 pr-3 pb-3 space-y-2",children:Se.companies.map(Re=>r.jsxs("div",{className:"border border-border rounded-lg",children:[r.jsxs("div",{className:"p-2 flex items-center justify-between bg-card",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>P(Re.id),children:r.jsx(Hu,{className:`h-5 w-5 transition-transform ${f[Re.id]?"rotate-90":""}`})}),r.jsxs("span",{children:[Re.name," (",Re.entities.length," clients)"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(se,{variant:"icon",size:"sm",title:`View ${Re.entities.length} clients`,onClick:()=>R({companyName:Re.name,clients:Re.entities}),children:r.jsx(jl,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>K(Re.name),title:"Add client",children:r.jsx(Tt,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",onClick:()=>D({isOpen:!0,mode:"edit",type:"company",id:Re.id,groupId:Se.id,initialName:Re.name,title:"Edit Company Name",label:"Company Name"}),title:"Edit company name",className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:r.jsx(ms,{className:"h-5 w-5"})}),r.jsx(se,{variant:"icon",onClick:()=>ue("company",Re.id,Re.name),title:"Delete company",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]}),f[Re.id]&&r.jsx("div",{className:"p-2",children:Re.entities.map(Ye=>r.jsxs("div",{className:"p-2 flex items-center justify-between hover:bg-page rounded",children:[r.jsx("span",{children:Ye.name}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"icon",onClick:()=>re(Ye,Re.name),className:"p-2 hover:bg-blue-500/10 rounded-full transition-colors",children:r.jsx(ms,{className:"h-5 w-5"})}),r.jsx(se,{variant:"icon",onClick:()=>ue("client",Ye.id,Ye.name),className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]},Ye.id))})]},Re.id))})]},Se.id))})]});case"site_configuration":return r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[r.jsx("h4",{className:"text-lg font-semibold text-primary-text",children:"Sites Configuration"}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{type:"button",variant:"outline",onClick:ge,children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Template"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>v.current?.click(),children:[r.jsx(td,{className:"mr-2 h-4 w-4"})," Import"]}),r.jsxs(se,{type:"button",variant:"outline",onClick:ie,children:[r.jsx(si,{className:"mr-2 h-4 w-4"})," Export"]})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-border responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Site Name"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Configuration Status"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:U.map(Se=>{const Re=o.find(De=>De.organizationId===Se.id),Ye=!!Re&&(!!Re.billingName||!!Re.keyAccountManager);return r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Site Name",className:"px-4 py-3 font-medium",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(oa,{className:"h-5 w-5 text-muted"}),r.jsx("span",{children:Se.shortName})]})}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:Ye?r.jsxs("span",{className:"flex items-center text-green-600",children:[r.jsx(Gi,{className:"h-4 w-4 mr-1"})," Complete"]}):r.jsxs("span",{className:"flex items-center text-yellow-600",children:[r.jsx(gG,{className:"h-4 w-4 mr-1"})," Incomplete"]})}),r.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:r.jsxs(se,{size:"sm",variant:"outline",onClick:()=>te({isOpen:!0,org:Se}),children:[r.jsx(jl,{className:"mr-2 h-4 w-4"})," View / Edit"]})})]},Se.id)})})]})})]});case"costing_resource":return r.jsx(Gge,{});case"backoffice_heads":return r.jsx(kge,{});case"staff_designation":return r.jsx(Vge,{});case"gmc_policy":return r.jsx(Yge,{});case"asset":return r.jsx(Qge,{});case"tools_list":return r.jsx(tue,{});case"attendance_format":return r.jsx(nue,{});case"attendance_overview":return r.jsx(sue,{});case"daily_attendance":return r.jsx(rue,{});case"notification_template":return r.jsx(iue,{});case"onboard_reject_reason":return r.jsx(aue,{});case"salary_template":return r.jsx(oue,{});case"salary_line_item":return r.jsx(lue,{});default:const Be=uw.find(Se=>Se.key===b);return r.jsx(bd,{title:Be?.label||"Configuration"})}};return r.jsxs("div",{className:"p-4 space-y-6",children:[h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)}),r.jsx(Sge,{isOpen:W,onClose:()=>_(!1)}),j.isOpen&&r.jsx(xge,{...j,onClose:()=>M(Be=>({...Be,isOpen:!1})),onSave:le}),r.jsx(cue,{isOpen:H.isOpen,onClose:()=>D({isOpen:!1,mode:"add",type:"group",title:"",label:""}),onSave:Ce,title:H.title,label:H.label,initialName:H.initialName}),r.jsxs(tr,{isOpen:z.isOpen,onClose:()=>O(Be=>({...Be,isOpen:!1})),onConfirm:ae,title:"Confirm Deletion",children:["Are you sure you want to delete the ",z.type,' "',z.name,'"? This action cannot be undone.']}),E.isOpen&&E.org&&r.jsx(gE,{isOpen:E.isOpen,onClose:()=>te({isOpen:!1,org:null}),onSave:()=>{},organization:E.org,allClients:q,initialData:o.find(Be=>Be.organizationId===E.org?.id)}),V&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60",onClick:()=>R(null),children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-md m-4 animate-fade-in-scale",onClick:Be=>Be.stopPropagation(),children:[r.jsxs("h3",{className:"text-lg font-bold text-primary-text mb-4",children:["Clients in ",V.companyName]}),V.clients.length>0?r.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:V.clients.map(Be=>r.jsx("li",{className:"text-sm p-2 bg-page rounded-md",children:Be.name},Be.id))}):r.jsx("p",{className:"text-muted text-center py-4",children:"No clients found for this company."}),r.jsx("div",{className:"mt-6 text-right",children:r.jsx(se,{onClick:()=>R(null),variant:"secondary",children:"Close"})})]})}),r.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4 mb-6",children:[r.jsx("h2",{className:"text-2xl font-semibold text-primary-text",children:"Client Management"}),!Y&&r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs(se,{variant:"outline",onClick:()=>_(!0),className:"hover:bg-gray-100",children:[r.jsx(k2,{className:"mr-2 h-4 w-4"})," Help"]}),r.jsx("input",{type:"file",ref:v,className:"hidden",accept:".csv",onChange:xe}),r.jsxs(se,{onClick:ne,className:"btn-primary border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save All Changes"]})]})]}),Y&&r.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[r.jsxs(se,{onClick:ne,className:"w-full justify-center btn-primary border hover:opacity-90 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save All Changes"]}),r.jsxs(se,{variant:"outline",onClick:()=>_(!0),className:"w-full justify-center hover:bg-gray-100",children:[r.jsx(k2,{className:"mr-2 h-4 w-4"})," Help"]}),r.jsx("input",{type:"file",ref:v,className:"hidden",accept:".csv",onChange:xe})]}),r.jsxs("div",{className:"relative",children:[r.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted"}),r.jsx("input",{type:"text",placeholder:"Search across all clients and sites...",value:S,onChange:Be=>B(Be.target.value),className:"form-input pl-10 w-full"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[r.jsx("nav",{className:"md:col-span-1",children:Y?r.jsx(Oe,{label:"Configuration Section",id:"hr-config-select",value:b,onChange:Be=>x(Be.target.value),children:uw.map(Be=>r.jsx("option",{value:Be.key,children:Be.label},Be.key))}):r.jsx("div",{className:"space-y-1",children:uw.map(Be=>r.jsxs("button",{onClick:()=>x(Be.key),className:`w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg text-left transition-colors ${b===Be.key?"bg-accent text-white":"text-slate-700 hover:bg-gray-100 hover:text-slate-900"}`,children:[r.jsx(Be.icon,{className:`h-5 w-5 ${b===Be.key?"text-white":"text-slate-500"}`}),r.jsx("span",{children:Be.label})]},Be.key))})}),r.jsx("main",{className:"md:col-span-3",children:c?r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent mx-auto mt-16"}):_e()})]})]})},gue=({isOpen:n,onSave:e,onClose:t,initialData:s})=>{const[i,a]=k.useState(s?.name||""),[o,l]=k.useState(s?.description||""),[c,d]=k.useState(!1);k.useEffect(()=>{n&&(a(s?.name||""),l(s?.description||""),d(!1))},[n,s]);const h=async m=>{if(m&&m.preventDefault(),!!i.trim()){d(!0);try{await e({name:i.trim(),description:o.trim()})}catch(f){console.error("Error saving policy:",f),d(!1)}}};return r.jsx(tr,{isOpen:n,onClose:t,onConfirm:h,title:`${s?"Edit":"Add"} Policy`,confirmButtonText:"Save Policy",isLoading:c,children:r.jsxs("form",{onSubmit:h,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"policy-name",className:"block text-sm font-medium text-muted mb-1",children:["Policy Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"policy-name",value:i,onChange:m=>a(m.target.value),placeholder:"Policy Name (e.g., POSH)",className:"form-input",required:!0,disabled:c})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"policy-description",className:"block text-sm font-medium text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"policy-description",value:o,onChange:m=>l(m.target.value),placeholder:"Description",className:"form-input",rows:3,disabled:c})]})]})})},uue=()=>{const n=vt(),[e,t]=k.useState([]),[s,i]=k.useState(!0),[a,o]=k.useState(!1),[l,c]=k.useState(null),[d,h]=k.useState(null),m=k.useRef(!0);k.useEffect(()=>(m.current=!0,()=>{m.current=!1}),[]);const f=k.useCallback(async()=>{i(!0);try{const v=await ce.getPolicies();m.current&&t(v)}catch(v){console.error("Error fetching policies:",v),m.current&&h({message:"Failed to fetch policies.",type:"error"})}finally{m.current&&i(!1)}},[]);k.useEffect(()=>{f()},[f]);const p=async v=>{try{l?h({message:"Policy updated.",type:"success"}):(await ce.createPolicy(v),m.current&&h({message:"Policy created successfully!",type:"success"})),m.current&&(o(!1),c(null),f())}catch(S){throw console.error("Error saving policy:",S),m.current&&h({message:"Failed to save policy. Please try again.",type:"error"}),S}},b=()=>{n("/hr/policies/add")},x=v=>{c(v),o(!0)};return r.jsxs("div",{children:[d&&r.jsx(It,{message:d.message,type:d.type,onDismiss:()=>h(null)}),r.jsx(gue,{isOpen:a,onSave:p,onClose:()=>{o(!1),c(null)},initialData:l}),r.jsx(ma,{title:"Policy Management",children:r.jsxs(se,{onClick:b,children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Policy"]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Policy Name"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Description"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"md:bg-card divide-y divide-border md:divide-y-0",children:s?r.jsx("tr",{children:r.jsx("td",{colSpan:3,"data-label":"Status",className:"text-center py-10 text-muted",children:"Loading..."})}):e.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:3,"data-label":"Status",className:"text-center py-10 text-muted",children:'No policies found. Click "Add Policy" to create one.'})}):e.map(v=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Policy Name",className:"px-6 py-4 font-medium",children:v.name}),r.jsx("td",{"data-label":"Description",className:"px-6 py-4 text-sm text-muted",children:v.description||""}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4",children:r.jsx("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:r.jsx(se,{variant:"icon",size:"sm",onClick:()=>x(v),children:r.jsx(ms,{className:"h-4 w-4"})})})})]},v.id))})]})})]})},hue=Bt({type:pe().oneOf(["GMC","GPA","WCA","Other"]).required("Type is required"),provider:pe().required("Provider is required"),policyNumber:pe().required("Policy number is required"),validTill:pe().required("Valid till date is required")}).defined(),mue=({onSave:n,onClose:e,initialData:t})=>{const{register:s,handleSubmit:i,control:a,formState:{errors:o},reset:l}=tn({resolver:Yn(hue)});k.useEffect(()=>{l(t||{type:"GMC",provider:"",policyNumber:"",validTill:""})},[t,l]);const c=d=>{n(d)};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-lg m-4",onClick:d=>d.stopPropagation(),children:r.jsxs("form",{onSubmit:i(c),children:[r.jsxs("h3",{className:"text-lg font-bold mb-4",children:[t?"Edit":"Add"," Insurance"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs(Oe,{label:"Insurance Type",id:"type",registration:s("type"),error:o.type?.message,children:[r.jsx("option",{children:"GMC"}),r.jsx("option",{children:"GPA"}),r.jsx("option",{children:"WCA"}),r.jsx("option",{children:"Other"})]}),r.jsx(be,{label:"Provider",id:"provider",registration:s("provider"),error:o.provider?.message}),r.jsx(be,{label:"Policy Number",id:"policyNumber",registration:s("policyNumber"),error:o.policyNumber?.message}),r.jsx(ye,{name:"validTill",control:a,render:({field:d})=>r.jsx(Vn,{label:"Valid Till",id:"validTill",value:d.value,onChange:d.onChange,error:o.validTill?.message})})]}),r.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:e,children:"Cancel"}),r.jsx(se,{type:"submit",children:"Save Insurance"})]})]})})})},Iue=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),[i,a]=k.useState(!1),[o,l]=k.useState(null),[c,d]=k.useState(null),h=k.useCallback(async()=>{s(!0);try{const f=await ce.getInsurances();e(f)}catch{d({message:"Failed to fetch insurance policies.",type:"error"})}finally{s(!1)}},[]);k.useEffect(()=>{h()},[h]);const m=async f=>{try{o||(await ce.createInsurance(f),d({message:"Insurance created.",type:"success"})),a(!1),h()}catch{d({message:"Failed to save insurance.",type:"error"})}};return r.jsxs("div",{children:[c&&r.jsx(It,{message:c.message,type:c.type,onDismiss:()=>d(null)}),i&&r.jsx(mue,{onSave:m,onClose:()=>a(!1),initialData:o}),r.jsx(ma,{title:"Insurance Management",children:r.jsxs(se,{onClick:()=>{l(null),a(!0)},children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Insurance"]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Type"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Provider"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Policy Number"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Valid Till"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"md:bg-card divide-y divide-border md:divide-y-0",children:t?r.jsx("tr",{children:r.jsx("td",{colSpan:5,"data-label":"Status",className:"text-center py-10 text-muted",children:"Loading..."})}):n.map(f=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Type",className:"px-6 py-4 font-medium",children:f.type}),r.jsx("td",{"data-label":"Provider",className:"px-6 py-4 text-sm text-muted",children:f.provider}),r.jsx("td",{"data-label":"Policy Number",className:"px-6 py-4 text-sm text-muted",children:f.policyNumber}),r.jsx("td",{"data-label":"Valid Till",className:"px-6 py-4 text-sm text-muted",children:f.validTill}),r.jsx("td",{"data-label":"Actions",className:"px-6 py-4",children:r.jsx("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:r.jsx(se,{variant:"icon",size:"sm",onClick:()=>{l(f),a(!0)},children:r.jsx(ms,{className:"h-4 w-4"})})})})]},f.id))})]})})]})},Cue=()=>{const[n,e]=k.useState("policies");return r.jsxs("div",{className:"p-4 space-y-6",children:[r.jsx("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Policies & Insurance"})}),r.jsx("div",{children:r.jsxs("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:[r.jsxs("button",{onClick:()=>e("policies"),className:`flex items-center gap-2 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${n==="policies"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-primary-text hover:border-gray-300"}`,children:[r.jsx(Cr,{className:"h-5 w-5"}),r.jsx("span",{children:"Company Policies"})]}),r.jsxs("button",{onClick:()=>e("insurance"),className:`flex items-center gap-2 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${n==="insurance"?"border-accent text-accent-dark":"border-transparent text-muted hover:text-primary-text hover:border-gray-300"}`,children:[r.jsx(bH,{className:"h-5 w-5"}),r.jsx("span",{children:"Insurance Plans"})]})]})}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[n==="policies"&&r.jsx(uue,{}),n==="insurance"&&r.jsx(Iue,{})]})]})},hf={documents:{aadhaar:!1,pan:!1,bankProof:!1,educationCertificate:!1,salarySlip:!1,uanProof:!1,familyAadhaar:!1},verifications:{requireBengaluruAddress:!1,requireDobVerification:!1}},fue=()=>{const n=dd(),[e,t]=k.useState(null),[s,i]=k.useState([]),[a,o]=k.useState("Administrator");k.useEffect(()=>{ce.getSiteStaffDesignations().then(B=>{const V=[...new Set(B.map(R=>R.designation))];V.includes("Administrator")||V.unshift("Administrator"),i(V.map((R,W)=>({id:`${W}`,designation:R,department:"",permanentId:"",temporaryId:""})))})},[]);const{register:l,handleSubmit:c,control:d,formState:{isDirty:h},watch:m,reset:f,setValue:p}=tn({defaultValues:n});k.useEffect(()=>{f(n)},[n,f]),k.useEffect(()=>{n.rulesByDesignation?.[a]||(Object.keys(hf.documents).forEach(V=>{p(`rulesByDesignation.${a}.documents.${V}`,!0,{shouldDirty:!0})}),Object.keys(hf.verifications).forEach(V=>{p(`rulesByDesignation.${a}.verifications.${V}`,!0,{shouldDirty:!0})}))},[a,n.rulesByDesignation,p]);const b=m("enforceManpowerLimit"),x=m("enableEsiRule"),v=m("enableGmcRule"),S=B=>{n.updateRules(B),t({message:"Enrollment rules saved successfully!",type:"success"}),f(B)};return r.jsxs("form",{onSubmit:c(S),className:"p-4 space-y-8 w-full",children:[e&&r.jsx(It,{message:e.message,type:e.type,onDismiss:()=>t(null)}),r.jsx(ma,{title:"Enrollment Rules",children:r.jsxs(se,{type:"submit",disabled:!h,children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Rules"]})}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(Cr,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Designation-Specific Rules"}),r.jsx("p",{className:"text-muted",children:"Set mandatory documents and verifications for specific roles."})]})]}),r.jsx("div",{className:"mb-4",children:r.jsx(Oe,{label:"Configure rules for designation",value:a,onChange:B=>o(B.target.value),children:s.map(B=>r.jsx("option",{value:B.designation,children:B.designation},B.id))})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsxs("section",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:"Mandatory Documents"}),r.jsx("div",{className:"space-y-3",children:Object.keys(hf.documents).map(B=>r.jsx(ye,{name:`rulesByDesignation.${a}.documents.${B}`,control:d,defaultValue:!0,render:({field:V})=>r.jsx(Nn,{id:`${a}-${B}`,label:B.replace(/([A-Z])/g," $1").replace(/^./,R=>R.toUpperCase()),checked:V.value,onChange:V.onChange})},B))})]}),r.jsxs("section",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:"Data Verifications"}),r.jsx("div",{className:"space-y-3",children:Object.keys(hf.verifications).map(B=>r.jsx(ye,{name:`rulesByDesignation.${a}.verifications.${B}`,control:d,defaultValue:!0,render:({field:V})=>r.jsx(Nn,{id:`${a}-${B}`,label:B.replace(/([A-Z])/g," $1").replace(/^./,R=>R.toUpperCase()),checked:V.value,onChange:V.onChange})},B))})]})]})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(Xl,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("h2",{className:"text-xl font-bold",children:"ESI Eligibility"}),r.jsx("p",{className:"text-muted",children:"Define salary threshold for statutory insurance."})]}),r.jsx(ye,{name:"enableEsiRule",control:d,render:({field:B})=>r.jsx(Nn,{id:"enableEsiRule",label:"Enable Rule",checked:B.value,onChange:B.onChange})})]}),r.jsx("div",{className:`transition-opacity ${x?"opacity-100":"opacity-50 pointer-events-none"}`,children:r.jsxs("div",{className:"max-w-sm",children:[r.jsx(be,{label:"ESI Eligibility Gross Salary Threshold",id:"esiCtcThreshold",type:"number",registration:l("esiCtcThreshold",{valueAsNumber:!0}),disabled:!x}),r.jsx("p",{className:"text-xs text-muted mt-2",children:"Employees at or below this amount are eligible for ESI. Those above are eligible for GMC."})]})})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(Xl,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("h2",{className:"text-xl font-bold",children:"GMC/Insurance Policy Rules"}),r.jsx("p",{className:"text-muted",children:"Set default GMC policies."})]}),r.jsx(ye,{name:"enableGmcRule",control:d,render:({field:B})=>r.jsx(Nn,{id:"enableGmcRule",label:"Enable Rule",checked:B.value,onChange:B.onChange})})]}),r.jsxs("div",{className:`transition-opacity ${v?"opacity-100":"opacity-50 pointer-events-none"}`,children:[r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[r.jsx(be,{label:"GMC Salary Threshold",id:"salaryThreshold",type:"number",registration:l("salaryThreshold",{valueAsNumber:!0}),disabled:!v}),r.jsx(ye,{name:"defaultPolicySingle",control:d,render:({field:B})=>r.jsxs(Oe,{label:"Policy (Single)",...B,disabled:!v,children:[r.jsx("option",{value:"1L",children:"1 Lakh"}),r.jsx("option",{value:"2L",children:"2 Lakh"})]})}),r.jsx(ye,{name:"defaultPolicyMarried",control:d,render:({field:B})=>r.jsxs(Oe,{label:"Policy (Married)",...B,disabled:!v,children:[r.jsx("option",{value:"1L",children:"1 Lakh"}),r.jsx("option",{value:"2L",children:"2 Lakh"})]})})]}),r.jsx("p",{className:"text-xs text-muted mt-2",children:"Employees with a salary *above* this threshold will be eligible for GMC."})]})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(Ni,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold",children:"Manpower Allocation"}),r.jsx("p",{className:"text-muted",children:"Set rules for enrolling based on approved manpower."})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(ye,{name:"enforceManpowerLimit",control:d,render:({field:B})=>r.jsx(Nn,{id:"enforceManpowerLimit",label:"Enforce Manpower Allocation Limits",description:"Check new enrollments against the approved manpower count for the site.",checked:B.value,onChange:B.onChange})}),r.jsx("div",{className:`max-w-sm transition-opacity ${b?"opacity-100":"opacity-50 pointer-events-none"}`,children:r.jsxs(Oe,{label:"Action When Limit is Reached",id:"manpowerLimitRule",registration:l("manpowerLimitRule"),disabled:!b,children:[r.jsx("option",{value:"warn",children:"Warn field officer but allow enrollment"}),r.jsx("option",{value:"block",children:"Block enrollment and require approval"})]})})]})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(ms,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold",children:"Field Officer Permissions"}),r.jsx("p",{className:"text-muted",children:"Control what field officers can do during enrollment."})]})]}),r.jsx("div",{className:"space-y-4",children:r.jsx(ye,{name:"allowSalaryEdit",control:d,render:({field:B})=>r.jsx(Nn,{id:"allowSalaryEdit",label:"Allow Salary Editing",description:"Permit field officers to edit default salary, triggering an approval workflow.",checked:B.value??!1,onChange:B.onChange})})})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-8 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"flex items-start mb-6",children:[r.jsx("div",{className:"p-3 rounded-full bg-accent-light mr-4",children:r.jsx(Sg,{className:"h-6 w-6 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold",children:"Family Details Validation"}),r.jsx("p",{className:"text-muted",children:"Set rules for validating family member details."})]})]}),r.jsx("div",{className:"space-y-4",children:r.jsx(ye,{name:"enforceFamilyValidation",control:d,render:({field:B})=>r.jsx(Nn,{id:"enforceFamilyValidation",label:"Enforce Strict Family Validation",description:"Enable checks for duplicates, age, and gender based on relationship.",checked:B.value??!1,onChange:B.onChange})})})]})]})},pue=()=>{const{id:n}=Bg(),e=vt(),[t,s]=k.useState(null),[i,a]=k.useState(!0),[o,l]=k.useState(!1),c=k.useRef(null),{data:d,setFormsGenerated:h}=Qn(),m=Dm(W=>W.currentLogo),[f,p]=k.useState(!1);k.useEffect(()=>{(async()=>{if(n&&!n.startsWith("draft_")){a(!0);const _=await ce.getOnboardingDataById(n);s(_||null),a(!1)}else s(d),a(!1)})()},[n,d]);const b=async()=>{const W=c.current;if(W&&t){p(!0);try{const _=W.outerHTML,Y={margin:0,filename:`Onboarding_Forms_${t?.personal.employeeId}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};await ce.generatePdf(_,Y)}catch(_){console.error("PDF generation failed:",_)}finally{p(!1)}}},x=()=>{h(!0),e(`/onboarding/add/review?id=${n}`)};if(i||f)return r.jsx("div",{className:"text-center p-10",children:r.jsx(xt,{className:"h-8 w-8 animate-spin mx-auto"})});if(!t)return r.jsx("div",{className:"text-center p-10 text-red-500",children:"Could not find employee data."});const v=t,S=`${v.personal.firstName} ${v.personal.middleName||""} ${v.personal.lastName}`.replace(/\s+/g," ").trim(),B=v.family.find(W=>W.relation==="Father")?.name||"",V=v.family.find(W=>W.relation==="Spouse")?.name||"",R=v.family.find(W=>W.relation==="Mother")?.name||"";return r.jsx("div",{className:"bg-page",children:r.jsxs("div",{className:"max-w-4xl p-4 sm:p-6 lg:p-8",children:[r.jsx("div",{className:"bg-card p-4 rounded-xl shadow-card no-print mb-8 sticky top-4 z-10",children:r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[r.jsxs(se,{type:"button",onClick:()=>e(-1),variant:"secondary",children:[r.jsx(Ri,{className:"mr-2 h-4 w-4"})," Go Back"]}),r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"font-bold text-lg",children:"Review Official Forms"}),r.jsx("p",{className:"text-sm text-muted",children:"Please confirm these details before submitting."})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(se,{type:"button",onClick:b,variant:"outline",disabled:f,children:[f?r.jsx(xt,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(si,{className:"mr-2 h-4 w-4"}),f?"Generating...":"Download"]}),r.jsx(se,{type:"button",onClick:x,children:"Confirm & Continue"})]})]})}),r.jsxs("div",{ref:c,className:"bg-white rounded-xl border border-border shadow-lg",children:[r.jsx("div",{className:"pdf-page p-8 font-serif text-sm text-black",children:r.jsxs("div",{className:"border-4 border-black p-6 h-full flex flex-col",children:[r.jsx("h1",{className:"text-center text-xl font-bold tracking-widest mb-8",children:"EMPLOYEE PERSONAL DATA"}),r.jsx("div",{className:"w-64 mx-auto border-2 border-black p-2 my-8",children:r.jsx("img",{src:m,alt:"Paradigm Logo",className:"w-full"})}),r.jsxs("div",{className:"mt-auto space-y-8 text-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"EMPLOYEE'S NAME"})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:S})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"SITE"})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:v.organization.organizationName})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"DESIGNATION"})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:v.organization.designation})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"EMPLOYEE'S ID NO."})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:v.personal.employeeId})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"PF No."})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:v.uan.pfNumber||v.uan.uanNumber})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"w-48 font-bold",children:"ESI NO."})," : ",r.jsx("span",{className:"border-b border-black flex-1 ml-2",children:v.esi.esiNumber})]})]})]})}),r.jsx("div",{className:"page-break"}),r.jsx("div",{className:"pdf-page p-8 font-serif text-xs text-black",children:r.jsxs("div",{className:"border-2 border-black p-4 h-full relative",children:[r.jsx("div",{className:"absolute top-4 right-4 w-48",children:r.jsx("img",{src:m,alt:"Paradigm Logo",className:"w-full"})}),r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsxs("h2",{className:"font-bold",children:["EMPLOYEE ID No. : ",r.jsx("span",{className:"font-normal underline",children:v.personal.employeeId})]}),r.jsx("h1",{className:"text-center font-bold text-base tracking-wider",children:"PERSONAL DATA"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{children:["1. Name: ",r.jsx("span",{className:"underline",children:S})]}),r.jsxs("p",{children:["2. Father's Name: ",r.jsx("span",{className:"underline",children:B})]}),r.jsxs("p",{children:["3. Mother's Name: ",r.jsx("span",{className:"underline",children:R})]}),r.jsxs("p",{children:["4. Reference by: ",r.jsx("span",{className:"underline"})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["5. Date of Birth: ",r.jsx("span",{className:"underline",children:v.personal.dob})]}),r.jsxs("p",{children:["6. Age: ",r.jsx("span",{className:"underline",children:v.personal.dob?new Date().getFullYear()-new Date(v.personal.dob).getFullYear():""})]})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["7. Qualification: ",r.jsx("span",{className:"underline",children:v.education[0]?.degree||""})]}),r.jsxs("p",{children:["8. Experience: ",r.jsx("span",{className:"underline"})]})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["9. Designation: ",r.jsx("span",{className:"underline",children:v.organization.designation})]}),r.jsxs("p",{children:["10. Net Salary Offered: ",r.jsx("span",{className:"underline",children:v.personal.salary?.toLocaleString("en-IN")})]})]}),r.jsxs("p",{children:["11. Present Address: ",r.jsx("span",{className:"underline",children:`${v.address.present.line1}, ${v.address.present.city}, ${v.address.present.state} - ${v.address.present.pincode}`})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["12. Permanent Address: ",r.jsx("span",{className:"underline",children:v.address.sameAsPresent?"Same as Present":`${v.address.permanent.line1}, ${v.address.permanent.city}`})]}),r.jsxs("p",{children:["Ph. No.: ",r.jsx("span",{className:"underline",children:v.personal.mobile})," Alternate Ph. No.: ",r.jsx("span",{className:"underline",children:v.personal.alternateMobile||""})]})]}),r.jsx("p",{children:"13. Left hand thumb impression"}),r.jsxs("div",{className:"grid grid-cols-4 gap-2 h-12 border border-black my-1",children:[r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{})]}),r.jsx("p",{children:"14. Right hand thumb impression"}),r.jsxs("div",{className:"grid grid-cols-4 gap-2 h-12 border border-black my-1",children:[r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{className:"border-r border-black"}),r.jsx("div",{})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["15. Marital Status: ",r.jsx("span",{className:"underline",children:v.personal.maritalStatus})]}),r.jsxs("p",{children:["16. Name of the Spouse: ",r.jsx("span",{className:"underline",children:V})," Contact No.: ",r.jsx("span",{className:"underline"})]})]}),r.jsxs("p",{children:["17. Languages Known: to Speak ",r.jsx("span",{className:"underline"})," to Write ",r.jsx("span",{className:"underline"})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["18. Date of Joining: ",r.jsx("span",{className:"underline",children:v.organization.joiningDate})]}),r.jsx("p",{children:"19. ID Card:"})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["20. ESI Number: ",r.jsx("span",{className:"underline",children:v.esi.esiNumber})]}),r.jsxs("p",{children:["21. PF Number: ",r.jsx("span",{className:"underline",children:v.uan.pfNumber||v.uan.uanNumber})]})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("p",{children:"22. Uniform Details: "}),r.jsx("p",{children:"23. Shoe Details: "})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("p",{children:["24. Name of the Site: ",r.jsx("span",{className:"underline",children:v.organization.organizationName})]}),r.jsx("p",{children:"25. Site / Estate Manager: "})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("p",{children:"26. Record enclosed: "}),r.jsx("p",{children:"28. Reference Name:"})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("p",{children:"27. Hirer: "}),r.jsx("p",{className:"ml-24",children:"Reference Ph.:"})]}),r.jsxs("p",{children:["29. Emergency Contact Name: ",r.jsx("span",{className:"underline",children:v.personal.emergencyContactName})," Ph.: ",r.jsx("span",{className:"underline",children:v.personal.emergencyContactNumber})," Blood Group: ",r.jsx("span",{className:"underline",children:v.personal.bloodGroup})]})]}),r.jsxs("div",{className:"absolute bottom-4 left-4 right-4 flex justify-between",children:[r.jsx("p",{children:"Employee Signature:"}),r.jsx("p",{children:"Documented by:"})]})]})})]})]})})},Aue=({status:n})=>{const e={Pending:"bg-yellow-100 text-yellow-800",Approved:"bg-blue-100 text-blue-800",Issued:"bg-green-100 text-green-800",Rejected:"bg-red-100 text-red-800"};return r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full capitalize ${e[n]}`,children:n})},mf=({title:n,sizes:e,headers:t,control:s,quantityType:i,quantities:a,readOnly:o=!1})=>{const l=Array.from(new Set(e.map(d=>d.fit))),c=Array.from(new Set(e.map(d=>d.size))).sort((d,h)=>{const m=parseInt(String(d)),f=parseInt(String(h));return!isNaN(m)&&!isNaN(f)?m-f:String(d).localeCompare(String(h))});return r.jsxs("div",{className:"border rounded-lg flex flex-col overflow-hidden",children:[r.jsx("h4",{className:"p-3 font-semibold bg-page border-b flex-shrink-0",children:n}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:"Size"}),t.map(d=>r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:d.label},String(d.key))),r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted w-20",children:"Qty"})]})}),r.jsx("tbody",{className:"divide-y",children:c.map(d=>r.jsx(ot.Fragment,{children:l.map((h,m)=>{const f=e.find(p=>p.size===d&&p.fit===h);return f?r.jsxs("tr",{children:[m===0&&r.jsx("td",{rowSpan:l.filter(p=>e.some(b=>b.size===d&&b.fit===p)).length,className:"px-2 py-2 align-middle font-semibold border-r",children:d}),t.map(p=>r.jsx("td",{className:"px-2 py-2",children:f[p.key]},String(p.key))),r.jsx("td",{className:"px-2 py-2",children:o?r.jsx("span",{className:"font-semibold block text-center pr-4",children:a?.[f.id]||0}):r.jsx(ye,{name:`${i}.${f.id}`,control:s,render:({field:p})=>r.jsx(be,{"aria-label":`Quantity for ${n} size ${d} ${h}`,type:"number",...p,value:p.value||"",onChange:b=>p.onChange(parseInt(b.target.value)||null),className:"!py-1.5"})})})]},f.id):null})},d))})]})})]})},bue=({request:n,onClose:e,masterUniforms:t})=>{if(!n)return null;const{pantsQuantities:s,shirtsQuantities:i}=k.useMemo(()=>{const o={},l={};return n.items.forEach(c=>{c.category==="Pants"?o[c.sizeId]=c.quantity:l[c.sizeId]=c.quantity}),{pantsQuantities:o,shirtsQuantities:l}},[n.items]),a=n.gender==="Gents"?t.gents:t.ladies;return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-6xl my-4 animate-fade-in-scale flex flex-col max-h-[90vh]",onClick:o=>o.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b flex justify-between items-start flex-shrink-0",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Uniform Request Details"}),r.jsxs("p",{className:"text-sm text-muted",children:[n.siteName," - ",He(new Date(n.requestedDate),"dd MMM, yyyy")]})]}),r.jsx(se,{variant:"icon",onClick:e,children:r.jsx(Zi,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"flex-grow overflow-y-auto p-6",children:r.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:n.gender==="Gents"?r.jsxs(r.Fragment,{children:[r.jsx(mf,{readOnly:!0,title:"Gents' Pants",sizes:a.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],quantities:s}),r.jsx(mf,{readOnly:!0,title:"Gents' Shirts",sizes:a.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],quantities:i})]}):r.jsxs(r.Fragment,{children:[r.jsx(mf,{readOnly:!0,title:"Ladies' Pants",sizes:a.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],quantities:s}),r.jsx(mf,{readOnly:!0,title:"Ladies' Shirts",sizes:a.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],quantities:i})]})})}),r.jsx("div",{className:"p-4 border-t flex justify-end flex-shrink-0",children:r.jsx(se,{variant:"secondary",onClick:e,children:"Close"})})]})})},yue=()=>{const n=vt(),[e,t]=k.useState("list"),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState(null),[d,h]=k.useState(!0),[m,f]=k.useState(null),[p,b]=k.useState(null),[x,v]=k.useState(null),[S,B]=k.useState(null),V=async()=>{h(!0);try{const[Y,j,M,H]=await Promise.all([ce.getUniformRequests(),ce.getOrganizations(),ce.getMasterGentsUniforms(),ce.getMasterLadiesUniforms()]);i(Y),o(j),c({gents:M,ladies:H})}catch{f({message:"Failed to load uniform data.",type:"error"})}finally{h(!1)}};k.useEffect(()=>{V()},[]);const R=()=>{n("/uniforms/request/new")},W=Y=>{n(`/uniforms/request/edit/${Y.id}`)},_=async()=>{if(x)try{await ce.deleteUniformRequest(x.id),f({message:"Request deleted.",type:"success"}),v(null),V()}catch{f({message:"Failed to delete request.",type:"error"})}};return d?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{className:"p-4 space-y-6",children:[m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)}),r.jsx(tr,{isOpen:!!x,onClose:()=>v(null),onConfirm:_,title:"Confirm Deletion",children:"Are you sure you want to delete this uniform request? This cannot be undone."}),l&&r.jsx(bue,{request:S,onClose:()=>B(null),masterUniforms:l}),r.jsx("div",{className:"bg-card p-4 rounded-2xl",children:r.jsx(ma,{title:"Uniform Management",children:e==="list"&&r.jsxs(se,{onClick:R,children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," New Uniform Request"]})})}),e==="list"&&r.jsxs("div",{className:"overflow-x-auto",children:[r.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site / Employee"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Gender"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Requested By"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Source"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Status"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),r.jsx("tbody",{children:s.map(Y=>r.jsxs("tr",{children:[r.jsxs("td",{"data-label":"Site",className:"px-4 py-3 font-medium",children:[r.jsx("p",{children:Y.siteName}),Y.source==="Individual"&&Y.employeeDetails?.[0]?.employeeName&&r.jsxs("p",{className:"text-xs text-muted",children:["For: ",Y.employeeDetails[0].employeeName]}),Y.source==="Enrollment"&&r.jsxs("p",{className:"text-xs text-muted",children:["(",Y.employeeDetails?.length||0," employees)"]})]}),r.jsx("td",{"data-label":"Gender",className:"px-4 py-3 text-muted",children:Y.gender}),r.jsx("td",{"data-label":"Requested By",className:"px-4 py-3 text-muted",children:Y.requestedByName||"System"}),r.jsx("td",{"data-label":"Source",className:"px-4 py-3 text-muted",children:Y.source||"Bulk"}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:r.jsx(Aue,{status:Y.status})}),r.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-2 md:justify-start justify-end",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>B(Y),title:"View Request",children:r.jsx(jl,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>W(Y),title:"Edit Request",disabled:Y.source==="Enrollment",children:r.jsx(ms,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>v(Y),title:"Delete Request",disabled:Y.source==="Enrollment",children:r.jsx(rn,{className:"h-4 w-4 text-red-600"})})]})})]},Y.id))})]}),s.length===0&&r.jsx("p",{className:"text-center p-8 text-muted",children:"No uniform requests found."})]})]})},vue=({item:n})=>{const[e,t]=k.useState(!1);return r.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold text-primary-text",children:n.employeeName}),r.jsx("p",{className:"text-sm text-muted",children:n.employeeId}),r.jsx("p",{className:"text-xs text-muted mt-1",children:He(new Date(n.enrollmentDate.replace(/-/g,"/")),"dd MMM, yyyy")})]}),r.jsx("div",{className:"text-right",children:r.jsxs("p",{className:"text-lg font-bold text-accent",children:["",n.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})})]}),n.breakdown.length>0&&r.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[r.jsxs("button",{onClick:()=>t(!e),className:"flex justify-between items-center w-full text-sm text-muted",children:[r.jsx("span",{children:"Details"}),r.jsx(kg,{className:`h-4 w-4 transition-transform ${e?"rotate-180":""}`})]}),e&&r.jsx("ul",{className:"list-disc list-inside space-y-1 mt-2 text-sm text-muted animate-fade-in-down",children:n.breakdown.map((s,i)=>r.jsxs("li",{children:[s.name,": ",(s.cost||0).toFixed(2)]},i))})]})]})},xue=()=>r.jsx("div",{className:"space-y-4",children:[...Array(3)].map((n,e)=>r.jsxs("div",{className:"bg-card rounded-xl border border-border p-4 space-y-3 skeleton-pulse",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-5 w-32 bg-gray-300 rounded"}),r.jsx("div",{className:"h-4 w-24 bg-gray-300 rounded"})]}),r.jsx("div",{className:"h-6 w-20 bg-gray-300 rounded"})]}),r.jsx("div",{className:"h-4 w-1/4 bg-gray-300 rounded mt-2"})]},e))}),Sue=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),{verificationCosts:i,updateVerificationCosts:a}=wi(),[o,l]=k.useState(i),[c,d]=k.useState(!1),[h,m]=k.useState([{startDate:xu(new Date,29),endDate:new Date,key:"selection"}]),[f,p]=k.useState("Last 30 Days"),[b,x]=k.useState(!1),v=k.useRef(null),[S,B]=k.useState(null),V=k.useRef(null),R=jt("(max-width: 767px)"),W=k.useCallback(async()=>{const P=h[0]?.startDate,ne=h[0]?.endDate;if(!(!P||!ne)){s(!0);try{const K=await ce.getVerificationCostBreakdown(He(P,"yyyy-MM-dd"),He(ne,"yyyy-MM-dd"));e(K)}catch(K){console.error("Failed to fetch cost breakdown",K),B({message:"Failed to load verification data.",type:"error"})}finally{s(!1)}}},[h]);k.useEffect(()=>{W()},[W]),k.useEffect(()=>{const P=ne=>{v.current&&!v.current.contains(ne.target)&&x(!1)};return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[]),k.useEffect(()=>{l(i)},[i]),k.useEffect(()=>{d(JSON.stringify(o)!==JSON.stringify(i))},[o,i]);const _=(P,ne,K)=>{l(re=>re.map(le=>le.id===P?ne==="cost"?{...le,cost:parseFloat(K)||0}:{...le,name:K}:le))},Y=()=>{l(P=>[...P,{id:`new_${Date.now()}`,name:"New Verification Type",cost:0}])},j=P=>{l(ne=>ne.filter(K=>K.id!==P))},M=()=>{a(o),B({message:"Costs updated successfully!",type:"success"})},H=k.useMemo(()=>{const P=new Map(i.map(ne=>[ne.name,ne.cost]));return n.map(ne=>{const K=ne.breakdown.map(le=>({...le,cost:Number(P.get(le.name))||0})),re=K.reduce((le,ue)=>le+(ue.cost||0)*ue.count,0);return{...ne,breakdown:K,totalCost:re}})},[n,i]),D=k.useMemo(()=>{const P=H.length,ne=H.reduce((re,le)=>re+le.totalCost,0),K=P>0?ne/P:0;return{totalEmployees:P,totalCost:ne,averageCost:K}},[H]),z=k.useMemo(()=>{const P={};return H.forEach(ne=>{ne.breakdown.forEach(K=>{P[K.name]||(P[K.name]={count:0,total:0}),P[K.name].count+=K.count,P[K.name].total+=(K.cost||0)*K.count})}),Object.entries(P).map(([ne,K])=>({name:ne,...K}))},[H]),[O,E]=k.useState(!1),te=async P=>{{const ne=V.current;if(!ne){B({message:"Could not find report to export.",type:"error"});return}E(!0);try{const K=ne.outerHTML,re={margin:.5,filename:`Cost_Analysis_Report_${He(h[0].startDate,"yyyy-MM-dd")}_to_${He(h[0].endDate,"yyyy-MM-dd")}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};await ce.generatePdf(K,re)}catch(K){console.error("PDF generation failed:",K),B({message:"Failed to generate PDF.",type:"error"})}finally{E(!1)}}},q=[{label:"Today",value:"Today"},{label:"Last 7 Days",value:"Last 7 Days"},{label:"Last 30 Days",value:"Last 30 Days"}],de=P=>{const ne=new Date;let K=new Date;P==="Today"?K=bf():P==="Last 7 Days"?K=xu(ne,6):P==="Last 30 Days"&&(K=xu(ne,29)),p(P),m([{startDate:K,endDate:ne,key:"selection"}]),x(!1)},U=P=>{m([P.selection])};return r.jsxs("div",{className:"p-4 space-y-6",children:[S&&r.jsx(It,{message:S.message,type:S.type,onDismiss:()=>B(null)}),r.jsx(ma,{title:"Verification Costing",children:r.jsx("div",{className:"w-full sm:w-auto",children:r.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:flex-wrap",children:[r.jsxs(se,{onClick:()=>te(),variant:"outline",size:"sm",disabled:O||t||H.length===0,children:[O?r.jsx(xt,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(si,{className:"mr-2 h-4 w-4"}),O?"Generating PDF...":"Download PDF"]}),q.map(P=>r.jsx(se,{variant:f===P.value?"outline":"secondary",size:"sm",onClick:()=>de(P.value),className:"justify-center",children:P.label},P.value)),r.jsxs("div",{className:"relative",ref:v,children:[r.jsxs(se,{variant:f==="Custom"?"outline":"secondary",size:"sm",onClick:()=>{x(P=>!P),p("Custom")},className:"w-full justify-center",children:[r.jsx(ra,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:"Custom Range"})]}),b&&r.jsx("div",{className:"absolute top-full right-0 mt-2 z-10 bg-card border rounded-lg shadow-lg",children:r.jsx(Wm.DateRangePicker,{onChange:U,ranges:h,maxDate:new Date,direction:"horizontal"})})]})]})})}),r.jsx("div",{className:"bg-card p-4 md:p-6 rounded-xl shadow-card",children:r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"cursor-pointer flex justify-between items-center list-none",children:[r.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 text-primary-text",children:[r.jsx(Lm,{className:"h-5 w-5 text-muted"})," Cost Configuration"]}),r.jsx(kg,{className:"transition-transform group-open:rotate-180"})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t",children:[r.jsx("div",{className:"space-y-2",children:o.map(P=>r.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[r.jsx("div",{className:"col-span-12 sm:col-span-6",children:r.jsx(be,{"aria-label":"Cost Item Name",value:P.name,onChange:ne=>_(P.id,"name",ne.target.value),className:"!py-2"})}),r.jsx("div",{className:"col-span-8 sm:col-span-4",children:r.jsx(be,{"aria-label":"Cost Value",type:"number",step:"0.01",value:P.cost||0,onChange:ne=>_(P.id,"cost",ne.target.value),className:"!py-2"})}),r.jsx("div",{className:"col-span-4 sm:col-span-2 text-right",children:r.jsx(se,{variant:"icon",onClick:()=>j(P.id),"aria-label":`Remove ${P.name}`,children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})})]},P.id))}),r.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[r.jsxs(se,{type:"button",variant:"outline",size:"sm",onClick:Y,children:[r.jsx(Tt,{className:"mr-2 h-4"})," Add Cost Item"]}),r.jsxs(se,{onClick:M,disabled:!c,children:[r.jsx(fr,{className:"mr-2 h-4"})," Save Costs"]})]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[r.jsx(ko,{title:"Total Verification Cost",value:`${D.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,icon:Xl}),r.jsx(ko,{title:"Total Verified Employees",value:D.totalEmployees,icon:Ni}),r.jsx(ko,{title:"Avg. Cost Per Employee",value:`${D.averageCost.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,icon:Xl})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary-text",children:"Verification Usage Breakdown"}),t?r.jsx("div",{className:"flex justify-center items-center h-24",children:r.jsx(xt,{className:"h-6 w-6 animate-spin text-muted"})}):z.length>0?r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:z.map(P=>r.jsxs("div",{className:"bg-page p-4 rounded-lg border",children:[r.jsx("p",{className:"text-sm font-medium text-muted",children:P.name}),r.jsx("p",{className:"text-2xl font-bold text-primary-text",children:P.count}),r.jsxs("p",{className:"text-sm font-semibold text-accent-dark",children:["Total: ",P.total.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},P.name))}):r.jsx("p",{className:"text-center text-muted py-8",children:"No verification data for this period."})]}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsx("div",{className:"flex justify-between items-center",children:r.jsx("h3",{className:"text-lg font-semibold text-primary-text",children:"Detailed Report"})}),r.jsx("div",{ref:V,className:"mt-4 pt-4 border-t border-border",children:R?t?r.jsx(xue,{}):H.length===0?r.jsx("p",{className:"text-center text-muted py-8",children:"No report data for this period."}):r.jsx("div",{className:"space-y-4",children:H.map(P=>r.jsx(vue,{item:P},P.id))}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-border responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Employee"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Enrollment Date"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Cost Breakdown"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-muted uppercase",children:"Total Cost"})]})}),r.jsx("tbody",{children:t?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10",children:r.jsx(xt,{className:"h-6 w-6 animate-spin text-muted mx-auto"})})}):H.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"No report data for this period."})}):H.map(P=>r.jsxs("tr",{children:[r.jsxs("td",{"data-label":"Employee",className:"px-6 py-4",children:[r.jsx("div",{className:"font-medium text-primary-text",children:P.employeeName}),r.jsx("div",{className:"text-sm text-muted",children:P.employeeId})]}),r.jsx("td",{"data-label":"Enrollment Date",className:"px-6 py-4 whitespace-nowrap text-sm text-muted",children:He(new Date(P.enrollmentDate.replace(/-/g,"/")),"dd MMM, yyyy")}),r.jsx("td",{"data-label":"Cost Breakdown",className:"px-6 py-4 text-sm text-muted",children:r.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[P.breakdown.map((ne,K)=>r.jsxs("li",{children:[ne.name,": ",(ne.cost||0).toFixed(2)]},K)),P.breakdown.length===0&&r.jsx("li",{children:"No verifications performed"})]})}),r.jsxs("td",{"data-label":"Total Cost",className:"px-6 py-4 whitespace-nowrap text-right font-semibold text-primary-text",children:["",P.totalCost.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]},P.id))})]})})})]})]})},wue=({status:n})=>{if(!n)return r.jsx("span",{className:"text-xs text-muted",children:"-"});const e={"Not Generated":"bg-slate-700 text-white dark:bg-slate-600 dark:text-slate-200",Generated:"bg-sky-100 text-sky-800 dark:bg-sky-500/20 dark:text-sky-300",Sent:"bg-amber-100 text-amber-800 dark:bg-amber-500/20 dark:text-amber-300",Paid:"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-300"};return r.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${e[n]}`,children:n})},Zue=({invoiceData:n,discount:e,setDiscount:t,roundOff:s,setRoundOff:i})=>{const a=l=>new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l),o=k.useMemo(()=>{if(!n)return null;const l=n.lineItems.reduce((f,p)=>{const b=p.deployment*p.ratePerMonth;return p.description.toLowerCase().includes("deduction")?f-b:f+b},0),c=l*.1,d=l+c-e,h=d*.09,m=d+h+h+s;return{subTotal:l,serviceCharge:c,grandTotal:d,gst:h,finalTotal:m}},[n,e,s]);return o?r.jsxs("div",{className:"p-4 bg-white text-black text-[10px] printable-area",children:[r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsxs("div",{children:[r.jsxs("p",{children:["Name : ",n.siteName]}),r.jsxs("p",{children:["Address : ",n.siteAddress]}),r.jsxs("p",{children:["City : ",n.siteAddress.split(",").pop()?.trim()]})]}),r.jsxs("div",{className:"border border-black",children:[r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("div",{className:"p-1 border-r border-b border-black",children:"Invoice No"}),r.jsx("div",{className:"p-1 border-b border-black",children:n.invoiceNumber})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("div",{className:"p-1 border-r border-b border-black",children:"Date"}),r.jsx("div",{className:"p-1 border-b border-black",children:n.invoiceDate})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("div",{className:"p-1 border-r border-b border-black",children:"Month"}),r.jsx("div",{className:"p-1 border-b border-black",children:n.statementMonth.split("-")[0]})]}),r.jsxs("div",{className:"grid grid-cols-2",children:[r.jsx("div",{className:"p-1 border-r border-black",children:"Due Date"}),r.jsx("div",{className:"p-1",children:"January 15, 2023"})]})]})]}),r.jsx("div",{className:"my-4 flex justify-center",children:r.jsx(da,{className:"h-10"})}),r.jsxs("h2",{className:"text-center font-bold text-sm underline mb-2",children:[n.siteName," Summary Statement for the month of ",n.statementMonth]}),r.jsxs("table",{className:"w-full border-collapse border border-black",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"font-bold bg-gray-200",children:[r.jsx("td",{className:"border p-1 border-black",children:"Sl.No"}),r.jsx("td",{className:"border p-1 border-black",children:"Description"}),r.jsx("td",{className:"border p-1 border-black",children:"Deployment"}),r.jsx("td",{className:"border p-1 border-black",children:"No of Days"}),r.jsx("td",{className:"border p-1 border-black",children:"Rate/Day"}),r.jsx("td",{className:"border p-1 border-black",children:"Rate/Month"}),r.jsx("td",{className:"border p-1 border-black",children:"Amount(Rs)"})]})}),r.jsxs("tbody",{children:[r.jsx("tr",{children:r.jsxs("td",{className:"border p-1 border-black font-bold",colSpan:7,children:["SERVICES (01/",He(new Date(n.statementMonth),"MM/yyyy")," to ",He(new Date(n.invoiceDate),"dd/MM/yyyy"),")"]})}),n.lineItems.map((l,c)=>{const d=l.deployment*l.ratePerMonth,h=l.description.toLowerCase().includes("deduction"),m=l.deployment===0;return r.jsxs("tr",{children:[r.jsx("td",{className:"border p-1 border-black text-center",children:c+1}),r.jsx("td",{className:`border p-1 border-black ${h?"text-red-600":""}`,children:l.description}),r.jsx("td",{className:"border p-1 border-black text-center",children:m?"-":l.deployment}),r.jsx("td",{className:"border p-1 border-black text-center",children:m?"-":l.noOfDays}),r.jsx("td",{className:"border p-1 border-black text-right",children:m?"-":a(l.ratePerDay)}),r.jsx("td",{className:"border p-1 border-black text-right",children:m?"-":a(l.ratePerMonth)}),r.jsx("td",{className:`border p-1 border-black text-right ${h?"text-red-600":""}`,children:a(d)})]},l.id)}),Array.from({length:Math.max(0,10-n.lineItems.length)}).map((l,c)=>r.jsx("tr",{children:r.jsx("td",{className:"border p-1 border-black h-6",colSpan:7})},`spacer-${c}`))]}),r.jsxs("tfoot",{children:[r.jsxs("tr",{children:[r.jsx("td",{colSpan:5,className:"border p-1 border-black font-bold",children:"Sub Total"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right font-bold",children:a(o.subTotal)})]}),r.jsxs("tr",{children:[r.jsx("td",{colSpan:5,className:"border p-1 border-black",children:"Admin,Overheads and Service Charges 10% on Sub Total"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right",children:a(o.serviceCharge)})]}),r.jsxs("tr",{className:"no-print",children:[r.jsx("td",{colSpan:5,className:"border p-1 border-black font-bold text-red-600",children:"Discount"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right",children:r.jsx(be,{type:"number",value:e,onChange:l=>t(parseFloat(l.target.value)||0),className:"text-right !p-1"})})]}),r.jsxs("tr",{children:[r.jsx("td",{colSpan:5,className:"border p-1 border-black font-bold",children:"Grand Total"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right font-bold",children:a(o.grandTotal)})]}),r.jsxs("tr",{children:[r.jsx("td",{colSpan:3,className:"border p-1 border-black",children:"Central GST"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-center",children:"9.00%"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right",children:a(o.gst)})]}),r.jsxs("tr",{children:[r.jsx("td",{colSpan:3,className:"border p-1 border-black",children:"State GST"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-center",children:"9.00%"}),r.jsx("td",{colSpan:2,className:"border p-1 border-black text-right",children:a(o.gst)})]}),r.jsxs("tr",{children:[r.jsx("td",{colSpan:5,className:"border p-1 border-black",children:"Round off"}),r.jsxs("td",{colSpan:2,className:"border p-1 border-black text-right",children:[r.jsx("span",{className:"print-only",children:a(s)}),r.jsx("span",{className:"no-print",children:r.jsx(be,{type:"number",step:"0.01",value:s,onChange:l=>i(parseFloat(l.target.value)||0),className:"text-right !p-1"})})]})]}),r.jsxs("tr",{className:"bg-gray-200 font-bold text-base",children:[r.jsx("td",{colSpan:5,className:"border p-2 border-black",children:"Payable for Services rendered"}),r.jsx("td",{colSpan:2,className:"border p-2 border-black text-right",children:a(o.finalTotal)})]})]})]})]}):null},Gue=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!0),[i,a]=k.useState(!1),[o,l]=k.useState(He(new Date,"yyyy-MM")),[c,d]=k.useState({}),[h,m]=k.useState({isOpen:!1,site:null,invoiceData:null,isLoading:!1}),[f,p]=k.useState(0),[b,x]=k.useState(.2),[v,S]=k.useState(null),B=k.useRef(null),[V,R]=k.useState(!1);k.useEffect(()=>{ce.getOrganizations().then(M=>e(M.sort((H,D)=>H.shortName.localeCompare(D.shortName)))).catch(()=>S({message:"Failed to load sites.",type:"error"})).finally(()=>s(!1))},[]);const W=k.useCallback(async M=>{a(!0);try{const H=new Date(M+"-02"),D=await ce.getInvoiceStatuses(H);d(D)}catch{S({message:"Failed to fetch invoice statuses.",type:"error"})}finally{a(!1)}},[]);k.useEffect(()=>{o&&W(o)},[o,W]);const _=async M=>{m({isOpen:!0,site:M,invoiceData:null,isLoading:!0});try{const H=new Date(o+"-02"),D=await ce.getInvoiceSummaryData(M.id,H);m({isOpen:!0,site:M,invoiceData:D,isLoading:!1})}catch{S({message:"Failed to fetch invoice data.",type:"error"}),m({isOpen:!1,site:null,invoiceData:null,isLoading:!1})}},Y=async()=>{const M=B.current;if(!M||!h.invoiceData){S({message:"Could not find invoice to export.",type:"error"});return}R(!0);try{const H=M.outerHTML,D={margin:.25,filename:`Invoice_${h.invoiceData.siteName.replace(" ","_")}_${h.invoiceData.statementMonth}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};await ce.generatePdf(H,D)}catch(H){console.error("PDF generation failed:",H),S({message:"Failed to generate PDF.",type:"error"})}finally{R(!1)}},j=()=>{m({isOpen:!1,site:null,invoiceData:null,isLoading:!1}),p(0),x(.2)};return t?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{className:"p-4 md:p-0",children:[v&&r.jsx(It,{message:v.message,type:v.type,onDismiss:()=>S(null)}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsx(ma,{title:"Invoice Summary"}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[r.jsx("h3",{className:"text-xl font-semibold text-primary-text",children:"Monthly Invoice Status"}),r.jsx("div",{className:"md:w-56",children:r.jsx(be,{label:"",id:"month-select",type:"month",value:o,onChange:M=>l(M.target.value)})})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Site Name"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Invoice Status"}),r.jsx("th",{className:"px-4 py-3 text-left font-medium text-muted",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-border md:bg-card md:divide-y-0",children:n.map(M=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"Site Name",className:"px-4 py-3 font-medium",children:M.shortName}),r.jsx("td",{"data-label":"Status",className:"px-4 py-3",children:i?r.jsx(xt,{className:"h-4 w-4 animate-spin"}):r.jsx(wue,{status:c[M.id]})}),r.jsx("td",{"data-label":"Actions",className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-2 justify-end md:justify-start",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>_(M),disabled:c[M.id]==="Not Generated"||i,title:"View Invoice",children:r.jsx(jl,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>_(M),disabled:c[M.id]==="Not Generated"||i,title:"Download Invoice",children:r.jsx(si,{className:"h-4 w-4"})})]})})]},M.id))})]})})]})]}),h.isOpen&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:j,children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card w-full max-w-4xl m-4 animate-fade-in-scale flex flex-col",onClick:M=>M.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b flex justify-between items-center no-print",children:[r.jsxs("h3",{className:"text-lg font-bold text-primary-text",children:["Invoice for ",h.site?.shortName]}),r.jsx(se,{variant:"icon",onClick:j,children:r.jsx(Zi,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"flex-grow overflow-y-auto p-4 max-h-[70vh]",children:h.isLoading?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):h.invoiceData?r.jsx("div",{ref:B,children:r.jsx(Zue,{invoiceData:h.invoiceData,discount:f,setDiscount:p,roundOff:b,setRoundOff:x})}):r.jsx("p",{className:"text-center text-muted",children:"No data to display."})}),r.jsx("div",{className:"p-4 border-t flex justify-end no-print",children:r.jsxs(se,{onClick:Y,disabled:!h.invoiceData||V,children:[V?r.jsx(xt,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(si,{className:"mr-2 h-4 w-4"}),V?"Generating...":"Download PDF"]})})]})})]})};var om={exports:{}};var Bue=om.exports,YY;function Nue(){return YY||(YY=1,(function(n,e){(function(t,s){s(e)})(Bue,(function(t){var s="1.9.4";function i(u){var A,G,X,T;for(G=1,X=arguments.length;G<X;G++){T=arguments[G];for(A in T)u[A]=T[A]}return u}var a=Object.create||(function(){function u(){}return function(A){return u.prototype=A,new u}})();function o(u,A){var G=Array.prototype.slice;if(u.bind)return u.bind.apply(u,G.call(arguments,1));var X=G.call(arguments,2);return function(){return u.apply(A,X.length?X.concat(G.call(arguments)):arguments)}}var l=0;function c(u){return"_leaflet_id"in u||(u._leaflet_id=++l),u._leaflet_id}function d(u,A,G){var X,T,$,me;return me=function(){X=!1,T&&($.apply(G,T),T=!1)},$=function(){X?T=arguments:(u.apply(G,arguments),setTimeout(me,A),X=!0)},$}function h(u,A,G){var X=A[1],T=A[0],$=X-T;return u===X&&G?u:((u-T)%$+$)%$+T}function m(){return!1}function f(u,A){if(A===!1)return u;var G=Math.pow(10,A===void 0?6:A);return Math.round(u*G)/G}function p(u){return u.trim?u.trim():u.replace(/^\s+|\s+$/g,"")}function b(u){return p(u).split(/\s+/)}function x(u,A){Object.prototype.hasOwnProperty.call(u,"options")||(u.options=u.options?a(u.options):{});for(var G in A)u.options[G]=A[G];return u.options}function v(u,A,G){var X=[];for(var T in u)X.push(encodeURIComponent(G?T.toUpperCase():T)+"="+encodeURIComponent(u[T]));return(!A||A.indexOf("?")===-1?"?":"&")+X.join("&")}var S=/\{ *([\w_ -]+) *\}/g;function B(u,A){return u.replace(S,function(G,X){var T=A[X];if(T===void 0)throw new Error("No value provided for variable "+G);return typeof T=="function"&&(T=T(A)),T})}var V=Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"};function R(u,A){for(var G=0;G<u.length;G++)if(u[G]===A)return G;return-1}var W="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(u){return window["webkit"+u]||window["moz"+u]||window["ms"+u]}var Y=0;function j(u){var A=+new Date,G=Math.max(0,16-(A-Y));return Y=A+G,window.setTimeout(u,G)}var M=window.requestAnimationFrame||_("RequestAnimationFrame")||j,H=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(u){window.clearTimeout(u)};function D(u,A,G){if(G&&M===j)u.call(A);else return M.call(window,o(u,A))}function z(u){u&&H.call(window,u)}var O={__proto__:null,extend:i,create:a,bind:o,get lastId(){return l},stamp:c,throttle:d,wrapNum:h,falseFn:m,formatNum:f,trim:p,splitWords:b,setOptions:x,getParamString:v,template:B,isArray:V,indexOf:R,emptyImageUrl:W,requestFn:M,cancelFn:H,requestAnimFrame:D,cancelAnimFrame:z};function E(){}E.extend=function(u){var A=function(){x(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},G=A.__super__=this.prototype,X=a(G);X.constructor=A,A.prototype=X;for(var T in this)Object.prototype.hasOwnProperty.call(this,T)&&T!=="prototype"&&T!=="__super__"&&(A[T]=this[T]);return u.statics&&i(A,u.statics),u.includes&&(te(u.includes),i.apply(null,[X].concat(u.includes))),i(X,u),delete X.statics,delete X.includes,X.options&&(X.options=G.options?a(G.options):{},i(X.options,u.options)),X._initHooks=[],X.callInitHooks=function(){if(!this._initHooksCalled){G.callInitHooks&&G.callInitHooks.call(this),this._initHooksCalled=!0;for(var $=0,me=X._initHooks.length;$<me;$++)X._initHooks[$].call(this)}},A},E.include=function(u){var A=this.prototype.options;return i(this.prototype,u),u.options&&(this.prototype.options=A,this.mergeOptions(u.options)),this},E.mergeOptions=function(u){return i(this.prototype.options,u),this},E.addInitHook=function(u){var A=Array.prototype.slice.call(arguments,1),G=typeof u=="function"?u:function(){this[u].apply(this,A)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(G),this};function te(u){if(!(typeof L>"u"||!L||!L.Mixin)){u=V(u)?u:[u];for(var A=0;A<u.length;A++)u[A]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var q={on:function(u,A,G){if(typeof u=="object")for(var X in u)this._on(X,u[X],A);else{u=b(u);for(var T=0,$=u.length;T<$;T++)this._on(u[T],A,G)}return this},off:function(u,A,G){if(!arguments.length)delete this._events;else if(typeof u=="object")for(var X in u)this._off(X,u[X],A);else{u=b(u);for(var T=arguments.length===1,$=0,me=u.length;$<me;$++)T?this._off(u[$]):this._off(u[$],A,G)}return this},_on:function(u,A,G,X){if(typeof A!="function"){console.warn("wrong listener type: "+typeof A);return}if(this._listens(u,A,G)===!1){G===this&&(G=void 0);var T={fn:A,ctx:G};X&&(T.once=!0),this._events=this._events||{},this._events[u]=this._events[u]||[],this._events[u].push(T)}},_off:function(u,A,G){var X,T,$;if(this._events&&(X=this._events[u],!!X)){if(arguments.length===1){if(this._firingCount)for(T=0,$=X.length;T<$;T++)X[T].fn=m;delete this._events[u];return}if(typeof A!="function"){console.warn("wrong listener type: "+typeof A);return}var me=this._listens(u,A,G);if(me!==!1){var we=X[me];this._firingCount&&(we.fn=m,this._events[u]=X=X.slice()),X.splice(me,1)}}},fire:function(u,A,G){if(!this.listens(u,G))return this;var X=i({},A,{type:u,target:this,sourceTarget:A&&A.sourceTarget||this});if(this._events){var T=this._events[u];if(T){this._firingCount=this._firingCount+1||1;for(var $=0,me=T.length;$<me;$++){var we=T[$],We=we.fn;we.once&&this.off(u,We,we.ctx),We.call(we.ctx||this,X)}this._firingCount--}}return G&&this._propagateEvent(X),this},listens:function(u,A,G,X){typeof u!="string"&&console.warn('"string" type argument expected');var T=A;typeof A!="function"&&(X=!!A,T=void 0,G=void 0);var $=this._events&&this._events[u];if($&&$.length&&this._listens(u,T,G)!==!1)return!0;if(X){for(var me in this._eventParents)if(this._eventParents[me].listens(u,A,G,X))return!0}return!1},_listens:function(u,A,G){if(!this._events)return!1;var X=this._events[u]||[];if(!A)return!!X.length;G===this&&(G=void 0);for(var T=0,$=X.length;T<$;T++)if(X[T].fn===A&&X[T].ctx===G)return T;return!1},once:function(u,A,G){if(typeof u=="object")for(var X in u)this._on(X,u[X],A,!0);else{u=b(u);for(var T=0,$=u.length;T<$;T++)this._on(u[T],A,G,!0)}return this},addEventParent:function(u){return this._eventParents=this._eventParents||{},this._eventParents[c(u)]=u,this},removeEventParent:function(u){return this._eventParents&&delete this._eventParents[c(u)],this},_propagateEvent:function(u){for(var A in this._eventParents)this._eventParents[A].fire(u.type,i({layer:u.target,propagatedFrom:u.target},u),!0)}};q.addEventListener=q.on,q.removeEventListener=q.clearAllEventListeners=q.off,q.addOneTimeEventListener=q.once,q.fireEvent=q.fire,q.hasEventListeners=q.listens;var de=E.extend(q);function U(u,A,G){this.x=G?Math.round(u):u,this.y=G?Math.round(A):A}var P=Math.trunc||function(u){return u>0?Math.floor(u):Math.ceil(u)};U.prototype={clone:function(){return new U(this.x,this.y)},add:function(u){return this.clone()._add(ne(u))},_add:function(u){return this.x+=u.x,this.y+=u.y,this},subtract:function(u){return this.clone()._subtract(ne(u))},_subtract:function(u){return this.x-=u.x,this.y-=u.y,this},divideBy:function(u){return this.clone()._divideBy(u)},_divideBy:function(u){return this.x/=u,this.y/=u,this},multiplyBy:function(u){return this.clone()._multiplyBy(u)},_multiplyBy:function(u){return this.x*=u,this.y*=u,this},scaleBy:function(u){return new U(this.x*u.x,this.y*u.y)},unscaleBy:function(u){return new U(this.x/u.x,this.y/u.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=P(this.x),this.y=P(this.y),this},distanceTo:function(u){u=ne(u);var A=u.x-this.x,G=u.y-this.y;return Math.sqrt(A*A+G*G)},equals:function(u){return u=ne(u),u.x===this.x&&u.y===this.y},contains:function(u){return u=ne(u),Math.abs(u.x)<=Math.abs(this.x)&&Math.abs(u.y)<=Math.abs(this.y)},toString:function(){return"Point("+f(this.x)+", "+f(this.y)+")"}};function ne(u,A,G){return u instanceof U?u:V(u)?new U(u[0],u[1]):u==null?u:typeof u=="object"&&"x"in u&&"y"in u?new U(u.x,u.y):new U(u,A,G)}function K(u,A){if(u)for(var G=A?[u,A]:u,X=0,T=G.length;X<T;X++)this.extend(G[X])}K.prototype={extend:function(u){var A,G;if(!u)return this;if(u instanceof U||typeof u[0]=="number"||"x"in u)A=G=ne(u);else if(u=re(u),A=u.min,G=u.max,!A||!G)return this;return!this.min&&!this.max?(this.min=A.clone(),this.max=G.clone()):(this.min.x=Math.min(A.x,this.min.x),this.max.x=Math.max(G.x,this.max.x),this.min.y=Math.min(A.y,this.min.y),this.max.y=Math.max(G.y,this.max.y)),this},getCenter:function(u){return ne((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,u)},getBottomLeft:function(){return ne(this.min.x,this.max.y)},getTopRight:function(){return ne(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(u){var A,G;return typeof u[0]=="number"||u instanceof U?u=ne(u):u=re(u),u instanceof K?(A=u.min,G=u.max):A=G=u,A.x>=this.min.x&&G.x<=this.max.x&&A.y>=this.min.y&&G.y<=this.max.y},intersects:function(u){u=re(u);var A=this.min,G=this.max,X=u.min,T=u.max,$=T.x>=A.x&&X.x<=G.x,me=T.y>=A.y&&X.y<=G.y;return $&&me},overlaps:function(u){u=re(u);var A=this.min,G=this.max,X=u.min,T=u.max,$=T.x>A.x&&X.x<G.x,me=T.y>A.y&&X.y<G.y;return $&&me},isValid:function(){return!!(this.min&&this.max)},pad:function(u){var A=this.min,G=this.max,X=Math.abs(A.x-G.x)*u,T=Math.abs(A.y-G.y)*u;return re(ne(A.x-X,A.y-T),ne(G.x+X,G.y+T))},equals:function(u){return u?(u=re(u),this.min.equals(u.getTopLeft())&&this.max.equals(u.getBottomRight())):!1}};function re(u,A){return!u||u instanceof K?u:new K(u,A)}function le(u,A){if(u)for(var G=A?[u,A]:u,X=0,T=G.length;X<T;X++)this.extend(G[X])}le.prototype={extend:function(u){var A=this._southWest,G=this._northEast,X,T;if(u instanceof ae)X=u,T=u;else if(u instanceof le){if(X=u._southWest,T=u._northEast,!X||!T)return this}else return u?this.extend(Ce(u)||ue(u)):this;return!A&&!G?(this._southWest=new ae(X.lat,X.lng),this._northEast=new ae(T.lat,T.lng)):(A.lat=Math.min(X.lat,A.lat),A.lng=Math.min(X.lng,A.lng),G.lat=Math.max(T.lat,G.lat),G.lng=Math.max(T.lng,G.lng)),this},pad:function(u){var A=this._southWest,G=this._northEast,X=Math.abs(A.lat-G.lat)*u,T=Math.abs(A.lng-G.lng)*u;return new le(new ae(A.lat-X,A.lng-T),new ae(G.lat+X,G.lng+T))},getCenter:function(){return new ae((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ae(this.getNorth(),this.getWest())},getSouthEast:function(){return new ae(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(u){typeof u[0]=="number"||u instanceof ae||"lat"in u?u=Ce(u):u=ue(u);var A=this._southWest,G=this._northEast,X,T;return u instanceof le?(X=u.getSouthWest(),T=u.getNorthEast()):X=T=u,X.lat>=A.lat&&T.lat<=G.lat&&X.lng>=A.lng&&T.lng<=G.lng},intersects:function(u){u=ue(u);var A=this._southWest,G=this._northEast,X=u.getSouthWest(),T=u.getNorthEast(),$=T.lat>=A.lat&&X.lat<=G.lat,me=T.lng>=A.lng&&X.lng<=G.lng;return $&&me},overlaps:function(u){u=ue(u);var A=this._southWest,G=this._northEast,X=u.getSouthWest(),T=u.getNorthEast(),$=T.lat>A.lat&&X.lat<G.lat,me=T.lng>A.lng&&X.lng<G.lng;return $&&me},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(u,A){return u?(u=ue(u),this._southWest.equals(u.getSouthWest(),A)&&this._northEast.equals(u.getNorthEast(),A)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ue(u,A){return u instanceof le?u:new le(u,A)}function ae(u,A,G){if(isNaN(u)||isNaN(A))throw new Error("Invalid LatLng object: ("+u+", "+A+")");this.lat=+u,this.lng=+A,G!==void 0&&(this.alt=+G)}ae.prototype={equals:function(u,A){if(!u)return!1;u=Ce(u);var G=Math.max(Math.abs(this.lat-u.lat),Math.abs(this.lng-u.lng));return G<=(A===void 0?1e-9:A)},toString:function(u){return"LatLng("+f(this.lat,u)+", "+f(this.lng,u)+")"},distanceTo:function(u){return ge.distance(this,Ce(u))},wrap:function(){return ge.wrapLatLng(this)},toBounds:function(u){var A=180*u/40075017,G=A/Math.cos(Math.PI/180*this.lat);return ue([this.lat-A,this.lng-G],[this.lat+A,this.lng+G])},clone:function(){return new ae(this.lat,this.lng,this.alt)}};function Ce(u,A,G){return u instanceof ae?u:V(u)&&typeof u[0]!="object"?u.length===3?new ae(u[0],u[1],u[2]):u.length===2?new ae(u[0],u[1]):null:u==null?u:typeof u=="object"&&"lat"in u?new ae(u.lat,"lng"in u?u.lng:u.lon,u.alt):A===void 0?null:new ae(u,A,G)}var ie={latLngToPoint:function(u,A){var G=this.projection.project(u),X=this.scale(A);return this.transformation._transform(G,X)},pointToLatLng:function(u,A){var G=this.scale(A),X=this.transformation.untransform(u,G);return this.projection.unproject(X)},project:function(u){return this.projection.project(u)},unproject:function(u){return this.projection.unproject(u)},scale:function(u){return 256*Math.pow(2,u)},zoom:function(u){return Math.log(u/256)/Math.LN2},getProjectedBounds:function(u){if(this.infinite)return null;var A=this.projection.bounds,G=this.scale(u),X=this.transformation.transform(A.min,G),T=this.transformation.transform(A.max,G);return new K(X,T)},infinite:!1,wrapLatLng:function(u){var A=this.wrapLng?h(u.lng,this.wrapLng,!0):u.lng,G=this.wrapLat?h(u.lat,this.wrapLat,!0):u.lat,X=u.alt;return new ae(G,A,X)},wrapLatLngBounds:function(u){var A=u.getCenter(),G=this.wrapLatLng(A),X=A.lat-G.lat,T=A.lng-G.lng;if(X===0&&T===0)return u;var $=u.getSouthWest(),me=u.getNorthEast(),we=new ae($.lat-X,$.lng-T),We=new ae(me.lat-X,me.lng-T);return new le(we,We)}},ge=i({},ie,{wrapLng:[-180,180],R:6371e3,distance:function(u,A){var G=Math.PI/180,X=u.lat*G,T=A.lat*G,$=Math.sin((A.lat-u.lat)*G/2),me=Math.sin((A.lng-u.lng)*G/2),we=$*$+Math.cos(X)*Math.cos(T)*me*me,We=2*Math.atan2(Math.sqrt(we),Math.sqrt(1-we));return this.R*We}}),xe=6378137,_e={R:xe,MAX_LATITUDE:85.0511287798,project:function(u){var A=Math.PI/180,G=this.MAX_LATITUDE,X=Math.max(Math.min(G,u.lat),-G),T=Math.sin(X*A);return new U(this.R*u.lng*A,this.R*Math.log((1+T)/(1-T))/2)},unproject:function(u){var A=180/Math.PI;return new ae((2*Math.atan(Math.exp(u.y/this.R))-Math.PI/2)*A,u.x*A/this.R)},bounds:(function(){var u=xe*Math.PI;return new K([-u,-u],[u,u])})()};function Be(u,A,G,X){if(V(u)){this._a=u[0],this._b=u[1],this._c=u[2],this._d=u[3];return}this._a=u,this._b=A,this._c=G,this._d=X}Be.prototype={transform:function(u,A){return this._transform(u.clone(),A)},_transform:function(u,A){return A=A||1,u.x=A*(this._a*u.x+this._b),u.y=A*(this._c*u.y+this._d),u},untransform:function(u,A){return A=A||1,new U((u.x/A-this._b)/this._a,(u.y/A-this._d)/this._c)}};function Se(u,A,G,X){return new Be(u,A,G,X)}var Re=i({},ge,{code:"EPSG:3857",projection:_e,transformation:(function(){var u=.5/(Math.PI*_e.R);return Se(u,.5,-u,.5)})()}),Ye=i({},Re,{code:"EPSG:900913"});function De(u){return document.createElementNS("http://www.w3.org/2000/svg",u)}function Me(u,A){var G="",X,T,$,me,we,We;for(X=0,$=u.length;X<$;X++){for(we=u[X],T=0,me=we.length;T<me;T++)We=we[T],G+=(T?"L":"M")+We.x+" "+We.y;G+=A?gt.svg?"z":"x":""}return G||"M0 0"}var Le=document.documentElement.style,nt="ActiveXObject"in window,st=nt&&!document.addEventListener,ee="msLaunchUri"in navigator&&!("documentMode"in document),oe=fs("webkit"),Ie=fs("android"),Ne=fs("android 2")||fs("android 3"),Ge=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),je=Ie&&fs("Google")&&Ge<537&&!("AudioNode"in window),Fe=!!window.opera,ze=!ee&&fs("chrome"),lt=fs("gecko")&&!oe&&!Fe&&!nt,Dt=!ze&&fs("safari"),kt=fs("phantom"),$t="OTransition"in Le,wn=navigator.platform.indexOf("Win")===0,Rt=nt&&"transition"in Le,cn="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ne,en="MozPerspective"in Le,on=!window.L_DISABLE_3D&&(Rt||cn||en)&&!$t&&!kt,Ut=typeof orientation<"u"||fs("mobile"),dn=Ut&&oe,fn=Ut&&cn,Ft=!window.PointerEvent&&window.MSPointerEvent,it=!!(window.PointerEvent||Ft),pn="ontouchstart"in window||!!window.TouchEvent,un=!window.L_NO_TOUCH&&(pn||it),ls=Ut&&Fe,Cs=Ut&&lt,br=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ia=(function(){var u=!1;try{var A=Object.defineProperty({},"passive",{get:function(){u=!0}});window.addEventListener("testPassiveEventSupport",m,A),window.removeEventListener("testPassiveEventSupport",m,A)}catch{}return u})(),Xr=(function(){return!!document.createElement("canvas").getContext})(),Rn=!!(document.createElementNS&&De("svg").createSVGRect),nr=!!Rn&&(function(){var u=document.createElement("div");return u.innerHTML="<svg/>",(u.firstChild&&u.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Jr=!Rn&&(function(){try{var u=document.createElement("div");u.innerHTML='<v:shape adj="1"/>';var A=u.firstChild;return A.style.behavior="url(#default#VML)",A&&typeof A.adj=="object"}catch{return!1}})(),Gs=navigator.platform.indexOf("Mac")===0,Yo=navigator.platform.indexOf("Linux")===0;function fs(u){return navigator.userAgent.toLowerCase().indexOf(u)>=0}var gt={ie:nt,ielt9:st,edge:ee,webkit:oe,android:Ie,android23:Ne,androidStock:je,opera:Fe,chrome:ze,gecko:lt,safari:Dt,phantom:kt,opera12:$t,win:wn,ie3d:Rt,webkit3d:cn,gecko3d:en,any3d:on,mobile:Ut,mobileWebkit:dn,mobileWebkit3d:fn,msPointer:Ft,pointer:it,touch:un,touchNative:pn,mobileOpera:ls,mobileGecko:Cs,retina:br,passiveEvents:Ia,canvas:Xr,svg:Rn,vml:Jr,inlineSvg:nr,mac:Gs,linux:Yo},Ca=gt.msPointer?"MSPointerDown":"pointerdown",Pa=gt.msPointer?"MSPointerMove":"pointermove",Tl=gt.msPointer?"MSPointerUp":"pointerup",El=gt.msPointer?"MSPointerCancel":"pointercancel",Fo={touchstart:Ca,touchmove:Pa,touchend:Tl,touchcancel:El},Yr={touchstart:jn,touchmove:Ka,touchend:Ka,touchcancel:Ka},ai={},Mo=!1;function yd(u,A,G){return A==="touchstart"&&vd(),Yr[A]?(G=Yr[A].bind(this,G),u.addEventListener(Fo[A],G,!1),G):(console.warn("wrong event specified:",A),m)}function Dl(u,A,G){if(!Fo[A]){console.warn("wrong event specified:",A);return}u.removeEventListener(Fo[A],G,!1)}function Ll(u){ai[u.pointerId]=u}function Pl(u){ai[u.pointerId]&&(ai[u.pointerId]=u)}function Ho(u){delete ai[u.pointerId]}function vd(){Mo||(document.addEventListener(Ca,Ll,!0),document.addEventListener(Pa,Pl,!0),document.addEventListener(Tl,Ho,!0),document.addEventListener(El,Ho,!0),Mo=!0)}function Ka(u,A){if(A.pointerType!==(A.MSPOINTER_TYPE_MOUSE||"mouse")){A.touches=[];for(var G in ai)A.touches.push(ai[G]);A.changedTouches=[A],u(A)}}function jn(u,A){A.MSPOINTER_TYPE_TOUCH&&A.pointerType===A.MSPOINTER_TYPE_TOUCH&&Xn(A),Ka(u,A)}function xd(u){var A={},G,X;for(X in u)G=u[X],A[X]=G&&G.bind?G.bind(u):G;return u=A,A.type="dblclick",A.detail=2,A.isTrusted=!1,A._simulated=!0,A}var To=200;function Kl(u,A){u.addEventListener("dblclick",A);var G=0,X;function T($){if($.detail!==1){X=$.detail;return}if(!($.pointerType==="mouse"||$.sourceCapabilities&&!$.sourceCapabilities.firesTouchEvents)){var me=ci($);if(!(me.some(function(We){return We instanceof HTMLLabelElement&&We.attributes.for})&&!me.some(function(We){return We instanceof HTMLInputElement||We instanceof HTMLSelectElement}))){var we=Date.now();we-G<=To?(X++,X===2&&A(xd($))):X=1,G=we}}}return u.addEventListener("click",T),{dblclick:A,simDblclick:T}}function Oa(u,A){u.removeEventListener("dblclick",A.dblclick),u.removeEventListener("click",A.simDblclick)}var Eo=Xi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Vi=Xi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),fa=Vi==="webkitTransition"||Vi==="OTransition"?Vi+"End":"transitionend";function Es(u){return typeof u=="string"?document.getElementById(u):u}function pa(u,A){var G=u.style[A]||u.currentStyle&&u.currentStyle[A];if((!G||G==="auto")&&document.defaultView){var X=document.defaultView.getComputedStyle(u,null);G=X?X[A]:null}return G==="auto"?null:G}function Wt(u,A,G){var X=document.createElement(u);return X.className=A||"",G&&G.appendChild(X),X}function Zn(u){var A=u.parentNode;A&&A.removeChild(u)}function za(u){for(;u.firstChild;)u.removeChild(u.firstChild)}function _i(u){var A=u.parentNode;A&&A.lastChild!==u&&A.appendChild(u)}function yr(u){var A=u.parentNode;A&&A.firstChild!==u&&A.insertBefore(u,A.firstChild)}function ji(u,A){if(u.classList!==void 0)return u.classList.contains(A);var G=Ua(u);return G.length>0&&new RegExp("(^|\\s)"+A+"(\\s|$)").test(G)}function Nt(u,A){if(u.classList!==void 0)for(var G=b(A),X=0,T=G.length;X<T;X++)u.classList.add(G[X]);else if(!ji(u,A)){var $=Ua(u);Do(u,($?$+" ":"")+A)}}function vn(u,A){u.classList!==void 0?u.classList.remove(A):Do(u,p((" "+Ua(u)+" ").replace(" "+A+" "," ")))}function Do(u,A){u.className.baseVal===void 0?u.className=A:u.className.baseVal=A}function Ua(u){return u.correspondingElement&&(u=u.correspondingElement),u.className.baseVal===void 0?u.className:u.className.baseVal}function ps(u,A){"opacity"in u.style?u.style.opacity=A:"filter"in u.style&&Ol(u,A)}function Ol(u,A){var G=!1,X="DXImageTransform.Microsoft.Alpha";try{G=u.filters.item(X)}catch{if(A===1)return}A=Math.round(A*100),G?(G.Enabled=A!==100,G.Opacity=A):u.style.filter+=" progid:"+X+"(opacity="+A+")"}function Xi(u){for(var A=document.documentElement.style,G=0;G<u.length;G++)if(u[G]in A)return u[G];return!1}function Ds(u,A,G){var X=A||new U(0,0);u.style[Eo]=(gt.ie3d?"translate("+X.x+"px,"+X.y+"px)":"translate3d("+X.x+"px,"+X.y+"px,0)")+(G?" scale("+G+")":"")}function Fn(u,A){u._leaflet_pos=A,gt.any3d?Ds(u,A):(u.style.left=A.x+"px",u.style.top=A.y+"px")}function vr(u){return u._leaflet_pos||new U(0,0)}var zt,Ji,Qa;if("onselectstart"in document)zt=function(){wt(window,"selectstart",Xn)},Ji=function(){hn(window,"selectstart",Xn)};else{var oi=Xi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);zt=function(){if(oi){var u=document.documentElement.style;Qa=u[oi],u[oi]="none"}},Ji=function(){oi&&(document.documentElement.style[oi]=Qa,Qa=void 0)}}function qa(){wt(window,"dragstart",Xn)}function $a(){hn(window,"dragstart",Xn)}var Aa,ba;function Yi(u){for(;u.tabIndex===-1;)u=u.parentNode;u.style&&(Ls(),Aa=u,ba=u.style.outlineStyle,u.style.outlineStyle="none",wt(window,"keydown",Ls))}function Ls(){Aa&&(Aa.style.outlineStyle=ba,Aa=void 0,ba=void 0,hn(window,"keydown",Ls))}function xr(u){do u=u.parentNode;while((!u.offsetWidth||!u.offsetHeight)&&u!==document.body);return u}function sr(u){var A=u.getBoundingClientRect();return{x:A.width/u.offsetWidth||1,y:A.height/u.offsetHeight||1,boundingClientRect:A}}var ya={__proto__:null,TRANSFORM:Eo,TRANSITION:Vi,TRANSITION_END:fa,get:Es,getStyle:pa,create:Wt,remove:Zn,empty:za,toFront:_i,toBack:yr,hasClass:ji,addClass:Nt,removeClass:vn,setClass:Do,getClass:Ua,setOpacity:ps,testProp:Xi,setTransform:Ds,setPosition:Fn,getPosition:vr,get disableTextSelection(){return zt},get enableTextSelection(){return Ji},disableImageDrag:qa,enableImageDrag:$a,preventOutline:Yi,restoreOutline:Ls,getSizedParentNode:xr,getScale:sr};function wt(u,A,G,X){if(A&&typeof A=="object")for(var T in A)Po(u,T,A[T],G);else{A=b(A);for(var $=0,me=A.length;$<me;$++)Po(u,A[$],G,X)}return this}var qn="_leaflet_events";function hn(u,A,G,X){if(arguments.length===1)Lo(u),delete u[qn];else if(A&&typeof A=="object")for(var T in A)eo(u,T,A[T],G);else if(A=b(A),arguments.length===2)Lo(u,function(we){return R(A,we)!==-1});else for(var $=0,me=A.length;$<me;$++)eo(u,A[$],G,X);return this}function Lo(u,A){for(var G in u[qn]){var X=G.split(/\d/)[0];(!A||A(X))&&eo(u,X,null,null,G)}}var li={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Po(u,A,G,X){var T=A+c(G)+(X?"_"+c(X):"");if(u[qn]&&u[qn][T])return this;var $=function(we){return G.call(X||u,we||window.event)},me=$;!gt.touchNative&&gt.pointer&&A.indexOf("touch")===0?$=yd(u,A,$):gt.touch&&A==="dblclick"?$=Kl(u,$):"addEventListener"in u?A==="touchstart"||A==="touchmove"||A==="wheel"||A==="mousewheel"?u.addEventListener(li[A]||A,$,gt.passiveEvents?{passive:!1}:!1):A==="mouseenter"||A==="mouseleave"?($=function(we){we=we||window.event,Sa(u,we)&&me(we)},u.addEventListener(li[A],$,!1)):u.addEventListener(A,me,!1):u.attachEvent("on"+A,$),u[qn]=u[qn]||{},u[qn][T]=$}function eo(u,A,G,X,T){T=T||A+c(G)+(X?"_"+c(X):"");var $=u[qn]&&u[qn][T];if(!$)return this;!gt.touchNative&&gt.pointer&&A.indexOf("touch")===0?Dl(u,A,$):gt.touch&&A==="dblclick"?Oa(u,$):"removeEventListener"in u?u.removeEventListener(li[A]||A,$,!1):u.detachEvent("on"+A,$),u[qn][T]=null}function rr(u){return u.stopPropagation?u.stopPropagation():u.originalEvent?u.originalEvent._stopped=!0:u.cancelBubble=!0,this}function to(u){return Po(u,"wheel",rr),this}function va(u){return wt(u,"mousedown touchstart dblclick contextmenu",rr),u._leaflet_disable_click=!0,this}function Xn(u){return u.preventDefault?u.preventDefault():u.returnValue=!1,this}function Ps(u){return Xn(u),rr(u),this}function ci(u){if(u.composedPath)return u.composedPath();for(var A=[],G=u.target;G;)A.push(G),G=G.parentNode;return A}function xa(u,A){if(!A)return new U(u.clientX,u.clientY);var G=sr(A),X=G.boundingClientRect;return new U((u.clientX-X.left)/G.x-A.clientLeft,(u.clientY-X.top)/G.y-A.clientTop)}var Sd=gt.linux&&gt.chrome?window.devicePixelRatio:gt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function zl(u){return gt.edge?u.wheelDeltaY/2:u.deltaY&&u.deltaMode===0?-u.deltaY/Sd:u.deltaY&&u.deltaMode===1?-u.deltaY*20:u.deltaY&&u.deltaMode===2?-u.deltaY*60:u.deltaX||u.deltaZ?0:u.wheelDelta?(u.wheelDeltaY||u.wheelDelta)/2:u.detail&&Math.abs(u.detail)<32765?-u.detail*20:u.detail?u.detail/-32765*60:0}function Sa(u,A){var G=A.relatedTarget;if(!G)return!0;try{for(;G&&G!==u;)G=G.parentNode}catch{return!1}return G!==u}var no={__proto__:null,on:wt,off:hn,stopPropagation:rr,disableScrollPropagation:to,disableClickPropagation:va,preventDefault:Xn,stop:Ps,getPropagationPath:ci,getMousePosition:xa,getWheelDelta:zl,isExternalTarget:Sa,addListener:wt,removeListener:hn},so=de.extend({run:function(u,A,G,X){this.stop(),this._el=u,this._inProgress=!0,this._duration=G||.25,this._easeOutPower=1/Math.max(X||.5,.2),this._startPos=vr(u),this._offset=A.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=D(this._animate,this),this._step()},_step:function(u){var A=+new Date-this._startTime,G=this._duration*1e3;A<G?this._runFrame(this._easeOut(A/G),u):(this._runFrame(1),this._complete())},_runFrame:function(u,A){var G=this._startPos.add(this._offset.multiplyBy(u));A&&G._round(),Fn(this._el,G),this.fire("step")},_complete:function(){z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(u){return 1-Math.pow(1-u,this._easeOutPower)}}),Pt=de.extend({options:{crs:Re,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(u,A){A=x(this,A),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(u),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),A.maxBounds&&this.setMaxBounds(A.maxBounds),A.zoom!==void 0&&(this._zoom=this._limitZoom(A.zoom)),A.center&&A.zoom!==void 0&&this.setView(Ce(A.center),A.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Vi&&gt.any3d&&!gt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),wt(this._proxy,fa,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(u,A,G){if(A=A===void 0?this._zoom:this._limitZoom(A),u=this._limitCenter(Ce(u),A,this.options.maxBounds),G=G||{},this._stop(),this._loaded&&!G.reset&&G!==!0){G.animate!==void 0&&(G.zoom=i({animate:G.animate},G.zoom),G.pan=i({animate:G.animate,duration:G.duration},G.pan));var X=this._zoom!==A?this._tryAnimatedZoom&&this._tryAnimatedZoom(u,A,G.zoom):this._tryAnimatedPan(u,G.pan);if(X)return clearTimeout(this._sizeTimer),this}return this._resetView(u,A,G.pan&&G.pan.noMoveStart),this},setZoom:function(u,A){return this._loaded?this.setView(this.getCenter(),u,{zoom:A}):(this._zoom=u,this)},zoomIn:function(u,A){return u=u||(gt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+u,A)},zoomOut:function(u,A){return u=u||(gt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-u,A)},setZoomAround:function(u,A,G){var X=this.getZoomScale(A),T=this.getSize().divideBy(2),$=u instanceof U?u:this.latLngToContainerPoint(u),me=$.subtract(T).multiplyBy(1-1/X),we=this.containerPointToLatLng(T.add(me));return this.setView(we,A,{zoom:G})},_getBoundsCenterZoom:function(u,A){A=A||{},u=u.getBounds?u.getBounds():ue(u);var G=ne(A.paddingTopLeft||A.padding||[0,0]),X=ne(A.paddingBottomRight||A.padding||[0,0]),T=this.getBoundsZoom(u,!1,G.add(X));if(T=typeof A.maxZoom=="number"?Math.min(A.maxZoom,T):T,T===1/0)return{center:u.getCenter(),zoom:T};var $=X.subtract(G).divideBy(2),me=this.project(u.getSouthWest(),T),we=this.project(u.getNorthEast(),T),We=this.unproject(me.add(we).divideBy(2).add($),T);return{center:We,zoom:T}},fitBounds:function(u,A){if(u=ue(u),!u.isValid())throw new Error("Bounds are not valid.");var G=this._getBoundsCenterZoom(u,A);return this.setView(G.center,G.zoom,A)},fitWorld:function(u){return this.fitBounds([[-90,-180],[90,180]],u)},panTo:function(u,A){return this.setView(u,this._zoom,{pan:A})},panBy:function(u,A){if(u=ne(u).round(),A=A||{},!u.x&&!u.y)return this.fire("moveend");if(A.animate!==!0&&!this.getSize().contains(u))return this._resetView(this.unproject(this.project(this.getCenter()).add(u)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new so,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),A.noMoveStart||this.fire("movestart"),A.animate!==!1){Nt(this._mapPane,"leaflet-pan-anim");var G=this._getMapPanePos().subtract(u).round();this._panAnim.run(this._mapPane,G,A.duration||.25,A.easeLinearity)}else this._rawPanBy(u),this.fire("move").fire("moveend");return this},flyTo:function(u,A,G){if(G=G||{},G.animate===!1||!gt.any3d)return this.setView(u,A,G);this._stop();var X=this.project(this.getCenter()),T=this.project(u),$=this.getSize(),me=this._zoom;u=Ce(u),A=A===void 0?me:A;var we=Math.max($.x,$.y),We=we*this.getZoomScale(me,A),Ee=T.distanceTo(X)||1,tt=1.42,St=tt*tt;function Lt(xn){var pc=xn?-1:1,gA=xn?We:we,uA=We*We-we*we+pc*St*St*Ee*Ee,cl=2*gA*St*Ee,dl=uA/cl,gl=Math.sqrt(dl*dl+1)-dl,Yg=gl<1e-9?-18:Math.log(gl);return Yg}function ks(xn){return(Math.exp(xn)-Math.exp(-xn))/2}function bs(xn){return(Math.exp(xn)+Math.exp(-xn))/2}function Gr(xn){return ks(xn)/bs(xn)}var ar=Lt(0);function Cc(xn){return we*(bs(ar)/bs(ar+tt*xn))}function uh(xn){return we*(bs(ar)*Gr(ar+tt*xn)-ks(ar))/St}function fo(xn){return 1-Math.pow(1-xn,1.5)}var rI=Date.now(),ll=(Lt(1)-ar)/tt,Pi=G.duration?1e3*G.duration:1e3*ll*.8;function fc(){var xn=(Date.now()-rI)/Pi,pc=fo(xn)*ll;xn<=1?(this._flyToFrame=D(fc,this),this._move(this.unproject(X.add(T.subtract(X).multiplyBy(uh(pc)/Ee)),me),this.getScaleZoom(we/Cc(pc),me),{flyTo:!0})):this._move(u,A)._moveEnd(!0)}return this._moveStart(!0,G.noMoveStart),fc.call(this),this},flyToBounds:function(u,A){var G=this._getBoundsCenterZoom(u,A);return this.flyTo(G.center,G.zoom,A)},setMaxBounds:function(u){return u=ue(u),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),u.isValid()?(this.options.maxBounds=u,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(u){var A=this.options.minZoom;return this.options.minZoom=u,this._loaded&&A!==u&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(u):this},setMaxZoom:function(u){var A=this.options.maxZoom;return this.options.maxZoom=u,this._loaded&&A!==u&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(u):this},panInsideBounds:function(u,A){this._enforcingBounds=!0;var G=this.getCenter(),X=this._limitCenter(G,this._zoom,ue(u));return G.equals(X)||this.panTo(X,A),this._enforcingBounds=!1,this},panInside:function(u,A){A=A||{};var G=ne(A.paddingTopLeft||A.padding||[0,0]),X=ne(A.paddingBottomRight||A.padding||[0,0]),T=this.project(this.getCenter()),$=this.project(u),me=this.getPixelBounds(),we=re([me.min.add(G),me.max.subtract(X)]),We=we.getSize();if(!we.contains($)){this._enforcingBounds=!0;var Ee=$.subtract(we.getCenter()),tt=we.extend($).getSize().subtract(We);T.x+=Ee.x<0?-tt.x:tt.x,T.y+=Ee.y<0?-tt.y:tt.y,this.panTo(this.unproject(T),A),this._enforcingBounds=!1}return this},invalidateSize:function(u){if(!this._loaded)return this;u=i({animate:!1,pan:!0},u===!0?{animate:!0}:u);var A=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var G=this.getSize(),X=A.divideBy(2).round(),T=G.divideBy(2).round(),$=X.subtract(T);return!$.x&&!$.y?this:(u.animate&&u.pan?this.panBy($):(u.pan&&this._rawPanBy($),this.fire("move"),u.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:A,newSize:G}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(u){if(u=this._locateOptions=i({timeout:1e4,watch:!1},u),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var A=o(this._handleGeolocationResponse,this),G=o(this._handleGeolocationError,this);return u.watch?this._locationWatchId=navigator.geolocation.watchPosition(A,G,u):navigator.geolocation.getCurrentPosition(A,G,u),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(u){if(this._container._leaflet_id){var A=u.code,G=u.message||(A===1?"permission denied":A===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:A,message:"Geolocation error: "+G+"."})}},_handleGeolocationResponse:function(u){if(this._container._leaflet_id){var A=u.coords.latitude,G=u.coords.longitude,X=new ae(A,G),T=X.toBounds(u.coords.accuracy*2),$=this._locateOptions;if($.setView){var me=this.getBoundsZoom(T);this.setView(X,$.maxZoom?Math.min(me,$.maxZoom):me)}var we={latlng:X,bounds:T,timestamp:u.timestamp};for(var We in u.coords)typeof u.coords[We]=="number"&&(we[We]=u.coords[We]);this.fire("locationfound",we)}},addHandler:function(u,A){if(!A)return this;var G=this[u]=new A(this);return this._handlers.push(G),this.options[u]&&G.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Zn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var u;for(u in this._layers)this._layers[u].remove();for(u in this._panes)Zn(this._panes[u]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(u,A){var G="leaflet-pane"+(u?" leaflet-"+u.replace("Pane","")+"-pane":""),X=Wt("div",G,A||this._mapPane);return u&&(this._panes[u]=X),X},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var u=this.getPixelBounds(),A=this.unproject(u.getBottomLeft()),G=this.unproject(u.getTopRight());return new le(A,G)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(u,A,G){u=ue(u),G=ne(G||[0,0]);var X=this.getZoom()||0,T=this.getMinZoom(),$=this.getMaxZoom(),me=u.getNorthWest(),we=u.getSouthEast(),We=this.getSize().subtract(G),Ee=re(this.project(we,X),this.project(me,X)).getSize(),tt=gt.any3d?this.options.zoomSnap:1,St=We.x/Ee.x,Lt=We.y/Ee.y,ks=A?Math.max(St,Lt):Math.min(St,Lt);return X=this.getScaleZoom(ks,X),tt&&(X=Math.round(X/(tt/100))*(tt/100),X=A?Math.ceil(X/tt)*tt:Math.floor(X/tt)*tt),Math.max(T,Math.min($,X))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new U(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(u,A){var G=this._getTopLeftPoint(u,A);return new K(G,G.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(u){return this.options.crs.getProjectedBounds(u===void 0?this.getZoom():u)},getPane:function(u){return typeof u=="string"?this._panes[u]:u},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(u,A){var G=this.options.crs;return A=A===void 0?this._zoom:A,G.scale(u)/G.scale(A)},getScaleZoom:function(u,A){var G=this.options.crs;A=A===void 0?this._zoom:A;var X=G.zoom(u*G.scale(A));return isNaN(X)?1/0:X},project:function(u,A){return A=A===void 0?this._zoom:A,this.options.crs.latLngToPoint(Ce(u),A)},unproject:function(u,A){return A=A===void 0?this._zoom:A,this.options.crs.pointToLatLng(ne(u),A)},layerPointToLatLng:function(u){var A=ne(u).add(this.getPixelOrigin());return this.unproject(A)},latLngToLayerPoint:function(u){var A=this.project(Ce(u))._round();return A._subtract(this.getPixelOrigin())},wrapLatLng:function(u){return this.options.crs.wrapLatLng(Ce(u))},wrapLatLngBounds:function(u){return this.options.crs.wrapLatLngBounds(ue(u))},distance:function(u,A){return this.options.crs.distance(Ce(u),Ce(A))},containerPointToLayerPoint:function(u){return ne(u).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(u){return ne(u).add(this._getMapPanePos())},containerPointToLatLng:function(u){var A=this.containerPointToLayerPoint(ne(u));return this.layerPointToLatLng(A)},latLngToContainerPoint:function(u){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ce(u)))},mouseEventToContainerPoint:function(u){return xa(u,this._container)},mouseEventToLayerPoint:function(u){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(u))},mouseEventToLatLng:function(u){return this.layerPointToLatLng(this.mouseEventToLayerPoint(u))},_initContainer:function(u){var A=this._container=Es(u);if(A){if(A._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");wt(A,"scroll",this._onScroll,this),this._containerId=c(A)},_initLayout:function(){var u=this._container;this._fadeAnimated=this.options.fadeAnimation&&gt.any3d,Nt(u,"leaflet-container"+(gt.touch?" leaflet-touch":"")+(gt.retina?" leaflet-retina":"")+(gt.ielt9?" leaflet-oldie":"")+(gt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var A=pa(u,"position");A!=="absolute"&&A!=="relative"&&A!=="fixed"&&A!=="sticky"&&(u.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var u=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Fn(this._mapPane,new U(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Nt(u.markerPane,"leaflet-zoom-hide"),Nt(u.shadowPane,"leaflet-zoom-hide"))},_resetView:function(u,A,G){Fn(this._mapPane,new U(0,0));var X=!this._loaded;this._loaded=!0,A=this._limitZoom(A),this.fire("viewprereset");var T=this._zoom!==A;this._moveStart(T,G)._move(u,A)._moveEnd(T),this.fire("viewreset"),X&&this.fire("load")},_moveStart:function(u,A){return u&&this.fire("zoomstart"),A||this.fire("movestart"),this},_move:function(u,A,G,X){A===void 0&&(A=this._zoom);var T=this._zoom!==A;return this._zoom=A,this._lastCenter=u,this._pixelOrigin=this._getNewPixelOrigin(u),X?G&&G.pinch&&this.fire("zoom",G):((T||G&&G.pinch)&&this.fire("zoom",G),this.fire("move",G)),this},_moveEnd:function(u){return u&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(u){Fn(this._mapPane,this._getMapPanePos().subtract(u))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(u){this._targets={},this._targets[c(this._container)]=this;var A=u?hn:wt;A(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&A(window,"resize",this._onResize,this),gt.any3d&&this.options.transform3DLimit&&(u?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){z(this._resizeRequest),this._resizeRequest=D(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var u=this._getMapPanePos();Math.max(Math.abs(u.x),Math.abs(u.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(u,A){for(var G=[],X,T=A==="mouseout"||A==="mouseover",$=u.target||u.srcElement,me=!1;$;){if(X=this._targets[c($)],X&&(A==="click"||A==="preclick")&&this._draggableMoved(X)){me=!0;break}if(X&&X.listens(A,!0)&&(T&&!Sa($,u)||(G.push(X),T))||$===this._container)break;$=$.parentNode}return!G.length&&!me&&!T&&this.listens(A,!0)&&(G=[this]),G},_isClickDisabled:function(u){for(;u&&u!==this._container;){if(u._leaflet_disable_click)return!0;u=u.parentNode}},_handleDOMEvent:function(u){var A=u.target||u.srcElement;if(!(!this._loaded||A._leaflet_disable_events||u.type==="click"&&this._isClickDisabled(A))){var G=u.type;G==="mousedown"&&Yi(A),this._fireDOMEvent(u,G)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(u,A,G){if(u.type==="click"){var X=i({},u);X.type="preclick",this._fireDOMEvent(X,X.type,G)}var T=this._findEventTargets(u,A);if(G){for(var $=[],me=0;me<G.length;me++)G[me].listens(A,!0)&&$.push(G[me]);T=$.concat(T)}if(T.length){A==="contextmenu"&&Xn(u);var we=T[0],We={originalEvent:u};if(u.type!=="keypress"&&u.type!=="keydown"&&u.type!=="keyup"){var Ee=we.getLatLng&&(!we._radius||we._radius<=10);We.containerPoint=Ee?this.latLngToContainerPoint(we.getLatLng()):this.mouseEventToContainerPoint(u),We.layerPoint=this.containerPointToLayerPoint(We.containerPoint),We.latlng=Ee?we.getLatLng():this.layerPointToLatLng(We.layerPoint)}for(me=0;me<T.length;me++)if(T[me].fire(A,We,!0),We.originalEvent._stopped||T[me].options.bubblingMouseEvents===!1&&R(this._mouseEvents,A)!==-1)return}},_draggableMoved:function(u){return u=u.dragging&&u.dragging.enabled()?u:this,u.dragging&&u.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var u=0,A=this._handlers.length;u<A;u++)this._handlers[u].disable()},whenReady:function(u,A){return this._loaded?u.call(A||this,{target:this}):this.on("load",u,A),this},_getMapPanePos:function(){return vr(this._mapPane)||new U(0,0)},_moved:function(){var u=this._getMapPanePos();return u&&!u.equals([0,0])},_getTopLeftPoint:function(u,A){var G=u&&A!==void 0?this._getNewPixelOrigin(u,A):this.getPixelOrigin();return G.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(u,A){var G=this.getSize()._divideBy(2);return this.project(u,A)._subtract(G)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(u,A,G){var X=this._getNewPixelOrigin(G,A);return this.project(u,A)._subtract(X)},_latLngBoundsToNewLayerBounds:function(u,A,G){var X=this._getNewPixelOrigin(G,A);return re([this.project(u.getSouthWest(),A)._subtract(X),this.project(u.getNorthWest(),A)._subtract(X),this.project(u.getSouthEast(),A)._subtract(X),this.project(u.getNorthEast(),A)._subtract(X)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(u){return this.latLngToLayerPoint(u).subtract(this._getCenterLayerPoint())},_limitCenter:function(u,A,G){if(!G)return u;var X=this.project(u,A),T=this.getSize().divideBy(2),$=new K(X.subtract(T),X.add(T)),me=this._getBoundsOffset($,G,A);return Math.abs(me.x)<=1&&Math.abs(me.y)<=1?u:this.unproject(X.add(me),A)},_limitOffset:function(u,A){if(!A)return u;var G=this.getPixelBounds(),X=new K(G.min.add(u),G.max.add(u));return u.add(this._getBoundsOffset(X,A))},_getBoundsOffset:function(u,A,G){var X=re(this.project(A.getNorthEast(),G),this.project(A.getSouthWest(),G)),T=X.min.subtract(u.min),$=X.max.subtract(u.max),me=this._rebound(T.x,-$.x),we=this._rebound(T.y,-$.y);return new U(me,we)},_rebound:function(u,A){return u+A>0?Math.round(u-A)/2:Math.max(0,Math.ceil(u))-Math.max(0,Math.floor(A))},_limitZoom:function(u){var A=this.getMinZoom(),G=this.getMaxZoom(),X=gt.any3d?this.options.zoomSnap:1;return X&&(u=Math.round(u/X)*X),Math.max(A,Math.min(G,u))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){vn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(u,A){var G=this._getCenterOffset(u)._trunc();return(A&&A.animate)!==!0&&!this.getSize().contains(G)?!1:(this.panBy(G,A),!0)},_createAnimProxy:function(){var u=this._proxy=Wt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(u),this.on("zoomanim",function(A){var G=Eo,X=this._proxy.style[G];Ds(this._proxy,this.project(A.center,A.zoom),this.getZoomScale(A.zoom,1)),X===this._proxy.style[G]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Zn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var u=this.getCenter(),A=this.getZoom();Ds(this._proxy,this.project(u,A),this.getZoomScale(A,1))},_catchTransitionEnd:function(u){this._animatingZoom&&u.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(u,A,G){if(this._animatingZoom)return!0;if(G=G||{},!this._zoomAnimated||G.animate===!1||this._nothingToAnimate()||Math.abs(A-this._zoom)>this.options.zoomAnimationThreshold)return!1;var X=this.getZoomScale(A),T=this._getCenterOffset(u)._divideBy(1-1/X);return G.animate!==!0&&!this.getSize().contains(T)?!1:(D(function(){this._moveStart(!0,G.noMoveStart||!1)._animateZoom(u,A,!0)},this),!0)},_animateZoom:function(u,A,G,X){this._mapPane&&(G&&(this._animatingZoom=!0,this._animateToCenter=u,this._animateToZoom=A,Nt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:u,zoom:A,noUpdate:X}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&vn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Fr(u,A){return new Pt(u,A)}var Bs=E.extend({options:{position:"topright"},initialize:function(u){x(this,u)},getPosition:function(){return this.options.position},setPosition:function(u){var A=this._map;return A&&A.removeControl(this),this.options.position=u,A&&A.addControl(this),this},getContainer:function(){return this._container},addTo:function(u){this.remove(),this._map=u;var A=this._container=this.onAdd(u),G=this.getPosition(),X=u._controlCorners[G];return Nt(A,"leaflet-control"),G.indexOf("bottom")!==-1?X.insertBefore(A,X.firstChild):X.appendChild(A),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Zn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(u){this._map&&u&&u.screenX>0&&u.screenY>0&&this._map.getContainer().focus()}}),Mr=function(u){return new Bs(u)};Pt.include({addControl:function(u){return u.addTo(this),this},removeControl:function(u){return u.remove(),this},_initControlPos:function(){var u=this._controlCorners={},A="leaflet-",G=this._controlContainer=Wt("div",A+"control-container",this._container);function X(T,$){var me=A+T+" "+A+$;u[T+$]=Wt("div",me,G)}X("top","left"),X("top","right"),X("bottom","left"),X("bottom","right")},_clearControlPos:function(){for(var u in this._controlCorners)Zn(this._controlCorners[u]);Zn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ko=Bs.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(u,A,G,X){return G<X?-1:X<G?1:0}},initialize:function(u,A,G){x(this,G),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var X in u)this._addLayer(u[X],X);for(X in A)this._addLayer(A[X],X,!0)},onAdd:function(u){this._initLayout(),this._update(),this._map=u,u.on("zoomend",this._checkDisabledLayers,this);for(var A=0;A<this._layers.length;A++)this._layers[A].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(u){return Bs.prototype.addTo.call(this,u),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var u=0;u<this._layers.length;u++)this._layers[u].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(u,A){return this._addLayer(u,A),this._map?this._update():this},addOverlay:function(u,A){return this._addLayer(u,A,!0),this._map?this._update():this},removeLayer:function(u){u.off("add remove",this._onLayerChange,this);var A=this._getLayer(c(u));return A&&this._layers.splice(this._layers.indexOf(A),1),this._map?this._update():this},expand:function(){Nt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var u=this._map.getSize().y-(this._container.offsetTop+50);return u<this._section.clientHeight?(Nt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=u+"px"):vn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return vn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var u="leaflet-control-layers",A=this._container=Wt("div",u),G=this.options.collapsed;A.setAttribute("aria-haspopup",!0),va(A),to(A);var X=this._section=Wt("section",u+"-list");G&&(this._map.on("click",this.collapse,this),wt(A,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var T=this._layersLink=Wt("a",u+"-toggle",A);T.href="#",T.title="Layers",T.setAttribute("role","button"),wt(T,{keydown:function($){$.keyCode===13&&this._expandSafely()},click:function($){Xn($),this._expandSafely()}},this),G||this.expand(),this._baseLayersList=Wt("div",u+"-base",X),this._separator=Wt("div",u+"-separator",X),this._overlaysList=Wt("div",u+"-overlays",X),A.appendChild(X)},_getLayer:function(u){for(var A=0;A<this._layers.length;A++)if(this._layers[A]&&c(this._layers[A].layer)===u)return this._layers[A]},_addLayer:function(u,A,G){this._map&&u.on("add remove",this._onLayerChange,this),this._layers.push({layer:u,name:A,overlay:G}),this.options.sortLayers&&this._layers.sort(o(function(X,T){return this.options.sortFunction(X.layer,T.layer,X.name,T.name)},this)),this.options.autoZIndex&&u.setZIndex&&(this._lastZIndex++,u.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;za(this._baseLayersList),za(this._overlaysList),this._layerControlInputs=[];var u,A,G,X,T=0;for(G=0;G<this._layers.length;G++)X=this._layers[G],this._addItem(X),A=A||X.overlay,u=u||!X.overlay,T+=X.overlay?0:1;return this.options.hideSingleBase&&(u=u&&T>1,this._baseLayersList.style.display=u?"":"none"),this._separator.style.display=A&&u?"":"none",this},_onLayerChange:function(u){this._handlingClick||this._update();var A=this._getLayer(c(u.target)),G=A.overlay?u.type==="add"?"overlayadd":"overlayremove":u.type==="add"?"baselayerchange":null;G&&this._map.fire(G,A)},_createRadioElement:function(u,A){var G='<input type="radio" class="leaflet-control-layers-selector" name="'+u+'"'+(A?' checked="checked"':"")+"/>",X=document.createElement("div");return X.innerHTML=G,X.firstChild},_addItem:function(u){var A=document.createElement("label"),G=this._map.hasLayer(u.layer),X;u.overlay?(X=document.createElement("input"),X.type="checkbox",X.className="leaflet-control-layers-selector",X.defaultChecked=G):X=this._createRadioElement("leaflet-base-layers_"+c(this),G),this._layerControlInputs.push(X),X.layerId=c(u.layer),wt(X,"click",this._onInputClick,this);var T=document.createElement("span");T.innerHTML=" "+u.name;var $=document.createElement("span");A.appendChild($),$.appendChild(X),$.appendChild(T);var me=u.overlay?this._overlaysList:this._baseLayersList;return me.appendChild(A),this._checkDisabledLayers(),A},_onInputClick:function(){if(!this._preventClick){var u=this._layerControlInputs,A,G,X=[],T=[];this._handlingClick=!0;for(var $=u.length-1;$>=0;$--)A=u[$],G=this._getLayer(A.layerId).layer,A.checked?X.push(G):A.checked||T.push(G);for($=0;$<T.length;$++)this._map.hasLayer(T[$])&&this._map.removeLayer(T[$]);for($=0;$<X.length;$++)this._map.hasLayer(X[$])||this._map.addLayer(X[$]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var u=this._layerControlInputs,A,G,X=this._map.getZoom(),T=u.length-1;T>=0;T--)A=u[T],G=this._getLayer(A.layerId).layer,A.disabled=G.options.minZoom!==void 0&&X<G.options.minZoom||G.options.maxZoom!==void 0&&X>G.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var u=this._section;this._preventClick=!0,wt(u,"click",Xn),this.expand();var A=this;setTimeout(function(){hn(u,"click",Xn),A._preventClick=!1})}}),ro=function(u,A,G){return new Ko(u,A,G)},Fi=Bs.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(u){var A="leaflet-control-zoom",G=Wt("div",A+" leaflet-bar"),X=this.options;return this._zoomInButton=this._createButton(X.zoomInText,X.zoomInTitle,A+"-in",G,this._zoomIn),this._zoomOutButton=this._createButton(X.zoomOutText,X.zoomOutTitle,A+"-out",G,this._zoomOut),this._updateDisabled(),u.on("zoomend zoomlevelschange",this._updateDisabled,this),G},onRemove:function(u){u.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(u){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(u.shiftKey?3:1))},_zoomOut:function(u){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(u.shiftKey?3:1))},_createButton:function(u,A,G,X,T){var $=Wt("a",G,X);return $.innerHTML=u,$.href="#",$.title=A,$.setAttribute("role","button"),$.setAttribute("aria-label",A),va($),wt($,"click",Ps),wt($,"click",T,this),wt($,"click",this._refocusOnMap,this),$},_updateDisabled:function(){var u=this._map,A="leaflet-disabled";vn(this._zoomInButton,A),vn(this._zoomOutButton,A),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||u._zoom===u.getMinZoom())&&(Nt(this._zoomOutButton,A),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||u._zoom===u.getMaxZoom())&&(Nt(this._zoomInButton,A),this._zoomInButton.setAttribute("aria-disabled","true"))}});Pt.mergeOptions({zoomControl:!0}),Pt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Fi,this.addControl(this.zoomControl))});var Ul=function(u){return new Fi(u)},As=Bs.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(u){var A="leaflet-control-scale",G=Wt("div",A),X=this.options;return this._addScales(X,A+"-line",G),u.on(X.updateWhenIdle?"moveend":"move",this._update,this),u.whenReady(this._update,this),G},onRemove:function(u){u.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(u,A,G){u.metric&&(this._mScale=Wt("div",A,G)),u.imperial&&(this._iScale=Wt("div",A,G))},_update:function(){var u=this._map,A=u.getSize().y/2,G=u.distance(u.containerPointToLatLng([0,A]),u.containerPointToLatLng([this.options.maxWidth,A]));this._updateScales(G)},_updateScales:function(u){this.options.metric&&u&&this._updateMetric(u),this.options.imperial&&u&&this._updateImperial(u)},_updateMetric:function(u){var A=this._getRoundNum(u),G=A<1e3?A+" m":A/1e3+" km";this._updateScale(this._mScale,G,A/u)},_updateImperial:function(u){var A=u*3.2808399,G,X,T;A>5280?(G=A/5280,X=this._getRoundNum(G),this._updateScale(this._iScale,X+" mi",X/G)):(T=this._getRoundNum(A),this._updateScale(this._iScale,T+" ft",T/A))},_updateScale:function(u,A,G){u.style.width=Math.round(this.options.maxWidth*G)+"px",u.innerHTML=A},_getRoundNum:function(u){var A=Math.pow(10,(Math.floor(u)+"").length-1),G=u/A;return G=G>=10?10:G>=5?5:G>=3?3:G>=2?2:1,A*G}}),Mi=function(u){return new As(u)},Oo='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',di=Bs.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(gt.inlineSvg?Oo+" ":"")+"Leaflet</a>"},initialize:function(u){x(this,u),this._attributions={}},onAdd:function(u){u.attributionControl=this,this._container=Wt("div","leaflet-control-attribution"),va(this._container);for(var A in u._layers)u._layers[A].getAttribution&&this.addAttribution(u._layers[A].getAttribution());return this._update(),u.on("layeradd",this._addAttribution,this),this._container},onRemove:function(u){u.off("layeradd",this._addAttribution,this)},_addAttribution:function(u){u.layer.getAttribution&&(this.addAttribution(u.layer.getAttribution()),u.layer.once("remove",function(){this.removeAttribution(u.layer.getAttribution())},this))},setPrefix:function(u){return this.options.prefix=u,this._update(),this},addAttribution:function(u){return u?(this._attributions[u]||(this._attributions[u]=0),this._attributions[u]++,this._update(),this):this},removeAttribution:function(u){return u?(this._attributions[u]&&(this._attributions[u]--,this._update()),this):this},_update:function(){if(this._map){var u=[];for(var A in this._attributions)this._attributions[A]&&u.push(A);var G=[];this.options.prefix&&G.push(this.options.prefix),u.length&&G.push(u.join(", ")),this._container.innerHTML=G.join(' <span aria-hidden="true">|</span> ')}}});Pt.mergeOptions({attributionControl:!0}),Pt.addInitHook(function(){this.options.attributionControl&&new di().addTo(this)});var wd=function(u){return new di(u)};Bs.Layers=Ko,Bs.Zoom=Fi,Bs.Scale=As,Bs.Attribution=di,Mr.layers=ro,Mr.zoom=Ul,Mr.scale=Mi,Mr.attribution=wd;var Js=E.extend({initialize:function(u){this._map=u},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Js.addTo=function(u,A){return u.addHandler(A,this),this};var zo={Events:q},Hi=gt.touch?"touchstart mousedown":"mousedown",Ks=de.extend({options:{clickTolerance:3},initialize:function(u,A,G,X){x(this,X),this._element=u,this._dragStartTarget=A||u,this._preventOutline=G},enable:function(){this._enabled||(wt(this._dragStartTarget,Hi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ks._dragging===this&&this.finishDrag(!0),hn(this._dragStartTarget,Hi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(u){if(this._enabled&&(this._moved=!1,!ji(this._element,"leaflet-zoom-anim"))){if(u.touches&&u.touches.length!==1){Ks._dragging===this&&this.finishDrag();return}if(!(Ks._dragging||u.shiftKey||u.which!==1&&u.button!==1&&!u.touches)&&(Ks._dragging=this,this._preventOutline&&Yi(this._element),qa(),zt(),!this._moving)){this.fire("down");var A=u.touches?u.touches[0]:u,G=xr(this._element);this._startPoint=new U(A.clientX,A.clientY),this._startPos=vr(this._element),this._parentScale=sr(G);var X=u.type==="mousedown";wt(document,X?"mousemove":"touchmove",this._onMove,this),wt(document,X?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(u){if(this._enabled){if(u.touches&&u.touches.length>1){this._moved=!0;return}var A=u.touches&&u.touches.length===1?u.touches[0]:u,G=new U(A.clientX,A.clientY)._subtract(this._startPoint);!G.x&&!G.y||Math.abs(G.x)+Math.abs(G.y)<this.options.clickTolerance||(G.x/=this._parentScale.x,G.y/=this._parentScale.y,Xn(u),this._moved||(this.fire("dragstart"),this._moved=!0,Nt(document.body,"leaflet-dragging"),this._lastTarget=u.target||u.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Nt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(G),this._moving=!0,this._lastEvent=u,this._updatePosition())}},_updatePosition:function(){var u={originalEvent:this._lastEvent};this.fire("predrag",u),Fn(this._element,this._newPos),this.fire("drag",u)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(u){vn(document.body,"leaflet-dragging"),this._lastTarget&&(vn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),hn(document,"mousemove touchmove",this._onMove,this),hn(document,"mouseup touchend touchcancel",this._onUp,this),$a(),Ji();var A=this._moved&&this._moving;this._moving=!1,Ks._dragging=!1,A&&this.fire("dragend",{noInertia:u,distance:this._newPos.distanceTo(this._startPos)})}});function Uo(u,A,G){var X,T=[1,4,2,8],$,me,we,We,Ee,tt,St,Lt;for($=0,tt=u.length;$<tt;$++)u[$]._code=gi(u[$],A);for(we=0;we<4;we++){for(St=T[we],X=[],$=0,tt=u.length,me=tt-1;$<tt;me=$++)We=u[$],Ee=u[me],We._code&St?Ee._code&St||(Lt=ao(Ee,We,St,A,G),Lt._code=gi(Lt,A),X.push(Lt)):(Ee._code&St&&(Lt=ao(Ee,We,St,A,G),Lt._code=gi(Lt,A),X.push(Lt)),X.push(We));u=X}return u}function Ql(u,A){var G,X,T,$,me,we,We,Ee,tt;if(!u||u.length===0)throw new Error("latlngs not passed");Ys(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var St=Ce([0,0]),Lt=ue(u),ks=Lt.getNorthWest().distanceTo(Lt.getSouthWest())*Lt.getNorthEast().distanceTo(Lt.getNorthWest());ks<1700&&(St=Qo(u));var bs=u.length,Gr=[];for(G=0;G<bs;G++){var ar=Ce(u[G]);Gr.push(A.project(Ce([ar.lat-St.lat,ar.lng-St.lng])))}for(we=We=Ee=0,G=0,X=bs-1;G<bs;X=G++)T=Gr[G],$=Gr[X],me=T.y*$.x-$.y*T.x,We+=(T.x+$.x)*me,Ee+=(T.y+$.y)*me,we+=me*3;we===0?tt=Gr[0]:tt=[We/we,Ee/we];var Cc=A.unproject(ne(tt));return Ce([Cc.lat+St.lat,Cc.lng+St.lng])}function Qo(u){for(var A=0,G=0,X=0,T=0;T<u.length;T++){var $=Ce(u[T]);A+=$.lat,G+=$.lng,X++}return Ce([A/X,G/X])}var Zd={__proto__:null,clipPolygon:Uo,polygonCenter:Ql,centroid:Qo};function io(u,A){if(!A||!u.length)return u.slice();var G=A*A;return u=Nd(u,G),u=Bd(u,G),u}function ql(u,A,G){return Math.sqrt(ui(u,A,G,!0))}function Gd(u,A,G){return ui(u,A,G)}function Bd(u,A){var G=u.length,X=typeof Uint8Array<"u"?Uint8Array:Array,T=new X(G);T[0]=T[G-1]=1,qo(u,T,A,0,G-1);var $,me=[];for($=0;$<G;$++)T[$]&&me.push(u[$]);return me}function qo(u,A,G,X,T){var $=0,me,we,We;for(we=X+1;we<=T-1;we++)We=ui(u[we],u[X],u[T],!0),We>$&&(me=we,$=We);$>G&&(A[me]=1,qo(u,A,G,X,me),qo(u,A,G,me,T))}function Nd(u,A){for(var G=[u[0]],X=1,T=0,$=u.length;X<$;X++)kd(u[X],u[T])>A&&(G.push(u[X]),T=X);return T<$-1&&G.push(u[$-1]),G}var $o;function $l(u,A,G,X,T){var $=X?$o:gi(u,G),me=gi(A,G),we,We,Ee;for($o=me;;){if(!($|me))return[u,A];if($&me)return!1;we=$||me,We=ao(u,A,we,G,T),Ee=gi(We,G),we===$?(u=We,$=Ee):(A=We,me=Ee)}}function ao(u,A,G,X,T){var $=A.x-u.x,me=A.y-u.y,we=X.min,We=X.max,Ee,tt;return G&8?(Ee=u.x+$*(We.y-u.y)/me,tt=We.y):G&4?(Ee=u.x+$*(we.y-u.y)/me,tt=we.y):G&2?(Ee=We.x,tt=u.y+me*(We.x-u.x)/$):G&1&&(Ee=we.x,tt=u.y+me*(we.x-u.x)/$),new U(Ee,tt,T)}function gi(u,A){var G=0;return u.x<A.min.x?G|=1:u.x>A.max.x&&(G|=2),u.y<A.min.y?G|=4:u.y>A.max.y&&(G|=8),G}function kd(u,A){var G=A.x-u.x,X=A.y-u.y;return G*G+X*X}function ui(u,A,G,X){var T=A.x,$=A.y,me=G.x-T,we=G.y-$,We=me*me+we*we,Ee;return We>0&&(Ee=((u.x-T)*me+(u.y-$)*we)/We,Ee>1?(T=G.x,$=G.y):Ee>0&&(T+=me*Ee,$+=we*Ee)),me=u.x-T,we=u.y-$,X?me*me+we*we:new U(T,$)}function Ys(u){return!V(u[0])||typeof u[0][0]!="object"&&typeof u[0][0]<"u"}function ec(u){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ys(u)}function tc(u,A){var G,X,T,$,me,we,We,Ee;if(!u||u.length===0)throw new Error("latlngs not passed");Ys(u)||(console.warn("latlngs are not flat! Only the first ring will be used"),u=u[0]);var tt=Ce([0,0]),St=ue(u),Lt=St.getNorthWest().distanceTo(St.getSouthWest())*St.getNorthEast().distanceTo(St.getNorthWest());Lt<1700&&(tt=Qo(u));var ks=u.length,bs=[];for(G=0;G<ks;G++){var Gr=Ce(u[G]);bs.push(A.project(Ce([Gr.lat-tt.lat,Gr.lng-tt.lng])))}for(G=0,X=0;G<ks-1;G++)X+=bs[G].distanceTo(bs[G+1])/2;if(X===0)Ee=bs[0];else for(G=0,$=0;G<ks-1;G++)if(me=bs[G],we=bs[G+1],T=me.distanceTo(we),$+=T,$>X){We=($-X)/T,Ee=[we.x-We*(we.x-me.x),we.y-We*(we.y-me.y)];break}var ar=A.unproject(ne(Ee));return Ce([ar.lat+tt.lat,ar.lng+tt.lng])}var nc={__proto__:null,simplify:io,pointToSegmentDistance:ql,closestPointOnSegment:Gd,clipSegment:$l,_getEdgeIntersection:ao,_getBitCode:gi,_sqClosestPointOnSegment:ui,isFlat:Ys,_flat:ec,polylineCenter:tc},el={project:function(u){return new U(u.lng,u.lat)},unproject:function(u){return new ae(u.y,u.x)},bounds:new K([-180,-90],[180,90])},tl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new K([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(u){var A=Math.PI/180,G=this.R,X=u.lat*A,T=this.R_MINOR/G,$=Math.sqrt(1-T*T),me=$*Math.sin(X),we=Math.tan(Math.PI/4-X/2)/Math.pow((1-me)/(1+me),$/2);return X=-G*Math.log(Math.max(we,1e-10)),new U(u.lng*A*G,X)},unproject:function(u){for(var A=180/Math.PI,G=this.R,X=this.R_MINOR/G,T=Math.sqrt(1-X*X),$=Math.exp(-u.y/G),me=Math.PI/2-2*Math.atan($),we=0,We=.1,Ee;we<15&&Math.abs(We)>1e-7;we++)Ee=T*Math.sin(me),Ee=Math.pow((1-Ee)/(1+Ee),T/2),We=Math.PI/2-2*Math.atan($*Ee)-me,me+=We;return new ae(me*A,u.x*A/G)}},Rd={__proto__:null,LonLat:el,Mercator:tl,SphericalMercator:_e},Wd=i({},ge,{code:"EPSG:3395",projection:tl,transformation:(function(){var u=.5/(Math.PI*tl.R);return Se(u,.5,-u,.5)})()}),sc=i({},ge,{code:"EPSG:4326",projection:el,transformation:Se(1/180,1,-1/180,.5)}),Vd=i({},ie,{projection:el,transformation:Se(1,0,-1,0),scale:function(u){return Math.pow(2,u)},zoom:function(u){return Math.log(u)/Math.LN2},distance:function(u,A){var G=A.lng-u.lng,X=A.lat-u.lat;return Math.sqrt(G*G+X*X)},infinite:!0});ie.Earth=ge,ie.EPSG3395=Wd,ie.EPSG3857=Re,ie.EPSG900913=Ye,ie.EPSG4326=sc,ie.Simple=Vd;var Os=de.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(u){return u.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(u){return u&&u.removeLayer(this),this},getPane:function(u){return this._map.getPane(u?this.options[u]||u:this.options.pane)},addInteractiveTarget:function(u){return this._map._targets[c(u)]=this,this},removeInteractiveTarget:function(u){return delete this._map._targets[c(u)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(u){var A=u.target;if(A.hasLayer(this)){if(this._map=A,this._zoomAnimated=A._zoomAnimated,this.getEvents){var G=this.getEvents();A.on(G,this),this.once("remove",function(){A.off(G,this)},this)}this.onAdd(A),this.fire("add"),A.fire("layeradd",{layer:this})}}});Pt.include({addLayer:function(u){if(!u._layerAdd)throw new Error("The provided object is not a Layer.");var A=c(u);return this._layers[A]?this:(this._layers[A]=u,u._mapToAdd=this,u.beforeAdd&&u.beforeAdd(this),this.whenReady(u._layerAdd,u),this)},removeLayer:function(u){var A=c(u);return this._layers[A]?(this._loaded&&u.onRemove(this),delete this._layers[A],this._loaded&&(this.fire("layerremove",{layer:u}),u.fire("remove")),u._map=u._mapToAdd=null,this):this},hasLayer:function(u){return c(u)in this._layers},eachLayer:function(u,A){for(var G in this._layers)u.call(A,this._layers[G]);return this},_addLayers:function(u){u=u?V(u)?u:[u]:[];for(var A=0,G=u.length;A<G;A++)this.addLayer(u[A])},_addZoomLimit:function(u){(!isNaN(u.options.maxZoom)||!isNaN(u.options.minZoom))&&(this._zoomBoundLayers[c(u)]=u,this._updateZoomLevels())},_removeZoomLimit:function(u){var A=c(u);this._zoomBoundLayers[A]&&(delete this._zoomBoundLayers[A],this._updateZoomLevels())},_updateZoomLevels:function(){var u=1/0,A=-1/0,G=this._getZoomSpan();for(var X in this._zoomBoundLayers){var T=this._zoomBoundLayers[X].options;u=T.minZoom===void 0?u:Math.min(u,T.minZoom),A=T.maxZoom===void 0?A:Math.max(A,T.maxZoom)}this._layersMaxZoom=A===-1/0?void 0:A,this._layersMinZoom=u===1/0?void 0:u,G!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Hr=Os.extend({initialize:function(u,A){x(this,A),this._layers={};var G,X;if(u)for(G=0,X=u.length;G<X;G++)this.addLayer(u[G])},addLayer:function(u){var A=this.getLayerId(u);return this._layers[A]=u,this._map&&this._map.addLayer(u),this},removeLayer:function(u){var A=u in this._layers?u:this.getLayerId(u);return this._map&&this._layers[A]&&this._map.removeLayer(this._layers[A]),delete this._layers[A],this},hasLayer:function(u){var A=typeof u=="number"?u:this.getLayerId(u);return A in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(u){var A=Array.prototype.slice.call(arguments,1),G,X;for(G in this._layers)X=this._layers[G],X[u]&&X[u].apply(X,A);return this},onAdd:function(u){this.eachLayer(u.addLayer,u)},onRemove:function(u){this.eachLayer(u.removeLayer,u)},eachLayer:function(u,A){for(var G in this._layers)u.call(A,this._layers[G]);return this},getLayer:function(u){return this._layers[u]},getLayers:function(){var u=[];return this.eachLayer(u.push,u),u},setZIndex:function(u){return this.invoke("setZIndex",u)},getLayerId:function(u){return c(u)}}),wa=function(u,A){return new Hr(u,A)},Sr=Hr.extend({addLayer:function(u){return this.hasLayer(u)?this:(u.addEventParent(this),Hr.prototype.addLayer.call(this,u),this.fire("layeradd",{layer:u}))},removeLayer:function(u){return this.hasLayer(u)?(u in this._layers&&(u=this._layers[u]),u.removeEventParent(this),Hr.prototype.removeLayer.call(this,u),this.fire("layerremove",{layer:u})):this},setStyle:function(u){return this.invoke("setStyle",u)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var u=new le;for(var A in this._layers){var G=this._layers[A];u.extend(G.getBounds?G.getBounds():G.getLatLng())}return u}}),rc=function(u,A){return new Sr(u,A)},hi=E.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(u){x(this,u)},createIcon:function(u){return this._createIcon("icon",u)},createShadow:function(u){return this._createIcon("shadow",u)},_createIcon:function(u,A){var G=this._getIconUrl(u);if(!G){if(u==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var X=this._createImg(G,A&&A.tagName==="IMG"?A:null);return this._setIconStyles(X,u),(this.options.crossOrigin||this.options.crossOrigin==="")&&(X.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),X},_setIconStyles:function(u,A){var G=this.options,X=G[A+"Size"];typeof X=="number"&&(X=[X,X]);var T=ne(X),$=ne(A==="shadow"&&G.shadowAnchor||G.iconAnchor||T&&T.divideBy(2,!0));u.className="leaflet-marker-"+A+" "+(G.className||""),$&&(u.style.marginLeft=-$.x+"px",u.style.marginTop=-$.y+"px"),T&&(u.style.width=T.x+"px",u.style.height=T.y+"px")},_createImg:function(u,A){return A=A||document.createElement("img"),A.src=u,A},_getIconUrl:function(u){return gt.retina&&this.options[u+"RetinaUrl"]||this.options[u+"Url"]}});function ic(u){return new hi(u)}var Ti=hi.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(u){return typeof Ti.imagePath!="string"&&(Ti.imagePath=this._detectIconPath()),(this.options.imagePath||Ti.imagePath)+hi.prototype._getIconUrl.call(this,u)},_stripUrl:function(u){var A=function(G,X,T){var $=X.exec(G);return $&&$[T]};return u=A(u,/^url\((['"])?(.+)\1\)$/,2),u&&A(u,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var u=Wt("div","leaflet-default-icon-path",document.body),A=pa(u,"background-image")||pa(u,"backgroundImage");if(document.body.removeChild(u),A=this._stripUrl(A),A)return A;var G=document.querySelector('link[href$="leaflet.css"]');return G?G.href.substring(0,G.href.length-11-1):""}}),nl=Js.extend({initialize:function(u){this._marker=u},addHooks:function(){var u=this._marker._icon;this._draggable||(this._draggable=new Ks(u,u,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Nt(u,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&vn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(u){var A=this._marker,G=A._map,X=this._marker.options.autoPanSpeed,T=this._marker.options.autoPanPadding,$=vr(A._icon),me=G.getPixelBounds(),we=G.getPixelOrigin(),We=re(me.min._subtract(we).add(T),me.max._subtract(we).subtract(T));if(!We.contains($)){var Ee=ne((Math.max(We.max.x,$.x)-We.max.x)/(me.max.x-We.max.x)-(Math.min(We.min.x,$.x)-We.min.x)/(me.min.x-We.min.x),(Math.max(We.max.y,$.y)-We.max.y)/(me.max.y-We.max.y)-(Math.min(We.min.y,$.y)-We.min.y)/(me.min.y-We.min.y)).multiplyBy(X);G.panBy(Ee,{animate:!1}),this._draggable._newPos._add(Ee),this._draggable._startPos._add(Ee),Fn(A._icon,this._draggable._newPos),this._onDrag(u),this._panRequest=D(this._adjustPan.bind(this,u))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(u){this._marker.options.autoPan&&(z(this._panRequest),this._panRequest=D(this._adjustPan.bind(this,u)))},_onDrag:function(u){var A=this._marker,G=A._shadow,X=vr(A._icon),T=A._map.layerPointToLatLng(X);G&&Fn(G,X),A._latlng=T,u.latlng=T,u.oldLatLng=this._oldLatLng,A.fire("move",u).fire("drag",u)},_onDragEnd:function(u){z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",u)}}),wr=Os.extend({options:{icon:new Ti,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(u,A){x(this,A),this._latlng=Ce(u)},onAdd:function(u){this._zoomAnimated=this._zoomAnimated&&u.options.markerZoomAnimation,this._zoomAnimated&&u.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(u){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&u.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(u){var A=this._latlng;return this._latlng=Ce(u),this.update(),this.fire("move",{oldLatLng:A,latlng:this._latlng})},setZIndexOffset:function(u){return this.options.zIndexOffset=u,this.update()},getIcon:function(){return this.options.icon},setIcon:function(u){return this.options.icon=u,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var u=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(u)}return this},_initIcon:function(){var u=this.options,A="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),G=u.icon.createIcon(this._icon),X=!1;G!==this._icon&&(this._icon&&this._removeIcon(),X=!0,u.title&&(G.title=u.title),G.tagName==="IMG"&&(G.alt=u.alt||"")),Nt(G,A),u.keyboard&&(G.tabIndex="0",G.setAttribute("role","button")),this._icon=G,u.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&wt(G,"focus",this._panOnFocus,this);var T=u.icon.createShadow(this._shadow),$=!1;T!==this._shadow&&(this._removeShadow(),$=!0),T&&(Nt(T,A),T.alt=""),this._shadow=T,u.opacity<1&&this._updateOpacity(),X&&this.getPane().appendChild(this._icon),this._initInteraction(),T&&$&&this.getPane(u.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&hn(this._icon,"focus",this._panOnFocus,this),Zn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Zn(this._shadow),this._shadow=null},_setPos:function(u){this._icon&&Fn(this._icon,u),this._shadow&&Fn(this._shadow,u),this._zIndex=u.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(u){this._icon&&(this._icon.style.zIndex=this._zIndex+u)},_animateZoom:function(u){var A=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center).round();this._setPos(A)},_initInteraction:function(){if(this.options.interactive&&(Nt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),nl)){var u=this.options.draggable;this.dragging&&(u=this.dragging.enabled(),this.dragging.disable()),this.dragging=new nl(this),u&&this.dragging.enable()}},setOpacity:function(u){return this.options.opacity=u,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var u=this.options.opacity;this._icon&&ps(this._icon,u),this._shadow&&ps(this._shadow,u)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var u=this._map;if(u){var A=this.options.icon.options,G=A.iconSize?ne(A.iconSize):ne(0,0),X=A.iconAnchor?ne(A.iconAnchor):ne(0,0);u.panInside(this._latlng,{paddingTopLeft:X,paddingBottomRight:G.subtract(X)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function _d(u,A){return new wr(u,A)}var Tr=Os.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(u){this._renderer=u.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(u){return x(this,u),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&u&&Object.prototype.hasOwnProperty.call(u,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),oo=Tr.extend({options:{fill:!0,radius:10},initialize:function(u,A){x(this,A),this._latlng=Ce(u),this._radius=this.options.radius},setLatLng:function(u){var A=this._latlng;return this._latlng=Ce(u),this.redraw(),this.fire("move",{oldLatLng:A,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(u){return this.options.radius=this._radius=u,this.redraw()},getRadius:function(){return this._radius},setStyle:function(u){var A=u&&u.radius||this._radius;return Tr.prototype.setStyle.call(this,u),this.setRadius(A),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var u=this._radius,A=this._radiusY||u,G=this._clickTolerance(),X=[u+G,A+G];this._pxBounds=new K(this._point.subtract(X),this._point.add(X))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(u){return u.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ac(u,A){return new oo(u,A)}var lo=oo.extend({initialize:function(u,A,G){if(typeof A=="number"&&(A=i({},G,{radius:A})),x(this,A),this._latlng=Ce(u),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(u){return this._mRadius=u,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var u=[this._radius,this._radiusY||this._radius];return new le(this._map.layerPointToLatLng(this._point.subtract(u)),this._map.layerPointToLatLng(this._point.add(u)))},setStyle:Tr.prototype.setStyle,_project:function(){var u=this._latlng.lng,A=this._latlng.lat,G=this._map,X=G.options.crs;if(X.distance===ge.distance){var T=Math.PI/180,$=this._mRadius/ge.R/T,me=G.project([A+$,u]),we=G.project([A-$,u]),We=me.add(we).divideBy(2),Ee=G.unproject(We).lat,tt=Math.acos((Math.cos($*T)-Math.sin(A*T)*Math.sin(Ee*T))/(Math.cos(A*T)*Math.cos(Ee*T)))/T;(isNaN(tt)||tt===0)&&(tt=$/Math.cos(Math.PI/180*A)),this._point=We.subtract(G.getPixelOrigin()),this._radius=isNaN(tt)?0:We.x-G.project([Ee,u-tt]).x,this._radiusY=We.y-me.y}else{var St=X.unproject(X.project(this._latlng).subtract([this._mRadius,0]));this._point=G.latLngToLayerPoint(this._latlng),this._radius=this._point.x-G.latLngToLayerPoint(St).x}this._updateBounds()}});function Za(u,A,G){return new lo(u,A,G)}var Ns=Tr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(u,A){x(this,A),this._setLatLngs(u)},getLatLngs:function(){return this._latlngs},setLatLngs:function(u){return this._setLatLngs(u),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(u){for(var A=1/0,G=null,X=ui,T,$,me=0,we=this._parts.length;me<we;me++)for(var We=this._parts[me],Ee=1,tt=We.length;Ee<tt;Ee++){T=We[Ee-1],$=We[Ee];var St=X(u,T,$,!0);St<A&&(A=St,G=X(u,T,$))}return G&&(G.distance=Math.sqrt(A)),G},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return tc(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(u,A){return A=A||this._defaultShape(),u=Ce(u),A.push(u),this._bounds.extend(u),this.redraw()},_setLatLngs:function(u){this._bounds=new le,this._latlngs=this._convertLatLngs(u)},_defaultShape:function(){return Ys(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(u){for(var A=[],G=Ys(u),X=0,T=u.length;X<T;X++)G?(A[X]=Ce(u[X]),this._bounds.extend(A[X])):A[X]=this._convertLatLngs(u[X]);return A},_project:function(){var u=new K;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,u),this._bounds.isValid()&&u.isValid()&&(this._rawPxBounds=u,this._updateBounds())},_updateBounds:function(){var u=this._clickTolerance(),A=new U(u,u);this._rawPxBounds&&(this._pxBounds=new K([this._rawPxBounds.min.subtract(A),this._rawPxBounds.max.add(A)]))},_projectLatlngs:function(u,A,G){var X=u[0]instanceof ae,T=u.length,$,me;if(X){for(me=[],$=0;$<T;$++)me[$]=this._map.latLngToLayerPoint(u[$]),G.extend(me[$]);A.push(me)}else for($=0;$<T;$++)this._projectLatlngs(u[$],A,G)},_clipPoints:function(){var u=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}var A=this._parts,G,X,T,$,me,we,We;for(G=0,T=0,$=this._rings.length;G<$;G++)for(We=this._rings[G],X=0,me=We.length;X<me-1;X++)we=$l(We[X],We[X+1],u,X,!0),we&&(A[T]=A[T]||[],A[T].push(we[0]),(we[1]!==We[X+1]||X===me-2)&&(A[T].push(we[1]),T++))}},_simplifyPoints:function(){for(var u=this._parts,A=this.options.smoothFactor,G=0,X=u.length;G<X;G++)u[G]=io(u[G],A)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(u,A){var G,X,T,$,me,we,We=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for(G=0,$=this._parts.length;G<$;G++)for(we=this._parts[G],X=0,me=we.length,T=me-1;X<me;T=X++)if(!(!A&&X===0)&&ql(u,we[T],we[X])<=We)return!0;return!1}});function jd(u,A){return new Ns(u,A)}Ns._flat=ec;var Zr=Ns.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ql(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(u){var A=Ns.prototype._convertLatLngs.call(this,u),G=A.length;return G>=2&&A[0]instanceof ae&&A[0].equals(A[G-1])&&A.pop(),A},_setLatLngs:function(u){Ns.prototype._setLatLngs.call(this,u),Ys(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ys(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var u=this._renderer._bounds,A=this.options.weight,G=new U(A,A);if(u=new K(u.min.subtract(G),u.max.add(G)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(u))){if(this.options.noClip){this._parts=this._rings;return}for(var X=0,T=this._rings.length,$;X<T;X++)$=Uo(this._rings[X],u,!0),$.length&&this._parts.push($)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(u){var A=!1,G,X,T,$,me,we,We,Ee;if(!this._pxBounds||!this._pxBounds.contains(u))return!1;for($=0,We=this._parts.length;$<We;$++)for(G=this._parts[$],me=0,Ee=G.length,we=Ee-1;me<Ee;we=me++)X=G[me],T=G[we],X.y>u.y!=T.y>u.y&&u.x<(T.x-X.x)*(u.y-X.y)/(T.y-X.y)+X.x&&(A=!A);return A||Ns.prototype._containsPoint.call(this,u,!0)}});function Xd(u,A){return new Zr(u,A)}var ir=Sr.extend({initialize:function(u,A){x(this,A),this._layers={},u&&this.addData(u)},addData:function(u){var A=V(u)?u:u.features,G,X,T;if(A){for(G=0,X=A.length;G<X;G++)T=A[G],(T.geometries||T.geometry||T.features||T.coordinates)&&this.addData(T);return this}var $=this.options;if($.filter&&!$.filter(u))return this;var me=Ei(u,$);return me?(me.feature=mo(u),me.defaultOptions=me.options,this.resetStyle(me),$.onEachFeature&&$.onEachFeature(u,me),this.addLayer(me)):this},resetStyle:function(u){return u===void 0?this.eachLayer(this.resetStyle,this):(u.options=i({},u.defaultOptions),this._setLayerStyle(u,this.options.style),this)},setStyle:function(u){return this.eachLayer(function(A){this._setLayerStyle(A,u)},this)},_setLayerStyle:function(u,A){u.setStyle&&(typeof A=="function"&&(A=A(u.feature)),u.setStyle(A))}});function Ei(u,A){var G=u.type==="Feature"?u.geometry:u,X=G?G.coordinates:null,T=[],$=A&&A.pointToLayer,me=A&&A.coordsToLatLng||go,we,We,Ee,tt;if(!X&&!G)return null;switch(G.type){case"Point":return we=me(X),co($,u,we,A);case"MultiPoint":for(Ee=0,tt=X.length;Ee<tt;Ee++)we=me(X[Ee]),T.push(co($,u,we,A));return new Sr(T);case"LineString":case"MultiLineString":return We=Ga(X,G.type==="LineString"?0:1,me),new Ns(We,A);case"Polygon":case"MultiPolygon":return We=Ga(X,G.type==="Polygon"?1:2,me),new Zr(We,A);case"GeometryCollection":for(Ee=0,tt=G.geometries.length;Ee<tt;Ee++){var St=Ei({geometry:G.geometries[Ee],type:"Feature",properties:u.properties},A);St&&T.push(St)}return new Sr(T);case"FeatureCollection":for(Ee=0,tt=G.features.length;Ee<tt;Ee++){var Lt=Ei(G.features[Ee],A);Lt&&T.push(Lt)}return new Sr(T);default:throw new Error("Invalid GeoJSON object.")}}function co(u,A,G,X){return u?u(A,G):new wr(G,X&&X.markersInheritOptions&&X)}function go(u){return new ae(u[1],u[0],u[2])}function Ga(u,A,G){for(var X=[],T=0,$=u.length,me;T<$;T++)me=A?Ga(u[T],A-1,G):(G||go)(u[T]),X.push(me);return X}function uo(u,A){return u=Ce(u),u.alt!==void 0?[f(u.lng,A),f(u.lat,A),f(u.alt,A)]:[f(u.lng,A),f(u.lat,A)]}function ho(u,A,G,X){for(var T=[],$=0,me=u.length;$<me;$++)T.push(A?ho(u[$],Ys(u[$])?0:A-1,G,X):uo(u[$],X));return!A&&G&&T.length>0&&T.push(T[0].slice()),T}function Di(u,A){return u.feature?i({},u.feature,{geometry:A}):mo(A)}function mo(u){return u.type==="Feature"||u.type==="FeatureCollection"?u:{type:"Feature",properties:{},geometry:u}}var sl={toGeoJSON:function(u){return Di(this,{type:"Point",coordinates:uo(this.getLatLng(),u)})}};wr.include(sl),lo.include(sl),oo.include(sl),Ns.include({toGeoJSON:function(u){var A=!Ys(this._latlngs),G=ho(this._latlngs,A?1:0,!1,u);return Di(this,{type:(A?"Multi":"")+"LineString",coordinates:G})}}),Zr.include({toGeoJSON:function(u){var A=!Ys(this._latlngs),G=A&&!Ys(this._latlngs[0]),X=ho(this._latlngs,G?2:A?1:0,!0,u);return A||(X=[X]),Di(this,{type:(G?"Multi":"")+"Polygon",coordinates:X})}}),Hr.include({toMultiPoint:function(u){var A=[];return this.eachLayer(function(G){A.push(G.toGeoJSON(u).geometry.coordinates)}),Di(this,{type:"MultiPoint",coordinates:A})},toGeoJSON:function(u){var A=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(A==="MultiPoint")return this.toMultiPoint(u);var G=A==="GeometryCollection",X=[];return this.eachLayer(function(T){if(T.toGeoJSON){var $=T.toGeoJSON(u);if(G)X.push($.geometry);else{var me=mo($);me.type==="FeatureCollection"?X.push.apply(X,me.features):X.push(me)}}}),G?Di(this,{geometries:X,type:"GeometryCollection"}):{type:"FeatureCollection",features:X}}});function oc(u,A){return new ir(u,A)}var zs=oc,Er=Os.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(u,A,G){this._url=u,this._bounds=ue(A),x(this,G)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Nt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Zn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(u){return this.options.opacity=u,this._image&&this._updateOpacity(),this},setStyle:function(u){return u.opacity&&this.setOpacity(u.opacity),this},bringToFront:function(){return this._map&&_i(this._image),this},bringToBack:function(){return this._map&&yr(this._image),this},setUrl:function(u){return this._url=u,this._image&&(this._image.src=u),this},setBounds:function(u){return this._bounds=ue(u),this._map&&this._reset(),this},getEvents:function(){var u={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var u=this._url.tagName==="IMG",A=this._image=u?this._url:Wt("img");if(Nt(A,"leaflet-image-layer"),this._zoomAnimated&&Nt(A,"leaflet-zoom-animated"),this.options.className&&Nt(A,this.options.className),A.onselectstart=m,A.onmousemove=m,A.onload=o(this.fire,this,"load"),A.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),u){this._url=A.src;return}A.src=this._url,A.alt=this.options.alt},_animateZoom:function(u){var A=this._map.getZoomScale(u.zoom),G=this._map._latLngBoundsToNewLayerBounds(this._bounds,u.zoom,u.center).min;Ds(this._image,G,A)},_reset:function(){var u=this._image,A=new K(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),G=A.getSize();Fn(u,A.min),u.style.width=G.x+"px",u.style.height=G.y+"px"},_updateOpacity:function(){ps(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var u=this.options.errorOverlayUrl;u&&this._url!==u&&(this._url=u,this._image.src=u)},getCenter:function(){return this._bounds.getCenter()}}),lc=function(u,A,G){return new Er(u,A,G)},rl=Er.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var u=this._url.tagName==="VIDEO",A=this._image=u?this._url:Wt("video");if(Nt(A,"leaflet-image-layer"),this._zoomAnimated&&Nt(A,"leaflet-zoom-animated"),this.options.className&&Nt(A,this.options.className),A.onselectstart=m,A.onmousemove=m,A.onloadeddata=o(this.fire,this,"load"),u){for(var G=A.getElementsByTagName("source"),X=[],T=0;T<G.length;T++)X.push(G[T].src);this._url=G.length>0?X:[A.src];return}V(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(A.style,"objectFit")&&(A.style.objectFit="fill"),A.autoplay=!!this.options.autoplay,A.loop=!!this.options.loop,A.muted=!!this.options.muted,A.playsInline=!!this.options.playsInline;for(var $=0;$<this._url.length;$++){var me=Wt("source");me.src=this._url[$],A.appendChild(me)}}});function cc(u,A,G){return new rl(u,A,G)}var il=Er.extend({_initImage:function(){var u=this._image=this._url;Nt(u,"leaflet-image-layer"),this._zoomAnimated&&Nt(u,"leaflet-zoom-animated"),this.options.className&&Nt(u,this.options.className),u.onselectstart=m,u.onmousemove=m}});function al(u,A,G){return new il(u,A,G)}var C=Os.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(u,A){u&&(u instanceof ae||V(u))?(this._latlng=Ce(u),x(this,A)):(x(this,u),this._source=A),this.options.content&&(this._content=this.options.content)},openOn:function(u){return u=arguments.length?u:this._source._map,u.hasLayer(this)||u.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(u){return this._map?this.close():(arguments.length?this._source=u:u=this._source,this._prepareOpen(),this.openOn(u._map)),this},onAdd:function(u){this._zoomAnimated=u._zoomAnimated,this._container||this._initLayout(),u._fadeAnimated&&ps(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),u._fadeAnimated&&ps(this._container,1),this.bringToFront(),this.options.interactive&&(Nt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(u){u._fadeAnimated?(ps(this._container,0),this._removeTimeout=setTimeout(o(Zn,void 0,this._container),200)):Zn(this._container),this.options.interactive&&(vn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(u){return this._latlng=Ce(u),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(u){return this._content=u,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var u={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_i(this._container),this},bringToBack:function(){return this._map&&yr(this._container),this},_prepareOpen:function(u){var A=this._source;if(!A._map)return!1;if(A instanceof Sr){A=null;var G=this._source._layers;for(var X in G)if(G[X]._map){A=G[X];break}if(!A)return!1;this._source=A}if(!u)if(A.getCenter)u=A.getCenter();else if(A.getLatLng)u=A.getLatLng();else if(A.getBounds)u=A.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(u),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var u=this._contentNode,A=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof A=="string")u.innerHTML=A;else{for(;u.hasChildNodes();)u.removeChild(u.firstChild);u.appendChild(A)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var u=this._map.latLngToLayerPoint(this._latlng),A=ne(this.options.offset),G=this._getAnchor();this._zoomAnimated?Fn(this._container,u.add(G)):A=A.add(u).add(G);var X=this._containerBottom=-A.y,T=this._containerLeft=-Math.round(this._containerWidth/2)+A.x;this._container.style.bottom=X+"px",this._container.style.left=T+"px"}},_getAnchor:function(){return[0,0]}});Pt.include({_initOverlay:function(u,A,G,X){var T=A;return T instanceof u||(T=new u(X).setContent(A)),G&&T.setLatLng(G),T}}),Os.include({_initOverlay:function(u,A,G,X){var T=G;return T instanceof u?(x(T,X),T._source=this):(T=A&&!X?A:new u(X,this),T.setContent(G)),T}});var jg=C.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(u){return u=arguments.length?u:this._source._map,!u.hasLayer(this)&&u._popup&&u._popup.options.autoClose&&u.removeLayer(u._popup),u._popup=this,C.prototype.openOn.call(this,u)},onAdd:function(u){C.prototype.onAdd.call(this,u),u.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Tr||this._source.on("preclick",rr))},onRemove:function(u){C.prototype.onRemove.call(this,u),u.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Tr||this._source.off("preclick",rr))},getEvents:function(){var u=C.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(u.preclick=this.close),this.options.keepInView&&(u.moveend=this._adjustPan),u},_initLayout:function(){var u="leaflet-popup",A=this._container=Wt("div",u+" "+(this.options.className||"")+" leaflet-zoom-animated"),G=this._wrapper=Wt("div",u+"-content-wrapper",A);if(this._contentNode=Wt("div",u+"-content",G),va(A),to(this._contentNode),wt(A,"contextmenu",rr),this._tipContainer=Wt("div",u+"-tip-container",A),this._tip=Wt("div",u+"-tip",this._tipContainer),this.options.closeButton){var X=this._closeButton=Wt("a",u+"-close-button",A);X.setAttribute("role","button"),X.setAttribute("aria-label","Close popup"),X.href="#close",X.innerHTML='<span aria-hidden="true">&#215;</span>',wt(X,"click",function(T){Xn(T),this.close()},this)}},_updateLayout:function(){var u=this._contentNode,A=u.style;A.width="",A.whiteSpace="nowrap";var G=u.offsetWidth;G=Math.min(G,this.options.maxWidth),G=Math.max(G,this.options.minWidth),A.width=G+1+"px",A.whiteSpace="",A.height="";var X=u.offsetHeight,T=this.options.maxHeight,$="leaflet-popup-scrolled";T&&X>T?(A.height=T+"px",Nt(u,$)):vn(u,$),this._containerWidth=this._container.offsetWidth},_animateZoom:function(u){var A=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center),G=this._getAnchor();Fn(this._container,A.add(G))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var u=this._map,A=parseInt(pa(this._container,"marginBottom"),10)||0,G=this._container.offsetHeight+A,X=this._containerWidth,T=new U(this._containerLeft,-G-this._containerBottom);T._add(vr(this._container));var $=u.layerPointToContainerPoint(T),me=ne(this.options.autoPanPadding),we=ne(this.options.autoPanPaddingTopLeft||me),We=ne(this.options.autoPanPaddingBottomRight||me),Ee=u.getSize(),tt=0,St=0;$.x+X+We.x>Ee.x&&(tt=$.x+X-Ee.x+We.x),$.x-tt-we.x<0&&(tt=$.x-we.x),$.y+G+We.y>Ee.y&&(St=$.y+G-Ee.y+We.y),$.y-St-we.y<0&&(St=$.y-we.y),(tt||St)&&(this.options.keepInView&&(this._autopanning=!0),u.fire("autopanstart").panBy([tt,St]))}},_getAnchor:function(){return ne(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),dc=function(u,A){return new jg(u,A)};Pt.mergeOptions({closePopupOnClick:!0}),Pt.include({openPopup:function(u,A,G){return this._initOverlay(jg,u,A,G).openOn(this),this},closePopup:function(u){return u=arguments.length?u:this._popup,u&&u.close(),this}}),Os.include({bindPopup:function(u,A){return this._popup=this._initOverlay(jg,this._popup,u,A),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(u){return this._popup&&(this instanceof Sr||(this._popup._source=this),this._popup._prepareOpen(u||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(u){return this._popup&&this._popup.setContent(u),this},getPopup:function(){return this._popup},_openPopup:function(u){if(!(!this._popup||!this._map)){Ps(u);var A=u.layer||u.target;if(this._popup._source===A&&!(A instanceof Tr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(u.latlng);return}this._popup._source=A,this.openPopup(u.latlng)}},_movePopup:function(u){this._popup.setLatLng(u.latlng)},_onKeyPress:function(u){u.originalEvent.keyCode===13&&this._openPopup(u)}});var gc=C.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(u){C.prototype.onAdd.call(this,u),this.setOpacity(this.options.opacity),u.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(u){C.prototype.onRemove.call(this,u),u.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var u=C.prototype.getEvents.call(this);return this.options.permanent||(u.preclick=this.close),u},_initLayout:function(){var u="leaflet-tooltip",A=u+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Wt("div",A),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+c(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(u){var A,G,X=this._map,T=this._container,$=X.latLngToContainerPoint(X.getCenter()),me=X.layerPointToContainerPoint(u),we=this.options.direction,We=T.offsetWidth,Ee=T.offsetHeight,tt=ne(this.options.offset),St=this._getAnchor();we==="top"?(A=We/2,G=Ee):we==="bottom"?(A=We/2,G=0):we==="center"?(A=We/2,G=Ee/2):we==="right"?(A=0,G=Ee/2):we==="left"?(A=We,G=Ee/2):me.x<$.x?(we="right",A=0,G=Ee/2):(we="left",A=We+(tt.x+St.x)*2,G=Ee/2),u=u.subtract(ne(A,G,!0)).add(tt).add(St),vn(T,"leaflet-tooltip-right"),vn(T,"leaflet-tooltip-left"),vn(T,"leaflet-tooltip-top"),vn(T,"leaflet-tooltip-bottom"),Nt(T,"leaflet-tooltip-"+we),Fn(T,u)},_updatePosition:function(){var u=this._map.latLngToLayerPoint(this._latlng);this._setPosition(u)},setOpacity:function(u){this.options.opacity=u,this._container&&ps(this._container,u)},_animateZoom:function(u){var A=this._map._latLngToNewLayerPoint(this._latlng,u.zoom,u.center);this._setPosition(A)},_getAnchor:function(){return ne(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Jd=function(u,A){return new gc(u,A)};Pt.include({openTooltip:function(u,A,G){return this._initOverlay(gc,u,A,G).openOn(this),this},closeTooltip:function(u){return u.close(),this}}),Os.include({bindTooltip:function(u,A){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(gc,this._tooltip,u,A),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(u){if(!(!u&&this._tooltipHandlersAdded)){var A=u?"off":"on",G={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?G.add=this._openTooltip:(G.mouseover=this._openTooltip,G.mouseout=this.closeTooltip,G.click=this._openTooltip,this._map?this._addFocusListeners():G.add=this._addFocusListeners),this._tooltip.options.sticky&&(G.mousemove=this._moveTooltip),this[A](G),this._tooltipHandlersAdded=!u}},openTooltip:function(u){return this._tooltip&&(this instanceof Sr||(this._tooltip._source=this),this._tooltip._prepareOpen(u)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(u){return this._tooltip&&this._tooltip.setContent(u),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(u){var A=typeof u.getElement=="function"&&u.getElement();A&&(wt(A,"focus",function(){this._tooltip._source=u,this.openTooltip()},this),wt(A,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(u){var A=typeof u.getElement=="function"&&u.getElement();A&&A.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(u){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var A=this;this._map.once("moveend",function(){A._openOnceFlag=!1,A._openTooltip(u)});return}this._tooltip._source=u.layer||u.target,this.openTooltip(this._tooltip.options.sticky?u.latlng:void 0)}},_moveTooltip:function(u){var A=u.latlng,G,X;this._tooltip.options.sticky&&u.originalEvent&&(G=this._map.mouseEventToContainerPoint(u.originalEvent),X=this._map.containerPointToLayerPoint(G),A=this._map.layerPointToLatLng(X)),this._tooltip.setLatLng(A)}});var Xg=hi.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(u){var A=u&&u.tagName==="DIV"?u:document.createElement("div"),G=this.options;if(G.html instanceof Element?(za(A),A.appendChild(G.html)):A.innerHTML=G.html!==!1?G.html:"",G.bgPos){var X=ne(G.bgPos);A.style.backgroundPosition=-X.x+"px "+-X.y+"px"}return this._setIconStyles(A,"icon"),A},createShadow:function(){return null}});function qm(u){return new Xg(u)}hi.Default=Ti;var Io=Os.extend({options:{tileSize:256,opacity:1,updateWhenIdle:gt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(u){x(this,u)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(u){u._addZoomLimit(this)},onRemove:function(u){this._removeAllTiles(),Zn(this._container),u._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_i(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(u){return this.options.opacity=u,this._updateOpacity(),this},setZIndex:function(u){return this.options.zIndex=u,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var u=this._clampZoom(this._map.getZoom());u!==this._tileZoom&&(this._tileZoom=u,this._updateLevels()),this._update()}return this},getEvents:function(){var u={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=d(this._onMoveEnd,this.options.updateInterval,this)),u.move=this._onMove),this._zoomAnimated&&(u.zoomanim=this._animateZoom),u},createTile:function(){return document.createElement("div")},getTileSize:function(){var u=this.options.tileSize;return u instanceof U?u:new U(u,u)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(u){for(var A=this.getPane().children,G=-u(-1/0,1/0),X=0,T=A.length,$;X<T;X++)$=A[X].style.zIndex,A[X]!==this._container&&$&&(G=u(G,+$));isFinite(G)&&(this.options.zIndex=G+u(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!gt.ielt9){ps(this._container,this.options.opacity);var u=+new Date,A=!1,G=!1;for(var X in this._tiles){var T=this._tiles[X];if(!(!T.current||!T.loaded)){var $=Math.min(1,(u-T.loaded)/200);ps(T.el,$),$<1?A=!0:(T.active?G=!0:this._onOpaqueTile(T),T.active=!0)}}G&&!this._noPrune&&this._pruneTiles(),A&&(z(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this))}},_onOpaqueTile:m,_initContainer:function(){this._container||(this._container=Wt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var u=this._tileZoom,A=this.options.maxZoom;if(u!==void 0){for(var G in this._levels)G=Number(G),this._levels[G].el.children.length||G===u?(this._levels[G].el.style.zIndex=A-Math.abs(u-G),this._onUpdateLevel(G)):(Zn(this._levels[G].el),this._removeTilesAtZoom(G),this._onRemoveLevel(G),delete this._levels[G]);var X=this._levels[u],T=this._map;return X||(X=this._levels[u]={},X.el=Wt("div","leaflet-tile-container leaflet-zoom-animated",this._container),X.el.style.zIndex=A,X.origin=T.project(T.unproject(T.getPixelOrigin()),u).round(),X.zoom=u,this._setZoomTransform(X,T.getCenter(),T.getZoom()),m(X.el.offsetWidth),this._onCreateLevel(X)),this._level=X,X}},_onUpdateLevel:m,_onRemoveLevel:m,_onCreateLevel:m,_pruneTiles:function(){if(this._map){var u,A,G=this._map.getZoom();if(G>this.options.maxZoom||G<this.options.minZoom){this._removeAllTiles();return}for(u in this._tiles)A=this._tiles[u],A.retain=A.current;for(u in this._tiles)if(A=this._tiles[u],A.current&&!A.active){var X=A.coords;this._retainParent(X.x,X.y,X.z,X.z-5)||this._retainChildren(X.x,X.y,X.z,X.z+2)}for(u in this._tiles)this._tiles[u].retain||this._removeTile(u)}},_removeTilesAtZoom:function(u){for(var A in this._tiles)this._tiles[A].coords.z===u&&this._removeTile(A)},_removeAllTiles:function(){for(var u in this._tiles)this._removeTile(u)},_invalidateAll:function(){for(var u in this._levels)Zn(this._levels[u].el),this._onRemoveLevel(Number(u)),delete this._levels[u];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(u,A,G,X){var T=Math.floor(u/2),$=Math.floor(A/2),me=G-1,we=new U(+T,+$);we.z=+me;var We=this._tileCoordsToKey(we),Ee=this._tiles[We];return Ee&&Ee.active?(Ee.retain=!0,!0):(Ee&&Ee.loaded&&(Ee.retain=!0),me>X?this._retainParent(T,$,me,X):!1)},_retainChildren:function(u,A,G,X){for(var T=2*u;T<2*u+2;T++)for(var $=2*A;$<2*A+2;$++){var me=new U(T,$);me.z=G+1;var we=this._tileCoordsToKey(me),We=this._tiles[we];if(We&&We.active){We.retain=!0;continue}else We&&We.loaded&&(We.retain=!0);G+1<X&&this._retainChildren(T,$,G+1,X)}},_resetView:function(u){var A=u&&(u.pinch||u.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),A,A)},_animateZoom:function(u){this._setView(u.center,u.zoom,!0,u.noUpdate)},_clampZoom:function(u){var A=this.options;return A.minNativeZoom!==void 0&&u<A.minNativeZoom?A.minNativeZoom:A.maxNativeZoom!==void 0&&A.maxNativeZoom<u?A.maxNativeZoom:u},_setView:function(u,A,G,X){var T=Math.round(A);this.options.maxZoom!==void 0&&T>this.options.maxZoom||this.options.minZoom!==void 0&&T<this.options.minZoom?T=void 0:T=this._clampZoom(T);var $=this.options.updateWhenZooming&&T!==this._tileZoom;(!X||$)&&(this._tileZoom=T,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),T!==void 0&&this._update(u),G||this._pruneTiles(),this._noPrune=!!G),this._setZoomTransforms(u,A)},_setZoomTransforms:function(u,A){for(var G in this._levels)this._setZoomTransform(this._levels[G],u,A)},_setZoomTransform:function(u,A,G){var X=this._map.getZoomScale(G,u.zoom),T=u.origin.multiplyBy(X).subtract(this._map._getNewPixelOrigin(A,G)).round();gt.any3d?Ds(u.el,T,X):Fn(u.el,T)},_resetGrid:function(){var u=this._map,A=u.options.crs,G=this._tileSize=this.getTileSize(),X=this._tileZoom,T=this._map.getPixelWorldBounds(this._tileZoom);T&&(this._globalTileRange=this._pxBoundsToTileRange(T)),this._wrapX=A.wrapLng&&!this.options.noWrap&&[Math.floor(u.project([0,A.wrapLng[0]],X).x/G.x),Math.ceil(u.project([0,A.wrapLng[1]],X).x/G.y)],this._wrapY=A.wrapLat&&!this.options.noWrap&&[Math.floor(u.project([A.wrapLat[0],0],X).y/G.x),Math.ceil(u.project([A.wrapLat[1],0],X).y/G.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(u){var A=this._map,G=A._animatingZoom?Math.max(A._animateToZoom,A.getZoom()):A.getZoom(),X=A.getZoomScale(G,this._tileZoom),T=A.project(u,this._tileZoom).floor(),$=A.getSize().divideBy(X*2);return new K(T.subtract($),T.add($))},_update:function(u){var A=this._map;if(A){var G=this._clampZoom(A.getZoom());if(u===void 0&&(u=A.getCenter()),this._tileZoom!==void 0){var X=this._getTiledPixelBounds(u),T=this._pxBoundsToTileRange(X),$=T.getCenter(),me=[],we=this.options.keepBuffer,We=new K(T.getBottomLeft().subtract([we,-we]),T.getTopRight().add([we,-we]));if(!(isFinite(T.min.x)&&isFinite(T.min.y)&&isFinite(T.max.x)&&isFinite(T.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ee in this._tiles){var tt=this._tiles[Ee].coords;(tt.z!==this._tileZoom||!We.contains(new U(tt.x,tt.y)))&&(this._tiles[Ee].current=!1)}if(Math.abs(G-this._tileZoom)>1){this._setView(u,G);return}for(var St=T.min.y;St<=T.max.y;St++)for(var Lt=T.min.x;Lt<=T.max.x;Lt++){var ks=new U(Lt,St);if(ks.z=this._tileZoom,!!this._isValidTile(ks)){var bs=this._tiles[this._tileCoordsToKey(ks)];bs?bs.current=!0:me.push(ks)}}if(me.sort(function(ar,Cc){return ar.distanceTo($)-Cc.distanceTo($)}),me.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Gr=document.createDocumentFragment();for(Lt=0;Lt<me.length;Lt++)this._addTile(me[Lt],Gr);this._level.el.appendChild(Gr)}}}},_isValidTile:function(u){var A=this._map.options.crs;if(!A.infinite){var G=this._globalTileRange;if(!A.wrapLng&&(u.x<G.min.x||u.x>G.max.x)||!A.wrapLat&&(u.y<G.min.y||u.y>G.max.y))return!1}if(!this.options.bounds)return!0;var X=this._tileCoordsToBounds(u);return ue(this.options.bounds).overlaps(X)},_keyToBounds:function(u){return this._tileCoordsToBounds(this._keyToTileCoords(u))},_tileCoordsToNwSe:function(u){var A=this._map,G=this.getTileSize(),X=u.scaleBy(G),T=X.add(G),$=A.unproject(X,u.z),me=A.unproject(T,u.z);return[$,me]},_tileCoordsToBounds:function(u){var A=this._tileCoordsToNwSe(u),G=new le(A[0],A[1]);return this.options.noWrap||(G=this._map.wrapLatLngBounds(G)),G},_tileCoordsToKey:function(u){return u.x+":"+u.y+":"+u.z},_keyToTileCoords:function(u){var A=u.split(":"),G=new U(+A[0],+A[1]);return G.z=+A[2],G},_removeTile:function(u){var A=this._tiles[u];A&&(Zn(A.el),delete this._tiles[u],this.fire("tileunload",{tile:A.el,coords:this._keyToTileCoords(u)}))},_initTile:function(u){Nt(u,"leaflet-tile");var A=this.getTileSize();u.style.width=A.x+"px",u.style.height=A.y+"px",u.onselectstart=m,u.onmousemove=m,gt.ielt9&&this.options.opacity<1&&ps(u,this.options.opacity)},_addTile:function(u,A){var G=this._getTilePos(u),X=this._tileCoordsToKey(u),T=this.createTile(this._wrapCoords(u),o(this._tileReady,this,u));this._initTile(T),this.createTile.length<2&&D(o(this._tileReady,this,u,null,T)),Fn(T,G),this._tiles[X]={el:T,coords:u,current:!0},A.appendChild(T),this.fire("tileloadstart",{tile:T,coords:u})},_tileReady:function(u,A,G){A&&this.fire("tileerror",{error:A,tile:G,coords:u});var X=this._tileCoordsToKey(u);G=this._tiles[X],G&&(G.loaded=+new Date,this._map._fadeAnimated?(ps(G.el,0),z(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this)):(G.active=!0,this._pruneTiles()),A||(Nt(G.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:G.el,coords:u})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),gt.ielt9||!this._map._fadeAnimated?D(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(u){return u.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(u){var A=new U(this._wrapX?h(u.x,this._wrapX):u.x,this._wrapY?h(u.y,this._wrapY):u.y);return A.z=u.z,A},_pxBoundsToTileRange:function(u){var A=this.getTileSize();return new K(u.min.unscaleBy(A).floor(),u.max.unscaleBy(A).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var u in this._tiles)if(!this._tiles[u].loaded)return!1;return!0}});function uc(u){return new Io(u)}var Co=Io.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(u,A){this._url=u,A=x(this,A),A.detectRetina&&gt.retina&&A.maxZoom>0?(A.tileSize=Math.floor(A.tileSize/2),A.zoomReverse?(A.zoomOffset--,A.minZoom=Math.min(A.maxZoom,A.minZoom+1)):(A.zoomOffset++,A.maxZoom=Math.max(A.minZoom,A.maxZoom-1)),A.minZoom=Math.max(0,A.minZoom)):A.zoomReverse?A.minZoom=Math.min(A.maxZoom,A.minZoom):A.maxZoom=Math.max(A.minZoom,A.maxZoom),typeof A.subdomains=="string"&&(A.subdomains=A.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(u,A){return this._url===u&&A===void 0&&(A=!0),this._url=u,A||this.redraw(),this},createTile:function(u,A){var G=document.createElement("img");return wt(G,"load",o(this._tileOnLoad,this,A,G)),wt(G,"error",o(this._tileOnError,this,A,G)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(G.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(G.referrerPolicy=this.options.referrerPolicy),G.alt="",G.src=this.getTileUrl(u),G},getTileUrl:function(u){var A={r:gt.retina?"@2x":"",s:this._getSubdomain(u),x:u.x,y:u.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var G=this._globalTileRange.max.y-u.y;this.options.tms&&(A.y=G),A["-y"]=G}return B(this._url,i(A,this.options))},_tileOnLoad:function(u,A){gt.ielt9?setTimeout(o(u,this,null,A),0):u(null,A)},_tileOnError:function(u,A,G){var X=this.options.errorTileUrl;X&&A.getAttribute("src")!==X&&(A.src=X),u(G,A)},_onTileRemove:function(u){u.tile.onload=null},_getZoomForUrl:function(){var u=this._tileZoom,A=this.options.maxZoom,G=this.options.zoomReverse,X=this.options.zoomOffset;return G&&(u=A-u),u+X},_getSubdomain:function(u){var A=Math.abs(u.x+u.y)%this.options.subdomains.length;return this.options.subdomains[A]},_abortLoading:function(){var u,A;for(u in this._tiles)if(this._tiles[u].coords.z!==this._tileZoom&&(A=this._tiles[u].el,A.onload=m,A.onerror=m,!A.complete)){A.src=W;var G=this._tiles[u].coords;Zn(A),delete this._tiles[u],this.fire("tileabort",{tile:A,coords:G})}},_removeTile:function(u){var A=this._tiles[u];if(A)return A.el.setAttribute("src",W),Io.prototype._removeTile.call(this,u)},_tileReady:function(u,A,G){if(!(!this._map||G&&G.getAttribute("src")===W))return Io.prototype._tileReady.call(this,u,A,G)}});function ah(u,A){return new Co(u,A)}var Yd=Co.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(u,A){this._url=u;var G=i({},this.defaultWmsParams);for(var X in A)X in this.options||(G[X]=A[X]);A=x(this,A);var T=A.detectRetina&&gt.retina?2:1,$=this.getTileSize();G.width=$.x*T,G.height=$.y*T,this.wmsParams=G},onAdd:function(u){this._crs=this.options.crs||u.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var A=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[A]=this._crs.code,Co.prototype.onAdd.call(this,u)},getTileUrl:function(u){var A=this._tileCoordsToNwSe(u),G=this._crs,X=re(G.project(A[0]),G.project(A[1])),T=X.min,$=X.max,me=(this._wmsVersion>=1.3&&this._crs===sc?[T.y,T.x,$.y,$.x]:[T.x,T.y,$.x,$.y]).join(","),we=Co.prototype.getTileUrl.call(this,u);return we+v(this.wmsParams,we,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+me},setParams:function(u,A){return i(this.wmsParams,u),A||this.redraw(),this}});function $m(u,A){return new Yd(u,A)}Co.WMS=Yd,ah.wms=$m;var Li=Os.extend({options:{padding:.1},initialize:function(u){x(this,u),c(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Nt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var u={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(u.zoomanim=this._onAnimZoom),u},_onAnimZoom:function(u){this._updateTransform(u.center,u.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(u,A){var G=this._map.getZoomScale(A,this._zoom),X=this._map.getSize().multiplyBy(.5+this.options.padding),T=this._map.project(this._center,A),$=X.multiplyBy(-G).add(T).subtract(this._map._getNewPixelOrigin(u,A));gt.any3d?Ds(this._container,$,G):Fn(this._container,$)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var u in this._layers)this._layers[u]._reset()},_onZoomEnd:function(){for(var u in this._layers)this._layers[u]._project()},_updatePaths:function(){for(var u in this._layers)this._layers[u]._update()},_update:function(){var u=this.options.padding,A=this._map.getSize(),G=this._map.containerPointToLayerPoint(A.multiplyBy(-u)).round();this._bounds=new K(G,G.add(A.multiplyBy(1+u*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),oh=Li.extend({options:{tolerance:0},getEvents:function(){var u=Li.prototype.getEvents.call(this);return u.viewprereset=this._onViewPreReset,u},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Li.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var u=this._container=document.createElement("canvas");wt(u,"mousemove",this._onMouseMove,this),wt(u,"click dblclick mousedown mouseup contextmenu",this._onClick,this),wt(u,"mouseout",this._handleMouseOut,this),u._leaflet_disable_events=!0,this._ctx=u.getContext("2d")},_destroyContainer:function(){z(this._redrawRequest),delete this._ctx,Zn(this._container),hn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var u;this._redrawBounds=null;for(var A in this._layers)u=this._layers[A],u._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Li.prototype._update.call(this);var u=this._bounds,A=this._container,G=u.getSize(),X=gt.retina?2:1;Fn(A,u.min),A.width=X*G.x,A.height=X*G.y,A.style.width=G.x+"px",A.style.height=G.y+"px",gt.retina&&this._ctx.scale(2,2),this._ctx.translate(-u.min.x,-u.min.y),this.fire("update")}},_reset:function(){Li.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(u){this._updateDashArray(u),this._layers[c(u)]=u;var A=u._order={layer:u,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=A),this._drawLast=A,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(u){this._requestRedraw(u)},_removePath:function(u){var A=u._order,G=A.next,X=A.prev;G?G.prev=X:this._drawLast=X,X?X.next=G:this._drawFirst=G,delete u._order,delete this._layers[c(u)],this._requestRedraw(u)},_updatePath:function(u){this._extendRedrawBounds(u),u._project(),u._update(),this._requestRedraw(u)},_updateStyle:function(u){this._updateDashArray(u),this._requestRedraw(u)},_updateDashArray:function(u){if(typeof u.options.dashArray=="string"){var A=u.options.dashArray.split(/[, ]+/),G=[],X,T;for(T=0;T<A.length;T++){if(X=Number(A[T]),isNaN(X))return;G.push(X)}u.options._dashArray=G}else u.options._dashArray=u.options.dashArray},_requestRedraw:function(u){this._map&&(this._extendRedrawBounds(u),this._redrawRequest=this._redrawRequest||D(this._redraw,this))},_extendRedrawBounds:function(u){if(u._pxBounds){var A=(u.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new K,this._redrawBounds.extend(u._pxBounds.min.subtract([A,A])),this._redrawBounds.extend(u._pxBounds.max.add([A,A]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var u=this._redrawBounds;if(u){var A=u.getSize();this._ctx.clearRect(u.min.x,u.min.y,A.x,A.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var u,A=this._redrawBounds;if(this._ctx.save(),A){var G=A.getSize();this._ctx.beginPath(),this._ctx.rect(A.min.x,A.min.y,G.x,G.y),this._ctx.clip()}this._drawing=!0;for(var X=this._drawFirst;X;X=X.next)u=X.layer,(!A||u._pxBounds&&u._pxBounds.intersects(A))&&u._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(u,A){if(this._drawing){var G,X,T,$,me=u._parts,we=me.length,We=this._ctx;if(we){for(We.beginPath(),G=0;G<we;G++){for(X=0,T=me[G].length;X<T;X++)$=me[G][X],We[X?"lineTo":"moveTo"]($.x,$.y);A&&We.closePath()}this._fillStroke(We,u)}}},_updateCircle:function(u){if(!(!this._drawing||u._empty())){var A=u._point,G=this._ctx,X=Math.max(Math.round(u._radius),1),T=(Math.max(Math.round(u._radiusY),1)||X)/X;T!==1&&(G.save(),G.scale(1,T)),G.beginPath(),G.arc(A.x,A.y/T,X,0,Math.PI*2,!1),T!==1&&G.restore(),this._fillStroke(G,u)}},_fillStroke:function(u,A){var G=A.options;G.fill&&(u.globalAlpha=G.fillOpacity,u.fillStyle=G.fillColor||G.color,u.fill(G.fillRule||"evenodd")),G.stroke&&G.weight!==0&&(u.setLineDash&&u.setLineDash(A.options&&A.options._dashArray||[]),u.globalAlpha=G.opacity,u.lineWidth=G.weight,u.strokeStyle=G.color,u.lineCap=G.lineCap,u.lineJoin=G.lineJoin,u.stroke())},_onClick:function(u){for(var A=this._map.mouseEventToLayerPoint(u),G,X,T=this._drawFirst;T;T=T.next)G=T.layer,G.options.interactive&&G._containsPoint(A)&&(!(u.type==="click"||u.type==="preclick")||!this._map._draggableMoved(G))&&(X=G);this._fireEvent(X?[X]:!1,u)},_onMouseMove:function(u){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var A=this._map.mouseEventToLayerPoint(u);this._handleMouseHover(u,A)}},_handleMouseOut:function(u){var A=this._hoveredLayer;A&&(vn(this._container,"leaflet-interactive"),this._fireEvent([A],u,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(u,A){if(!this._mouseHoverThrottled){for(var G,X,T=this._drawFirst;T;T=T.next)G=T.layer,G.options.interactive&&G._containsPoint(A)&&(X=G);X!==this._hoveredLayer&&(this._handleMouseOut(u),X&&(Nt(this._container,"leaflet-interactive"),this._fireEvent([X],u,"mouseover"),this._hoveredLayer=X)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,u),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(u,A,G){this._map._fireDOMEvent(A,G||A.type,u)},_bringToFront:function(u){var A=u._order;if(A){var G=A.next,X=A.prev;if(G)G.prev=X;else return;X?X.next=G:G&&(this._drawFirst=G),A.prev=this._drawLast,this._drawLast.next=A,A.next=null,this._drawLast=A,this._requestRedraw(u)}},_bringToBack:function(u){var A=u._order;if(A){var G=A.next,X=A.prev;if(X)X.next=G;else return;G?G.prev=X:X&&(this._drawLast=X),A.prev=null,A.next=this._drawFirst,this._drawFirst.prev=A,this._drawFirst=A,this._requestRedraw(u)}}});function lh(u){return gt.canvas?new oh(u):null}var hc=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(u){return document.createElement("<lvml:"+u+' class="lvml">')}}catch{}return function(u){return document.createElement("<"+u+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),eI={_initContainer:function(){this._container=Wt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Li.prototype._update.call(this),this.fire("update"))},_initPath:function(u){var A=u._container=hc("shape");Nt(A,"leaflet-vml-shape "+(this.options.className||"")),A.coordsize="1 1",u._path=hc("path"),A.appendChild(u._path),this._updateStyle(u),this._layers[c(u)]=u},_addPath:function(u){var A=u._container;this._container.appendChild(A),u.options.interactive&&u.addInteractiveTarget(A)},_removePath:function(u){var A=u._container;Zn(A),u.removeInteractiveTarget(A),delete this._layers[c(u)]},_updateStyle:function(u){var A=u._stroke,G=u._fill,X=u.options,T=u._container;T.stroked=!!X.stroke,T.filled=!!X.fill,X.stroke?(A||(A=u._stroke=hc("stroke")),T.appendChild(A),A.weight=X.weight+"px",A.color=X.color,A.opacity=X.opacity,X.dashArray?A.dashStyle=V(X.dashArray)?X.dashArray.join(" "):X.dashArray.replace(/( *, *)/g," "):A.dashStyle="",A.endcap=X.lineCap.replace("butt","flat"),A.joinstyle=X.lineJoin):A&&(T.removeChild(A),u._stroke=null),X.fill?(G||(G=u._fill=hc("fill")),T.appendChild(G),G.color=X.fillColor||X.color,G.opacity=X.fillOpacity):G&&(T.removeChild(G),u._fill=null)},_updateCircle:function(u){var A=u._point.round(),G=Math.round(u._radius),X=Math.round(u._radiusY||G);this._setPath(u,u._empty()?"M0 0":"AL "+A.x+","+A.y+" "+G+","+X+" 0,"+65535*360)},_setPath:function(u,A){u._path.v=A},_bringToFront:function(u){_i(u._container)},_bringToBack:function(u){yr(u._container)}},mi=gt.vml?hc:De,ol=Li.extend({_initContainer:function(){this._container=mi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=mi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Zn(this._container),hn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Li.prototype._update.call(this);var u=this._bounds,A=u.getSize(),G=this._container;(!this._svgSize||!this._svgSize.equals(A))&&(this._svgSize=A,G.setAttribute("width",A.x),G.setAttribute("height",A.y)),Fn(G,u.min),G.setAttribute("viewBox",[u.min.x,u.min.y,A.x,A.y].join(" ")),this.fire("update")}},_initPath:function(u){var A=u._path=mi("path");u.options.className&&Nt(A,u.options.className),u.options.interactive&&Nt(A,"leaflet-interactive"),this._updateStyle(u),this._layers[c(u)]=u},_addPath:function(u){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(u._path),u.addInteractiveTarget(u._path)},_removePath:function(u){Zn(u._path),u.removeInteractiveTarget(u._path),delete this._layers[c(u)]},_updatePath:function(u){u._project(),u._update()},_updateStyle:function(u){var A=u._path,G=u.options;A&&(G.stroke?(A.setAttribute("stroke",G.color),A.setAttribute("stroke-opacity",G.opacity),A.setAttribute("stroke-width",G.weight),A.setAttribute("stroke-linecap",G.lineCap),A.setAttribute("stroke-linejoin",G.lineJoin),G.dashArray?A.setAttribute("stroke-dasharray",G.dashArray):A.removeAttribute("stroke-dasharray"),G.dashOffset?A.setAttribute("stroke-dashoffset",G.dashOffset):A.removeAttribute("stroke-dashoffset")):A.setAttribute("stroke","none"),G.fill?(A.setAttribute("fill",G.fillColor||G.color),A.setAttribute("fill-opacity",G.fillOpacity),A.setAttribute("fill-rule",G.fillRule||"evenodd")):A.setAttribute("fill","none"))},_updatePoly:function(u,A){this._setPath(u,Me(u._parts,A))},_updateCircle:function(u){var A=u._point,G=Math.max(Math.round(u._radius),1),X=Math.max(Math.round(u._radiusY),1)||G,T="a"+G+","+X+" 0 1,0 ",$=u._empty()?"M0 0":"M"+(A.x-G)+","+A.y+T+G*2+",0 "+T+-G*2+",0 ";this._setPath(u,$)},_setPath:function(u,A){u._path.setAttribute("d",A)},_bringToFront:function(u){_i(u._path)},_bringToBack:function(u){yr(u._path)}});gt.vml&&ol.include(eI);function Jg(u){return gt.svg||gt.vml?new ol(u):null}Pt.include({getRenderer:function(u){var A=u.options.renderer||this._getPaneRenderer(u.options.pane)||this.options.renderer||this._renderer;return A||(A=this._renderer=this._createRenderer()),this.hasLayer(A)||this.addLayer(A),A},_getPaneRenderer:function(u){if(u==="overlayPane"||u===void 0)return!1;var A=this._paneRenderers[u];return A===void 0&&(A=this._createRenderer({pane:u}),this._paneRenderers[u]=A),A},_createRenderer:function(u){return this.options.preferCanvas&&lh(u)||Jg(u)}});var tI=Zr.extend({initialize:function(u,A){Zr.prototype.initialize.call(this,this._boundsToLatLngs(u),A)},setBounds:function(u){return this.setLatLngs(this._boundsToLatLngs(u))},_boundsToLatLngs:function(u){return u=ue(u),[u.getSouthWest(),u.getNorthWest(),u.getNorthEast(),u.getSouthEast()]}});function dA(u,A){return new tI(u,A)}ol.create=mi,ol.pointsToPath=Me,ir.geometryToLayer=Ei,ir.coordsToLatLng=go,ir.coordsToLatLngs=Ga,ir.latLngToCoords=uo,ir.latLngsToCoords=ho,ir.getFeature=Di,ir.asFeature=mo,Pt.mergeOptions({boxZoom:!0});var mc=Js.extend({initialize:function(u){this._map=u,this._container=u._container,this._pane=u._panes.overlayPane,this._resetStateTimeout=0,u.on("unload",this._destroy,this)},addHooks:function(){wt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){hn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Zn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(u){if(!u.shiftKey||u.which!==1&&u.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),zt(),qa(),this._startPoint=this._map.mouseEventToContainerPoint(u),wt(document,{contextmenu:Ps,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(u){this._moved||(this._moved=!0,this._box=Wt("div","leaflet-zoom-box",this._container),Nt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(u);var A=new K(this._point,this._startPoint),G=A.getSize();Fn(this._box,A.min),this._box.style.width=G.x+"px",this._box.style.height=G.y+"px"},_finish:function(){this._moved&&(Zn(this._box),vn(this._container,"leaflet-crosshair")),Ji(),$a(),hn(document,{contextmenu:Ps,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(u){if(!(u.which!==1&&u.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var A=new le(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(A).fire("boxzoomend",{boxZoomBounds:A})}},_onKeyDown:function(u){u.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Pt.addInitHook("addHandler","boxZoom",mc),Pt.mergeOptions({doubleClickZoom:!0});var nI=Js.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(u){var A=this._map,G=A.getZoom(),X=A.options.zoomDelta,T=u.originalEvent.shiftKey?G-X:G+X;A.options.doubleClickZoom==="center"?A.setZoom(T):A.setZoomAround(u.containerPoint,T)}});Pt.addInitHook("addHandler","doubleClickZoom",nI),Pt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ch=Js.extend({addHooks:function(){if(!this._draggable){var u=this._map;this._draggable=new Ks(u._mapPane,u._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),u.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),u.on("zoomend",this._onZoomEnd,this),u.whenReady(this._onZoomEnd,this))}Nt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){vn(this._map._container,"leaflet-grab"),vn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var u=this._map;if(u._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var A=ue(this._map.options.maxBounds);this._offsetLimit=re(this._map.latLngToContainerPoint(A.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(A.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;u.fire("movestart").fire("dragstart"),u.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(u){if(this._map.options.inertia){var A=this._lastTime=+new Date,G=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(G),this._times.push(A),this._prunePositions(A)}this._map.fire("move",u).fire("drag",u)},_prunePositions:function(u){for(;this._positions.length>1&&u-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var u=this._map.getSize().divideBy(2),A=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=A.subtract(u).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(u,A){return u-(u-A)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var u=this._draggable._newPos.subtract(this._draggable._startPos),A=this._offsetLimit;u.x<A.min.x&&(u.x=this._viscousLimit(u.x,A.min.x)),u.y<A.min.y&&(u.y=this._viscousLimit(u.y,A.min.y)),u.x>A.max.x&&(u.x=this._viscousLimit(u.x,A.max.x)),u.y>A.max.y&&(u.y=this._viscousLimit(u.y,A.max.y)),this._draggable._newPos=this._draggable._startPos.add(u)}},_onPreDragWrap:function(){var u=this._worldWidth,A=Math.round(u/2),G=this._initialWorldOffset,X=this._draggable._newPos.x,T=(X-A+G)%u+A-G,$=(X+A+G)%u-A-G,me=Math.abs(T+G)<Math.abs($+G)?T:$;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=me},_onDragEnd:function(u){var A=this._map,G=A.options,X=!G.inertia||u.noInertia||this._times.length<2;if(A.fire("dragend",u),X)A.fire("moveend");else{this._prunePositions(+new Date);var T=this._lastPos.subtract(this._positions[0]),$=(this._lastTime-this._times[0])/1e3,me=G.easeLinearity,we=T.multiplyBy(me/$),We=we.distanceTo([0,0]),Ee=Math.min(G.inertiaMaxSpeed,We),tt=we.multiplyBy(Ee/We),St=Ee/(G.inertiaDeceleration*me),Lt=tt.multiplyBy(-St/2).round();!Lt.x&&!Lt.y?A.fire("moveend"):(Lt=A._limitOffset(Lt,A.options.maxBounds),D(function(){A.panBy(Lt,{duration:St,easeLinearity:me,noMoveStart:!0,animate:!0})}))}}});Pt.addInitHook("addHandler","dragging",ch),Pt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var dh=Js.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(u){this._map=u,this._setPanDelta(u.options.keyboardPanDelta),this._setZoomDelta(u.options.zoomDelta)},addHooks:function(){var u=this._map._container;u.tabIndex<=0&&(u.tabIndex="0"),wt(u,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),hn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var u=document.body,A=document.documentElement,G=u.scrollTop||A.scrollTop,X=u.scrollLeft||A.scrollLeft;this._map._container.focus(),window.scrollTo(X,G)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(u){var A=this._panKeys={},G=this.keyCodes,X,T;for(X=0,T=G.left.length;X<T;X++)A[G.left[X]]=[-1*u,0];for(X=0,T=G.right.length;X<T;X++)A[G.right[X]]=[u,0];for(X=0,T=G.down.length;X<T;X++)A[G.down[X]]=[0,u];for(X=0,T=G.up.length;X<T;X++)A[G.up[X]]=[0,-1*u]},_setZoomDelta:function(u){var A=this._zoomKeys={},G=this.keyCodes,X,T;for(X=0,T=G.zoomIn.length;X<T;X++)A[G.zoomIn[X]]=u;for(X=0,T=G.zoomOut.length;X<T;X++)A[G.zoomOut[X]]=-u},_addHooks:function(){wt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){hn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(u){if(!(u.altKey||u.ctrlKey||u.metaKey)){var A=u.keyCode,G=this._map,X;if(A in this._panKeys){if(!G._panAnim||!G._panAnim._inProgress)if(X=this._panKeys[A],u.shiftKey&&(X=ne(X).multiplyBy(3)),G.options.maxBounds&&(X=G._limitOffset(ne(X),G.options.maxBounds)),G.options.worldCopyJump){var T=G.wrapLatLng(G.unproject(G.project(G.getCenter()).add(X)));G.panTo(T)}else G.panBy(X)}else if(A in this._zoomKeys)G.setZoom(G.getZoom()+(u.shiftKey?3:1)*this._zoomKeys[A]);else if(A===27&&G._popup&&G._popup.options.closeOnEscapeKey)G.closePopup();else return;Ps(u)}}});Pt.addInitHook("addHandler","keyboard",dh),Pt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Wn=Js.extend({addHooks:function(){wt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){hn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(u){var A=zl(u),G=this._map.options.wheelDebounceTime;this._delta+=A,this._lastMousePos=this._map.mouseEventToContainerPoint(u),this._startTime||(this._startTime=+new Date);var X=Math.max(G-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),X),Ps(u)},_performZoom:function(){var u=this._map,A=u.getZoom(),G=this._map.options.zoomSnap||0;u._stop();var X=this._delta/(this._map.options.wheelPxPerZoomLevel*4),T=4*Math.log(2/(1+Math.exp(-Math.abs(X))))/Math.LN2,$=G?Math.ceil(T/G)*G:T,me=u._limitZoom(A+(this._delta>0?$:-$))-A;this._delta=0,this._startTime=null,me&&(u.options.scrollWheelZoom==="center"?u.setZoom(A+me):u.setZoomAround(this._lastMousePos,A+me))}});Pt.addInitHook("addHandler","scrollWheelZoom",Wn);var gh=600;Pt.mergeOptions({tapHold:gt.touchNative&&gt.safari&&gt.mobile,tapTolerance:15});var Fd=Js.extend({addHooks:function(){wt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){hn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(u){if(clearTimeout(this._holdTimeout),u.touches.length===1){var A=u.touches[0];this._startPos=this._newPos=new U(A.clientX,A.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(wt(document,"touchend",Xn),wt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",A))},this),gh),wt(document,"touchend touchcancel contextmenu",this._cancel,this),wt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function u(){hn(document,"touchend",Xn),hn(document,"touchend touchcancel",u)},_cancel:function(){clearTimeout(this._holdTimeout),hn(document,"touchend touchcancel contextmenu",this._cancel,this),hn(document,"touchmove",this._onMove,this)},_onMove:function(u){var A=u.touches[0];this._newPos=new U(A.clientX,A.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(u,A){var G=new MouseEvent(u,{bubbles:!0,cancelable:!0,view:window,screenX:A.screenX,screenY:A.screenY,clientX:A.clientX,clientY:A.clientY});G._simulated=!0,A.target.dispatchEvent(G)}});Pt.addInitHook("addHandler","tapHold",Fd),Pt.mergeOptions({touchZoom:gt.touch,bounceAtZoomLimits:!0});var Ic=Js.extend({addHooks:function(){Nt(this._map._container,"leaflet-touch-zoom"),wt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){vn(this._map._container,"leaflet-touch-zoom"),hn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(u){var A=this._map;if(!(!u.touches||u.touches.length!==2||A._animatingZoom||this._zooming)){var G=A.mouseEventToContainerPoint(u.touches[0]),X=A.mouseEventToContainerPoint(u.touches[1]);this._centerPoint=A.getSize()._divideBy(2),this._startLatLng=A.containerPointToLatLng(this._centerPoint),A.options.touchZoom!=="center"&&(this._pinchStartLatLng=A.containerPointToLatLng(G.add(X)._divideBy(2))),this._startDist=G.distanceTo(X),this._startZoom=A.getZoom(),this._moved=!1,this._zooming=!0,A._stop(),wt(document,"touchmove",this._onTouchMove,this),wt(document,"touchend touchcancel",this._onTouchEnd,this),Xn(u)}},_onTouchMove:function(u){if(!(!u.touches||u.touches.length!==2||!this._zooming)){var A=this._map,G=A.mouseEventToContainerPoint(u.touches[0]),X=A.mouseEventToContainerPoint(u.touches[1]),T=G.distanceTo(X)/this._startDist;if(this._zoom=A.getScaleZoom(T,this._startZoom),!A.options.bounceAtZoomLimits&&(this._zoom<A.getMinZoom()&&T<1||this._zoom>A.getMaxZoom()&&T>1)&&(this._zoom=A._limitZoom(this._zoom)),A.options.touchZoom==="center"){if(this._center=this._startLatLng,T===1)return}else{var $=G._add(X)._divideBy(2)._subtract(this._centerPoint);if(T===1&&$.x===0&&$.y===0)return;this._center=A.unproject(A.project(this._pinchStartLatLng,this._zoom).subtract($),this._zoom)}this._moved||(A._moveStart(!0,!1),this._moved=!0),z(this._animRequest);var me=o(A._move,A,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=D(me,this,!0),Xn(u)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,z(this._animRequest),hn(document,"touchmove",this._onTouchMove,this),hn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Pt.addInitHook("addHandler","touchZoom",Ic),Pt.BoxZoom=mc,Pt.DoubleClickZoom=nI,Pt.Drag=ch,Pt.Keyboard=dh,Pt.ScrollWheelZoom=Wn,Pt.TapHold=Fd,Pt.TouchZoom=Ic,t.Bounds=K,t.Browser=gt,t.CRS=ie,t.Canvas=oh,t.Circle=lo,t.CircleMarker=oo,t.Class=E,t.Control=Bs,t.DivIcon=Xg,t.DivOverlay=C,t.DomEvent=no,t.DomUtil=ya,t.Draggable=Ks,t.Evented=de,t.FeatureGroup=Sr,t.GeoJSON=ir,t.GridLayer=Io,t.Handler=Js,t.Icon=hi,t.ImageOverlay=Er,t.LatLng=ae,t.LatLngBounds=le,t.Layer=Os,t.LayerGroup=Hr,t.LineUtil=nc,t.Map=Pt,t.Marker=wr,t.Mixin=zo,t.Path=Tr,t.Point=U,t.PolyUtil=Zd,t.Polygon=Zr,t.Polyline=Ns,t.Popup=jg,t.PosAnimation=so,t.Projection=Rd,t.Rectangle=tI,t.Renderer=Li,t.SVG=ol,t.SVGOverlay=il,t.TileLayer=Co,t.Tooltip=gc,t.Transformation=Be,t.Util=O,t.VideoOverlay=rl,t.bind=o,t.bounds=re,t.canvas=lh,t.circle=Za,t.circleMarker=ac,t.control=Mr,t.divIcon=qm,t.extend=i,t.featureGroup=rc,t.geoJSON=oc,t.geoJson=zs,t.gridLayer=uc,t.icon=ic,t.imageOverlay=lc,t.latLng=Ce,t.latLngBounds=ue,t.layerGroup=wa,t.map=Fr,t.marker=_d,t.point=ne,t.polygon=Xd,t.polyline=jd,t.popup=dc,t.rectangle=dA,t.setOptions=x,t.stamp=c,t.svg=Jg,t.svgOverlay=al,t.tileLayer=ah,t.tooltip=Jd,t.transformation=Se,t.version=s,t.videoOverlay=cc;var sI=window.L;t.noConflict=function(){return window.L=sI,this},window.L=t}))})(om,om.exports)),om.exports}var kue=Nue();const Kn=rd(kue),Rue=({events:n,users:e})=>{const t=k.useRef(null),s=k.useRef(null),i=k.useRef(Kn.layerGroup()),a=k.useRef(null),{theme:o}=Fl();return k.useEffect(()=>{s.current&&!t.current&&(t.current=Kn.map(s.current,{zoomControl:!1}).setView([12.9716,77.5946],12),i.current.addTo(t.current),Kn.control.zoom({position:"bottomright"}).addTo(t.current)),setTimeout(()=>t.current?.invalidateSize(),100)},[]),k.useEffect(()=>{if(!t.current)return;const l=o==="dark",h=l?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",m=l?'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>':'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';a.current?(a.current.setUrl(h),t.current.attributionControl.setPrefix(m)):a.current=Kn.tileLayer(h,{attribution:m}).addTo(t.current)},[o]),k.useEffect(()=>{i.current.clearLayers();const l=new Map;n.forEach(h=>{if(h.latitude&&h.longitude){const m=l.get(h.userId);(!m||new Date(h.timestamp)>new Date(m.timestamp))&&l.set(h.userId,h)}});const c=new Map(e.map(h=>[h.id,h])),d=[];if(l.forEach(h=>{const m=c.get(h.userId);if(m&&h.latitude&&h.longitude){const f=Kn.divIcon({className:"",html:`<div class="user-marker" style="background-image: url(${m.photoUrl||`https://i.pravatar.cc/150?u=${m.id}`})"></div>`,iconSize:[48,48],iconAnchor:[24,56],popupAnchor:[0,-56]}),p=Kn.marker([h.latitude,h.longitude],{icon:f});p.bindPopup(`
                    <div class="user-marker-popup">
                        <p class="popup-name">${m.name}</p>
                        <p class="popup-time">Last seen: ${He(new Date(h.timestamp),"hh:mm a")}</p>
                    </div>
                `),i.current.addLayer(p),d.push(p)}}),d.length>0&&t.current){const h=Kn.featureGroup(d);t.current.fitBounds(h.getBounds().pad(.5))}else t.current&&t.current.setView([12.9716,77.5946],12)},[n,e]),r.jsx("div",{ref:s,style:{height:"600px",width:"100%",borderRadius:"1rem",zIndex:0}})},Wue=({events:n,selectedUser:e})=>{const t=k.useRef(null),s=k.useRef(null),i=k.useRef(null),a=k.useRef(null),o=k.useRef(Kn.layerGroup()),l=k.useRef(null),{theme:c}=Fl(),d=k.useMemo(()=>n.filter(h=>h.userId===e&&h.latitude&&h.longitude).sort((h,m)=>new Date(h.timestamp).getTime()-new Date(m.timestamp).getTime()),[n,e]);return k.useEffect(()=>{s.current&&!t.current&&(t.current=Kn.map(s.current,{zoomControl:!1}).setView([12.9716,77.5946],12),o.current.addTo(t.current),Kn.control.zoom({position:"bottomright"}).addTo(t.current)),setTimeout(()=>t.current?.invalidateSize(),100)},[]),k.useEffect(()=>{if(!t.current)return;const h=c==="dark",p=h?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",b=h?'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>':'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';l.current?(l.current.setUrl(p),t.current.attributionControl.setPrefix(b)):l.current=Kn.tileLayer(p,{attribution:b}).addTo(t.current)},[c]),k.useEffect(()=>{if(!t.current)return;if(o.current.clearLayers(),i.current&&(t.current.removeLayer(i.current),i.current=null),a.current&&(t.current.removeLayer(a.current),a.current=null),d.length===0){t.current.setView([12.9716,77.5946],12);return}const h=d.map(_=>[_.latitude,_.longitude]);i.current=Kn.polyline(h,{color:"#00BFA6",weight:4}).addTo(t.current);const m=h[0],f=h[h.length-1],p=Kn.marker(m,{icon:Kn.divIcon({className:"",html:'<div style="width:16px;height:16px;border-radius:50%;background-color:#00BFA6;border:2px solid white;"></div>',iconSize:[16,16],iconAnchor:[8,8]})}),b=Kn.marker(f,{icon:Kn.divIcon({className:"",html:'<div style="width:16px;height:16px;border-radius:50%;background-color:#EF4444;border:2px solid white;"></div>',iconSize:[16,16],iconAnchor:[8,8]})});o.current.addLayer(p),o.current.addLayer(b);let x=h[0][0],v=h[0][0],S=h[0][1],B=h[0][1];h.forEach(([_,Y])=>{x=Math.min(x,_),v=Math.max(v,_),S=Math.min(S,Y),B=Math.max(B,Y)});const V=[x,S],R=[v,B];a.current=Kn.rectangle([V,R],{color:"#FFB700",weight:2,fillOpacity:.1}).addTo(t.current);const W=Kn.latLngBounds(V,R);t.current.fitBounds(W.pad(.2))},[d]),r.jsx("div",{ref:s,style:{height:"600px",width:"100%",borderRadius:"1rem",zIndex:0}})},Vue=({event:n})=>r.jsxs("div",{className:"bg-card rounded-2xl border border-border overflow-hidden shadow-sm",children:[r.jsxs("div",{className:"p-3 bg-page flex justify-between items-center",children:[r.jsx("span",{className:"text-sm font-medium text-muted",children:"User"}),r.jsx("span",{className:"font-semibold text-primary-text",children:n.userName})]}),r.jsxs("div",{className:"p-3 space-y-3 text-sm",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-muted font-medium",children:"Event"}),r.jsx("span",{className:"font-semibold capitalize text-primary-text",children:n.type.replace("-"," ")})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-muted font-medium",children:"Timestamp"}),r.jsx("span",{className:"text-primary-text",children:He(new Date(n.timestamp),"dd MMM, yy - hh:mm a")})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-muted font-medium",children:"Location"}),n.latitude&&n.longitude?r.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${n.latitude},${n.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-accent hover:underline",children:[r.jsx(Bi,{className:"h-4 w-4 mr-1"})," View on Map"]}):r.jsx("span",{className:"text-primary-text",children:"-"})]})]})]}),FY=()=>{const[n,e]=k.useState("list"),[t,s]=k.useState([]),[i,a]=k.useState([]),[o,l]=k.useState(!0),[c,d]=k.useState(He(new Date,"yyyy-MM-dd")),[h,m]=k.useState(He(new Date,"yyyy-MM-dd")),[f,p]=k.useState("all"),b=jt("(max-width: 767px)"),x=k.useMemo(()=>i.filter(R=>R.role==="field_officer"),[i]),v=k.useCallback(async()=>{l(!0);try{const R=new Date(c);R.setHours(0,0,0,0);const W=new Date(h);W.setHours(23,59,59,999);const[_,Y]=await Promise.all([ce.getAllAttendanceEvents(R.toISOString(),W.toISOString()),ce.getUsers()]);s(_),a(Y)}catch(R){console.error("Failed to fetch tracking data",R)}finally{l(!1)}},[c,h]);k.useEffect(()=>{v()},[v]);const S=k.useMemo(()=>{let R=t;f!=="all"&&(R=R.filter(_=>_.userId===f));const W=new Map(i.map(_=>[_.id,_]));return R.map(_=>({..._,userName:W.get(_.userId)?.name||"Unknown User"})).sort((_,Y)=>new Date(Y.timestamp).getTime()-new Date(_.timestamp).getTime())},[t,i,f]),B=k.useMemo(()=>{const R=new Set(S.map(W=>W.userId));return i.filter(W=>R.has(W.id))},[S,i]),V=()=>o?r.jsx("div",{className:"flex justify-center items-center h-96",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):n==="map"?r.jsx(Rue,{events:S,users:B}):n==="route"?f==="all"?r.jsx("div",{className:"text-center py-10 text-muted",children:"Please select a specific user to view their route coverage."}):r.jsx(Wue,{events:S,selectedUser:f}):b?r.jsx("div",{className:"space-y-3",children:S.length===0?r.jsx("div",{className:"text-center py-10 text-muted",children:"No events found."}):S.map(R=>r.jsx(Vue,{event:R},R.id))}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-border responsive-table",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"User"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Event"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Timestamp"}),r.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-muted uppercase",children:"Location"})]})}),r.jsx("tbody",{children:S.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:4,className:"text-center py-10 text-muted",children:"No events found."})}):S.map(R=>r.jsxs("tr",{children:[r.jsx("td",{"data-label":"User",className:"px-6 py-4 whitespace-nowrap font-medium",children:R.userName}),r.jsx("td",{"data-label":"Event",className:"px-6 py-4 whitespace-nowrap capitalize",children:R.type.replace("-"," ")}),r.jsx("td",{"data-label":"Timestamp",className:"px-6 py-4 whitespace-nowrap text-sm text-muted",children:He(new Date(R.timestamp),"dd MMM, yyyy - hh:mm a")}),r.jsx("td",{"data-label":"Location",className:"px-6 py-4 whitespace-nowrap text-sm text-muted",children:R.latitude&&R.longitude?r.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${R.latitude},${R.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center md:justify-start justify-end text-accent hover:underline",children:[r.jsx(Bi,{className:"h-4 w-4 mr-1"})," View on Map"]}):"-"})]},R.id))})]})});return r.jsxs("div",{className:"p-4 border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text flex-shrink-0",children:"User Activity Tracking"}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 w-full sm:w-auto justify-end flex-wrap",children:[r.jsx("div",{className:"w-full sm:w-40",children:r.jsx(Vn,{label:"",id:"start-date",value:c,onChange:d})}),r.jsx("div",{className:"w-full sm:w-40",children:r.jsx(Vn,{label:"",id:"end-date",value:h,onChange:m})}),r.jsx("div",{className:"w-full sm:w-48",children:r.jsxs(Oe,{label:"",id:"user-select",value:f,onChange:R=>p(R.target.value),children:[r.jsx("option",{value:"all",children:"All Users"}),x.map(R=>r.jsx("option",{value:R.id,children:R.name},R.id))]})})]})]}),r.jsx("div",{className:"mt-4",children:r.jsxs("div",{className:"bg-page p-1 rounded-full flex items-center w-fit",children:[r.jsxs("button",{onClick:()=>e("list"),className:`px-3 py-1 text-sm font-semibold rounded-full flex items-center gap-2 transition-colors duration-200 ${n==="list"?"bg-accent text-white shadow-sm":"text-muted hover:text-primary-text"}`,children:[r.jsx(l$,{className:"h-4 w-4"}),"List View"]}),r.jsxs("button",{onClick:()=>e("map"),className:`px-3 py-1 text-sm font-semibold rounded-full flex items-center gap-2 transition-colors duration-200 ${n==="map"?"bg-accent text-white shadow-sm":"text-muted hover:text-primary-text"}`,children:[r.jsx(fH,{className:"h-4 w-4"}),"Map View"]}),r.jsxs("button",{onClick:()=>e("route"),className:`px-3 py-1 text-sm font-semibold rounded-full flex items-center gap-2 transition-colors duration-200 ${n==="route"?"bg-accent text-white shadow-sm":"text-muted hover:text-primary-text"}`,children:[r.jsx(f$,{className:"h-4 w-4"}),"Route View"]})]})})]}),r.jsx("div",{className:"mt-6",children:V()})]})},_ue=(n,e,t,s)=>{const a=n*Math.PI/180,o=t*Math.PI/180,l=(t-n)*Math.PI/180,c=(s-e)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},jue=()=>{const{user:n}=bt(),{colorScheme:e}=an(),t=Is(e),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState(""),[d,h]=k.useState("100"),[m,f]=k.useState(""),[p,b]=k.useState(""),[x,v]=k.useState(""),[S,B]=k.useState(""),[V,R]=k.useState([]),[W,_]=k.useState(!0),[Y,j]=k.useState(null),[M,H]=k.useState(null);k.useEffect(()=>{(async()=>{try{const[ne,K]=await Promise.all([ce.getLocations(),ce.getUsers()]);i(ne),o(K)}catch(ne){console.error(ne),j({message:"Failed to load locations or users.",type:"error"})}finally{_(!1)}})()},[]);const D=ot.useMemo(()=>{const P=new Map;return a.forEach(ne=>P.set(ne.id,ne.name)),P},[a]),z=async()=>{try{const P=await ce.getLocations();i(P)}catch(P){console.error(P),j({message:"Failed to refresh locations.",type:"error"})}},O=async()=>{try{const P=await vp(),{latitude:ne,longitude:K}=P.coords;f(ne.toString()),b(K.toString());try{const re=await wm(ne,K);x||v(re),l||c(re)}catch(re){console.warn("Reverse geocode failed",re)}}catch(P){console.error(P),j({message:"Unable to retrieve current location.",type:"error"})}},E=async()=>{const P=parseFloat(d),ne=parseFloat(m),K=parseFloat(p);if(isNaN(P)||P<10||P>1e3){j({message:"Radius must be between 10 and 1000 meters.",type:"error"});return}if(isNaN(ne)||isNaN(K)){j({message:"Please provide valid latitude and longitude.",type:"error"});return}try{const re=x||await wm(ne,K);if(!M&&s.some(ue=>_ue(ne,K,ue.latitude,ue.longitude)<10)){j({message:"A location already exists at these coordinates. Please use a different location.",type:"error"});return}M?(await ce.updateLocation(M,{name:l||re,latitude:ne,longitude:K,radius:P,address:re}),j({message:"Location updated successfully.",type:"success"}),H(null)):(await ce.createLocation({name:l||re,latitude:ne,longitude:K,radius:P,address:re,createdBy:n?.id||null}),j({message:"Location created successfully.",type:"success"})),c(""),h("100"),f(""),b(""),v(""),await z()}catch(re){console.error(re);const le=re?.message||(M?"Failed to update location.":"Failed to create location.");j({message:le,type:"error"})}},te=async()=>{if(!S||V.length===0){j({message:"Please select a user and at least one location.",type:"error"});return}try{await Promise.all(V.map(P=>ce.assignLocationToUser(S,P))),j({message:"Location(s) assigned to user.",type:"success"}),B(""),R([])}catch(P){console.error(P),j({message:"Failed to assign location(s).",type:"error"})}},q=P=>{H(P.id),c(P.name||""),h(P.radius.toString()),f(P.latitude.toString()),b(P.longitude.toString()),v(P.address||""),window.scrollTo({top:0,behavior:"smooth"})},de=()=>{H(null),c(""),h("100"),f(""),b(""),v("")},U=async P=>{if(window.confirm("Are you sure you want to delete this location? This will remove it from all users and the database."))try{await ce.deleteLocation(P),j({message:"Location deleted successfully from all users and database.",type:"success"}),await z()}catch(ne){console.error(ne);const K=ne?.message||"Failed to delete location.";j({message:K,type:"error"})}};return r.jsxs("div",{className:"p-4 md:p-6 w-full",children:[Y&&r.jsx(It,{message:Y.message,type:Y.type,onDismiss:()=>j(null)}),r.jsxs("div",{className:"border-0 shadow-none md:bg-card md:p-6 md:rounded-xl md:shadow-card",children:[r.jsx(ma,{title:"Location Management"}),r.jsx("p",{className:"text-muted -mt-4 mb-6",children:"Define geofenced locations and assign them to staff. Only checkins within these locations will be accepted."})]}),r.jsxs("div",{className:"mt-6 space-y-6",children:[r.jsxs("section",{className:"bg-card border border-border rounded-lg p-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(Bi,{className:"h-5 w-5 mr-2 text-muted"})," ",M?"Edit Location":"Add New Location"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsx(be,{label:"Name (optional)",id:"locName",value:l,onChange:P=>c(P.target.value),placeholder:"e.g. Office HQ"}),r.jsx(be,{label:"Radius (meters)",id:"locRadius",type:"number",value:d,onChange:P=>h(P.target.value),min:"10",max:"1000"}),r.jsx(be,{label:"Latitude",id:"locLat",type:"number",value:m,onChange:P=>f(P.target.value),placeholder:"12.9716"}),r.jsx(be,{label:"Longitude",id:"locLng",type:"number",value:p,onChange:P=>b(P.target.value),placeholder:"77.5946"}),r.jsx(be,{label:"Address (optional)",id:"locAddr",value:x,onChange:P=>v(P.target.value),placeholder:"Street, City, State"})]}),r.jsxs("div",{className:"flex flex-wrap mt-4 gap-4",children:[r.jsxs(se,{variant:"secondary",onClick:O,children:[r.jsx(pH,{className:"h-4 w-4 mr-2"})," Use Current Location"]}),M?r.jsxs(r.Fragment,{children:[r.jsxs(se,{onClick:E,children:[r.jsx(fr,{className:"h-4 w-4 mr-2"})," Save Changes"]}),r.jsx(se,{variant:"secondary",onClick:de,children:"Cancel"})]}):r.jsxs(se,{onClick:E,children:[r.jsx(Tt,{className:"h-4 w-4 mr-2"})," Add Location"]})]})]}),r.jsxs("section",{className:"bg-card border border-border rounded-lg p-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(Ni,{className:"h-5 w-5 mr-2 text-muted"})," Assign Location to User"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs(Oe,{label:"Select User",id:"assignUser",value:S,onChange:P=>B(P.target.value),children:[r.jsx("option",{value:"",children:"-- Select User --"}),a.map(P=>r.jsx("option",{value:P.id,children:P.name},P.id))]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Select Location(s)"}),r.jsx("div",{className:"border border-border rounded-lg p-3 max-h-48 overflow-y-auto bg-page",children:s.length===0?r.jsx("p",{className:"text-muted text-sm",children:"No locations available."}):s.map(P=>r.jsxs("label",{className:"flex items-center justify-start gap-2 py-1 text-sm",children:[r.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-accent border-gray-300 rounded",checked:V.includes(P.id),onChange:ne=>{R(K=>ne.target.checked?[...K,P.id]:K.filter(re=>re!==P.id))}}),r.jsx("span",{children:P.name||P.address||`${P.latitude.toFixed(4)}, ${P.longitude.toFixed(4)}`})]},P.id))})]})]}),r.jsx("div",{className:"flex justify-end mt-4",children:r.jsxs(se,{onClick:te,className:"w-full md:w-auto",children:[r.jsx(fr,{className:"h-4 w-4 mr-2"})," Assign"]})})]}),r.jsxs("section",{children:[r.jsxs("h3",{className:"text-xl font-semibold text-primary-text mb-4 flex items-center",children:[r.jsx(Bi,{className:"h-5 w-5 mr-2 text-muted"})," Existing Locations"]}),W?r.jsx("p",{children:"Loading..."}):s.length===0?r.jsx("p",{className:"text-muted text-center md:text-left",children:"No locations defined yet."}):r.jsxs("div",{className:"space-y-4 md:space-y-0",children:[r.jsx("div",{className:"md:hidden space-y-4",children:s.map(P=>r.jsxs("div",{className:"bg-card rounded-lg shadow-card p-4 border border-border",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-bold text-primary-text",children:P.name||"Unnamed Location"}),r.jsx("p",{className:"text-sm text-muted",children:P.address})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{type:"button",className:"p-1 text-accent hover:opacity-70 transition-opacity",style:{color:t.primary},title:"Edit",onClick:()=>q(P),children:r.jsx(ms,{className:"h-5 w-5"})}),r.jsx("button",{type:"button",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",title:"Delete",onClick:()=>U(P.id),children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Radius"}),r.jsxs("p",{children:[P.radius,"m"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Coordinates"}),r.jsxs("p",{children:[P.latitude.toFixed(4),", ",P.longitude.toFixed(4)]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Created By"}),r.jsx("p",{children:P.createdByName||D.get(P.createdBy||"")||"-"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-muted",children:"Created At"}),r.jsx("p",{children:P.createdAt?new Date(P.createdAt).toLocaleDateString():"-"})]})]})]},P.id))}),r.jsx("div",{className:"hidden md:block overflow-x-auto border border-border rounded-lg",children:r.jsxs("table",{className:"min-w-full border-collapse text-sm",children:[r.jsx("thead",{className:"bg-page text-primary-text",children:r.jsxs("tr",{children:[r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Name"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Radius (m)"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Coordinates"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Address"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Created By"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Created At"}),r.jsx("th",{className:"p-3 border-b border-border text-left",children:"Actions"})]})}),r.jsx("tbody",{children:s.map(P=>r.jsxs("tr",{className:"border-b border-border",children:[r.jsx("td",{className:"p-3",children:P.name||"-"}),r.jsx("td",{className:"p-3",children:P.radius}),r.jsxs("td",{className:"p-3",children:[P.latitude.toFixed(4),", ",P.longitude.toFixed(4)]}),r.jsx("td",{className:"p-3",children:P.address||"-"}),r.jsx("td",{className:"p-3",children:P.createdByName||D.get(P.createdBy||"")||"-"}),r.jsx("td",{className:"p-3",children:P.createdAt?new Date(P.createdAt).toLocaleString():"-"}),r.jsxs("td",{className:"p-3 whitespace-nowrap",children:[r.jsx("button",{type:"button",className:"mr-3 text-accent hover:opacity-70 transition-opacity",style:{color:t.primary},title:"Edit",onClick:()=>q(P),children:r.jsx(ms,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",className:"p-2 hover:bg-red-500/10 rounded-full transition-colors",title:"Delete",onClick:()=>U(P.id),children:r.jsx(rn,{className:"h-5 w-5 text-red-500"})})]})]},P.id))})]})})]})]})]})]})},Xue=({isOpen:n,onClose:e,onOverride:t,employeeName:s,bankName:i,reason:a})=>n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60","aria-modal":"true",role:"dialog",children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-lg m-4 animate-fade-in-scale",children:[r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-full bg-red-100",children:r.jsx(ca,{className:"h-6 w-6 text-red-600"})}),r.jsxs("div",{className:"ml-4 flex-1",children:[r.jsx("h3",{className:"text-lg font-bold text-primary-text",children:"Verification Alert: Name Mismatch Found"}),r.jsxs("div",{className:"mt-2 text-sm text-muted space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Name on ID:"}),' "',s,'"']}),r.jsxs("p",{children:[r.jsx("strong",{children:"Name on Bank Proof:"}),' "',i,'"']}),a&&r.jsxs("p",{className:"mt-2 p-2 bg-page rounded-md",children:[r.jsx("strong",{children:"AI Analysis:"})," ",r.jsx("em",{children:a})]}),r.jsx("p",{className:"mt-2",children:"Please upload the correct documents. If the names are different for a valid reason (e.g., maiden name), you can override this warning, but it will require manual verification by an administrator."})]})]})]}),r.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row-reverse gap-3",children:[r.jsx(se,{onClick:t,variant:"danger",children:"Override & Proceed"}),r.jsx(se,{onClick:e,variant:"secondary",children:"Re-upload Documents"})]})]})}):null,Jue={documents:{aadhaar:!0,pan:!0,bankProof:!0,educationCertificate:!0,salarySlip:!0,uanProof:!0,familyAadhaar:!0},verifications:{requireBengaluruAddress:!0,requireDobVerification:!0}},Yue=n=>{const e=Bt({id:pe().required(),relation:pe().oneOf(["Spouse","Child","Father","Mother",""]).required("Relation is required"),phone:pe().when("relation",{is:"Child",then:s=>s.optional().nullable().matches(/^[6-9][0-9]{9}$/,{message:"Must be a valid 10-digit number",excludeEmptyString:!0}),otherwise:s=>s.required("Phone number is required").matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit Indian number")}),idProof:n.documents.familyAadhaar?Et().nonNullable("Aadhaar proof is required for each family member."):Et().optional().nullable()}),t=Bt({id:pe().required(),document:n.documents.educationCertificate?Et().nonNullable("Education certificate is required."):Et().optional().nullable()});return Bt({photo:Et().optional().nullable(),aadhaarLinkedMobile:pe().required("Aadhaar-linked mobile number is required.").matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit number"),alternateMobile:pe().optional().nullable().matches(/^[6-9][0-9]{9}$/,{message:"Must be a valid 10-digit number",excludeEmptyString:!0}),idProofType:pe().oneOf(["Aadhaar","PAN","Voter ID",""]).required(),idProofFront:Et().nonNullable("Aadhaar (Front) is required."),idProofBack:Et().nonNullable("Aadhaar (Back) is required."),bankProof:Et().nonNullable("Bank proof document is required."),uanProof:Et().nonNullable("UAN proof document is required."),salarySlip:n.documents.salarySlip?Et().nonNullable("Salary slip is required."):Et().optional().nullable(),family:Rr().of(e).optional(),education:Rr().of(t).optional()}).defined()},ag=n=>new Promise((e,t)=>{const s=new FileReader;s.readAsDataURL(n),s.onload=()=>e({base64:s.result.split(",")[1],type:n.type}),s.onerror=i=>t(i)}),Qh=n=>n?n.toLowerCase().replace(/\b(\w)/g,e=>e.toUpperCase()):"",Fue=()=>{const n=vt(),e=Qn(),{user:t}=bt(),{rulesByDesignation:s}=dd(),[i,a]=k.useState(!1),[o,l]=k.useState(null),[c,d]=k.useState({isOpen:!1,employeeName:"",bankName:"",reason:""}),[h,m]=k.useState(window.innerWidth<768),f=e.data.organization.designation,p=k.useMemo(()=>f&&s[f]?s[f]:Jue,[f,s]),b=k.useMemo(()=>Yue(p),[p]);k.useEffect(()=>{const E=()=>m(window.innerWidth<768);return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),t?.role;const{control:x,handleSubmit:v,formState:{errors:S},getValues:B,watch:V}=tn({resolver:Yn(b),defaultValues:{aadhaarLinkedMobile:"",alternateMobile:"",photo:null,idProofType:"Aadhaar",idProofFront:null,idProofBack:null,bankProof:null,salarySlip:null,uanProof:null,family:[],education:[]}}),{fields:R,append:W,remove:_}=Wr({control:x,name:"family"}),{fields:Y,append:j,remove:M}=Wr({control:x,name:"education"});V("idProofType");const H=V("family"),D=async(E,te=!1)=>{a(!0),e.setRequiresManualVerification(te);try{const q={type:$e.OBJECT,properties:{name:{type:$e.STRING,description:"The person's full name as written on the card."},dob:{type:$e.STRING,description:"The person's date of birth in YYYY-MM-DD format. If only year available, return YYYY-01-01."},gender:{type:$e.STRING,description:"Gender: 'Male', 'Female', or 'Other'."},aadhaarNumber:{type:$e.STRING,description:"The 12-digit Aadhaar number, if present."},panNumber:{type:$e.STRING,description:"The 10-character PAN number, if present."},voterIdNumber:{type:$e.STRING,description:"The Voter ID number, also known as EPIC number."}}},de={type:$e.OBJECT,properties:{address:{type:$e.OBJECT,description:"The full address on the back of an Aadhaar card, parsed into components.",properties:{line1:{type:$e.STRING,description:"Full address line(s) excluding city, state, pincode. e.g., 'S/O: John Doe, 123 Maple Street, Anytown'"},city:{type:$e.STRING},state:{type:$e.STRING},pincode:{type:$e.STRING}}}}},U={type:$e.OBJECT,properties:{accountHolderName:{type:$e.STRING,description:"The account holder's full name."},accountNumber:{type:$e.STRING,description:"The full bank account number."},ifscCode:{type:$e.STRING,description:"The bank's IFSC code."},bankName:{type:$e.STRING,description:"The name of the bank (e.g., 'State Bank of India')."},branchName:{type:$e.STRING,description:"The name of the bank branch (e.g., 'Koramangala Branch')."}}},P={type:$e.OBJECT,properties:{uanNumber:{type:$e.STRING,description:"The 12-digit Universal Account Number (UAN)."},pfNumber:{type:$e.STRING,description:"The Provident Fund (PF) account number."},esiNumber:{type:$e.STRING,description:"The 10 or 17-digit ESI number."}}},ne={type:$e.OBJECT,properties:{uanNumber:{type:$e.STRING}}},K={type:$e.OBJECT,properties:{name:{type:$e.STRING},dob:{type:$e.STRING}}},re={type:$e.OBJECT,properties:{degree:{type:$e.STRING},institution:{type:$e.STRING},endYear:{type:$e.STRING}}},le=[E.idProofFront?ag(E.idProofFront.file):Promise.resolve(null),(E.idProofType==="Aadhaar"||E.idProofType==="Voter ID")&&E.idProofBack?ag(E.idProofBack.file):Promise.resolve(null),E.bankProof?ag(E.bankProof.file):Promise.resolve(null),E.salarySlip?ag(E.salarySlip.file):Promise.resolve(null),E.uanProof?ag(E.uanProof.file):Promise.resolve(null),...E.family.map(it=>it.idProof?ag(it.idProof.file):Promise.resolve(null)),...E.education.map(it=>it.document?ag(it.document.file):Promise.resolve(null))],[ue,ae,Ce,ie,ge,...xe]=await Promise.all(le),_e=xe.slice(0,E.family.length),Be=xe.slice(E.family.length),Se=ue?ce.extractDataFromImage(ue.base64,ue.type,q,E.idProofType):Promise.resolve({}),Re=ae&&E.idProofType==="Aadhaar"?ce.extractDataFromImage(ae.base64,ae.type,de,"Aadhaar"):Promise.resolve({}),Ye=Ce?ce.extractDataFromImage(Ce.base64,Ce.type,U,"Bank"):Promise.resolve({}),De=ie?ce.extractDataFromImage(ie.base64,ie.type,P,"Salary"):Promise.resolve(null),Me=ge?ce.extractDataFromImage(ge.base64,ge.type,ne,"UAN"):Promise.resolve(null),Le=_e.map(it=>it?ce.extractDataFromImage(it.base64,it.type,K,"Aadhaar"):Promise.resolve({})),nt=Be.map(it=>it?ce.extractDataFromImage(it.base64,it.type,re):Promise.resolve({})),[st,ee,oe,Ie,Ne,...Ge]=await Promise.all([Se,Re,Ye,De,Me,...Le,...nt]),je=Ge.slice(0,_e.length),Fe=Ge.slice(_e.length),ze={...st,...ee},lt=ze.name||"",Dt=oe.accountHolderName||"";if(!te&&lt&&Dt){const{isMatch:it,reason:pn}=await ce.crossVerifyNames(lt,Dt);if(!it){d({isOpen:!0,employeeName:lt,bankName:Dt,reason:pn}),a(!1);return}}const kt={idProofType:E.idProofType,idProofFront:E.idProofFront,idProofBack:E.idProofBack,photo:E.photo,mobile:E.aadhaarLinkedMobile,alternateMobile:E.alternateMobile},$t={};if(ze.name){const it=ze.name.split(" ");kt.firstName=Qh(it.shift()||""),kt.lastName=Qh(it.pop()||""),kt.middleName=Qh(it.join(" ")),kt.preferredName=kt.firstName,$t.name=!0}if(ze.dob)try{kt.dob=He(new Date(ze.dob.replace(/[-./]/g,"/")),"yyyy-MM-dd"),$t.dob=!0}catch{}if(ze.gender){const it=ze.gender.toLowerCase().trim();it.includes("male")||it.includes("purush")||it==="m"?kt.gender="Male":it.includes("female")||it.includes("mahila")||it==="f"?kt.gender="Female":it.includes("transgender")&&(kt.gender="Other")}(ze.aadhaarNumber||ze.panNumber||ze.voterIdNumber)&&(kt.idProofNumber=(ze.aadhaarNumber||ze.panNumber||ze.voterIdNumber).replace(/\s/g,""),$t.idProofNumber=!0);const wn={bankProof:E.bankProof},Rt={};if(oe.accountHolderName&&(wn.accountHolderName=Qh(oe.accountHolderName),Rt.accountHolderName=!0),oe.accountNumber){const it=oe.accountNumber.replace(/\D/g,"");wn.accountNumber=it,wn.confirmAccountNumber=it,Rt.accountNumber=!0}oe.ifscCode&&(wn.ifscCode=oe.ifscCode.toUpperCase().replace(/\s/g,""),Rt.ifscCode=!0),oe.bankName&&(wn.bankName=oe.bankName),oe.branchName&&(wn.branchName=oe.branchName);const cn={salarySlip:E.salarySlip,document:E.uanProof},en={},on={},Ut={},dn=Ne?.uanNumber||Ie?.uanNumber;if(dn){const it=dn.replace(/\D/g,"");it.length===12&&(cn.uanNumber=it,cn.hasPreviousPf=!0,on.uanNumber=!0)}if(Ie?.pfNumber&&(cn.pfNumber=Ie.pfNumber,cn.hasPreviousPf=!0),Ie?.esiNumber){const it=Ie.esiNumber.replace(/\D/g,"");(it.length===10||it.length===17)&&(en.esiNumber=it,en.hasEsi=!0,Ut.esiNumber=!0)}const fn=je.map((it,pn)=>{const un=E.family[pn];let ls="";if(it.dob)try{ls=He(new Date(it.dob.replace(/[-./]/g,"/")),"yyyy-MM-dd")}catch{}return{id:`fam_preupload_${Date.now()}_${pn}`,relation:un.relation,name:Qh(it.name)||"",dob:ls,gender:"",occupation:"",dependent:!1,idProof:un.idProof,phone:un.phone}}),Ft=Fe.map((it,pn)=>{const un=E.education[pn];return{id:`edu_preupload_${Date.now()}_${pn}`,degree:it.degree||"",institution:it.institution||"",startYear:"",endYear:it.endYear||"",document:un.document}});ze.address&&e.updateAddress({present:{...ze.address,country:"India",verifiedStatus:{line1:!0,city:!0,state:!0,pincode:!0,country:!0}},permanent:{...ze.address,country:"India"},sameAsPresent:!0}),e.updateBank(wn),e.setBankVerifiedStatus(Rt),e.updateUan(cn),e.setUanVerifiedStatus(on),e.updateEsi(en),e.setEsiVerifiedStatus(Ut),e.updateFamily(fn),e.updateEducation(Ft),e.updatePersonal(kt),e.setPersonalVerifiedStatus($t),l({message:"Application auto-filled! Please review.",type:"success"}),n("/onboarding/add/personal")}catch(q){const de=q instanceof Error?q.message:"An unexpected error occurred.";console.error("Document processing failed:",q),l({message:`Document processing failed: ${de}`,type:"error"}),a(!1)}},z=E=>{d({isOpen:!1,employeeName:"",bankName:"",reason:""}),D(E,!1)},O=()=>{d({isOpen:!1,employeeName:"",bankName:"",reason:""}),D(B(),!0)};return r.jsxs("div",{className:"relative",children:[i&&r.jsxs("div",{className:"absolute inset-0 bg-page/90 backdrop-blur-sm z-10 flex flex-col items-center justify-center rounded-xl animate-fade-in-scale",children:[r.jsx(xt,{className:"h-12 w-12 animate-spin text-accent"}),r.jsx("p",{className:"mt-4 text-lg font-semibold text-primary-text",children:"Processing Documents..."}),r.jsx("p",{className:"text-muted text-center max-w-xs",children:"Our AI is analyzing your files. This may take a moment."})]}),r.jsxs("div",{className:`bg-card p-8 rounded-xl shadow-card w-full transition-all ${i?"blur-sm pointer-events-none":""}`,children:[r.jsx(Xue,{...c,onClose:()=>d({isOpen:!1,employeeName:"",bankName:"",reason:""}),onOverride:O}),r.jsxs("form",{onSubmit:v(z),children:[r.jsx(Xs,{title:"Document Collection",subtitle:"Upload documents to auto-fill the application."}),r.jsxs("div",{className:"space-y-8 mt-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[r.jsx(ye,{name:"photo",control:x,render:({field:E})=>r.jsx(pt,{label:"Profile Photo",file:E.value,onFileChange:E.onChange,allowCapture:!0,allowedTypes:["image/jpeg","image/png","image/webp"]})}),r.jsxs("div",{className:"space-y-6",children:[r.jsx(ye,{name:"aadhaarLinkedMobile",control:x,render:({field:E,fieldState:te})=>r.jsx(be,{label:"Aadhaar Linked Mobile Number",type:"tel",...E,error:te.error?.message})}),r.jsx(ye,{name:"alternateMobile",control:x,render:({field:E,fieldState:te})=>r.jsx(be,{label:"Alternative Mobile Number (Optional)",type:"tel",...E,error:te.error?.message})})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[r.jsx(ye,{name:"idProofFront",control:x,render:({field:E})=>r.jsx(pt,{label:"Aadhaar (Front Side)",file:E.value,onFileChange:E.onChange,error:S.idProofFront?.message,allowCapture:!0,verificationStatus:e.data.personal.verifiedStatus?.idProofNumber})}),r.jsx(ye,{name:"idProofBack",control:x,render:({field:E})=>r.jsx(pt,{label:"Aadhaar (Back Side)",file:E.value,onFileChange:E.onChange,error:S.idProofBack?.message,allowCapture:!0,verificationStatus:e.data.personal.verifiedStatus?.idProofNumber})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 items-start",children:[r.jsx(ye,{name:"bankProof",control:x,render:({field:E})=>r.jsx(pt,{label:"Bank Proof (Passbook/Cancelled Cheque)",file:E.value,onFileChange:E.onChange,error:S.bankProof?.message,allowCapture:!0,verificationStatus:e.data.bank.verifiedStatus?.accountNumber})}),r.jsx(ye,{name:"uanProof",control:x,render:({field:E})=>r.jsx(pt,{label:"UAN Proof Document",file:E.value,onFileChange:E.onChange,error:S.uanProof?.message,allowCapture:!0,verificationStatus:e.data.uan.verifiedStatus?.uanNumber})})]}),p.documents.salarySlip&&r.jsx(ye,{name:"salarySlip",control:x,render:({field:E})=>r.jsx(pt,{label:"Latest Salary Slip",file:E.value,onFileChange:E.onChange,error:S.salarySlip?.message,allowCapture:!0})}),p.documents.educationCertificate&&r.jsxs("div",{className:"pt-6 border-t",children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Education Certificates"}),r.jsxs("div",{className:"space-y-4",children:[Y.map((E,te)=>r.jsxs("div",{className:"p-4 border rounded-lg bg-page/50 relative",children:[r.jsx(ye,{name:`education.${te}.document`,control:x,render:({field:q,fieldState:de})=>r.jsx(pt,{label:"Certificate",file:q.value,onFileChange:q.onChange,error:de.error?.message,allowCapture:!0})}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>M(te),className:"!absolute top-2 right-2",children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})]},E.id)),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>j({id:`edu_upload_${Date.now()}`,document:null}),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Certificate"]})]})]}),p.documents.familyAadhaar&&r.jsxs("div",{className:"pt-6 border-t",children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Family Member Documents"}),r.jsxs("div",{className:"space-y-4",children:[R.map((E,te)=>{const de=H?.[te]?.relation==="Child";return r.jsxs("div",{className:"p-4 border rounded-lg bg-page/50 grid grid-cols-1 md:grid-cols-3 gap-4 items-start relative",children:[r.jsx(ye,{name:`family.${te}.relation`,control:x,render:({field:U,fieldState:P})=>r.jsxs(Oe,{label:"Relation",error:P.error?.message,...U,children:[" ",r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Spouse"}),r.jsx("option",{children:"Child"}),r.jsx("option",{children:"Father"}),r.jsx("option",{children:"Mother"})," "]})}),r.jsx(ye,{name:`family.${te}.phone`,control:x,render:({field:U,fieldState:P})=>r.jsx(be,{label:`Phone Number${de?" (Optional)":""}`,type:"tel",...U,error:P.error?.message})}),r.jsx("div",{className:"md:col-start-1 md:col-span-3",children:r.jsx(ye,{name:`family.${te}.idProof`,control:x,render:({field:U,fieldState:P})=>r.jsx(pt,{label:"Aadhaar Card",file:U.value,onFileChange:U.onChange,error:P.error?.message,allowCapture:!0})})}),r.jsx(se,{type:"button",variant:"icon",size:"sm",onClick:()=>_(te),className:"!absolute top-2 right-2",children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})]},E.id)}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>W({id:`fam_upload_${Date.now()}`,relation:"",idProof:null,phone:""}),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Family Member"]})]})]})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-between items-center gap-4",children:[r.jsxs(se,{type:"button",variant:"secondary",onClick:()=>n(-1),children:[r.jsx(Ri,{className:"mr-2 h-4 w-4"})," Back"]}),r.jsx(se,{type:"submit",isLoading:i,children:"Process"})]})]})]})]})},Mue=({count:n=3})=>r.jsx("div",{className:"space-y-2.5",children:Array.from({length:n}).map((e,t)=>r.jsxs("div",{className:"bg-[#041b0f] md:bg-[#243524] p-3 rounded-xl flex gap-4 items-start border border-transparent",children:[r.jsx($s,{className:"w-12 h-12 rounded-full flex-shrink-0"}),r.jsxs("div",{className:"flex-grow space-y-2 mt-1",children:[r.jsxs("div",{className:"flex justify-between items-start gap-2",children:[r.jsx($s,{className:"h-4 w-1/2"}),r.jsx($s,{className:"h-5 w-20 rounded-full"})]}),r.jsx($s,{className:"h-3 w-1/3"}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 mt-3 text-xs",children:[r.jsx($s,{className:"h-3 w-20"}),r.jsx($s,{className:"h-3 w-20"}),r.jsx($s,{className:"h-3 w-20"}),r.jsx($s,{className:"h-3 w-20"})]})]})]},t))}),If=({label:n,checked:e})=>r.jsxs("div",{className:"flex items-center gap-1.5",children:[e?r.jsx(Rm,{className:"h-4 w-4 text-emerald-400"}):r.jsx(xH,{className:"h-4 w-4 text-gray-500"}),r.jsx("span",{className:e?"text-gray-300":"text-gray-500",children:n})]}),Hue=({submission:n})=>{const{esiCtcThreshold:e}=dd(),{colorScheme:t}=an(),s=k.useMemo(()=>{const{personal:i,uan:a,esi:o,gmc:l}=n,c=i.salary!=null&&i.salary<=e;let d=!1;return c?d=!o.hasEsi||o.hasEsi&&!!o.esiNumber:l.isOptedIn===!0?d=!0:l.isOptedIn===!1&&(d=!!l.gmcPolicyCopy&&!!l.declarationAccepted),{aadhaar:!!i.idProofFront,uan:!a.hasPreviousPf||a.hasPreviousPf&&!!a.uanNumber,pf:!a.hasPreviousPf||a.hasPreviousPf&&!!a.uanNumber,esiGmc:d}},[n,e]);return r.jsx(aa,{to:`/onboarding/add/personal?id=${n.id}`,className:"block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[#041b0f] focus-visible:ring-emerald-400 rounded-xl",children:r.jsxs("div",{className:"bg-[#041b0f] md:bg-[#243524] hover:border-emerald-500 p-3 rounded-xl flex gap-4 items-start border border-transparent transition-colors duration-200",children:[r.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden flex-shrink-0 border-2 border-gray-600",children:r.jsx(ia,{photoUrl:n.personal.photo?.preview,seed:n.id})}),r.jsxs("div",{className:"flex-grow",children:[r.jsxs("div",{className:"flex justify-between items-start gap-2",children:[r.jsx("p",{className:"font-semibold text-green-400",children:`${n.personal.firstName} ${n.personal.lastName}`}),r.jsx("div",{className:"flex-shrink-0",children:r.jsx(GG,{status:n.status})})]}),r.jsx("p",{className:"text-sm text-gray-400",children:n.personal.mobile}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 mt-3 text-xs",children:[r.jsx(If,{label:"Aadhaar",checked:s.aadhaar}),r.jsx(If,{label:"UAN",checked:s.uan}),r.jsx(If,{label:"PF",checked:s.pf}),r.jsx(If,{label:"ESI / GMC",checked:s.esiGmc})]})]})]})})},Tue=()=>{const{colorScheme:n}=an(),[e,t]=k.useState([]),[s,i]=k.useState(!0),[a,o]=k.useState("in-progress"),[l,c]=k.useState(""),[d,h]=k.useState(null),m=vt(),f=k.useRef(null);k.useEffect(()=>{(async()=>{i(!0);try{const B=await ce.getVerificationSubmissions();t(B)}catch{h({message:"Failed to load submissions.",type:"error"})}finally{i(!1)}})()},[]);const p=k.useMemo(()=>{const S={"in-progress":["pending","draft","rejected"],existing:["verified"]};return e.filter(B=>S[a].includes(B.status)).filter(B=>`${B.personal.firstName} ${B.personal.lastName}`.toLowerCase().includes(l.toLowerCase())||B.personal.mobile?.toLowerCase().includes(l.toLowerCase()))},[e,a,l]),b=()=>{m("/onboarding/select-organization")},x=()=>{f.current?.focus()},v=[{key:"in-progress",label:"IN PROGRESS"},{key:"existing",label:"EXISTING"}];return r.jsxs("div",{className:"h-full flex flex-col bg-[#041b0f] text-white",children:[d&&r.jsx(It,{message:d.message,type:d.type,onDismiss:()=>h(null)}),r.jsxs("header",{className:"p-4 flex-shrink-0 flex items-center justify-between fo-mobile-header sticky top-0 z-10 bg-[#041b0f]/80 border-[#374151] backdrop-blur-sm border-b",children:[r.jsx("button",{onClick:()=>m("/onboarding"),"aria-label":"Go back",className:"p-2 rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 hover:bg-white/10",children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsx("h1",{className:"text-lg font-semibold",children:"On Boarding"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:x,"aria-label":"Search employee",className:"p-2 rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 hover:bg-white/10",children:r.jsx(la,{className:"h-6 w-6"})}),r.jsx("button",{onClick:b,"aria-label":"Add new employee",className:"p-2 rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 hover:bg-white/10",children:r.jsx(nd,{className:"h-6 w-6"})}),r.jsx("button",{onClick:()=>m("/profile"),"aria-label":"Exit to profile",className:"p-2 rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 hover:bg-white/10",children:r.jsx(Zi,{className:"h-6 w-6"})})]})]}),r.jsx("div",{className:"px-4 pt-4 pb-3 flex-shrink-0",children:r.jsx("div",{className:"flex",children:v.map(S=>r.jsx("button",{onClick:()=>o(S.key),className:`flex-1 py-2 text-sm font-semibold uppercase tracking-wider transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[#041b0f] focus-visible:ring-emerald-400 rounded-sm ${a===S.key?"border-b-2 border-emerald-500 text-emerald-600":"border-b-2 border-transparent text-gray-400 hover:text-white"}`,children:S.label},S.key))})}),r.jsxs("main",{className:"flex-1 overflow-y-auto px-4 space-y-2.5 pb-24",children:[r.jsxs("div",{className:"relative",children:[r.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500"}),r.jsx("input",{ref:f,type:"text",placeholder:"Search by name or number...",value:l,onChange:S=>c(S.target.value),className:"form-input w-full !pl-10 !h-12 !rounded-md"})]}),s?r.jsx("div",{className:"pt-4",children:r.jsx(Mue,{count:3})}):p.length>0?r.jsx("div",{className:"space-y-2.5",children:p.map(S=>r.jsx(Hue,{submission:S},S.id))}):r.jsx("div",{className:"text-center pt-16 text-gray-500",children:r.jsxs("p",{children:["No ",a.replace("-"," ")," submissions found."]})})]})]})},Eue=({status:n})=>{const e={"To Do":"bg-gray-500","In Progress":"bg-blue-500",Done:"bg-green-600"};return r.jsx("span",{className:`fo-status-badge ${e[n]}`,children:n})},Due=()=>{const{user:n}=bt(),{colorScheme:e}=an(),[t,s]=k.useState("tasks"),[i,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState(!0);k.useEffect(()=>{if(!n)return;(async()=>{d(!0);try{const[f,p]=await Promise.all([ce.getTasks(),ce.getNotifications(n.id)]),b=f.filter(x=>x.assignedToId===n.id);a(b),l(p)}catch(f){console.error("Failed to load data for tasks page",f)}finally{d(!1)}})()},[n]);const h=m=>{const f=["HR","Admin","Ops Manager","Site Manager"];return f[m.charCodeAt(m.length-1)%f.length]};return r.jsxs("div",{className:"text-white",children:[r.jsx("header",{className:"p-4 flex-shrink-0 text-center fo-mobile-header sticky top-0 bg-[#041b0f]/80 border-[#374151] backdrop-blur-sm z-10 border-b",children:r.jsx("h1",{className:"font-semibold text-lg",children:"Tasks"})}),r.jsx("div",{className:"flex-shrink-0 p-4",children:r.jsxs("div",{className:"fo-tabs-container",children:[r.jsx("button",{onClick:()=>s("tasks"),className:`fo-tab-button ${t==="tasks"?"active":""}`,children:"Tasks"}),r.jsx("button",{onClick:()=>s("notifications"),className:`fo-tab-button ${t==="notifications"?"active":""}`,children:"Notifications"})]})}),r.jsx("main",{className:"p-4",children:c?r.jsx("div",{className:"flex justify-center items-center h-full",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-muted"})}):t==="tasks"?i.length>0?r.jsx("div",{className:"space-y-4",children:i.map(m=>r.jsxs("div",{className:"fo-task-card",children:[r.jsxs("div",{className:"fo-task-header",children:[r.jsx("p",{className:"fo-task-title",children:m.name}),r.jsx(Eue,{status:m.status})]}),r.jsx("p",{className:"text-sm mb-2 text-gray-400",children:m.description}),r.jsxs("div",{className:"fo-task-meta flex justify-between items-center",children:[r.jsxs("span",{children:["Due: ",m.dueDate?He(new Date(m.dueDate),"dd MMM, yyyy"):"N/A"]}),r.jsxs("span",{children:["Assigned by: ",h(m.id)]})]})]},m.id))}):r.jsxs("div",{className:"text-center pt-16 text-muted",children:[r.jsx(IG,{className:"h-12 w-12 mx-auto mb-4"}),r.jsx("p",{children:"You have no assigned tasks."})]}):o.length>0?r.jsx("div",{className:"divide-y divide-border",children:o.map(m=>r.jsxs("div",{className:"fo-notification-item",children:[r.jsx(Mu,{className:"h-5 w-5 text-yellow-400 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("p",{className:"text-sm text-gray-300",children:m.message}),r.jsx("p",{className:"text-xs text-muted mt-1",children:Vl(new Date(m.createdAt),{addSuffix:!0})})]})]},m.id))}):r.jsxs("div",{className:"text-center pt-16 text-muted",children:[r.jsx(Mu,{className:"h-12 w-12 mx-auto mb-4"}),r.jsx("p",{children:"You have no notifications."})]})})]})},Lue=({status:n})=>{const{colorScheme:e}=useBrandingStore(),s={Pending:"bg-yellow-900/50 text-yellow-300 border border-yellow-500/50",Approved:"bg-blue-900/50 text-blue-300 border border-blue-500/50",Issued:"bg-green-900/50 text-green-300 border border-green-500/50",Rejected:"bg-red-900/50 text-red-300 border border-red-500/50"};return r.jsx("span",{className:`fo-status-badge ${s[n]}`,children:n})},Cf=({title:n,sizes:e,headers:t,control:s,quantityType:i})=>{const a=Array.from(new Set(e.map(l=>l.fit))),o=Array.from(new Set(e.map(l=>l.size))).sort((l,c)=>{const d=parseInt(String(l)),h=parseInt(String(c));return!isNaN(d)&&!isNaN(h)?d-h:String(l).localeCompare(String(c))});return r.jsxs("div",{className:"border border-border rounded-lg",children:[r.jsx("h4",{className:"p-3 font-semibold bg-accent text-white border-b border-accent",children:n}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-page",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 py-2 text-left font-medium text-muted",children:"Size"}),t.map(l=>r.jsx("th",{className:"px-3 py-2 text-left font-medium text-muted",children:l.label},String(l.key))),r.jsx("th",{className:"px-3 py-2 text-left font-medium text-muted w-24",children:"Quantity"})]})}),r.jsx("tbody",{className:"divide-y divide-border",children:o.map(l=>r.jsx(ot.Fragment,{children:a.map((c,d)=>{const h=e.find(m=>m.size===l&&m.fit===c);return h?r.jsxs("tr",{children:[d===0&&r.jsx("td",{rowSpan:a.filter(m=>e.some(f=>f.size===l&&f.fit===m)).length,className:"px-3 py-2 align-middle font-semibold border-r",children:l}),t.map(m=>r.jsx("td",{className:"px-3 py-2",children:h[m.key]},String(m.key))),r.jsx("td",{className:"px-3 py-2",children:r.jsx(ye,{name:`${i}.${h.id}`,control:s,render:({field:m})=>r.jsx(be,{"aria-label":`Quantity for ${n} size ${l} ${c}`,type:"number",...m,value:m.value||"",onChange:f=>m.onChange(parseInt(f.target.value)||null),className:"!py-1.5"})})})]},h.id):null})},l))})]})})]})},Pue=({onSave:n,onCancel:e,sites:t,masterUniforms:s,initialData:i})=>{const{register:a,control:o,handleSubmit:l,watch:c,reset:d}=tn({defaultValues:{siteId:"",gender:"Gents",pantsQuantities:{},shirtsQuantities:{}}}),{data:h}=Qn(),{user:m}=bt(),f=c("gender"),p=c("siteId");k.useEffect(()=>{if(i){const x={},v={};i.items.forEach(S=>{S.category==="Pants"?x[S.sizeId]=S.quantity:v[S.sizeId]=S.quantity}),d({siteId:i.siteId,gender:i.gender,pantsQuantities:x,shirtsQuantities:v})}else{const x=h.organization.organizationId||"",S=h.personal.gender==="Female"?"Ladies":"Gents";d({siteId:x,gender:S,pantsQuantities:{},shirtsQuantities:{}})}},[i,d,h]);const b=x=>{const v=t.find(R=>R.id===x.siteId);if(!v||!m)return;const S=f==="Gents"?[...s.gents.pants,...s.gents.shirts]:[...s.ladies.pants,...s.ladies.shirts],B=[];for(const[R,W]of Object.entries(x.pantsQuantities))if(W&&W>0){const _=S.find(Y=>Y.id===R);_&&B.push({sizeId:R,quantity:W,category:"Pants",sizeLabel:_.size,fit:_.fit})}for(const[R,W]of Object.entries(x.shirtsQuantities))if(W&&W>0){const _=S.find(Y=>Y.id===R);_&&B.push({sizeId:R,quantity:W,category:"Shirts",sizeLabel:_.size,fit:_.fit})}const V={id:i?.id||`new_${Date.now()}`,siteId:x.siteId,siteName:v.shortName,gender:x.gender,requestedDate:i?.requestedDate||new Date().toISOString(),status:i?.status||"Pending",items:B,source:"Individual",requestedById:m.id,requestedByName:m.name,employeeDetails:[{employeeName:`${h.personal.firstName} ${h.personal.lastName}`,employeeId:h.personal.employeeId,items:B.map(R=>({itemName:R.category,sizeLabel:R.sizeLabel,fit:R.fit,quantity:R.quantity}))}]};n(V)};return r.jsx("form",{onSubmit:l(b),children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs(Oe,{label:"Select Site",value:p,...a("siteId"),required:!0,disabled:!0,children:[r.jsx("option",{value:"",children:"-- Select a Site --"}),t.map(x=>r.jsx("option",{value:x.id,children:x.shortName},x.id))]}),r.jsxs(Oe,{label:"Select Uniform Type",value:f,...a("gender"),disabled:!0,children:[r.jsx("option",{children:"Gents"}),r.jsx("option",{children:"Ladies"})]})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:f==="Gents"?r.jsxs(r.Fragment,{children:[r.jsx(Cf,{title:"Gents' Pants",sizes:s.gents.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:o,quantityType:"pantsQuantities"}),r.jsx(Cf,{title:"Gents' Shirts",sizes:s.gents.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"fit",label:"Fit"}],control:o,quantityType:"shirtsQuantities"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Cf,{title:"Ladies' Pants",sizes:s.ladies.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:o,quantityType:"pantsQuantities"}),r.jsx(Cf,{title:"Ladies' Shirts",sizes:s.ladies.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],control:o,quantityType:"shirtsQuantities"})]})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-[#374151]",children:[r.jsx(se,{type:"button",variant:"secondary",onClick:e,children:"Cancel"}),r.jsxs(se,{type:"submit",children:[r.jsx(fr,{className:"mr-2 h-4 w-4"})," Save Request"]})]})]})})},Kue=()=>{const[n,e]=k.useState("list"),[t,s]=k.useState([]),[i,a]=k.useState([]),[o,l]=k.useState(null),[c,d]=k.useState(!0),[h,m]=k.useState(null),[f,p]=k.useState(null),[b,x]=k.useState(null),v=vt(),[S]=wF(),{updateUniforms:B}=Qn(),V=S.get("from")==="onboarding",R=async()=>{d(!0);try{const[H,D,z,O]=await Promise.all([ce.getUniformRequests(),ce.getOrganizations(),ce.getMasterGentsUniforms(),ce.getMasterLadiesUniforms()]);s(H.sort((E,te)=>new Date(te.requestedDate).getTime()-new Date(E.requestedDate).getTime())),a(D),l({gents:z,ladies:O})}catch{m({message:"Failed to load uniform data.",type:"error"})}finally{d(!1)}};k.useEffect(()=>{R()},[]),k.useEffect(()=>{V&&(e("form"),p(null))},[V]);const W=()=>{p(null),e("form")},_=H=>{p(H),e("form")},Y=async H=>{if(V&&o){const D=H.gender==="Ladies"?[...o.ladies.pants,...o.ladies.shirts]:[...o.gents.pants,...o.gents.shirts],z=H.items.map(O=>{const E=D.find(de=>de.id===O.sizeId),te=O.category==="Pants"?`${H.gender}' Pants`:`${H.gender}' Shirts`;return{itemId:`generic_${H.gender.toLowerCase()}_${O.category==="Pants"?"pants":"shirts"}`,itemName:te,sizeId:O.sizeId,sizeLabel:E?.size||"",fit:E?.fit||"",quantity:O.quantity}});B(z),await ce.submitUniformRequest(H),v(-1);return}try{H.id.startsWith("new_")?(await ce.submitUniformRequest(H),m({message:"New request submitted.",type:"success"})):(await ce.updateUniformRequest(H),m({message:"Request updated.",type:"success"})),e("list"),R()}catch{m({message:"Failed to save request.",type:"error"})}},j=async()=>{if(b)try{await ce.deleteUniformRequest(b.id),m({message:"Request deleted.",type:"success"}),x(null),R()}catch{m({message:"Failed to delete request.",type:"error"})}},M=H=>H.reduce((D,z)=>D+z.quantity,0);if(c||!o)return r.jsx("div",{className:"flex justify-center items-center h-full",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-muted"})});if(n==="form"){const H=()=>{V?v(-1):e("list")};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("header",{className:"p-4 flex-shrink-0 flex items-center gap-4 fo-mobile-header",children:[r.jsx("button",{onClick:H,"aria-label":"Go back",children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsxs("h1",{children:[f?"Edit":"New"," Request"]})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsx(Pue,{onSave:Y,onCancel:H,sites:i,masterUniforms:o,initialData:f})})]})}return r.jsxs("div",{className:"h-full flex flex-col bg-[#041b0f] text-white",children:[h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)}),r.jsx(tr,{isOpen:!!b,onClose:()=>x(null),onConfirm:j,title:"Confirm Deletion",children:"Are you sure you want to delete this uniform request? This cannot be undone."}),r.jsxs("header",{className:"p-4 flex-shrink-0 flex items-center justify-between fo-mobile-header",children:[r.jsx("h1",{className:"text-lg font-semibold",children:"Uniform Requests"}),r.jsx("button",{onClick:W,"aria-label":"New Uniform Request",className:"",children:r.jsx(nd,{className:"h-6 w-6"})})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:t.length>0?t.map(H=>r.jsxs("div",{className:"p-3 rounded-xl border bg-[#243524] border-[#374151]",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold text-white",children:H.siteName}),r.jsx("p",{className:"text-xs text-gray-400",children:He(new Date(H.requestedDate),"dd MMM, yyyy")})]}),r.jsx(Lue,{status:H.status})]}),r.jsxs("div",{className:"mt-3 flex justify-between items-end",children:[r.jsxs("div",{className:"text-sm text-gray-300",children:[r.jsxs("p",{children:[H.gender," Uniforms"]}),r.jsxs("p",{className:"font-semibold",children:[M(H.items)," Items"]})]}),H.status==="Pending"&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(se,{variant:"icon",size:"sm",onClick:()=>_(H),children:r.jsx(ms,{className:"h-4 w-4 text-gray-400"})}),r.jsx(se,{variant:"icon",size:"sm",onClick:()=>x(H),children:r.jsx(rn,{className:"h-4 w-4 text-red-500"})})]})]})]},H.id)):r.jsxs("div",{className:"text-center pt-16 text-muted",children:[r.jsx(Lu,{className:"h-12 w-12 mx-auto mb-4"}),r.jsx("p",{children:"No uniform requests found."}),r.jsxs(se,{onClick:W,className:"mt-4",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Create First Request"]})]})})]})},Oue=({priority:n})=>{const e={Low:"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]",Medium:"bg-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.5)]",High:"bg-orange-500 shadow-[0_0_8px_rgba(249,115,22,0.5)]",Urgent:"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)]"};return r.jsx("span",{className:`w-3 h-3 rounded-full ${e[n]}`,title:`Priority: ${n}`})},zue=({status:n})=>{const e={Open:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20","In Progress":"bg-blue-500/10 text-blue-500 border-blue-500/20","Pending Requester":"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",Resolved:"bg-purple-500/10 text-purple-500 border-purple-500/20",Closed:"bg-gray-500/10 text-gray-500 border-gray-500/20"};return r.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${e[n]}`,children:n})},Uue=({ticket:n,onClick:e,isAdmin:t,onDelete:s})=>r.jsxs("div",{onClick:e,className:"group bg-card hover:bg-accent/5 p-5 rounded-xl border border-border hover:border-accent cursor-pointer transition-all duration-300 flex flex-col justify-between h-full shadow-sm hover:shadow-md",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-start gap-3 mb-2",children:[r.jsx("h4",{className:"font-bold text-primary-text leading-snug group-hover:text-accent transition-colors line-clamp-2",children:n.title}),r.jsxs("div",{className:"flex-shrink-0 mt-1 flex gap-2",children:[t&&r.jsx("button",{onClick:s,className:"p-1 hover:bg-red-100 rounded text-gray-400 hover:text-red-600 transition-colors",title:"Delete Ticket",children:r.jsx(rn,{className:"h-4 w-4"})}),r.jsx(Oue,{priority:n.priority})]})]}),r.jsxs("p",{className:"text-xs text-muted font-mono",children:["#",n.ticketNumber]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border/50",children:[r.jsxs("div",{className:"flex justify-between items-center text-xs text-muted mb-3",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-700 flex items-center justify-center text-[10px] text-white font-bold",children:n.raisedByName.charAt(0)}),r.jsx("span",{children:n.raisedByName})]}),r.jsx("span",{children:Vl(new Date(n.raisedAt),{addSuffix:!0})})]}),r.jsx("div",{className:"flex justify-between items-center",children:r.jsx(zue,{status:n.status})})]})]}),MY=({user:n,onAction:e})=>{const{colorScheme:t}=an(),s=Is(t);return r.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-card border border-border hover:border-accent/50 transition-colors",children:[r.jsxs("div",{className:"relative",children:[r.jsx(ia,{photoUrl:n.photoUrl,seed:n.id,className:"w-12 h-12 rounded-full shadow-sm"}),r.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 block h-4 w-4 rounded-full ${n.isAvailable?"bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.8)]":"bg-rose-600 shadow-[0_0_6px_rgba(225,29,72,0.6)]"} ring-2 ring-white`})]}),r.jsxs("div",{className:"flex-grow min-w-0",children:[r.jsx("p",{className:"text-sm font-bold text-primary-text truncate",children:n.name}),r.jsx("p",{className:"text-xs text-muted truncate",children:n.role.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:s.activeItemBg,color:"#FFFFFF",borderColor:s.sidebarBorder},title:"Call",onClick:()=>e(n.phone),children:r.jsx(Eu,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:s.activeItemBg,color:"#FFFFFF",borderColor:s.sidebarBorder},title:"Message",onClick:()=>e(n.phone),children:r.jsx(Bm,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",className:"hover:opacity-90 transition-opacity border",style:{backgroundColor:s.activeItemBg,color:"#FFFFFF",borderColor:s.sidebarBorder},title:"Video",onClick:()=>e(n.phone),children:r.jsx(ZH,{className:"h-4 w-4"})})]})]})},Que=()=>{const n=vt(),{user:e}=bt(),{colorScheme:t}=an(),[s,i]=k.useState([]),[a,o]=k.useState([]),[l,c]=k.useState(!0),[d,h]=k.useState(null),[m,f]=k.useState("All"),[p,b]=k.useState("All"),[x,v]=k.useState(""),[S,B]=k.useState(!1),[V,R]=k.useState(!1),W=jt("(max-width: 767px)"),[_,Y]=k.useState({status:"all",priority:"all",searchTerm:""});k.useEffect(()=>{(async()=>{if(e){c(!0);try{const[E,te]=await Promise.all([ce.getSupportTickets(),ce.getNearbyUsers()]);i(E),o(te.filter(q=>q.id!==e.id))}catch{h({message:"Failed to load support data.",type:"error"})}finally{c(!1)}}})()},[e]);const j=async(O,E)=>{if(O.stopPropagation(),!!window.confirm("Are you sure you want to delete this ticket? This action cannot be undone."))try{await ce.deleteSupportTicket(E),i(te=>te.filter(q=>q.id!==E)),h({message:"Ticket deleted successfully.",type:"success"})}catch{h({message:"Failed to delete ticket.",type:"error"})}},M=k.useMemo(()=>s.filter(O=>{const E=_.status==="all"||O.status===_.status,te=_.priority==="all"||O.priority===_.priority,q=_.searchTerm===""||O.title.toLowerCase().includes(_.searchTerm.toLowerCase())||O.ticketNumber.toLowerCase().includes(_.searchTerm.toLowerCase())||O.description.toLowerCase().includes(_.searchTerm.toLowerCase());return E&&te&&q}),[s,_]),H=k.useMemo(()=>{const O=s.filter(E=>E.status==="Resolved"&&E.raisedById===e?.id);return{open:s.filter(E=>E.status==="Open").length,inProgress:s.filter(E=>E.status==="In Progress").length,pendingYourAction:O.length}},[s,e]),D=O=>{if(!O){h({message:"User does not have a phone number.",type:"error"});return}let E=O.replace(/\D/g,"");if(E.length>10&&(E=E.slice(-10)),E.length!==10){h({message:"Invalid phone number format.",type:"error"});return}window.open(`https://wa.me/91${E}`,"_blank")},z=({title:O,value:E,icon:te,colorClass:q})=>r.jsxs("div",{className:"bg-transparent p-5 rounded-2xl flex items-center justify-between transition-all",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-muted mb-1",children:O}),r.jsx("p",{className:`text-3xl font-bold ${q.replace("bg-","text-").split(" ")[0]}`,children:E})]}),r.jsx("div",{className:`p-3 rounded-full bg-opacity-10 ${q.replace("text-","bg-")} ${q}`,children:te})]});return r.jsxs("div",{className:"w-full p-4 lg:p-8 space-y-8",children:[d&&r.jsx(It,{message:d.message,type:d.type,onDismiss:()=>h(null)}),r.jsx(tr,{isOpen:V,onClose:()=>R(!1),title:"Nearby Available Support",onConfirm:()=>R(!1),confirmButtonText:"Close",children:r.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:a.length>0?a.map(O=>r.jsx(MY,{user:O,onAction:D},O.id)):r.jsxs("div",{className:"text-center py-8 text-muted",children:[r.jsx(Ni,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),r.jsx("p",{children:"No support staff found nearby."})]})})}),r.jsx("div",{className:"relative overflow-hidden rounded-3xl bg-transparent p-6 lg:p-10 transition-all",children:r.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"p-2 bg-emerald-50 rounded-lg backdrop-blur-sm",children:r.jsx(Pf,{className:"h-6 w-6 text-emerald-600"})}),r.jsx("h2",{className:"text-2xl lg:text-3xl font-bold text-primary-text",children:"Support & Audit"})]}),r.jsx("p",{className:"text-muted max-w-xl text-sm",children:"Track issues, request audits, and connect with support staff in real-time."})]}),r.jsxs("div",{className:"flex flex-wrap gap-2 w-full lg:w-auto",children:[W&&r.jsxs(se,{onClick:()=>R(!0),variant:"secondary",className:"flex-1 lg:flex-none bg-gray-100 text-gray-900 hover:bg-gray-200 border-none shadow-none p-0 text-sm transition-colors",children:[r.jsx(Sg,{className:"mr-1.5 h-3.5 w-3.5"})," Nearby"]}),r.jsxs(se,{onClick:()=>n("/support/ticket/new"),className:"flex-1 lg:flex-none",children:[r.jsx(Tt,{className:"mr-1.5 h-3.5 w-3.5"})," New Ticket"]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 lg:gap-6",children:[r.jsx(z,{title:"Open Tickets",value:H.open,icon:r.jsx(Pf,{className:"h-6 w-6"}),colorClass:"text-rose-500"}),r.jsx(z,{title:"In Progress",value:H.inProgress,icon:r.jsx(xt,{className:"h-6 w-6"}),colorClass:"text-blue-500"}),r.jsx(z,{title:"Pending Your Action",value:H.pendingYourAction,icon:r.jsx(Sg,{className:"h-6 w-6"}),colorClass:"text-amber-500"})]}),r.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-8",children:[r.jsx("div",{className:"lg:col-span-2 space-y-6",children:r.jsxs("div",{className:"bg-transparent p-5 rounded-2xl",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[r.jsxs("div",{className:"relative flex-grow",children:[r.jsx(la,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx(be,{id:"search",placeholder:"Search tickets...",className:"pl-10 bg-gray-50 border-gray-200",value:_.searchTerm,onChange:O=>Y(E=>({...E,searchTerm:O.target.value}))})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("div",{className:"w-32 sm:w-40",children:r.jsxs(Oe,{value:_.status,onChange:O=>Y(E=>({...E,status:O.target.value})),className:"bg-gray-50 border-gray-200",children:[r.jsx("option",{value:"all",children:"All Status"}),r.jsx("option",{children:"Open"}),r.jsx("option",{children:"In Progress"}),r.jsx("option",{value:"Pending Requester",children:"Pending"}),r.jsx("option",{children:"Resolved"}),r.jsx("option",{children:"Closed"})]})}),r.jsx("div",{className:"w-32 sm:w-40",children:r.jsxs(Oe,{value:_.priority,onChange:O=>Y(E=>({...E,priority:O.target.value})),className:"bg-gray-50 border-gray-200",children:[r.jsx("option",{value:"all",children:"All Priority"}),r.jsx("option",{children:"Low"}),r.jsx("option",{children:"Medium"}),r.jsx("option",{children:"High"}),r.jsx("option",{children:"Urgent"})]})})]})]}),l?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:M.length>0?M.map(O=>r.jsx(Uue,{ticket:O,onClick:()=>n(`/support/ticket/${O.id}`),isAdmin:e?.role==="admin"||e?.role==="operations_manager",onDelete:E=>j(E,O.id)},O.id)):r.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-muted",children:[r.jsx("div",{className:"p-4 bg-accent/5 rounded-full mb-3",children:r.jsx(la,{className:"h-8 w-8 opacity-50"})}),r.jsx("p",{children:"No tickets match your filters."})]})})]})}),r.jsx("aside",{className:"hidden lg:block space-y-6",children:r.jsxs("div",{className:"bg-card p-6 rounded-2xl border border-border shadow-sm sticky top-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"font-bold text-lg text-primary-text flex items-center gap-2",children:[r.jsx(Ni,{className:"h-5 w-5 text-accent"})," Nearby Support"]}),r.jsxs("span",{className:"text-xs font-medium bg-accent/10 text-accent px-2 py-1 rounded-full",children:[a.filter(O=>O.isAvailable).length," Online"]})]}),r.jsx("div",{className:"space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto pr-1 custom-scrollbar",children:a.length>0?a.map(O=>r.jsx(MY,{user:O,onAction:D},O.id)):r.jsx("div",{className:"text-center py-8 text-muted",children:r.jsx("p",{children:"No support staff found nearby."})})})]})})]})]})},que=({post:n,ticket:e,setTicket:t})=>{const{user:s}=bt(),[i,a]=k.useState(!1),[o,l]=k.useState(""),[c,d]=k.useState(!1),h=s?n.likes.includes(s.id):!1,m=async()=>{if(!s)return;const p=[...n.likes],b=h?n.likes.filter(x=>x!==s.id):[...n.likes,s.id];t(x=>x?{...x,posts:x.posts.map(v=>v.id===n.id?{...v,likes:b}:v)}:null);try{await ce.togglePostLike(n.id,s.id)}catch{t(v=>v?{...v,posts:v.posts.map(S=>S.id===n.id?{...S,likes:p}:S)}:null)}},f=async()=>{if(!(!o.trim()||!s)){d(!0);try{const p=await ce.addPostComment(n.id,{postId:n.id,authorId:s.id,authorName:s.name,content:o});t(b=>b?{...b,posts:b.posts.map(x=>x.id===n.id?{...x,comments:[...x.comments,p]}:x)}:null),l("")}catch{}finally{d(!1)}}};return r.jsx("div",{className:"bg-card p-4 rounded-xl shadow-card",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(ia,{seed:n.authorId,className:"w-10 h-10 rounded-full flex-shrink-0"}),r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"font-semibold text-primary-text",children:n.authorName}),r.jsx("span",{className:"text-xs text-muted",children:n.authorRole.replace(/_/g," ")}),r.jsxs("span",{className:"text-xs text-muted",children:[" ",Vl(new Date(n.createdAt),{addSuffix:!0})]})]}),r.jsx("p",{className:"text-sm text-muted mt-1 whitespace-pre-wrap",children:n.content}),r.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-muted",children:[r.jsxs("button",{onClick:m,className:`flex items-center gap-1.5 hover:text-accent transition-colors ${h?"text-accent font-semibold":""}`,children:[r.jsx(b$,{className:`h-4 w-4 ${h?"fill-current":""}`}),r.jsxs("span",{children:[n.likes.length," Like",n.likes.length!==1&&"s"]})]}),r.jsxs("button",{onClick:()=>a(!i),className:"flex items-center gap-1.5 hover:text-accent transition-colors",children:[r.jsx(Bm,{className:"h-4 w-4"}),r.jsxs("span",{children:[n.comments.length," Comment",n.comments.length!==1&&"s"]})]})]}),i&&r.jsxs("div",{className:"mt-4 space-y-3 pt-3 border-t border-border animate-fade-in-down",children:[n.comments.map(p=>r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(ia,{seed:p.authorId,className:"w-8 h-8 rounded-full flex-shrink-0"}),r.jsxs("div",{className:"bg-page p-2 rounded-lg flex-grow",children:[r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"font-semibold text-sm text-primary-text",children:p.authorName}),r.jsx("span",{className:"text-xs text-muted",children:Vl(new Date(p.createdAt),{addSuffix:!0})})]}),r.jsx("p",{className:"text-sm text-muted",children:p.content})]})]},p.id)),r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(ia,{className:"w-8 h-8 rounded-full flex-shrink-0"}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("textarea",{value:o,onChange:p=>l(p.target.value),placeholder:"Write a comment...",rows:2,className:"form-input text-sm"}),r.jsx("div",{className:"text-right mt-1",children:r.jsx(se,{size:"sm",onClick:f,isLoading:c,children:"Post"})})]})]})]})]})]})})},$ue=Bt({rating:mr().min(1,"Please select a rating.").required(),feedback:pe().required("Feedback is required to close the ticket.").min(10,"Please provide more detailed feedback.")}).defined(),ehe=({value:n,onChange:e})=>{const[t,s]=k.useState(0);return r.jsx("div",{className:"flex items-center justify-center gap-1",onMouseLeave:()=>s(0),children:[1,2,3,4,5].map(i=>r.jsx("button",{type:"button",onMouseEnter:()=>s(i),onClick:()=>e(i),className:"focus:outline-none",children:r.jsx(SH,{className:`h-8 w-8 cursor-pointer transition-colors ${(t||n)>=i?"text-yellow-400 fill-current":"text-gray-400"}`})},i))})},the=({isOpen:n,onClose:e,onSubmit:t})=>{const[s,i]=k.useState(!1),{register:a,handleSubmit:o,control:l,formState:{errors:c}}=tn({resolver:Yn($ue),defaultValues:{rating:0,feedback:""}}),d=h=>{i(!0),t(h.rating,h.feedback),i(!1)};return n?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4",onClick:e,children:r.jsx("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-lg m-4 animate-fade-in-scale",onClick:h=>h.stopPropagation(),children:r.jsxs("form",{onSubmit:o(d),children:[r.jsx("h3",{className:"text-lg font-bold text-primary-text mb-2 text-center",children:"Ticket Resolved"}),r.jsx("p",{className:"text-sm text-muted text-center mb-4",children:"Please rate the support you received before closing this ticket."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx(ye,{name:"rating",control:l,render:({field:h})=>r.jsx(ehe,{value:h.value,onChange:h.onChange})}),c.rating&&r.jsx("p",{className:"mt-2 text-xs text-red-500 text-center",children:c.rating.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted text-center",children:"Your Feedback"}),r.jsx("textarea",{...a("feedback"),rows:4,className:`mt-1 form-input ${c.feedback?"form-input--error":""}`}),c.feedback&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:c.feedback.message})]})]}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx(se,{type:"button",onClick:e,variant:"secondary",children:"Not Now"}),r.jsx(se,{type:"submit",isLoading:s,children:"Confirm & Close"})]})]})})}):null},nhe=({priority:n})=>{const e={Low:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",Medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",High:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",Urgent:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${e[n]}`,children:n})},she=({status:n})=>{const e={Open:"status-chip--pending","In Progress":"sync-chip--pending_sync","Pending Requester":"leave-status-chip--pending_hr_confirmation",Resolved:"leave-status-chip--approved",Closed:"status-chip--draft"};return r.jsx("span",{className:`status-chip ${e[n]}`,children:n})},rhe=()=>{const{id:n}=Bg(),e=vt(),{user:t}=bt(),[s,i]=k.useState(null),[a,o]=k.useState([]),[l,c]=k.useState(!0),[d,h]=k.useState(null),[m,f]=k.useState(""),[p,b]=k.useState(!1),[x,v]=k.useState(!1);jt("(max-width: 1023px)"),k.useEffect(()=>{if(!n)return;(async()=>{c(!0);try{const[j,M]=await Promise.all([ce.getSupportTicketById(n),ce.getNearbyUsers()]);j?i(j):(h({message:"Ticket not found.",type:"error"}),e("/support")),o(M)}catch{h({message:"Failed to load ticket data.",type:"error"})}finally{c(!1)}})()},[n,e]);const S=async()=>{if(!(!m.trim()||!s||!t)){b(!0);try{const Y=await ce.addTicketPost(s.id,{ticketId:s.id,authorId:t.id,authorName:t.name,authorRole:t.role,content:m});i(j=>j?{...j,posts:[...j.posts,Y]}:null),f("")}catch{h({message:"Failed to add post.",type:"error"})}finally{b(!1)}}},B=async Y=>{if(s)try{const j=await ce.updateSupportTicket(s.id,Y);i(j),Y.status&&h({message:`Ticket status updated to ${Y.status}`,type:"success"})}catch{h({message:"Failed to update ticket.",type:"error"})}},V=async(Y,j)=>{await B({status:"Closed",rating:Y,feedback:j,closedAt:new Date().toISOString()}),v(!1)},R=Y=>{if(!Y){h({message:"User does not have a phone number.",type:"error"});return}let j=Y.replace(/\D/g,"");if(j.length>10&&(j=j.slice(-10)),j.length!==10){h({message:"Invalid phone number format.",type:"error"});return}window.open(`https://wa.me/91${j}`,"_blank")};if(l)return r.jsx("div",{className:"flex justify-center items-center h-screen",children:r.jsx(xt,{className:"h-12 w-12 animate-spin text-accent"})});if(!s)return null;const W=t?.id===s.raisedById,_=()=>s.status==="Closed"?null:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.status==="Open"&&r.jsx(se,{onClick:()=>B({status:"In Progress",assignedToId:t?.id,assignedToName:t?.name}),children:"Assign to Me"}),s.status==="In Progress"&&t?.id===s.assignedToId&&r.jsx(se,{onClick:()=>B({status:"Resolved",resolvedAt:new Date().toISOString()}),children:"Mark as Resolved"}),s.status==="Resolved"&&W&&r.jsx(se,{onClick:()=>v(!0),children:"Close Ticket"})]});return r.jsxs("div",{className:"p-4",children:[d&&r.jsx(It,{message:d.message,type:d.type,onDismiss:()=>h(null)}),x&&r.jsx(the,{isOpen:x,onClose:()=>v(!1),onSubmit:V}),r.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[r.jsx(se,{variant:"icon",onClick:()=>e("/support"),children:r.jsx(Ri,{})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl md:text-2xl font-bold text-primary-text",children:s.title}),r.jsxs("p",{className:"text-xs text-muted",children:["#",s.ticketNumber]})]})]}),r.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-6",children:[r.jsxs("main",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-card space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap gap-4 justify-between items-start",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(she,{status:s.status}),r.jsx(nhe,{priority:s.priority})]}),r.jsxs("div",{className:"text-sm text-muted text-right",children:[r.jsxs("p",{children:["Raised by: ",r.jsx("span",{className:"font-semibold text-primary-text",children:s.raisedByName})]}),r.jsx("p",{children:He(new Date(s.raisedAt),"dd MMM, yyyy - hh:mm a")})]})]}),r.jsx("p",{className:"text-sm text-muted whitespace-pre-wrap",children:s.description}),s.attachmentUrl&&r.jsxs("div",{className:"mt-4",children:[r.jsx("h5",{className:"text-sm font-semibold text-primary-text mb-2",children:"Attachment"}),r.jsx("a",{href:s.attachmentUrl,target:"_blank",rel:"noopener noreferrer",className:"block border rounded-lg overflow-hidden max-w-xs hover:border-accent",children:r.jsx("img",{src:s.attachmentUrl,alt:"Attachment",className:"max-h-64 w-auto"})})]})]}),r.jsx("div",{className:"space-y-4",children:s.posts.map(Y=>r.jsx(que,{post:Y,ticket:s,setTicket:i},Y.id))}),s.status!=="Closed"&&r.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-card flex items-start gap-3",children:[r.jsx(ia,{className:"w-10 h-10 rounded-full flex-shrink-0"}),r.jsxs("div",{className:"w-full",children:[r.jsx("textarea",{value:m,onChange:Y=>f(Y.target.value),placeholder:"Add a public reply...",className:"form-input w-full",rows:3}),r.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[r.jsx(se,{variant:"icon",size:"sm",title:"Attach file",children:r.jsx(I$,{className:"h-5 w-5"})}),r.jsxs(se,{onClick:S,isLoading:p,children:[r.jsx(CG,{className:"mr-2 h-4"})," Post"]})]})]})]})]}),r.jsxs("aside",{className:"space-y-6 mt-6 lg:mt-0",children:[r.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-card",children:[r.jsx("h3",{className:"font-semibold text-primary-text mb-3",children:"Ticket Details"}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-muted",children:"Assigned To:"})," ",r.jsx("span",{className:"font-semibold",children:s.assignedToName||"Unassigned"})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-muted",children:"Category:"})," ",r.jsx("span",{children:s.category})]}),s.resolvedAt&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-muted",children:"Resolved:"})," ",r.jsx("span",{children:He(new Date(s.resolvedAt),"dd MMM, yy")})]}),s.closedAt&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-muted",children:"Closed:"})," ",r.jsx("span",{children:He(new Date(s.closedAt),"dd MMM, yy")})]}),s.rating&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-muted",children:"Rating:"})," ",r.jsxs("span",{className:"flex items-center gap-1",children:[s.rating," ",r.jsx(SH,{className:"h-4 w-4 text-yellow-400 fill-current"})]})]})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-border",children:_()})]}),r.jsxs("div",{className:"bg-card p-4 rounded-xl shadow-card",children:[r.jsxs("h3",{className:"font-semibold text-primary-text mb-3 flex items-center gap-2",children:[r.jsx(Ni,{className:"h-5 w-5 text-muted"})," Nearby Users"]}),r.jsx("div",{className:"space-y-3",children:a.map(Y=>r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(ia,{photoUrl:Y.photoUrl,seed:Y.id,className:"w-10 h-10 rounded-full"}),r.jsx("span",{className:"absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-400 ring-2 ring-card"})]}),r.jsxs("div",{className:"flex-grow",children:[r.jsx("p",{className:"text-sm font-semibold",children:Y.name}),r.jsx("p",{className:"text-xs text-muted",children:Y.role.replace(/_/g," ").replace(/\b\w/g,j=>j.toUpperCase())})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(se,{variant:"icon",size:"sm",title:"WhatsApp Chat",onClick:()=>R(Y.phone),children:r.jsx(Eu,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",title:"WhatsApp Chat",onClick:()=>R(Y.phone),children:r.jsx(Bm,{className:"h-4 w-4"})}),r.jsx(se,{variant:"icon",size:"sm",title:"WhatsApp Chat",onClick:()=>R(Y.phone),children:r.jsx(ZH,{className:"h-4 w-4"})})]})]},Y.id))})]})]})]})]})},ihe=Bt({id:pe().optional(),name:pe().required("Name is required"),email:pe().email("Invalid email").required("Email is required"),role:pe().required("Role is required"),password:pe().min(6,"Password must be at least 6 characters").required("Password is required for new users"),phone:pe().optional(),organizationId:pe().when("role",{is:"site_manager",then:n=>n.required("Site manager must be assigned to a site."),otherwise:n=>n.optional()}),organizationName:pe().optional(),reportingManagerId:pe().optional(),photoUrl:pe().optional().nullable()}).defined(),ahe=Bt({id:pe().optional(),name:pe().required("Name is required"),email:pe().email("Invalid email").required("Email is required"),role:pe().required("Role is required"),phone:pe().optional(),organizationId:pe().when("role",{is:"site_manager",then:n=>n.required("Site manager must be assigned to a site."),otherwise:n=>n.optional()}),organizationName:pe().optional(),reportingManagerId:pe().optional(),photoUrl:pe().optional().nullable()}).defined(),HY=()=>{const n=vt(),{id:e}=Bg(),t=!!e,s=jt("(max-width: 767px)"),[i,a]=k.useState(!1),[o,l]=k.useState([]),[c,d]=k.useState([]),[h,m]=k.useState(null),[f,p]=k.useState(null),b=t?ahe:ihe,{register:x,handleSubmit:v,formState:{errors:S},reset:B,watch:V,setValue:R}=tn({resolver:Yn(b)}),W=V("role");k.useEffect(()=>{(async()=>{try{const[M,H]=await Promise.all([ce.getOrganizations(),ce.getRoles()]);if(l(M),d(H),t&&e){const z=(await ce.getUsers()).find(O=>O.id===e);z&&(p(z),B(z))}else B({name:"",email:"",role:"field_officer"})}catch{m({message:"Failed to load form data.",type:"error"})}})()},[e,t,B]);const _=j=>{const M=j.target.value,H=o.find(D=>D.id===M);R("organizationId",M),R("organizationName",H?.shortName||"")},Y=async j=>{a(!0);try{if(t&&e){const{password:M,...H}=j;await ce.updateUser(e,H),m({message:"User updated successfully!",type:"success"})}else{const{name:M,email:H,password:D,role:z,...O}=j;if(!D)throw new Error("Password is required when creating a new user");const E=await ce.createAuthUser({name:M,email:H,password:D,role:z});O&&Object.keys(O).length>0&&await ce.updateUser(E.id,O),await ce.createNotification({userId:E.id,message:`Welcome ${E.name}! Your account has been created.`,type:"greeting"}),m({message:"User created successfully!",type:"success"})}setTimeout(()=>n("/admin/users"),1500)}catch(M){m({message:M.message||"Failed to save user.",type:"error"})}finally{a(!1)}};return s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:t?"Edit User":"Add User"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(nd,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:t?"Edit User":"Add New User"}),r.jsx("p",{className:"text-sm text-gray-400",children:t?"Update user information below.":"Create a new user account with initial credentials."})]}),r.jsxs("form",{onSubmit:v(Y),className:"space-y-4",children:[r.jsx(be,{label:"Full Name",id:"name",registration:x("name"),error:S.name?.message}),r.jsx(be,{label:"Email",id:"email",type:"email",registration:x("email"),error:S.email?.message}),r.jsx(Oe,{label:"Role",id:"role",registration:x("role"),error:S.role?.message,children:c.map(j=>r.jsx("option",{value:j.id,children:j.displayName},j.id))}),!t&&r.jsx(be,{label:"Password",id:"password",type:"password",registration:x("password"),error:S.password?.message}),W==="site_manager"&&r.jsxs(Oe,{label:"Assigned Site",id:"organizationId",...x("organizationId"),error:S.organizationId?.message,onChange:_,children:[r.jsx("option",{value:"",children:"Select a Site"}),o.map(j=>r.jsx("option",{value:j.id,children:j.shortName},j.id))]})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/admin/users"),disabled:i,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:v(Y),disabled:i,className:"fo-btn-primary flex-1",children:i?"Saving...":t?"Save Changes":"Create User"})]}),h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(nd,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:t?"Edit User":"Add New User"}),r.jsx("p",{className:"text-muted",children:t?"Update user information below.":"Create a new user account with initial credentials."})]})]}),r.jsxs("form",{onSubmit:v(Y),className:"space-y-6",children:[r.jsx(be,{label:"Full Name",id:"name",registration:x("name"),error:S.name?.message}),r.jsx(be,{label:"Email",id:"email",type:"email",registration:x("email"),error:S.email?.message}),r.jsx(Oe,{label:"Role",id:"role",registration:x("role"),error:S.role?.message,children:c.map(j=>r.jsx("option",{value:j.id,children:j.displayName},j.id))}),!t&&r.jsx(be,{label:"Password",id:"password",type:"password",registration:x("password"),error:S.password?.message}),W==="site_manager"&&r.jsxs(Oe,{label:"Assigned Site",id:"organizationId",...x("organizationId"),error:S.organizationId?.message,onChange:_,children:[r.jsx("option",{value:"",children:"Select a Site"}),o.map(j=>r.jsx("option",{value:j.id,children:j.shortName},j.id))]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/admin/users"),variant:"secondary",disabled:i,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:i,children:t?"Save Changes":"Create User"})]})]})]}),h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)})]})},ohe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState(""),[i,a]=k.useState(""),[o,l]=k.useState(!1),[c,d]=k.useState(null),h=async m=>{if(m.preventDefault(),!!t.trim()){l(!0);try{await ce.createPolicy({name:t.trim(),description:i.trim()}),d({message:"Policy created successfully!",type:"success"}),setTimeout(()=>n("/hr/policies-and-insurance"),1500)}catch{d({message:"Failed to save policy. Please try again.",type:"error"})}finally{l(!1)}}};return e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Add Policy"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(Cr,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Add New Policy"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create a new policy for your organization."})]}),r.jsxs("form",{onSubmit:h,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-muted mb-1",children:["Policy Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",value:t,onChange:m=>s(m.target.value),placeholder:"Policy Name (e.g., POSH)",className:"form-input",required:!0,disabled:o})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"description",value:i,onChange:m=>a(m.target.value),placeholder:"Description",className:"form-input",rows:4,disabled:o})]})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/hr/policies-and-insurance"),disabled:o,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:h,disabled:o||!t.trim(),className:"fo-btn-primary flex-1",children:o?"Saving...":"Save Policy"})]}),c&&r.jsx(It,{message:c.message,type:c.type,onDismiss:()=>d(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(Cr,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Add New Policy"}),r.jsx("p",{className:"text-muted",children:"Create a new policy for your organization."})]})]}),r.jsxs("form",{onSubmit:h,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-muted mb-1",children:["Policy Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",value:t,onChange:m=>s(m.target.value),placeholder:"Policy Name (e.g., POSH)",className:"form-input",required:!0,disabled:o})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-muted mb-1",children:"Description"}),r.jsx("textarea",{id:"description",value:i,onChange:m=>a(m.target.value),placeholder:"Description",className:"form-input",rows:4,disabled:o})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/hr/policies-and-insurance"),variant:"secondary",disabled:o,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:o,disabled:!t.trim(),children:"Save Policy"})]})]})]}),c&&r.jsx(It,{message:c.message,type:c.type,onDismiss:()=>d(null)})]})},lhe=Bt({title:pe().required("Title is required"),description:pe().required("Description is required"),category:pe().oneOf(["Software Developer","Admin","Operational","HR Query","Other"]).required("Category is required"),priority:pe().oneOf(["Low","Medium","High","Urgent"]).required("Priority is required"),assignedToId:pe().optional().nullable(),attachment:Et().optional().nullable()}).defined(),che=()=>{const n=vt(),{user:e}=bt(),[t,s]=k.useState(!1),[i,a]=k.useState([]),[o,l]=k.useState(null),c=jt("(max-width: 767px)"),{register:d,handleSubmit:h,control:m,formState:{errors:f}}=tn({resolver:Yn(lhe),defaultValues:{category:"Software Developer",priority:"Medium",assignedToId:null,attachment:null}}),p=pg({control:m,name:"category"});k.useEffect(()=>{ce.getUsers().then(a)},[]);const b=k.useMemo(()=>{if(!i)return[];switch(p){case"Software Developer":return i.filter(B=>B.role==="developer");case"Admin":return i.filter(B=>B.role==="admin");case"HR Query":return i.filter(B=>B.role==="hr");case"Operational":return i.filter(B=>["operation_manager","site_manager"].includes(B.role));default:const S=["admin","hr","developer","operation_manager","site_manager"];return i.filter(B=>S.includes(B.role))}},[i,p]),x=async S=>{if(e){s(!0);try{const B=i.find(V=>V.id===S.assignedToId);await ce.createSupportTicket({...S,attachment:S.attachment,status:"Open",raisedById:e.id,raisedByName:e.name,assignedToId:S.assignedToId||null,assignedToName:B?.name||null,resolvedAt:null,closedAt:null,rating:null,feedback:null}),l({message:"Ticket created successfully!",type:"success"}),setTimeout(()=>n("/support"),1500)}catch{l({message:"Failed to create ticket.",type:"error"})}finally{s(!1)}}},v="new-ticket-form";return c?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"New Support Ticket"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(W2,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Create New Ticket"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Submit a support request or report an issue."})]}),r.jsxs("form",{id:v,onSubmit:h(x),className:"space-y-4",children:[r.jsx(be,{placeholder:"Title / Subject",...d("title"),error:f.title?.message}),r.jsxs("div",{children:[r.jsx("textarea",{placeholder:"Description",...d("description"),rows:5,className:`form-input ${f.description?"form-input--error":""}`}),f.description&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:f.description.message})]}),r.jsx(ye,{name:"category",control:m,render:({field:S})=>r.jsxs(Oe,{...S,error:f.category?.message,children:[r.jsx("option",{children:"Software Developer"}),r.jsx("option",{children:"Admin"}),r.jsx("option",{children:"Operational"}),r.jsx("option",{children:"HR Query"}),r.jsx("option",{children:"Other"})]})}),r.jsx(ye,{name:"priority",control:m,render:({field:S})=>r.jsxs(Oe,{...S,error:f.priority?.message,children:[r.jsx("option",{children:"Low"}),r.jsx("option",{children:"Medium"}),r.jsx("option",{children:"High"}),r.jsx("option",{children:"Urgent"})]})}),r.jsx(ye,{name:"assignedToId",control:m,render:({field:S})=>r.jsxs(Oe,{...S,value:S.value??"",error:f.assignedToId?.message,children:[r.jsx("option",{value:"",children:"Unassigned"}),b.map(B=>r.jsxs("option",{value:B.id,children:[B.name," (",B.role.replace(/_/g," "),")"]},B.id))]})}),r.jsx(ye,{name:"attachment",control:m,render:({field:S,fieldState:B})=>r.jsx(pt,{label:"Attach Screenshot or Document (Image only)",file:S.value,onFileChange:S.onChange,allowedTypes:["image/jpeg","image/png","image/webp"],error:B.error?.message})})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/support"),disabled:t,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",form:v,disabled:t,className:"fo-btn-primary flex-1",children:t?"Creating...":"Create Ticket"})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(W2,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Create New Ticket"}),r.jsx("p",{className:"text-muted",children:"Submit a support request or report an issue."})]})]}),r.jsxs("form",{id:v,onSubmit:h(x),className:"space-y-6",children:[r.jsx(be,{label:"Title / Subject",...d("title"),error:f.title?.message}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted mb-1",children:"Description"}),r.jsx("textarea",{...d("description"),rows:5,className:`form-input ${f.description?"form-input--error":""}`}),f.description&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:f.description.message})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(ye,{name:"category",control:m,render:({field:S})=>r.jsxs(Oe,{label:"Category",...S,error:f.category?.message,children:[r.jsx("option",{children:"Software Developer"}),r.jsx("option",{children:"Admin"}),r.jsx("option",{children:"Operational"}),r.jsx("option",{children:"HR Query"}),r.jsx("option",{children:"Other"})]})}),r.jsx(ye,{name:"priority",control:m,render:({field:S})=>r.jsxs(Oe,{label:"Priority",...S,error:f.priority?.message,children:[r.jsx("option",{children:"Low"}),r.jsx("option",{children:"Medium"}),r.jsx("option",{children:"High"}),r.jsx("option",{children:"Urgent"})]})})]}),r.jsx(ye,{name:"assignedToId",control:m,render:({field:S})=>r.jsxs(Oe,{label:"Assigned To (Optional)",...S,value:S.value??"",error:f.assignedToId?.message,children:[r.jsx("option",{value:"",children:"Unassigned"}),b.map(B=>r.jsxs("option",{value:B.id,children:[B.name," (",B.role.replace(/_/g," "),")"]},B.id))]})}),r.jsx(ye,{name:"attachment",control:m,render:({field:S,fieldState:B})=>r.jsx(pt,{label:"Attach Screenshot or Document (Image only)",file:S.value,onFileChange:S.onChange,allowedTypes:["image/jpeg","image/png","image/webp"],error:B.error?.message})}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/support"),variant:"secondary",disabled:t,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:t,children:"Create Ticket"})]})]})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]})},dhe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState(""),[i,a]=k.useState(!1),[o,l]=k.useState(null),c=async d=>{if(d.preventDefault(),!!t.trim()){a(!0);try{const h={id:`group_${Date.now()}`,name:t.trim(),locations:[],companies:[]};l({message:"Group created successfully!",type:"success"}),setTimeout(()=>n("/hr/entity-management"),1500)}catch{l({message:"Failed to create group. Please try again.",type:"error"})}finally{a(!1)}}};return e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Add Group"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Add New Group"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create a new organizational group."})]}),r.jsx("form",{onSubmit:c,className:"space-y-4",children:r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-muted mb-1",children:["Group Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",value:t,onChange:d=>s(d.target.value),placeholder:"Enter group name",className:"form-input",required:!0,disabled:i})]})})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/hr/entity-management"),disabled:i,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:c,disabled:i||!t.trim(),className:"fo-btn-primary flex-1",children:i?"Saving...":"Create Group"})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Add New Group"}),r.jsx("p",{className:"text-muted",children:"Create a new organizational group."})]})]}),r.jsxs("form",{onSubmit:c,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-muted mb-1",children:["Group Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"name",value:t,onChange:d=>s(d.target.value),placeholder:"Enter group name",className:"form-input",required:!0,disabled:i})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/hr/entity-management"),variant:"secondary",disabled:i,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:i,disabled:!t.trim(),children:"Create Group"})]})]})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]})},ghe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState([]),[i,a]=k.useState(""),[o,l]=k.useState(""),[c,d]=k.useState(""),[h,m]=k.useState(!1),[f,p]=k.useState(null),b=async x=>{if(x.preventDefault(),!(!i||!o||!c.trim())){m(!0);try{console.log("Granting comp off:",{userId:i,days:o,reason:c}),p({message:"Comp off granted successfully!",type:"success"}),setTimeout(()=>n("/hr/leave-management"),1500)}catch{p({message:"Failed to grant comp off.",type:"error"})}finally{m(!1)}}};return k.useEffect(()=>{(async()=>{try{const v=await ce.getUsers();s(v)}catch{p({message:"Failed to load users.",type:"error"})}})()},[]),e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Grant Comp Off"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(R2,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Grant Compensatory Off"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Grant comp off days to an employee."})]}),r.jsxs("form",{onSubmit:b,className:"space-y-4",children:[r.jsxs(Oe,{label:"Select Employee",id:"user",value:i,onChange:x=>a(x.target.value),error:!i&&i!==""?"Please select an employee":"",children:[r.jsx("option",{value:"",children:"Select an employee"}),t.map(x=>r.jsxs("option",{value:x.id,children:[x.name," - ",x.role]},x.id))]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"days",className:"block text-sm font-medium text-muted mb-1",children:["Number of Days ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"days",type:"number",step:"0.5",min:"0.5",value:o,onChange:x=>l(x.target.value),placeholder:"e.g. 1, 0.5, 2",className:"form-input",required:!0,disabled:h})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-muted mb-1",children:["Reason ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("textarea",{id:"reason",value:c,onChange:x=>d(x.target.value),placeholder:"Reason for granting comp off",className:"form-input",rows:4,required:!0,disabled:h})]})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/hr/leave-management"),disabled:h,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:b,disabled:h||!i||!o||!c.trim(),className:"fo-btn-primary flex-1",children:h?"Granting...":"Grant Comp Off"})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(R2,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Grant Compensatory Off"}),r.jsx("p",{className:"text-muted",children:"Grant comp off days to an employee."})]})]}),r.jsxs("form",{onSubmit:b,className:"space-y-6",children:[r.jsxs(Oe,{label:"Select Employee",id:"user",value:i,onChange:x=>a(x.target.value),children:[r.jsx("option",{value:"",children:"Select an employee"}),t.map(x=>r.jsxs("option",{value:x.id,children:[x.name," - ",x.role]},x.id))]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"days",className:"block text-sm font-medium text-muted mb-1",children:["Number of Days ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{id:"days",type:"number",step:"0.5",min:"0.5",value:o,onChange:x=>l(x.target.value),placeholder:"e.g. 1, 0.5, 2",className:"form-input",required:!0,disabled:h})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"reason",className:"block text-sm font-medium text-muted mb-1",children:["Reason ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("textarea",{id:"reason",value:c,onChange:x=>d(x.target.value),placeholder:"Reason for granting comp off",className:"form-input",rows:4,required:!0,disabled:h})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/hr/leave-management"),variant:"secondary",disabled:h,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:h,disabled:!i||!o||!c.trim(),children:"Grant Comp Off"})]})]})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]})},uhe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState(""),[i,a]=k.useState(""),[o,l]=k.useState([]),[c,d]=k.useState(!1),[h,m]=k.useState(null),f=async x=>{if(x.preventDefault(),!(!t.trim()||!i.trim())){d(!0);try{const v={id:t.toLowerCase().replace(/\s+/g,"_"),name:t.trim(),description:i.trim(),permissions:o},S=await ce.getModules();if(S.some(V=>V.id===v.id)){m({message:"Module with this ID already exists.",type:"error"}),d(!1);return}const B=[...S,v];await ce.saveModules(B),m({message:"Module created successfully!",type:"success"}),setTimeout(()=>n("/admin/modules"),1500)}catch(v){console.error("Failed to create module:",v),m({message:"Failed to create module. Please try again.",type:"error"})}finally{d(!1)}}},p=(x,v)=>{l(S=>v?[...S,x]:S.filter(B=>B!==x))},b=()=>r.jsxs("form",{onSubmit:f,className:"space-y-6",children:[r.jsx(be,{label:"Module Name",id:"name",value:t,onChange:x=>s(x.target.value),placeholder:"e.g. HR Tasks & Management",required:!0,disabled:c,error:!t.trim()&&t!==""?"Module name is required":""}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-muted mb-1",children:["Description ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("textarea",{id:"description",value:i,onChange:x=>a(x.target.value),placeholder:"Manage leaves, policies, insurance, uniforms, and tasks.",className:"form-input",rows:4,required:!0,disabled:c})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Permissions"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2 p-4 border rounded-lg h-64 overflow-y-auto bg-page",children:Ou.map(x=>r.jsx(Nn,{id:`perm-${x.key}`,label:x.name,checked:o.includes(x.key),onChange:v=>p(x.key,v),disabled:c},x.key))})]}),e?r.jsxs("div",{className:"flex gap-4 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/admin/modules"),disabled:c,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:c||!t.trim()||!i.trim(),className:"fo-btn-primary flex-1",children:c?"Creating...":"Create Module"})]}):r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/admin/modules"),variant:"secondary",disabled:c,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:c,disabled:!t.trim()||!i.trim(),children:"Create Module"})]})]});return e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Add Module"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(Tu,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Add New Module"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create a new system module."})]}),b()]})}),h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(Tu,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Add New Module"}),r.jsx("p",{className:"text-muted",children:"Create a new system module."})]})]}),b()]}),h&&r.jsx(It,{message:h.message,type:h.type,onDismiss:()=>m(null)})]})},TY=()=>{const n=vt(),{id:e}=Bg(),t=!!e,s=jt("(max-width: 767px)"),{permissions:i,setRolePermissions:a,addRolePermissionEntry:o}=ha(),[l,c]=k.useState(""),[d,h]=k.useState(""),[m,f]=k.useState([]),[p,b]=k.useState(!1),[x,v]=k.useState(null);k.useEffect(()=>{(async()=>{try{if(t&&e){const W=(await ce.getRoles()).find(_=>_.id===e);if(W){c(W.id),h(W.displayName);const _=i[W.id]||[];f(_)}}}catch{v({message:"Failed to load data.",type:"error"})}})()},[e,t,i]);const S=V=>{f(R=>R.includes(V)?R.filter(W=>W!==V):[...R,V])},B=async V=>{if(V.preventDefault(),!(!l.trim()||!d.trim())){b(!0);try{const R=t?l:l.toLowerCase().replace(/\s+/g,"_"),W={id:R,displayName:d.trim()},_=await ce.getRoles();let Y=[..._];if(t)Y=Y.map(j=>j.id===R?W:j);else{if(_.some(j=>j.id===R)){v({message:"Role ID already exists.",type:"error"}),b(!1);return}Y.push(W)}await ce.saveRoles(Y),a(R,m),t||o(W),v({message:`Role ${t?"updated":"created"} successfully!`,type:"success"}),setTimeout(()=>n("/admin/roles"),1500)}catch{v({message:"Failed to save role. Please try again.",type:"error"})}finally{b(!1)}}};return s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:t?"Edit Role":"Add Role"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(km,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:t?"Edit Role":"Add New Role"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Define role permissions and access control."})]}),r.jsxs("form",{onSubmit:B,className:"space-y-4",children:[r.jsx(be,{label:"Role ID",id:"roleId",value:l,onChange:V=>c(V.target.value),placeholder:"e.g. admin, hr, field_officer",required:!0,disabled:p||t}),r.jsx(be,{label:"Display Name",id:"displayName",value:d,onChange:V=>h(V.target.value),placeholder:"e.g. Admin, HR, Field Officer",required:!0,disabled:p}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-muted mb-2",children:"Permissions"}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Ou.map(V=>r.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-page cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:m.includes(V.key),onChange:()=>S(V.key),className:"form-checkbox",disabled:p}),r.jsx("span",{className:"text-sm",children:V.name})]},V.key))})]})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/admin/roles"),disabled:p,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:B,disabled:p||!l.trim()||!d.trim(),className:"fo-btn-primary flex-1",children:p?"Saving...":t?"Save Changes":"Create Role"})]}),x&&r.jsx(It,{message:x.message,type:x.type,onDismiss:()=>v(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(km,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:t?"Edit Role":"Add New Role"}),r.jsx("p",{className:"text-muted",children:"Define role permissions and access control."})]})]}),r.jsxs("form",{onSubmit:B,className:"space-y-6",children:[r.jsx(be,{label:"Role ID",id:"roleId",value:l,onChange:V=>c(V.target.value),placeholder:"e.g. admin, hr, field_officer",required:!0,disabled:p||t}),r.jsx(be,{label:"Display Name",id:"displayName",value:d,onChange:V=>h(V.target.value),placeholder:"e.g. Admin, HR, Field Officer",required:!0,disabled:p}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-muted mb-2",children:["Permissions (",m.length," selected)"]}),r.jsx("div",{className:"border border-border rounded-lg p-4 space-y-2 max-h-96 overflow-y-auto",children:Ou.map(V=>r.jsxs("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-page cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:m.includes(V.key),onChange:()=>S(V.key),className:"form-checkbox",disabled:p}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium",children:V.name}),V.description&&r.jsx("div",{className:"text-xs text-muted",children:V.description})]})]},V.key))})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/admin/roles"),variant:"secondary",disabled:p,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:p,disabled:!l.trim()||!d.trim(),children:t?"Save Changes":"Create Role"})]})]})]}),x&&r.jsx(It,{message:x.message,type:x.type,onDismiss:()=>v(null)})]})},hhe=Bt({groupId:pe().required("Please select a group"),companyId:pe().required("Please select a company"),clientId:pe().required("Please select a client"),manpowerCount:mr().typeError("Must be a number").min(0,"Cannot be negative").required("Manpower count is required")}).defined(),mhe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState([]),[i,a]=k.useState(!0),[o,l]=k.useState(!1),[c,d]=k.useState(""),[h,m]=k.useState(!1),[f,p]=k.useState(null),b=k.useRef(null),{register:x,handleSubmit:v,watch:S,formState:{errors:B},setValue:V}=tn({resolver:Yn(hhe)}),R=S("groupId"),W=S("companyId");k.useEffect(()=>{a(!0),ce.getOrganizationStructure().then(s).catch(()=>p({message:"Failed to load organization structure.",type:"error"})).finally(()=>a(!1))},[]),k.useEffect(()=>{V("companyId",""),V("clientId",""),d("")},[R,V]),k.useEffect(()=>{V("clientId",""),d("")},[W,V]),k.useEffect(()=>{const D=z=>{b.current&&!b.current.contains(z.target)&&m(!1)};return document.addEventListener("mousedown",D),()=>document.removeEventListener("mousedown",D)},[]);const _=k.useMemo(()=>t.find(D=>D.id===R)?.companies||[],[t,R]),Y=k.useMemo(()=>_.find(D=>D.id===W)?.entities||[],[_,W]),j=k.useMemo(()=>c?Y.filter(D=>D.name.toLowerCase().includes(c.toLowerCase())):Y,[Y,c]),M=D=>{V("clientId",D.id,{shouldValidate:!0}),d(D.name),m(!1)},H=async D=>{const z=Y.find(O=>O.id===D.clientId);if(z){l(!0);try{if((await ce.getOrganizations()).some(te=>te.id===z.organizationId)){p({message:"A site for this client already exists.",type:"error"}),l(!1);return}const E={id:z.organizationId||`site_${Date.now()}`,shortName:z.name,fullName:z.name,address:z.location||z.registeredAddress||"",manpowerApprovedCount:D.manpowerCount};await ce.createOrganization(E),p({message:"Site added successfully!",type:"success"}),setTimeout(()=>n("/admin/sites"),1500)}catch{p({message:"Failed to add site. Please try again.",type:"error"})}finally{l(!1)}}};return e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Add Site"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Add Site from Client"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create a new site from an existing client entity."})]}),i?r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("form",{onSubmit:v(H),className:"space-y-4",children:[r.jsxs(Oe,{label:"Group",id:"groupId",registration:x("groupId"),error:B.groupId?.message,children:[r.jsx("option",{value:"",children:"Select a Group"}),t.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]}),r.jsxs(Oe,{label:"Company",id:"companyId",registration:x("companyId"),error:B.companyId?.message,disabled:!R,children:[r.jsx("option",{value:"",children:"Select a Company"}),_.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]}),r.jsxs("div",{className:"relative",ref:b,children:[r.jsx(be,{label:"Client",id:"clientSearch",value:c,onChange:D=>{d(D.target.value),m(!0),V("clientId","")},onFocus:()=>m(!0),disabled:!W,error:B.clientId?.message,autoComplete:"off"}),h&&j.length>0&&r.jsx("ul",{className:"absolute z-10 w-full bg-card border border-border rounded-lg mt-1 max-h-48 overflow-y-auto shadow-lg",children:j.map(D=>r.jsx("li",{onClick:()=>M(D),className:"px-3 py-2 text-sm cursor-pointer hover:bg-page",children:D.name},D.id))})]}),r.jsx(be,{label:"Approved Manpower Count",id:"manpowerCount",type:"number",registration:x("manpowerCount"),error:B.manpowerCount?.message})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/admin/sites"),disabled:o,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:v(H),disabled:o||i,className:"fo-btn-primary flex-1",children:o?"Adding...":"Add Site"})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(oa,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Add Site from Client"}),r.jsx("p",{className:"text-muted",children:"Create a new site from an existing client entity."})]})]}),i?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("form",{onSubmit:v(H),className:"space-y-6",children:[r.jsxs(Oe,{label:"Group",id:"groupId",registration:x("groupId"),error:B.groupId?.message,children:[r.jsx("option",{value:"",children:"Select a Group"}),t.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]}),r.jsxs(Oe,{label:"Company",id:"companyId",registration:x("companyId"),error:B.companyId?.message,disabled:!R,children:[r.jsx("option",{value:"",children:"Select a Company"}),_.map(D=>r.jsx("option",{value:D.id,children:D.name},D.id))]}),r.jsxs("div",{className:"relative",ref:b,children:[r.jsx(be,{label:"Client",id:"clientSearch",value:c,onChange:D=>{d(D.target.value),m(!0),V("clientId","")},onFocus:()=>m(!0),disabled:!W,error:B.clientId?.message,autoComplete:"off"}),h&&j.length>0&&r.jsx("ul",{className:"absolute z-10 w-full bg-card border border-border rounded-lg mt-1 max-h-48 overflow-y-auto shadow-lg",children:j.map(D=>r.jsx("li",{onClick:()=>M(D),className:"px-3 py-2 text-sm cursor-pointer hover:bg-page",children:D.name},D.id))})]}),r.jsx(be,{label:"Approved Manpower Count",id:"manpowerCount",type:"number",registration:x("manpowerCount"),error:B.manpowerCount?.message}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/admin/sites"),variant:"secondary",disabled:o,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:o,children:"Add Site"})]})]})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]})},Ihe=()=>{const n=vt(),e=jt("(max-width: 767px)"),[t,s]=k.useState(""),[i,a]=k.useState(!1),[o,l]=k.useState(null),c=async d=>{if(d.preventDefault(),!!t.trim()){a(!0);try{const h={id:`SITE-${t.toUpperCase().replace(/\s/g,"").substring(0,4)}-${Date.now()%1e3}`,shortName:t.trim(),fullName:t.trim(),address:"To be configured",provisionalCreationDate:new Date().toISOString()};await ce.createOrganization(h),l({message:`Provisional site '${t}' created.`,type:"success"}),setTimeout(()=>n("/admin/sites"),1500)}catch(h){const m=h?.message||h?.error?.message||"Failed to create site.";l({message:`Failed to create site: ${m}`,type:"error"})}finally{a(!1)}}};return e?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:"Quick Add Site"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(CZ,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:"Quick Add Provisional Site"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Create a new site with a 90-day grace period."})]}),r.jsxs("form",{onSubmit:c,className:"space-y-4",children:[r.jsx(be,{label:"New Site Name",id:"quick-add-site-name",value:t,onChange:d=>s(d.target.value),placeholder:"e.g. New Project Site",required:!0,disabled:i,autoFocus:!0}),r.jsx("p",{className:"text-xs text-muted",children:"This will create a new site with a 90-day grace period to complete the full configuration."})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/admin/sites"),disabled:i,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:c,disabled:i||!t.trim(),className:"fo-btn-primary flex-1",children:i?"Adding...":"Add Site"})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-2xl",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(CZ,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:"Quick Add Provisional Site"}),r.jsx("p",{className:"text-muted",children:"Create a new site with a 90-day grace period to complete the full configuration."})]})]}),r.jsxs("form",{onSubmit:c,className:"space-y-6",children:[r.jsx(be,{label:"New Site Name",id:"quick-add-site-name",value:t,onChange:d=>s(d.target.value),placeholder:"e.g. New Project Site",required:!0,disabled:i,autoFocus:!0}),r.jsx("p",{className:"text-sm text-muted -mt-4",children:"This will create a new site with a 90-day grace period to complete the full configuration."}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/admin/sites"),variant:"secondary",disabled:i,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:i,disabled:!t.trim(),children:"Add Site"})]})]})]}),o&&r.jsx(It,{message:o.message,type:o.type,onDismiss:()=>l(null)})]})},Che=Bt({name:pe().required("Task name is required"),description:pe().required("Description is required"),dueDate:pe().required("A due date is required").nullable(),priority:pe().oneOf(["Low","Medium","High"]).required("Priority is required"),assignedToId:pe().required("An assignee is required"),escalationLevel1UserId:pe().optional(),escalationLevel1DurationDays:mr().when("escalationLevel1UserId",{is:n=>!!n,then:n=>n.required("Duration is required").min(0).typeError("Must be a number"),otherwise:n=>n.optional().nullable()}),escalationLevel2UserId:pe().optional(),escalationLevel2DurationDays:mr().when("escalationLevel2UserId",{is:n=>!!n,then:n=>n.required("Duration is required").min(0).typeError("Must be a number"),otherwise:n=>n.optional().nullable()}),escalationEmail:pe().email("Must be a valid email address").optional(),escalationEmailDurationDays:mr().when("escalationEmail",{is:n=>!!n,then:n=>n.required("Duration is required").min(0).typeError("Must be a number"),otherwise:n=>n.optional().nullable()})}).defined(),EY=()=>{const n=vt(),{id:e}=Bg(),t=!!e,s=jt("(max-width: 767px)"),{createTask:i,updateTask:a,tasks:o}=cB(),[l,c]=k.useState(!1),[d,h]=k.useState([]),[m,f]=k.useState(null),{permissions:p}=ha(),{fetchNotifications:b}=Sp(),{theme:x}=Fl(),{colorScheme:v}=an(),S=Is(v),B=x==="dark"||S.isDark,{register:V,handleSubmit:R,formState:{errors:W},reset:_,control:Y,watch:j}=tn({resolver:Yn(Che),defaultValues:{priority:"Medium",assignedToId:"",dueDate:null}}),M=j("escalationLevel1UserId"),H=j("escalationLevel2UserId"),D=j("escalationEmail"),z=async ne=>{c(!0);try{t&&e?(await a(e,ne),f({message:"Task updated successfully",type:"success"})):(await i(ne),f({message:"Task created successfully",type:"success"})),setTimeout(()=>n("/tasks"),1500)}catch(K){console.error("Failed to save task:",K),f({message:"Failed to save task. Please try again.",type:"error"}),c(!1)}},O="!text-white !border-white/10 !placeholder-slate-400 !rounded-xl focus:!ring-2 focus:!ring-opacity-50",E="text-gray-300 font-medium mb-1.5 block",te="",q="block text-sm font-medium text-muted mb-1",de=B?O:te,U=B?{backgroundColor:S.sidebarBg,borderColor:"rgba(255,255,255,0.1)"}:{},P=B?E:q;return s?r.jsxs("div",{className:"h-full flex flex-col",style:{backgroundColor:B?S.mobileBg:void 0,color:B?"white":void 0},children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:t?"Edit Task":"Add Task"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"rounded-2xl p-6 space-y-6",style:{backgroundColor:B?S.sidebarBg:"white",borderColor:B?"rgba(255,255,255,0.1)":void 0,borderWidth:B?1:0},children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-block p-3 rounded-full mb-2 ${B?"bg-white/10":"bg-accent-light"}`,children:r.jsx(Rm,{className:`h-8 w-8 ${B?"text-white":"text-accent-dark"}`})}),r.jsx("h2",{className:`text-xl font-bold ${B?"text-white":"text-primary-text"}`,children:t?"Edit Task":"Create New Task"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Assign tasks and set deadlines."})]}),r.jsxs("form",{onSubmit:R(z),className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"name",className:P,children:"Task Name"}),r.jsx(be,{id:"name",registration:V("name"),error:W.name?.message,className:de,style:U,placeholder:B?"Enter task name":""})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"description",className:P,children:"Description"}),r.jsx("textarea",{id:"description",rows:4,...V("description"),className:B?`w-full ${de} px-3 py-3 outline-none`:`mt-1 bg-card border ${W.description?"border-red-500":"border-border"} rounded-lg px-3 py-2.5 w-full sm:text-sm focus:ring-1 focus:ring-accent`,style:B?U:{},placeholder:B?"Enter task description":""}),W.description&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:W.description.message})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:P,children:"Due Date"}),r.jsx(ye,{name:"dueDate",control:Y,render:({field:ne})=>r.jsx(Vn,{label:"",id:"dueDate",value:ne.value,onChange:ne.onChange,error:W.dueDate?.message,minDate:new Date,className:de,style:U})})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"priority",className:P,children:"Priority"}),r.jsxs(Oe,{id:"priority",registration:V("priority"),error:W.priority?.message,className:de,style:U,children:[r.jsx("option",{value:"Low",style:B?{backgroundColor:S.sidebarBg}:{},children:"Low"}),r.jsx("option",{value:"Medium",style:B?{backgroundColor:S.sidebarBg}:{},children:"Medium"}),r.jsx("option",{value:"High",style:B?{backgroundColor:S.sidebarBg}:{},children:"High"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"assignedToId",className:P,children:"Assign To"}),r.jsxs(Oe,{id:"assignedToId",registration:V("assignedToId"),error:W.assignedToId?.message,className:de,style:U,children:[r.jsx("option",{value:"",style:B?{backgroundColor:S.sidebarBg}:{},children:"Select User"}),d.map(ne=>r.jsxs("option",{value:ne.id,style:B?{backgroundColor:S.sidebarBg}:{},children:[ne.name," (",ne.role.replace(/_/g," "),")"]},ne.id))]})]})]})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/tasks"),disabled:l,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:R(z),disabled:l,className:"fo-btn-primary flex-1",children:l?"Saving...":t?"Save Changes":"Create Task"})]}),m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)})]}):r.jsxs("div",{className:`p-4 md:p-6 ${B?"text-white":""}`,children:[r.jsxs("div",{className:`p-8 rounded-xl shadow-card w-full max-w-3xl mx-auto ${B?"":"bg-card"}`,style:B?{backgroundColor:S.sidebarBg,borderColor:"rgba(255,255,255,0.1)",borderWidth:1}:{},children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:`p-3 rounded-full mr-4 ${B?"bg-white/10":"bg-accent-light"}`,children:r.jsx(Rm,{className:`h-8 w-8 ${B?"text-white":"text-accent-dark"}`})}),r.jsxs("div",{children:[r.jsx("h2",{className:`text-2xl font-bold ${B?"text-white":"text-primary-text"}`,children:t?"Edit Task":"Create New Task"}),r.jsx("p",{className:B?"text-gray-400":"text-muted",children:"Assign tasks and set deadlines."})]})]}),r.jsxs("form",{onSubmit:R(z),className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{htmlFor:"name",className:P,children:"Task Name"}),r.jsx(be,{id:"name",registration:V("name"),error:W.name?.message,className:de,style:U,placeholder:B?"Enter task name":""})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{htmlFor:"description",className:P,children:"Description"}),r.jsx("textarea",{id:"description",rows:4,...V("description"),className:B?`w-full ${de} px-3 py-3 outline-none`:`mt-1 bg-card border ${W.description?"border-red-500":"border-border"} rounded-lg px-3 py-2.5 w-full sm:text-sm focus:ring-1 focus:ring-accent`,style:B?U:{},placeholder:B?"Enter task description":""}),W.description&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:W.description.message})]}),r.jsxs("div",{children:[r.jsx("label",{className:P,children:"Due Date"}),r.jsx(ye,{name:"dueDate",control:Y,render:({field:ne})=>r.jsx(Vn,{label:"",id:"dueDate",value:ne.value,onChange:ne.onChange,error:W.dueDate?.message,minDate:new Date,className:de,style:U})})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"priority",className:P,children:"Priority"}),r.jsxs(Oe,{id:"priority",registration:V("priority"),error:W.priority?.message,className:de,style:U,children:[r.jsx("option",{value:"Low",style:B?{backgroundColor:S.sidebarBg}:{},children:"Low"}),r.jsx("option",{value:"Medium",style:B?{backgroundColor:S.sidebarBg}:{},children:"Medium"}),r.jsx("option",{value:"High",style:B?{backgroundColor:S.sidebarBg}:{},children:"High"})]})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{htmlFor:"assignedToId",className:P,children:"Assign To"}),r.jsxs(Oe,{id:"assignedToId",registration:V("assignedToId"),error:W.assignedToId?.message,className:de,style:U,children:[r.jsx("option",{value:"",style:B?{backgroundColor:S.sidebarBg}:{},children:"Select User"}),d.map(ne=>r.jsxs("option",{value:ne.id,style:B?{backgroundColor:S.sidebarBg}:{},children:[ne.name," (",ne.role.replace(/_/g," "),")"]},ne.id))]})]})]}),r.jsxs("div",{className:`pt-6 border-t ${B?"border-white/10":"border-border"}`,children:[r.jsx("h4",{className:`text-lg font-semibold ${B?"text-white":"text-primary-text"} mb-1`,children:"Escalation Matrix (Optional)"}),r.jsx("p",{className:`text-sm ${B?"text-gray-400":"text-muted"} mb-6`,children:"Define who gets notified if this task becomes overdue."}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"escalationLevel1UserId",className:P,children:"Escalation Level 1"}),r.jsxs(Oe,{id:"escalationLevel1UserId",registration:V("escalationLevel1UserId"),error:W.escalationLevel1UserId?.message,className:de,style:U,children:[r.jsx("option",{value:"",style:B?{backgroundColor:S.sidebarBg}:{},children:"Select User"}),d.map(ne=>r.jsx("option",{value:ne.id,style:B?{backgroundColor:S.sidebarBg}:{},children:ne.name},ne.id))]})]}),M&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"escalationLevel1DurationDays",className:P,children:"Days until L1 Escalation"}),r.jsx(be,{id:"escalationLevel1DurationDays",type:"number",registration:V("escalationLevel1DurationDays"),error:W.escalationLevel1DurationDays?.message,className:de,style:U})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"escalationLevel2UserId",className:P,children:"Escalation Level 2"}),r.jsxs(Oe,{id:"escalationLevel2UserId",registration:V("escalationLevel2UserId"),error:W.escalationLevel2UserId?.message,className:de,style:U,children:[r.jsx("option",{value:"",style:B?{backgroundColor:S.sidebarBg}:{},children:"Select User"}),d.map(ne=>r.jsx("option",{value:ne.id,style:B?{backgroundColor:S.sidebarBg}:{},children:ne.name},ne.id))]})]}),H&&r.jsxs("div",{children:[r.jsx("label",{htmlFor:"escalationLevel2DurationDays",className:P,children:"Days until L2 Escalation"}),r.jsx(be,{id:"escalationLevel2DurationDays",type:"number",registration:V("escalationLevel2DurationDays"),error:W.escalationLevel2DurationDays?.message,className:de,style:U})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{htmlFor:"escalationEmail",className:P,children:"Final Escalation Email"}),r.jsx(be,{id:"escalationEmail",type:"email",registration:V("escalationEmail"),error:W.escalationEmail?.message,className:de,style:U,placeholder:B?"Enter email address":""})]}),D&&r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{htmlFor:"escalationEmailDurationDays",className:P,children:"Days until Final Escalation"}),r.jsx(be,{id:"escalationEmailDurationDays",type:"number",registration:V("escalationEmailDurationDays"),error:W.escalationEmailDurationDays?.message,className:de,style:U})]})]})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/tasks"),variant:"secondary",disabled:l,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:l,children:t?"Save Changes":"Create Task"})]})]})]}),m&&r.jsx(It,{message:m.message,type:m.type,onDismiss:()=>f(null)})]})},Yc=({title:n,sizes:e,headers:t,control:s,quantityType:i,quantities:a,readOnly:o=!1})=>{const l=Array.from(new Set(e.map(d=>d.fit))),c=Array.from(new Set(e.map(d=>d.size))).sort((d,h)=>{const m=parseInt(String(d)),f=parseInt(String(h));return!isNaN(m)&&!isNaN(f)?m-f:String(d).localeCompare(String(h))});return r.jsxs("div",{className:"border rounded-lg flex flex-col overflow-hidden bg-card",children:[r.jsx("h4",{className:"p-3 font-semibold bg-gray-50 dark:bg-white/5 border-b flex-shrink-0",children:n}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-white/5",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:"Size"}),t.map(d=>r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted",children:d.label},String(d.key))),r.jsx("th",{className:"px-2 py-2 text-left font-medium text-muted w-20",children:"Qty"})]})}),r.jsx("tbody",{className:"divide-y dark:divide-white/10",children:c.map(d=>r.jsx(ot.Fragment,{children:l.map((h,m)=>{const f=e.find(p=>p.size===d&&p.fit===h);return f?r.jsxs("tr",{children:[m===0&&r.jsx("td",{rowSpan:l.filter(p=>e.some(b=>b.size===d&&b.fit===p)).length,className:"px-2 py-2 align-middle font-semibold border-r dark:border-white/10",children:d}),t.map(p=>r.jsx("td",{className:"px-2 py-2",children:f[p.key]},String(p.key))),r.jsx("td",{className:"px-2 py-2",children:o?r.jsx("span",{className:"font-semibold block text-center pr-4",children:a?.[f.id]||0}):r.jsx(ye,{name:`${i}.${f.id}`,control:s,render:({field:p})=>r.jsx(be,{"aria-label":`Quantity for ${n} size ${d} ${h}`,type:"number",...p,value:p.value||"",onChange:b=>p.onChange(parseInt(b.target.value)||null),className:"!py-1.5"})})})]},f.id):null})},d))})]})})]})},DY=()=>{const n=vt(),{id:e}=Bg(),t=!!e,s=jt("(max-width: 767px)"),[i,a]=k.useState([]),[o,l]=k.useState(null),[c,d]=k.useState(!0),[h,m]=k.useState(!1),[f,p]=k.useState(null),[b,x]=k.useState(null),{register:v,control:S,handleSubmit:B,watch:V,reset:R}=tn({defaultValues:{siteId:"",gender:"Gents",pantsQuantities:{},shirtsQuantities:{}}}),W=V("gender");k.useEffect(()=>{(async()=>{d(!0);try{const[j,M,H]=await Promise.all([ce.getOrganizations(),ce.getMasterGentsUniforms(),ce.getMasterLadiesUniforms()]);if(a(j),l({gents:M,ladies:H}),t&&e){const z=(await ce.getUniformRequests()).find(O=>O.id===e);if(z){x(z);const O={},E={};z.items.forEach(te=>{te.category==="Pants"?O[te.sizeId]=te.quantity:E[te.sizeId]=te.quantity}),R({siteId:z.siteId,gender:z.gender,pantsQuantities:O,shirtsQuantities:E})}else p({message:"Request not found.",type:"error"}),setTimeout(()=>n("/uniforms"),2e3)}}catch{p({message:"Failed to load data.",type:"error"})}finally{d(!1)}})()},[e,t,n,R]);const _=async Y=>{if(!o)return;const j=i.find(M=>M.id===Y.siteId);if(j){m(!0);try{const M=W==="Gents"?[...o.gents.pants,...o.gents.shirts]:[...o.ladies.pants,...o.ladies.shirts],H=[];for(const[z,O]of Object.entries(Y.pantsQuantities))if(O&&O>0){const E=M.find(te=>te.id===z);E&&H.push({sizeId:z,quantity:O,category:"Pants",sizeLabel:E.size,fit:E.fit})}for(const[z,O]of Object.entries(Y.shirtsQuantities))if(O&&O>0){const E=M.find(te=>te.id===z);E&&H.push({sizeId:z,quantity:O,category:"Shirts",sizeLabel:E.size,fit:E.fit})}const D={id:b?.id||`new_${Date.now()}`,siteId:Y.siteId,siteName:j.shortName,gender:Y.gender,requestedDate:b?.requestedDate||new Date().toISOString(),status:b?.status||"Pending",items:H};D.id.startsWith("new_")?(await ce.submitUniformRequest(D),p({message:"New request submitted.",type:"success"})):(await ce.updateUniformRequest(D),p({message:"Request updated.",type:"success"})),setTimeout(()=>n("/uniforms"),1500)}catch{p({message:"Failed to save request.",type:"error"})}finally{m(!1)}}};return c?r.jsx("div",{className:"flex justify-center items-center h-screen",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-emerald-600"})}):o?s?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("header",{className:"p-4 flex-shrink-0 fo-mobile-header",children:r.jsx("h1",{children:t?"Edit Request":"New Request"})}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"bg-card rounded-2xl p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"inline-block bg-accent-light p-3 rounded-full mb-2",children:r.jsx(Lu,{className:"h-8 w-8 text-accent-dark"})}),r.jsx("h2",{className:"text-xl font-bold text-primary-text",children:t?"Edit Uniform Request":"New Uniform Request"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Submit a request for new uniforms."})]}),r.jsxs("form",{onSubmit:B(_),className:"space-y-6",children:[r.jsxs(Oe,{label:"Select Site",...v("siteId"),required:!0,children:[r.jsx("option",{value:"",children:"-- Select a Site --"}),i.map(Y=>r.jsx("option",{value:Y.id,children:Y.shortName},Y.id))]}),r.jsxs(Oe,{label:"Select Uniform Type",...v("gender"),children:[r.jsx("option",{children:"Gents"}),r.jsx("option",{children:"Ladies"})]}),r.jsx("div",{className:"space-y-6",children:W==="Gents"?r.jsxs(r.Fragment,{children:[r.jsx(Yc,{title:"Gents' Pants",sizes:o.gents.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],control:S,quantityType:"pantsQuantities"}),r.jsx(Yc,{title:"Gents' Shirts",sizes:o.gents.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],control:S,quantityType:"shirtsQuantities"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yc,{title:"Ladies' Pants",sizes:o.ladies.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:S,quantityType:"pantsQuantities"}),r.jsx(Yc,{title:"Ladies' Shirts",sizes:o.ladies.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],control:S,quantityType:"shirtsQuantities"})]})})]})]})}),r.jsxs("footer",{className:"p-4 flex-shrink-0 flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>n("/uniforms"),disabled:h,className:"fo-btn-secondary px-6",children:"Cancel"}),r.jsx("button",{type:"submit",onClick:B(_),disabled:h,className:"fo-btn-primary flex-1",children:h?"Saving...":"Save Request"})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"bg-card p-8 rounded-xl shadow-card w-full max-w-5xl mx-auto",children:[r.jsxs("div",{className:"flex items-center mb-6",children:[r.jsx("div",{className:"bg-accent-light p-3 rounded-full mr-4",children:r.jsx(Lu,{className:"h-8 w-8 text-accent-dark"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-primary-text",children:t?"Edit Uniform Request":"New Uniform Request"}),r.jsx("p",{className:"text-muted",children:"Submit a request for new uniforms."})]})]}),r.jsxs("form",{onSubmit:B(_),className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs(Oe,{label:"Select Site",...v("siteId"),required:!0,children:[r.jsx("option",{value:"",children:"-- Select a Site --"}),i.map(Y=>r.jsx("option",{value:Y.id,children:Y.shortName},Y.id))]}),r.jsxs(Oe,{label:"Select Uniform Type",...v("gender"),children:[r.jsx("option",{children:"Gents"}),r.jsx("option",{children:"Ladies"})]})]}),r.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:W==="Gents"?r.jsxs(r.Fragment,{children:[r.jsx(Yc,{title:"Gents' Pants",sizes:o.gents.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"tilesLoose",label:"TL"},{key:"bottomWaist",label:"BW"},{key:"fit",label:"Fit"}],control:S,quantityType:"pantsQuantities"}),r.jsx(Yc,{title:"Gents' Shirts",sizes:o.gents.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"chest",label:"C"},{key:"shoulder",label:"Sh"},{key:"collar",label:"Co"},{key:"fit",label:"Fit"}],control:S,quantityType:"shirtsQuantities"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yc,{title:"Ladies' Pants",sizes:o.ladies.pants,headers:[{key:"length",label:"L"},{key:"waist",label:"W"},{key:"hip",label:"H"},{key:"fit",label:"Fit"}],control:S,quantityType:"pantsQuantities"}),r.jsx(Yc,{title:"Ladies' Shirts",sizes:o.ladies.shirts,headers:[{key:"length",label:"L"},{key:"sleeves",label:"S"},{key:"bust",label:"B"},{key:"shoulder",label:"Sh"},{key:"fit",label:"Fit"}],control:S,quantityType:"shirtsQuantities"})]})}),r.jsxs("div",{className:"mt-8 pt-6 border-t flex justify-end gap-3",children:[r.jsx(se,{type:"button",onClick:()=>n("/uniforms"),variant:"secondary",disabled:h,children:"Cancel"}),r.jsx(se,{type:"submit",isLoading:h,children:h?"Saving...":"Save Request"})]})]})]}),f&&r.jsx(It,{message:f.message,type:f.type,onDismiss:()=>p(null)})]}):null},ws=({label:n,isVerified:e,hasValue:t,error:s,registration:i,onManualInput:a,...o})=>{const{theme:l}=Fl(),c=l==="dark",h=i?{...i,onChange:async m=>{a&&a(),i?.onChange&&await i.onChange(m)}}:void 0;return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx("label",{htmlFor:o.id,className:"block text-sm font-medium text-muted",children:n}),t&&(e?r.jsx("span",{className:`ml-2 flex items-center ${c?"text-green-400":"text-green-600"}`,title:"Verified from document",children:r.jsx(Gi,{className:"h-4 w-4"})}):r.jsx("span",{className:`ml-2 flex items-center ${c?"text-yellow-400":"text-yellow-500"}`,title:"Manually entered. Please verify.",children:r.jsx(ca,{className:"h-4 w-4"})}))]}),r.jsx(be,{id:o.id,error:s,registration:h,label:"",...o})]})},fhe=Bt({employeeId:pe().required(),firstName:pe().required("First name is required"),middleName:pe().optional(),lastName:pe().required("Last name is required"),preferredName:pe().optional(),dob:pe().required("Date of birth is required"),gender:pe().oneOf(["Male","Female","Other",""]).required("Gender is required"),maritalStatus:pe().oneOf(["Single","Married","Divorced","Widowed",""]).required("Marital status is required"),bloodGroup:pe().oneOf(["","A+","A-","B+","B-","AB+","AB-","O+","O-"]).required("Blood group is required"),mobile:pe().required("Mobile number is required").matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit Indian mobile number"),alternateMobile:pe().optional().nullable(),email:pe().email("Must be a valid email").required("Email is required"),idProofType:pe().oneOf(["Aadhaar","PAN","Voter ID",""]).optional(),idProofNumber:pe().optional(),photo:Et().optional().nullable(),idProofFront:Et().optional().nullable(),idProofBack:Et().optional().nullable(),emergencyContactName:pe().required("Emergency contact name is required"),emergencyContactNumber:pe().required("Emergency contact number is required").matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit number"),relationship:pe().oneOf(["Spouse","Child","Father","Mother","Sibling","Other",""]).required("Relationship is required"),salary:mr().typeError("Salary must be a number").min(0).required("Salary is required").nullable(),verifiedStatus:Bt().optional()}).defined(),phe=()=>{const{onValidated:n}=ki(),{data:e,updatePersonal:t,addOrUpdateEmergencyContactAsFamilyMember:s,setPersonalVerifiedStatus:i}=Qn(),{register:a,handleSubmit:o,formState:{errors:l},control:c,reset:d,watch:h}=tn({resolver:Yn(fhe),defaultValues:e.personal}),m=h();k.useEffect(()=>{d(e.personal)},[e.personal,d]),k.useEffect(()=>{let p;const b=h(x=>{clearTimeout(p),p=window.setTimeout(()=>{t(x)},500)});return()=>{b.unsubscribe(),clearTimeout(p)}},[h,t]);const f=async p=>{t(p),s(),await n()};return r.jsxs("form",{onSubmit:o(f),id:"personal-form",children:[r.jsx("div",{className:"text-left",children:r.jsx(Xs,{title:"Personal Details",subtitle:"Please provide your personal information as per your official documents."})}),r.jsxs("div",{className:"flex flex-col md:flex-row gap-8 md:items-start",children:[r.jsx("div",{className:"flex-shrink-0 mx-auto md:mx-0",children:r.jsx(ye,{name:"photo",control:c,render:({field:p})=>r.jsx(ZZ,{file:p.value,onFileChange:b=>p.onChange(b)})})}),r.jsxs("div",{className:"w-full flex-grow grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:[r.jsx("div",{className:"md:col-span-3",children:r.jsx(be,{label:"Employee ID",id:"employeeId",registration:a("employeeId"),error:l.employeeId?.message,readOnly:!0,className:"bg-gray-100"})}),r.jsx(ws,{label:"First Name",id:"firstName",registration:a("firstName"),error:l.firstName?.message,isVerified:e.personal.verifiedStatus?.name===!0,hasValue:!!m.firstName,onManualInput:()=>i({name:!1})}),r.jsx(be,{label:"Middle Name (Optional)",id:"middleName",registration:a("middleName")}),r.jsx(ws,{label:"Last Name",id:"lastName",registration:a("lastName"),error:l.lastName?.message,isVerified:e.personal.verifiedStatus?.name===!0,hasValue:!!m.lastName,onManualInput:()=>i({name:!1})}),r.jsx(be,{label:"Preferred Name (Optional)",id:"preferredName",registration:a("preferredName")}),r.jsx(ye,{name:"dob",control:c,render:({field:p})=>r.jsx(Vn,{label:"Date of Birth",id:"dob",error:l.dob?.message,value:p.value,onChange:b=>{p.onChange(b),i({dob:!1})},maxDate:new Date})}),r.jsxs(Oe,{label:"Gender",id:"gender",registration:a("gender"),error:l.gender?.message,children:[r.jsx("option",{value:"",children:"Select Gender"}),r.jsx("option",{children:"Male"}),r.jsx("option",{children:"Female"}),r.jsx("option",{children:"Other"})]}),r.jsxs(Oe,{label:"Marital Status",id:"maritalStatus",registration:a("maritalStatus"),error:l.maritalStatus?.message,children:[r.jsx("option",{value:"",children:"Select Status"}),r.jsx("option",{children:"Single"}),r.jsx("option",{children:"Married"}),r.jsx("option",{children:"Divorced"}),r.jsx("option",{children:"Widowed"})]}),r.jsxs(Oe,{label:"Blood Group",id:"bloodGroup",registration:a("bloodGroup"),error:l.bloodGroup?.message,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"A+"}),r.jsx("option",{children:"A-"}),r.jsx("option",{children:"B+"}),r.jsx("option",{children:"B-"}),r.jsx("option",{children:"AB+"}),r.jsx("option",{children:"AB-"}),r.jsx("option",{children:"O+"}),r.jsx("option",{children:"O-"})]}),r.jsx(be,{label:"Mobile Number",id:"mobile",type:"tel",registration:a("mobile"),error:l.mobile?.message}),r.jsx(be,{label:"Alternate Mobile (Optional)",id:"alternateMobile",type:"tel",registration:a("alternateMobile")}),r.jsx(be,{label:"Email Address",id:"email",type:"email",registration:a("email"),error:l.email?.message}),r.jsx(be,{label:"Monthly Salary (Gross)",id:"salary",type:"number",registration:a("salary"),error:l.salary?.message}),r.jsxs("div",{className:"md:col-span-3 pt-4 border-t",children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Emergency Contact"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[r.jsx(be,{label:"Contact Name",id:"emergencyContactName",registration:a("emergencyContactName"),error:l.emergencyContactName?.message}),r.jsx(be,{label:"Contact Number",id:"emergencyContactNumber",type:"tel",registration:a("emergencyContactNumber"),error:l.emergencyContactNumber?.message}),r.jsxs(Oe,{label:"Relationship",id:"relationship",registration:a("relationship"),error:l.relationship?.message,children:[r.jsx("option",{value:"",children:"Select Relationship"}),r.jsx("option",{children:"Spouse"}),r.jsx("option",{children:"Child"}),r.jsx("option",{children:"Father"}),r.jsx("option",{children:"Mother"}),r.jsx("option",{children:"Sibling"}),r.jsx("option",{children:"Other"})]})]})]})]})]})]})},LY=Bt({line1:pe().required("Address line 1 is required"),line2:pe().optional(),city:pe().required("City is required"),state:pe().required("State is required"),country:pe().required("Country is required"),pincode:pe().required("Pincode is required").matches(/^[1-9][0-9]{5}$/,"Must be a valid 6-digit Indian pincode"),verifiedStatus:Bt().optional()}).defined(),Ahe=Bt({present:LY.required(),permanent:LY.required(),sameAsPresent:hr().required()}).defined(),bhe=()=>{const{onValidated:n}=ki(),{data:e,updateAddress:t,setAddressVerifiedStatus:s}=Qn(),{address:i}=wi(),[a,o]=k.useState(!1),[l,c]=k.useState(""),{register:d,handleSubmit:h,formState:{errors:m},control:f,setValue:p,trigger:b,getValues:x,reset:v,watch:S}=tn({resolver:Yn(Ahe),defaultValues:e.address}),B=pg({control:f,name:"sameAsPresent"}),V=pg({control:f,name:"present"}),R=pg({control:f,name:"permanent"});k.useEffect(()=>{v(e.address)},[e.address,v]),k.useEffect(()=>{let j;const M=S(H=>{clearTimeout(j),j=window.setTimeout(()=>{t(H)},500)});return()=>{M.unsubscribe(),clearTimeout(j)}},[S,t]),k.useEffect(()=>{B&&(p("permanent",V),b("permanent"))},[B,V,p,b]);const W=(j,M)=>{s(j,{[M]:!1})},_=async j=>{const M=j.target.value;if(W("present","pincode"),i.enablePincodeVerification&&/^[1-9][0-9]{5}$/.test(M)){o(!0),c("");try{const H=await ce.getPincodeDetails(M);p("present.city",H.city,{shouldValidate:!0}),p("present.state",H.state,{shouldValidate:!0}),s("present",{city:!0,state:!0,pincode:!0})}catch{c("Invalid Pincode. Please check and try again.")}finally{o(!1)}}},Y=async j=>{t(j),await n()};return r.jsxs("form",{onSubmit:h(Y),id:"address-form",children:[r.jsx(Xs,{title:"Address Details",subtitle:"Your communication and permanent address."}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Present Address"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[r.jsx("div",{className:"sm:col-span-2",children:r.jsx(ws,{label:"Address Line 1",id:"present.line1",isVerified:!!e.address.present.verifiedStatus?.line1,hasValue:!!V?.line1,onManualInput:()=>W("present","line1"),error:m.present?.line1?.message,registration:d("present.line1")})}),r.jsx("div",{className:"sm:col-span-2",children:r.jsx(be,{label:"Address Line 2 (Optional)",id:"present.line2",registration:d("present.line2")})}),r.jsx(ws,{label:"Country",id:"present.country",isVerified:!!e.address.present.verifiedStatus?.country,hasValue:!!V?.country,onManualInput:()=>W("present","country"),error:m.present?.country?.message,registration:d("present.country")}),r.jsxs("div",{className:"relative",children:[r.jsx(ws,{label:"Pincode",id:"present.pincode",type:"tel",isVerified:!!e.address.present.verifiedStatus?.pincode,hasValue:!!V?.pincode,error:m.present?.pincode?.message||l,registration:d("present.pincode"),onBlur:_}),a&&r.jsx(xt,{className:"absolute right-3 top-9 h-5 w-5 animate-spin text-muted"})]}),r.jsx(ws,{label:"City",id:"present.city",isVerified:!!e.address.present.verifiedStatus?.city,hasValue:!!V?.city,onManualInput:()=>W("present","city"),error:m.present?.city?.message,registration:d("present.city")}),r.jsx(ws,{label:"State",id:"present.state",isVerified:!!e.address.present.verifiedStatus?.state,hasValue:!!V?.state,onManualInput:()=>W("present","state"),error:m.present?.state?.message,registration:d("present.state")})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4",children:"Permanent Address"}),r.jsxs("div",{className:"flex items-center mb-4",children:[r.jsx("input",{id:"sameAsPresent",type:"checkbox",...d("sameAsPresent"),className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent"}),r.jsx("label",{htmlFor:"sameAsPresent",className:"ml-2 block text-sm text-muted",children:"Same as Present Address"})]}),!B&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[r.jsx("div",{className:"sm:col-span-2",children:r.jsx(ws,{label:"Address Line 1",id:"permanent.line1",isVerified:!!e.address.permanent.verifiedStatus?.line1,hasValue:!!R?.line1,onManualInput:()=>W("permanent","line1"),error:m.permanent?.line1?.message,registration:d("permanent.line1")})}),r.jsx("div",{className:"sm:col-span-2",children:r.jsx(be,{label:"Address Line 2 (Optional)",id:"permanent.line2",registration:d("permanent.line2")})}),r.jsx(ws,{label:"Country",id:"permanent.country",isVerified:!!e.address.permanent.verifiedStatus?.country,hasValue:!!R?.country,onManualInput:()=>W("permanent","country"),error:m.permanent?.country?.message,registration:d("permanent.country")}),r.jsx(ws,{label:"Pincode",id:"permanent.pincode",type:"tel",isVerified:!!e.address.permanent.verifiedStatus?.pincode,hasValue:!!R?.pincode,onManualInput:()=>W("permanent","pincode"),error:m.permanent?.pincode?.message,registration:d("permanent.pincode")}),r.jsx(ws,{label:"City",id:"permanent.city",isVerified:!!e.address.permanent.verifiedStatus?.city,hasValue:!!R?.city,onManualInput:()=>W("permanent","city"),error:m.permanent?.city?.message,registration:d("permanent.city")}),r.jsx(ws,{label:"State",id:"permanent.state",isVerified:!!e.address.permanent.verifiedStatus?.state,hasValue:!!R?.state,onManualInput:()=>W("permanent","state"),error:m.permanent?.state?.message,registration:d("permanent.state")})]})]})]})]})},yhe=Bt({designation:pe().required("Designation is required"),department:pe().required("Department is required"),reportingManager:pe().optional(),organizationId:pe().required("Organization is required"),organizationName:pe().required(),joiningDate:pe().required("Joining date is required"),workType:pe().oneOf(["Full-time","Part-time","Contract",""]).required("Work type is required"),site:pe().optional(),defaultSalary:mr().nullable().optional()}).defined(),vhe=()=>{const{onValidated:n}=ki(),{user:e}=bt(),{data:t,updateOrganization:s}=Qn(),[i,a]=k.useState([]),o=jt("(max-width: 767px)"),{register:l,handleSubmit:c,formState:{errors:d},control:h,watch:m,setValue:f,reset:p}=tn({resolver:Yn(yhe),defaultValues:t.organization}),b=m("organizationId"),x=m("designation"),v=!!t.organization.organizationId;k.useEffect(()=>{ce.getOrganizations().then(a)},[]),k.useEffect(()=>{p(t.organization)},[t.organization,p]),k.useEffect(()=>{let B;const V=m(R=>{clearTimeout(B),B=window.setTimeout(()=>{s(R)},500)});return()=>{V.unsubscribe(),clearTimeout(B)}},[m,s]),k.useEffect(()=>{const B=i.find(V=>V.id===b);B&&f("organizationName",B.shortName)},[b,i,f]),k.useEffect(()=>{x&&ce.suggestDepartmentForDesignation(x).then(B=>{B&&f("department",B,{shouldValidate:!0})})},[x,f]);const S=async B=>{s(B),await n()};return o?r.jsx("form",{onSubmit:c(S),id:"organization-form",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("p",{className:"text-sm text-gray-400",children:"Provide the employment details for the new employee within the organization."}),r.jsxs("select",{...l("organizationId"),className:"pro-select pro-select-arrow",disabled:v,children:[r.jsx("option",{value:"",children:"Select Organization"}),i.map(B=>r.jsx("option",{value:B.id,children:B.shortName},B.id))]}),d.organizationId&&r.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.organizationId.message}),r.jsx("input",{placeholder:"Designation",...l("designation"),className:"form-input"}),r.jsx("input",{placeholder:"Department",...l("department"),className:"form-input"}),r.jsx("input",{placeholder:"Reporting Manager",...l("reportingManager"),className:"form-input"}),r.jsx(ye,{name:"joiningDate",control:h,render:({field:B})=>r.jsx("input",{type:"date",...B,className:"form-input"})}),d.joiningDate&&r.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.joiningDate.message}),r.jsxs("select",{...l("workType"),className:"pro-select pro-select-arrow",children:[r.jsx("option",{value:"",children:"Select Work Type"}),r.jsx("option",{children:"Full-time"}),r.jsx("option",{children:"Part-time"}),r.jsx("option",{children:"Contract"})]}),d.workType&&r.jsx("p",{className:"mt-1 text-xs text-red-500",children:d.workType.message})]})}):r.jsxs("form",{onSubmit:c(S),id:"organization-form",children:[r.jsx(Xs,{title:"Organization Details",subtitle:"Your employment details within the organization."}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[r.jsxs(Oe,{label:"Organization / Client",id:"organizationId",error:d.organizationId?.message,registration:l("organizationId"),disabled:v,children:[r.jsx("option",{value:"",children:"Select Organization"}),i.map(B=>r.jsx("option",{value:B.id,children:B.shortName},B.id))]}),r.jsx(be,{label:"Designation",id:"designation",error:d.designation?.message,registration:l("designation")}),r.jsx(be,{label:"Department",id:"department",error:d.department?.message,registration:l("department")}),r.jsx(be,{label:"Reporting Manager",id:"reportingManager",error:d.reportingManager?.message,registration:l("reportingManager")}),r.jsx(ye,{name:"joiningDate",control:h,render:({field:B})=>r.jsx(Vn,{label:"Joining Date",id:"joiningDate",error:d.joiningDate?.message,value:B.value,onChange:B.onChange})}),r.jsxs(Oe,{label:"Work Type",id:"workType",error:d.workType?.message,registration:l("workType"),children:[r.jsx("option",{value:"",children:"Select Work Type"}),r.jsx("option",{children:"Full-time"}),r.jsx("option",{children:"Part-time"}),r.jsx("option",{children:"Contract"})]})]})]})},xhe=()=>{const{onValidated:n,setToast:e}=ki(),{data:t,updateFamily:s}=Qn(),{rulesByDesignation:i}=dd(),a=jt("(max-width: 767px)"),o=t.organization.designation,l=k.useMemo(()=>{const z=o&&i[o];return z?z.documents.familyAadhaar:!1},[o,i]),c=Bt({id:pe().required(),relation:pe().oneOf(["Spouse","Child","Father","Mother",""]).required("Relation is required"),name:pe().required("Name is required"),dob:pe().required("Date of birth is required"),gender:pe().oneOf(["Male","Female","Other",""]).required("Gender is required"),occupation:pe().optional(),dependent:hr().required(),phone:pe().when("relation",{is:"Child",then:z=>z.optional().nullable().matches(/^[6-9][0-9]{9}$/,{message:"Must be a valid 10-digit number",excludeEmptyString:!0}),otherwise:z=>z.required("Phone number is required").matches(/^[6-9][0-9]{9}$/,"Must be a valid 10-digit Indian number")}),idProof:Et().nullable().when([],{is:()=>l,then:z=>z.test("is-required","Aadhaar proof is required for this designation.",O=>O!=null).nullable(),otherwise:z=>z.optional().nullable()})}),d=Bt({family:Rr().of(c).required()}),{control:h,handleSubmit:m,formState:{errors:f},watch:p,setValue:b}=tn({resolver:Yn(d),defaultValues:{family:t.family}}),{fields:x,append:v,remove:S}=Wr({control:h,name:"family"}),[B,V]=k.useState(!1),[R,W]=k.useState(null);k.useEffect(()=>{let z;const O=p(E=>{clearTimeout(z),z=window.setTimeout(()=>{s(E.family)},500)});return()=>{O.unsubscribe(),clearTimeout(z)}},[p,s]);const _=z=>O=>{let E=!1;if(O.name){const te=O.name.toLowerCase().replace(/\b(\w)/g,q=>q.toUpperCase());b(`family.${z}.name`,te,{shouldValidate:!0}),E=!0}if(O.dob)try{const te=O.dob.replace(/[/.]/g,"-"),q=["dd-MM-yyyy","yyyy-MM-dd","MM-dd-yyyy","d-M-yyyy"];let de=null;for(const U of q){const P=nO(te,U,new Date);if(!isNaN(P.getTime())){de=P;break}}if(de){const U=He(de,"yyyy-MM-dd");b(`family.${z}.dob`,U,{shouldValidate:!0}),E=!0}}catch{console.error("Could not parse date from OCR:",O.dob)}if(O.gender){const te=O.gender.toLowerCase().trim();te.includes("male")||te.includes("purush")||te==="m"?(b(`family.${z}.gender`,"Male",{shouldValidate:!0}),E=!0):(te.includes("female")||te.includes("mahila")||te==="f")&&(b(`family.${z}.gender`,"Female",{shouldValidate:!0}),E=!0)}E&&e({message:"Family member details auto-filled.",type:"success"})},Y={type:$e.OBJECT,properties:{name:{type:$e.STRING},dob:{type:$e.STRING},gender:{type:$e.STRING}}},j=()=>{v({id:`fam_${Date.now()}`,relation:"",name:"",dob:"",gender:"",occupation:"",dependent:!1,idProof:null,phone:""})},M=z=>{W(z),V(!0)},H=()=>{R!==null&&(S(R),V(!1),W(null))},D=async z=>{s(z.family),await n()};return a?r.jsxs("form",{onSubmit:m(D),id:"family-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"List your immediate family members."}),r.jsx("div",{className:"space-y-4",children:x.map((z,O)=>r.jsxs("div",{className:"p-4 border border-border rounded-xl relative space-y-4",children:[r.jsx("button",{type:"button",onClick:()=>M(O),className:"absolute top-2 right-2 p-1 text-red-500 rounded-full z-10","aria-label":"Remove family member",children:r.jsx(rn,{className:"h-5 w-5"})}),r.jsx(ye,{name:`family.${O}.relation`,control:h,render:({field:E})=>r.jsxs("select",{...E,className:"pro-select pro-select-arrow",children:[r.jsx("option",{value:"",children:"Select Relation"}),r.jsx("option",{children:"Spouse"}),r.jsx("option",{children:"Child"}),r.jsx("option",{children:"Father"}),r.jsx("option",{children:"Mother"})]})}),r.jsx(ye,{name:`family.${O}.name`,control:h,render:({field:E})=>r.jsx("input",{placeholder:"Full Name",...E,className:"form-input"})}),r.jsx(ye,{name:`family.${O}.dob`,control:h,render:({field:E})=>r.jsx("input",{type:"date",placeholder:"Date of Birth",...E,className:"form-input"})}),r.jsx(ye,{name:`family.${O}.phone`,control:h,render:({field:E})=>r.jsx("input",{placeholder:"Phone Number",type:"tel",...E,className:"form-input"})})]},z.id))}),r.jsxs(se,{type:"button",onClick:j,variant:"secondary",className:"mt-6 w-full flex items-center justify-center",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Family Member"]})]}):r.jsxs("form",{onSubmit:m(D),id:"family-form",children:[r.jsx(tr,{isOpen:B,onClose:()=>V(!1),onConfirm:H,title:"Confirm Deletion",children:"Are you sure you want to remove this family member? This action cannot be undone."}),r.jsx(Xs,{title:"Family Details",subtitle:"List your immediate family members."}),r.jsx("div",{className:"space-y-6",children:x.map((z,O)=>r.jsxs("div",{className:"p-4 border border-border rounded-xl relative",children:[r.jsx("button",{type:"button",onClick:()=>M(O),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 rounded-full","aria-label":`Remove ${z.name}`,children:r.jsx(rn,{className:"h-4 w-4"})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[r.jsx(ye,{name:`family.${O}.relation`,control:h,render:({field:E})=>r.jsxs(Oe,{label:"Relation",id:E.name,error:f.family?.[O]?.relation?.message,...E,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Spouse"}),r.jsx("option",{children:"Child"}),r.jsx("option",{children:"Father"}),r.jsx("option",{children:"Mother"})]})}),r.jsx(ye,{name:`family.${O}.name`,control:h,render:({field:E})=>r.jsx(be,{label:"Full Name",id:E.name,error:f.family?.[O]?.name?.message,...E})}),r.jsx(ye,{name:`family.${O}.dob`,control:h,render:({field:E})=>r.jsx(Vn,{label:"Date of Birth",id:E.name,value:E.value,onChange:E.onChange,error:f.family?.[O]?.dob?.message,maxDate:new Date})}),r.jsx(ye,{name:`family.${O}.gender`,control:h,render:({field:E})=>r.jsxs(Oe,{label:"Gender",id:E.name,error:f.family?.[O]?.gender?.message,...E,children:[r.jsx("option",{value:"",children:"Select"}),r.jsx("option",{children:"Male"}),r.jsx("option",{children:"Female"}),r.jsx("option",{children:"Other"})]})}),r.jsx(ye,{name:`family.${O}.phone`,control:h,render:({field:E})=>r.jsx(be,{label:"Phone Number",id:E.name,type:"tel",error:f.family?.[O]?.phone?.message,...E,value:E.value??""})}),r.jsx(ye,{name:`family.${O}.occupation`,control:h,render:({field:E})=>r.jsx(be,{label:"Occupation (Optional)",id:E.name,...E,value:E.value??""})}),r.jsx("div",{className:"col-span-full md:col-span-1 flex items-center pt-5",children:r.jsx(ye,{name:`family.${O}.dependent`,control:h,render:({field:E})=>r.jsx(Nn,{id:E.name,label:"Is a dependent?",checked:E.value,onChange:E.onChange})})}),r.jsx("div",{className:"col-span-full",children:r.jsx(ye,{name:`family.${O}.idProof`,control:h,render:({field:E,fieldState:te})=>r.jsx(pt,{label:`Aadhaar Proof ${l?"(Mandatory)":"(Optional)"}`,file:E.value,onFileChange:E.onChange,onOcrComplete:_(O),ocrSchema:Y,setToast:e,error:te.error?.message,docType:"Aadhaar"})})})]})]},z.id))}),r.jsxs(se,{type:"button",onClick:j,variant:"outline",className:"mt-6",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Family Member"]})]})},She=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),{data:s,updateEducation:i,updateEducationRecord:a}=Qn(),o=jt("(max-width: 767px)"),l=k.useMemo(()=>/manager|admin|head/i.test(s.organization.designation),[s.organization.designation]),c=k.useMemo(()=>Bt({id:pe().required(),degree:pe().required("Degree is required"),institution:pe().required("Institution is required"),startYear:pe().required("Start year is required").matches(/^\d{4}$/,"Must be a 4-digit year"),endYear:pe().required("End year is required").matches(/^\d{4}$/,"Must be a 4-digit year").test("is-after-start-year","End year must be on or after start year",function(O){const{startYear:E}=this.parent;return!E||!O||parseInt(O)>=parseInt(E)}),percentage:mr().nullable().min(0).max(100).optional(),grade:pe().optional(),document:Et().nullable().when([],{is:()=>l,then:O=>O.required("Certificate is mandatory for this role.").nullable(),otherwise:O=>O.optional().nullable()})}).defined(),[l]),d=Bt({education:Rr().of(c).required()}),{control:h,handleSubmit:m,formState:{errors:f},setValue:p,reset:b,watch:x}=tn({resolver:Yn(d),context:{isAdminOrManager:l},mode:"onBlur"}),{fields:v,append:S,remove:B}=Wr({control:h,name:"education"}),[V,R]=k.useState(!1),[W,_]=k.useState(null);k.useEffect(()=>{b({education:s.education})},[s.education,b]),k.useEffect(()=>{let O;const E=x(te=>{clearTimeout(O),O=window.setTimeout(()=>{i(te.education)},500)});return()=>{E.unsubscribe(),clearTimeout(O)}},[x,i]);const Y=()=>{S({id:`edu_${Date.now()}`,degree:"",institution:"",startYear:"",endYear:""})},j=O=>{_(O),R(!0)},M=()=>{W!==null&&(B(W),R(!1),_(null))},H=async O=>{i(O.education),await n()},D=O=>E=>{const te=v[O].id,q={};if(E.degree&&(p(`education.${O}.degree`,E.degree,{shouldValidate:!0}),q.degree=E.degree),E.institution&&(p(`education.${O}.institution`,E.institution,{shouldValidate:!0}),q.institution=E.institution),E.endYear){const de=E.endYear.toString();p(`education.${O}.endYear`,de,{shouldValidate:!0}),q.endYear=de}Object.keys(q).length>0&&(a(te,q),e({message:"Education details auto-filled.",type:"success"}))},z={type:$e.OBJECT,properties:{degree:{type:$e.STRING,description:"The name of the degree, diploma, or certificate."},institution:{type:$e.STRING,description:"The name of the university, college, or institution."},endYear:{type:$e.STRING,description:"The year of completion or graduation as a 4-digit number."}},required:["degree","institution","endYear"]};return o?r.jsxs("form",{onSubmit:m(H),id:"education-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"List educational qualifications, starting with the most recent."}),r.jsx("div",{className:"space-y-4",children:v.map((O,E)=>r.jsxs("div",{className:"p-4 border border-border rounded-xl relative space-y-4",children:[r.jsx("button",{type:"button",onClick:()=>j(E),className:"absolute top-2 right-2 p-1 text-red-500 rounded-full z-10","aria-label":"Remove qualification",children:r.jsx(rn,{className:"h-5 w-5"})}),r.jsx(ye,{name:`education.${E}.degree`,control:h,render:({field:te})=>r.jsx("input",{placeholder:"Degree / Certificate",...te,className:"form-input"})}),r.jsx(ye,{name:`education.${E}.institution`,control:h,render:({field:te})=>r.jsx("input",{placeholder:"Institution / University",...te,className:"form-input"})}),r.jsx(ye,{name:`education.${E}.endYear`,control:h,render:({field:te})=>r.jsx("input",{placeholder:"Year of Completion",type:"text",maxLength:4,...te,className:"form-input"})}),r.jsx(ye,{name:`education.${E}.document`,control:h,render:({field:te,fieldState:q})=>r.jsx(pt,{label:`Certificate ${l?"(Mandatory)":"(Optional)"}`,file:te.value,onFileChange:te.onChange,error:q.error?.message,allowCapture:!0})})]},O.id))}),r.jsxs(se,{type:"button",onClick:Y,variant:"secondary",className:"mt-6 w-full flex items-center justify-center",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]}):r.jsxs("form",{onSubmit:m(H),id:"education-form",children:[r.jsx(tr,{isOpen:V,onClose:()=>R(!1),onConfirm:M,title:"Confirm Deletion",children:"Are you sure you want to remove this education record? This action cannot be undone."}),r.jsx(Xs,{title:"Education Details",subtitle:"List your educational qualifications, starting with the most recent."}),r.jsx("div",{className:"space-y-6",children:v.map((O,E)=>r.jsxs("div",{className:"p-4 border border-border rounded-xl relative",children:[r.jsx("button",{type:"button",onClick:()=>j(E),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-100 rounded-full","aria-label":`Remove ${O.degree}`,children:r.jsx(rn,{className:"h-4 w-4"})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsx(ye,{name:`education.${E}.degree`,control:h,render:({field:te})=>r.jsx(be,{label:"Degree / Certificate",id:te.name,error:f.education?.[E]?.degree?.message,...te})}),r.jsx(ye,{name:`education.${E}.institution`,control:h,render:({field:te})=>r.jsx(be,{label:"Institution / University",id:te.name,error:f.education?.[E]?.institution?.message,...te})}),r.jsx(ye,{name:`education.${E}.startYear`,control:h,render:({field:te})=>r.jsx(be,{label:"Start Year",id:te.name,type:"text",maxLength:4,error:f.education?.[E]?.startYear?.message,...te})}),r.jsx(ye,{name:`education.${E}.endYear`,control:h,render:({field:te})=>r.jsx(be,{label:"End Year",id:te.name,type:"text",maxLength:4,error:f.education?.[E]?.endYear?.message,...te})}),r.jsx(ye,{name:`education.${E}.percentage`,control:h,render:({field:te})=>r.jsx(be,{label:"Percentage (Optional)",id:te.name,type:"number",error:f.education?.[E]?.percentage?.message,...te,value:te.value??""})}),r.jsx(ye,{name:`education.${E}.grade`,control:h,render:({field:te})=>r.jsx(be,{label:"Grade (Optional)",id:te.name,type:"text",error:f.education?.[E]?.grade?.message,...te,value:te.value??""})}),r.jsx("div",{className:"sm:col-span-2",children:r.jsx(ye,{name:`education.${E}.document`,control:h,render:({field:te,fieldState:q})=>r.jsx(pt,{label:`Upload Certificate ${l?"(Mandatory)":"(Optional)"}`,file:te.value,onFileChange:te.onChange,onOcrComplete:D(E),ocrSchema:z,setToast:e,error:q.error?.message})})})]})]},O.id))}),r.jsxs(se,{type:"button",onClick:Y,variant:"outline",className:"mt-6",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]})},XZ=n=>n?n.toLowerCase().replace(/\b(\w)/g,e=>e.toUpperCase()):"",whe=pe().matches(/^[a-zA-Z\s.'-]*$/,"Name can only contain letters and spaces").transform(XZ),Zhe=Bt({accountHolderName:whe.required("Account holder name is required"),accountNumber:pe().required("Account number is required").matches(/^[0-9]+$/,"Must be only digits"),confirmAccountNumber:pe().oneOf([wG("accountNumber")],"Account numbers must match").required("Please confirm your account number"),ifscCode:pe().required("IFSC code is required").transform(n=>n.toUpperCase()).matches(/^[A-Z]{4}0[A-Z0-9]{6}$/,"Invalid IFSC code format (e.g., SBIN0123456)"),bankName:pe().required("Bank name is required"),branchName:pe().required("Branch name is required"),bankProof:Et().optional().nullable(),verifiedStatus:Bt().optional()}).defined(),Ghe=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),{data:s,updateBank:i,setBankVerifiedStatus:a}=Qn(),o=jt("(max-width: 767px)"),{register:l,handleSubmit:c,formState:{errors:d},control:h,setValue:m,watch:f,reset:p}=tn({resolver:Yn(Zhe),defaultValues:s.bank});k.useEffect(()=>{p(s.bank)},[s.bank,p]),k.useEffect(()=>{let R;const W=f(_=>{clearTimeout(R),R=window.setTimeout(()=>{i(_)},500)});return()=>{W.unsubscribe(),clearTimeout(R)}},[f,i]);const b=f(),x=async R=>{i(R),await n()},v=R=>{const W=R.target.value;m("accountHolderName",XZ(W),{shouldValidate:!0})},S=R=>{const W={};R.forEach(_=>{W[_]=!1}),a(W)},B=R=>{const W={},_={};if(R.accountHolderName){const Y=XZ(R.accountHolderName);m("accountHolderName",Y,{shouldValidate:!0}),W.accountHolderName=Y,_.accountHolderName=!0}if(R.accountNumber){const Y=R.accountNumber.replace(/\D/g,"");m("accountNumber",Y,{shouldValidate:!0}),m("confirmAccountNumber",Y,{shouldValidate:!0}),W.accountNumber=Y,W.confirmAccountNumber=Y,_.accountNumber=!0}if(R.ifscCode){const Y=R.ifscCode.toUpperCase().replace(/\s/g,"");m("ifscCode",Y,{shouldValidate:!0}),W.ifscCode=Y,_.ifscCode=!0}R.bankName&&(m("bankName",R.bankName,{shouldValidate:!0}),W.bankName=R.bankName),R.branchName&&(m("branchName",R.branchName,{shouldValidate:!0}),W.branchName=R.branchName),Object.keys(W).length>0&&i(W),a(_),e({message:"Bank details extracted. Please review.",type:"success"})},V={type:$e.OBJECT,properties:{accountHolderName:{type:$e.STRING,description:"The account holder's full name."},accountNumber:{type:$e.STRING,description:"The full bank account number."},ifscCode:{type:$e.STRING,description:"The bank's IFSC code."},bankName:{type:$e.STRING,description:"The name of the bank (e.g., 'State Bank of India')."},branchName:{type:$e.STRING,description:"The name of the bank branch (e.g., 'Koramangala Branch')."}},required:["accountHolderName","accountNumber","ifscCode","bankName","branchName"]};return o?r.jsxs("form",{onSubmit:c(x),id:"bank-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Your salary will be credited to this account."}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("input",{placeholder:"Account Holder Name",...l("accountHolderName"),onBlur:v,className:"form-input"}),r.jsx("input",{placeholder:"Bank Name",...l("bankName"),className:"form-input"}),r.jsx("input",{placeholder:"Account Number",...l("accountNumber"),className:"form-input"}),r.jsx("input",{placeholder:"Confirm Account Number",...l("confirmAccountNumber"),className:"form-input"}),r.jsx("input",{placeholder:"IFSC Code",...l("ifscCode"),className:"form-input"}),r.jsx("input",{placeholder:"Branch Name",...l("branchName"),className:"form-input"}),r.jsx(ye,{name:"bankProof",control:h,render:({field:R})=>r.jsx(pt,{label:"Upload Bank Proof (Optional)",file:R.value,onFileChange:R.onChange,allowCapture:!0})})]})]}):r.jsxs("form",{onSubmit:c(x),id:"bank-form",children:[r.jsx(Xs,{title:"Bank Details",subtitle:"Your salary will be credited to this account."}),r.jsxs("div",{className:"space-y-6",children:[r.jsx(ye,{name:"bankProof",control:h,render:({field:R})=>r.jsx(pt,{label:"Upload Bank Proof (Cancelled Cheque/Passbook)",file:R.value,onFileChange:R.onChange,onOcrComplete:B,ocrSchema:V,setToast:e})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 pt-6 border-t",children:[r.jsx(ws,{label:"Account Holder Name",id:"accountHolderName",hasValue:!!b.accountHolderName,isVerified:s.bank.verifiedStatus?.accountHolderName===!0,onManualInput:()=>S(["accountHolderName"]),error:d.accountHolderName?.message,registration:l("accountHolderName"),onBlur:v}),r.jsx(ws,{label:"Bank Name",id:"bankName",hasValue:!!b.bankName,isVerified:!1,error:d.bankName?.message,registration:l("bankName")}),r.jsx(ws,{label:"Account Number",id:"accountNumber",hasValue:!!b.accountNumber,isVerified:s.bank.verifiedStatus?.accountNumber===!0,onManualInput:()=>S(["accountNumber"]),error:d.accountNumber?.message,registration:l("accountNumber")}),r.jsx(ws,{label:"Confirm Account Number",id:"confirmAccountNumber",hasValue:!!b.confirmAccountNumber,isVerified:s.bank.verifiedStatus?.accountNumber===!0,onManualInput:()=>S(["accountNumber"]),error:d.confirmAccountNumber?.message,registration:l("confirmAccountNumber")}),r.jsx(ws,{label:"IFSC Code",id:"ifscCode",hasValue:!!b.ifscCode,isVerified:s.bank.verifiedStatus?.ifscCode===!0,onManualInput:()=>S(["ifscCode"]),error:d.ifscCode?.message,registration:l("ifscCode")}),r.jsx(ws,{label:"Branch Name",id:"branchName",hasValue:!!b.branchName,isVerified:!1,error:d.branchName?.message,registration:l("branchName")})]})]})]})},Bhe=Bt({hasPreviousPf:hr().required(),uanNumber:pe().when("hasPreviousPf",{is:!0,then:n=>n.required("UAN Number is required").matches(/^[0-9]{12}$/,"UAN must be 12 digits"),otherwise:n=>n.optional().nullable()}),pfNumber:pe().when("hasPreviousPf",{is:!0,then:n=>n.optional().nullable(),otherwise:n=>n.optional().nullable()}),document:Et().optional().nullable(),salarySlip:Et().optional().nullable(),verifiedStatus:Bt().optional()}).defined(),Nhe=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),{data:s,updateUan:i,setUanVerifiedStatus:a}=Qn(),o=jt("(max-width: 767px)"),{register:l,control:c,handleSubmit:d,formState:{errors:h},setValue:m,watch:f,reset:p}=tn({resolver:Yn(Bhe),defaultValues:s.uan});k.useEffect(()=>{p(s.uan)},[s.uan,p]),k.useEffect(()=>{let R;const W=f(_=>{clearTimeout(R),R=window.setTimeout(()=>{i(_)},500)});return()=>{W.unsubscribe(),clearTimeout(R)}},[f,i]);const b=f("hasPreviousPf"),x=f(),v=async R=>{i(R),await n()},S=()=>{a({uanNumber:!1})},B=R=>{if(R.uanNumber){const W=R.uanNumber.replace(/\D/g,"");if(W.length===12){const _={uanNumber:W,hasPreviousPf:!0};m("uanNumber",W,{shouldValidate:!0}),m("hasPreviousPf",!0,{shouldValidate:!0}),i(_),a({uanNumber:!0}),e({message:"UAN extracted successfully.",type:"success"})}}},V={type:$e.OBJECT,properties:{uanNumber:{type:$e.STRING,description:"The 12-digit Universal Account Number (UAN)."}},required:["uanNumber"]};return o?r.jsxs("form",{onSubmit:d(v),id:"uan-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide your Universal Account Number if you have one."}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[r.jsx("input",{type:"checkbox",...l("hasPreviousPf"),className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),r.jsx("span",{children:"Do you have a previous PF account or UAN?"})]}),b&&r.jsxs("div",{className:"space-y-4 animate-fade-in-down",children:[r.jsx("input",{placeholder:"UAN Number",...l("uanNumber"),className:"form-input"}),r.jsx("input",{placeholder:"PF Number (Optional)",...l("pfNumber"),className:"form-input"}),r.jsx(ye,{name:"document",control:c,render:({field:R})=>r.jsx(pt,{label:"Upload Proof (Payslip, etc.)",file:R.value,onFileChange:R.onChange,allowCapture:!0,costingItemName:"EPF UAN Lookup"})})]})]})]}):r.jsxs("form",{onSubmit:d(v),id:"uan-form",children:[r.jsx(Xs,{title:"UAN / PF Details",subtitle:"Provide your Universal Account Number if you have one."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{id:"hasPreviousPf",type:"checkbox",...l("hasPreviousPf"),className:"h-4 w-4 text-accent border-gray-300 rounded focus:ring-accent"}),r.jsx("label",{htmlFor:"hasPreviousPf",className:"ml-2 block text-sm text-muted",children:"Do you have a previous PF account or UAN?"})]}),s.uan.salarySlip&&r.jsxs("div",{className:"pt-4 border-t",children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-2",children:"Reference Salary Slip"}),r.jsx(pt,{label:"",file:s.uan.salarySlip,onFileChange:()=>{}})]}),b&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx(ws,{label:"UAN Number",id:"uanNumber",hasValue:!!x.uanNumber,isVerified:s.uan.verifiedStatus?.uanNumber===!0,onManualInput:S,registration:l("uanNumber"),error:h.uanNumber?.message}),r.jsx(be,{label:"PF Number (Optional)",id:"pfNumber",registration:l("pfNumber"),error:h.pfNumber?.message})]}),r.jsx(ye,{name:"document",control:c,render:({field:R})=>r.jsx(pt,{label:"Upload Proof (Payslip, etc.)",file:R.value,onFileChange:R.onChange,onOcrComplete:B,ocrSchema:V,setToast:e,costingItemName:"EPF UAN Lookup"})})]})]})]})},khe=Bt({hasEsi:hr().required(),esiNumber:pe().when("hasEsi",{is:!0,then:n=>n.required("ESI Number is required").matches(/^(\d{10}|\d{17})$/,"ESI number must be 10 or 17 digits"),otherwise:n=>n.optional().nullable()}),esiRegistrationDate:pe().when("hasEsi",{is:!0,then:n=>n.required("Registration date is required").test("not-in-future","Registration date cannot be in the future",e=>e?new Date(e.replace(/-/g,"/"))<=new Date:!0),otherwise:n=>n.optional().nullable()}),esicBranch:pe().when("hasEsi",{is:!0,then:n=>n.required("ESIC Branch is required"),otherwise:n=>n.optional().nullable()}),document:Et().optional().nullable(),verifiedStatus:Bt().optional()}),Rhe=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),{data:s,updateEsi:i,setEsiVerifiedStatus:a}=Qn(),{esiCtcThreshold:o,enableEsiRule:l}=dd(),c=jt("(max-width: 767px)"),{register:d,control:h,handleSubmit:m,formState:{errors:f},reset:p,setValue:b,watch:x}=tn({resolver:Yn(khe),defaultValues:s.esi}),v=x("hasEsi"),S=x(),B=s.personal.salary!=null&&s.personal.salary<=o;k.useEffect(()=>{p(s.esi)},[s.esi,p]),k.useEffect(()=>{let Y;const j=x(M=>{clearTimeout(Y),Y=window.setTimeout(()=>{i(M)},500)});return()=>{j.unsubscribe(),clearTimeout(Y)}},[x,i]),k.useEffect(()=>{B||s.esi.hasEsi&&i({hasEsi:!1,esiNumber:"",esiRegistrationDate:"",esicBranch:""})},[B,s.esi.hasEsi,i]);const V=async Y=>{i(Y),await n()},R=()=>{a({esiNumber:!1})},W=Y=>{if(Y.esiNumber){const j=Y.esiNumber.replace(/\D/g,"");if(j.length===10||j.length===17){const M={esiNumber:j,hasEsi:!0};b("esiNumber",j,{shouldValidate:!0}),b("hasEsi",!0,{shouldValidate:!0}),i(M),a({esiNumber:!0}),e({message:"ESI Number extracted successfully.",type:"success"})}}},_={type:$e.OBJECT,properties:{esiNumber:{type:$e.STRING,description:"The 10 or 17-digit ESI number."}},required:["esiNumber"]};if(c){if(!l||!B){const Y=l?`Employee is not eligible for ESI as their gross salary is above the ${o.toLocaleString()} threshold.`:"ESI enrollment is currently disabled by company policy. This step is not applicable.";return r.jsx("form",{onSubmit:async j=>{j.preventDefault(),await n()},id:"esi-form",children:r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-900/40 rounded-lg border border-blue-500/50",children:[r.jsx(fg,{className:"h-5 w-5 text-blue-400 mt-0.5 flex-shrink-0"}),r.jsx("p",{className:"text-sm text-blue-300",children:Y})]})})}return r.jsxs("form",{onSubmit:m(V),id:"esi-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide your Employee's State Insurance number if applicable."}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[r.jsx("input",{type:"checkbox",...d("hasEsi"),className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),r.jsx("span",{children:"Are you covered under ESI?"})]}),v&&r.jsxs("div",{className:"space-y-4 animate-fade-in-down",children:[r.jsx("input",{placeholder:"ESI Number",...d("esiNumber"),className:"form-input"}),r.jsx("input",{type:"date",...d("esiRegistrationDate"),className:"form-input"}),r.jsx("input",{placeholder:"ESIC Branch",...d("esicBranch"),className:"form-input"}),r.jsx(ye,{name:"document",control:h,render:({field:Y})=>r.jsx(pt,{label:"Upload ESI Card",file:Y.value,onFileChange:Y.onChange,allowCapture:!0,costingItemName:"ESI Card OCR"})})]})]})]})}return l?B?r.jsxs("form",{onSubmit:m(V),id:"esi-form",children:[r.jsx(Xs,{title:"ESI Details",subtitle:"Provide your Employee's State Insurance number if applicable."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{id:"hasEsi",type:"checkbox",...d("hasEsi"),className:"h-4 w-4 text-accent"}),r.jsx("label",{htmlFor:"hasEsi",className:"ml-2 block text-sm text-muted",children:"Are you covered under ESI?"})]}),v&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 animate-fade-in-down",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx(ws,{label:"ESI Number",id:"esiNumber",hasValue:!!S.esiNumber,isVerified:s.esi.verifiedStatus?.esiNumber===!0,onManualInput:R,registration:d("esiNumber"),error:f.esiNumber?.message}),r.jsx(ye,{name:"esiRegistrationDate",control:h,render:({field:Y})=>r.jsx(Vn,{label:"ESI Registration Date",id:"esiRegistrationDate",error:f.esiRegistrationDate?.message,value:Y.value,onChange:Y.onChange,maxDate:new Date})}),r.jsx(be,{label:"ESIC Branch",id:"esicBranch",registration:d("esicBranch"),error:f.esicBranch?.message})]}),r.jsx(ye,{name:"document",control:h,render:({field:Y})=>r.jsx(pt,{label:"Upload ESI Card",file:Y.value,onFileChange:Y.onChange,onOcrComplete:W,ocrSchema:_,setToast:e,costingItemName:"ESI Card OCR"})})]})]})]}):r.jsxs("form",{onSubmit:async Y=>{Y.preventDefault(),await n()},id:"esi-form",children:[r.jsx(Xs,{title:"ESI Details",subtitle:"Employee's State Insurance eligibility."}),r.jsxs("div",{className:"mt-4 flex items-center bg-blue-50 p-4 rounded-lg",children:[r.jsx(fg,{className:"h-5 w-5 text-blue-500 mr-3"}),r.jsxs("p",{className:"text-sm text-blue-700",children:["Employee is not eligible for ESI as their gross salary is above the $",o.toLocaleString()," threshold."]})]})]}):r.jsxs("form",{onSubmit:async Y=>{Y.preventDefault(),await n()},id:"esi-form",children:[r.jsx(Xs,{title:"ESI Details",subtitle:"Employee's State Insurance eligibility."}),r.jsxs("div",{className:"mt-4 flex items-center bg-blue-50 p-4 rounded-lg",children:[r.jsx(fg,{className:"h-5 w-5 text-blue-500 mr-3"}),r.jsx("p",{className:"text-sm text-blue-700",children:"ESI enrollment is currently disabled by company policy. This step is not applicable."})]})]})},Whe=()=>{const{user:n}=bt(),e=vt(),[t,s]=k.useState([]),[i,a]=k.useState(!0),[o,l]=k.useState(""),[c,d]=k.useState({}),h=k.useRef(null),m=k.useRef(null),f=k.useRef(null);k.useEffect(()=>{(async()=>{if(n){a(!0);try{let x=[];["admin","operations_manager","hr"].includes(n.role)?x=await ce.getUsers():x=await ce.getTeamMembers(n.id),s(x);const v=x.map(S=>S.id);if(v.length>0){const S=await ce.getLatestLocations(v);d(S)}}catch(x){console.error("Failed to load team",x)}finally{a(!1)}}})()},[n]),k.useEffect(()=>{if(!h.current||m.current)return;const b=Kn.map(h.current).setView([12.9716,77.5946],11);return Kn.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(b),f.current=Kn.layerGroup().addTo(b),m.current=b,()=>{m.current&&(m.current.remove(),m.current=null,f.current=null)}},[]);const p=t.filter(b=>b.name.toLowerCase().includes(o.toLowerCase())||b.role.toLowerCase().includes(o.toLowerCase()));return k.useEffect(()=>{if(!m.current||!f.current)return;f.current.clearLayers();const b=Kn.latLngBounds([]);let x=!1;p.forEach(v=>{const S=c[v.id];if(S&&S.latitude&&S.longitude){x=!0;const B=Kn.latLng(S.latitude,S.longitude);b.extend(B);const V=`
                    <div style="
                        width: 48px; 
                        height: 48px; 
                        border-radius: 12px; 
                        border: 3px solid #10b981; 
                        box-shadow: 0 4px 8px rgba(0,0,0,0.4);
                        overflow: hidden; 
                        background: white; 
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        position: relative;
                        z-index: 10;
                    ">
                        ${v.photoUrl?`<img src="${v.photoUrl}" style="width: 100%; height: 100%; object-fit: cover;" onError="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                               <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; background: #10b981; color: white; font-weight: bold;">${v.name.charAt(0)}</div>`:`<div style="width: 100%; height: 100%; background: #10b981; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px;">${v.name.charAt(0)}</div>`}
                    </div>
                    <div style="
                        position: absolute;
                        bottom: -6px;
                        left: 50%;
                        transform: translateX(-50%);
                        width: 0; 
                        height: 0; 
                        border-left: 6px solid transparent;
                        border-right: 6px solid transparent;
                        border-top: 6px solid #10b981;
                        z-index: 5;
                    "></div>
                `,R=Kn.divIcon({html:V,className:"custom-avatar-marker",iconSize:[48,56],iconAnchor:[24,56],popupAnchor:[0,-56]});Kn.marker(B,{icon:R}).bindPopup(`
                        <div class="text-center">
                            <strong>${v.name}</strong><br/>
                            <span class="text-xs text-gray-500">${Vl(new Date(S.timestamp),{addSuffix:!0})}</span>
                        </div>
                    `).addTo(f.current)}}),x&&m.current&&m.current.fitBounds(b,{padding:[50,50],maxZoom:16})},[p,c]),k.useEffect(()=>{setTimeout(()=>{m.current?.invalidateSize()},200)}),r.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-primary-text",children:"My Team"}),r.jsx("p",{className:"text-muted text-sm mt-1",children:n?.role==="admin"?"All System Users":"Team Members Reporting to You"})]}),r.jsxs("div",{className:"relative w-full sm:w-64",children:[r.jsx(la,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted h-4 w-4"}),r.jsx("input",{type:"text",placeholder:"Search team...",value:o,onChange:b=>l(b.target.value),className:"w-full pl-10 pr-4 py-2 bg-card border border-border rounded-lg text-primary-text focus:ring-2 focus:ring-accent focus:border-accent transition-all"})]})]}),r.jsx("div",{className:"h-64 sm:h-96 w-full rounded-2xl overflow-hidden shadow-lg border border-border z-0",children:r.jsx("div",{ref:h,className:"h-full w-full z-0"})}),i?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})}):r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[p.map(b=>r.jsxs("div",{onClick:()=>e(`/my-team/${b.id}`),className:"bg-card border border-border rounded-xl p-4 hover:shadow-card-hover transition-all cursor-pointer group",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-12 w-12 rounded-full overflow-hidden bg-gray-200 border-2 border-transparent group-hover:border-accent transition-colors",children:b.photoUrl?r.jsx("img",{src:b.photoUrl,alt:b.name,className:"h-full w-full object-cover"}):r.jsx("div",{className:"h-full w-full flex items-center justify-center bg-accent/10 text-accent font-bold text-lg",children:b.name.charAt(0)})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-primary-text group-hover:text-accent transition-colors",children:b.name}),r.jsx("p",{className:"text-xs text-muted capitalize bg-page px-2 py-0.5 rounded-full w-fit mt-1",children:b.role.replace("_"," ")})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-border flex justify-between items-center text-sm",children:[r.jsxs("span",{className:"text-muted flex items-center gap-1",children:[r.jsx(Bi,{className:"h-3 w-3"}),c[b.id]?r.jsxs("span",{className:"text-xs truncate max-w-[150px]",children:["Last active ",Vl(new Date(c[b.id].timestamp),{addSuffix:!0})]}):"No location history"]}),r.jsx("span",{className:"text-accent font-medium text-xs",children:"View Details "})]})]},b.id)),p.length===0&&r.jsx("div",{className:"col-span-full text-center py-10 text-muted",children:"No team members found."})]})]})},Vhe=(n,e,t,s)=>{const a=ff(t-n),o=ff(s-e),l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(ff(n))*Math.cos(ff(t))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},ff=n=>n*(Math.PI/180),_he=()=>{const{userId:n}=Bg(),e=vt(),[t,s]=k.useState(null),[i,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState(!0),[h,m]=k.useState(He(new Date,"yyyy-MM-dd")),{theme:f}=Fl();k.useEffect(()=>{(async()=>{if(n){d(!0);try{const V=(await ce.getUsers()).find(j=>j.id===n);s(V||null);const R=await ce.getLocationHistory(n,h);a(R);const W=`${h}T00:00:00`,_=`${h}T23:59:59`,Y=await ce.getAttendanceEvents(n,W,_);l(Y)}catch(B){console.error("Failed to load profile",B)}finally{d(!1)}}})()},[n,h]);const p=(S,B)=>{if(!i.length)return 0;const V=new Date(S).getTime(),R=new Date(B).getTime(),W=i.filter(Y=>{const j=new Date(Y.timestamp).getTime();return j>=V&&j<=R});if(W.length<2)return 0;let _=0;for(let Y=1;Y<W.length;Y++)_+=Vhe(W[Y-1].latitude,W[Y-1].longitude,W[Y].latitude,W[Y].longitude);return _},b=k.useMemo(()=>{const S=[],B=[...o].sort((_,Y)=>new Date(_.timestamp).getTime()-new Date(Y.timestamp).getTime());let V=null,R=null,W=0;for(;W<B.length;){const _=B[W];if(_.type==="check-in"){if(V&&R&&new Date(_.timestamp)>new Date(V)){const j=p(V,_.timestamp),M=Uc(Vc(_.timestamp),Vc(V));S.push({type:"travel",startTime:V,endTime:_.timestamp,durationMinutes:M,distanceKm:j,startLocation:R,endLocation:{lat:_.latitude||0,lng:_.longitude||0}})}const Y=B[W+1];if(Y&&Y.type==="check-out"){const j=Uc(Vc(Y.timestamp),Vc(_.timestamp));S.push({type:"work",startTime:_.timestamp,endTime:Y.timestamp,durationMinutes:j,locationId:_.locationId,startLocation:{lat:_.latitude||0,lng:_.longitude||0}}),V=Y.timestamp,R={lat:Y.latitude||0,lng:Y.longitude||0},W+=2}else S.push({type:"work",startTime:_.timestamp,endTime:"In Progress",durationMinutes:0,locationId:_.locationId,startLocation:{lat:_.latitude||0,lng:_.longitude||0}}),V=null,R=null,W+=1}else W+=1}return S},[o,i]),x=k.useMemo(()=>{const S=b.filter(R=>R.type==="travel").reduce((R,W)=>R+(W.distanceKm||0),0),B=b.filter(R=>R.type==="travel").reduce((R,W)=>R+W.durationMinutes,0),V=b.filter(R=>R.type==="work"&&R.endTime!=="In Progress").reduce((R,W)=>R+W.durationMinutes,0);return{totalDist:S,totalTravelMins:B,totalWorkMins:V}},[b]),v=()=>{if(!b.length)return;const S=["Type","Start Time","End Time","Duration (m)","Distance (km)","Location"],B=b.map(_=>[_.type.toUpperCase(),He(Vc(_.startTime),"yyyy-MM-dd HH:mm:ss"),_.endTime==="In Progress"?"In Progress":He(Vc(_.endTime),"yyyy-MM-dd HH:mm:ss"),_.durationMinutes,_.distanceKm?_.distanceKm.toFixed(2):"0",_.locationId||"N/A"]),V="data:text/csv;charset=utf-8,"+[S.join(","),...B.map(_=>_.join(","))].join(`
`),R=encodeURI(V),W=document.createElement("a");W.setAttribute("href",R),W.setAttribute("download",`${t?.name}_activity_report_${h}.csv`),document.body.appendChild(W),W.click(),document.body.removeChild(W)};return c?r.jsx("div",{className:"flex justify-center items-center h-screen",children:r.jsx(xt,{className:"animate-spin text-accent h-8 w-8"})}):t?r.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-page rounded-full text-muted hover:text-primary-text transition-colors",children:r.jsx(Ri,{className:"h-6 w-6"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-primary-text",children:t.name}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted",children:[r.jsx("span",{className:"capitalize px-2 py-0.5 rounded-full bg-accent/10 text-accent font-medium",children:t.role.replace("_"," ")}),r.jsx("span",{children:""}),r.jsx("span",{children:t.email})]})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:v,disabled:b.length===0,className:"px-4 py-2 bg-card border border-border rounded-lg text-sm font-medium hover:bg-accent hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Export Report"}),r.jsx(Vn,{label:"",id:"report-date",value:h,onChange:m,align:"right"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsx("div",{className:"space-y-6 lg:col-span-1",children:r.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[r.jsxs("div",{className:"bg-card p-5 rounded-xl border border-border shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10 text-blue-500 dark:text-blue-400",children:r.jsx(IZ,{className:"h-5 w-5"})}),r.jsx("span",{className:"text-sm font-medium text-muted",children:"Total Distance"})]}),r.jsxs("p",{className:"text-3xl font-bold text-primary-text",children:[x.totalDist.toFixed(2)," ",r.jsx("span",{className:"text-lg text-muted font-normal",children:"km"})]}),r.jsxs("p",{className:"text-xs text-muted mt-1",children:["Traveled across ",b.filter(S=>S.type==="travel").length," trips"]})]}),r.jsxs("div",{className:"bg-card p-5 rounded-xl border border-border shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10 text-emerald-500 dark:text-emerald-400",children:r.jsx(jo,{className:"h-5 w-5"})}),r.jsx("span",{className:"text-sm font-medium text-muted",children:"Work Duration"})]}),r.jsxs("p",{className:"text-3xl font-bold text-primary-text",children:[Math.floor(x.totalWorkMins/60),"h ",x.totalWorkMins%60,"m"]}),r.jsx("p",{className:"text-xs text-muted mt-1",children:"Total time at site locations"})]}),r.jsxs("div",{className:"bg-card p-5 rounded-xl border border-border shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10 text-amber-500 dark:text-amber-400",children:r.jsx(g$,{className:"h-5 w-5"})}),r.jsx("span",{className:"text-sm font-medium text-muted",children:"Travel Time"})]}),r.jsxs("p",{className:"text-3xl font-bold text-primary-text",children:[Math.floor(x.totalTravelMins/60),"h ",x.totalTravelMins%60,"m"]}),r.jsx("p",{className:"text-xs text-muted mt-1",children:"Total time spent commuting"})]})]})}),r.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[r.jsxs("h3",{className:"font-semibold text-lg text-primary-text flex items-center gap-2",children:[r.jsx(ra,{className:"h-5 w-5 text-accent"}),"Activity Timeline"]}),r.jsx("div",{className:"bg-card rounded-xl border border-border p-6 min-h-[400px]",children:b.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-muted",children:[r.jsx(jo,{className:"h-12 w-12 mb-4 opacity-20"}),r.jsx("p",{children:"No activity recorded for this date."})]}):r.jsx("div",{className:"relative space-y-0 before:absolute before:inset-y-0 before:left-6 before:w-0.5 before:bg-border/50",children:b.map((S,B)=>r.jsxs("div",{className:"relative pl-14 pb-8 last:pb-0 group",children:[r.jsx("div",{className:`absolute left-3 -translate-x-1/2 top-0 w-6 h-6 rounded-full border-4 border-card z-10 flex items-center justify-center
                                            ${S.type==="work"?"bg-emerald-500":"bg-amber-500 ring-4 ring-amber-500/10"}
                                        `}),r.jsxs("div",{className:`p-4 rounded-xl border ${S.type==="work"?"bg-page border-border":"bg-amber-50/50 dark:bg-amber-900/10 border-amber-100 dark:border-amber-800/30"} transition-all hover:shadow-md`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-2 mb-2",children:[r.jsxs("div",{children:[r.jsx("span",{className:`text-xs font-bold uppercase tracking-wider mb-1 block ${S.type==="work"?"text-emerald-600":"text-amber-600"}`,children:S.type==="work"?"At Location":"Travel"}),r.jsx("h4",{className:"font-semibold text-primary-text",children:S.type==="work"?S.locationId?`Site: ${S.locationId}`:"Unknown Location (Site)":"Travel to next stop"})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm font-mono font-medium text-primary-text",children:[He(Vc(S.startTime),"hh:mm a"),r.jsx("span",{className:"text-muted mx-1",children:"-"}),S.endTime==="In Progress"?"Now":He(Vc(S.endTime),"hh:mm a")]}),r.jsxs("div",{className:"text-xs text-muted",children:[Math.floor(S.durationMinutes/60),"h ",S.durationMinutes%60,"m"]})]})]}),S.type==="travel"&&r.jsx("div",{className:"flex items-center gap-4 text-xs text-muted mt-3 pt-3 border-t border-border/50",children:r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(IZ,{className:"h-3 w-3"}),r.jsxs("span",{children:[S.distanceKm?.toFixed(2)," km"]})]})}),S.type==="work"&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted mt-2",children:[r.jsx(Bi,{className:"h-3 w-3"}),r.jsxs("span",{children:["Lat: ",S.startLocation?.lat.toFixed(4),", Lng: ",S.startLocation?.lng.toFixed(4)]})]})]})]},B))})})]})]})]}):r.jsx("div",{className:"p-6 text-center text-muted",children:"User not found."})},jhe=Bt({isOptedIn:hr().nullable().required("Please choose whether you want to avail Group Medical Cover."),selectedSpouseId:pe().optional(),selectedChildIds:Rr().of(pe().required()).optional(),gmcPolicyCopy:Et().when("isOptedIn",{is:!1,then:n=>n.required("Please upload GMC policy copy (PNG, JPG, PDF up to 5MB)."),otherwise:n=>n.optional().nullable()}),declarationAccepted:hr().when("isOptedIn",{is:!1,then:n=>n.oneOf([!0],"Please accept the declaration to proceed."),otherwise:n=>n.optional()}),policyAmount:pe().optional().nullable(),nomineeName:pe().optional().nullable(),nomineeRelation:pe().optional().nullable(),wantsToAddDependents:hr().optional().nullable(),optOutReason:pe().optional().nullable(),alternateInsuranceProvider:pe().optional().nullable(),alternateInsuranceStartDate:pe().optional().nullable(),alternateInsuranceEndDate:pe().optional().nullable(),alternateInsuranceCoverage:pe().optional().nullable()}).defined(),Xhe=()=>{const{onValidated:n}=ki(),{user:e}=bt(),{data:t,updateGmc:s}=Qn(),i=jt("(max-width: 767px)"),{control:a,handleSubmit:o,formState:{errors:l},watch:c,reset:d,setValue:h,getValues:m}=tn({resolver:Yn(jhe),defaultValues:t.gmc}),f=c("isOptedIn"),p=c("selectedSpouseId"),b=c("selectedChildIds")||[],x=k.useMemo(()=>t.family.find(R=>R.relation==="Spouse"),[t.family]),v=k.useMemo(()=>t.family.filter(R=>R.relation==="Child"),[t.family]),S=k.useMemo(()=>{const R=[];return x&&R.push(x),R.push(...v),R},[x,v]);k.useEffect(()=>{if(t.gmc.isOptedIn===!0){const R=!t.gmc.selectedSpouseId&&(!t.gmc.selectedChildIds||t.gmc.selectedChildIds.length===0),W=x||v.length>0;R&&W&&(h("selectedSpouseId",x?.id||"",{shouldDirty:!0}),h("selectedChildIds",v.map(_=>_.id),{shouldDirty:!0}))}},[t.gmc.isOptedIn,x,v,h,t.gmc.selectedSpouseId,t.gmc.selectedChildIds]),k.useEffect(()=>{d(t.gmc)},[t.gmc,d]),k.useEffect(()=>{let R;const W=c(_=>{clearTimeout(R),R=window.setTimeout(()=>{s(_)},500)});return()=>{W.unsubscribe(),clearTimeout(R)}},[c,s]);const B=async R=>{const W={...R};R.isOptedIn?(W.gmcPolicyCopy=null,W.declarationAccepted=!1):(W.selectedSpouseId="",W.selectedChildIds=[]),s(W),await n()},V=(R,W)=>{if(R.relation==="Spouse")h("selectedSpouseId",W?R.id:"",{shouldDirty:!0});else{const _=m("selectedChildIds")||[],Y=W?[..._,R.id]:_.filter(j=>j!==R.id);h("selectedChildIds",Y,{shouldDirty:!0})}};return i?r.jsxs("form",{onSubmit:o(B),id:"gmc-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Please choose whether to enroll in the company's insurance plan."}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-md font-semibold",children:"Would you like to Avail Group Medical Cover?"}),r.jsx(ye,{name:"isOptedIn",control:a,render:({field:R})=>r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${R.value===!0?"border-[#32cd32] bg-[#243524]":"border-[#374151]"}`,children:[r.jsx("input",{type:"radio",name:R.name,onBlur:R.onBlur,ref:R.ref,onChange:()=>R.onChange(!0),checked:R.value===!0,className:"h-4 w-4 text-accent focus:ring-accent bg-transparent border-muted"}),r.jsx("span",{className:"ml-3 text-sm font-medium",children:"Yes"})]}),r.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${R.value===!1?"border-[#32cd32] bg-[#243524]":"border-[#374151]"}`,children:[r.jsx("input",{type:"radio",name:R.name,onBlur:R.onBlur,ref:R.ref,onChange:()=>R.onChange(!1),checked:R.value===!1,className:"h-4 w-4 text-accent focus:ring-accent bg-transparent border-muted"}),r.jsx("span",{className:"ml-3 text-sm font-medium",children:"No"})]})]})}),f===!0&&r.jsxs("div",{className:"pt-4 space-y-4 animate-fade-in-down",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Select Dependents"}),S.map(R=>{const W=R.relation==="Spouse"?p===R.id:b.includes(R.id);return r.jsx(Nn,{id:`dep-mob-${R.id}`,label:`${R.name} (${R.relation})`,checked:W,onChange:_=>V(R,_)},R.id)})]}),f===!1&&r.jsxs("div",{className:"pt-4 space-y-4 animate-fade-in-down",children:[r.jsx(ye,{name:"gmcPolicyCopy",control:a,render:({field:R,fieldState:W})=>r.jsx(pt,{label:"Upload GMC Policy Copy",file:R.value,onFileChange:R.onChange,error:W.error?.message,allowCapture:!0})}),r.jsx(ye,{name:"declarationAccepted",control:a,render:({field:R,fieldState:W})=>r.jsxs("label",{className:"flex items-center gap-3 p-4 bg-[#243524] rounded-lg border border-[#374151]",children:[r.jsx("input",{type:"checkbox",checked:R.value??!1,onChange:R.onChange,className:"h-5 w-5 rounded text-accent focus:ring-accent bg-transparent border-[#9ca89c]"}),r.jsx("span",{children:"I declare I will not avail company GMC and the uploaded policy is valid."})]})})]})]})]}):r.jsxs("form",{onSubmit:o(B),id:"gmc-form",children:[r.jsx(Xs,{title:"Group Medical Cover (GMC)",subtitle:"Please choose whether to enroll in the company's insurance plan."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-md font-semibold text-primary-text mb-2 block",children:"Would you like to Avail Group Medical Cover?"}),r.jsx(ye,{name:"isOptedIn",control:a,render:({field:R})=>r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[r.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${R.value===!0?"border-accent bg-accent-light":"border-border"}`,children:[r.jsx("input",{type:"radio",name:R.name,onBlur:R.onBlur,ref:R.ref,onChange:()=>R.onChange(!0),checked:R.value===!0,className:"h-4 w-4 text-accent focus:ring-accent"}),r.jsx("span",{className:"ml-3 text-sm font-medium",children:"Yes"})]}),r.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer flex-1 ${R.value===!1?"border-accent bg-accent-light":"border-border"}`,children:[r.jsx("input",{type:"radio",name:R.name,onBlur:R.onBlur,ref:R.ref,onChange:()=>R.onChange(!1),checked:R.value===!1,className:"h-4 w-4 text-accent focus:ring-accent"}),r.jsx("span",{className:"ml-3 text-sm font-medium",children:"No"})]})]})}),l.isOptedIn&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.isOptedIn.message})]}),f===!0&&r.jsxs("div",{className:"pt-4 border-t space-y-4 animate-fade-in-down",children:[r.jsx("label",{className:"text-md font-semibold text-primary-text mb-2 block",children:"Select Dependents for Policy"}),r.jsx("p",{className:"text-sm text-muted -mt-2 mb-2",children:"Spouse and children are included by default. Uncheck any dependents you do not want to include."}),r.jsx("div",{className:"space-y-2 p-4 border rounded-lg bg-page",children:S.length>0?S.map(R=>{const W=R.relation==="Spouse"?p===R.id:b.includes(R.id);return r.jsx(Nn,{id:`dep-${R.id}`,label:`${R.name} (${R.relation})`,checked:W,onChange:_=>V(R,_)},R.id)}):r.jsx("p",{className:"text-sm text-muted",children:'No spouse or children added. Please add them in the "Family Details" section to include them in the policy.'})})]}),f===!1&&r.jsxs("div",{className:"pt-4 border-t space-y-4 animate-fade-in-down",children:[r.jsx(ye,{name:"gmcPolicyCopy",control:a,render:({field:R,fieldState:W})=>r.jsx(pt,{label:"Upload GMC Policy Copy",file:R.value,onFileChange:R.onChange,allowedTypes:["image/png","image/jpeg","application/pdf"],error:W.error?.message})}),r.jsx(ye,{name:"declarationAccepted",control:a,render:({field:R,fieldState:W})=>r.jsxs("div",{className:"space-y-1",children:[r.jsx(Nn,{id:"declarationAccepted",label:"I declare that I will not avail company GMC and the uploaded policy is valid.",checked:R.value??!1,onChange:R.onChange}),W.error&&r.jsx("p",{className:"text-xs text-red-600",children:W.error.message})]})})]})]})]})},Jhe=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),s=vt(),{data:i,updateUniforms:a}=Qn(),o=jt("(max-width: 767px)"),[l,c]=k.useState(!0),[d,h]=k.useState(null),{gender:m}=i.personal,{organizationId:f,department:p,designation:b}=i.organization,{control:x,handleSubmit:v,reset:S,watch:B}=tn(),{fields:V,replace:R}=Wr({control:x,name:"uniforms"});k.useEffect(()=>{(async()=>{c(!0);try{const[M,H,D]=await Promise.all([ce.getAllSiteUniformDetails(),ce.getMasterGentsUniforms(),ce.getMasterLadiesUniforms()]);h({details:M,gents:H,ladies:D})}catch{e({message:"Failed to load uniform configuration.",type:"error"})}finally{c(!1)}})()},[e]);const W=k.useMemo(()=>{if(!d||!f||!p||!b)return[];const j=d.details[f];if(!j)return[];const M=j.departments.find(D=>D.department===p);return M?M.designations.find(D=>D.designation===b)?.items||[]:[]},[d,f,p,b]);k.useEffect(()=>{const j=W.map(M=>{const H=i.uniforms.find(z=>z.itemId===M.id),D=M.name.toLowerCase().includes("pant")?"Pants":"Shirts";return{itemId:M.id,itemName:M.name,category:D,sizeId:H?.sizeId||"",quantity:H?.quantity||1}});R(j)},[W,i.uniforms,R]),k.useEffect(()=>{let j;const M=B(H=>{clearTimeout(j),j=window.setTimeout(()=>{const D=H,z=m==="Female"?[...d?.ladies.pants||[],...d?.ladies.shirts||[]]:[...d?.gents.pants||[],...d?.gents.shirts||[]],O=(D.uniforms||[]).filter(E=>E.sizeId&&E.quantity>0).map(E=>{const te=z.find(q=>q.id===E.sizeId);return{itemId:E.itemId,itemName:E.itemName,sizeId:E.sizeId,sizeLabel:te?.size||"",fit:te?.fit||"",quantity:E.quantity}});a(O)},500)});return()=>{M.unsubscribe(),clearTimeout(j)}},[B,a,m,d]);const _=async j=>{const M=m==="Female"?[...d?.ladies.pants||[],...d?.ladies.shirts||[]]:[...d?.gents.pants||[],...d?.gents.shirts||[]],H=j.uniforms.filter(D=>D.sizeId&&D.quantity>0).map(D=>{const z=M.find(O=>O.id===D.sizeId);return{itemId:D.itemId,itemName:D.itemName,sizeId:D.sizeId,sizeLabel:z?.size||"",fit:z?.fit||"",quantity:D.quantity}});a(H),await n()};if(l)return r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx(xt,{className:"h-8 w-8 animate-spin text-accent"})});if(W.length===0&&i.uniforms.length>0)return r.jsxs("form",{onSubmit:async j=>{j.preventDefault(),await n()},id:"uniform-form",children:[!o&&r.jsx(Xs,{title:"Uniform Details",subtitle:"The following items have been selected for this employee."}),r.jsxs("div",{className:"space-y-4",children:[i.uniforms.map(j=>r.jsx("div",{className:`p-4 border rounded-lg flex justify-between items-center ${o?"bg-[#243524] border-border":"bg-page"}`,children:r.jsxs("div",{children:[r.jsx("p",{className:`font-semibold ${o?"text-white":"text-primary-text"}`,children:j.itemName}),r.jsxs("p",{className:`text-sm ${o?"text-gray-400":"text-muted"}`,children:["Size: ",j.sizeLabel,", Fit: ",j.fit,", Quantity: ",j.quantity]})]})},j.itemId+j.sizeId)),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>s("/onboarding/uniforms?from=onboarding"),children:[r.jsx(ms,{className:"mr-2 h-4 w-4"}),"Edit Uniform Selection"]})]})]});if(!m||W.length===0){const j=m?"No uniform requirements found for the selected site, department, and designation.":"Please select a gender in 'Personal Details' to view uniform options.",M=m&&W.length===0;return r.jsxs("form",{onSubmit:async H=>{H.preventDefault(),await n()},id:"uniform-form",children:[!o&&r.jsx(Xs,{title:"Uniform Details",subtitle:"Provide uniform measurements for the employee."}),r.jsxs("div",{className:`text-center p-8 rounded-lg ${o?"":"bg-page"}`,children:[r.jsx(Lu,{className:`h-12 w-12 mx-auto ${o?"text-gray-500":"text-muted"}`}),r.jsx("p",{className:`mt-4 ${o?"text-gray-400":"text-muted"}`,children:j}),M&&r.jsxs("div",{className:"mt-6",children:[r.jsx("p",{className:`text-sm mb-4 ${o?"text-gray-500":"text-muted"}`,children:"You can proceed to the next step, or create a new site-level request if uniforms are needed."}),r.jsxs(se,{type:"button",onClick:()=>s("/onboarding/uniforms?from=onboarding"),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Create Site Uniform Request"]})]})]})]})}const Y=m==="Female"?d?.ladies:d?.gents;return o?r.jsxs("form",{onSubmit:v(_),id:"uniform-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Provide uniform measurements for the employee."}),r.jsx("div",{className:"space-y-4",children:V.map((j,M)=>{const H=j.category==="Pants"?Y?.pants:Y?.shirts;return r.jsxs("div",{className:"p-4 border border-border rounded-xl space-y-4",children:[r.jsx("h4",{className:"font-semibold text-primary-text",children:j.itemName}),r.jsx(ye,{name:`uniforms.${M}.sizeId`,control:x,render:({field:D})=>r.jsxs("select",{...D,className:"pro-select pro-select-arrow",children:[r.jsx("option",{value:"",children:"-- Select Size --"}),H?.map(z=>r.jsxs("option",{value:z.id,children:["Size: ",z.size," - ",z.fit]},z.id))]})}),r.jsx(ye,{name:`uniforms.${M}.quantity`,control:x,render:({field:D})=>r.jsx("input",{type:"number",min:"1",...D,className:"form-input"})})]},j.id)})})]}):r.jsxs("form",{onSubmit:v(_),id:"uniform-form",children:[r.jsx(Xs,{title:"Uniform Details",subtitle:"Provide uniform measurements for the employee."}),r.jsx("div",{className:"space-y-6",children:V.map((j,M)=>{const H=j.category==="Pants"?Y?.pants:Y?.shirts;return r.jsxs("div",{className:"p-4 border border-border rounded-xl bg-page/50",children:[r.jsx("h4",{className:"font-semibold text-primary-text mb-2",children:j.itemName}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsx(ye,{name:`uniforms.${M}.sizeId`,control:x,rules:{required:"Please select a size"},render:({field:D,fieldState:z})=>r.jsxs(Oe,{label:"Size & Fit",error:z.error?.message,...D,children:[r.jsx("option",{value:"",children:"-- Select Size --"}),H?.map(O=>r.jsxs("option",{value:O.id,children:["Size: ",O.size," - ",O.fit]},O.id))]})}),r.jsx(ye,{name:`uniforms.${M}.quantity`,control:x,rules:{required:!0,min:1},render:({field:D})=>r.jsx(be,{label:"Quantity",type:"number",min:"1",...D})})]})]},j.id)})})]})},qh=n=>n?n.toLowerCase().replace(/\b(\w)/g,e=>e.toUpperCase()):"",Yhe=()=>{const{onValidated:n,setToast:e}=ki(),{user:t}=bt(),s=vt(),{data:i,updatePersonal:a,updateBank:o,addEducationRecord:l,updateFamilyMember:c,updateEducationRecord:d,updateUan:h,updateEsi:m,updateGmc:f}=Qn(),p=jt("(max-width: 767px)"),b=H=>{const D={};if(H.name){const z=H.name.split(" ");D.firstName=qh(z.shift()||""),D.lastName=qh(z.pop()||""),D.middleName=qh(z.join(" "))}if(H.dob)try{const z=new Date(H.dob);isNaN(z.getTime())||(D.dob=He(z,"yyyy-MM-dd"))}catch{}H.aadhaarNumber&&(D.idProofNumber=H.aadhaarNumber.replace(/\s/g,""),D.idProofType="Aadhaar"),a(D)},x=H=>{const D={};if(H.accountHolderName&&(D.accountHolderName=qh(H.accountHolderName)),H.accountNumber){const z=H.accountNumber.replace(/\D/g,"");D.accountNumber=z,D.confirmAccountNumber=z}H.ifscCode&&(D.ifscCode=H.ifscCode.toUpperCase().replace(/\s/g,"")),o(D)},v=H=>{const D={};H.uanNumber&&(D.uanNumber=H.uanNumber.replace(/\D/g,""),D.hasPreviousPf=!0),h(D)},S=H=>{const D={};H.esiNumber&&(D.esiNumber=H.esiNumber.replace(/\D/g,""),D.hasEsi=!0),m(D)},B=H=>D=>{const z={};if(D.name&&(z.name=qh(D.name)),D.dob)try{const O=new Date(D.dob);isNaN(O.getTime())||(z.dob=He(O,"yyyy-MM-dd"))}catch{}c(H,z)},V=H=>D=>{const z={};D.degree&&(z.degree=D.degree),D.institution&&(z.institution=D.institution),D.endYear&&(z.endYear=D.endYear.toString()),d(H,z)},R={type:$e.OBJECT,properties:{name:{type:$e.STRING},dob:{type:$e.STRING},aadhaarNumber:{type:$e.STRING}}},W={type:$e.OBJECT,properties:{accountHolderName:{type:$e.STRING},accountNumber:{type:$e.STRING},ifscCode:{type:$e.STRING}}},_={type:$e.OBJECT,properties:{uanNumber:{type:$e.STRING,description:"The 12-digit Universal Account Number (UAN)."},pfNumber:{type:$e.STRING,description:"The Provident Fund (PF) account number."},esiNumber:{type:$e.STRING,description:"The 10 or 17-digit ESI number."}}},Y={type:$e.OBJECT,properties:{uanNumber:{type:$e.STRING}}},j={type:$e.OBJECT,properties:{esiNumber:{type:$e.STRING}}},M={type:$e.OBJECT,properties:{degree:{type:$e.STRING},institution:{type:$e.STRING},endYear:{type:$e.STRING}}};return p?r.jsxs("form",{onSubmit:async H=>{H.preventDefault(),await n()},id:"documents-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Upload supporting documents. You can also do this within each relevant section."}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(pt,{label:"ID Proof (Front Side)",file:i.personal.idProofFront,onFileChange:H=>a({idProofFront:H}),onOcrComplete:b,ocrSchema:R,setToast:e,allowCapture:!0,docType:i.personal.idProofType||"Aadhaar"}),r.jsx(pt,{label:"ID Proof (Back Side)",file:i.personal.idProofBack,onFileChange:H=>a({idProofBack:H}),onOcrComplete:b,ocrSchema:R,setToast:e,allowCapture:!0,docType:i.personal.idProofType||"Aadhaar"}),r.jsx(pt,{label:"Profile Photo",file:i.personal.photo,onFileChange:H=>a({photo:H}),allowCapture:!0,allowedTypes:["image/jpeg","image/png","image/webp"]}),r.jsx(pt,{label:"Bank Proof",file:i.bank.bankProof,onFileChange:H=>o({bankProof:H}),onOcrComplete:x,ocrSchema:W,setToast:e,allowCapture:!0,docType:"Bank"}),r.jsx(pt,{label:"Latest Salary Slip (Optional, for UAN/ESI)",file:i.uan.salarySlip,onFileChange:H=>h({salarySlip:H}),onOcrComplete:H=>{v(H),S(H)},ocrSchema:_,setToast:e,allowCapture:!0,docType:"Salary"}),i.uan.hasPreviousPf&&r.jsx(pt,{label:"UAN Document",file:i.uan.document,onFileChange:H=>h({document:H}),onOcrComplete:v,ocrSchema:Y,setToast:e,allowCapture:!0,docType:"UAN"}),i.esi.hasEsi&&r.jsx(pt,{label:"ESI Document",file:i.esi.document,onFileChange:H=>m({document:H}),onOcrComplete:S,ocrSchema:j,setToast:e,allowCapture:!0}),i.gmc.isOptedIn===!1&&r.jsx(pt,{label:"GMC Policy Copy",file:i.gmc.gmcPolicyCopy,onFileChange:H=>f({gmcPolicyCopy:H}),allowCapture:!0}),r.jsxs("div",{className:"mt-6 pt-6 border-t border-[#374151]",children:[r.jsx("h4",{className:"form-header-title mb-4",children:"Education Certificates"}),r.jsxs("div",{className:"space-y-4",children:[i.education.map(H=>r.jsx(pt,{label:`Certificate for ${H.degree||"Qualification"}`,file:H.document,onFileChange:D=>d(H.id,{document:D}),onOcrComplete:V(H.id),ocrSchema:M,setToast:e,allowCapture:!0},H.id)),r.jsxs(se,{type:"button",onClick:()=>s("/onboarding/add/education"),variant:"secondary",className:"w-full flex items-center justify-center",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:"Add / Edit Qualifications"})]})]})]}),r.jsxs("div",{className:"mt-6 pt-6 border-t border-[#374151]",children:[r.jsx("h4",{className:"form-header-title mb-4",children:"Family Member Documents"}),r.jsxs("div",{className:"space-y-4",children:[i.family.map(H=>r.jsx(pt,{label:`ID Proof for ${H.name||"Family Member"}`,file:H.idProof,onFileChange:D=>c(H.id,{idProof:D}),onOcrComplete:B(H.id),ocrSchema:R,setToast:e,allowCapture:!0,docType:"Aadhaar"},H.id)),i.family.length===0&&r.jsx("p",{className:"text-sm text-gray-400",children:"No family members added."}),r.jsxs(se,{type:"button",onClick:()=>s("/onboarding/add/family"),variant:"secondary",className:"w-full flex items-center justify-center",children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"}),r.jsx("span",{children:"Add/Edit on Family Page"})]})]})]})]})]}):r.jsxs("form",{onSubmit:async H=>{H.preventDefault(),await n()},id:"documents-form",children:[r.jsx(Xs,{title:"Document Collection",subtitle:"Upload supporting documents. You can also do this within each relevant section."}),r.jsxs("div",{className:"space-y-6",children:[r.jsx("section",{children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[r.jsx(pt,{label:"Employee ID Proof (Aadhaar/PAN) - Front Side",file:i.personal.idProofFront,onFileChange:H=>a({idProofFront:H}),onOcrComplete:b,ocrSchema:R,setToast:e,docType:i.personal.idProofType||"Aadhaar"}),r.jsx(pt,{label:"Employee ID Proof (Aadhaar/PAN) - Back Side",file:i.personal.idProofBack,onFileChange:H=>a({idProofBack:H}),onOcrComplete:b,ocrSchema:R,setToast:e,docType:i.personal.idProofType||"Aadhaar"}),r.jsx(pt,{label:"Bank Proof (Passbook/Cancelled Cheque)",file:i.bank.bankProof,onFileChange:H=>o({bankProof:H}),onOcrComplete:x,ocrSchema:W,setToast:e,docType:"Bank"}),r.jsx(pt,{label:"Latest Salary Slip (Optional, for UAN/ESI)",file:i.uan.salarySlip,onFileChange:H=>h({salarySlip:H}),onOcrComplete:H=>{v(H),S(H)},ocrSchema:_,setToast:e,docType:"Salary"})]})}),r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Education Certificates"}),r.jsxs("div",{className:"space-y-4",children:[i.education.map(H=>r.jsx(pt,{label:`Certificate for ${H.degree||"New Qualification"}`,file:H.document,onFileChange:D=>d(H.id,{document:D}),onOcrComplete:V(H.id),ocrSchema:M,setToast:e},H.id)),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>l(),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Add Qualification"]})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Family Member Documents"}),r.jsxs("div",{className:"space-y-4",children:[i.family.map(H=>r.jsx(pt,{label:`ID Proof for ${H.name||`(${H.relation})`}`,file:H.idProof,onFileChange:D=>c(H.id,{idProof:D}),onOcrComplete:B(H.id),ocrSchema:R,setToast:e,docType:"Aadhaar"},H.id)),i.family.length===0&&r.jsx("p",{className:"text-sm text-muted",children:"No family members added yet."}),r.jsxs(se,{type:"button",variant:"outline",onClick:()=>s("/onboarding/add/family"),children:[r.jsx(Tt,{className:"mr-2 h-4 w-4"})," Go to Family Page to Add/Edit"]})]})]})]})]})},Fhe=Bt({signatureImage:Et().required("A signature image is mandatory.").nullable(),fingerprints:Bt().shape({leftThumb:Et().optional().nullable(),leftIndex:Et().optional().nullable(),leftMiddle:Et().optional().nullable(),leftRing:Et().optional().nullable(),leftLittle:Et().optional().nullable(),rightThumb:Et().optional().nullable(),rightIndex:Et().optional().nullable(),rightMiddle:Et().optional().nullable(),rightRing:Et().optional().nullable(),rightLittle:Et().optional().nullable()})}).defined(),Mhe=[{hand:"Left",key:"leftThumb",name:"Thumb"},{hand:"Left",key:"leftIndex",name:"Index"},{hand:"Left",key:"leftMiddle",name:"Middle"},{hand:"Left",key:"leftRing",name:"Ring"},{hand:"Left",key:"leftLittle",name:"Little"},{hand:"Right",key:"rightThumb",name:"Thumb"},{hand:"Right",key:"rightIndex",name:"Index"},{hand:"Right",key:"rightMiddle",name:"Middle"},{hand:"Right",key:"rightRing",name:"Ring"},{hand:"Right",key:"rightLittle",name:"Little"}],Hhe=()=>{const{onValidated:n}=ki(),{data:e,updateBiometrics:t}=Qn(),{user:s}=bt(),i=jt("(max-width: 767px)"),{control:a,handleSubmit:o,formState:{errors:l},reset:c,watch:d}=tn({resolver:Yn(Fhe),defaultValues:e.biometrics});k.useEffect(()=>{c(e.biometrics)},[e.biometrics,c]),k.useEffect(()=>{const p=d(b=>{t(b)});return()=>p.unsubscribe()},[d,t]);const h=async(p,b)=>{try{const x=await ce.verifyFingerprintImage(p,b);return x.containsFingerprints?{success:!0,reason:""}:{success:!1,reason:x.reason||"Image does not appear to contain fingerprints. Please upload a clear scan."}}catch(x){return{success:!1,reason:x.message||"AI verification failed."}}},m=async p=>{t(p),await n()},f=p=>Mhe.filter(b=>b.hand===p).map(b=>r.jsx(ye,{name:`fingerprints.${b.key}`,control:a,render:({field:x})=>r.jsx(pt,{label:`${p} ${b.name}`,file:x.value,onFileChange:x.onChange,onVerification:h,allowCapture:!0})},b.key));return r.jsxs("form",{onSubmit:o(m),id:"biometrics-form",children:[!i&&r.jsx(Xs,{title:"Biometrics",subtitle:"Please provide fingerprint scans and a mandatory signature."}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{children:[r.jsxs("h4",{className:`text-lg font-semibold text-center mb-4 ${i?"form-header-title":"text-primary-text"}`,children:["Signature ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"w-full",children:r.jsx(ye,{name:"signatureImage",control:a,render:({field:p,fieldState:b})=>r.jsx(pt,{label:"Upload or capture a signature",file:p.value,onFileChange:p.onChange,allowCapture:!0,error:b.error?.message})})})]}),r.jsx("div",{className:i?"":"my-8 border-t border-border"}),r.jsxs("div",{children:[r.jsx("h4",{className:`text-lg font-semibold text-center mb-4 ${i?"form-header-title":"text-primary-text"}`,children:"Fingerprints (Optional)"}),r.jsx("p",{className:`text-center mb-6 ${i?"text-gray-400":"text-muted"}`,children:"Upload scans for all 10 fingerprints, one image per finger."}),r.jsxs("div",{className:"w-full grid grid-cols-2 md:grid-cols-5 gap-4",children:[f("Left"),f("Right")]})]})]})]})},Fc=({label:n,value:e})=>r.jsxs("div",{children:[r.jsx("dt",{className:"text-sm font-medium text-muted",children:n}),r.jsx("dd",{className:"mt-1 text-sm text-primary-text",children:e||"-"})]}),Mc=({label:n,value:e,status:t,isVerifying:s})=>r.jsxs("div",{children:[r.jsxs("dt",{className:"text-sm font-medium text-muted flex items-center",children:[n,s&&r.jsx(xt,{className:"h-4 w-4 text-muted animate-spin ml-2"}),!s&&t===!0&&r.jsx("span",{title:"Verified from document",className:"ml-2",children:r.jsx(Gi,{className:"h-4 w-4 text-green-500"})}),!s&&t===!1&&r.jsx("span",{title:"Verification Failed",className:"ml-2",children:r.jsx(Gm,{className:"h-4 w-4 text-red-500"})})]}),r.jsx("dd",{className:"mt-1 text-sm text-primary-text",children:e||"-"})]}),ta=({label:n,value:e})=>r.jsxs("div",{className:"flex justify-between items-start py-2",children:[r.jsx("span",{className:"text-sm text-gray-400",children:n}),r.jsx("span",{className:"text-sm text-white font-medium text-right max-w-[60%]",children:e||"-"})]}),The=()=>{const{onSubmit:n,isSubmitting:e}=ki(),{user:t}=bt(),{data:s,logVerificationUsage:i,setPersonalVerifiedStatus:a,setBankVerifiedStatus:o,setUanVerifiedStatus:l}=Qn(),{perfiosApi:c}=wi(),d=vt(),[h,m]=k.useState(window.innerWidth<768);k.useEffect(()=>{const W=()=>m(window.innerWidth<768);return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]);const f=t?.role==="field_officer"&&h,[p,b]=k.useState("idle"),[x,v]=k.useState(""),S=k.useMemo(()=>Object.entries(s.biometrics.fingerprints).filter(([,W])=>W!==null).map(([W])=>W.replace(/([A-Z])/g," $1").replace(/^./,_=>_.toUpperCase())),[s.biometrics.fingerprints]),B=async()=>{b("verifying"),v("");let W=!0;const _=[];try{i("Bank AC Verification Advanced");const Y=await ce.verifyBankAccountWithPerfios({name:s.bank.accountHolderName,dob:s.personal.dob,aadhaar:s.personal.idProofNumber||null,pan:null,bank:{accountNumber:s.bank.accountNumber,ifsc:s.bank.ifscCode},uan:s.uan.uanNumber||null,esi:s.esi.esiNumber||null});if(_.push(`Bank: ${Y.message}`),o({accountNumber:Y.verifiedFields.accountNumber,accountHolderName:Y.verifiedFields.accountHolderName}),Y.success||(W=!1),s.personal.idProofType==="Aadhaar"&&s.personal.idProofNumber){i("Aadhaar Verification");const j=await ce.verifyAadhaar(s.personal.idProofNumber);_.push(`Aadhaar: ${j.message}`),a({idProofNumber:j.success}),j.success||(W=!1)}if(s.uan.hasPreviousPf&&s.uan.uanNumber){i("EPF UAN Lookup");const j=await ce.lookupUan(s.uan.uanNumber);_.push(`UAN: ${j.message}`),l({uanNumber:j.verifiedFields.uan}),j.success||(W=!1)}await ce.updateOnboarding(Qn.getState().data),v(_.join(`
`)),b(W?"success":"failed")}catch(Y){b("failed"),v(Y.message||"An unexpected error occurred during verification.")}},V=()=>{d(`/onboarding/pdf/${s.id||"draft"}`)},R=(p==="success"||!c.enabled)&&s.formsGenerated;return f?r.jsxs("form",{onSubmit:async W=>{W.preventDefault(),await n()},id:"review-form",children:[r.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"Please review all your details carefully before submitting."}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("section",{children:[r.jsx("h4",{className:"fo-section-title mb-2",children:"Personal Details"}),r.jsxs("div",{className:"divide-y divide-border",children:[r.jsx(ta,{label:"Full Name",value:`${s.personal.firstName} ${s.personal.lastName}`}),r.jsx(ta,{label:"Email",value:s.personal.email}),r.jsx(ta,{label:"Mobile",value:s.personal.mobile}),r.jsx(ta,{label:"Date of Birth",value:s.personal.dob})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"fo-section-title mb-2",children:"Organization Details"}),r.jsxs("div",{className:"divide-y divide-border",children:[r.jsx(ta,{label:"Site",value:s.organization.organizationName}),r.jsx(ta,{label:"Designation",value:s.organization.designation}),r.jsx(ta,{label:"Department",value:s.organization.department})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"fo-section-title mb-2",children:"Bank Details"}),r.jsxs("div",{className:"divide-y divide-border",children:[r.jsx(ta,{label:"Account Holder",value:s.bank.accountHolderName}),r.jsx(ta,{label:"Account Number",value:"*".repeat(Math.max(0,s.bank.accountNumber.length-4))+s.bank.accountNumber.slice(-4)}),r.jsx(ta,{label:"IFSC Code",value:s.bank.ifscCode})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"fo-section-title mb-2",children:"Uniform Details"}),r.jsxs("div",{className:"divide-y divide-border",children:[r.jsx(ta,{label:"Uniform Required",value:s.uniforms.length>0?"Yes":"No"}),s.uniforms.map(W=>r.jsx(ta,{label:W.itemName,value:`${W.quantity} x Size ${W.sizeLabel} (${W.fit})`},W.itemId))]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"fo-section-title mb-2",children:"Biometrics"}),s.biometrics.signatureImage&&r.jsxs("div",{className:"mb-4",children:[r.jsx("h5",{className:"fo-section-title mb-2 text-base",children:"Signature"}),r.jsx("img",{src:s.biometrics.signatureImage.preview,alt:"Signature",className:"h-24 bg-white border rounded-md mx-auto"})]}),S.length>0&&r.jsxs("div",{children:[r.jsx("h5",{className:"fo-section-title mb-2 text-base",children:"Fingerprints"}),r.jsx("ul",{className:"text-sm text-center text-gray-400 list-disc list-inside",children:S.map(W=>r.jsx("li",{children:W},W))})]})]})]})]}):r.jsxs("form",{onSubmit:async W=>{W.preventDefault(),await n()},id:"review-form",children:[r.jsx(Xs,{title:"Review & Submit",subtitle:"Please review all your details carefully before submitting."}),r.jsxs("div",{className:"space-y-8",children:[r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Personal Details"}),r.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[r.jsx(Mc,{label:"Full Name",value:`${s.personal.firstName} ${s.personal.lastName}`,status:s.personal.verifiedStatus?.name,isVerifying:!1}),r.jsx(Fc,{label:"Email",value:s.personal.email}),r.jsx(Fc,{label:"Mobile",value:s.personal.mobile}),r.jsx(Mc,{label:"Date of Birth",value:s.personal.dob,status:s.personal.verifiedStatus?.dob,isVerifying:!1}),r.jsx(Fc,{label:"Gender",value:s.personal.gender}),r.jsx(Mc,{label:"Aadhaar Number",value:s.personal.idProofNumber,status:s.personal.verifiedStatus?.idProofNumber,isVerifying:p==="verifying"})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Organization Details"}),r.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[r.jsx(Fc,{label:"Site / Client",value:s.organization.organizationName}),r.jsx(Fc,{label:"Designation",value:s.organization.designation}),r.jsx(Fc,{label:"Department",value:s.organization.department}),r.jsx(Fc,{label:"Joining Date",value:s.organization.joiningDate})]})]}),r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Bank & Statutory Details"}),r.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-6",children:[r.jsx(Mc,{label:"Account Holder",value:s.bank.accountHolderName,status:s.bank.verifiedStatus?.accountHolderName,isVerifying:p==="verifying"}),r.jsx(Mc,{label:"Account Number",value:"*".repeat(Math.max(0,s.bank.accountNumber.length-4))+s.bank.accountNumber.slice(-4),status:s.bank.verifiedStatus?.accountNumber,isVerifying:p==="verifying"}),r.jsx(Mc,{label:"IFSC Code",value:s.bank.ifscCode,status:s.bank.verifiedStatus?.ifscCode,isVerifying:p==="verifying"}),r.jsx(Fc,{label:"Bank Name",value:s.bank.bankName}),s.uan.hasPreviousPf&&r.jsx(Mc,{label:"UAN",value:s.uan.uanNumber,status:s.uan.verifiedStatus?.uanNumber,isVerifying:p==="verifying"}),s.esi.hasEsi&&r.jsx(Mc,{label:"ESI Number",value:s.esi.esiNumber,status:s.esi.verifiedStatus?.esiNumber,isVerifying:p==="verifying"})]})]}),s.uniforms.length>0&&r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Uniform Details"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:s.uniforms.map(W=>r.jsxs("div",{className:"bg-page p-3 rounded-md",children:[r.jsx("p",{className:"font-semibold text-sm",children:W.itemName}),r.jsxs("p",{className:"text-xs text-muted",children:["Size: ",W.sizeLabel," (",W.fit,")"]}),r.jsxs("p",{className:"text-xs text-muted",children:["Qty: ",W.quantity]})]},W.itemId))})]}),s.biometrics.signatureImage&&r.jsxs("section",{children:[r.jsx("h4",{className:"text-md font-semibold text-primary-text mb-4 border-b pb-2",children:"Biometrics"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsxs("div",{children:[r.jsx("h5",{className:"font-semibold text-primary-text",children:"Signature"}),r.jsx("div",{className:"mt-2 p-2 border rounded-lg inline-block bg-page",children:r.jsx("img",{src:s.biometrics.signatureImage.preview,alt:"Signature",className:"h-24"})})]}),S.length>0&&r.jsxs("div",{children:[r.jsx("h5",{className:"font-semibold text-primary-text",children:"Fingerprints Uploaded"}),r.jsx("ul",{className:"mt-2 list-disc list-inside text-sm text-muted columns-2",children:S.map(W=>r.jsx("li",{children:W},W))})]})]})]})]}),c.enabled&&r.jsxs("div",{className:"mt-8 pt-6 border-t",children:[r.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-4",children:"Third-Party Verification"}),r.jsxs("div",{className:"p-4 bg-page rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium",children:"Run a background check against official records."}),r.jsx("p",{className:"text-sm text-muted",children:"This step is required before you can submit the application."}),p==="failed"&&r.jsx("p",{className:"text-sm text-red-600 mt-2",children:x}),p==="success"&&r.jsx("p",{className:"text-sm text-green-600 mt-2",children:x})]}),r.jsxs(se,{onClick:B,isLoading:p==="verifying",disabled:p==="success",children:[p==="idle"&&r.jsxs(r.Fragment,{children:[r.jsx(Nm,{className:"mr-2 h-4 w-4"})," Verify Details"]}),p==="verifying"&&"Verifying...",p==="failed"&&"Retry Verification",p==="success"&&r.jsxs(r.Fragment,{children:[r.jsx(Gi,{className:"mr-2 h-4 w-4"})," Verified"]})]})]})]}),r.jsxs("div",{className:"mt-8 pt-6 border-t",children:[r.jsx("h3",{className:"text-lg font-semibold text-primary-text mb-4",children:"Generate Official Forms"}),r.jsxs("div",{className:"p-4 bg-page rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium",children:"Generate and review the official PDF documents."}),r.jsx("p",{className:"text-sm text-muted",children:"This step is mandatory before final submission."})]}),s.formsGenerated?r.jsxs("div",{className:"flex items-center gap-2 font-semibold text-green-600",children:[r.jsx(Gi,{className:"h-5 w-5"}),r.jsx("span",{children:"Forms Generated & Confirmed"})]}):r.jsxs(se,{onClick:V,children:[r.jsx(Cr,{className:"mr-2 h-4 w-4"})," Generate & Review Forms"]})]})]}),r.jsx("div",{className:"mt-8 pt-6 border-t",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex items-center h-5",children:r.jsx("input",{id:"confirmation",name:"confirmation",type:"checkbox",required:!0,className:"focus:ring-accent h-4 w-4 text-accent border-gray-300 rounded",disabled:!R})}),r.jsxs("div",{className:"ml-3 text-sm",children:[r.jsx("label",{htmlFor:"confirmation",className:`font-medium ${R?"text-gray-700":"text-gray-400"}`,children:"Declaration"}),r.jsx("p",{className:`${R?"text-muted":"text-gray-400"}`,children:"I hereby declare that the information provided is true and correct to the best of my knowledge."})]})]})})]})},Dn=({requiredPermission:n,children:e})=>{const{user:t,isInitialized:s}=bt(),{permissions:i}=ha();return s?t?(i[t.role]||[]).includes(n)?e?r.jsx(r.Fragment,{children:e}):r.jsx(Nu,{}):r.jsx(Bl,{to:"/forbidden",replace:!0}):r.jsx(Bl,{to:"/auth/login",replace:!0}):null},Ehe=({onIdle:n,idleTimeout:e,promptTimeout:t,disabled:s=!1})=>{const[i,a]=k.useState(!1),[o,l]=k.useState(t),c=k.useRef(null),d=k.useRef(null),h=k.useRef(null),m=["mousemove","keydown","mousedown","scroll","touchstart"],f=k.useCallback(()=>{s||(a(!1),l(t),c.current&&clearTimeout(c.current),d.current&&clearTimeout(d.current),h.current&&clearInterval(h.current),c.current=window.setTimeout(()=>{a(!0)},e))},[e,t,s]);return k.useEffect(()=>{if(!s)return i&&(d.current=window.setTimeout(n,t),h.current=window.setInterval(()=>{l(p=>Math.max(0,p-1e3))},1e3)),()=>{d.current&&clearTimeout(d.current),h.current&&clearInterval(h.current)}},[i,n,t,s]),k.useEffect(()=>{if(s)return;const p=()=>f();return m.forEach(b=>{window.addEventListener(b,p)}),f(),()=>{m.forEach(b=>{window.removeEventListener(b,p)}),c.current&&clearTimeout(c.current),d.current&&clearTimeout(d.current),h.current&&clearInterval(h.current)}},[f,s]),{isIdle:i,countdown:o,reset:f}},Dhe=1800*1e3,Lhe=120*1e3,Phe=()=>{const{logout:n}=bt(),e=vt(),t=()=>{n(),e("/auth/login",{replace:!0})},s=jt("(max-width: 768px)"),{isIdle:i,countdown:a,reset:o}=Ehe({onIdle:t,idleTimeout:Dhe,promptTimeout:Lhe,disabled:s});return i?r.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm","aria-modal":"true",role:"dialog",children:r.jsxs("div",{className:"bg-card rounded-xl shadow-card p-6 w-full max-w-md m-4 text-center animate-fade-in-scale",children:[r.jsx(AH,{className:"h-16 w-16 text-yellow-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-bold text-primary-text",children:"Are you still there?"}),r.jsx("p",{className:"mt-2 text-muted",children:"For your security, you will be logged out due to inactivity."}),r.jsx("div",{className:"my-6 text-4xl font-bold text-accent",children:Math.ceil(a/1e3)}),r.jsx("p",{className:"text-sm text-muted mb-6",children:"Click the button below to stay logged in."}),r.jsx("div",{className:"flex justify-center gap-4",children:r.jsx(se,{onClick:o,variant:"primary",size:"lg",children:"Stay Logged In"})})]})}):null},Khe=()=>{const{pathname:n}=er();return k.useEffect(()=>{window.scrollTo(0,0);const e=document.querySelector("main");e&&e.scrollTo(0,0);const t=document.getElementById("root");t&&t.scrollTo(0,0)},[n]),null},Ohe=()=>{const[n,e]=k.useState([]),[t,s]=k.useState(!1),[i,a]=k.useState(He(new Date,"yyyy-MM-dd")),[o,l]=k.useState([]),[c,d]=k.useState("");k.useEffect(()=>{h()},[]),k.useEffect(()=>{m()},[i,c]);const h=async()=>{try{const b=await ce.getOrganizations();l(b)}catch(b){console.error(b)}},m=async()=>{s(!0);try{const b=await ce.getPatrolLogs(i,c||void 0);e(b)}catch(b){console.error(b)}finally{s(!1)}},f=n.filter(b=>b.status==="Completed").length,p=n.filter(b=>b.status==="Exception"||b.status==="Failed").length;return r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Security Patrol Dashboard"}),r.jsxs(aa,{to:"/admin/patrol/qr-codes",className:"bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2 hover:bg-blue-700",children:[r.jsx(Bi,{size:18})," Manage QR Codes"]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-4",children:[r.jsx("div",{className:"p-3 bg-green-100 text-green-700 rounded-full",children:r.jsx(Gi,{size:24})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500",children:"Patrols Completed"}),r.jsx("p",{className:"text-2xl font-bold",children:f})]})]}),r.jsxs("div",{className:"bg-white p-4 rounded shadow flex items-center gap-4",children:[r.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded-full",children:r.jsx(gG,{size:24})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-500",children:"Exceptions / Issues"}),r.jsx("p",{className:"text-2xl font-bold",children:p})]})]}),r.jsxs("div",{className:"col-span-2 bg-white p-4 rounded shadow flex items-center gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"DATE"}),r.jsx("input",{type:"date",className:"w-full border p-2 rounded",value:i,onChange:b=>a(b.target.value)})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"SITE"}),r.jsxs("select",{className:"w-full border p-2 rounded",value:c,onChange:b=>d(b.target.value),children:[r.jsx("option",{value:"",children:"All Sites"}),o.map(b=>r.jsx("option",{value:b.id,children:b.fullName},b.id))]})]}),r.jsx("button",{onClick:m,className:"mt-5 p-2 text-gray-500 hover:text-blue-600",children:r.jsx(Du,{size:20,className:t?"animate-spin":""})})]})]}),r.jsx("div",{className:"bg-white rounded shadow overflow-hidden",children:r.jsxs("table",{className:"w-full text-left",children:[r.jsx("thead",{className:"bg-gray-50 border-b",children:r.jsxs("tr",{children:[r.jsx("th",{className:"p-4 font-semibold text-gray-600",children:"Time"}),r.jsx("th",{className:"p-4 font-semibold text-gray-600",children:"Guard"}),r.jsx("th",{className:"p-4 font-semibold text-gray-600",children:"Location/QR"}),r.jsx("th",{className:"p-4 font-semibold text-gray-600",children:"Status"}),r.jsx("th",{className:"p-4 font-semibold text-gray-600",children:"Proof"})]})}),r.jsx("tbody",{children:n.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"p-8 text-center text-gray-500",children:"No patrol logs found for this date."})}):n.map(b=>r.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[r.jsx("td",{className:"p-4",children:He(new Date(b.scanTime),"HH:mm:ss")}),r.jsx("td",{className:"p-4",children:r.jsxs("span",{className:"font-mono text-xs bg-gray-100 p-1 rounded",title:b.userId,children:[b.userId.substring(0,8),"..."]})}),r.jsxs("td",{className:"p-4",children:["Lat: ",b.latitude.toFixed(4),", Lng: ",b.longitude.toFixed(4)]}),r.jsxs("td",{className:"p-4",children:[r.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${b.status==="Completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:b.status}),b.reason&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:b.reason})]}),r.jsx("td",{className:"p-4",children:b.photoUrl?r.jsxs("a",{href:b.photoUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 text-xs flex items-center gap-1 hover:underline",children:["View Photo ",r.jsx(Q6,{size:10})]}):r.jsx("span",{className:"text-gray-400 text-xs",children:"-"})})]},b.id))})]})})]})};function JZ(){return JZ=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},JZ.apply(null,arguments)}function Mm(n){"@babel/helpers - typeof";return Mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mm(n)}function zhe(n,e){if(Mm(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(Mm(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Uhe(n){var e=zhe(n,"string");return Mm(e)=="symbol"?e:e+""}function Qhe(n,e,t){return(e=Uhe(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function qhe(n){if(Array.isArray(n))return n}function $he(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,i,a,o,l=[],c=!0,d=!1;try{if(a=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(s=a.call(t)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw i}}return l}}function PY(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=Array(e);t<e;t++)s[t]=n[t];return s}function eme(n,e){if(n){if(typeof n=="string")return PY(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?PY(n,e):void 0}}function tme(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nme(n,e){return qhe(n)||$he(n,e)||eme(n,e)||tme()}function sme(n,e){if(n==null)return{};var t={};for(var s in n)if({}.hasOwnProperty.call(n,s)){if(e.indexOf(s)!==-1)continue;t[s]=n[s]}return t}function rme(n,e){if(n==null)return{};var t,s,i=sme(n,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(s=0;s<a.length;s++)t=a[s],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var aD={exports:{}},_n={};var Ts=typeof Symbol=="function"&&Symbol.for,dB=Ts?Symbol.for("react.element"):60103,gB=Ts?Symbol.for("react.portal"):60106,eA=Ts?Symbol.for("react.fragment"):60107,tA=Ts?Symbol.for("react.strict_mode"):60108,nA=Ts?Symbol.for("react.profiler"):60114,sA=Ts?Symbol.for("react.provider"):60109,rA=Ts?Symbol.for("react.context"):60110,uB=Ts?Symbol.for("react.async_mode"):60111,iA=Ts?Symbol.for("react.concurrent_mode"):60111,aA=Ts?Symbol.for("react.forward_ref"):60112,oA=Ts?Symbol.for("react.suspense"):60113,ime=Ts?Symbol.for("react.suspense_list"):60120,lA=Ts?Symbol.for("react.memo"):60115,cA=Ts?Symbol.for("react.lazy"):60116,ame=Ts?Symbol.for("react.block"):60121,ome=Ts?Symbol.for("react.fundamental"):60117,lme=Ts?Symbol.for("react.responder"):60118,cme=Ts?Symbol.for("react.scope"):60119;function Wi(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case dB:switch(n=n.type,n){case uB:case iA:case eA:case nA:case tA:case oA:return n;default:switch(n=n&&n.$$typeof,n){case rA:case aA:case cA:case lA:case sA:return n;default:return e}}case gB:return e}}}function oD(n){return Wi(n)===iA}_n.AsyncMode=uB;_n.ConcurrentMode=iA;_n.ContextConsumer=rA;_n.ContextProvider=sA;_n.Element=dB;_n.ForwardRef=aA;_n.Fragment=eA;_n.Lazy=cA;_n.Memo=lA;_n.Portal=gB;_n.Profiler=nA;_n.StrictMode=tA;_n.Suspense=oA;_n.isAsyncMode=function(n){return oD(n)||Wi(n)===uB};_n.isConcurrentMode=oD;_n.isContextConsumer=function(n){return Wi(n)===rA};_n.isContextProvider=function(n){return Wi(n)===sA};_n.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===dB};_n.isForwardRef=function(n){return Wi(n)===aA};_n.isFragment=function(n){return Wi(n)===eA};_n.isLazy=function(n){return Wi(n)===cA};_n.isMemo=function(n){return Wi(n)===lA};_n.isPortal=function(n){return Wi(n)===gB};_n.isProfiler=function(n){return Wi(n)===nA};_n.isStrictMode=function(n){return Wi(n)===tA};_n.isSuspense=function(n){return Wi(n)===oA};_n.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===eA||n===iA||n===nA||n===tA||n===oA||n===ime||typeof n=="object"&&n!==null&&(n.$$typeof===cA||n.$$typeof===lA||n.$$typeof===sA||n.$$typeof===rA||n.$$typeof===aA||n.$$typeof===ome||n.$$typeof===lme||n.$$typeof===cme||n.$$typeof===ame)};_n.typeOf=Wi;var KY=Object.getOwnPropertySymbols,dme=Object.prototype.hasOwnProperty,gme=Object.prototype.propertyIsEnumerable;function ume(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function hme(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var s=Object.getOwnPropertyNames(e).map(function(a){return e[a]});if(s.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(a){i[a]=a}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}hme();var mme="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ime=mme;Function.call.bind(Object.prototype.hasOwnProperty);var Cme=Ime;function lD(){}function cD(){}cD.resetWarningCache=lD;var fme=function(){function n(s,i,a,o,l,c){if(c!==Cme){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:cD,resetWarningCache:lD};return t.PropTypes=t,t};aD.exports=fme();var gu=aD.exports;function pme(n,e){var t=atob(n);return t}function Ame(n,e,t){var s=pme(n),i=s.indexOf(`
`,10)+1,a=s.substring(i)+"",o=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(o)}function bme(n,e,t){var s;return function(a){return s=s||Ame(n),new Worker(s,a)}}var yme=bme("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg=="),vme=["constraints","onError","onLoad","onScan","resolution","qrArea"];function OY(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function zY(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?OY(Object(t),!0).forEach(function(s){Qhe(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):OY(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}var xme=function(){return new yme},UY=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().forEach(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().forEach(function(t){e.removeTrack(t),t.stop()})):e.stop())},hB=function(e){var t=e.constraints,s=e.onError,i=e.onLoad,a=e.onScan,o=e.resolution,l=e.qrArea,c=rme(e,vme),d=k.useRef(null),h=k.useRef(null),m=k.useRef(document.createElement("canvas")),f=k.useRef(null),p=k.useRef(),b=k.useState(null),x=nme(b,2),v=x[0],S=x[1],B=k.useRef(!1),V=k.useRef();k.useEffect(function(){V.current=xme();var Y=V.current;return Y.onmessage=function(j){a&&a(j.data?zY(zY({},j.data),{},{canvas:m.current}):null),B.current=!1},function(){Y.terminate()}},[a]);var R=JSON.stringify(l),W=k.useCallback(function(){var Y=JSON.parse(R),j=V.current,M=h.current&&h.current.readyState===h.current.HAVE_ENOUGH_DATA;if(!B.current&&M){B.current=!0;var H=h.current.videoWidth,D=h.current.videoHeight,z=H>D?H:D,O=Math.floor(o/z*100)/100;D=Math.floor(O*D),H=Math.floor(O*H),m.current.width=H,m.current.height=D,f.current=m.current.getContext("2d"),f.current.drawImage(h.current,0,0,H,D);var E;Y&&Y.length===2&&Y[0]>0&&Y[1]>0?E=f.current.getImageData(Math.floor((H-Y[0])/2),Math.floor((D-Y[1])/2),Y[0],Y[1]):E=f.current.getImageData(0,0,H,D),j.postMessage(E)}p.current=requestAnimationFrame(W)},[o,R]),_=JSON.stringify(t);return k.useEffect(function(){var Y=JSON.parse(_),j=!0;return navigator.mediaDevices.getUserMedia(Y).then(function(M){if(!j)UY(M);else{d.current=M;try{h.current&&(h.current.srcObject=M,h.current.setAttribute("playsinline",!0))}catch{S(window.URL.createObjectURL(M))}i&&i(),p.current=requestAnimationFrame(W)}}).catch(function(M){return j?s(M):null}),function(){cancelAnimationFrame(p.current),j=!1,UY(d.current),v&&window.URL.revokeObjectURL(v)}},[W,_,s,i,v]),k.createElement("video",JZ({autoPlay:!0,playsInline:!0,src:v,ref:h},c))};hB.propTypes={constraints:gu.object,onError:gu.func.isRequired,onLoad:gu.func,onScan:gu.func.isRequired,resolution:gu.number,qrArea:gu.array};hB.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]};const Sme=(n,e,t,s)=>{const a=n*Math.PI/180,o=t*Math.PI/180,l=(t-n)*Math.PI/180,c=(s-e)*Math.PI/180,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},wme=()=>{const{user:n}=bt(),e=vt(),[t,s]=k.useState(!0),[i,a]=k.useState(null),[o,l]=k.useState(null),[c,d]=k.useState(!1),[h,m]=k.useState(null),[f,p]=k.useState(!1),[b,x]=k.useState(null),[v,S]=k.useState(""),[B,V]=k.useState(null),[R,W]=k.useState(0),[_,Y]=k.useState([]);k.useEffect(()=>{j()},[]);const j=async()=>{try{const te=await bG.getCurrentPosition();l({lat:te.coords.latitude,lng:te.coords.longitude})}catch(te){console.error("Error getting location",te),m("Could not fetch location. Please enable GPS.")}},M=te=>{console.error(te),m("Camera error. Please ensure permission is granted.")},H=async te=>{if(te&&t){s(!1);try{let q="";try{q=JSON.parse(te.text).id}catch{q=te.text}d(!0);const U=(await ce.getPatrolQrCodes()).find(P=>P.id===q);if(!U)throw new Error("Invalid or inactive QR code.");if(V(U),W(0),Y([]),o||await j(),o){const P=Sme(o.lat,o.lng,U.latitude,U.longitude);if(P>(U.radiusMeters||50))throw new Error(`Location mismatch. You are ${Math.round(P)}m away. Allowed: ${U.radiusMeters}m.`)}else throw new Error("GPS Location required.");a(U)}catch(q){m(q.message||"Verification failed"),s(!0)}finally{d(!1)}}},D=async te=>{const q=B?.questions?.[R]||B?.question;if(te){const de=[..._,{question:q,answer:"YES"}];Y(de),O(de)}else p(!0)},z=async(te,q)=>{if(!v.trim()){alert("Please provide a reason.");return}const de=B?.questions?.[R]||B?.question,U=`data:${q};base64,${te}`,P={question:de,answer:"NO",photo:U,reason:v},ne=[..._,P];Y(ne),p(!1),S(""),O(ne)},O=async te=>{const q=B?.questions||[B?.question];R<q.length-1?W(R+1):await E(te)},E=async te=>{if(!B||!n||!o)return;const q=te.some(P=>P.answer==="NO"),de=q?"Exception":"Completed",U=q?5:10;try{d(!0),await ce.submitPatrolLog({qrId:B.id,userId:n.id,scanTime:new Date().toISOString(),latitude:o.lat,longitude:o.lng,isWithinRadius:!0,answers:te,status:de,scoreAwarded:U}),alert("Patrol submitted successfully!"),e("/mobile-home")}catch(P){m(P.message)}finally{d(!1)}};if(!t&&i&&!f){const te=i.questions||[i.question],q=te[R],de=R===te.length-1;return r.jsxs("div",{className:"fixed inset-0 bg-white z-50 flex flex-col p-6",children:[r.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Checkpoint Verification (",R+1,"/",te.length,")"]}),r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[r.jsx("p",{className:"font-semibold",children:i.name}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:q})]}),r.jsxs("div",{className:"flex gap-4 mt-auto mb-10",children:[r.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-4 bg-red-100 text-red-700 rounded-xl font-bold border border-red-200",children:"NO / ISSUE"}),r.jsx("button",{onClick:()=>D(!0),className:"flex-1 py-4 bg-green-600 text-white rounded-xl font-bold shadow-lg",children:de?"YES / FINISH":"YES / NEXT"})]})]})}return r.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 text-white",children:[r.jsx("button",{onClick:()=>e(-1),children:r.jsx(Ri,{})}),r.jsx("span",{className:"font-bold",children:"Scan Patrol QR"}),r.jsx("div",{className:"w-6"})]}),r.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[h?r.jsxs("div",{className:"bg-white p-6 rounded-lg text-center mx-4",children:[r.jsx(ca,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),r.jsx("p",{className:"text-red-700 font-medium mb-4",children:h}),r.jsx("button",{onClick:()=>{m(null),s(!0)},className:"px-4 py-2 bg-gray-200 rounded-full",children:"Try Again"})]}):r.jsx(hB,{delay:300,onError:M,onScan:H,style:{width:"100%",height:"100%"},constraints:{video:{facingMode:"environment"}}}),c&&r.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:r.jsx("div",{className:"text-white font-bold",children:"Verifying..."})})]}),r.jsxs("div",{className:"p-4 bg-gray-900 text-white text-center",children:[r.jsx("p",{className:"text-sm opacity-80",children:"Align QR code within the frame"}),o&&r.jsxs("p",{className:"text-xs text-green-400 mt-1 flex items-center justify-center gap-1",children:[r.jsx(yH,{size:12})," GPS Active"]})]}),f&&r.jsx(BG,{isOpen:f,onClose:()=>p(!1),onCapture:z}),f&&r.jsxs("div",{className:"absolute bottom-20 left-4 right-4 bg-white p-4 rounded-lg shadow-xl",style:{zIndex:60},children:[r.jsx("p",{className:"mb-2 font-bold text-gray-800",children:"Reason for issue:"}),r.jsx("textarea",{className:"w-full border rounded p-2",placeholder:"Describe the issue...",value:v,onChange:te=>S(te.target.value)}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Take photo to submit."})]})]})};var uu={},hw,QY;function dD(){return QY||(QY=1,hw={L:1,M:0,Q:3,H:2}),hw}var mw,qY;function gD(){return qY||(qY=1,mw={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),mw}var Iw,$Y;function Zme(){if($Y)return Iw;$Y=1;var n=gD();function e(t){this.mode=n.MODE_8BIT_BYTE,this.data=t}return e.prototype={getLength:function(t){return this.data.length},write:function(t){for(var s=0;s<this.data.length;s++)t.put(this.data.charCodeAt(s),8)}},Iw=e,Iw}var Cw,eF;function Gme(){if(eF)return Cw;eF=1;var n=dD();function e(t,s){this.totalCount=t,this.dataCount=s}return e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(t,s){var i=e.getRsBlockTable(t,s);if(i==null)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+s);for(var a=i.length/3,o=new Array,l=0;l<a;l++)for(var c=i[l*3+0],d=i[l*3+1],h=i[l*3+2],m=0;m<c;m++)o.push(new e(d,h));return o},e.getRsBlockTable=function(t,s){switch(s){case n.L:return e.RS_BLOCK_TABLE[(t-1)*4+0];case n.M:return e.RS_BLOCK_TABLE[(t-1)*4+1];case n.Q:return e.RS_BLOCK_TABLE[(t-1)*4+2];case n.H:return e.RS_BLOCK_TABLE[(t-1)*4+3];default:return}},Cw=e,Cw}var fw,tF;function Bme(){if(tF)return fw;tF=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(e){var t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(var s=0;s<t;s++)this.putBit((e>>>t-s-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},fw=n,fw}var pw,nF;function uD(){if(nF)return pw;nF=1;for(var n={glog:function(t){if(t<1)throw new Error("glog("+t+")");return n.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return n.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},e=0;e<8;e++)n.EXP_TABLE[e]=1<<e;for(var e=8;e<256;e++)n.EXP_TABLE[e]=n.EXP_TABLE[e-4]^n.EXP_TABLE[e-5]^n.EXP_TABLE[e-6]^n.EXP_TABLE[e-8];for(var e=0;e<255;e++)n.LOG_TABLE[n.EXP_TABLE[e]]=e;return pw=n,pw}var Aw,sF;function hD(){if(sF)return Aw;sF=1;var n=uD();function e(t,s){if(t.length==null)throw new Error(t.length+"/"+s);for(var i=0;i<t.length&&t[i]==0;)i++;this.num=new Array(t.length-i+s);for(var a=0;a<t.length-i;a++)this.num[a]=t[a+i]}return e.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var s=new Array(this.getLength()+t.getLength()-1),i=0;i<this.getLength();i++)for(var a=0;a<t.getLength();a++)s[i+a]^=n.gexp(n.glog(this.get(i))+n.glog(t.get(a)));return new e(s,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var s=n.glog(this.get(0))-n.glog(t.get(0)),i=new Array(this.getLength()),a=0;a<this.getLength();a++)i[a]=this.get(a);for(var a=0;a<t.getLength();a++)i[a]^=n.gexp(n.glog(t.get(a))+s);return new e(i,0).mod(t)}},Aw=e,Aw}var bw,rF;function Nme(){if(rF)return bw;rF=1;var n=gD(),e=hD(),t=uD(),s={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var o=a<<10;i.getBCHDigit(o)-i.getBCHDigit(i.G15)>=0;)o^=i.G15<<i.getBCHDigit(o)-i.getBCHDigit(i.G15);return(a<<10|o)^i.G15_MASK},getBCHTypeNumber:function(a){for(var o=a<<12;i.getBCHDigit(o)-i.getBCHDigit(i.G18)>=0;)o^=i.G18<<i.getBCHDigit(o)-i.getBCHDigit(i.G18);return a<<12|o},getBCHDigit:function(a){for(var o=0;a!=0;)o++,a>>>=1;return o},getPatternPosition:function(a){return i.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,o,l){switch(a){case s.PATTERN000:return(o+l)%2==0;case s.PATTERN001:return o%2==0;case s.PATTERN010:return l%3==0;case s.PATTERN011:return(o+l)%3==0;case s.PATTERN100:return(Math.floor(o/2)+Math.floor(l/3))%2==0;case s.PATTERN101:return o*l%2+o*l%3==0;case s.PATTERN110:return(o*l%2+o*l%3)%2==0;case s.PATTERN111:return(o*l%3+(o+l)%2)%2==0;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var o=new e([1],0),l=0;l<a;l++)o=o.multiply(new e([1,t.gexp(l)],0));return o},getLengthInBits:function(a,o){if(1<=o&&o<10)switch(a){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(o<27)switch(a){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else if(o<41)switch(a){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}else throw new Error("type:"+o)},getLostPoint:function(a){for(var o=a.getModuleCount(),l=0,c=0;c<o;c++)for(var d=0;d<o;d++){for(var h=0,m=a.isDark(c,d),f=-1;f<=1;f++)if(!(c+f<0||o<=c+f))for(var p=-1;p<=1;p++)d+p<0||o<=d+p||f==0&&p==0||m==a.isDark(c+f,d+p)&&h++;h>5&&(l+=3+h-5)}for(var c=0;c<o-1;c++)for(var d=0;d<o-1;d++){var b=0;a.isDark(c,d)&&b++,a.isDark(c+1,d)&&b++,a.isDark(c,d+1)&&b++,a.isDark(c+1,d+1)&&b++,(b==0||b==4)&&(l+=3)}for(var c=0;c<o;c++)for(var d=0;d<o-6;d++)a.isDark(c,d)&&!a.isDark(c,d+1)&&a.isDark(c,d+2)&&a.isDark(c,d+3)&&a.isDark(c,d+4)&&!a.isDark(c,d+5)&&a.isDark(c,d+6)&&(l+=40);for(var d=0;d<o;d++)for(var c=0;c<o-6;c++)a.isDark(c,d)&&!a.isDark(c+1,d)&&a.isDark(c+2,d)&&a.isDark(c+3,d)&&a.isDark(c+4,d)&&!a.isDark(c+5,d)&&a.isDark(c+6,d)&&(l+=40);for(var x=0,d=0;d<o;d++)for(var c=0;c<o;c++)a.isDark(c,d)&&x++;var v=Math.abs(100*x/o/o-50)/5;return l+=v*10,l}};return bw=i,bw}var yw,iF;function kme(){if(iF)return yw;iF=1;var n=Zme(),e=Gme(),t=Bme(),s=Nme(),i=hD();function a(l,c){this.typeNumber=l,this.errorCorrectLevel=c,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var o=a.prototype;return o.addData=function(l){var c=new n(l);this.dataList.push(c),this.dataCache=null},o.isDark=function(l,c){if(l<0||this.moduleCount<=l||c<0||this.moduleCount<=c)throw new Error(l+","+c);return this.modules[l][c]},o.getModuleCount=function(){return this.moduleCount},o.make=function(){if(this.typeNumber<1){var l=1;for(l=1;l<40;l++){for(var c=e.getRSBlocks(l,this.errorCorrectLevel),d=new t,h=0,m=0;m<c.length;m++)h+=c[m].dataCount;for(var m=0;m<this.dataList.length;m++){var f=this.dataList[m];d.put(f.mode,4),d.put(f.getLength(),s.getLengthInBits(f.mode,l)),f.write(d)}if(d.getLengthInBits()<=h*8)break}this.typeNumber=l}this.makeImpl(!1,this.getBestMaskPattern())},o.makeImpl=function(l,c){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var h=0;h<this.moduleCount;h++)this.modules[d][h]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(l,c),this.typeNumber>=7&&this.setupTypeNumber(l),this.dataCache==null&&(this.dataCache=a.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},o.setupPositionProbePattern=function(l,c){for(var d=-1;d<=7;d++)if(!(l+d<=-1||this.moduleCount<=l+d))for(var h=-1;h<=7;h++)c+h<=-1||this.moduleCount<=c+h||(0<=d&&d<=6&&(h==0||h==6)||0<=h&&h<=6&&(d==0||d==6)||2<=d&&d<=4&&2<=h&&h<=4?this.modules[l+d][c+h]=!0:this.modules[l+d][c+h]=!1)},o.getBestMaskPattern=function(){for(var l=0,c=0,d=0;d<8;d++){this.makeImpl(!0,d);var h=s.getLostPoint(this);(d==0||l>h)&&(l=h,c=d)}return c},o.createMovieClip=function(l,c,d){var h=l.createEmptyMovieClip(c,d),m=1;this.make();for(var f=0;f<this.modules.length;f++)for(var p=f*m,b=0;b<this.modules[f].length;b++){var x=b*m,v=this.modules[f][b];v&&(h.beginFill(0,100),h.moveTo(x,p),h.lineTo(x+m,p),h.lineTo(x+m,p+m),h.lineTo(x,p+m),h.endFill())}return h},o.setupTimingPattern=function(){for(var l=8;l<this.moduleCount-8;l++)this.modules[l][6]==null&&(this.modules[l][6]=l%2==0);for(var c=8;c<this.moduleCount-8;c++)this.modules[6][c]==null&&(this.modules[6][c]=c%2==0)},o.setupPositionAdjustPattern=function(){for(var l=s.getPatternPosition(this.typeNumber),c=0;c<l.length;c++)for(var d=0;d<l.length;d++){var h=l[c],m=l[d];if(this.modules[h][m]==null)for(var f=-2;f<=2;f++)for(var p=-2;p<=2;p++)f==-2||f==2||p==-2||p==2||f==0&&p==0?this.modules[h+f][m+p]=!0:this.modules[h+f][m+p]=!1}},o.setupTypeNumber=function(l){for(var c=s.getBCHTypeNumber(this.typeNumber),d=0;d<18;d++){var h=!l&&(c>>d&1)==1;this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=h}for(var d=0;d<18;d++){var h=!l&&(c>>d&1)==1;this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=h}},o.setupTypeInfo=function(l,c){for(var d=this.errorCorrectLevel<<3|c,h=s.getBCHTypeInfo(d),m=0;m<15;m++){var f=!l&&(h>>m&1)==1;m<6?this.modules[m][8]=f:m<8?this.modules[m+1][8]=f:this.modules[this.moduleCount-15+m][8]=f}for(var m=0;m<15;m++){var f=!l&&(h>>m&1)==1;m<8?this.modules[8][this.moduleCount-m-1]=f:m<9?this.modules[8][15-m-1+1]=f:this.modules[8][15-m-1]=f}this.modules[this.moduleCount-8][8]=!l},o.mapData=function(l,c){for(var d=-1,h=this.moduleCount-1,m=7,f=0,p=this.moduleCount-1;p>0;p-=2)for(p==6&&p--;;){for(var b=0;b<2;b++)if(this.modules[h][p-b]==null){var x=!1;f<l.length&&(x=(l[f]>>>m&1)==1);var v=s.getMask(c,h,p-b);v&&(x=!x),this.modules[h][p-b]=x,m--,m==-1&&(f++,m=7)}if(h+=d,h<0||this.moduleCount<=h){h-=d,d=-d;break}}},a.PAD0=236,a.PAD1=17,a.createData=function(l,c,d){for(var h=e.getRSBlocks(l,c),m=new t,f=0;f<d.length;f++){var p=d[f];m.put(p.mode,4),m.put(p.getLength(),s.getLengthInBits(p.mode,l)),p.write(m)}for(var b=0,f=0;f<h.length;f++)b+=h[f].dataCount;if(m.getLengthInBits()>b*8)throw new Error("code length overflow. ("+m.getLengthInBits()+">"+b*8+")");for(m.getLengthInBits()+4<=b*8&&m.put(0,4);m.getLengthInBits()%8!=0;)m.putBit(!1);for(;!(m.getLengthInBits()>=b*8||(m.put(a.PAD0,8),m.getLengthInBits()>=b*8));)m.put(a.PAD1,8);return a.createBytes(m,h)},a.createBytes=function(l,c){for(var d=0,h=0,m=0,f=new Array(c.length),p=new Array(c.length),b=0;b<c.length;b++){var x=c[b].dataCount,v=c[b].totalCount-x;h=Math.max(h,x),m=Math.max(m,v),f[b]=new Array(x);for(var S=0;S<f[b].length;S++)f[b][S]=255&l.buffer[S+d];d+=x;var B=s.getErrorCorrectPolynomial(v),V=new i(f[b],B.getLength()-1),R=V.mod(B);p[b]=new Array(B.getLength()-1);for(var S=0;S<p[b].length;S++){var W=S+R.getLength()-p[b].length;p[b][S]=W>=0?R.get(W):0}}for(var _=0,S=0;S<c.length;S++)_+=c[S].totalCount;for(var Y=new Array(_),j=0,S=0;S<h;S++)for(var b=0;b<c.length;b++)S<f[b].length&&(Y[j++]=f[b][S]);for(var S=0;S<m;S++)for(var b=0;b<c.length;b++)S<p[b].length&&(Y[j++]=p[b][S]);return Y},yw=a,yw}var pf={},aF;function Rme(){if(aF)return pf;aF=1,Object.defineProperty(pf,"__esModule",{value:!0});var n=Object.assign||function(d){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(d[f]=m[f])}return d},e=La(),t=a(e),s=Ar(),i=a(s);function a(d){return d&&d.__esModule?d:{default:d}}function o(d,h){var m={};for(var f in d)h.indexOf(f)>=0||Object.prototype.hasOwnProperty.call(d,f)&&(m[f]=d[f]);return m}var l={bgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,bgD:t.default.string.isRequired,fgColor:t.default.oneOfType([t.default.object,t.default.string]).isRequired,fgD:t.default.string.isRequired,size:t.default.number.isRequired,title:t.default.string,viewBoxSize:t.default.number.isRequired,xmlns:t.default.string},c=(0,s.forwardRef)(function(d,h){var m=d.bgColor,f=d.bgD,p=d.fgD,b=d.fgColor,x=d.size,v=d.title,S=d.viewBoxSize,B=d.xmlns,V=B===void 0?"http://www.w3.org/2000/svg":B,R=o(d,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return i.default.createElement("svg",n({},R,{height:x,ref:h,viewBox:"0 0 "+S+" "+S,width:x,xmlns:V}),v?i.default.createElement("title",null,v):null,i.default.createElement("path",{d:f,fill:m}),i.default.createElement("path",{d:p,fill:b}))});return c.displayName="QRCodeSvg",c.propTypes=l,pf.default=c,pf}var oF;function Wme(){if(oF)return uu;oF=1,Object.defineProperty(uu,"__esModule",{value:!0}),uu.QRCode=void 0;var n=Object.assign||function(x){for(var v=1;v<arguments.length;v++){var S=arguments[v];for(var B in S)Object.prototype.hasOwnProperty.call(S,B)&&(x[B]=S[B])}return x},e=La(),t=m(e),s=dD(),i=m(s),a=kme(),o=m(a),l=Ar(),c=m(l),d=Rme(),h=m(d);function m(x){return x&&x.__esModule?x:{default:x}}function f(x,v){var S={};for(var B in x)v.indexOf(B)>=0||Object.prototype.hasOwnProperty.call(x,B)&&(S[B]=x[B]);return S}var p={bgColor:t.default.oneOfType([t.default.object,t.default.string]),fgColor:t.default.oneOfType([t.default.object,t.default.string]),level:t.default.string,size:t.default.number,value:t.default.string.isRequired},b=(0,l.forwardRef)(function(x,v){var S=x.bgColor,B=S===void 0?"#FFFFFF":S,V=x.fgColor,R=V===void 0?"#000000":V,W=x.level,_=W===void 0?"L":W,Y=x.size,j=Y===void 0?256:Y,M=x.value,H=f(x,["bgColor","fgColor","level","size","value"]),D=new o.default(-1,i.default[_]);D.addData(M),D.make();var z=D.modules;return c.default.createElement(h.default,n({},H,{bgColor:B,bgD:z.map(function(O,E){return O.map(function(te,q){return te?"":"M "+q+" "+E+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:R,fgD:z.map(function(O,E){return O.map(function(te,q){return te?"M "+q+" "+E+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:v,size:j,viewBoxSize:z.length}))});return uu.QRCode=b,b.displayName="QRCode",b.propTypes=p,uu.default=b,uu}var Vme=Wme();const _me=rd(Vme),jme=()=>{const{user:n}=bt(),[e,t]=k.useState([]),[s,i]=k.useState(!1),[a,o]=k.useState([]),[l,c]=k.useState(""),[d,h]=k.useState(""),[m,f]=k.useState(!1),[p,b]=k.useState(["Is the area secure?"]),[x,v]=k.useState(30),[S,B]=k.useState(null),[V,R]=k.useState(null);k.useEffect(()=>{W()},[]);const W=async()=>{try{const[O,E]=await Promise.all([ce.getOrganizations(),ce.getPatrolQrCodes()]),te=Array.from(new Set(E.map(P=>P.siteId))),q=new Set(O.map(P=>P.id)),de=te.filter(P=>!q.has(P)&&P).map(P=>({id:P,fullName:`${P} (Manual)`,shortName:P})),U=[...O,...de];t(U),U.length>0&&!l&&!m&&c(U[0].id)}catch(O){console.error(O)}},_=async()=>{if(l)try{const O=await ce.getPatrolQrCodes(l);o(O)}catch(O){console.error(O)}};k.useEffect(()=>{l&&_()},[l]);const Y=async()=>{try{const O=await bG.getCurrentPosition();B({lat:O.coords.latitude,lng:O.coords.longitude})}catch{alert("Could not fetch location")}},j=async()=>{if(!l||!d||!S){alert("Please fill all fields and get GPS location.");return}try{i(!0);const O={siteId:l,name:d,latitude:S.lat,longitude:S.lng,radiusMeters:x,questions:p,requirePhotoOnNo:!0,status:"active"};V?(await ce.updatePatrolQrCode(V,O),alert("QR Code Updated!")):(await ce.createPatrolQrCode(O),alert("QR Code Created!")),_(),W(),D()}catch(O){alert(O.message)}finally{i(!1)}},M=async O=>{if(window.confirm("Are you sure you want to delete this checkpoint?"))try{await ce.deletePatrolQrCode(O),_()}catch(E){alert(E.message)}},H=O=>{R(O.id),h(O.name),v(O.radiusMeters),b(O.questions||["Is the area secure?"]),B({lat:O.latitude,lng:O.longitude}),c(O.siteId),f(!1)},D=()=>{R(null),h(""),b(["Is the area secure?"]),v(30),B(null)},z=O=>{const E=document.getElementById(`qr-${O.id}`);if(!E)return;const te=new XMLSerializer().serializeToString(E),q=document.createElement("canvas"),de=q.getContext("2d"),U=new Image;U.onload=()=>{q.width=U.width,q.height=U.height,de?.drawImage(U,0,0);const P=q.toDataURL("image/png"),ne=document.createElement("a");ne.download=`${O.name}-QR.png`,ne.href=P,ne.click()},U.src="data:image/svg+xml;base64,"+btoa(te)};return r.jsxs("div",{className:"p-6 bg-white shadow rounded-lg",children:[r.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Patrol QR Management"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[r.jsxs("div",{className:"space-y-4 border p-4 rounded-lg bg-gray-50",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h3",{className:"font-semibold text-lg",children:V?"Edit Checkpoint":"Create New Checkpoint"}),V&&r.jsx("button",{onClick:D,className:"text-xs text-gray-500 hover:text-gray-700",children:"Cancel Edit"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-1",children:[r.jsx("label",{className:"block text-sm font-medium",children:"Select Site"}),r.jsx("button",{onClick:()=>{f(!m),c("")},className:"text-xs text-blue-600 hover:underline",children:m?"Select from List":"Enter Manually"})]}),m?r.jsx("input",{type:"text",className:"w-full border p-2 rounded",placeholder:"Enter Site Name / ID",value:l,onChange:O=>c(O.target.value)}):r.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:O=>c(O.target.value),children:[r.jsx("option",{value:"",children:"Select a Site..."}),e.map(O=>r.jsx("option",{value:O.id,children:O.fullName},O.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium",children:"Checkpoint Name"}),r.jsx("input",{type:"text",className:"w-full border p-2 rounded",placeholder:"e.g. Main Gate, Rear Entrance",value:d,onChange:O=>h(O.target.value)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Verification Checklist"}),p.map((O,E)=>r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{type:"text",className:"w-full border p-2 rounded",placeholder:`Question ${E+1}`,value:O,onChange:te=>{const q=[...p];q[E]=te.target.value,b(q)}}),p.length>1&&r.jsx("button",{onClick:()=>{const te=p.filter((q,de)=>de!==E);b(te)},className:"text-red-500 hover:text-red-700 px-2 font-bold",title:"Remove",children:"x"})]},E)),r.jsx("button",{onClick:()=>b([...p,""]),className:"text-sm text-blue-600 font-semibold hover:underline mt-1",children:"+ Add Question"})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-medium",children:"Radius (Meters)"}),r.jsx("input",{type:"number",className:"w-full border p-2 rounded",value:x,onChange:O=>v(Number(O.target.value))})]}),r.jsx("div",{className:"flex-1 pt-6",children:r.jsxs("button",{onClick:Y,className:`w-full py-2 rounded flex items-center justify-center gap-2 ${S?"bg-green-100 text-green-700 border-green-300":"bg-blue-100 text-blue-700"}`,children:[r.jsx(Bi,{size:16}),S?"Updated":"Get GPS"]})})]}),S&&r.jsxs("p",{className:"text-xs text-gray-500",children:["Lat: ",S.lat,", Lng: ",S.lng]}),r.jsxs("button",{onClick:j,disabled:s,className:"w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700 flex items-center justify-center gap-2",children:[s?r.jsx(Du,{className:"animate-spin"}):r.jsx(fr,{})," ",V?"Update Checkpoint":"Save & Generate QR"]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"font-semibold text-lg flex justify-between",children:["Existing Checkpoints",r.jsx("button",{onClick:_,children:r.jsx(Du,{size:16})})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto",children:a.map(O=>r.jsxs("div",{className:"border p-4 rounded-lg flex flex-col items-center bg-white shadow-sm",children:[r.jsx("h4",{className:"font-bold mb-2",children:O.name}),r.jsx("div",{className:"bg-white p-2",children:r.jsx(_me,{id:`qr-${O.id}`,value:JSON.stringify({id:O.id}),size:120})}),r.jsxs("button",{onClick:()=>z(O),className:"mt-3 text-sm text-blue-600 flex items-center gap-1 hover:underline",children:[r.jsx(si,{size:14})," Download PNG"]}),r.jsxs("div",{className:"flex gap-2 w-full mt-3",children:[r.jsx("button",{onClick:()=>H(O),className:"flex-1 py-1 text-xs border rounded hover:bg-gray-50 text-blue-600",children:"Edit"}),r.jsx("button",{onClick:()=>M(O.id),className:"flex-1 py-1 text-xs border rounded hover:bg-gray-50 text-red-600",children:"Delete"})]}),r.jsxs("div",{className:"text-xs text-center mt-2 text-gray-400",children:["Radius: ",O.radiusMeters,"m"]})]},O.id))})]})]})]})},Xme=()=>{const{theme:n,isAutomatic:e,_setThemeInternal:t}=Fl(),{colorScheme:s}=an(),i=jt("(max-width: 767px)");return k.useEffect(()=>{const a=document.body;let o="light";e?i?o="dark":o="light":o=n,t(o),o==="dark"?a.classList.add("pro-dark-theme"):a.classList.remove("pro-dark-theme")},[n,e,i,t,s]),null},Jme=()=>{const{colorScheme:n,appTitle:e}=an();return k.useEffect(()=>{const t=document.body;t.classList.remove("blue-theme","green-theme","purple-theme","red-theme","amber-theme","professional-blue-theme","dark-saas-theme","teal-mint-theme","indigo-violet-theme","green-finance-theme","orange-energy-theme","red-alert-theme","neutral-gray-theme","cyan-tech-theme","black-gold-theme"),t.classList.add(`${n}-theme`),e&&(document.title=e)},[n,e]),null},kf="app:lastPath",Yme=["/auth","/splash","/pending-approval","/forbidden"],YZ=n=>n==="/"||n==="/#"||n==="/index.html"?!1:!Yme.some(e=>n.startsWith(e)),Fme=()=>{const{user:n,isInitialized:e}=bt(),t=er(),s=jt("(max-width: 767px)");return Z6(),e?n?n.role==="unverified"?r.jsx(Bl,{to:"/pending-approval",replace:!0}):r.jsx(U$,{children:s?r.jsx(B$,{}):r.jsx(Z$,{})}):(YZ(t.pathname+t.search)&&localStorage.setItem(kf,t.pathname+t.search),r.jsx(Bl,{to:"/auth/login",replace:!0})):null},Mme=()=>{const{user:n,isInitialized:e,setUser:t,setInitialized:s,resetAttendance:i,setLoading:a,isLoginAnimationPending:o}=bt(),{init:l}=dd(),{initRoles:c}=ha(),{initSettings:d}=wi(),{initBranding:h}=an(),m=vt(),f=er();return k.useEffect(()=>{n&&YZ(f.pathname+f.search)&&localStorage.setItem(kf,f.pathname+f.search)},[n,f.pathname,f.search]),k.useEffect(()=>{let p=!0;const b=setTimeout(()=>{p&&(console.warn("App initialization is taking too long. Proceeding without a session."),a(!1),s(!0))},3e4);(async()=>{a(!0);try{let{data:{session:S},error:B}=await ve.auth.getSession();if(B&&console.error("Error fetching initial session:",B.message),!S){const V=localStorage.getItem("supabase.auth.rememberMe");if(V){console.log("Attempting to restore session from long-term token...");try{const{data:R,error:W}=await ve.auth.setSession({refresh_token:V});W?(console.error("Failed to restore session from long-term token:",W.message),localStorage.removeItem("supabase.auth.rememberMe")):S=R.session}catch(R){console.error("Exception while restoring session from long-term token:",R)}}}if(S)try{const V=await Ja.getAppUserProfile(S.user);p&&t(V)}catch(V){console.error("Failed to fetch user profile during initialization:",V),p&&(t(null),i())}else p&&(t(null),i())}catch(S){console.error("Error during app initialization:",S),p&&(t(null),i())}finally{clearTimeout(b),p&&(a(!1),s(!0))}})();const{data:{subscription:v}}=ve.auth.onAuthStateChange((S,B)=>{if(S==="PASSWORD_RECOVERY"){m("/auth/update-password",{replace:!0});return}B?.user?setTimeout(async()=>{try{const V=await Ja.getAppUserProfile(B.user);if(p&&(t(V),V))try{const R=`greetingSent_${V.id}`;localStorage.getItem(R)||(await ce.createNotification({userId:V.id,message:`Good morning, ${V.name||"there"}! Welcome to Paradigm Services.`,type:"greeting"}),localStorage.setItem(R,"1"))}catch(R){console.error("Failed to send login greeting notification",R)}}catch(V){console.error("Failed to fetch user profile after auth change:",V),p&&(t(null),i(),Qn.getState().reset())}},0):p&&(t(null),i(),Qn.getState().reset())});return()=>{p=!1,v?.unsubscribe(),clearTimeout(b)}},[t,s,i,a]),k.useEffect(()=>{n&&e&&((async()=>{try{const{settings:b,roles:x,holidays:v}=await ce.getInitialAppData(),S=await ce.getRecurringHolidays();if(b.enrollmentRules&&l(b.enrollmentRules),x&&c(x),b.attendanceSettings&&v&&d({holidays:v,attendanceSettings:b.attendanceSettings,recurringHolidays:S||[]}),b.apiSettings?.colorScheme){const{userHasSetPreference:B,setAppTitle:V}=an.getState();B?b.apiSettings.appTitle&&V(b.apiSettings.appTitle):h(b.apiSettings.colorScheme,b.apiSettings.appTitle)}if(b.apiSettings?.globalLogo){const B=Dm.getState();B.setDefaultLogoValue&&B.setDefaultLogoValue(b.apiSettings.globalLogo),!B.userHasSetLogo&&B.initLogo?B.initLogo(b.apiSettings.globalLogo):B.userHasSetLogo||B.setCurrentLogo(b.apiSettings.globalLogo)}}catch(b){console.error("Failed to load initial application data:",b)}})(),bt.getState().checkAttendanceStatus())},[n,e,l,c,d,h]),k.useEffect(()=>{if(e&&f.pathname!=="/auth/update-password"&&n&&!o&&(f.pathname.startsWith("/auth")&&f.pathname!=="/auth/logout"||f.pathname==="/"||f.pathname==="/splash")){const p=localStorage.getItem(kf);p&&YZ(p)&&p!=="/"&&p!=="/#"?(localStorage.removeItem(kf),m(p,{replace:!0})):n.role==="unverified"?m("/pending-approval",{replace:!0}):m("/profile",{replace:!0})}},[e,n,f.pathname,m,o]),e?r.jsxs(r.Fragment,{children:[r.jsx(Khe,{}),r.jsx(Xme,{}),r.jsx(Jme,{}),n&&r.jsx(Phe,{}),r.jsxs(z5,{children:[r.jsxs(Te,{path:"/auth",element:r.jsx(k$,{}),children:[r.jsx(Te,{index:!0,element:r.jsx(Bl,{to:"login",replace:!0})}),r.jsx(Te,{path:"login",element:r.jsx(ste,{})}),r.jsx(Te,{path:"signup",element:r.jsx(ite,{})}),r.jsx(Te,{path:"forgot-password",element:r.jsx(ote,{})}),r.jsx(Te,{path:"update-password",element:r.jsx(dte,{})}),r.jsx(Te,{path:"logout",element:r.jsx(gte,{})})]}),r.jsx(Te,{path:"/pending-approval",element:n&&n.role==="unverified"?r.jsx(ute,{}):r.jsx(Bl,{to:"/auth/login",replace:!0})}),r.jsx(Te,{path:"/forbidden",element:r.jsx(hte,{})}),r.jsxs(Te,{path:"/",element:r.jsx(V$,{children:r.jsx(Fme,{})}),children:[r.jsx(Te,{index:!0,element:r.jsx(Bl,{to:"/profile",replace:!0})}),r.jsx(Te,{path:"profile",element:r.jsx(rae,{})}),r.jsx(Te,{path:"mobile-home",element:r.jsx($$,{})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"create_enrollment"}),children:[r.jsx(Te,{path:"onboarding",element:r.jsx(mte,{})}),r.jsx(Te,{path:"onboarding/select-organization",element:r.jsx(Ite,{})}),r.jsx(Te,{path:"onboarding/pre-upload",element:r.jsx(Fue,{})}),r.jsx(Te,{path:"onboarding/submissions",element:r.jsx(Tue,{})}),r.jsx(Te,{path:"onboarding/tasks",element:r.jsx(Due,{})}),r.jsx(Te,{path:"onboarding/uniforms",element:r.jsx(Kue,{})}),r.jsxs(Te,{path:"onboarding/add",element:r.jsx(Cte,{}),children:[r.jsx(Te,{path:"personal",element:r.jsx(phe,{})}),r.jsx(Te,{path:"address",element:r.jsx(bhe,{})}),r.jsx(Te,{path:"organization",element:r.jsx(vhe,{})}),r.jsx(Te,{path:"family",element:r.jsx(xhe,{})}),r.jsx(Te,{path:"education",element:r.jsx(She,{})}),r.jsx(Te,{path:"bank",element:r.jsx(Ghe,{})}),r.jsx(Te,{path:"uan",element:r.jsx(Nhe,{})}),r.jsx(Te,{path:"esi",element:r.jsx(Rhe,{})}),r.jsx(Te,{path:"gmc",element:r.jsx(Xhe,{})}),r.jsx(Te,{path:"uniform",element:r.jsx(Jhe,{})}),r.jsx(Te,{path:"documents",element:r.jsx(Yhe,{})}),r.jsx(Te,{path:"biometrics",element:r.jsx(Hhe,{})}),r.jsx(Te,{path:"review",element:r.jsx(The,{})})]}),r.jsx(Te,{path:"onboarding/pdf/:id",element:r.jsx(pue,{})})]}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"view_all_submissions"}),children:r.jsx(Te,{path:"verification/dashboard",element:r.jsx(bte,{})})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_users"}),children:[r.jsx(Te,{path:"admin/users",element:r.jsx(xte,{})}),r.jsx(Te,{path:"admin/users/add",element:r.jsx(HY,{})}),r.jsx(Te,{path:"admin/users/edit/:id",element:r.jsx(HY,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_sites"}),children:[r.jsx(Te,{path:"admin/sites",element:r.jsx(Eie,{})}),r.jsx(Te,{path:"admin/sites/add",element:r.jsx(mhe,{})}),r.jsx(Te,{path:"admin/sites/quick-add",element:r.jsx(Ihe,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_roles_and_permissions"}),children:[r.jsx(Te,{path:"admin/roles",element:r.jsx(Lie,{})}),r.jsx(Te,{path:"admin/roles/add",element:r.jsx(TY,{})}),r.jsx(Te,{path:"admin/roles/edit/:id",element:r.jsx(TY,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_modules"}),children:[r.jsx(Te,{path:"admin/modules",element:r.jsx(zie,{})}),r.jsx(Te,{path:"admin/modules/add",element:r.jsx(uhe,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_approval_workflow"}),children:[r.jsx(Te,{path:"admin/approval-workflow",element:r.jsx(Cge,{})}),r.jsx(Te,{path:"admin/approval-workflow/chart",element:r.jsx(fge,{})}),r.jsx(Te,{path:"admin/patrol/dashboard",element:r.jsx(Ohe,{})}),r.jsx(Te,{path:"admin/patrol/qr-codes",element:r.jsx(jme,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"view_developer_settings"}),children:[r.jsx(Te,{path:"developer/api",element:r.jsx(Qie,{})}),r.jsx(Te,{path:"patrol/scan",element:r.jsx(wme,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"view_operations_dashboard"}),children:[r.jsx(Te,{path:"operations/dashboard",element:r.jsx($ie,{})}),r.jsx(Te,{path:"operations/team-activity",element:r.jsx(eae,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"view_field_officer_tracking"}),children:[r.jsx(Te,{path:"my-team",element:r.jsx(Whe,{})}),r.jsx(Te,{path:"my-team/:userId",element:r.jsx(_he,{})}),r.jsx(Te,{path:"hr/tracking",element:r.jsx(FY,{})})]}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"view_site_dashboard"}),children:r.jsx(Te,{path:"site/dashboard",element:r.jsx(nae,{})})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"view_own_attendance"}),children:[r.jsx(Te,{path:"attendance/dashboard",element:r.jsx(qde,{})}),r.jsx(Te,{path:"attendance/locations",element:r.jsx(tge,{})}),r.jsx(Te,{path:"attendance/check-in",element:r.jsx(WY,{})}),r.jsx(Te,{path:"attendance/check-out",element:r.jsx(WY,{})})]}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"apply_for_leave"}),children:r.jsx(Te,{path:"leaves/dashboard",element:r.jsx(dge,{})})}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"manage_attendance_rules"}),children:r.jsx(Te,{path:"hr/attendance-settings",element:r.jsx(nge,{})})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_leave_requests"}),children:[r.jsx(Te,{path:"hr/leave-management",element:r.jsx(mge,{})}),r.jsx(Te,{path:"hr/leave-management/grant-comp-off",element:r.jsx(ghe,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"view_entity_management"}),children:[r.jsx(Te,{path:"hr/entities",element:r.jsx(due,{})}),r.jsx(Te,{path:"hr/entity-management/add-group",element:r.jsx(dhe,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_policies"}),children:[r.jsx(Te,{path:"hr/policies-and-insurance",element:r.jsx(Cue,{})}),r.jsx(Te,{path:"hr/policies/add",element:r.jsx(ohe,{})})]}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"manage_enrollment_rules"}),children:r.jsx(Te,{path:"hr/enrollment-rules",element:r.jsx(fue,{})})}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"view_field_officer_tracking"}),children:r.jsx(Te,{path:"hr/field-officer-tracking",element:r.jsx(FY,{})})}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"manage_attendance_rules"}),children:r.jsx(Te,{path:"hr/locations",element:r.jsx(jue,{})})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_uniforms"}),children:[r.jsx(Te,{path:"uniforms",element:r.jsx(yue,{})}),r.jsx(Te,{path:"uniforms/request/new",element:r.jsx(DY,{})}),r.jsx(Te,{path:"uniforms/request/edit/:id",element:r.jsx(DY,{})})]}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"view_verification_costing"}),children:r.jsx(Te,{path:"billing/cost-analysis",element:r.jsx(Sue,{})})}),r.jsx(Te,{element:r.jsx(Dn,{requiredPermission:"view_invoice_summary"}),children:r.jsx(Te,{path:"billing/summary",element:r.jsx(Gue,{})})}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"manage_tasks"}),children:[r.jsx(Te,{path:"tasks",element:r.jsx(yge,{})}),r.jsx(Te,{path:"tasks/add",element:r.jsx(EY,{})}),r.jsx(Te,{path:"tasks/edit/:id",element:r.jsx(EY,{})})]}),r.jsxs(Te,{element:r.jsx(Dn,{requiredPermission:"access_support_desk"}),children:[r.jsx(Te,{path:"support",element:r.jsx(Que,{})}),r.jsx(Te,{path:"support/ticket/new",element:r.jsx(che,{})}),r.jsx(Te,{path:"support/ticket/:id",element:r.jsx(rhe,{})})]})]}),r.jsx(Te,{path:"*",element:r.jsx(Bl,{to:"/",replace:!0})})]})]}):r.jsx(q$,{})},mD=document.getElementById("root");if(!mD)throw new Error("Could not find root element to mount to");const Hme=r5.createRoot(mD);Hme.render(r.jsx(ot.StrictMode,{children:r.jsx(r9,{children:r.jsx(Mme,{})})}));export{F2 as E,AG as W,Mm as _,nme as a,Ru as b,Tme as c,rd as d,H$ as e,Qhe as f,cF as g};
